import{n as dn,o as Vi,A as Ue,d as Mr,P as St,q as Ci,s as De,m as Ji,u as Ot,v as Fe,w as Ye,M as Ht,L as It,x as Ge,y as qe,j as ee,z as _i,T as yi,h as kt,f as ke,B as Ae,g as je,C as E_,D as nt,F as mt,G as it,E as cg,l as Te,K as fg,I as J,O as mv,Q as bv,R as Cv,S as _v,N as Xi,U as wv,V as yv,W as gg,i as O,X as L_,a0 as os,Y as vh,Z as F_,_ as vv,$ as pg,a1 as Ri,a2 as z_,a3 as Sh,a7 as Hu,k as re,b as Xe,H as Fn,a8 as I_,a9 as Sv,aa as lr,ab as ei,ad as xv,ae as ye,ag as Rv,ai as mg,aj as bg,af as xh,ak as Av,a6 as Bv,e as Or,a5 as vt,al as Cr,am as Mv,aP as O_,aQ as Kd,aR as bf,aS as Tv,aY as Pv,aJ as Hv,ao as Cf,b0 as kv}from"./linear-scale-E30nU8tb.js";import{aq as D_}from"./index-D_-DzWhp.js";import{j as Ev}from"./get-C9XpniJp.js";import{E as Lo}from"./index-k_YsQNhl.js";var li={},ku={},ai={},Cg;function W_(){if(Cg)return ai;Cg=1,Object.defineProperty(ai,"__esModule",{value:!0}),ai.loop=ai.conditional=ai.parse=void 0;var n=function i(r,o){var s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},l=arguments.length>3&&arguments[3]!==void 0?arguments[3]:s;if(Array.isArray(o))o.forEach(function(d){return i(r,d,s,l)});else if(typeof o=="function")o(r,s,l,i);else{var a=Object.keys(o)[0];Array.isArray(o[a])?(l[a]={},i(r,o[a],s,l[a])):l[a]=o[a](r,s,l,i)}return s};ai.parse=n;var e=function(r,o){return function(s,l,a,d){o(s,l,a)&&d(s,r,l,a)}};ai.conditional=e;var t=function(r,o){return function(s,l,a,d){for(var u=[],h=s.pos;o(s,l,a);){var c={};if(d(s,r,l,c),s.pos===h)break;h=s.pos,u.push(c)}return u}};return ai.loop=t,ai}var ht={},_g;function N_(){if(_g)return ht;_g=1,Object.defineProperty(ht,"__esModule",{value:!0}),ht.readBits=ht.readArray=ht.readUnsigned=ht.readString=ht.peekBytes=ht.readBytes=ht.peekByte=ht.readByte=ht.buildStream=void 0;var n=function(h){return{data:h,pos:0}};ht.buildStream=n;var e=function(){return function(h){return h.data[h.pos++]}};ht.readByte=e;var t=function(){var h=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;return function(c){return c.data[c.pos+h]}};ht.peekByte=t;var i=function(h){return function(c){return c.data.subarray(c.pos,c.pos+=h)}};ht.readBytes=i;var r=function(h){return function(c){return c.data.subarray(c.pos,c.pos+h)}};ht.peekBytes=r;var o=function(h){return function(c){return Array.from(i(h)(c)).map(function(g){return String.fromCharCode(g)}).join("")}};ht.readString=o;var s=function(h){return function(c){var g=i(2)(c);return h?(g[1]<<8)+g[0]:(g[0]<<8)+g[1]}};ht.readUnsigned=s;var l=function(h,c){return function(g,f,p){for(var m=typeof c=="function"?c(g,f,p):c,b=i(h),C=new Array(m),_=0;_<m;_++)C[_]=b(g);return C}};ht.readArray=l;var a=function(h,c,g){for(var f=0,p=0;p<g;p++)f+=h[c+p]&&Math.pow(2,g-p-1);return f},d=function(h){return function(c){for(var g=e()(c),f=new Array(8),p=0;p<8;p++)f[7-p]=!!(g&1<<p);return Object.keys(h).reduce(function(m,b){var C=h[b];return C.length?m[b]=a(f,C.index,C.length):m[b]=f[C.index],m},{})}};return ht.readBits=d,ht}var wg;function Lv(){return wg||(wg=1,function(n){Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var e=W_(),t=N_(),i={blocks:function(c){for(var g=0,f=[],p=c.data.length,m=0,b=(0,t.readByte)()(c);b!==g&&b;b=(0,t.readByte)()(c)){if(c.pos+b>=p){var C=p-c.pos;f.push((0,t.readBytes)(C)(c)),m+=C;break}f.push((0,t.readBytes)(b)(c)),m+=b}for(var _=new Uint8Array(m),w=0,y=0;y<f.length;y++)_.set(f[y],w),w+=f[y].length;return _}},r=(0,e.conditional)({gce:[{codes:(0,t.readBytes)(2)},{byteSize:(0,t.readByte)()},{extras:(0,t.readBits)({future:{index:0,length:3},disposal:{index:3,length:3},userInput:{index:6},transparentColorGiven:{index:7}})},{delay:(0,t.readUnsigned)(!0)},{transparentColorIndex:(0,t.readByte)()},{terminator:(0,t.readByte)()}]},function(h){var c=(0,t.peekBytes)(2)(h);return c[0]===33&&c[1]===249}),o=(0,e.conditional)({image:[{code:(0,t.readByte)()},{descriptor:[{left:(0,t.readUnsigned)(!0)},{top:(0,t.readUnsigned)(!0)},{width:(0,t.readUnsigned)(!0)},{height:(0,t.readUnsigned)(!0)},{lct:(0,t.readBits)({exists:{index:0},interlaced:{index:1},sort:{index:2},future:{index:3,length:2},size:{index:5,length:3}})}]},(0,e.conditional)({lct:(0,t.readArray)(3,function(h,c,g){return Math.pow(2,g.descriptor.lct.size+1)})},function(h,c,g){return g.descriptor.lct.exists}),{data:[{minCodeSize:(0,t.readByte)()},i]}]},function(h){return(0,t.peekByte)()(h)===44}),s=(0,e.conditional)({text:[{codes:(0,t.readBytes)(2)},{blockSize:(0,t.readByte)()},{preData:function(c,g,f){return(0,t.readBytes)(f.text.blockSize)(c)}},i]},function(h){var c=(0,t.peekBytes)(2)(h);return c[0]===33&&c[1]===1}),l=(0,e.conditional)({application:[{codes:(0,t.readBytes)(2)},{blockSize:(0,t.readByte)()},{id:function(c,g,f){return(0,t.readString)(f.blockSize)(c)}},i]},function(h){var c=(0,t.peekBytes)(2)(h);return c[0]===33&&c[1]===255}),a=(0,e.conditional)({comment:[{codes:(0,t.readBytes)(2)},i]},function(h){var c=(0,t.peekBytes)(2)(h);return c[0]===33&&c[1]===254}),d=[{header:[{signature:(0,t.readString)(3)},{version:(0,t.readString)(3)}]},{lsd:[{width:(0,t.readUnsigned)(!0)},{height:(0,t.readUnsigned)(!0)},{gct:(0,t.readBits)({exists:{index:0},resolution:{index:1,length:3},sort:{index:4},size:{index:5,length:3}})},{backgroundColorIndex:(0,t.readByte)()},{pixelAspectRatio:(0,t.readByte)()}]},(0,e.conditional)({gct:(0,t.readArray)(3,function(h,c){return Math.pow(2,c.lsd.gct.size+1)})},function(h,c){return c.lsd.gct.exists}),{frames:(0,e.loop)([r,l,a,o,s],function(h){var c=(0,t.peekByte)()(h);return c===33||c===44})}],u=d;n.default=u}(ku)),ku}var Uo={},yg;function Fv(){if(yg)return Uo;yg=1,Object.defineProperty(Uo,"__esModule",{value:!0}),Uo.deinterlace=void 0;var n=function(t,i){for(var r=new Array(t.length),o=t.length/i,s=function(g,f){var p=t.slice(f*i,(f+1)*i);r.splice.apply(r,[g*i,i].concat(p))},l=[0,4,2,1],a=[8,8,4,2],d=0,u=0;u<4;u++)for(var h=l[u];h<o;h+=a[u])s(h,d),d++;return r};return Uo.deinterlace=n,Uo}var $o={},vg;function zv(){if(vg)return $o;vg=1,Object.defineProperty($o,"__esModule",{value:!0}),$o.lzw=void 0;var n=function(t,i,r){var o=4096,s=-1,l=r,a,d,u,h,c,g,f,x,p,m,v,b,S,R,A,B,C=new Array(r),_=new Array(o),w=new Array(o),y=new Array(o+1);for(b=t,d=1<<b,c=d+1,a=d+2,f=s,h=b+1,u=(1<<h)-1,p=0;p<d;p++)_[p]=0,w[p]=p;var v,x,S,R,B,A;for(v=x=S=R=B=A=0,m=0;m<l;){if(R===0){if(x<h){v+=i[A]<<x,x+=8,A++;continue}if(p=v&u,v>>=h,x-=h,p>a||p==c)break;if(p==d){h=b+1,u=(1<<h)-1,a=d+2,f=s;continue}if(f==s){y[R++]=w[p],f=p,S=p;continue}for(g=p,p==a&&(y[R++]=S,p=f);p>d;)y[R++]=w[p],p=_[p];S=w[p]&255,y[R++]=S,a<o&&(_[a]=f,w[a]=S,a++,(a&u)===0&&a<o&&(h++,u+=a)),f=g}R--,C[B++]=y[R],m++}for(m=B;m<l;m++)C[m]=0;return C};return $o.lzw=n,$o}var Sg;function Iv(){if(Sg)return li;Sg=1,Object.defineProperty(li,"__esModule",{value:!0}),li.decompressFrames=li.decompressFrame=li.parseGIF=void 0;var n=o(Lv()),e=W_(),t=N_(),i=Fv(),r=zv();function o(u){return u&&u.__esModule?u:{default:u}}var s=function(h){var c=new Uint8Array(h);return(0,e.parse)((0,t.buildStream)(c),n.default)};li.parseGIF=s;var l=function(h){for(var c=h.pixels.length,g=new Uint8ClampedArray(c*4),f=0;f<c;f++){var p=f*4,m=h.pixels[f],b=h.colorTable[m]||[0,0,0];g[p]=b[0],g[p+1]=b[1],g[p+2]=b[2],g[p+3]=m!==h.transparentIndex?255:0}return g},a=function(h,c,g){if(!h.image){console.warn("gif frame does not have associated image.");return}var f=h.image,p=f.descriptor.width*f.descriptor.height,m=(0,r.lzw)(f.data.minCodeSize,f.data.blocks,p);f.descriptor.lct.interlaced&&(m=(0,i.deinterlace)(m,f.descriptor.width));var b={pixels:m,dims:{top:h.image.descriptor.top,left:h.image.descriptor.left,width:h.image.descriptor.width,height:h.image.descriptor.height}};return f.descriptor.lct&&f.descriptor.lct.exists?b.colorTable=f.lct:b.colorTable=c,h.gce&&(b.delay=(h.gce.delay||10)*10,b.disposalType=h.gce.extras.disposal,h.gce.extras.transparentColorGiven&&(b.transparentIndex=h.gce.transparentColorIndex)),g&&(b.patch=l(b)),b};li.decompressFrame=a;var d=function(h,c){return h.frames.filter(function(g){return g.image}).map(function(g){return a(g,h.gct,c)})};return li.decompressFrames=d,li}var xg=Iv();class pt{static GenAutoIncrementId(){return pt.auto_increment_id++}}pt.auto_increment_id=0;class we{constructor(e){this.id=pt.GenAutoIncrementId(),this.registry=e}}const Yd="named",V_="inject",G_="multi_inject",j_="inversify:tagged",U_="inversify:paramtypes";class _f{constructor(e,t){this.key=e,this.value=t}toString(){return this.key===Yd?`named: ${String(this.value).toString()} `:`tagged: { key:${this.key.toString()}, value: ${String(this.value)} }`}}const ao=function(n){var e;return function(t){const i=typeof Symbol=="function",r=i&&Symbol.toPrimitive!==void 0?Symbol.toPrimitive:"@@toPrimitive",o=Object.getPrototypeOf(Function),s=Map,l=new WeakMap;function a(T,P,k,L){if(!v(k))throw new TypeError;return b(T,P,k,L)}function d(T,P,k){if(!v(P))throw new TypeError;return _(k)||(k=A(k)),g(T,P,k)}function u(T,P,k){if(!v(P))throw new TypeError;return _(k)||(k=A(k)),f(T,P,k)}function h(T,P,k){if(!v(P))throw new TypeError;return _(k)||(k=A(k)),p(T,P,k)}function c(T,P,k){let L=l.get(T);if(_(L)){if(!k)return;L=new s,l.set(T,L)}let F=L.get(P);if(_(F)){if(!k)return;F=new s,L.set(P,F)}return F}function g(T,P,k){if(f(T,P,k))return!0;const L=E(P);return!w(L)&&g(T,L,k)}function f(T,P,k){const L=c(P,k,!1);return!_(L)&&R(L.has(T))}function p(T,P,k){if(f(T,P,k))return m(T,P,k);const L=E(P);return w(L)?void 0:p(T,L,k)}function m(T,P,k){const L=c(P,k,!1);if(!_(L))return L.get(T)}function b(T,P,k,L){c(k,L,!0).set(T,P)}function C(T){if(T===null)return 1;switch(typeof T){case"undefined":return 0;case"boolean":return 2;case"string":return 3;case"symbol":return 4;case"number":return 5;case"object":return T===null?1:6;default:return 6}}function _(T){return T===void 0}function w(T){return T===null}function y(T){return typeof T=="symbol"}function v(T){return typeof T=="object"?T!==null:typeof T=="function"}function x(T,P){switch(C(T)){case 0:case 1:case 2:case 3:case 4:case 5:return T}const k="string",L=H(T,r);if(L!==void 0){const F=L.call(T,k);if(v(F))throw new TypeError;return F}return S(T)}function S(T,P){{const k=T.toString;if(M(k)){const F=k.call(T);if(!v(F))return F}const L=T.valueOf;if(M(L)){const F=L.call(T);if(!v(F))return F}}throw new TypeError}function R(T){return!!T}function B(T){return""+T}function A(T){const P=x(T);return y(P)?P:B(P)}function M(T){return typeof T=="function"}function H(T,P){const k=T[P];if(k!=null){if(!M(k))throw new TypeError;return k}}function E(T){const P=Object.getPrototypeOf(T);if(typeof T!="function"||T===o||P!==o)return P;const k=T.prototype,L=k&&Object.getPrototypeOf(k);if(L==null||L===Object.prototype)return P;const F=L.constructor;return typeof F!="function"||F===T?P:F}t("defineMetadata",a),t("hasMetadata",d),t("hasOwnMetadata",u),t("getMetadata",h)}((e=n,function(t,i){typeof e[t]!="function"&&Object.defineProperty(e,t,{configurable:!0,writable:!0,value:i})})),n}({});function Ov(n,e,t,i){const r=[i];let o={};ao.hasOwnMetadata(n,e)&&(o=ao.getMetadata(n,e));let s=o[t];s===void 0&&(s=[]),s.push(...r),o[t]=s,ao.defineMetadata(n,o,e)}function Dv(n,e,t,i){Ov(j_,n,t.toString(),i)}function $_(n){return(e,t,i)=>{Dv(e,t,i,n)}}function K_(n){return e=>(t,i,r)=>$_(new _f(n,e))(t,i,r)}const Be=K_(V_),Y_=K_(G_);function se(){return function(n){return ao.defineMetadata(U_,null,n),n}}function At(n){return $_(new _f(Yd,n))}const Tr={Singleton:"Singleton",Transient:"Transient"},Ui={ConstantValue:"ConstantValue",DynamicValue:"DynamicValue",Factory:"Factory",Function:"Function",Instance:"Instance",Invalid:"Invalid"};class wf{constructor(e,t){this.id=pt.GenAutoIncrementId(),this.activated=!1,this.serviceIdentifier=e,this.scope=t,this.type=Ui.Invalid,this.constraint=i=>!0,this.implementationType=null,this.cache=null,this.factory=null,this.provider=null,this.dynamicValue=null}clone(){const e=new wf(this.serviceIdentifier,this.scope);return e.activated=e.scope===Tr.Singleton&&this.activated,e.implementationType=this.implementationType,e.dynamicValue=this.dynamicValue,e.scope=this.scope,e.type=this.type,e.provider=this.provider,e.constraint=this.constraint,e.cache=this.cache,e}}class Wv{getConstructorMetadata(e){return{compilerGeneratedMetadata:ao.getMetadata(U_,e),userGeneratedMetadata:ao.getMetadata(j_,e)||{}}}getPropertiesMetadata(e){throw new Error("暂未实现")}}const Nv=n=>e=>{const t=i=>{if(i==null)return!1;if(i.key===n&&i.value===e)return!0;if(i.constructorArgsMetadata==null)return!1;const r=i.constructorArgsMetadata;for(let o=0;o<r.length;o++)if(r[o].key===n&&r[o].value===e)return!0;return!1};return t.metaData=new _f(n,e),t},Vv=Nv(Yd);class _l{constructor(e){this._binding=e}inRequestScope(){throw new Error("暂未实现")}inSingletonScope(){return this._binding.scope=Tr.Singleton,this}inTransientScope(){return this._binding.scope=Tr.Transient,this}whenTargetNamed(e){return this._binding.constraint=Vv(e),this}}class Gv{constructor(e){this._binding=e}to(e){return this._binding.type=Ui.Instance,this._binding.implementationType=e,new _l(this._binding)}toSelf(){const e=this._binding.serviceIdentifier;return this.to(e)}toDynamicValue(e){return this._binding.type=Ui.DynamicValue,this._binding.cache=null,this._binding.dynamicValue=e,this._binding.implementationType=null,new _l(this._binding)}toConstantValue(e){return this._binding.type=Ui.ConstantValue,this._binding.cache=e,this._binding.dynamicValue=null,this._binding.implementationType=null,this._binding.scope=Tr.Singleton,new _l(this._binding)}toFactory(e){return this._binding.type=Ui.Factory,this._binding.factory=e,this._binding.scope=Tr.Singleton,new _l(this._binding)}toService(e){this.toDynamicValue(t=>t.container.get(e))}}let jv=class{constructor(e){const t=e||{};t.defaultScope=t.defaultScope||Tr.Transient,this.options=t,this.id=pt.GenAutoIncrementId(),this._bindingDictionary=new Map,this._metadataReader=new Wv}load(e){const t=this._getContainerModuleHelpersFactory()(e.id);e.registry(t.bindFunction,t.unbindFunction,t.isboundFunction,t.rebindFunction)}get(e){const t=this._getNotAllArgs(e,!1);return this._get(t)}getAll(e){const t=this._getAllArgs(e);return this._get(t)}getTagged(e,t,i){const r=this._getNotAllArgs(e,!1,t,i);return this._get(r)}getNamed(e,t){return this.getTagged(e,Yd,t)}isBound(e){return this._bindingDictionary.has(e)}bind(e){const t=this.options.defaultScope,i=new wf(e,t),r=this._bindingDictionary.get(e)||[];return r.push(i),this._bindingDictionary.set(e,r),new Gv(i)}unbind(e){this._bindingDictionary.delete(e)}rebind(e){return this.unbind(e),this.bind(e)}_getContainerModuleHelpersFactory(){const e=(s,l)=>{s._binding.moduleId=l},t=s=>l=>{const a=this.bind(l);return e(a,s),a},i=()=>s=>this.unbind(s),r=()=>s=>this.isBound(s),o=s=>l=>{const a=this.rebind(l);return e(a,s),a};return s=>({bindFunction:t(s),isboundFunction:r(),rebindFunction:o(s),unbindFunction:i(),unbindAsyncFunction:l=>null})}_getNotAllArgs(e,t,i,r){return{avoidConstraints:!1,isMultiInject:t,serviceIdentifier:e,key:i,value:r}}_getAllArgs(e){return{avoidConstraints:!0,isMultiInject:!0,serviceIdentifier:e}}_get(e){const t=[];return this._bindingDictionary.get(e.serviceIdentifier).filter(i=>i.constraint(e)).forEach(i=>{t.push(this._resolveFromBinding(i))}),e.isMultiInject||t.length!==1?t:t[0]}_getChildRequest(e){const t=e.implementationType,{userGeneratedMetadata:i}=this._metadataReader.getConstructorMetadata(t),r=Object.keys(i),o=[];for(let s=0;s<r.length;s++){const l=i[s],a={};l.forEach(g=>{a[g.key]=g.value});const d={inject:a[V_],multiInject:a[G_]},u=d.inject||d.multiInject,h={serviceIdentifier:u,constructorArgsMetadata:l},c={injectIdentifier:u,metadata:l,bindings:this._bindingDictionary.get(u).filter(g=>g.constraint(h))};o.push(c)}return o}_resolveFromBinding(e){const t=this._getResolvedFromBinding(e);return this._saveToScope(e,t),t}_getResolvedFromBinding(e){let t;switch(e.type){case Ui.ConstantValue:case Ui.Function:t=e.cache;break;case Ui.Instance:t=this._resolveInstance(e,e.implementationType);break;default:t=e.dynamicValue({container:this})}return t}_resolveInstance(e,t){if(e.activated)return e.cache;const i=this._getChildRequest(e);return this._createInstance(t,i)}_createInstance(e,t){return t.length?new e(...this._resolveRequests(t)):new e}_resolveRequests(e){return e.map(t=>t.bindings.length>1?t.bindings.map(i=>this._resolveFromBinding(i)):this._resolveFromBinding(t.bindings[0]))}_saveToScope(e,t){e.scope===Tr.Singleton&&(e.cache=t,e.activated=!0)}};const gt=Symbol("ContributionProvider");class X_{constructor(e,t){this.serviceIdentifier=e,this.container=t}getContributions(){return this.caches||(this.caches=[],this.container&&this.container.isBound(this.serviceIdentifier)&&this.caches.push(...this.container.getAll(this.serviceIdentifier))),this.caches}}function Dt(n,e){n(gt).toDynamicValue(({container:t})=>new X_(e,t)).inSingletonScope().whenTargetNamed(e)}function Uv(n,e){n(gt).toDynamicValue(({container:t})=>new X_(e,t)).whenTargetNamed(e)}class $v{constructor(e,t){this._args=e,this.name=t,this.taps=[]}tap(e,t){this._tap("sync",e,t)}unTap(e,t){const i=typeof e=="string"?e.trim():e.name;i&&(this.taps=this.taps.filter(r=>!(r.name===i&&(!t||r.fn===t))))}_parseOptions(e,t,i){let r;if(typeof t=="string")r={name:t.trim()};else if(typeof t!="object"||t===null)throw new Error("Invalid tap options");if(typeof r.name!="string"||r.name==="")throw new Error("Missing name for tap");return r=Object.assign({type:e,fn:i},r),r}_tap(e,t,i){this._insert(this._parseOptions(e,t,i))}_insert(e){let t;typeof e.before=="string"?t=new Set([e.before]):Array.isArray(e.before)&&(t=new Set(e.before));let i=0;typeof e.stage=="number"&&(i=e.stage);let r=this.taps.length;for(;r>0;){r--;const o=this.taps[r];this.taps[r+1]=o;const s=o.stage||0;if(t){if(t.has(o.name)){t.delete(o.name);continue}if(t.size>0)continue}if(!(s>i)){r++;break}}this.taps[r]=e}}class Xt extends $v{call(...e){this.taps.map(t=>t.fn).forEach(t=>t(...e))}}const Xd=Symbol.for("EnvContribution"),yf=Symbol.for("VGlobal");var Kv=function(n,e,t,i){var r,o=arguments.length,s=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,e,t,i);else for(var l=n.length-1;l>=0;l--)(r=n[l])&&(s=(o<3?r(s):o>3?r(e,t,s):r(e,t))||s);return o>3&&s&&Object.defineProperty(e,t,s),s},Yv=function(n,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,e)},Rg=function(n,e){return function(t,i){e(t,i,n)}},Xv=function(n,e,t,i){return new(t||(t=Promise))(function(r,o){function s(d){try{a(i.next(d))}catch(u){o(u)}}function l(d){try{a(i.throw(d))}catch(u){o(u)}}function a(d){var u;d.done?r(d.value):(u=d.value,u instanceof t?u:new t(function(h){h(u)})).then(s,l)}a((i=i.apply(n,e||[])).next())})};let Rh=class{get env(){return this._env}get isImageAnonymous(){return this._isImageAnonymous}set isImageAnonymous(n){this._isImageAnonymous=n}get devicePixelRatio(){return this._env||this.setEnv("browser"),this.envContribution.getDevicePixelRatio()}get supportEvent(){return this._env||this.setEnv("browser"),this.envContribution.supportEvent}set supportEvent(n){this._env||this.setEnv("browser"),this.envContribution.supportEvent=n}get supportsTouchEvents(){return this._env||this.setEnv("browser"),this.envContribution.supportsTouchEvents}set supportsTouchEvents(n){this._env||this.setEnv("browser"),this.envContribution.supportsTouchEvents=n}get supportsPointerEvents(){return this._env||this.setEnv("browser"),this.envContribution.supportsPointerEvents}set supportsPointerEvents(n){this._env||this.setEnv("browser"),this.envContribution.supportsPointerEvents=n}get supportsMouseEvents(){return this._env||this.setEnv("browser"),this.envContribution.supportsMouseEvents}set supportsMouseEvents(n){this._env||this.setEnv("browser"),this.envContribution.supportsMouseEvents=n}get applyStyles(){return this._env||this.setEnv("browser"),this.envContribution.applyStyles}set applyStyles(n){this._env||this.setEnv("browser"),this.envContribution.applyStyles=n}constructor(n){this.contributions=n,this._isImageAnonymous=!0,this.id=pt.GenAutoIncrementId(),this.hooks={onSetEnv:new Xt(["lastEnv","env","global"])},this.measureTextMethod="native",this.optimizeVisible=!1}bindContribution(n){const e=[];if(this.contributions.getContributions().forEach(t=>{const i=t.configure(this,n);i&&i.then&&e.push(i)}),e.length)return Promise.all(e)}getDynamicCanvasCount(){return this._env||this.setEnv("browser"),this.envContribution.getDynamicCanvasCount()}getStaticCanvasCount(){return this._env||this.setEnv("browser"),this.envContribution.getStaticCanvasCount()}setEnv(n,e){if(e&&e.force===!0||this._env!==n)return this.deactiveCurrentEnv(),this.activeEnv(n,e)}deactiveCurrentEnv(){this.envContribution&&this.envContribution.release()}activeEnv(n,e){const t=this._env;this._env=n;const i=this.bindContribution(e);if(i&&i.then)return i.then(()=>{this.envParams=e,this.hooks.onSetEnv.call(t,n,this)});this.envParams=e,this.hooks.onSetEnv.call(t,n,this)}setActiveEnvContribution(n){this.envContribution=n}createCanvas(n){return this._env||this.setEnv("browser"),this.envContribution.createCanvas(n)}createOffscreenCanvas(n){return this._env||this.setEnv("browser"),this.envContribution.createOffscreenCanvas(n)}releaseCanvas(n){return this._env||this.setEnv("browser"),this.envContribution.releaseCanvas(n)}addEventListener(n,e,t){return this._env||this.setEnv("browser"),this.envContribution.addEventListener(n,e,t)}removeEventListener(n,e,t){return this._env||this.setEnv("browser"),this.envContribution.removeEventListener(n,e,t)}dispatchEvent(n){return this._env||this.setEnv("browser"),this.envContribution.dispatchEvent(n)}getRequestAnimationFrame(){return this._env||this.setEnv("browser"),this.envContribution.getRequestAnimationFrame()}getCancelAnimationFrame(){return this._env||this.setEnv("browser"),this.envContribution.getCancelAnimationFrame()}getElementById(n){return this._env||this.setEnv("browser"),this.envContribution.getElementById?this.envContribution.getElementById(n):null}getRootElement(){return this._env||this.setEnv("browser"),this.envContribution.getRootElement?this.envContribution.getRootElement():null}getDocument(){return this._env||this.setEnv("browser"),this.envContribution.getDocument?this.envContribution.getDocument():null}mapToCanvasPoint(n,e){return this._env||this.setEnv("browser"),this.envContribution.mapToCanvasPoint?this.envContribution.mapToCanvasPoint(n,e):null}loadImage(n){return this._env||this.setEnv("browser"),this.envContribution.loadImage(n)}loadSvg(n){return this._env||this.setEnv("browser"),this.envContribution.loadSvg(n)}loadJson(n){return this._env||this.setEnv("browser"),this.envContribution.loadJson(n)}loadArrayBuffer(n){return this._env||this.setEnv("browser"),this.envContribution.loadArrayBuffer(n)}loadBlob(n){return this._env||this.setEnv("browser"),this.envContribution.loadBlob(n)}loadFont(n,e,t){return Xv(this,void 0,void 0,function*(){return this._env||this.setEnv("browser"),this.envContribution.loadFont(n,e,t)})}isChrome(){return this._isChrome!=null||(this._env||this.setEnv("browser"),this._isChrome=this._env==="browser"&&navigator.userAgent.indexOf("Chrome")>-1),this._isChrome}isSafari(){return this._isSafari!=null||(this._env||this.setEnv("browser"),this._isSafari=this._env==="browser"&&/Safari/.test(navigator.userAgent)&&!/Chrome/.test(navigator.userAgent)),this._isSafari}getNativeAABBBounds(n){return this._env||this.setEnv("browser"),this.envContribution.getNativeAABBBounds(n)}removeDom(n){return this._env||this.setEnv("browser"),this.envContribution.removeDom(n)}createDom(n){return this._env||this.setEnv("browser"),this.envContribution.createDom(n)}updateDom(n,e){return this._env||this.setEnv("browser"),this.envContribution.updateDom(n,e)}getElementTop(n,e=!1){return this._env||this.setEnv("browser"),this.envContribution.getElementTop(n,e)}getElementLeft(n,e=!1){return this._env||this.setEnv("browser"),this.envContribution.getElementLeft(n,e)}getElementTopLeft(n,e=!1){return this._env||this.setEnv("browser"),this.envContribution.getElementTopLeft(n,e)}};Rh=Kv([se(),Rg(0,Be(gt)),Rg(0,At(Xd)),Yv("design:paramtypes",[Object])],Rh);var Sr;(function(n){n[n.estimate=0]="estimate",n[n.actualBounding=1]="actualBounding",n[n.fontBounding=2]="fontBounding"})(Sr||(Sr={}));const qv=dn-1e-8;class vf{constructor(e){this.init(e)}init(e){this.bounds=e}arc(e,t,i,r,o,s){if(Math.abs(o-r)>qv)return this.bounds.add(e-i,t-i),void this.bounds.add(e+i,t+i);let l,a,d,u,h=1/0,c=-1/0,g=1/0,f=-1/0;function p(m){d=i*Math.cos(m),u=i*Math.sin(m),d<h&&(h=d),d>c&&(c=d),u<g&&(g=u),u>f&&(f=u)}if(p(r),p(o),o!==r)if((r%=dn)<0&&(r+=dn),(o%=dn)<0&&(o+=dn),o<r&&(s=!s,l=r,r=o,o=l),s)for(o-=dn,l=r-r%Vi,a=0;a<4&&l>o;++a,l-=Vi)p(l);else for(l=r-r%Vi+Vi,a=0;a<4&&l<o;++a,l+=Vi)p(l);this.bounds.add(e+h,t+g),this.bounds.add(e+c,t+f)}arcTo(e,t,i,r,o){this.bounds.add(e,t)}bezierCurveTo(e,t,i,r,o,s){this.bounds.add(e,t),this.bounds.add(i,r),this.bounds.add(o,s)}closePath(){}ellipse(){throw new Error("不支持ellipse")}lineTo(e,t){this.bounds.add(e,t)}moveTo(e,t){this.bounds.add(e,t)}quadraticCurveTo(e,t,i,r){this.bounds.add(e,t),this.bounds.add(i,r)}rect(e,t,i,r){this.bounds.add(e,t),this.bounds.add(e+i,t+r)}clear(){this.bounds.clear()}release(...e){}}class Zv{constructor(){this.curves=[],this.bounds=new Ue}getCurveLengths(){return this.curves.map(e=>e.getLength())}getPointAt(e){return{x:0,y:0}}getLength(){return 0}getBounds(){return this.bounds}}const Jv=/([-+]?((\d+\.\d+)|((\d+)|(\.\d+)))(?:[eE][-+]?\d+)?)/gi,Qv={m:2,l:2,h:1,v:1,c:6,s:4,q:4,t:2,a:7,M:2,L:2,H:1,V:1,C:6,S:4,Q:4,T:2,A:7},Le={A:0,AT:1,C:2,Z:3,E:4,L:5,M:6,Q:7,R:8};let Eu,Ag,wl,Bg,Lu,yl;function e1(n){if(!n)return[];const e=n.match(/[mzlhvcsqta][^mzlhvcsqta]*/gi);if(e===null)return[];let t,i;const r=[];for(let o=0,s=e.length;o<s;o++)if(Eu=e[o],Ag=Eu.slice(1),wl=Eu[0],t=[wl],i=Ag.match(Jv),i!==null){for(let l=0,a=i.length;l<a;l++)Bg=i[l],Lu=parseFloat(Bg),Number.isNaN(Lu)||t.push(Lu);if(yl=Qv[wl],t.length-1>yl){let l,a=wl;for(let d=1,u=t.length;d<u;d+=yl){l=[a];for(let h=d,c=d+yl;h<c;h++)l.push(t[h]);r.push(l),a==="m"?a="l":a==="M"&&(a="L")}}else r.push(t)}else r.push(t);return r}var Ve;(function(n){n[n.NONE=0]="NONE",n[n.UPDATE_BOUNDS=1]="UPDATE_BOUNDS",n[n.UPDATE_SHAPE=2]="UPDATE_SHAPE",n[n.CLEAR_SHAPE=253]="CLEAR_SHAPE",n[n.UPDATE_SHAPE_AND_BOUNDS=3]="UPDATE_SHAPE_AND_BOUNDS",n[n.INIT=179]="INIT",n[n.CLEAR_BOUNDS=254]="CLEAR_BOUNDS",n[n.UPDATE_GLOBAL_MATRIX=32]="UPDATE_GLOBAL_MATRIX",n[n.CLEAR_GLOBAL_MATRIX=223]="CLEAR_GLOBAL_MATRIX",n[n.UPDATE_LOCAL_MATRIX=16]="UPDATE_LOCAL_MATRIX",n[n.CLEAR_LOCAL_MATRIX=239]="CLEAR_LOCAL_MATRIX",n[n.UPDATE_GLOBAL_LOCAL_MATRIX=48]="UPDATE_GLOBAL_LOCAL_MATRIX",n[n.UPDATE_LAYOUT=128]="UPDATE_LAYOUT",n[n.CLEAR_LAYOUT=127]="CLEAR_LAYOUT"})(Ve||(Ve={}));var Ts;(function(n){n[n.GLOBAL=1]="GLOBAL",n[n.LOCAL=16]="LOCAL",n[n.GLOBAL_ACCURATE=3]="GLOBAL_ACCURATE",n[n.LOCAL_ACCURATE=48]="LOCAL_ACCURATE"})(Ts||(Ts={}));var Yt;(function(n){n[n.INIT=0]="INIT",n[n.DEFAULT=1]="DEFAULT",n[n.STATE=2]="STATE",n[n.ANIMATE_BIND=10]="ANIMATE_BIND",n[n.ANIMATE_PLAY=11]="ANIMATE_PLAY",n[n.ANIMATE_START=12]="ANIMATE_START",n[n.ANIMATE_UPDATE=13]="ANIMATE_UPDATE",n[n.ANIMATE_END=14]="ANIMATE_END",n[n.TRANSLATE=20]="TRANSLATE",n[n.TRANSLATE_TO=21]="TRANSLATE_TO",n[n.SCALE=22]="SCALE",n[n.SCALE_TO=23]="SCALE_TO",n[n.ROTATE=24]="ROTATE",n[n.ROTATE_TO=25]="ROTATE_TO"})(Yt||(Yt={}));var Ft;(function(n){n[n.INITIAL=0]="INITIAL",n[n.RUNNING=1]="RUNNING",n[n.PAUSED=2]="PAUSED",n[n.END=3]="END"})(Ft||(Ft={}));var la;(function(n){n[n.NORMAL=0]="NORMAL",n[n.SET_ATTR_IMMEDIATELY=1]="SET_ATTR_IMMEDIATELY"})(la||(la={}));var eo;(function(n){n.wait="wait",n.from="from",n.to="to",n.customAnimate="customAnimate"})(eo||(eo={}));var $e;(function(n){n[n.ROW=1]="ROW",n[n.COLUMN=2]="COLUMN"})($e||($e={}));var aa;(function(n){n[n.CubicBezierCurve=0]="CubicBezierCurve",n[n.QuadraticBezierCurve=1]="QuadraticBezierCurve",n[n.ArcCurve=2]="ArcCurve",n[n.LineCurve=3]="LineCurve",n[n.EllipseCurve=4]="EllipseCurve",n[n.MoveCurve=5]="MoveCurve"})(aa||(aa={}));var Ee;(function(n){n[n.beforeFillStroke=0]="beforeFillStroke",n[n.afterFillStroke=1]="afterFillStroke"})(Ee||(Ee={}));function t1(n,e,t,i,r,o,s,l,a){const d=Mr(s),u=Math.sin(d),h=Math.cos(d),c=h*(l-n)*.5+u*(a-e)*.5,g=h*(a-e)*.5-u*(l-n)*.5;let f=c*c/((t=Math.abs(t))*t)+g*g/((i=Math.abs(i))*i);f>1&&(f=Math.sqrt(f),t*=f,i*=f);const p=h/t,m=u/t,b=-u/i,C=h/i,_=p*l+m*a,w=b*l+C*a,y=p*n+m*e,v=b*n+C*e;let x=1/((y-_)*(y-_)+(v-w)*(v-w))-.25;x<0&&(x=0);let S=Math.sqrt(x);o===r&&(S=-S);const R=.5*(_+y)-S*(v-w),B=.5*(w+v)+S*(y-_),A=Math.atan2(w-B,_-R);let M=Math.atan2(v-B,y-R)-A;M<0&&o===1?M+=dn:M>0&&o===0&&(M-=dn);const H=Math.ceil(Math.abs(M/(Vi+.001))),E=[];for(let T=0;T<H;++T){const P=A+T*M/H,k=A+(T+1)*M/H;E[T]=[R,B,P,k,t,i,u,h]}return E}function n1(n){const e=n[0],t=n[1],i=n[2],r=n[3],o=n[4],s=n[5],l=n[6],a=n[7],d=a*o,u=-l*s,h=l*o,c=a*s,g=Math.cos(i),f=Math.sin(i),p=Math.cos(r),m=Math.sin(r),b=.5*(r-i),C=Math.sin(.5*b),_=8/3*C*C/Math.sin(b),w=e+g-_*f,y=t+f+_*g,v=e+p,x=t+m,S=v+_*m,R=x-_*p;return[d*w+u*y,h*w+c*y,d*S+u*R,h*S+c*R,d*v+u*x,h*v+c*x]}function Mg(n,e,t,i){const r=t1(i[5],i[6],i[0],i[1],i[3],i[4],i[2],e,t);for(let o=0;o<r.length;++o){const s=n1(r[o]);n.bezierCurveTo(s[0],s[1],s[2],s[3],s[4],s[5])}}const i1=(n,e,t,i,r,o,s)=>{const l=Math.abs(t-e),a=l>.5*Math.PI?Math.ceil(2*l/Math.PI):1,d=(t-e)/a;for(let u=0;u<a;u++){const h=e+d*u,c=e+d*(u+1),g=4*Math.tan(Math.abs(d)/4)/3,f=c<h?-1:1,p=Math.cos(h),m=Math.sin(h),b=Math.cos(c),C=Math.sin(c),_=p*o+i,w=m*s+r,y=b*o+i,v=C*s+r,x=o*g*f,S=s*g*f;n.push(_-x*m,w+S*p,y+x*C,v-S*b,y,v)}},r1=[(n,e,t,i,r,o,s)=>e.arc(n[1]*r+t,n[2]*o+i,n[3]*(r+o)/2,n[4],n[5],n[6],s),(n,e,t,i,r,o,s)=>e.arcTo(n[1]*r+t,n[2]*o+i,n[3]*r+t,n[4]*o+i,n[5]*(r+o)/2,s),(n,e,t,i,r,o,s)=>e.bezierCurveTo(n[1]*r+t,n[2]*o+i,n[3]*r+t,n[4]*o+i,n[5]*r+t,n[6]*o+i,s),(n,e,t,i)=>e.closePath(),(n,e,t,i,r,o)=>e.ellipse(n[1]*r+t,n[2]*o+i,n[3]*r,n[4]*o,n[5],n[6],n[7],n[8]),(n,e,t,i,r,o,s)=>e.lineTo(n[1]*r+t,n[2]*o+i,s),(n,e,t,i,r,o,s)=>e.moveTo(n[1]*r+t,n[2]*o+i,s),(n,e,t,i,r,o,s)=>e.quadraticCurveTo(n[1]*r+t,n[2]*o+i,n[3]*r+t,n[4]*o+i,s),(n,e,t,i,r,o,s)=>e.rect(n[1]*r+t,n[2]*o+i,n[3]*r,n[4]*o,s)];function Qi(n,e,t=0,i=0,r=1,o=1,s){for(let l=0;l<n.length;l++){const a=n[l];r1[a[0]](a,e,t,i,r,o,s)}}class q_{getLength(e){return e!=null?this.calcProjLength(e):(Number.isFinite(this.length)||(this.length=this.calcLength()),this.length)}}function o1(n,e){let t=0;const i=n.length;for(let r=0;r<i;r++){const o=n[r],s=e[r],l=n[(r+1)%i],a=e[(r+1)%i];t+=Ci.distanceNN(o,s,l,a)}return t/2}function s1(n,e,t,i,r){return o1([n.x,e.x,t.x,i.x],[n.y,e.y,t.y,i.y])}function Tg(n,e,t,i,r){const o=1-r;return o*o*o*n+3*e*r*o*o+3*t*r*r*o+i*r*r*r}function Z_(n,e,t,i,r){const o=Tg(n.x,e.x,t.x,i.x,r),s=Tg(n.y,e.y,t.y,i.y,r);return new St(o,s)}function Ah(n,e){const{p0:t,p1:i,p2:r,p3:o}=n,s=Z_(t,i,r,o,e),l=Ci.pointAtPP(t,i,e),a=Ci.pointAtPP(i,r,e),d=Ci.pointAtPP(r,o,e),u=Ci.pointAtPP(l,a,e),h=Ci.pointAtPP(a,d,e);return[new Bh(t,l,u,s),new Bh(s,h,d,o)]}class Bh extends q_{constructor(e,t,i,r){super(),this.type=aa.CubicBezierCurve,this.p0=e,this.p1=t,this.p2=i,this.p3=r}_validPoint(){return Number.isFinite(this.p0.x+this.p0.y+this.p1.x+this.p1.y+this.p2.x+this.p2.y+this.p3.x+this.p3.y)}getPointAt(e){if(this.defined!==!1)return Z_(this.p0,this.p1,this.p2,this.p3,e);throw new Error("defined为false的点不能getPointAt")}calcLength(){return this._validPoint()?s1(this.p0,this.p1,this.p2,this.p3):60}calcProjLength(e){return e===$e.ROW?De(this.p0.x-this.p3.x):e===$e.COLUMN?De(this.p0.y-this.p3.y):0}getAngleAt(e){const t=Ji(e-.01,0),i=Ot(e+.01,1),r=this.getPointAt(t),o=this.getPointAt(i);return Fe(o.y-r.y,o.x-r.x)}}function Pg(n,e){const{p0:t,p1:i}=n,r=Ci.pointAtPP(t,i,e);return[new Mh(t,r),new Mh(r,i)]}class Mh extends q_{constructor(e,t){super(),this.type=aa.LineCurve,this.p0=e,this.p1=t}getPointAt(e){if(this.defined!==!1)return Ci.pointAtPP(this.p0,this.p1,e);throw new Error("defined为false的点不能getPointAt")}getAngleAt(e){return this.angle==null&&(this.angle=Fe(this.p1.y-this.p0.y,this.p1.x-this.p0.x)),this.angle}_validPoint(){return Number.isFinite(this.p0.x+this.p0.y+this.p1.x+this.p1.y)}calcLength(){return this._validPoint()?Ci.distancePP(this.p0,this.p1):60}calcProjLength(e){return e===$e.ROW?De(this.p0.x-this.p1.x):e===$e.COLUMN?De(this.p0.y-this.p1.y):0}}class Sf{get endX(){return this._lastX}get endY(){return this._lastY}constructor(e,t){this.init(e,t)}init(e,t){this._lastX=this._lastY=this._startX=this._startY=0,this.curveType=e,this.direction=t,this.curves=[]}bezierCurveTo(e,t,i,r,o,s,l,a){const d=new Bh(new St(this._lastX,this._lastY),new St(e,t),new St(i,r),new St(o,s));d.originP1=this._lastOriginP,d.originP2=a,d.defined=l,this.curves.push(d),this._lastX=o,this._lastY=s,this._lastOriginP=a}closePath(){if(this.curves.length<2)return;const e=this.curves[this.curves.length-1];this.lineTo(this._startX,this._startY,e.defined,this._startOriginP)}ellipse(){throw new Error("SegContext不支持调用ellipse")}lineTo(e,t,i,r){const o=this.addLinearCurve(e,t,i,this._lastOriginP,r);this.curves.push(o),this._lastX=e,this._lastY=t,this._lastOriginP=r}moveTo(e,t,i){return this._lastX=this._startX=e,this._lastY=this._startY=t,this._lastOriginP=i,this._startOriginP=i,this}quadraticCurveTo(e,t,i,r){throw new Error("SegContext不支持调用quadraticCurveTo")}clear(){this.curves=[],this.length=NaN}tryUpdateLength(e){return this.getLength(e)}addLinearCurve(e,t,i,r,o){const s=new Mh(new St(this._lastX,this._lastY),new St(e,t));return s.originP1=r,s.originP2=o,s.defined=i,s}getPointAt(e){throw new Error("暂未实现")}getCurveLengths(){return[]}getLength(e){var t,i;if(e===$e.COLUMN){if(!this.curves.length)return 0;const r=this.curves[0],o=this.curves[this.curves.length-1],s=(t=o.p3)!==null&&t!==void 0?t:o.p1;return De(r.p0.y-s.y)}if(e===$e.ROW){if(!this.curves.length)return 0;const r=this.curves[0],o=this.curves[this.curves.length-1],s=(i=o.p3)!==null&&i!==void 0?i:o.p1;return De(r.p0.x-s.x)}return Number.isFinite(this.length)||(this.length=this.curves.reduce((r,o)=>r+o.getLength(),0)),this.length}}class l1 extends Sf{bezierCurveTo(e,t,i,r,o,s,l,a){return super.bezierCurveTo(t,e,r,i,s,o,l,a)}lineTo(e,t,i,r){return super.lineTo(t,e,i,r)}moveTo(e,t,i){return super.moveTo(t,e,i)}clear(){return super.clear()}}function Dr(n,e,t=1){let i=!1;for(let r=0,o=e.length;r<=o;r++)r>=o===i&&((i=!i)?n.lineStart():n.lineEnd()),i&&n.point(e[r])}function Fo(n,e,t){const i=e??(De(t[t.length-1].x-t[0].x)>De(t[t.length-1].y-t[0].y)?$e.ROW:$e.COLUMN);return n==="monotoneY"?new l1(n,i):new Sf(n,i)}class J_{constructor(e,t){this.context=e,t&&(this.startPoint=t)}areaStart(){this._line=0}areaEnd(){this._line=NaN}lineStart(){this._point=0,this.startPoint&&this.point(this.startPoint)}lineEnd(){(this._line||this._line!==0&&this._point===1)&&this.context.closePath(),this._line=1-this._line}point(e){const t=e.x,i=e.y;switch(this._point){case 0:this._point=1,this._line?this.context.lineTo(t,i,this._lastDefined!==!1&&e.defined!==!1,e):this.context.moveTo(t,i,e);break;case 1:this._point=2;default:this.context.lineTo(t,i,this._lastDefined!==!1&&e.defined!==!1,e)}this._lastDefined=e.defined}tryUpdateLength(){return this.context.tryUpdateLength()}}function el(n,e={}){const{direction:t,startPoint:i}=e;if(n.length<2-+!!i)return null;const r=Fo("linear",t,n);return a1(new J_(r,i),n),r}function a1(n,e){return Dr(n,e,1)}function Hg(n,e,t,i,r){n.context.bezierCurveTo((2*n._x0+n._x1)/3,(2*n._y0+n._y1)/3,(n._x0+2*n._x1)/3,(n._y0+2*n._y1)/3,(n._x0+4*n._x1+e)/6,(n._y0+4*n._y1+t)/6,i,n.lastPoint1)}class d1{constructor(e,t){this.context=e,this.startPoint=t}areaStart(){this._line=0}areaEnd(){this._line=NaN}lineStart(){this._x0=this._x1=this._y0=this._y1=NaN,this._point=0,this.startPoint&&this.point(this.startPoint)}lineEnd(){this._point===2&&Hg(this,6*this._x1-(this._x0+4*this._x1),6*this._y1-(this._y0+4*this._y1),this._lastDefined1!==!1&&this._lastDefined2!==!1,this.lastPoint1),(this._line||this._line!==0&&this._point===1)&&this.context.closePath(),this._line=1-this._line}point(e){const t=e.x,i=e.y;switch(this._point){case 0:this._point=1,this._line?this.context.lineTo(t,i,this._lastDefined1!==!1&&this._lastDefined2!==!1,e):this.context.moveTo(t,i,e);break;case 1:this._point=2;break;default:Hg(this,t,i,this._lastDefined1!==!1&&this._lastDefined2!==!1)}this._x0=this._x1,this._x1=t,this._y0=this._y1,this._y1=i,this._lastDefined1=this._lastDefined2,this._lastDefined2=e.defined,this.lastPoint0=this.lastPoint1,this.lastPoint1=e}tryUpdateLength(){return this.context.tryUpdateLength()}}function u1(n,e){return Dr(n,e,2)}function h1(n,e={}){const{direction:t,startPoint:i}=e;if(n.length<2-+!!i)return null;if(n.length<3-+!!i)return el(n,e);const r=Fo("basis",t,n);return u1(new d1(r,i),n),r}function kg(n){return n<0?-1:1}function Eg(n,e,t){const i=n._x1-n._x0,r=e-n._x1,o=(n._y1-n._y0)/(i||Number(r<0&&-0)),s=(t-n._y1)/(r||Number(i<0&&-0)),l=(o*r+s*i)/(i+r);return(kg(o)+kg(s))*Math.min(Math.abs(o),Math.abs(s),.5*Math.abs(l))||0}function Lg(n,e){const t=n._x1-n._x0;return t?(3*(n._y1-n._y0)/t-e)/2:e}function Fu(n,e,t,i,r){const o=n._x0,s=n._y0,l=n._x1,a=n._y1,d=(l-o)/3;n.context.bezierCurveTo(o+d,s+d*e,l-d,a-d*t,l,a,i,n.lastPoint1)}class Q_{constructor(e,t){this.context=e,this.startPoint=t}areaStart(){this._line=0}areaEnd(){this._line=NaN}lineStart(){this._x0=this._x1=this._y0=this._y1=this._t0=NaN,this._point=0,this.startPoint&&this.point(this.startPoint)}lineEnd(){switch(this._point){case 2:this.context.lineTo(this._x1,this._y1,this._lastDefined1!==!1&&this._lastDefined2!==!1,this.lastPoint1);break;case 3:Fu(this,this._t0,Lg(this,this._t0),this._lastDefined1!==!1&&this._lastDefined2!==!1,this.lastPoint1)}(this._line||this._line!==0&&this._point===1)&&this.context.closePath(),this._line=1-this._line}point(e){let t=NaN;const i=e.x,r=e.y;switch(this._point){case 0:this._point=1,this._line?this.context.lineTo(i,r,this._lastDefined1!==!1&&this._lastDefined2!==!1,e):this.context.moveTo(i,r,e);break;case 1:this._point=2;break;case 2:this._point=3,Fu(this,Lg(this,t=Eg(this,i,r)),t,this._lastDefined1!==!1&&this._lastDefined2!==!1);break;default:Fu(this,this._t0,t=Eg(this,i,r),this._lastDefined1!==!1&&this._lastDefined2!==!1)}this._x0=this._x1,this._x1=i,this._y0=this._y1,this._y1=r,this._t0=t,this._lastDefined1=this._lastDefined2,this._lastDefined2=e.defined!==!1,this.lastPoint0=this.lastPoint1,this.lastPoint1=e}tryUpdateLength(){return this.context.tryUpdateLength()}}class c1 extends Q_{constructor(e,t){super(e,t)}point(e){return super.point({y:e.x,x:e.y,defined:e.defined})}}function f1(n,e){return Dr(n,e,2)}function g1(n,e={}){const{direction:t,startPoint:i}=e;if(n.length<2-+!!i)return null;if(n.length<3-+!!i)return el(n,e);const r=Fo("monotoneX",t,n);return f1(new Q_(r,i),n),r}function p1(n,e){return Dr(n,e,2)}function m1(n,e={}){const{direction:t,startPoint:i}=e;if(n.length<2-+!!i)return null;if(n.length<3-+!!i)return el(n,e);const r=Fo("monotoneY",t,n);return p1(new c1(r,i),n),r}let b1=class{constructor(e,t=.5,i){this.context=e,this._t=t,this.startPoint=i}areaStart(){this._line=0}areaEnd(){this._line=NaN}lineStart(){this._x=this._y=NaN,this._point=0,this.startPoint&&this.point(this.startPoint)}lineEnd(){0<this._t&&this._t<1&&this._point===2&&this.context.lineTo(this._x,this._y,this._lastDefined!==!1,this.lastPoint),(this._line||this._line!==0&&this._point===1)&&this.context.closePath(),this._line>=0&&(this._t=1-this._t,this._line=1-this._line)}point(e){const t=e.x,i=e.y;switch(this._point){case 0:this._point=1,this._line?this.context.lineTo(t,i,this._lastDefined!==!1&&e.defined!==!1,e):this.context.moveTo(t,i,e);break;case 1:this._point=2;default:if(this._t<=0)this.context.lineTo(this._x,i,this._lastDefined!==!1&&e.defined!==!1,this.lastPoint),this.context.lineTo(t,i,this._lastDefined!==!1&&e.defined!==!1,e);else{const r=this._x*(1-this._t)+t*this._t;this.context.lineTo(r,this._y,this._lastDefined!==!1&&e.defined!==!1,this.lastPoint),this.context.lineTo(r,i,this._lastDefined!==!1&&e.defined!==!1,e)}}this._lastDefined=e.defined,this._x=t,this._y=i,this.lastPoint=e}tryUpdateLength(){return this.context.tryUpdateLength()}};function zu(n,e,t={}){const{direction:i,startPoint:r}=t;if(n.length<2-+!!r)return null;const o=new Sf("step",i??(De(n[n.length-1].x-n[0].x)>De(n[n.length-1].y-n[0].y)?$e.ROW:$e.COLUMN));return C1(new b1(o,e,r),n),o}function C1(n,e){return Dr(n,e,1)}class _1 extends J_{lineEnd(){this.context.closePath()}}function w1(n,e={}){const{direction:t,startPoint:i}=e;if(n.length<2-+!!i)return null;const r=Fo("linear",t,n);return y1(new _1(r,i),n),r}function y1(n,e){return Dr(n,e,1)}function e0(n,e,t,i,r){let o=n._x1,s=n._y1,l=n._x2,a=n._y2;if(n._l01_a>Ye){const d=2*n._l01_2a+3*n._l01_a*n._l12_a+n._l12_2a,u=3*n._l01_a*(n._l01_a+n._l12_a);o=(o*d-n._x0*n._l12_2a+n._x2*n._l01_2a)/u,s=(s*d-n._y0*n._l12_2a+n._y2*n._l01_2a)/u}if(n._l23_a>Ye){const d=2*n._l23_2a+3*n._l23_a*n._l12_a+n._l12_2a,u=3*n._l23_a*(n._l23_a+n._l12_a);l=(l*d+n._x1*n._l23_2a-e*n._l12_2a)/u,a=(a*d+n._y1*n._l23_2a-t*n._l12_2a)/u}n.context.bezierCurveTo(o,s,l,a,n._x2,n._y2,i,n.lastPoint1)}class v1{constructor(e,t=.5,i){this.context=e,this.startPoint=i,this._alpha=t}areaStart(){this._line=0}areaEnd(){this._line=NaN}lineStart(){this._x0=this._x1=this._x2=this._y0=this._y1=this._y2=NaN,this._l01_a=this._l12_a=this._l23_a=this._l01_2a=this._l12_2a=this._l23_2a=this._point=0}lineEnd(){switch(this._point){case 2:this.context.lineTo(this._x2,this._y2,this._lastDefined1!==!1&&this._lastDefined2!==!1,this.lastPoint1);break;case 3:this.point({x:this._x2,y:this._y2})}(this._line||this._line!==0&&this._point===1)&&this.context.closePath(),this._line=1-this._line}point(e){const{x:t,y:i}=e;if(this._point){const r=this._x2-t,o=this._y2-i;this._l23_a=Math.sqrt(this._l23_2a=Math.pow(r*r+o*o,this._alpha))}switch(this._point){case 0:this._point=1,this._line?this.context.lineTo(t,i,this._lastDefined1!==!1&&this._lastDefined2!==!1):this.context.moveTo(t,i);break;case 1:this._point=2;break;case 2:this._point=3;default:e0(this,t,i,this._lastDefined1!==!1&&this._lastDefined2!==!1)}this._l01_a=this._l12_a,this._l12_a=this._l23_a,this._l01_2a=this._l12_2a,this._l12_2a=this._l23_2a,this._x0=this._x1,this._x1=this._x2,this._x2=t,this._y0=this._y1,this._y1=this._y2,this._y2=i,this._lastDefined1=this._lastDefined2,this._lastDefined2=e.defined,this.lastPoint0=this.lastPoint1,this.lastPoint1=e}tryUpdateLength(){return this.context.tryUpdateLength()}}function t0(n,e){return function(t,i,r={}){const{direction:o,startPoint:s}=r;if(t.length<2-+!!s)return null;if(t.length<3-+!!s)return el(t,r);const l=Fo(n,o,t),a=new e(l,i,s);return Dr(a,t,2),l}}const S1=t0("catmullRom",v1);class x1{constructor(e,t=.5,i){this.context=e,this.startPoint=i,this._alpha=t}areaStart(){this._line=0}areaEnd(){this._line=NaN}lineStart(){this._x0=this._x1=this._x2=this._x3=this._x4=this._x5=this._y0=this._y1=this._y2=this._y3=this._y4=this._y5=NaN,this._l01_a=this._l12_a=this._l23_a=this._l01_2a=this._l12_2a=this._l23_2a=this._point=0}lineEnd(){switch(this._point){case 1:this.context.moveTo(this._x3,this._y3,this.lastPoint1),this.context.closePath();break;case 2:this.context.lineTo(this._x3,this._y3,this._lastDefined1!==!1&&this._lastDefined2!==!1,this.lastPoint1),this.context.closePath();break;case 3:this.point({x:this._x3,y:this._y3}),this.point({x:this._x4,y:this._y4}),this.point({x:this._x5,y:this._y5})}}point(e){const{x:t,y:i}=e;if(this._point){const r=this._x2-t,o=this._y2-i;this._l23_a=Math.sqrt(this._l23_2a=Math.pow(r*r+o*o,this._alpha))}switch(this._point){case 0:this._point=1,this._x3=t,this._y3=i;break;case 1:this._point=2,this.context.moveTo(this._x4=t,this._y4=i,e);break;case 2:this._point=3,this._x5=t,this._y5=i;break;default:e0(this,t,i,this._lastDefined1!==!1&&this._lastDefined2!==!1)}this._l01_a=this._l12_a,this._l12_a=this._l23_a,this._l01_2a=this._l12_2a,this._l12_2a=this._l23_2a,this._x0=this._x1,this._x1=this._x2,this._x2=t,this._y0=this._y1,this._y1=this._y2,this._y2=i,this._lastDefined1=this._lastDefined2,this._lastDefined2=e.defined,this.lastPoint0=this.lastPoint1,this.lastPoint1=e}tryUpdateLength(){return this.context.tryUpdateLength()}}const R1=t0("catmullRomClosed",x1);function _r(n,e,t){var i,r;switch(e){case"linear":default:return el(n,t);case"basis":return h1(n,t);case"monotoneX":return g1(n,t);case"monotoneY":return m1(n,t);case"step":return zu(n,.5,t);case"stepBefore":return zu(n,0,t);case"stepAfter":return zu(n,1,t);case"catmullRom":return S1(n,(i=t==null?void 0:t.curveTension)!==null&&i!==void 0?i:.5,t);case"catmullRomClosed":return R1(n,(r=t==null?void 0:t.curveTension)!==null&&r!==void 0?r:.5,t);case"linearClosed":return w1(n,t)}}class Bt extends Zv{constructor(e){super(),this.commandList=[],e&&(this._ctx=e),this._boundsContext=new vf(this.bounds)}setCtx(e){this._ctx=e}moveTo(e,t){return this.commandList.push([Le.M,e,t]),this._ctx&&this._ctx.moveTo(e,t),this}lineTo(e,t){return this.commandList.push([Le.L,e,t]),this._ctx&&this._ctx.lineTo(e,t),this}quadraticCurveTo(e,t,i,r){return this.commandList.push([Le.Q,e,t,i,r]),this._ctx&&this._ctx.quadraticCurveTo(e,t,i,r),this}bezierCurveTo(e,t,i,r,o,s){return this.commandList.push([Le.C,e,t,i,r,o,s]),this._ctx&&this._ctx.bezierCurveTo(e,t,i,r,o,s),this}arcTo(e,t,i,r,o){return this.commandList.push([Le.AT,e,t,i,r,o]),this._ctx&&this._ctx.arcTo(e,t,i,r,o),this}ellipse(e,t,i,r,o,s,l,a){return this.commandList.push([Le.E,e,t,i,r,o,s,l,a]),this._ctx&&this._ctx.ellipse(e,t,i,r,o,s,l,a),this}rect(e,t,i,r){return this.commandList.push([Le.R,e,t,i,r]),this._ctx&&this._ctx.rect(e,t,i,r),this}arc(e,t,i,r,o,s){return this.commandList.push([Le.A,e,t,i,r,o,s]),this._ctx&&this._ctx.arc(e,t,i,r,o,s),this}closePath(){return this.commandList.push([Le.Z]),this._ctx&&this._ctx.closePath(),this}addCurve(e){this.curves.push(e)}clear(){this.transformCbList=null,this.commandList.length=0,this.curves.length=0}beginPath(){this.clear()}toString(){if(!this.toStringCbList){const i=[];i[Le.M]=r=>`M${r[1]} ${r[2]}`,i[Le.L]=r=>`L${r[1]} ${r[2]}`,i[Le.Q]=r=>`Q${r[1]} ${r[2]} ${r[3]} ${r[4]}`,i[Le.C]=r=>`C${r[1]} ${r[2]} ${r[3]} ${r[4]} ${r[5]} ${r[6]}`,i[Le.A]=r=>{const o=[];i1(o,r[4],r[5],r[1],r[2],r[3],r[3]);let s="";for(let l=0;l<o.length;l+=6)s+=`C${o[l]} ${o[l+1]} ${o[l+2]} ${o[l+3]} ${o[l+4]} ${o[l+5]}`;return s},i[Le.R]=r=>`M${r[1]} ${r[2]} h${r[3]} v${r[4]} H${r[1]}Z`,i[Le.Z]=r=>"Z",this.toStringCbList=i}const e=this.toStringCbList;let t="";return this.commandList.forEach(i=>{t+=e[i[0]](i)}),t}fromString(e,t,i,r,o){this.clear();const s=e1(e);return this._runCommandStrList(s,t,i,r,o),this._updateBounds(),this}fromLine(e){const{points:t,curveType:i,clipRangeByDimension:r}=e.attribute;if(!t)return;const o=_r(t,i);r==="x"?this.direction=$e.ROW:r==="y"?this.direction=$e.COLUMN:r==="auto"&&(this.direction=o.direction),this.curves=o.curves}fromCustomPath2D(e,t,i,r,o){return this.clear(),this._runCommandList(e.commandList,t,i,r,o),this._updateBounds(),this}transform(e,t,i,r){const o=this.commandList;if(!this.transformCbList){const s=[];s[Le.M]=this.moveToTransform,s[Le.L]=this.lineToTransform,s[Le.Q]=this.quadraticCurveToTransform,s[Le.C]=this.bezierCurveToTransform,s[Le.AT]=this.arcToTransform,s[Le.E]=this.ellipseTransform,s[Le.R]=this.rectTransform,s[Le.A]=this.arcTransform,s[Le.Z]=this.closePathTransform,this.transformCbList=s}o.forEach(s=>{this.transformCbList[s[0]](s,e,t,i,r)}),this._updateBounds()}moveToTransform(e,t,i,r,o){e[1]=e[1]*r+t,e[2]=e[2]*o+i}lineToTransform(e,t,i,r,o){e[1]=e[1]*r+t,e[2]=e[2]*o+i}quadraticCurveToTransform(e,t,i,r,o){e[1]=e[1]*r+t,e[2]=e[2]*o+i,e[3]=e[3]*r+t,e[4]=e[4]*o+i}bezierCurveToTransform(e,t,i,r,o){e[1]=e[1]*r+t,e[2]=e[2]*o+i,e[3]=e[3]*r+t,e[4]=e[4]*o+i,e[5]=e[5]*r+t,e[6]=e[6]*o+i}arcToTransform(e,t,i,r,o){e[1]=e[1]*r+t,e[2]=e[2]*o+i,e[3]=e[3]*r+t,e[4]=e[4]*o+i,e[5]=e[5]*(r+o)/2}ellipseTransform(e,t,i,r,o){e[1]=e[1]*r+t,e[2]=e[2]*o+i,e[3]=e[3]*r,e[4]=e[4]*o}rectTransform(e,t,i,r,o){e[1]=e[1]*r+t,e[2]=e[2]*o+i,e[3]=e[3]*r,e[4]=e[4]*o}arcTransform(e,t,i,r,o){e[1]=e[1]*r+t,e[2]=e[2]*o+i,e[3]=e[3]*(r+o)/2}closePathTransform(){}_runCommandStrList(e,t=0,i=0,r=1,o=1){let s,l,a,d,u,h=null,c=0,g=0,f=0,p=0;for(let m=0,b=e.length;m<b;++m){switch(s=e[m],r===1&&o===1||(s=A1(s,r,o)),s[0]){case"l":c+=s[1],g+=s[2],this.lineTo(c+t,g+i);break;case"L":c=s[1],g=s[2],this.lineTo(c+t,g+i);break;case"h":c+=s[1],this.lineTo(c+t,g+i);break;case"H":c=s[1],this.lineTo(c+t,g+i);break;case"v":g+=s[1],this.lineTo(c+t,g+i);break;case"V":g=s[1],this.lineTo(c+t,g+i);break;case"m":c+=s[1],g+=s[2],this.moveTo(c+t,g+i);break;case"M":c=s[1],g=s[2],this.moveTo(c+t,g+i);break;case"c":l=c+s[5],a=g+s[6],f=c+s[3],p=g+s[4],this.bezierCurveTo(c+s[1]+t,g+s[2]+i,f+t,p+i,l+t,a+i),c=l,g=a;break;case"C":c=s[5],g=s[6],f=s[3],p=s[4],this.bezierCurveTo(s[1]+t,s[2]+i,f+t,p+i,c+t,g+i);break;case"s":l=c+s[3],a=g+s[4],f=2*c-f,p=2*g-p,this.bezierCurveTo(f+t,p+i,c+s[1]+t,g+s[2]+i,l+t,a+i),f=c+s[1],p=g+s[2],c=l,g=a;break;case"S":l=s[3],a=s[4],f=2*c-f,p=2*g-p,this.bezierCurveTo(f+t,p+i,s[1]+t,s[2]+i,l+t,a+i),c=l,g=a,f=s[1],p=s[2];break;case"q":l=c+s[3],a=g+s[4],f=c+s[1],p=g+s[2],this.quadraticCurveTo(f+t,p+i,l+t,a+i),c=l,g=a;break;case"Q":l=s[3],a=s[4],this.quadraticCurveTo(s[1]+t,s[2]+i,l+t,a+i),c=l,g=a,f=s[1],p=s[2];break;case"t":l=c+s[1],a=g+s[2],h[0].match(/[QqTt]/)===null?(f=c,p=g):h[0]==="t"?(f=2*c-d,p=2*g-u):h[0]==="q"&&(f=2*c-f,p=2*g-p),d=f,u=p,this.quadraticCurveTo(f+t,p+i,l+t,a+i),c=l,g=a,f=c+s[1],p=g+s[2];break;case"T":l=s[1],a=s[2],f=2*c-f,p=2*g-p,this.quadraticCurveTo(f+t,p+i,l+t,a+i),c=l,g=a;break;case"a":Mg(this,c+t,g+i,[s[1],s[2],s[3],s[4],s[5],s[6]+c+t,s[7]+g+i]),c+=s[6],g+=s[7];break;case"A":Mg(this,c+t,g+i,[s[1],s[2],s[3],s[4],s[5],s[6]+t,s[7]+i]),c=s[6],g=s[7];break;case"z":case"Z":this.closePath()}h=s}}_runCommandList(e,t=0,i=0,r=1,o=1){if(t!==0||i!==0||r!==1||o!==1)for(let s=0,l=e.length;s<l;++s){const a=e[s].slice();switch(a[0]){case Le.L:this.lineToTransform(a,t,i,r,o);break;case Le.M:this.moveToTransform(a,t,i,r,o);break;case Le.C:this.bezierCurveToTransform(a,t,i,r,o);break;case Le.Q:this.quadraticCurveToTransform(a,t,i,r,o);break;case Le.A:this.arcToTransform(a,t,i,r,o);break;case Le.E:this.ellipseTransform(a,t,i,r,o);break;case Le.R:this.rectTransform(a,t,i,r,o);break;case Le.AT:this.arcToTransform(a,t,i,r,o);break;case Le.Z:this.closePath()}}else this.commandList=e.map(s=>s.slice())}_updateBounds(){this.bounds.clear(),Qi(this.commandList,this._boundsContext)}release(){this.commandList=[],this._boundsContext=null,this._ctx=null}getLength(){if(this.direction===$e.COLUMN){if(!this.curves.length)return 0;const e=this.curves[0],t=this.curves[this.curves.length-1];return De(e.p0.y-t.p1.y)}if(this.direction===$e.ROW){if(!this.curves.length)return 0;const e=this.curves[0],t=this.curves[this.curves.length-1];return De(e.p0.x-t.p1.x)}return this.curves.reduce((e,t)=>e+t.getLength(),0)}getAttrAt(e){if(!this.curves)return{pos:{x:0,y:0},angle:0};let t,i=0;for(let o=0;o<this.curves.length;o++){t=this.curves[o];const s=t.getLength(this.direction);if(i+s>=e)break;i+=s}const r=(e-i)/t.getLength(this.direction);return{pos:t.getPointAt(r),angle:t.getAngleAt(r)}}}const mn=["l",0,0,0,0,0,0,0];function A1(n,e,t){const i=mn[0]=n[0];if(i==="a"||i==="A")mn[1]=e*n[1],mn[2]=t*n[2],mn[3]=n[3],mn[4]=n[4],mn[5]=n[5],mn[6]=e*n[6],mn[7]=t*n[7];else if(i==="h"||i==="H")mn[1]=e*n[1];else if(i==="v"||i==="V")mn[1]=t*n[1];else for(let r=1,o=n.length;r<o;++r)mn[r]=(r%2==1?e:t)*n[r];return mn}const B1={alignSelf:"auto"},yt={x:0,y:0,z:0,dx:0,dy:0,dz:0,scrollX:0,scrollY:0,scaleX:1,scaleY:1,scaleZ:1,angle:0,alpha:0,beta:0,scaleCenter:[0,0],anchor:[0,0],anchor3d:[0,0],postMatrix:new Ht},n0={fillOpacity:1,fill:!1,shadowBlur:0,shadowColor:"black",shadowOffsetX:0,shadowOffsetY:0},Iu={strokeOpacity:1,lineDash:[],lineDashOffset:0,lineWidth:1,lineCap:"butt",lineJoin:"miter",miterLimit:10,strokeBoundsBuffer:2,stroke:!1},i0=Object.assign({outerBorder:Object.assign(Object.assign({},Iu),{distance:0}),innerBorder:Object.assign(Object.assign({},Iu),{distance:0})},Iu),qt={text:"",maxLineWidth:1/0,maxWidth:1/0,textAlign:"left",textBaseline:"alphabetic",fontSize:16,fontFamily:`PingFang SC,Microsoft Yahei,system-ui,-apple-system,segoe ui,
    Roboto,Helvetica,Arial,sans-serif, apple color emoji,segoe ui emoji,segoe ui symbol`,fontWeight:"",ellipsis:"…",fontVariant:"",fontStyle:"",lineHeight:void 0,underline:0,lineThrough:0,scaleIn3d:!1,direction:"horizontal",wordBreak:"break-all",ignoreBuf:!1,verticalMode:0,wrap:!1,whiteSpace:"no-wrap",heightLimit:1/0,lineClamp:1/0,suffixPosition:"end",underlineDash:[],underlineOffset:0,disableAutoClipedPoptip:void 0,measureMode:Sr.fontBounding,keepCenterInLine:!1},M1={pickStrokeBuffer:0},T1=Object.assign(Object.assign(Object.assign(Object.assign({forceBoundsWidth:void 0,forceBoundsHeight:void 0,opacity:1,background:null,backgroundOpacity:1,backgroundCornerRadius:0,texture:null,textureColor:"black",textureSize:10,texturePadding:2,backgroundMode:"no-repeat",backgroundFit:!0,blur:0,cursor:null,html:null,react:null},n0),i0),B1),M1),r0={connectedType:"none",connectedStyle:{},connectedX:NaN,connectedY:NaN},P1={_debug_bounds:!1},ot=Object.assign(Object.assign(Object.assign({strokeSeg:null,renderable:!0,pickable:!0,shadowGraphic:void 0,childrenPickable:!0,fillPickable:!0,strokePickable:!0,visible:!0,zIndex:0,layout:null,boundsPadding:0,fillStrokeOrder:0,renderStyle:"default",pickMode:"accurate",customPickShape:null,boundsMode:"accurate",keepDirIn3d:!0,shadowRootIdx:1,globalZIndex:1,globalCompositeOperation:"",overflow:"hidden",shadowPickMode:"graphic",keepStrokeScale:!1},P1),T1),yt),H1=Object.assign(Object.assign({},ot),{startAngle:0,endAngle:Ge,innerRadius:0,outerRadius:1,innerPadding:0,outerPadding:0,cornerRadius:0,padRadius:0,padAngle:0,cap:!1,forceShowCap:!1}),k1=Object.assign(Object.assign(Object.assign({},ot),r0),{points:[],segments:[],curveType:"linear",clipRange:1,closePath:!1,curveTension:1}),E1=Object.assign(Object.assign({},ot),{radius:1,startAngle:0,endAngle:Ge}),L1=Object.assign(Object.assign({},ot),{width:0,height:0,cornerRadius:0,path:[],clip:!1,visibleAll:!0,display:"relative",flexDirection:"row",flexWrap:"wrap",justifyContent:"flex-start",alignItems:"flex-start",alignContent:"flex-start",baseOpacity:1}),F1=Object.assign(Object.assign({},ot),{path:"",width:0,height:0,cornerRadius:0,clip:!1}),z1=Object.assign(Object.assign(Object.assign({},ot),r0),{points:[],segments:[],curveType:"linear",clipRange:1,clipRangeByDimension:"default",closePath:!1,curveTension:1}),I1=Object.assign(Object.assign({},ot),{path:new Bt,fillStrokeOrder:1,customPath:()=>{It.getInstance().warn("空函数")}}),O1=Object.assign(Object.assign({},ot),{points:[],cornerRadius:0,closePath:!0}),D1=Object.assign(Object.assign({},ot),{width:0,height:0,x1:0,y1:0,strokeBoundsBuffer:0,cornerRadius:0});Object.assign(Object.assign({},ot),{width:0,height:0,x1:0,y1:0,cornerRadius:0,length:0});const W1=Object.assign(Object.assign({},ot),{symbolType:"circle",size:10,keepDirIn3d:!0}),o0=Object.assign(Object.assign(Object.assign({},ot),qt),{strokeBoundsBuffer:0,keepDirIn3d:!0}),mi=Object.assign(Object.assign(Object.assign({},ot),qt),{editable:!1,width:300,height:300,ellipsis:!0,wordBreak:"break-word",verticalDirection:"top",textAlign:"left",textBaseline:"top",layoutDirection:"horizontal",textConfig:[],disableAutoWrapLine:!1,maxHeight:void 0,maxWidth:void 0,singleLine:!1}),Ps=Object.assign(Object.assign({repeatX:"no-repeat",repeatY:"no-repeat",image:"",width:0,height:0},ot),{fill:!0,cornerRadius:0}),N1=Object.assign(Object.assign({},Ps),{backgroundShowMode:"never",backgroundWidth:0,backgroundHeight:0,textAlign:"left",textBaseline:"middle",direction:"horizontal",margin:0,id:"",width:20,height:20,backgroundFill:"rgba(101, 117, 168, 0.1)",backgroundFillOpacity:1,backgroundStroke:!1,backgroundStrokeOpacity:1,backgroundRadius:4,opacity:1});class V1{}const U=new V1,G1=function(){const n={linearGradient:/^(linear\-gradient)/i,radialGradient:/^(radial\-gradient)/i,conicGradient:/^(conic\-gradient)/i,sideOrCorner:/^to (left (top|bottom)|right (top|bottom)|top (left|right)|bottom (left|right)|left|right|top|bottom)/i,extentKeywords:/^(closest\-side|closest\-corner|farthest\-side|farthest\-corner|contain|cover)/,positionKeywords:/^(left|center|right|top|bottom)/i,pixelValue:/^(-?(([0-9]*\.[0-9]+)|([0-9]+\.?)))px/,percentageValue:/^(-?(([0-9]*\.[0-9]+)|([0-9]+\.?)))\%/,emValue:/^(-?(([0-9]*\.[0-9]+)|([0-9]+\.?)))em/,angleValue:/^(-?(([0-9]*\.[0-9]+)|([0-9]+\.?)))deg/,fromAngleValue:/^from\s*(-?(([0-9]*\.[0-9]+)|([0-9]+\.?)))deg/,startCall:/^\(/,endCall:/^\)/,comma:/^,/,hexColor:/(^\#[0-9a-fA-F]+)/,literalColor:/^([a-zA-Z]+)/,rgbColor:/^(rgb\(\d{1,3},\s*\d{1,3},\s*\d{1,3}\))/i,rgbaColor:/^(rgba\(\d{1,3},\s*\d{1,3},\s*\d{1,3},\s*((\d\.\d+)|\d{1,3})\))/i};let e="";function t(w){const y=new Error(e+": "+w);throw y.source=e,y}function i(){const w=g(r);return e.length>0&&t("Invalid input not EOF"),w}function r(){return o("linear",n.linearGradient,s)||o("radial",n.radialGradient,a)||o("conic",n.conicGradient,l)}function o(w,y,v){return function(x,S){const R=C(x);if(R){C(n.startCall)||t("Missing (");const B=S(R);return C(n.endCall)||t("Missing )"),B}}(y,function(x){const S=v();return S&&(C(n.comma)||t("Missing comma before color stops")),{type:w,orientation:S,colorStops:g(f)}})}function s(){return b("directional",n.sideOrCorner,1)||b("angular",n.angleValue,1)}function l(){return b("angular",n.fromAngleValue,1)}function a(){let w,y,v=d();return v&&(w=[],w.push(v),y=e,C(n.comma)&&(v=d(),v?w.push(v):e=y)),w}function d(){let w=function(){const y=b("shape",/^(circle)/i,0);return y&&(y.style=m()||u()),y}()||function(){const y=b("shape",/^(ellipse)/i,0);return y&&(y.style=p()||u()),y}();if(w)w.at=h();else{const y=u();if(y){w=y;const v=h();v&&(w.at=v)}else{const v=c();v&&(w={type:"default-radial",at:v})}}return w}function u(){return b("extent-keyword",n.extentKeywords,1)}function h(){if(b("position",/^at/,0)){const w=c();return w||t("Missing positioning value"),w}}function c(){const w={x:p(),y:p()};if(w.x||w.y)return{type:"position",value:w}}function g(w){let y=w();const v=[];if(y)for(v.push(y);C(n.comma);)y=w(),y?v.push(y):t("One extra comma");return v}function f(){const w=b("hex",n.hexColor,1)||b("rgba",n.rgbaColor,1)||b("rgb",n.rgbColor,1)||b("literal",n.literalColor,0);return w||t("Expected color definition"),w.length=p(),w}function p(){return b("%",n.percentageValue,1)||b("position-keyword",n.positionKeywords,1)||m()}function m(){return b("px",n.pixelValue,1)||b("em",n.emValue,1)}function b(w,y,v){const x=C(y);if(x)return{type:w,value:x[v]}}function C(w){const y=/^[\n\r\t\s]+/.exec(e);y&&_(y[0].length);const v=w.exec(e);return v&&_(v[0].length),v}function _(w){e=e.substr(w)}return function(w){return e=w.toString(),i()}}();class to{static IsGradient(e){return!(typeof e=="string"&&!e.includes("gradient"))}static IsGradientStr(e){return typeof e=="string"&&e.includes("gradient")}static Parse(e){if(to.IsGradientStr(e))try{const t=G1(e)[0];if(t){if(t.type==="linear")return to.ParseLinear(t);if(t.type==="radial")return to.ParseRadial(t);if(t.type==="conic")return to.ParseConic(t)}}catch{return e}return e}static ParseConic(e){const{orientation:t,colorStops:i=[]}=e,r=qe/2,o=parseFloat(t.value)/180*qe-r;return{gradient:"conical",x:.5,y:.5,startAngle:o,endAngle:o+Ge,stops:i.map(s=>({color:s.value,offset:parseFloat(s.length.value)/100}))}}static ParseRadial(e){const{colorStops:t=[]}=e;return{gradient:"radial",x0:.5,y0:.5,x1:.5,y1:.5,r0:0,r1:1,stops:t.map(i=>({color:i.value,offset:parseFloat(i.length.value)/100}))}}static ParseLinear(e){const{orientation:t,colorStops:i=[]}=e,r=qe/2;let o=t.type==="angular"?parseFloat(t.value)/180*qe:0;for(;o<0;)o+=Ge;for(;o>=Ge;)o-=Ge;let s=0,l=0,a=0,d=0;return o<r?(s=0,l=1,a=Math.sin(o),d=l-Math.cos(o)):o<qe?(s=0,l=0,a=Math.cos(o-r),d=Math.sin(o-r)):o<qe+r?(s=1,l=0,a=s-Math.sin(o-qe),d=Math.cos(o-qe)):(s=1,a=s-Math.cos(o-r-qe),d-=Math.sin(o-r-qe)),{gradient:"linear",x0:s,y0:l,x1:a,y1:d,stops:i.map(u=>({color:u.value,offset:parseFloat(u.length.value)/100}))}}}function Bi(n,e,t){let i=e;const{a:r,b:o,c:s,d:l}=n.currentMatrix,a=Math.sign(r)*Math.sqrt(r*r+o*o),d=Math.sign(l)*Math.sqrt(s*s+l*l);return a+d===0?0:(i=i/Math.abs(a+d)*2*t,i)}function da(n,e,t,i=0,r=0){if(!e||e===!0)return"black";let o,s;if(ee(e))for(let l=0;l<e.length&&(s=e[l],!s);l++);else s=e;if(s=to.Parse(s),typeof s=="string")return s;if(t.AABBBounds&&(!t.attribute||t.attribute.scaleX!==0||t.attribute.scaleY!==0)){const l=t.AABBBounds;let a=l.x2-l.x1,d=l.y2-l.y1,u=l.x1-i,h=l.y1-r;if(t.attribute){const{scaleX:c=1,scaleY:g=1}=t.attribute;a/=c,d/=g,u/=c,h/=g}s.gradient==="linear"?o=j1(n,s,u,h,a,d):s.gradient==="conical"?o=$1(n,s,u,h,a,d):s.gradient==="radial"&&(o=U1(n,s,u,h,a,d))}return o||"orange"}function j1(n,e,t,i,r,o){var s,l,a,d;const u=n.createLinearGradient(t+((s=e.x0)!==null&&s!==void 0?s:0)*r,i+((l=e.y0)!==null&&l!==void 0?l:0)*o,t+((a=e.x1)!==null&&a!==void 0?a:1)*r,i+((d=e.y1)!==null&&d!==void 0?d:0)*o);return e.stops.forEach(h=>{u.addColorStop(h.offset,h.color)}),u}function U1(n,e,t,i,r,o){var s,l,a,d,u,h;const c=n.createRadialGradient(t+((s=e.x0)!==null&&s!==void 0?s:.5)*r,i+((l=e.y0)!==null&&l!==void 0?l:.5)*o,Math.max(r,o)*((a=e.r0)!==null&&a!==void 0?a:0),t+((d=e.x1)!==null&&d!==void 0?d:.5)*r,i+((u=e.y1)!==null&&u!==void 0?u:.5)*o,Math.max(r,o)*((h=e.r1)!==null&&h!==void 0?h:.5));return e.stops.forEach(g=>{c.addColorStop(g.offset,g.color)}),c}function $1(n,e,t,i,r,o){var s,l;const a=n.createConicGradient(t+((s=e.x)!==null&&s!==void 0?s:0)*r,i+((l=e.y)!==null&&l!==void 0?l:0)*o,e.startAngle,e.endAngle);return e.stops.forEach(d=>{a.addColorStop(d.offset,d.color)}),a.GetPattern(r+t,o+i,void 0)}const xf={horizontal:{width:"width",height:"height",left:"left",top:"top",x:"x",y:"y",bottom:"bottom"},vertical:{width:"height",height:"width",left:"top",top:"left",x:"y",y:"x",bottom:"right"}},s0={fill:!0,stroke:!1},ua=/\w|\(|\)|-/,l0=/[.?!,;:/，。？！、；：]/,K1=/\S/,a0=(n,e)=>{let t=e.fontSize||16;switch(e.script){case"super":case"sub":t*=.8}n.setTextStyle({textAlign:"left",textBaseline:e.textBaseline||"alphabetic",fontStyle:e.fontStyle||"",fontWeight:e.fontWeight||"",fontSize:t,fontFamily:e.fontFamily})};function Y1(n,e,t){const i=e&&e.fill||s0.fill,{fillOpacity:r=1,opacity:o=1}=e;n.globalAlpha=r*o,n.fillStyle=t?da(n,i,{AABBBounds:t}):i,a0(n,e)}function X1(n,e){const t=e&&e.stroke||s0.stroke;if(!t)return void(n.globalAlpha=0);const{strokeOpacity:i=1,opacity:r=1}=e;n.globalAlpha=i*r,n.lineWidth=e&&typeof e.lineWidth=="number"?e.lineWidth:1,n.strokeStyle=t,a0(n,e)}function Th(n,e,t,i,r){if(!e||e<=0)return 0;const o=U.graphicUtil.textMeasure;let s=i,l=n.slice(0,s),a=Math.floor(o.measureText(l,t).width),d=n.slice(0,s+1),u=Math.floor(o.measureText(d,t).width);for(;a>e||u<=e;){if(a>e?s--:s++,s>n.length){s=n.length;break}if(s<0){s=0;break}l=n.slice(0,s),a=Math.floor(o.measureText(l,t).width),d=n.slice(0,s+1),u=Math.floor(o.measureText(d,t).width)}return r&&(s=Zl(n,s)),s}function Zl(n,e,t=!1){let i=e;for(;ua.test(n[i-1])&&ua.test(n[i])||l0.test(n[i]);)if(i--,i<=0)return t?q1(n,e):e;return i}function q1(n,e){let t=e;for(;ua.test(n[t-1])&&ua.test(n[t])||l0.test(n[t]);)if(t++,t>=n.length)return t;return t}function no(n,e){const t=U.graphicUtil.textMeasure.measureText(n,e),i={ascent:0,height:0,descent:0,width:0};return typeof t.actualBoundingBoxAscent!="number"||typeof t.actualBoundingBoxDescent!="number"?(i.width=Math.floor(t.width),i.height=e.fontSize||0,i.ascent=i.height,i.descent=0):(i.width=Math.floor(t.width),i.height=Math.floor(t.actualBoundingBoxAscent+t.actualBoundingBoxDescent),i.ascent=Math.floor(t.actualBoundingBoxAscent),i.descent=i.height-i.ascent),i}var Z1=function(n,e,t,i){var r,o=arguments.length,s=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,e,t,i);else for(var l=n.length-1;l>=0;l--)(r=n[l])&&(s=(o<3?r(s):o>3?r(e,t,s):r(e,t))||s);return o>3&&s&&Object.defineProperty(e,t,s),s};let Ph=class{configure(n,e){this.canvas=n.canvas,this.context=n.context,n.bindTextMeasure(this)}_measureTextWithoutAlignBaseline(n,e,t){this.context.setTextStyleWithoutAlignBaseline(e);const i=this.context.measureText(n);return t?this.compatibleMetrics(i,e):i}_measureTextWithAlignBaseline(n,e,t){this.context.setTextStyle(e);const i=this.context.measureText(n);return t?this.compatibleMetrics(i,e):i}compatibleMetrics(n,e){if(n.actualBoundingBoxAscent==null||n.actualBoundingBoxDescent==null||n.fontBoundingBoxAscent==null||n.fontBoundingBoxDescent==null){n={width:n.width};const{ascent:t,descent:i}=this.measureTextBoundADscentEstimate(e);n.actualBoundingBoxAscent=t,n.actualBoundingBoxDescent=i,n.fontBoundingBoxAscent=t,n.fontBoundingBoxDescent=i}if(n.actualBoundingBoxLeft==null||n.actualBoundingBoxRight==null){n={width:n.width,actualBoundingBoxAscent:n.actualBoundingBoxAscent,actualBoundingBoxDescent:n.actualBoundingBoxDescent,fontBoundingBoxAscent:n.fontBoundingBoxAscent,fontBoundingBoxDescent:n.fontBoundingBoxDescent};const{left:t,right:i}=this.measureTextBoundLeftRightEstimate(e);n.actualBoundingBoxLeft=t,n.actualBoundingBoxRight=i}return n}estimate(n,{fontSize:e=o0.fontSize}){let t=0,i=0;for(let r=0;r<n.length;r++)n.charCodeAt(r)<128?t++:i++;return{width:~~(.8*t*e+i*e),height:e}}measureTextWidth(n,e,t){return this.context?(t=t??this._measureTextWithoutAlignBaseline(n,e)).width:this.estimate(n,e).width}measureTextBoundsWidth(n,e,t){return this.context?(t=t??this._measureTextWithoutAlignBaseline(n,e)).width:this.estimate(n,e).width}measureTextBoundsLeftRight(n,e,t){return this.context?{left:(t=t??this._measureTextWithAlignBaseline(n,e,!0)).actualBoundingBoxLeft,right:t.actualBoundingBoxRight}:this.measureTextBoundLeftRightEstimate(e)}measureTextPixelHeight(n,e,t){var i;return this.context?(t=t??this._measureTextWithoutAlignBaseline(n,e,!0),Math.abs(t.actualBoundingBoxAscent-t.actualBoundingBoxDescent)):(i=e.fontSize)!==null&&i!==void 0?i:qt.fontSize}measureTextPixelADscent(n,e,t){return this.context?{ascent:(t=t??this._measureTextWithAlignBaseline(n,e,!0)).actualBoundingBoxAscent,descent:t.actualBoundingBoxDescent}:this.measureTextBoundADscentEstimate(e)}measureTextBoundHieght(n,e,t){var i;return this.context?(t=t??this._measureTextWithoutAlignBaseline(n,e,!0),Math.abs(t.fontBoundingBoxAscent-t.fontBoundingBoxDescent)):(i=e.fontSize)!==null&&i!==void 0?i:qt.fontSize}measureTextBoundADscent(n,e,t){return this.context?{ascent:(t=t??this._measureTextWithAlignBaseline(n,e,!0)).fontBoundingBoxAscent,descent:t.fontBoundingBoxDescent}:this.measureTextBoundADscentEstimate(e)}measureTextBoundADscentEstimate(n){var e;const t=(e=n.fontSize)!==null&&e!==void 0?e:qt.fontSize;return{ascent:.79*t,descent:.21*t}}measureTextBoundLeftRightEstimate(n){var e;const t=(e=n.fontSize)!==null&&e!==void 0?e:qt.fontSize,{textAlign:i}=n;return i==="center"?{left:t/2,right:t/2}:i==="right"||i==="end"?{left:t,right:0}:{left:0,right:t}}measureTextPixelADscentAndWidth(n,e,t){if(!this.context)return Object.assign(Object.assign({},this.measureTextBoundADscentEstimate(e)),{width:this.estimate(n,e).width});const i=this._measureTextWithoutAlignBaseline(n,e,!0);if(t===Sr.actualBounding)return{ascent:i.actualBoundingBoxAscent,descent:i.actualBoundingBoxDescent,width:i.width};if(t===Sr.estimate)return Object.assign(Object.assign({},this.measureTextBoundADscentEstimate(e)),{width:i.width});if(t===Sr.fontBounding){let r=i.fontBoundingBoxAscent,o=i.fontBoundingBoxDescent;if(i.actualBoundingBoxDescent&&o<i.actualBoundingBoxDescent){const s=i.actualBoundingBoxDescent-o;o+=s,r-=s}else if(i.actualBoundingBoxAscent&&r<i.actualBoundingBoxAscent){const s=i.actualBoundingBoxAscent-r;r+=s,o-=s}return{ascent:r,descent:o,width:i.width}}return{ascent:i.actualBoundingBoxAscent,descent:i.actualBoundingBoxDescent,width:i.width}}measureText(n,e){return this.context?(this.context.setTextStyleWithoutAlignBaseline(e),this.context.measureText(n)):this.estimate(n,e)}clipTextVertical(n,e,t,i){if(n.length===0)return{verticalList:n,width:0};const{fontSize:r=12}=e;n.forEach(a=>{a.width=a.direction===0?r:this.measureTextWidth(a.text,e)});const o=[];let s=0,l=0;for(;l<n.length&&s+n[l].width<t;l++)s+=n[l].width,o.push(n[l]);if(n[l]&&n[l].text.length>1){const a=this._clipText(n[l].text,e,t-s,0,n[l].text.length-1,"end",!1);if(i&&a.str!==n[l].text){let d="",u=0;for(let g=0;g<l;g++){const f=n[g];d+=f.text,u+=f.text.length}d+=n[l].text;const h=u+a.str.length;let c=Zl(d,h);c-=u,c!==a.str.length-1&&(a.str=a.str.substring(0,c),a.width=this.measureTextWidth(a.str,e))}o.push(Object.assign(Object.assign({},n[l]),{text:a.str,width:a.width})),s+=a.width}return{verticalList:o,width:s}}clipText(n,e,t,i,r){if(n.length===0)return{str:"",width:0};let o=this.measureTextWidth(n,e);if(o<=t)return{str:n,width:o};if(o=this.measureTextWidth(n[0],e),o>t)return{str:"",width:0};const s=this._clipText(n,e,t,0,n.length-1,"end",!1);if(i&&s.str!==n){let l=Zl(n,s.str.length,r);l!==s.str.length&&(l>s.str.length&&(s.wordBreaked=l,l=s.str.length),s.str=n.substring(0,l),s.width=this.measureTextWidth(s.str,e))}return s}_clipText(n,e,t,i,r,o,s){let l;if(o==="start")l=this._clipTextStart(n,e,t,i,r),s&&(l.result=s+l.str);else if(o==="middle"){const a=this._clipTextMiddle(n,e,t,"","",0,0,1);l={str:"none",width:a.width,result:a.left+s+a.right}}else l=this._clipTextEnd(n,e,t,i,r),s&&(l.result=l.str+s);return l}_clipTextEnd(n,e,t,i,r){if(i===r){It.getInstance().warn(`【_clipTextEnd】不应该走到这里${n}, ${i}, ${r}`);const d=n.substring(0,r+1);return{str:d,width:this.measureTextWidth(d,e)}}const o=Math.floor((i+r)/2),s=n.substring(0,o+1),l=this.measureTextWidth(s,e);let a;if(l>t){if(s.length<=1)return{str:"",width:0};const d=n.substring(0,o);return a=this.measureTextWidth(d,e),a<=t?{str:d,width:a}:this._clipTextEnd(n,e,t,i,o)}if(l<t){if(o>=n.length-1)return{str:n,width:this.measureTextWidth(n,e)};const d=n.substring(0,o+2);return a=this.measureTextWidth(d,e),a>=t?{str:s,width:l}:this._clipTextEnd(n,e,t,o,r)}return{str:s,width:l}}_clipTextStart(n,e,t,i,r){const o=Math.ceil((i+r)/2),s=n.substring(o-1,n.length),l=this.measureTextWidth(s,e);let a;if(l>t){if(s.length<=1)return{str:"",width:0};const d=n.substring(o,n.length);return a=this.measureTextWidth(d,e),a<=t?{str:d,width:a}:this._clipTextStart(n,e,t,o,n.length)}if(l<t){if(o<=0)return{str:n,width:this.measureTextWidth(n,e)};const d=n.substring(o-2,n.length);return a=this.measureTextWidth(d,e),a>=t?{str:s,width:l}:this._clipTextStart(n,e,t,i,o)}return{str:s,width:l}}_clipTextMiddle(n,e,t,i,r,o,s,l){const a=n.substring(0,l),d=this.measureTextWidth(a,e);if(d+s>t)return{left:i,right:r,width:o+s};const u=n.substring(n.length-l,n.length),h=this.measureTextWidth(u,e);return d+h>t?{left:a,right:r,width:d+s}:this._clipTextMiddle(n,e,t,a,u,d,h,l+1)}clipTextWithSuffixVertical(n,e,t,i,r,o){if(i==="")return this.clipTextVertical(n,e,t,r);if(n.length===0)return{verticalList:n,width:0};const s=this.clipTextVertical(n,e,t,r);if(s.verticalList.length===n.length&&s.verticalList[s.verticalList.length-1].width===n[n.length-1].width)return s;const l=this.measureTextWidth(i,e);if(l>t)return s;let a;if(t-=l,o==="start"){const d=this.revertVerticalList(n);a=this.clipTextVertical(d,e,t,r);const u=this.revertVerticalList(a.verticalList);u.unshift({text:i,direction:1,width:l}),a.verticalList=u}else if(o==="middle"){const d=this.clipTextVertical(n,e,t/2,r),u=this.revertVerticalList(n),h=this.clipTextVertical(u,e,t/2,r);d.verticalList.push({text:i,direction:1,width:l}),this.revertVerticalList(h.verticalList).forEach(c=>d.verticalList.push(c)),a={verticalList:d.verticalList,width:d.width+h.width}}else a=this.clipTextVertical(n,e,t,r),a.verticalList.push({text:i,direction:1,width:l});return a.width+=l,a}revertVerticalList(n){return n.reverse().map(e=>{const t=e.text.split("").reverse().join("");return Object.assign(Object.assign({},e),{text:t})})}clipTextWithSuffix(n,e,t,i,r,o,s=!1){if(i==="")return this.clipText(n,e,t,r);if(n.length===0)return{str:"",width:0};const l=this.measureTextWidth(n,e);if(!s&&l<=t)return{str:n,width:l};const a=this.measureTextWidth(i,e);if(a>t)return{str:"",width:0};if(s&&l+a<=t)return{str:n+i,width:l+a};t-=a;const d=this._clipText(n,e,t,0,n.length-1,o,i);if(r&&d.str!==n){const u=Zl(n,d.str.length);u!==d.str.length&&(d.result=n.substring(0,u),d.width=this.measureTextWidth(d.str,e))}else s&&d.str===n&&(d.result=n+i);return d.str=d.result,d.width+=a,d}};Ph=Z1([se()],Ph);var J1=function(n,e,t,i){var r,o=arguments.length,s=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,e,t,i);else for(var l=n.length-1;l>=0;l--)(r=n[l])&&(s=(o<3?r(s):o>3?r(e,t,s):r(e,t))||s);return o>3&&s&&Object.defineProperty(e,t,s),s};const vi=Symbol.for("TextMeasureContribution");let yo=class extends Ph{};yo=J1([se()],yo);const Ce=new jv,d0=Symbol.for("CanvasFactory"),Q1=Symbol.for("Context2dFactory");function Hh(n){return Ce.getNamed(d0,U.global.env)(n)}class eS{constructor(){this.pools=[],this.allocatedCanvas=[]}shareCanvas(){return this.allocatedCanvas.length?this.allocatedCanvas[0]:this.getCommonCanvas()}getCommonCanvas(){return this._commonCanvas||(this._commonCanvas=this.allocate({width:100,height:100,dpr:2})),this._commonCanvas}allocate(e){if(!this.pools.length){const i=Hh(Object.assign({nativeCanvas:U.global.createCanvas(e)},e));return this.allocatedCanvas.push(i),i}const t=this.pools.pop();return t.resize(e.width,e.height),t.dpr=e.dpr,t}allocateByObj(e){if(!this.pools.length){const i={width:e.width/e.dpr,height:e.height/e.dpr,dpr:e.dpr},r=Hh(Object.assign({nativeCanvas:U.global.createCanvas(i)},i));return this.allocatedCanvas.push(r),r}const t=this.pools.pop();return t.width=e.width,t.height=e.height,t}free(e){this.pools.push(e)}get length(){return this.pools.length}release(...e){this.pools=[]}}const vo=new eS;var tS=function(n,e,t,i){var r,o=arguments.length,s=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,e,t,i);else for(var l=n.length-1;l>=0;l--)(r=n[l])&&(s=(o<3?r(s):o>3?r(e,t,s):r(e,t))||s);return o>3&&s&&Object.defineProperty(e,t,s),s},nS=function(n,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,e)};const Hs=Symbol.for("VWindow"),Rf=Symbol.for("WindowHandlerContribution");let kh=class{get width(){if(this._handler){const n=this._handler.getWH();return this._width=n.width}return this._width}get height(){if(this._handler){const n=this._handler.getWH();return this._height=n.height}return this._height}get dpr(){return this._handler.getDpr()}constructor(){this.hooks={onChange:new Xt(["x","y","width","height"])},this.active=()=>{const n=this.global;!n.env||this.actived||(Ce.getNamed(Rf,n.env).configure(this,n),this.actived=!0)},this._uid=pt.GenAutoIncrementId(),this.global=U.global,this.postInit()}postInit(){this.global.hooks.onSetEnv.tap("window",this.active),this.active()}get style(){var n;return(n=this._handler.getStyle())!==null&&n!==void 0?n:{}}set style(n){this._handler.setStyle(n)}create(n){var e,t;this._handler.createWindow(n);const i=this._handler.getWH();this._width=i.width,this._height=i.height,n.viewBox?this.setViewBox(n.viewBox):n.canvasControled!==!1?this.setViewBox({x1:0,y1:0,x2:this._width,y2:this._height}):this.setViewBox({x1:0,y1:0,x2:(e=n.width)!==null&&e!==void 0?e:this._width,y2:(t=n.height)!==null&&t!==void 0?t:this._height}),this.title=this._handler.getTitle(),this.resizable=!0}setWindowHandler(n){this._handler=n}setDpr(n){return this._handler.setDpr(n)}resize(n,e){return this._handler.resizeWindow(n,e)}configure(){throw new Error("暂不支持")}release(){return this.global.hooks.onSetEnv.unTap("window",this.active),this._handler.releaseWindow()}getContext(){return this._handler.getContext()}getNativeHandler(){return this._handler.getNativeHandler()}getImageBuffer(n){return this._handler.getImageBuffer?this._handler.getImageBuffer(n):null}addEventListener(n,e,t){return this._handler.addEventListener(n,e,t)}removeEventListener(n,e,t){return this._handler.removeEventListener(n,e,t)}dispatchEvent(n){return this._handler.dispatchEvent(n)}getBoundingClientRect(){return this._handler.getBoundingClientRect()}getContainer(){return this._handler.container}clearViewBox(n){this._handler.clearViewBox(n)}setViewBox(n){this._handler.setViewBox(n)}setViewBoxTransform(n,e,t,i,r,o){this._handler.setViewBoxTransform(n,e,t,i,r,o)}getViewBox(){return this._handler.getViewBox()}getViewBoxTransform(){return this._handler.getViewBoxTransform()}pointTransform(n,e){const t=this._handler.getViewBox(),i={x:n,y:e};return this._handler.getViewBoxTransform().transformPoint({x:n,y:e},i),i.x-=t.x1,i.y-=t.y1,i}hasSubView(){const n=this._handler.getViewBox();return!(n.x1===0&&n.y1===0&&_i(this.width,n.width())&&_i(this.height,n.height()))}isVisible(n){return this._handler.isVisible(n)}onVisibleChange(n){return this._handler.onVisibleChange(n)}getTopLeft(n){return this._handler.getTopLeft(n)}};kh=tS([se(),nS("design:paramtypes",[])],kh);var u0=function(n,e,t,i){var r,o=arguments.length,s=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,e,t,i);else for(var l=n.length-1;l>=0;l--)(r=n[l])&&(s=(o<3?r(s):o>3?r(e,t,s):r(e,t))||s);return o>3&&s&&Object.defineProperty(e,t,s),s},h0=function(n,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,e)},Fg=function(n,e){return function(t,i){e(t,i,n)}};let Eh=class{get canvas(){return this.tryInitCanvas(),this._canvas}get context(){return this.tryInitCanvas(),this._context}constructor(n){this.contributions=n,this.configured=!1,this.global=U.global,this.global.hooks.onSetEnv.tap("graphic-util",(e,t,i)=>{this.configured=!1,this.configure(i,t)})}get textMeasure(){return this._textMeasure||this.configure(this.global,this.global.env),this._textMeasure}configure(n,e){this.configured||(this.contributions.getContributions().forEach(t=>{t.configure(this,e)}),this.configured=!0)}tryInitCanvas(){if(!this._canvas){const n=vo.shareCanvas();this._canvas=n,this._context=n.getContext("2d")}}bindTextMeasure(n){this._textMeasure=n}measureText(n,e,t="native"){var i;this.configure(this.global,this.global.env);const r=this.global.measureTextMethod;this.global.measureTextMethod=t;const o={width:this._textMeasure.measureTextWidth(n,e),height:(i=e.fontSize)!==null&&i!==void 0?i:qt.fontSize};return this.global.measureTextMethod=r,o}createTextMeasureInstance(n,e,t){return this.configure(this.global,this.global.env),new yi(Object.assign({defaultFontParams:{fontFamily:qt.fontFamily,fontSize:qt.fontSize},getCanvasForMeasure:t||(()=>this.canvas),getTextBounds:void 0,specialCharSet:`-/: .,@%'"~`+yi.ALPHABET_CHAR_SET+yi.ALPHABET_CHAR_SET.toUpperCase()},e??{}),n)}drawGraphicToCanvas(n,e,t){if(!e.defaultLayer)return null;const i=Ce.get(Hs),r=n.AABBBounds,o=r.width(),s=r.height(),l=-r.x1,a=-r.y1;i.create({viewBox:{x1:l,y1:a,x2:r.x2,y2:r.y2},width:o,height:s,canvas:t,dpr:e.window.dpr,canvasControled:!0,offscreen:!0,title:""});const d=e.params.optimize.disableCheckGraphicWidthOutRange;e.params.optimize.disableCheckGraphicWidthOutRange=!0,e.defaultLayer.getNativeHandler().drawTo(i,[n],{transMatrix:i.getViewBoxTransform(),viewBox:i.getViewBox(),stage:e,layer:e.defaultLayer,renderService:e.renderService,background:"transparent",clear:!0,updateBounds:!1}),e.params.optimize.disableCheckGraphicWidthOutRange=d;const u=i.getNativeHandler();return u.nativeCanvas?u.nativeCanvas:null}};Eh=u0([se(),Fg(0,Be(gt)),Fg(0,At(vi)),h0("design:paramtypes",[Object])],Eh);var Wi;(function(n){n[n.transform=0]="transform",n[n.matrix=1]="matrix"})(Wi||(Wi={}));const ct=new Ht;let Lh=class{constructor(){this.matrix=new Ht}init(n){return this.mode=Wi.transform,this.originTransform=n,this.matrix.reset(),this}fromMatrix(n,e){return this.mode=Wi.matrix,this.outSourceMatrix=n,this.outTargetMatrix=e,this}scaleMatrix(n,e,t){const i=this.outSourceMatrix;if(ct.setValue(i.a,i.b,i.c,i.d,i.e,i.f),this.outTargetMatrix.reset(),t){const{x:r,y:o}=t;this.outTargetMatrix.translate(r,o),this.outTargetMatrix.scale(n,e),this.outTargetMatrix.translate(-r,-o)}else this.outTargetMatrix.scale(n,e);return this.outTargetMatrix.multiply(ct.a,ct.b,ct.c,ct.d,ct.e,ct.f),this}rotateMatrix(n,e){const t=this.outSourceMatrix;if(ct.setValue(t.a,t.b,t.c,t.d,t.e,t.f),this.outTargetMatrix.reset(),e){const{x:i,y:r}=e;this.outTargetMatrix.translate(i,r),this.outTargetMatrix.rotate(n),this.outTargetMatrix.translate(-i,-r)}else this.outTargetMatrix.rotate(n);return this.outTargetMatrix.multiply(ct.a,ct.b,ct.c,ct.d,ct.e,ct.f),this}scale(n,e,t){return this.mode===Wi.matrix?this.scaleMatrix(n,e,t):this}rotate(n,e){return this.mode===Wi.matrix?this.rotateMatrix(n,e):this}translateMatrix(n,e){const t=this.outSourceMatrix;return ct.setValue(t.a,t.b,t.c,t.d,t.e,t.f),this.outTargetMatrix.reset(),this.outTargetMatrix.translate(n,e),this.outTargetMatrix.multiply(ct.a,ct.b,ct.c,ct.d,ct.e,ct.f),this}translate(n,e){return this.mode===Wi.matrix?this.translateMatrix(n,e):this}simplify(n){return this.mode===Wi.matrix?this.simplifyMatrix(n):this}simplifyMatrix(n){return this}};Lh=u0([se(),h0("design:paramtypes",[])],Lh);const Wt={arc:H1,area:k1,circle:E1,line:z1,path:I1,symbol:W1,text:o0,rect:D1,polygon:O1,richtext:mi,richtextIcon:N1,image:Ps,group:L1,glyph:F1},Ou=Object.keys(Wt);function iS(){return{arc:Object.assign({},Wt.arc),area:Object.assign({},Wt.area),circle:Object.assign({},Wt.circle),line:Object.assign({},Wt.line),path:Object.assign({},Wt.path),symbol:Object.assign({},Wt.symbol),text:Object.assign({},Wt.text),rect:Object.assign({},Wt.rect),polygon:Object.assign({},Wt.polygon),richtext:Object.assign({},Wt.richtext),richtextIcon:Object.assign({},Wt.richtextIcon),image:Object.assign({},Wt.image),group:Object.assign({},Wt.group),glyph:Object.assign({},Wt.glyph)}}function vl(n,e){Object.keys(e).forEach(t=>{n[t]=e[t]})}const zg=iS();class ks{constructor(){this.initTheme(),this.dirty=!1}initTheme(){this._defaultTheme={},Ou.forEach(e=>{this._defaultTheme[e]=Object.create(zg[e])}),this.combinedTheme=this._defaultTheme}getTheme(e){if(!e)return this.combinedTheme;if(!this.dirty)return this.combinedTheme;let t={};const i=this.getParentWithTheme(e);return i&&(t=i.theme),this.applyTheme(e,t),this.combinedTheme}getParentWithTheme(e){for(;e.parent;)if((e=e.parent).theme)return e;return null}applyTheme(e,t,i=!1){if(this.dirty){const r=this.getParentWithTheme(e);if(r){const o=r.theme;(o.dirty||i)&&o.applyTheme(r,t,!0)}this.userTheme?this.doCombine(r&&r.theme.combinedTheme):(r?this.combinedTheme=r.theme.combinedTheme:(this.combinedTheme=this._defaultTheme,It.getInstance().warn("未知错误，走到不应该走的区域里")),this.dirty=!1)}return this.combinedTheme}doCombine(e){const t=this.userTheme,i=this.combinedTheme;Ou.forEach(r=>{const o=Object.create(zg[r]);e&&e[r]&&vl(o,e[r]),i[r]&&vl(o,i[r]),t[r]&&vl(o,t[r]),this.combinedTheme[r]=o}),t.common&&Ou.forEach(r=>{vl(this.combinedTheme[r],t.common)}),this.dirty=!1}setTheme(e,t){let i=this.userTheme;i?Object.keys(e).forEach(r=>{i[r]?Object.assign(i[r],e[r]):i[r]=Object.assign({},e[r])}):i=e,this.userTheme=i,this.dirty=!0,this.dirtyChildren(t)}resetTheme(e,t){this.userTheme=e,this.dirty=!0,this.dirtyChildren(t)}dirtyChildren(e){e.forEachChildren(t=>{t.isContainer&&(t.theme&&(t.theme.dirty=!0),this.dirtyChildren(t))})}}const c0=new ks;function ve(n,e){return n.glyphHost?ve(n.glyphHost):e?(n.isContainer,e):rS(n)||n.attachedThemeGraphic&&ve(n.attachedThemeGraphic)||c0.getTheme()}function rS(n){let e;if(e=n.isContainer?n:n.parent,e){for(;e&&!e.theme;)e=e.parent;return e?(e.theme||e.createTheme(),e.theme.getTheme(e)):c0.getTheme()}return null}var oS=function(n,e,t,i){return new(t||(t=Promise))(function(r,o){function s(d){try{a(i.next(d))}catch(u){o(u)}}function l(d){try{a(i.throw(d))}catch(u){o(u)}}function a(d){var u;d.done?r(d.value):(u=d.value,u instanceof t?u:new t(function(h){h(u)})).then(s,l)}a((i=i.apply(n,e||[])).next())})};class sS extends Lo{get previousSibling(){return this._prev}get nextSibling(){return this._next}get children(){return this.getChildren()}get firstChild(){return this._firstChild}get lastChild(){return this._lastChild}get count(){return this._count}get childrenCount(){return this._idMap?this._idMap.size:0}constructor(){super(),this._uid=pt.GenAutoIncrementId(),this._firstChild=null,this._lastChild=null,this.parent=null,this._count=1}forEachChildren(e,t=!1){if(t){let i=this._lastChild,r=0;for(;i;){if(e(i,r++))return;i=i._prev}}else{let i=this._firstChild,r=0;for(;i;){if(e(i,r++))return;i=i._next}}}forEachChildrenAsync(e,t=!1){return oS(this,void 0,void 0,function*(){if(t){let i=this._lastChild,r=0;for(;i;){let o=e(i,r++);if(o.then&&(o=yield o),o)return;i=i._prev}}else{let i=this._firstChild,r=0;for(;i;){let o=e(i,r++);if(o.then&&(o=yield o),o)return;i=i._next}}})}forEach(e){return this.forEachChildren(e)}appendChild(e,t=!0){if(this._uid===e._uid)return null;if(!t&&e.isAncestorsOf(this))throw new Error("【Node::appendChild】不能将父辈元素append为子元素");return e.parent&&e.parent.removeChild(e),e.parent=this,this._lastChild?(this._lastChild._next=e,e._prev=this._lastChild,this._lastChild=e):(this._firstChild=this._lastChild=e,e._prev=e._next=null),this._idMap||(this._idMap=new Map),this._idMap.set(e._uid,e),this.setCount(e.count),this._structEdit=!0,e}appendChildArrHighPerformance(e,t=!1){return console.error("暂不支持该函数"),e}insertBefore(e,t){if(!t)return this.appendChild(e);if(this===e||e===t)return null;if(e.isAncestorsOf(this))throw new Error("【Node::insertBefore】不能将父辈元素insert为子元素");return t.parent!==this?null:(e.parent&&e.parent.removeChild(e),e.parent=this,e._prev=t._prev,t._prev?t._prev._next=e:this._firstChild=e,t._prev=e,e._next=t,this._idMap||(this._idMap=new Map),this._idMap.set(e._uid,e),this._structEdit=!0,this.setCount(e.count),e)}insertAfter(e,t){if(!t)return this.appendChild(e);if(this===e||e===t)return null;if(e.isAncestorsOf(this))throw new Error("【Node::insertAfter】不能将父辈元素insert为子元素");return t.parent!==this?null:(e.parent&&e.parent.removeChild(e),e.parent=this,t._next?(t._next._prev=e,e._next=t._next):this._lastChild=e,t._next=e,e._prev=t,this._idMap||(this._idMap=new Map),this._idMap.set(e._uid,e),this._structEdit=!0,this.setCount(e.count),e)}insertInto(e,t){if(!this._ignoreWarn&&this._nodeList&&It.getInstance().warn("insertIntoKeepIdx和insertInto混用可能会存在错误"),t>=this.childrenCount)return this.appendChild(e);if(this===e)return null;if(e.isAncestorsOf(this))throw new Error("【Node::insertBefore】不能将父辈元素insert为子元素");if(e.parent&&e.parent.removeChild(e),e.parent=this,t===0)e._next=this._firstChild,this._firstChild&&(this._firstChild._prev=e),e._prev=null,this._firstChild=e;else{let i=this._firstChild;for(let r=0;r<t;r++){if(!i)return null;r>0&&(i=i._next)}if(!i)return null;e._next=i._next,e._prev=i,i._next=e,e._next&&(e._next._prev=e)}return this._idMap||(this._idMap=new Map),this._idMap.set(e._uid,e),this._structEdit=!0,this.setCount(e.count),e}insertIntoKeepIdx(e,t){if(this._nodeList||(this._nodeList=this.children),this._nodeList[t]){const o=this._nodeList[t];return this._nodeList.splice(t,0,e),this.insertBefore(e,o)}let i;this._nodeList[t]=e;for(let o=t-1;o>=0&&(i=this._nodeList[o],!i);o--);if(i)return i._next?this.insertBefore(e,i._next):this.appendChild(e);this._ignoreWarn=!0;const r=this.insertInto(e,0);return this._ignoreWarn=!1,r}removeChild(e){if(!this._idMap||!this._idMap.has(e._uid))return null;if(this._idMap.delete(e._uid),this._nodeList){const t=this._nodeList.findIndex(i=>i===e);t>=0&&this._nodeList.splice(t,1)}return e._prev?e._prev._next=e._next:this._firstChild=e._next,e._next?e._next._prev=e._prev:this._lastChild=e._prev,e.parent=null,e._prev=null,e._next=null,this._structEdit=!0,this.setCount(-e.count),e}delete(){this.parent&&this.parent.removeChild(this)}removeAllChild(e){if(!this._idMap)return;this._nodeList&&(this._nodeList.length=0);let t=this._firstChild;for(;t;){const i=t._next;t.parent=null,t._prev=null,t._next=null,t=t._next,t=i}this._firstChild=null,this._lastChild=null,this._idMap.clear(),this._structEdit=!0,this.setCount(1-this._count)}replaceChild(e,t){throw new Error("暂不支持")}find(e,t=!1){let i=null;return this.forEachChildren((r,o)=>!(r===this||!e(r,o))&&(i=r,!0)),t&&this.forEachChildren(r=>{if(r.isContainer){const o=r.find(e,!0);if(o)return i=o,!0}return!1}),i}findAll(e,t=!1){let i=[];return this.forEachChildren((r,o)=>{r!==this&&e(r,o)&&i.push(r)}),t&&this.forEachChildren(r=>{if(r.isContainer){const o=r.findAll(e,!0);o.length&&(i=i.concat(o))}}),i}getElementById(e){return this.find(t=>t.id===e,!0)}findChildById(e){return this.getElementById(e)}findChildByUid(e){return this._idMap&&this._idMap.get(e)||null}getElementsByName(e){return this.findAll(t=>t.name===e,!0)}findChildrenByName(e){return this.getElementsByName(e)}getElementsByType(e){return this.findAll(t=>t.type===e,!0)}getChildByName(e,t=!1){return this.find(i=>i.name===e,t)}getChildAt(e){let t=this._firstChild;if(!t)return null;for(let i=0;i<e;i++){if(!t._next)return null;t=t._next}return t}at(e){return this.getChildAt(e)}containNode(e){if(!this._idMap)return!1;if(this._idMap.has(e._uid))return!0;let t=this._firstChild;for(;t;){if(t.containNode(e))return!0;t=t._next}return!1}getRootNode(){let e=this.parent;for(;e!=null&&e.parent;)e=e.parent;return e||this}hasChildNodes(){return this._firstChild!==null}addChild(e){return this.appendChild(e)}add(e){return this.appendChild(e)}getChildren(){const e=[];let t=this._firstChild;for(;t;)e.push(t),t=t._next;return e}isChildOf(e){return!!this.parent&&this.parent._uid===e._uid}isParentOf(e){return e.isChildOf(this)}isDescendantsOf(e){let t=this.parent;if(!t)return!1;do{if(t._uid===e._uid)return!0;t=t.parent}while(t!==null);return!1}isAncestorsOf(e){return e.isDescendantsOf(this)}getAncestor(e){throw new Error("暂不支持")}setAllDescendantsProps(e,t){let i=this._firstChild;for(;i;)i[e]=t,i.setAllDescendantsProps(e,t),i=i._next}setCount(e){this._count+=e;let t=this.parent;if(t)do t._count+=e,t=t.parent;while(t!==null)}clone(){throw new Error("暂不支持")}cloneTo(e){throw new Error("暂不支持")}getParent(){return this.parent}del(e){return this.removeChild(e)}addEventListener(e,t,i){const r=kt(i,!0)&&i||ke(i)&&i.capture,o=ke(i)&&i.once,s=Ae(t)?void 0:t;return e=r?`${e}capture`:e,t=Ae(t)?t:t.handleEvent,o?super.once(e,t,s):super.on(e,t,s),this}on(e,t,i){return this.addEventListener(e,t,i)}removeEventListener(e,t,i){const r=kt(i,!0)&&i||ke(i)&&i.capture,o=Ae(t)?void 0:t;e=r?`${e}capture`:e,t=Ae(t)?t:t.handleEvent;const s=ke(i)&&i.once;return super.off(e,t,o,s),this}off(e,t,i){return this.removeEventListener(e,t,i)}once(e,t,i){return ke(i)?(i.once=!0,this.addEventListener(e,t,i)):this.addEventListener(e,t,{once:!0})}removeAllEventListeners(){return super.removeAllListeners(),this}removeAllListeners(){return this.removeAllEventListeners()}dispatchEvent(e,...t){return super.emit(e.type,e,...t),!e.defaultPrevented}emit(e,t){return this.dispatchEvent(e,t)}release(){this.removeAllListeners()}}class tl{get layerX(){return this.layer.x}get layerY(){return this.layer.y}get pageX(){return this.page.x}get pageY(){return this.page.y}get x(){return this.canvas.x}get y(){return this.canvas.y}get canvasX(){return this.canvas.x}get canvasY(){return this.canvas.y}get viewX(){return this.viewport.x}get viewY(){return this.viewport.y}constructor(e){this.bubbles=!0,this.cancelBubble=!0,this.cancelable=!1,this.composed=!1,this.defaultPrevented=!1,this.eventPhase=tl.prototype.NONE,this.propagationStopped=!1,this.propagationImmediatelyStopped=!1,this.layer={x:0,y:0},this.page={x:0,y:0},this.canvas={x:0,y:0},this.viewport={x:0,y:0},this.NONE=0,this.CAPTURING_PHASE=1,this.AT_TARGET=2,this.BUBBLING_PHASE=3,this.manager=e}composedPath(){return!this.manager||this.path&&this.path[this.path.length-1]===this.target||(this.path=this.target?this.manager.propagationPath(this.target):[]),this.composedDetailPath(),this.path}composedDetailPath(){return this.pickParams&&this.pickParams.graphic?(this.detailPath=this.path.slice(),this._composedDetailPath(this.pickParams)):this.detailPath=this.path.slice(),this.detailPath}_composedDetailPath(e){if(e&&e.graphic){const t=this.pickParams.graphic;if(t.stage){const i=t.stage.eventSystem.manager.propagationPath(t);this.detailPath.push(i),this._composedDetailPath(e.params)}}}preventDefault(){try{this.nativeEvent instanceof Event&&this.nativeEvent.cancelable&&this.nativeEvent.preventDefault()}catch{this.nativeEvent.preventDefault&&Ae(this.nativeEvent.preventDefault)&&this.nativeEvent.preventDefault()}this.defaultPrevented=!0}stopImmediatePropagation(){this.propagationImmediatelyStopped=!0}stopPropagation(){try{this.nativeEvent instanceof Event&&this.nativeEvent.cancelable&&this.nativeEvent.stopPropagation()}catch{this.nativeEvent.stopPropagation&&Ae(this.nativeEvent.stopPropagation)&&this.nativeEvent.stopPropagation()}this.propagationStopped=!0}initEvent(){}initUIEvent(){}clone(){throw new Error("Method not implemented.")}}class ha extends tl{constructor(){super(...arguments),this.client={x:0,y:0},this.movement={x:0,y:0},this.offset={x:0,y:0},this.global={x:0,y:0},this.screen={x:0,y:0}}get clientX(){return this.client.x}get clientY(){return this.client.y}get movementX(){return this.movement.x}get movementY(){return this.movement.y}get offsetX(){return this.offset.x}get offsetY(){return this.offset.y}get globalX(){return this.global.x}get globalY(){return this.global.y}get screenX(){return this.screen.x}get screenY(){return this.screen.y}getModifierState(e){return"getModifierState"in this.nativeEvent&&this.nativeEvent.getModifierState(e)}initMouseEvent(e,t,i,r,o,s,l,a,d,u,h,c,g,f,p){throw new Error("Method not implemented.")}}class on extends ha{constructor(){super(...arguments),this.width=0,this.height=0,this.isPrimary=!1}getCoalescedEvents(){return this.type==="pointermove"||this.type==="mousemove"||this.type==="touchmove"?[this]:[]}getPredictedEvents(){throw new Error("getPredictedEvents is not supported!")}clone(){var e,t,i;const r=new on(this.manager);r.eventPhase=r.NONE,r.currentTarget=null,r.path=[],r.detailPath=[],r.target=null,r.nativeEvent=this.nativeEvent,r.originalEvent=this.originalEvent,(e=this.manager)===null||e===void 0||e.copyPointerData(this,r),(t=this.manager)===null||t===void 0||t.copyMouseData(this,r),(i=this.manager)===null||i===void 0||i.copyData(this,r),r.target=this.target,r.path=this.composedPath().slice();const o=this.composedDetailPath();return r.detailPath=o&&o.slice(),r.type=this.type,r}}class qi extends ha{constructor(){super(...arguments),this.DOM_DELTA_PIXEL=0,this.DOM_DELTA_LINE=1,this.DOM_DELTA_PAGE=2}clone(){var e,t,i;const r=new qi(this.manager);r.eventPhase=r.NONE,r.currentTarget=null,r.path=[],r.detailPath=[],r.target=null,r.nativeEvent=this.nativeEvent,r.originalEvent=this.originalEvent,(e=this.manager)===null||e===void 0||e.copyWheelData(this,r),(t=this.manager)===null||t===void 0||t.copyMouseData(this,r),(i=this.manager)===null||i===void 0||i.copyData(this,r),r.target=this.target,r.path=this.composedPath().slice();const o=this.composedDetailPath();return r.detailPath=o&&o.slice(),r.type=this.type,r}}qi.DOM_DELTA_PIXEL=0,qi.DOM_DELTA_LINE=1,qi.DOM_DELTA_PAGE=2;class Af extends tl{constructor(e,t){super(),this.type=e,this.detail=t}}const f0="*",wr=typeof performance=="object"&&performance.now?performance:Date;function Ei(n){return n==="mouse"||n==="pen"}let lS=class{constructor(e,t){this.dispatch=new Lo,this.cursorTarget=null,this.pauseNotify=!1,this.mappingState={trackingData:{}},this.eventPool=new Map,this.onPointerDown=(i,r)=>{if(!(i instanceof on))return void It.getInstance().warn("EventManager cannot map a non-pointer event as a pointer event");const o=this.createPointerEvent(i,i.type,r);if(this.dispatchEvent(o,"pointerdown"),o.pointerType==="touch")this.dispatchEvent(o,"touchstart");else if(Ei(o.pointerType)){const s=o.button===2;this.dispatchEvent(o,s?"rightdown":"mousedown")}this.trackingData(i.pointerId).pressTargetsByButton[i.button]=o.composedPath(),this.freeEvent(o)},this.onPointerMove=(i,r)=>{var o,s;if(!(i instanceof on))return void It.getInstance().warn("EventManager cannot map a non-pointer event as a pointer event");const l=this.createPointerEvent(i,i.type,r),a=Ei(l.pointerType),d=this.trackingData(i.pointerId),u=this.findMountedTarget(d.overTargets);if(d.overTargets&&u&&u!==this.rootTarget&&u!==l.target){const h=i.type==="mousemove"?"mouseout":"pointerout",c=this.createPointerEvent(i,h,u||void 0);if(this.dispatchEvent(c,"pointerout"),a&&this.dispatchEvent(c,"mouseout"),!l.composedPath().includes(u)){const g=this.createPointerEvent(i,"pointerleave",u||void 0);for(g.eventPhase=g.AT_TARGET;g.target&&!l.composedPath().includes(g.target);)g.currentTarget=g.target,this.notifyTarget(g),a&&this.notifyTarget(g,"mouseleave"),g.target=g.target.parent;this.freeEvent(g)}this.freeEvent(c)}if(u!==l.target){const h=i.type==="mousemove"?"mouseover":"pointerover",c=this.clonePointerEvent(l,h);this.dispatchEvent(c,"pointerover"),a&&this.dispatchEvent(c,"mouseover");let g=u==null?void 0:u.parent;for(;g&&g!==this.rootTarget.parent&&g!==l.target;)g=g.parent;if(!g||g===this.rootTarget.parent){const f=this.clonePointerEvent(l,"pointerenter");f.eventPhase=f.AT_TARGET;let p=f.target;const m=new Set;let b=u;for(;b&&b!==this.rootTarget;)m.add(b),b=b.parent;for(;p&&p!==u&&p!==this.rootTarget.parent;)m.has(p)||(f.currentTarget=p,this.notifyTarget(f),a&&this.notifyTarget(f,"mouseenter")),p=p.parent;this.freeEvent(f)}this.freeEvent(c)}this.dispatchEvent(l,"pointermove"),l.pointerType==="touch"&&this.dispatchEvent(l,"touchmove"),a&&(this.dispatchEvent(l,"mousemove"),this.cursorTarget=l.target,this.cursor=((s=(o=l.target)===null||o===void 0?void 0:o.attribute)===null||s===void 0?void 0:s.cursor)||this.rootTarget.getCursor()),d.overTargets=l.composedPath(),this.freeEvent(l)},this.onPointerOver=(i,r)=>{var o,s;if(!(i instanceof on))return void It.getInstance().warn("EventManager cannot map a non-pointer event as a pointer event");const l=this.trackingData(i.pointerId),a=this.createPointerEvent(i,i.type,r),d=Ei(a.pointerType);this.dispatchEvent(a,"pointerover"),d&&this.dispatchEvent(a,"mouseover"),a.pointerType==="mouse"&&(this.cursorTarget=a.target,this.cursor=((s=(o=a.target)===null||o===void 0?void 0:o.attribute)===null||s===void 0?void 0:s.cursor)||this.rootTarget.getCursor());const u=this.clonePointerEvent(a,"pointerenter");for(u.eventPhase=u.AT_TARGET;u.target&&u.target!==this.rootTarget.parent;)u.currentTarget=u.target,this.notifyTarget(u),d&&this.notifyTarget(u,"mouseenter"),u.target=u.target.parent;l.overTargets=a.composedPath(),this.freeEvent(a),this.freeEvent(u)},this.onPointerOut=(i,r)=>{if(!(i instanceof on))return void It.getInstance().warn("EventManager cannot map a non-pointer event as a pointer event");const o=this.trackingData(i.pointerId);if(o.overTargets){const s=Ei(i.pointerType),l=this.findMountedTarget(o.overTargets),a=this.createPointerEvent(i,"pointerout",l||void 0);this.dispatchEvent(a),s&&this.dispatchEvent(a,"mouseout");const d=this.createPointerEvent(i,"pointerleave",l||void 0);for(d.eventPhase=d.AT_TARGET;d.target&&d.target!==this.rootTarget.parent;)d.currentTarget=d.target,this.notifyTarget(d),s&&this.notifyTarget(d,"mouseleave"),d.target=d.target.parent;o.overTargets=[],this.freeEvent(a),this.freeEvent(d)}this.cursorTarget=null,this.cursor=""},this.onPointerUp=(i,r)=>{var o;if(!(i instanceof on))return void It.getInstance().warn("EventManager cannot map a non-pointer event as a pointer event");const s=wr.now(),l=this.createPointerEvent(i,i.type,r);if(this.dispatchEvent(l,"pointerup"),l.pointerType==="touch")this.dispatchEvent(l,"touchend");else if(Ei(l.pointerType)){const h=l.button===2;this.dispatchEvent(l,h?"rightup":"mouseup")}const a=this.trackingData(i.pointerId),d=this.findMountedTarget(a.pressTargetsByButton[i.button]);let u=d;if(d&&!l.composedPath().includes(d)){let h=d;for(;h&&!l.composedPath().includes(h);){if(l.currentTarget=h,this.notifyTarget(l,"pointerupoutside"),l.pointerType==="touch")this.notifyTarget(l,"touchendoutside");else if(Ei(l.pointerType)){const c=l.button===2;this.notifyTarget(l,c?"rightupoutside":"mouseupoutside")}h=h.parent}delete a.pressTargetsByButton[i.button],u=h}if(u){const h=this.clonePointerEvent(l,"click");h.target=u,h.path=[],h.detailPath=[],a.clicksByButton[i.button]||(a.clicksByButton[i.button]={clickCount:0,target:h.target,timeStamp:s});const c=a.clicksByButton[i.button];c.target===h.target&&s-c.timeStamp<((o=this._config.clickInterval)!==null&&o!==void 0?o:200)?++c.clickCount:c.clickCount=1,c.target=h.target,c.timeStamp=s,h.detail=c.clickCount,Ei(h.pointerType)?(this.dispatchEvent(h,"click"),c.clickCount===2&&this.dispatchEvent(h,"dblclick")):h.pointerType==="touch"&&this._config.supportsTouchEvents&&(this.dispatchEvent(h,"tap"),c.clickCount===2&&this.dispatchEvent(h,"dbltap")),this.dispatchEvent(h,"pointertap"),this.freeEvent(h)}this.freeEvent(l)},this.onPointerUpOutside=(i,r)=>{if(!(i instanceof on))return void It.getInstance().warn("EventManager cannot map a non-pointer event as a pointer event");const o=this.trackingData(i.pointerId),s=this.findMountedTarget(o.pressTargetsByButton[i.button]),l=this.createPointerEvent(i,i.type,r);if(s){let a=s;for(;a;)l.currentTarget=a,this.notifyTarget(l,"pointerupoutside"),l.pointerType==="touch"?this.notifyTarget(l,"touchendoutside"):Ei(l.pointerType)&&this.notifyTarget(l,l.button===2?"rightupoutside":"mouseupoutside"),a=a.parent;delete o.pressTargetsByButton[i.button]}this.freeEvent(l)},this.onWheel=(i,r)=>{if(!(i instanceof qi))return void It.getInstance().warn("EventManager cannot map a non-wheel event as a wheel event");const o=this.createWheelEvent(i,r);this.dispatchEvent(o),this.freeEvent(o)},this.rootTarget=e,this.mappingTable={},this._config=Object.assign({clickInterval:200},t),this.addEventMapping("pointerdown",this.onPointerDown),this.addEventMapping("pointermove",this.onPointerMove),this.addEventMapping("pointerout",this.onPointerOut),this.addEventMapping("pointerleave",this.onPointerOut),this.addEventMapping("pointerover",this.onPointerOver),this.addEventMapping("pointerup",this.onPointerUp),this.addEventMapping("pointerupoutside",this.onPointerUpOutside),this.addEventMapping("wheel",this.onWheel)}addEventMapping(e,t){this.mappingTable[e]||(this.mappingTable[e]=[]),this.mappingTable[e].push({fn:t,priority:0}),this.mappingTable[e].sort((i,r)=>i.priority-r.priority)}dispatchEvent(e,t){e.propagationStopped=!1,e.propagationImmediatelyStopped=!1,this.propagate(e,t),this.dispatch.emit(t||e.type,e)}mapEvent(e){var t,i,r,o,s,l,a;if(!this.rootTarget)return;const d=this.mappingTable[e.type];let u;const h=`${e.canvasX}-${e.canvasY}`;if(!((t=this._prePointTargetCache)===null||t===void 0)&&t[h]&&(!((r=(i=this._prePointTargetCache)===null||i===void 0?void 0:i[h])===null||r===void 0)&&r.stage)&&((s=(o=this._prePointTargetCache)===null||o===void 0?void 0:o[h])===null||s===void 0?void 0:s.stage.renderCount)===((l=this._prePointTargetCache)===null||l===void 0?void 0:l.stageRenderCount)?u=this._prePointTargetCache[h]:(u=this.pickTarget(e.viewX,e.viewY,e),e.pickParams||(this._prePointTargetCache={[h]:u,stageRenderCount:(a=u==null?void 0:u.stage.renderCount)!==null&&a!==void 0?a:-1})),d)for(let c=0,g=d.length;c<g;c++)d[c].fn(e,u);else It.getInstance().warn(`[EventManager]: Event mapping not defined for ${e.type}`)}propagate(e,t){if(!e.target)return;const i=e.composedPath();e.eventPhase=e.CAPTURING_PHASE;for(let r=0,o=i.length-1;r<o;r++)if(e.currentTarget=i[r],this.notifyTarget(e,t),e.propagationStopped||e.propagationImmediatelyStopped)return;if(e.eventPhase=e.AT_TARGET,e.currentTarget=e.target,this.notifyTarget(e,t),!e.propagationStopped&&!e.propagationImmediatelyStopped){e.eventPhase=e.BUBBLING_PHASE;for(let r=i.length-2;r>=0;r--)if(e.currentTarget=i[r],this.notifyTarget(e,t),e.propagationStopped||e.propagationImmediatelyStopped)return}}propagationPath(e){const t=[e];for(let i=0;i<2048&&e!==this.rootTarget&&e.parent;i++){if(!e.parent)throw new Error("Cannot find propagation path to disconnected target");t.push(e.parent),e=e.parent}return t.reverse(),t}notifyTarget(e,t){if(this.pauseNotify)return;t=t??e.type;const i=e.eventPhase===e.CAPTURING_PHASE||e.eventPhase===e.AT_TARGET?`${t}capture`:t;this.notifyListeners(e,i),e.eventPhase===e.AT_TARGET&&this.notifyListeners(e,t)}findMountedTarget(e){if(!e)return null;let t=e[0];for(let i=1;i<e.length&&e[i].parent===t;i++)t=e[i];return t}createPointerEvent(e,t,i){var r,o;const s=this.allocateEvent(on);return this.copyPointerData(e,s),this.copyMouseData(e,s),this.copyData(e,s),s.nativeEvent=e.nativeEvent,s.originalEvent=e,s.target=i||this.pickTarget((r=s.viewX)!==null&&r!==void 0?r:s.global.x,(o=s.viewY)!==null&&o!==void 0?o:s.global.y,s),typeof t=="string"&&(s.type=t),s}createWheelEvent(e,t){var i,r;const o=this.allocateEvent(qi);return this.copyWheelData(e,o),this.copyMouseData(e,o),this.copyData(e,o),o.nativeEvent=e.nativeEvent,o.originalEvent=e,o.target=t||this.pickTarget((i=o.viewX)!==null&&i!==void 0?i:o.global.x,(r=o.viewY)!==null&&r!==void 0?r:o.global.y,o),o}clonePointerEvent(e,t){const i=this.allocateEvent(on);i.nativeEvent=e.nativeEvent,i.originalEvent=e.originalEvent,this.copyPointerData(e,i),this.copyMouseData(e,i),this.copyData(e,i),i.target=e.target,i.path=e.composedPath().slice();const r=e.composedDetailPath();return i.detailPath=r&&r.slice(),i.type=t??i.type,i}copyWheelData(e,t){t.deltaMode=e.deltaMode,t.deltaX=e.deltaX,t.deltaY=e.deltaY,t.deltaZ=e.deltaZ}copyPointerData(e,t){e instanceof on&&t instanceof on&&(t.pointerId=e.pointerId,t.width=e.width,t.height=e.height,t.isPrimary=e.isPrimary,t.pointerType=e.pointerType,t.pressure=e.pressure,t.tangentialPressure=e.tangentialPressure,t.tiltX=e.tiltX,t.tiltY=e.tiltY,t.twist=e.twist)}copyMouseData(e,t){e instanceof ha&&t instanceof ha&&(t.altKey=e.altKey,t.button=e.button,t.buttons=e.buttons,t.ctrlKey=e.ctrlKey,t.shiftKey=e.shiftKey,t.metaKey=e.metaKey,["client","movement","canvas","screen","global","offset","viewport"].forEach(i=>{t[i].x=e[i].x,t[i].y=e[i].y}))}copyData(e,t){t.isTrusted=e.isTrusted,t.srcElement=e.srcElement,t.timeStamp=wr.now(),t.type=e.type,t.detail=e.detail,t.view=e.view,t.which=e.which,t.layer.x=e.layer.x,t.layer.y=e.layer.y,t.page.x=e.page.x,t.page.y=e.page.y,t.pickParams=e.pickParams}trackingData(e){return this.mappingState.trackingData[e]||(this.mappingState.trackingData[e]={pressTargetsByButton:{},clicksByButton:{},overTarget:null}),this.mappingState.trackingData[e]}allocateEvent(e){var t;this.eventPool.has(e)||this.eventPool.set(e,[]);const i=((t=this.eventPool.get(e))===null||t===void 0?void 0:t.pop())||new e(this);return i.eventPhase=i.NONE,i.currentTarget=null,i.path=[],i.detailPath=[],i.target=null,i}freeEvent(e){var t;if(e.manager!==this)throw new Error("It is illegal to free an event not managed by this EventManager!");const i=e.constructor;this.eventPool.has(i)||this.eventPool.set(i,[]),(t=this.eventPool.get(i))===null||t===void 0||t.push(e)}notifyListeners(e,t){const i=e.currentTarget._events[t];if(i)if("fn"in i)i.once&&e.currentTarget.removeEventListener(t,i.fn,{once:!0}),i.fn.call(i.context,e);else for(let r=0,o=i.length;r<o&&!e.propagationImmediatelyStopped;r++)i[r].once&&e.currentTarget.removeEventListener(t,i[r].fn,{once:!0}),i[r].fn.call(i[r].context,e);this.emitDelegation(e,t)}emitDelegation(e,t){const i=e.currentTarget._events[f0];if(i)if("fn"in i)i.fn.call(i.context,e,t);else for(let r=0,o=i.length;r<o&&!e.propagationImmediatelyStopped;r++)i[r].fn.call(i[r].context,e,t)}pickTarget(e,t,i){let r;const o=this.rootTarget.pick(e,t);return r=o&&o.graphic?o.graphic:o&&o.group?o.group:this.rootTarget.AABBBounds.contains(e,t)?this.rootTarget:null,i&&(i.pickParams=o.params),r}release(){this.dispatch.removeAllListeners(),this.eventPool.clear(),this.rootTarget=null,this.mappingTable=null,this.mappingState=null,this.cursorTarget=null}};const aS={dispatchEvent(n){var e;if(!(n instanceof tl))throw new Error("DisplayObject cannot propagate events outside of the Federated Events API");return n.defaultPrevented=!1,n.path=[],n.detailPath&&(n.detailPath=[]),n.target=this,(e=n==null?void 0:n.manager)===null||e===void 0||e.dispatchEvent(n),!n.defaultPrevented},emit(n,e){return this.dispatchEvent(new Af(n,e))}},dS={touchstart:"pointerdown",touchend:"pointerup",touchendoutside:"pointerupoutside",touchmove:"pointermove",touchcancel:"pointercancel"};class uS{constructor(e){this.resolution=1,this.onPointerDown=u=>{if(this.supportsTouchEvents&&u.pointerType==="touch")return;const h=this.normalizeToPointerData(u);this.autoPreventDefault&&h[0].isNormalized&&(u.cancelable||!("cancelable"in u))&&u.preventDefault();for(let c=0,g=h.length;c<g;c++){const f=h[c],p=this.bootstrapEvent(this.rootPointerEvent,f);this.manager.mapEvent(p)}this.setCursor(this.manager.cursor,this.manager.cursorTarget),this.rootPointerEvent.nativeEvent=null},this.onPointerMove=u=>{if(this.supportsTouchEvents&&u.pointerType==="touch"||this.isEventOutsideOfTargetElement(u))return;const h=this.normalizeToPointerData(u);for(let c=0,g=h.length;c<g;c++){const f=this.bootstrapEvent(this.rootPointerEvent,h[c]);this.manager.mapEvent(f)}this.setCursor(this.manager.cursor,this.manager.cursorTarget),this.rootPointerEvent.nativeEvent=null},this.onPointerUp=u=>{if(this.supportsTouchEvents&&u.pointerType==="touch")return;const h=this.isEventOutsideOfTargetViewPort(u)?"outside":"",c=this.normalizeToPointerData(u);for(let g=0,f=c.length;g<f;g++){const p=this.bootstrapEvent(this.rootPointerEvent,c[g]);p.type+=h,this.manager.mapEvent(p)}this.setCursor(this.manager.cursor,this.manager.cursorTarget),this.rootPointerEvent.nativeEvent=null},this.onPointerOverOut=u=>{if(this.supportsTouchEvents&&u.pointerType==="touch")return;const h=this.normalizeToPointerData(u);for(let c=0,g=h.length;c<g;c++){const f=this.bootstrapEvent(this.rootPointerEvent,h[c]);this.manager.mapEvent(f)}this.setCursor(this.manager.cursor,this.manager.cursorTarget),this.rootPointerEvent.nativeEvent=null},this.onWheel=u=>{const h=this.normalizeWheelEvent(u);this.manager.mapEvent(h)};const{targetElement:t,resolution:i,rootNode:r,global:o,autoPreventDefault:s=!1,clickInterval:l,supportsTouchEvents:a=o.supportsTouchEvents,supportsPointerEvents:d=o.supportsPointerEvents}=e;this.manager=new lS(r,{clickInterval:l,supportsTouchEvents:a}),this.globalObj=o,this.supportsPointerEvents=d,this.supportsTouchEvents=a,this.supportsMouseEvents=o.supportsMouseEvents,this.applyStyles=o.applyStyles,this.autoPreventDefault=s,this.eventsAdded=!1,this.rootPointerEvent=new on,this.rootWheelEvent=new qi,this.cursorStyles={default:"inherit",pointer:"pointer"},this.resolution=i,this.setTargetElement(t)}release(){this.removeEvents(),this.manager&&this.manager.release(),this.domElement=null,this.manager=null,this.globalObj=null}setCursor(e,t){if(!t&&!this.manager.rootTarget.window._handler.canvas.controled)return;e||(e="default");const{applyStyles:i,domElement:r}=this;if(this.currentCursor===e)return;this.currentCursor=e;const o=this.cursorStyles[e];o?typeof o=="string"&&i?r.style.cursor=o:typeof o=="function"?o(e):typeof o=="object"&&i&&Object.assign(r.style,o):i&&je(e)&&!E_(this.cursorStyles,e)&&(r.style.cursor=e)}setTargetElement(e){this.removeEvents(),this.domElement=e,this.addEvents()}addEvents(){if(this.eventsAdded||!this.domElement)return;const{globalObj:e,domElement:t}=this;this.supportsPointerEvents?(e.getDocument()?(e.getDocument().addEventListener("pointermove",this.onPointerMove,!0),e.getDocument().addEventListener("pointerup",this.onPointerUp,!0)):(t.addEventListener("pointermove",this.onPointerMove,!0),t.addEventListener("pointerup",this.onPointerUp,!0)),t.addEventListener("pointerdown",this.onPointerDown,!0),t.addEventListener("pointerleave",this.onPointerOverOut,!0),t.addEventListener("pointerover",this.onPointerOverOut,!0)):(e.getDocument()?(e.getDocument().addEventListener("mousemove",this.onPointerMove,!0),e.getDocument().addEventListener("mouseup",this.onPointerUp,!0)):(t.addEventListener("mousemove",this.onPointerMove,!0),t.addEventListener("mouseup",this.onPointerUp,!0)),t.addEventListener("mousedown",this.onPointerDown,!0),t.addEventListener("mouseout",this.onPointerOverOut,!0),t.addEventListener("mouseover",this.onPointerOverOut,!0)),this.supportsTouchEvents&&(t.addEventListener("touchstart",this.onPointerDown,!0),t.addEventListener("touchend",this.onPointerUp,!0),t.addEventListener("touchmove",this.onPointerMove,!0)),t.addEventListener("wheel",this.onWheel,{capture:!0}),this.eventsAdded=!0}removeEvents(){if(!this.eventsAdded||!this.domElement)return;const{globalObj:e,domElement:t}=this;this.supportsPointerEvents?(e.getDocument()?(e.getDocument().removeEventListener("pointermove",this.onPointerMove,!0),e.getDocument().removeEventListener("pointerup",this.onPointerUp,!0)):(t.removeEventListener("pointermove",this.onPointerMove,!0),t.removeEventListener("pointerup",this.onPointerUp,!0)),t.removeEventListener("pointerdown",this.onPointerDown,!0),t.removeEventListener("pointerleave",this.onPointerOverOut,!0),t.removeEventListener("pointerover",this.onPointerOverOut,!0)):(e.getDocument()?(e.getDocument().removeEventListener("mousemove",this.onPointerMove,!0),e.getDocument().removeEventListener("mouseup",this.onPointerUp,!0)):(t.removeEventListener("mousemove",this.onPointerMove,!0),t.removeEventListener("mouseup",this.onPointerUp,!0)),t.removeEventListener("mousedown",this.onPointerDown,!0),t.removeEventListener("mouseout",this.onPointerOverOut,!0),t.removeEventListener("mouseover",this.onPointerOverOut,!0)),this.supportsTouchEvents&&(t.removeEventListener("touchstart",this.onPointerDown,!0),t.removeEventListener("touchend",this.onPointerUp,!0),t.removeEventListener("touchmove",this.onPointerMove,!0)),t.removeEventListener("wheel",this.onWheel,!0),this.domElement=null,this.eventsAdded=!1}mapToViewportPoint(e){return this.domElement.pointTransform?this.domElement.pointTransform(e.x,e.y):e}mapToCanvasPoint(e){var t,i;const r=(t=this.globalObj)===null||t===void 0?void 0:t.mapToCanvasPoint(e,this.domElement);if(r)return r;let o=0,s=0;if(e.changedTouches){const a=(i=e.changedTouches[0])!==null&&i!==void 0?i:{};o=a.clientX||0,s=a.clientY||0}else o=e.clientX||0,s=e.clientY||0;const l=this.domElement.getBoundingClientRect();return{x:o-l.left,y:s-l.top}}normalizeToPointerData(e){const t=[];if(this.supportsTouchEvents&&e.changedTouches&&e.changedTouches.length)for(let i=0,r=e.changedTouches.length;i<r;i++){const o=e.changedTouches[i];nt(o.button)&&(o.button=0),nt(o.buttons)&&(o.buttons=1),nt(o.isPrimary)&&(o.isPrimary=e.touches.length===1&&e.type==="touchstart"),nt(o.width)&&(o.width=o.radiusX||1),nt(o.height)&&(o.height=o.radiusY||1),nt(o.tiltX)&&(o.tiltX=0),nt(o.tiltY)&&(o.tiltY=0),nt(o.pointerType)&&(o.pointerType="touch"),nt(o.pointerId)&&(o.pointerId=o.identifier||0),nt(o.pressure)&&(o.pressure=o.force||.5),nt(o.twist)&&(o.twist=0),nt(o.tangentialPressure)&&(o.tangentialPressure=0),nt(o.layerX)&&(o.layerX=o.offsetX=o.clientX),nt(o.layerY)&&(o.layerY=o.offsetY=o.clientY),o.isNormalized=!0,o.type=e.type,t.push(o)}else if(this.globalObj.supportsMouseEvents&&(!(e instanceof MouseEvent)||this.supportsPointerEvents&&e instanceof PointerEvent))t.push(e);else{const i=e;nt(i.isPrimary)&&(i.isPrimary=!0),nt(i.width)&&(i.width=1),nt(i.height)&&(i.height=1),nt(i.tiltX)&&(i.tiltX=0),nt(i.tiltY)&&(i.tiltY=0),nt(i.pointerType)&&(i.pointerType="mouse"),nt(i.pointerId)&&(i.pointerId=1),nt(i.pressure)&&(i.pressure=.5),nt(i.twist)&&(i.twist=0),nt(i.tangentialPressure)&&(i.tangentialPressure=0),i.isNormalized=!0,t.push(i)}return t}normalizeWheelEvent(e){const t=this.rootWheelEvent;this.transferMouseData(t,e),t.deltaMode=e.deltaMode,t.deltaX=e.deltaX,t.deltaY=e.deltaY,t.deltaZ=e.deltaZ;const{x:i,y:r}=this.mapToCanvasPoint(e);t.canvas.x=i,t.canvas.y=r,t.global.x=i,t.global.y=r,t.offset.x=i,t.offset.y=r;const{x:o,y:s}=this.mapToViewportPoint(t);return t.viewport.x=o,t.viewport.y=s,t.nativeEvent=e,t.type=e.type,t}bootstrapEvent(e,t){e.originalEvent=null,e.nativeEvent=t,e.pointerId=t.pointerId,e.width=t.width,e.height=t.height,e.isPrimary=t.isPrimary,e.pointerType=t.pointerType,e.pressure=t.pressure,e.tangentialPressure=t.tangentialPressure,e.tiltX=t.tiltX,e.tiltY=t.tiltY,e.twist=t.twist,this.transferMouseData(e,t);const{x:i,y:r}=this.mapToCanvasPoint(t);e.canvas.x=i,e.canvas.y=r,e.global.x=i,e.global.y=r,e.offset.x=i,e.offset.y=r;const{x:o,y:s}=this.mapToViewportPoint(e);return e.viewport.x=o,e.viewport.y=s,e.isTrusted=t.isTrusted,e.type==="pointerleave"&&(e.type="pointerout"),e.type.startsWith("mouse")&&(e.type=e.type.replace("mouse","pointer")),e.type.startsWith("touch")&&(e.type=dS[e.type]||e.type),e}transferMouseData(e,t){e.isTrusted=t.isTrusted,e.srcElement=t.srcElement,e.timeStamp=wr.now(),e.type=t.type,e.altKey=t.altKey,e.button=t.button,e.buttons=t.buttons,e.client.x=t.clientX,e.client.y=t.clientY,e.ctrlKey=t.ctrlKey,e.shiftKey=t.shiftKey,e.metaKey=t.metaKey,e.movement.x=t.movementX,e.movement.y=t.movementY,e.page.x=t.pageX,e.page.y=t.pageY,e.relatedTarget=null}isEventOutsideOfTargetViewPort(e){if(this.isEventOutsideOfTargetElement(e))return!0;if(this.domElement.getViewBox){const t=this.mapToViewportPoint(this.mapToCanvasPoint(e)),i=this.domElement.getViewBox(),r=i.width(),o=i.height();return!(t.x<r&&t.y<o&&t.x>0&&t.y>0)}return!1}isEventOutsideOfTargetElement(e){let t=e.target;return e.composedPath&&e.composedPath().length>0&&(t=e.composedPath()[0]),t!==(this.domElement.getNativeHandler?this.domElement.getNativeHandler().nativeCanvas:this.domElement)}pauseTriggerEvent(){this.manager.pauseNotify=!0}resumeTriggerEvent(){this.manager.pauseNotify=!1}}var rn;(function(n){n[n.INITIAL=0]="INITIAL",n[n.RUNNING=1]="RUNNING",n[n.PAUSE=2]="PAUSE"})(rn||(rn={}));class ps{static Avaliable(){return!!U.global.getRequestAnimationFrame()}avaliable(){return ps.Avaliable()}tick(e,t){U.global.getRequestAnimationFrame()(()=>{this.released||t(this)})}release(){this.released=!0}getTime(){return Date.now()}}class ca{static Avaliable(){return!0}avaliable(){return ca.Avaliable()}tick(e,t){this.timerId=setTimeout(()=>{t(this)},e)}release(){this.timerId>0&&(clearTimeout(this.timerId),this.timerId=-1)}getTime(){return Date.now()}}class g0 extends Lo{set mode(e){this._mode!==e&&(this._mode=e,this.setupTickHandler())}get mode(){return this._mode}constructor(e=[]){super(),this.handleTick=(t,i)=>{const{once:r=!1}=i??{};this.ifCanStop()?this.stop():(this._handlerTick(),r||t.tick(this.interval,this.handleTick))},this._handlerTick=()=>{const t=this.tickerHandler.getTime();let i=0;this.lastFrameTime>=0&&(i=t-this.lastFrameTime),this.lastFrameTime=t,this.status===rn.RUNNING&&(this.tickCounts++,this.timelines.forEach(r=>{r.tick(i)}),this.emit("afterTick"))},this.init(),this.lastFrameTime=-1,this.tickCounts=0,this.timelines=e,this.autoStop=!0}init(){this.interval=NaN,this.status=rn.INITIAL,U.global.hooks.onSetEnv.tap("default-ticker",()=>{this.initHandler()}),U.global.env&&this.initHandler()}addTimeline(e){this.timelines.push(e)}remTimeline(e){this.timelines=this.timelines.filter(t=>t!==e)}initHandler(){if(this._mode)return null;const e=[{mode:"raf",cons:ps},{mode:"timeout",cons:ca}];for(let t=0;t<e.length;t++)if(e[t].cons.Avaliable()){this.mode=e[t].mode;break}return null}setupTickHandler(){let e;switch(this._mode){case"raf":e=new ps;break;case"timeout":e=new ca;break;default:It.getInstance().warn("非法的计时器模式"),e=new ps}return!!e.avaliable()&&(this.tickerHandler&&this.tickerHandler.release(),this.tickerHandler=e,!0)}setInterval(e){this.interval=e}getInterval(){return this.interval}setFPS(e){this.setInterval(1e3/e)}getFPS(){return 1e3/this.interval}tick(e){this.tickerHandler.tick(e,t=>{this.handleTick(t,{once:!0})})}tickTo(e){this.tickerHandler.tickTo&&this.tickerHandler.tickTo(e,t=>{this.handleTick(t,{once:!0})})}pause(){return this.status!==rn.INITIAL&&(this.status=rn.PAUSE,!0)}resume(){return this.status!==rn.INITIAL&&(this.status=rn.RUNNING,!0)}ifCanStop(){return!!(this.autoStop&&(!this.timelines.length||this.timelines.reduce((e,t)=>e+t.animateCount,0)===0))}start(e=!1){return this.status===rn.RUNNING||!this.tickerHandler||!e&&(this.status===rn.PAUSE||!this.timelines.length||this.timelines.reduce((t,i)=>t+i.animateCount,0)===0)?!1:(this.status=rn.RUNNING,this.tickerHandler.tick(0,this.handleTick),!0)}stop(){this.status=rn.INITIAL,this.setupTickHandler(),this.lastFrameTime=-1}trySyncTickStatus(){this.status===rn.RUNNING&&this._handlerTick()}}class Re{constructor(){}static linear(e){return e}static none(){return this.linear}static get(e){return e<-1?e=-1:e>1&&(e=1),function(t){return e===0?t:e<0?t*(t*-e+1+e):t*((2-t)*e+(1-e))}}static getPowIn(e){return function(t){return Math.pow(t,e)}}static getPowOut(e){return function(t){return 1-Math.pow(1-t,e)}}static getPowInOut(e){return function(t){return(t*=2)<1?.5*Math.pow(t,e):1-.5*Math.abs(Math.pow(2-t,e))}}static getBackIn(e){return function(t){return t*t*((e+1)*t-e)}}static getBackOut(e){return function(t){return--t*t*((e+1)*t+e)+1}}static getBackInOut(e){return e*=1.525,function(t){return(t*=2)<1?t*t*((e+1)*t-e)*.5:.5*((t-=2)*t*((e+1)*t+e)+2)}}static sineIn(e){return 1-Math.cos(e*Math.PI/2)}static sineOut(e){return Math.sin(e*Math.PI/2)}static sineInOut(e){return-(Math.cos(Math.PI*e)-1)/2}static expoIn(e){return e===0?0:Math.pow(2,10*e-10)}static expoOut(e){return e===1?1:1-Math.pow(2,-10*e)}static expoInOut(e){return e===0?0:e===1?1:e<.5?Math.pow(2,20*e-10)/2:(2-Math.pow(2,-20*e+10))/2}static circIn(e){return-(Math.sqrt(1-e*e)-1)}static circOut(e){return Math.sqrt(1- --e*e)}static circInOut(e){return(e*=2)<1?-.5*(Math.sqrt(1-e*e)-1):.5*(Math.sqrt(1-(e-=2)*e)+1)}static bounceOut(e){return e<1/2.75?7.5625*e*e:e<2/2.75?7.5625*(e-=1.5/2.75)*e+.75:e<2.5/2.75?7.5625*(e-=2.25/2.75)*e+.9375:7.5625*(e-=2.625/2.75)*e+.984375}static bounceIn(e){return 1-Re.bounceOut(1-e)}static bounceInOut(e){return e<.5?.5*Re.bounceIn(2*e):.5*Re.bounceOut(2*e-1)+.5}static getElasticIn(e,t){return function(i){if(i===0||i===1)return i;const r=t/Ge*Math.asin(1/e);return-e*Math.pow(2,10*(i-=1))*Math.sin((i-r)*Ge/t)}}static getElasticOut(e,t){return function(i){if(i===0||i===1)return i;const r=t/Ge*Math.asin(1/e);return e*Math.pow(2,-10*i)*Math.sin((i-r)*Ge/t)+1}}static getElasticInOut(e,t){return function(i){const r=t/Ge*Math.asin(1/e);return(i*=2)<1?e*Math.pow(2,10*(i-=1))*Math.sin((i-r)*Ge/t)*-.5:e*Math.pow(2,-10*(i-=1))*Math.sin((i-r)*Ge/t)*.5+1}}}Re.quadIn=Re.getPowIn(2),Re.quadOut=Re.getPowOut(2),Re.quadInOut=Re.getPowInOut(2),Re.cubicIn=Re.getPowIn(3),Re.cubicOut=Re.getPowOut(3),Re.cubicInOut=Re.getPowInOut(3),Re.quartIn=Re.getPowIn(4),Re.quartOut=Re.getPowOut(4),Re.quartInOut=Re.getPowInOut(4),Re.quintIn=Re.getPowIn(5),Re.quintOut=Re.getPowOut(5),Re.quintInOut=Re.getPowInOut(5),Re.backIn=Re.getBackIn(1.7),Re.backOut=Re.getBackOut(1.7),Re.backInOut=Re.getBackInOut(1.7),Re.elasticIn=Re.getElasticIn(1,.3),Re.elasticOut=Re.getElasticOut(1,.3),Re.elasticInOut=Re.getElasticInOut(1,.3*1.5);class Bf{constructor(){this.id=pt.GenAutoIncrementId(),this.animateHead=null,this.animateTail=null,this.animateCount=0,this.paused=!1}addAnimate(e){this.animateTail?(this.animateTail.nextAnimate=e,e.prevAnimate=this.animateTail,this.animateTail=e,e.nextAnimate=null):(this.animateHead=e,this.animateTail=e),this.animateCount++}pause(){this.paused=!0}resume(){this.paused=!1}tick(e){if(this.paused)return;let t=this.animateHead;for(this.animateCount=0;t;)t.status===Ft.END?this.removeAnimate(t):t.status===Ft.RUNNING||t.status===Ft.INITIAL?(this.animateCount++,t.advance(e)):t.status===Ft.PAUSED&&this.animateCount++,t=t.nextAnimate}clear(){let e=this.animateHead;for(;e;)e.release(),e=e.nextAnimate;this.animateHead=null,this.animateTail=null,this.animateCount=0}removeAnimate(e,t=!0){e._onRemove&&e._onRemove.forEach(i=>i()),e===this.animateHead?(this.animateHead=e.nextAnimate,e===this.animateTail?this.animateTail=null:this.animateHead.prevAnimate=null):e===this.animateTail?(this.animateTail=e.prevAnimate,this.animateTail.nextAnimate=null):(e.prevAnimate.nextAnimate=e.nextAnimate,e.nextAnimate.prevAnimate=e.prevAnimate),t&&e.release()}}const p0=new Bf;class m0{constructor(e,t,i,r,o){this.from=e,this.to=t,this.duration=i,this.easing=r,this.params=o,this.updateCount=0}bind(e,t){this.target=e,this.subAnimate=t,this.onBind()}onBind(){}onFirstRun(){}onStart(){}onEnd(){}getEndProps(){return this.to}getFromProps(){return this.from}getMergedEndProps(){var e;const t=this.getEndProps();return t?this._endProps===t?this._mergedEndProps:(this._endProps=t,void(this._mergedEndProps=Object.assign({},(e=this.step.prev.getLastProps())!==null&&e!==void 0?e:{},t))):this.step.prev?this.step.prev.getLastProps():t}update(e,t,i){if(this.updateCount===0){this.onFirstRun();const r=this.step.getLastProps();Object.keys(r).forEach(o=>{this.subAnimate.animate.validAttr(o)&&(i[o]=r[o])})}this.updateCount+=1,this.onUpdate(e,t,i),e&&this.onEnd()}}class hS extends m0{constructor(e){super(null,null,0,"linear"),this.cb=e}onUpdate(e,t,i){}onStart(){this.cb()}}class wi{constructor(e=pt.GenAutoIncrementId(),t=p0,i){this.id=e,this.timeline=t,this.status=Ft.INITIAL,this.tailAnimate=new Ig(this),this.subAnimates=[this.tailAnimate],this.timeScale=1,this.rawPosition=-1,this._startTime=0,this._duringTime=0,this.timeline.addAnimate(this),this.slience=i}setTimeline(e){e!==this.timeline&&(this.timeline.removeAnimate(this,!1),e.addAnimate(this))}getStartTime(){return this._startTime}getDuration(){return this.subAnimates.reduce((e,t)=>e+t.totalDuration,0)}after(e){const t=e.getDuration();return this._startTime=t,this}afterAll(e){let t=-1/0;return e.forEach(i=>{t=Ji(i.getDuration(),t)}),this._startTime=t,this}parallel(e){return this._startTime=e.getStartTime(),this}static AddInterpolate(e,t){wi.interpolateMap.set(e,t)}play(e){if(this.tailAnimate.play(e),this.target){const t=this.target.stage;t&&t.renderNextFrame()}return this.subAnimates.length===1&&this.tailAnimate.totalDuration===e.duration&&this.trySetAttribute(e.getFromProps(),e.mode),this}trySetAttribute(e,t=wi.mode){e&&t&la.SET_ATTR_IMMEDIATELY&&this.target.setAttributes&&this.target.setAttributes(e,!1,{type:Yt.ANIMATE_PLAY})}runCb(e){const t=new hS(()=>{e(this,t.step.prev)});return this.tailAnimate.play(t),this}customInterpolate(e,t,i,r,o,s){const l=wi.interpolateMap.get(e)||wi.interpolateMap.get("");return!!l&&l(e,t,i,r,o,s)}pause(){this.status===Ft.RUNNING&&(this.status=Ft.PAUSED)}resume(){this.status===Ft.PAUSED&&(this.status=Ft.RUNNING)}to(e,t,i,r){if(this.tailAnimate.to(e,t,i,r),this.target){const o=this.target.stage;o&&o.renderNextFrame()}return this}from(e,t,i,r){if(this.tailAnimate.from(e,t,i,r),this.target){const o=this.target.stage;o&&o.renderNextFrame()}return this}wait(e){if(this.tailAnimate.wait(e),this.target){const t=this.target.stage;t&&t.renderNextFrame()}return this}startAt(e){if(this.tailAnimate.startAt(e),this.target){const t=this.target.stage;t&&t.renderNextFrame()}return this}loop(e){if(this.tailAnimate.loop=e,this.target){const t=this.target.stage;t&&t.renderNextFrame()}return this}reversed(e){if(this.tailAnimate.reversed=e,this.target){const t=this.target.stage;t&&t.renderNextFrame()}return this}bounce(e){if(this.tailAnimate.bounce=e,this.target){const t=this.target.stage;t&&t.renderNextFrame()}return this}subAnimate(){const e=new Ig(this,this.tailAnimate);return this.tailAnimate=e,this.subAnimates.push(e),e.bind(this.target),this}getStartProps(){return this.subAnimates[0].getStartProps()}getEndProps(){return this.tailAnimate.getEndProps()}depreventAttr(e){this._preventAttrs&&this._preventAttrs.delete(e)}preventAttr(e){this._preventAttrs||(this._preventAttrs=new Set),this._preventAttrs.add(e)}preventAttrs(e){e.forEach(t=>this.preventAttr(t))}validAttr(e){return!this._preventAttrs||!this._preventAttrs.has(e)}bind(e){return this.target=e,this.target.onAnimateBind&&!this.slience&&this.target.onAnimateBind(this),this.subAnimates.forEach(t=>{t.bind(e)}),this}advance(e){if(this._duringTime<this._startTime){if(this._duringTime+e*this.timeScale<this._startTime)return void(this._duringTime+=e*this.timeScale);e=this._duringTime+e*this.timeScale-this._startTime,this._duringTime=this._startTime}this.status===Ft.INITIAL&&(this.status=Ft.RUNNING,this._onStart&&this._onStart.forEach(t=>t())),this.setPosition(Math.max(this.rawPosition,0)+e*this.timeScale)&&this.status===Ft.RUNNING&&(this.status=Ft.END,this._onEnd&&this._onEnd.forEach(t=>t()))}setPosition(e){let t,i=0;const r=this.rawPosition,o=this.subAnimates.reduce((l,a)=>l+a.totalDuration,0);e<0&&(e=0);const s=e>=o;if(s&&(e=o),e===r)return s;for(let l=0;l<this.subAnimates.length&&(t=this.subAnimates[l],!(i+t.totalDuration>=e));l++)i+=t.totalDuration,t=void 0;return this.rawPosition=e,t.setPosition(e-i),s}onStart(e){this._onStart||(this._onStart=[]),this._onStart.push(e)}onEnd(e){this._onEnd||(this._onEnd=[]),this._onEnd.push(e)}onRemove(e){this._onRemove||(this._onRemove=[]),this._onRemove.push(e)}onFrame(e){this._onFrame||(this._onFrame=[]),this._onFrame.push(e)}release(){this.status=Ft.END}stop(e){e||this.target.onStop(),e==="start"?this.target.onStop(this.getStartProps()):e==="end"?this.target.onStop(this.getEndProps()):this.target.onStop(e),this.release()}}wi.mode=la.NORMAL,wi.interpolateMap=new Map;class Ig{get totalDuration(){return this.calcAttr(),this._totalDuration+this._startAt}constructor(e,t){this.rawPosition=-1,this.position=0,this.loop=0,this.duration=0,this.animate=e,this.stepHead=new Og(0,0,t?Object.assign({},t.stepTail.props):{}),this.stepTail=this.stepHead,this.dirty=!0,this._startAt=0}calcAttr(){this.dirty&&(this._totalDuration=this.duration*(this.loop+1))}bind(e){return this.target=e,this}play(e){let t=e.duration;(t==null||t<0)&&(t=0);const i=e.easing,r=typeof i=="string"?Re[i]:i,o=this._addStep(t,null,r);return o.type=eo.customAnimate,this._appendProps(e.getEndProps(),o,!1),this._appendCustomAnimate(e,o),this}to(e,t,i,r){(t==null||t<0)&&(t=0);const o=typeof i=="string"?Re[i]:i,s=this._addStep(t,null,o);return s.type=eo.to,this._appendProps(e,s,!!r&&r.tempProps),s.propKeys||(s.propKeys=Object.keys(s.props)),r&&r.noPreventAttrs||this.target.animates.forEach(l=>{l.id!==this.animate.id&&l.preventAttrs(s.propKeys)}),this}from(e,t,i,r){this.to(e,0,i,r);const o={};this.stepTail.propKeys||(this.stepTail.propKeys=Object.keys(this.stepTail.props)),this.stepTail.propKeys.forEach(s=>{o[s]=this.getLastPropByName(s,this.stepTail)}),this.to(o,t,i,r),this.stepTail.type=eo.from}startAt(e){return e<0&&(e=0),this._startAt=e,this}getStartProps(){var e;return(e=this.stepHead)===null||e===void 0?void 0:e.props}getEndProps(){return this.stepTail.props}getLastStep(){return this._lastStep}wait(e){if(e>0){const t=this._addStep(+e,null);t.type=eo.wait,t.prev.customAnimate?t.props=t.prev.customAnimate.getEndProps():t.props=t.prev.props,this.target.onAddStep&&this.target.onAddStep(t)}return this}_addStep(e,t,i){const r=new Og(this.duration,e,t,i);return this.duration+=e,this.stepTail.append(r),this.stepTail=r,r}_appendProps(e,t,i){t.props=i?e:Object.assign({},e);let r=t.prev;const o=t.props;for(t.propKeys||(t.propKeys=Object.keys(t.props)),t.propKeys.forEach(l=>{t.props[l]===void 0&&(t.props[l]=this.target.getDefaultAttribute(l))});r.prev;)r.props&&(r.propKeys||(r.propKeys=Object.keys(r.props)),r.propKeys.forEach(l=>{o[l]===void 0&&(o[l]=r.props[l])})),t.propKeys=Object.keys(t.props),r=r.prev;const s=this.stepHead.props;t.propKeys||(t.propKeys=Object.keys(o)),t.propKeys.forEach(l=>{if(s[l]===void 0){const a=this.animate.getStartProps();s[l]=a[l]=this.target.getComputedAttribute(l)}}),this.target.onAddStep&&this.target.onAddStep(t)}_appendCustomAnimate(e,t){t.customAnimate=e,e.step=t,e.bind(this.target,this)}setPosition(e){var t;const i=this.duration,r=this.loop,o=this.rawPosition;let s,l,a=!1;const d=(t=this._startAt)!==null&&t!==void 0?t:0;if(e<0&&(e=0),e<d)return this.rawPosition=e,!1;if(e-=d,i<=0&&(a=!0,i<0)||(s=Math.floor(e/i),l=e-s*i,a=e>=r*i+i,a&&(l=i,s=r,e=l*s+i),e===o))return a;const u=!this.reversed!=!(this.bounce&&s%2);return u&&(l=i-l),this._deltaPosition=l-this.position,this.position=l,this.rawPosition=e+d,this.updatePosition(a,u),a}updatePosition(e,t){if(!this.stepHead)return;let i=this.stepHead.next;const r=this.position,o=this.duration;if(this.target&&i){let s=i.next;for(;s&&s.position<=r;)i=s,s=i.next;let l=e?o===0?1:r/o:(r-i.position)/i.duration;i.easing&&(l=i.easing(l)),this.tryCallCustomAnimateLifeCycle(i,this._lastStep||(t?this.stepTail:this.stepHead),t),this.updateTarget(i,l,e),this._lastStep=i,this.animate._onFrame&&this.animate._onFrame.forEach(a=>a(i,l))}}tryCallCustomAnimateLifeCycle(e,t,i){if(e!==t)if(i){let r=t.prev;for(;r&&r!==e;)r.customAnimate&&(r.customAnimate.onStart&&r.customAnimate.onStart(),r.customAnimate.onEnd&&r.customAnimate.onEnd()),r=e.prev;t&&t.customAnimate&&t.customAnimate.onEnd&&t.customAnimate.onEnd(),e&&e.customAnimate&&e.customAnimate.onStart&&e.customAnimate.onStart()}else{let r=t.next;for(;r&&r!==e;)r.customAnimate&&(r.customAnimate.onStart&&r.customAnimate.onStart(),r.customAnimate.onEnd&&r.customAnimate.onEnd()),r=r.next;t&&t.customAnimate&&t.customAnimate.onEnd&&t.customAnimate.onEnd(),e&&e.customAnimate&&e.customAnimate.onStart&&e.customAnimate.onStart()}}getLastPropByName(e,t){let i=t.prev;for(;i;){if(i.props&&i.props[e]!==void 0)return i.props[e];if(i.customAnimate){const r=i.customAnimate.getEndProps()[e];if(r!==void 0)return r}i=i.prev}return It.getInstance().warn("未知错误，step中找不到属性"),t.props[e]}updateTarget(e,t,i){e.props==null&&e.customAnimate==null||this.target.onStep(this,this.animate,e,t,i)}}class Og{constructor(e,t,i,r){this.duration=t,this.position=e,this.props=i,this.easing=r}append(e){e.prev=this,e.next=this.next,this.next=e}getLastProps(){let e=this.prev;for(;e;){if(e.props)return e.props;if(e.customAnimate)return e.customAnimate.getMergedEndProps();e=e.prev}return null}}const Dg={duration:200,easing:"cubicOut"};var Wg;(function(n){n[n.Top=1]="Top",n[n.Right=2]="Right",n[n.Bottom=4]="Bottom",n[n.Left=8]="Left",n[n.ALL=15]="ALL"})(Wg||(Wg={}));const di=[!1,!1,!1,!1],cS=n=>{var e;let t=!0;if(kt(n,!0)){for(let i=0;i<4;i++)di[i]=n,t&&(t=!((e=di[i])!==null&&e!==void 0&&!e));t=n}else if(Array.isArray(n))for(let i=0;i<4;i++)di[i]=!!n[i],t&&(t=!!di[i]);else di[0]=!1,di[1]=!1,di[2]=!1,di[3]=!1;return{isFullStroke:t,stroke:di}},Ko=[0,0,0,0],fa=n=>n?ee(n)?n.length===0?0:n.length===1?n[0]:n.length===2?(Ko[0]=n[0],Ko[2]=n[0],Ko[1]=n[1],Ko[3]=n[1],Ko):n:n:0,Wr=[{x:0,y:0},{x:0,y:0},{x:0,y:0},{x:0,y:0}],Sl=[1,2,3,0,1,2,3,0];function Fh(n,e,t,i){for(;n>=Ge;)n-=Ge;for(;n<0;)n+=Ge;for(;n>e;)e+=Ge;Wr[0].x=t,Wr[1].y=t,Wr[2].x=-t,Wr[3].y=-t;const r=Math.ceil(n/Vi)%4,o=Math.ceil(e/Vi)%4;if(i.add(mt(n)*t,it(n)*t),i.add(mt(e)*t,it(e)*t),r!==o||e-n>qe){let s=!1;for(let l=0;l<Sl.length;l++)if(s||r!==Sl[l]){if(s&&o===Sl[l])break;if(s){const a=Wr[Sl[l]];i.add(a.x,a.y)}}else{s=!0;const a=Wr[r];i.add(a.x,a.y)}}}function Ng(n,e,t){const{x:i,y:r}=cg(n.x,n.y,e.x,e.y,t),{x:o,y:s}=cg(n.x1,n.y1,e.x1,e.y1,t),l=new St(i,r,o,s);return l.defined=e.defined,l}function b0(n,e,t){if(!n||!e)return[];Array.isArray(n)||(n=[n]),Array.isArray(e)||(e=[e]);let i=[];if(n.length>e.length){i=e.map(r=>{const o=new St(r.x,r.y,r.x1,r.y1);return o.defined=r.defined,o});for(let r=0;r<e.length;r++)i[r]=Ng(n[r],e[r],t)}else{i=e.map(r=>{const o=new St(r.x,r.y,r.x1,r.y1);return o.defined=r.defined,o});for(let r=0;r<n.length;r++)i[r]=Ng(n[r],e[r],t)}return i}function xl(n,e){if(ee(n)){let t;for(let i=0;i<n.length&&t===void 0;i++)t=n[i][e];return t}return n[e]}class qd{constructor(e=qd.TimeOut){this.durations=[],this.timeout=e,this.lastDate=0,this.durationsListThreshold=30}call(e){return this.lastDate=Date.now(),setTimeout(()=>{this.appendDuration(Date.now()-this.lastDate),e(0)},this.timeout,!0)}clear(e){clearTimeout(e)}appendDuration(e){this.durations.push(e),this.durations.length>this.durationsListThreshold&&this.durations.shift(),this.timeout=Math.min(Math.max(this.durations.reduce((t,i)=>t+i,0)/this.durations.length,1e3/60),1e3/30)}}qd.TimeOut=1e3/60;const Vg=new qd,fS=(n,e)=>je(n)&&n[n.length-1]==="%"?e*(Number.parseFloat(n.substring(0,n.length-1))/100):n,nl=(n,e)=>{const t=fS(n,e);return isNaN(t)?t:Math.max(e,t)},gS=n=>{if(!n)return{x:0,y:0,width:0,height:0};let e=Te(n.width)?n.x1-n.x:n.width,t=Te(n.height)?n.y1-n.y:n.height,i=0,r=0;return e<0?(i=e,e=-e):Number.isNaN(e)&&(e=0),t<0?(r=t,t=-t):Number.isNaN(t)&&(t=0),{x:i,y:r,width:e,height:t}};var Si;(function(n){n[n.Color255=0]="Color255",n[n.Color1=1]="Color1"})(Si||(Si={}));class wt{static Get(e,t=Si.Color1,i=[0,0,0,1]){if(t===Si.Color1){const s=wt.store1[e];if(s)return i[0]=s[0],i[1]=s[1],i[2]=s[2],i[3]=s[3],i;const l=fg.parseColorString(e);if(l){const a=[l.r/255,l.g/255,l.b/255,l.opacity];wt.store1[e]=a,wt.store255[e]=[l.r,l.g,l.b,l.opacity],i[0]=a[0],i[1]=a[1],i[2]=a[2],i[3]=a[3]}return i}const r=wt.store255[e];if(r)return i[0]=r[0],i[1]=r[1],i[2]=r[2],i[3]=r[3],i;const o=fg.parseColorString(e);return o&&(wt.store1[e]=[o.r/255,o.g/255,o.b/255,o.opacity],wt.store255[e]=[o.r,o.g,o.b,o.opacity],i[0]=o.r,i[1]=o.g,i[2]=o.b,i[3]=o.opacity),i}static Set(e,t,i){if(t===Si.Color1){if(wt.store1[e])return;wt.store1[e]=i,wt.store255[e]=[Math.floor(255*i[0]),Math.floor(255*i[1]),Math.floor(255*i[2]),Math.floor(255*i[3])]}else{if(wt.store255[e])return;wt.store255[e]=i,wt.store1[e]=[i[0]/255,i[1]/255,i[2]/255,i[3]]}}}wt.store255={},wt.store1={};function Rl(n,e=!1){return Array.isArray(n)&&J(n[0])?e?`rgb(${Math.round(n[0])},${Math.round(n[1])},${Math.round(n[2])},${n[3].toFixed(2)})`:`rgb(${Math.round(n[0])},${Math.round(n[1])},${Math.round(n[2])})`:n}function uo(n,e,t,i,r){return Array.isArray(n)&&!J(n[0])||Array.isArray(e)&&!J(e[0])?new Array(4).fill(0).map((o,s)=>Gg(ee(n)?n[s]:n,ee(e)?e[s]:e,t,i)):Gg(n,e,t,i,r)}function Gg(n,e,t,i,r){if(!n||!e)return n&&Rl(n)||e&&Rl(e)||!1;let o,s,l=!1,a=!1;if(Array.isArray(n)?o=n:typeof n=="string"?o=wt.Get(n,Si.Color255):l=!0,Array.isArray(e)?s=e:typeof e=="string"?s=wt.Get(e,Si.Color255):a=!0,l!==a){const d=l?n:e,u=l?e:n,h=Object.assign(Object.assign({},d),{stops:d.stops.map(c=>Object.assign(Object.assign({},c),{color:Rl(u)}))});return l?uo(d,h,t,i,r):uo(h,d,t,i,r)}if(l){if(n.gradient===e.gradient){const d=n,u=e,h=d.stops,c=u.stops;if(h.length!==c.length)return!1;if(d.gradient==="linear")return pS(d,u,t);if(d.gradient==="radial")return mS(d,u,t);if(d.gradient==="conical")return bS(d,u,t)}return!1}return r&&r(o,s),Rl(CS(o,s,t),i)}function pS(n,e,t){const i=n.stops,r=e.stops;return{gradient:"linear",x0:n.x0+(e.x0-n.x0)*t,x1:n.x1+(e.x1-n.x1)*t,y0:n.y0+(e.y0-n.y0)*t,y1:n.y1+(e.y1-n.y1)*t,stops:new Array(i.length).fill(0).map((o,s)=>({color:Mf(i[s].color,r[s].color,t),offset:i[s].offset+(r[s].offset-i[s].offset)*t}))}}function mS(n,e,t){const i=n.stops,r=e.stops;return{gradient:"radial",x0:n.x0+(e.x0-n.x0)*t,x1:n.x1+(e.x1-n.x1)*t,y0:n.y0+(e.y0-n.y0)*t,y1:n.y1+(e.y1-n.y1)*t,r0:n.r0+(e.r0-n.r0)*t,r1:n.r1+(e.r1-n.r1)*t,stops:new Array(i.length).fill(0).map((o,s)=>({color:Mf(i[s].color,r[s].color,t),offset:i[s].offset+(r[s].offset-i[s].offset)*t}))}}function bS(n,e,t){const i=n.stops,r=e.stops;return{gradient:"conical",startAngle:n.startAngle+(e.startAngle-n.startAngle)*t,endAngle:n.endAngle+(e.endAngle-n.endAngle)*t,x:n.x+(e.x-n.x)*t,y:n.y+(e.y-n.y)*t,stops:new Array(i.length).fill(0).map((o,s)=>({color:Mf(i[s].color,r[s].color,t),offset:i[s].offset+(r[s].offset-i[s].offset)*t}))}}function CS(n,e,t){return[n[0]+(e[0]-n[0])*t,n[1]+(e[1]-n[1])*t,n[2]+(e[2]-n[2])*t,n[3]+(e[3]-n[3])*t]}const ui=[0,0,0,0],Yo=[0,0,0,0];function Mf(n,e,t){return wt.Get(n,Si.Color255,ui),wt.Get(e,Si.Color255,Yo),`rgba(${Math.round(ui[0]+(Yo[0]-ui[0])*t)},${Math.round(ui[1]+(Yo[1]-ui[1])*t)},${Math.round(ui[2]+(Yo[2]-ui[2])*t)},${ui[3]+(Yo[3]-ui[3])*t})`}class Ne{static GetImage(e,t){var i;const r=Ne.cache.get(e);r?r.loadState==="fail"?U.global.getRequestAnimationFrame()(()=>{t.imageLoadFail(e)}):r.loadState==="init"||r.loadState==="loading"?(i=r.waitingMark)===null||i===void 0||i.push(t):t&&t.imageLoadSuccess(e,r.data):Ne.loadImage(e,t)}static GetSvg(e,t){var i;let r=Ne.cache.get(e);r?r.loadState==="fail"?U.global.getRequestAnimationFrame()(()=>{t.imageLoadFail(e)}):r.loadState==="init"||r.loadState==="loading"?(i=r.waitingMark)===null||i===void 0||i.push(t):t&&t.imageLoadSuccess(e,r.data):(r={type:"image",loadState:"init"},Ne.cache.set(e,r),r.dataPromise=U.global.loadSvg(e),r.dataPromise?(r.waitingMark=[t],r.dataPromise.then(o=>{var s;r.loadState=o!=null&&o.data?"success":"fail",r.data=o==null?void 0:o.data,(s=r.waitingMark)===null||s===void 0||s.map((l,a)=>{o!=null&&o.data?(r.loadState="success",r.data=o.data,l.imageLoadSuccess(e,o.data)):(r.loadState="fail",l.imageLoadFail(e))}),r.waitingMark&&(r.waitingMark=[])})):(r.loadState="fail",t.imageLoadFail(e)))}static GetFile(e,t){let i=Ne.cache.get(e);return i?i.loadState==="fail"?Promise.reject():i.loadState==="init"||i.loadState==="loading"?i.dataPromise.then(r=>r.data):Promise.resolve(i.data):(i={type:t,loadState:"init"},Ne.cache.set(e,i),t==="arrayBuffer"?i.dataPromise=U.global.loadArrayBuffer(e):t==="blob"?i.dataPromise=U.global.loadBlob(e):t==="json"&&(i.dataPromise=U.global.loadJson(e)),i.dataPromise.then(r=>r.data))}static loading(){setTimeout(()=>{if(!Ne.isLoading&&Ne.toLoadAueue.length){Ne.isLoading=!0;const e=Ne.toLoadAueue.splice(0,10),t=[];e.forEach(i=>{const{url:r,marks:o}=i,s={type:"image",loadState:"init"};if(Ne.cache.set(r,s),s.dataPromise=U.global.loadImage(r),s.dataPromise){s.waitingMark=o;const l=s.dataPromise.then(a=>{var d;s.loadState=a!=null&&a.data?"success":"fail",s.data=a==null?void 0:a.data,(d=s.waitingMark)===null||d===void 0||d.map((u,h)=>{a!=null&&a.data?(s.loadState="success",s.data=a.data,u.imageLoadSuccess(r,a.data)):(s.loadState="fail",u.imageLoadFail(r))}),s.waitingMark&&(s.waitingMark=[])});t.push(l)}else s.loadState="fail",o.forEach(l=>l.imageLoadFail(r))}),Promise.all(t).then(()=>{Ne.isLoading=!1,this.onLoadSuccessCb.forEach(i=>i()),Ne.loading()}).catch(i=>{console.error(i),Ne.isLoading=!1,this.onLoadSuccessCb.forEach(r=>r()),Ne.loading()})}},0)}static loadImage(e,t){const i=jg(e,Ne.toLoadAueue);if(i!==-1)return Ne.toLoadAueue[i].marks.push(t),void Ne.loading();Ne.toLoadAueue.push({url:e,marks:[t]}),Ne.loading()}static improveImageLoading(e){const t=jg(e,Ne.toLoadAueue);if(t!==-1){const i=Ne.toLoadAueue.splice(t,1);Ne.toLoadAueue.unshift(i[0])}}static onLoadSuccess(e){this.onLoadSuccessCb.push(e)}}function jg(n,e){for(let t=0;t<e.length;t++)if(e[t].url===n)return t;return-1}Ne.cache=new Map,Ne.isLoading=!1,Ne.toLoadAueue=[],Ne.onLoadSuccessCb=[];const _S=new Ht,Ug=new Ue,Pn=["lineWidth","scaleX","scaleY","angle","anchor","visible"],$g=["x","y"],Kg=["scaleX","scaleY"],Yg=["angle"],Xo=new St,Gn={strokeSeg:1,boundsPadding:2,pickMode:1,boundsMode:1,customPickShape:1,pickable:1,childrenPickable:1,visible:1,zIndex:1,layout:1,keepDirIn3d:1,globalZIndex:1,outerBorder:1,innerBorder:1,lineDash:1,lineCap:1,lineJoin:1,miterLimit:2,strokeBoundsBuffer:2,scaleCenter:1,anchor:1,anchor3d:1,postMatrix:1,backgroundMode:2,background:1,texture:1,cursor:1,html:1};class en extends sS{static mixin(e){const t=Object.keys(e);for(let i=0;i<t.length;++i){const r=t[i];Object.defineProperty(en.prototype,r,Object.getOwnPropertyDescriptor(e,r))}}get AABBBounds(){return this.tryUpdateAABBBounds(this.attribute.boundsMode==="imprecise")}get OBBBounds(){return this.tryUpdateOBBBounds()}get globalAABBBounds(){return this.tryUpdateGlobalAABBBounds()}get transMatrix(){return this.tryUpdateLocalTransMatrix(!0)}get globalTransMatrix(){return this.tryUpdateGlobalTransMatrix(!0)}constructor(e={}){var t;super(),this._AABBBounds=new Ue,this._updateTag=Ve.INIT,this.attribute=e,this.valid=this.isValid(),this.updateAABBBoundsStamp=0,e.background?this.loadImage((t=e.background.background)!==null&&t!==void 0?t:e.background,!0):e.shadowGraphic&&this.setShadowGraphic(e.shadowGraphic)}setMode(e){e==="3d"?this.set3dMode():this.set2dMode()}set3dMode(){this.in3dMode=!0}set2dMode(){this.in3dMode=!1}getOffsetXY(e,t=!1){var i,r;const{dx:o=e.dx,dy:s=e.dy}=this.attribute;if(t&&this.parent){const l=this.parent.attribute;Xo.x=o+((i=l.scrollX)!==null&&i!==void 0?i:0),Xo.y=s+((r=l.scrollY)!==null&&r!==void 0?r:0)}else Xo.x=o,Xo.y=s;return Xo}onAnimateBind(e){this._emitCustomEvent("animate-bind",e)}tryUpdateAABBBounds(e){if(!this.shouldUpdateAABBBounds())return this._AABBBounds;if(!this.valid)return this._AABBBounds.clear(),this._AABBBounds;U.graphicService.beforeUpdateAABBBounds(this,this.stage,!0,this._AABBBounds);const t=this.doUpdateAABBBounds(e);return U.graphicService.afterUpdateAABBBounds(this,this.stage,this._AABBBounds,this,!0),t}tryUpdateOBBBounds(){return this._OBBBounds||(this._OBBBounds=new mv),this.tryUpdateAABBBounds(),this.updateOBBBoundsStamp===this.updateAABBBoundsStamp?this._OBBBounds:(this.updateOBBBoundsStamp=this.updateAABBBoundsStamp,this.valid?this.doUpdateOBBBounds():(this._OBBBounds.clear(),this._OBBBounds))}combindShadowAABBBounds(e){if(this.shadowRoot){const t=this.shadowRoot.AABBBounds.clone();e.union(t)}}doUpdateOBBBounds(){return this._OBBBounds}doUpdateAABBBounds(e){this.updateAABBBoundsStamp++;const t=this.getGraphicTheme();this._AABBBounds.clear();const i=this.attribute,r=this.updateAABBBounds(i,t,this._AABBBounds,e),{boundsPadding:o=t.boundsPadding}=i,s=fa(o);return s&&r.expand(s),this.clearUpdateBoundTag(),r}updatePathProxyAABBBounds(e){const t=typeof this.pathProxy=="function"?this.pathProxy(this.attribute):this.pathProxy;if(!t)return!1;const i=new vf(e);return Qi(t.commandList,i,0,0),!0}tryUpdateGlobalAABBBounds(){const e=this.AABBBounds;return this._globalAABBBounds?this._globalAABBBounds.setValue(e.x1,e.y1,e.x2,e.y2):this._globalAABBBounds=e.clone(),this._globalAABBBounds.empty()||this.parent&&this._globalAABBBounds.transformWithMatrix(this.parent.globalTransMatrix),this._globalAABBBounds}tryUpdateGlobalTransMatrix(e=!0){if(this._globalTransMatrix){if(this.parent){const t=this.parent.globalTransMatrix;this._globalTransMatrix.setValue(t.a,t.b,t.c,t.d,t.e,t.f)}}else this._globalTransMatrix=this.parent?this.parent.globalTransMatrix.clone():this.transMatrix.clone();return this.shouldUpdateGlobalMatrix()&&this.doUpdateGlobalMatrix(),this._globalTransMatrix}shouldUpdateGlobalMatrix(){return!0}tryUpdateLocalTransMatrix(e=!0){return this._transMatrix||(this._transMatrix=new Ht),this.shouldUpdateLocalMatrix()&&(this.doUpdateLocalMatrix(),e&&this.clearUpdateLocalPositionTag()),this._transMatrix}shouldUpdateAABBBounds(){return this.shadowRoot?(!!(this._updateTag&Ve.UPDATE_BOUNDS)||this.shadowRoot.shouldUpdateAABBBounds())&&U.graphicService.validCheck(this.attribute,this.getGraphicTheme(),this._AABBBounds,this):!!(this._updateTag&Ve.UPDATE_BOUNDS)&&U.graphicService.validCheck(this.attribute,this.getGraphicTheme(),this._AABBBounds,this)}shouldSelfChangeUpdateAABBBounds(){return this.shadowRoot?!!(this._updateTag&Ve.UPDATE_BOUNDS)||this.shadowRoot.shouldUpdateAABBBounds():!!(this._updateTag&Ve.UPDATE_BOUNDS)}shouldUpdateLocalMatrix(){return!!(this._updateTag&Ve.UPDATE_LOCAL_MATRIX)}isValid(){var e,t;const i=this.attribute;return Number.isFinite(((e=i.x)!==null&&e!==void 0?e:0)+((t=i.y)!==null&&t!==void 0?t:0))}_validNumber(e){return e==null||Number.isFinite(e)}shouldUpdateShape(){return!!(this._updateTag&Ve.UPDATE_SHAPE)}clearUpdateShapeTag(){this._updateTag&=Ve.CLEAR_SHAPE}containsPoint(e,t,i,r){if(!r)return!1;if(i===Ts.GLOBAL){const o=new St(e,t);this.parent&&this.parent.globalTransMatrix.transformPoint(o,o),e=o.x,t=o.y}return r.containsPoint(this,{x:e,y:t})}setAttributes(e,t=!1,i){(e=this.onBeforeAttributeUpdate&&this.onBeforeAttributeUpdate(e,this.attribute,null,i)||e).background?this.loadImage(e.background,!0):e.shadowGraphic&&this.setShadowGraphic(e.shadowGraphic),this._setAttributes(e,t,i)}_setAttributes(e,t=!1,i){const r=Object.keys(e);for(let o=0;o<r.length;o++){const s=r[o];this.attribute[s]=e[s]}this.valid=this.isValid(),this.updateShapeAndBoundsTagSetted()||!t&&!this.needUpdateTags(r)?this.addUpdateBoundTag():this.addUpdateShapeAndBoundsTag(),this.addUpdatePositionTag(),this.addUpdateLayoutTag(),this.onAttributeUpdate(i)}setAttribute(e,t,i,r){var o;const s=this.onBeforeAttributeUpdate&&this.onBeforeAttributeUpdate({[e]:t},this.attribute,e,r);s?this._setAttributes(s,i,r):Te((o=this.normalAttrs)===null||o===void 0?void 0:o[e])?(this.attribute[e]=t,this.valid=this.isValid(),this.updateShapeAndBoundsTagSetted()||!i&&!this.needUpdateTag(e)?this.addUpdateBoundTag():this.addUpdateShapeAndBoundsTag(),this.addUpdatePositionTag(),this.addUpdateLayoutTag(),this.onAttributeUpdate(r)):this.normalAttrs[e]=t,e==="background"?this.loadImage(t,!0):e==="shadowGraphic"&&this.setShadowGraphic(t)}needUpdateTags(e,t=Pn){for(let i=0;i<t.length;i++){const r=t[i];if(e.indexOf(r)!==-1)return!0}return!1}needUpdateTag(e,t=Pn){for(let i=0;i<t.length;i++)if(e===t[i])return!0;return!1}initAttributes(e){const t={type:Yt.INIT};e=this.onBeforeAttributeUpdate&&this.onBeforeAttributeUpdate(e,this.attribute,null,t)||e,this.attribute=e,e.background?this.loadImage(e.background,!0):e.shadowGraphic&&this.setShadowGraphic(e.shadowGraphic),this._updateTag=Ve.INIT,this.valid=this.isValid(),this.onAttributeUpdate(t)}translate(e,t){var i,r;if(e===0&&t===0)return this;const o={type:Yt.TRANSLATE},s=this.onBeforeAttributeUpdate&&this.onBeforeAttributeUpdate({x:e,y:t},this.attribute,$g,o);s&&(e=s.x,t=s.y,delete s.x,delete s.y,this._setAttributes(s));const l=this.attribute,a=l.postMatrix;return a?U.transformUtil.fromMatrix(a,a).translate(e,t):(l.x=((i=l.x)!==null&&i!==void 0?i:yt.x)+e,l.y=((r=l.y)!==null&&r!==void 0?r:yt.y)+t),this.addUpdatePositionTag(),this.addUpdateBoundTag(),this.addUpdateLayoutTag(),this.onAttributeUpdate(o),this}translateTo(e,t){const i=this.attribute;if(i.x===e&&i.y===t)return this;const r={type:Yt.TRANSLATE_TO},o=this.onBeforeAttributeUpdate&&this.onBeforeAttributeUpdate({x:e,y:t},this.attribute,$g,r);return o?(this._setAttributes(o,!1,r),this):(i.x=e,i.y=t,this.addUpdatePositionTag(),this.addUpdateBoundTag(),this.addUpdateLayoutTag(),this.onAttributeUpdate(r),this)}scale(e,t,i){var r,o;if(e===1&&t===1)return this;const s={type:Yt.SCALE},l=this.onBeforeAttributeUpdate&&this.onBeforeAttributeUpdate({scaleX:e,scaleY:t,scaleCenter:i},this.attribute,Kg,s);l&&(e=l.scaleX,t=l.scaleY,delete l.scaleX,delete l.scaleY,this._setAttributes(l));const a=this.attribute;if(i){let{postMatrix:d}=this.attribute;d||(d=new Ht,a.postMatrix=d),U.transformUtil.fromMatrix(d,d).scale(e,t,i)}else a.scaleX=((r=a.scaleX)!==null&&r!==void 0?r:yt.scaleX)*e,a.scaleY=((o=a.scaleY)!==null&&o!==void 0?o:yt.scaleY)*t;return this.addUpdatePositionTag(),this.addUpdateBoundTag(),this.addUpdateLayoutTag(),this.onAttributeUpdate(s),this}scaleTo(e,t){const i=this.attribute;if(i.scaleX===e&&i.scaleY===t)return this;const r={type:Yt.SCALE_TO},o=this.onBeforeAttributeUpdate&&this.onBeforeAttributeUpdate({scaleX:e,scaleY:t},this.attribute,Kg,r);return o?(this._setAttributes(o,!1,r),this):(i.scaleX=e,i.scaleY=t,this.addUpdatePositionTag(),this.addUpdateBoundTag(),this.addUpdateLayoutTag(),this.onAttributeUpdate(r),this)}rotate(e,t){var i;if(e===0)return this;const r={type:Yt.ROTATE},o=this.onBeforeAttributeUpdate&&this.onBeforeAttributeUpdate({angle:e,rotateCenter:t},this.attribute,Yg,r);o&&(delete o.angle,this._setAttributes(o,!1,r));const s=this.attribute;if(t){let{postMatrix:l}=this.attribute;l||(l=new Ht,s.postMatrix=l),U.transformUtil.fromMatrix(l,l).rotate(e,t)}else s.angle=((i=s.angle)!==null&&i!==void 0?i:yt.angle)+e;return this.addUpdatePositionTag(),this.addUpdateBoundTag(),this.addUpdateLayoutTag(),this.onAttributeUpdate(r),this}rotateTo(e){const t=this.attribute;if(t.angle===e)return this;const i={type:Yt.ROTATE_TO},r=this.onBeforeAttributeUpdate&&this.onBeforeAttributeUpdate(e,this.attribute,Yg,i);return r?(this._setAttributes(r,!1,i),this):(t.angle=e,this.addUpdatePositionTag(),this.addUpdateBoundTag(),this.addUpdateLayoutTag(),this.onAttributeUpdate(i),this)}skewTo(e,t){return this}animate(e){this.animates||(this.animates=new Map);const t=new wi(e==null?void 0:e.id,this.stage&&this.stage.getTimeline(),e==null?void 0:e.slience);if(t.bind(this),e){const{onStart:i,onFrame:r,onEnd:o,onRemove:s}=e;i!=null&&t.onStart(i),r!=null&&t.onFrame(r),o!=null&&t.onEnd(o),s!=null&&t.onRemove(s),t.interpolateFunc=e.interpolate}return this.animates.set(t.id,t),t.onRemove(()=>{this.animates.delete(t.id)}),t}onAttributeUpdate(e){e&&e.skipUpdateCallback||(U.graphicService.onAttributeUpdate(this),this._emitCustomEvent("afterAttributeUpdate",e))}update(e){e?(e.bounds&&this.tryUpdateAABBBounds(this.attribute.boundsMode==="imprecise"),e.trans&&this.tryUpdateLocalTransMatrix()):(this.tryUpdateAABBBounds(this.attribute.boundsMode==="imprecise"),this.tryUpdateLocalTransMatrix())}hasState(e){return!(!this.currentStates||!this.currentStates.length)&&(!!Te(e)||this.currentStates.includes(e))}getState(e){var t;return(t=this.states)===null||t===void 0?void 0:t[e]}applyStateAttrs(e,t,i,r){var o,s,l,a;if(i){const d=Object.keys(e),u=this.getNoWorkAnimateAttr(),h={};let c;d.forEach(f=>{u[f]?(c||(c={}),c[f]=e[f]):h[f]=r&&e[f]===void 0?this.getDefaultAttribute(f):e[f]});const g=this.animate({slience:!0});g.stateNames=t,g.to(h,(s=(o=this.stateAnimateConfig)===null||o===void 0?void 0:o.duration)!==null&&s!==void 0?s:Dg.duration,(a=(l=this.stateAnimateConfig)===null||l===void 0?void 0:l.easing)!==null&&a!==void 0?a:Dg.easing),c&&this.setAttributes(c,!1,{type:Yt.STATE})}else this.stopStateAnimates(),this.setAttributes(e,!1,{type:Yt.STATE})}updateNormalAttrs(e){const t={};this.normalAttrs?(Object.keys(e).forEach(i=>{i in this.normalAttrs?(t[i]=this.normalAttrs[i],delete this.normalAttrs[i]):t[i]=this.getNormalAttribute(i)}),Object.keys(this.normalAttrs).forEach(i=>{e[i]=this.normalAttrs[i]})):Object.keys(e).forEach(i=>{t[i]=this.getNormalAttribute(i)}),this.normalAttrs=t}stopStateAnimates(e="end"){this.animates&&this.animates.forEach(t=>{t.stateNames&&(t.stop(e),this.animates.delete(t.id))})}getNormalAttribute(e){let t=this.attribute[e];return this.animates&&this.animates.forEach(i=>{if(i.stateNames){const r=i.getEndProps();E_(r,e)&&(t=r[e])}}),t}clearStates(e){this.hasState()&&this.normalAttrs?(this.currentStates=[],this.applyStateAttrs(this.normalAttrs,this.currentStates,e,!0)):this.currentStates=[],this.normalAttrs=null}removeState(e,t){if((this.currentStates?this.currentStates.indexOf(e):-1)>=0){const i=this.currentStates.filter(r=>r!==e);this.useStates(i,t)}}toggleState(e,t){if(this.hasState(e))this.removeState(e,t);else if((this.currentStates?this.currentStates.indexOf(e):-1)<0){const i=this.currentStates?this.currentStates.slice():[];i.push(e),this.useStates(i,t)}}addState(e,t,i){var r;if(this.currentStates&&this.currentStates.includes(e)&&(t||this.currentStates.length===1))return;const o=t&&(!((r=this.currentStates)===null||r===void 0)&&r.length)?this.currentStates.concat([e]):[e];this.useStates(o,i)}useStates(e,t){var i;if(!e.length)return void this.clearStates(t);if(!(((i=this.currentStates)===null||i===void 0?void 0:i.length)!==e.length||e.some((o,s)=>this.currentStates[s]!==o)))return;const r={};e.forEach(o=>{var s;const l=this.stateProxy?this.stateProxy(o,e):(s=this.states)===null||s===void 0?void 0:s[o];l&&Object.assign(r,l)}),this.updateNormalAttrs(r),this.currentStates=e,this.applyStateAttrs(r,e,t)}addUpdateBoundTag(){this._updateTag|=Ve.UPDATE_BOUNDS,this.parent&&this.parent.addChildUpdateBoundTag(),this.glyphHost&&this.glyphHost.addUpdateBoundTag()}addUpdateShapeTag(){this._updateTag|=Ve.UPDATE_SHAPE}addUpdateShapeAndBoundsTag(){this._updateTag|=Ve.UPDATE_SHAPE_AND_BOUNDS,this.parent&&this.parent.addChildUpdateBoundTag(),this.glyphHost&&this.glyphHost.addUpdateBoundTag()}updateShapeAndBoundsTagSetted(){return(this._updateTag&Ve.UPDATE_SHAPE_AND_BOUNDS)===Ve.UPDATE_SHAPE_AND_BOUNDS}clearUpdateBoundTag(){this._updateTag&=Ve.CLEAR_BOUNDS}addUpdatePositionTag(){this.shadowRoot&&this.shadowRoot.addUpdateGlobalPositionTag(),this._updateTag|=Ve.UPDATE_GLOBAL_LOCAL_MATRIX}addUpdateGlobalPositionTag(){this.shadowRoot&&this.shadowRoot.addUpdateGlobalPositionTag(),this._updateTag|=Ve.UPDATE_GLOBAL_MATRIX}clearUpdateLocalPositionTag(){this._updateTag&=Ve.CLEAR_LOCAL_MATRIX}clearUpdateGlobalPositionTag(){this._updateTag&=Ve.CLEAR_GLOBAL_MATRIX}addUpdateLayoutTag(){this._updateTag|=Ve.UPDATE_LAYOUT}clearUpdateLayoutTag(){this._updateTag&=Ve.CLEAR_LAYOUT}needUpdateLayout(){return!!(this._updateTag&Ve.UPDATE_LAYOUT)}getAnchor(e,t){const i=[0,0],r=()=>{if(t.b)return t.b;const{scaleX:o,scaleY:s,angle:l}=this.attribute;return Ug.copy(this._AABBBounds),this.setAttributes({scaleX:1,scaleY:1,angle:0}),t.b=this.AABBBounds.clone(),this._AABBBounds.copy(Ug),this.setAttributes({scaleX:o,scaleY:s,angle:l}),t.b};if(typeof e[0]=="string"){const o=parseFloat(e[0])/100,s=r();i[0]=s.x1+(s.x2-s.x1)*o}else i[0]=e[0];if(typeof e[1]=="string"){const o=parseFloat(e[1])/100,s=r();i[1]=s.y1+(s.y2-s.y1)*o}else i[1]=e[1];return i}doUpdateLocalMatrix(){const{x:e=yt.x,y:t=yt.y,scaleX:i=yt.scaleX,scaleY:r=yt.scaleY,angle:o=yt.angle,scaleCenter:s,anchor:l,postMatrix:a}=this.attribute;let d=[0,0];const u={};if(l&&(d=this.getAnchor(l,u)),!s||i===1&&r===1)bv(this._transMatrix,this._transMatrix.reset(),e,t,i,r,o,l&&d);else{const c=this._transMatrix;c.reset(),c.translate(d[0],d[1]),c.rotate(o),c.translate(-d[0],-d[1]),c.translate(e,t),d=this.getAnchor(s,u),U.transformUtil.fromMatrix(c,c).scale(i,r,{x:d[0],y:d[1]})}const h=this.getOffsetXY(yt);if(this._transMatrix.e+=h.x,this._transMatrix.f+=h.y,a){const c=_S.setValue(a.a,a.b,a.c,a.d,a.e,a.f),g=this._transMatrix;c.multiply(g.a,g.b,g.c,g.d,g.e,g.f),g.setValue(c.a,c.b,c.c,c.d,c.e,c.f)}}doUpdateGlobalMatrix(){if(this.parent){this._globalTransMatrix.multiply(this.transMatrix.a,this.transMatrix.b,this.transMatrix.c,this.transMatrix.d,this.transMatrix.e,this.transMatrix.f);const{scrollX:e=0,scrollY:t=0}=this.parent.attribute;this._globalTransMatrix.translate(e,t)}}setStage(e,t){if(this.stage!==e){if(this.stage=e,this.layer=t,this.setStageToShadowRoot(e,t),this.animates&&this.animates.size){const i=e.getTimeline();this.animates.forEach(r=>{r.setTimeline(i)})}this._onSetStage&&this._onSetStage(this,e,t),U.graphicService.onSetStage(this,e)}}setStageToShadowRoot(e,t){this.shadowRoot&&this.shadowRoot.setStage(e,t)}onAddStep(e){}onStop(e){e&&this.setAttributes(e,!1,{type:Yt.ANIMATE_END})}onStep(e,t,i,r,o){const s={};if(i.customAnimate)i.customAnimate.update(o,r,s);else{const l=i.props,a=i.parsedProps,d=i.propKeys;this.stepInterpolate(e,t,s,i,r,o,l,void 0,a,d)}this.setAttributes(s,!1,{type:Yt.ANIMATE_UPDATE,animationState:{ratio:r,end:o,step:i,isFirstFrameOfStep:e.getLastStep()!==i}}),this.stage&&this.stage.renderNextFrame()}stepInterpolate(e,t,i,r,o,s,l,a,d,u){u||(u=Object.keys(l),r.propKeys=u),s?r.propKeys.forEach(h=>{t.validAttr(h)&&(i[h]=l[h])}):u.forEach(h=>{var c;if(!t.validAttr(h))return;const g=l[h],f=(c=a&&a[h])!==null&&c!==void 0?c:e.getLastPropByName(h,r);if(g==null||f==null||g===f)return void(i[h]=g);let p;p=t.interpolateFunc&&t.interpolateFunc(h,o,f,g,i),p||(p=t.customInterpolate(h,o,f,g,this,i),p||this.defaultInterpolate(g,f,h,i,d,o)||this._interpolate(h,o,f,g,i))}),r.parsedProps=d}defaultInterpolate(e,t,i,r,o,s){if(Number.isFinite(e))return r[i]=t+(e-t)*s,!0;if(i==="fill"){o||(o={});const l=o.fillColorArray,a=uo(t,l??e,s,!1,(d,u)=>{o.fillColorArray=u});return a&&(r[i]=a),!0}if(i==="stroke"){o||(o={});const l=o.strokeColorArray,a=uo(t,l??e,s,!1,(d,u)=>{o.strokeColorArray=u});return a&&(r[i]=a),!0}if(i==="shadowColor"){o||(o={});const l=o.shadowColorArray,a=uo(t,l??e,s,!0,(d,u)=>{o.shadowColorArray=u});return a&&(r[i]=a),!0}return!1}_interpolate(e,t,i,r,o){}getDefaultAttribute(e){return this.getGraphicTheme()[e]}getComputedAttribute(e){var t;return(t=this.attribute[e])!==null&&t!==void 0?t:this.getDefaultAttribute(e)}onSetStage(e,t=!1){this._onSetStage=e,t&&this.stage&&e(this,this.stage)}attachShadow(e){return e&&(e.shadowHost=this),this.shadowRoot=e??U.graphicService.creator.shadowRoot(this),this.addUpdateBoundTag(),this.shadowRoot.setStage(this.stage,this.layer),this.shadowRoot}detachShadow(){this.shadowRoot&&(this.addUpdateBoundTag(),this.shadowRoot=null)}toJson(){return{attribute:this.attribute,_uid:this._uid,type:this.type,name:this.name,children:this.children.map(e=>e.toJson())}}createPathProxy(e){return je(e,!0)?this.pathProxy=new Bt().fromString(e):this.pathProxy=new Bt,this.pathProxy}loadImage(e,t=!1){if(!e||t&&wS(e))return;const i=e;this.resources||(this.resources=new Map);const r={data:"init",state:null};this.resources.set(i,r),typeof e=="string"?(r.state="loading",e.startsWith("<svg")?(Ne.GetSvg(e,this),this.backgroundImg=this.backgroundImg||t):(Cv(e)||e.includes("/")||_v(e))&&(Ne.GetImage(e,this),this.backgroundImg=this.backgroundImg||t)):ke(e)?(r.state="success",r.data=e,this.backgroundImg=this.backgroundImg||t):r.state="fail"}setShadowGraphic(e){e?this.attachShadow().add(e):this.detachShadow()}imageLoadSuccess(e,t,i){if(!this.resources)return;const r=this.resources.get(e);r&&(r.state="success",r.data=t,i&&i(),this.addUpdateBoundTag(),this.stage&&this.stage.renderNextFrame())}imageLoadFail(e,t){if(!this.resources)return;const i=this.resources.get(e);i&&(i.state="fail",t&&t())}_stopAnimates(e){e&&e.forEach(t=>{t.stop()})}stopAnimates(e=!1){this._stopAnimates(this.animates),this.shadowRoot&&this.shadowRoot.stopAnimates(!0),this.isContainer&&e&&this.forEachChildren(t=>{t.stopAnimates(e)})}release(){this.releaseStatus="released",U.graphicService.onRelease(this)}_emitCustomEvent(e,t){var i,r;if(this._events&&e in this._events){const o=new Af(e,t);o.bubbles=!1,o.manager=(r=(i=this.stage)===null||i===void 0?void 0:i.eventSystem)===null||r===void 0?void 0:r.manager,this.dispatchEvent(o)}}}function wS(n){return!(!n.fill&&!n.stroke)}en.mixin(aS);function yS(n,e){const t=[];let i=e.exec(n);for(;i;){const r=[];r.startIndex=e.lastIndex-i[0].length;const o=i.length;for(let s=0;s<o;s++)r.push(i[s]);t.push(r),i=e.exec(n)}return t}class Du{constructor(e){this.tagname=e,this.child=[],this[":@"]={}}add(e,t){e==="__proto__"&&(e="#__proto__"),this.child.push({[e]:t})}addChild(e){e.tagname==="__proto__"&&(e.tagname="#__proto__"),e[":@"]&&Object.keys(e[":@"]).length>0?this.child.push({[e.tagname]:e.child,":@":e[":@"]}):this.child.push({[e.tagname]:e.child})}}function Xg(n,e,t,i){const r=n.indexOf(e,t);if(r===-1)throw new Error(i);return r+e.length-1}function vS(n,e,t=">"){let i,r="";for(let o=e;o<n.length;o++){let s=n[o];if(i)s===i&&(i="");else if(s==='"'||s==="'")i=s;else if(s===t[0]){if(!t[1])return{data:r,index:o};if(n[o+1]===t[1])return{data:r,index:o}}else s==="	"&&(s=" ");r+=s}}function qg(n,e,t,i=">"){const r=vS(n,e+1,i);if(!r)return;let o=r.data;const s=r.index,l=o.search(/\s/);let a=o,d=!0;return l!==-1&&(a=o.substr(0,l).replace(/\s\s*$/,""),o=o.substr(l+1)),{tagName:a,tagExp:o,closeIndex:s,attrExpPresent:d,rawTagName:a}}const SS=new RegExp(`([^\\s=]+)\\s*(=\\s*(['"])([\\s\\S]*?)\\3)?`,"gm");class xS{constructor(e){this.currentNode=null,this.options=e,this.tagsNodeStack=[],this.docTypeEntities={}}addChild(e,t,i){const r=t.tagname;typeof r=="string"&&(t.tagname=r),e.addChild(t)}buildAttributesMap(e,t,i){const r={};if(!e)return;const o=yS(e,SS),s=o.length;for(let l=0;l<s;l++){const a=o[l][1],d=o[l][4],u=a;a&&(r[u]=d===void 0||(isNaN(d)?d:Number(d)))}return r}parseXml(e){e=e.replace(/\r\n?/g,`
`);const t=new Du("!xml");let i=t,r="",o="";for(let s=0;s<e.length;s++)if(e[s]==="<")if(e[s+1]==="/"){const l=Xg(e,">",s,"Closing Tag is not closed."),a=o.lastIndexOf(".");o=o.substring(0,a),i=this.tagsNodeStack.pop(),i&&i.child&&r&&i.child[i.child.length-1][":@"]&&(i.child[i.child.length-1][":@"].text=r),r="",s=l}else if(e[s+1]==="?")s=qg(e,s,!1,"?>").closeIndex+1;else if(e.substr(s+1,3)==="!--")s=Xg(e,"-->",s+4,"Comment is not closed.");else{const l=qg(e,s);let a=l.tagName,d=l.tagExp;const u=l.attrExpPresent,h=l.closeIndex;if(a!==t.tagname&&(o+=o?"."+a:a),d.length>0&&d.lastIndexOf("/")===d.length-1){a[a.length-1]==="/"?(a=a.substr(0,a.length-1),o=o.substr(0,o.length-1),d=a):d=d.substr(0,d.length-1);const c=new Du(a);a!==d&&u&&(c[":@"]=this.buildAttributesMap(d,o,a)),this.addChild(i,c,o),o=o.substr(0,o.lastIndexOf("."))}else{const c=new Du(a);this.tagsNodeStack.push(i),a!==d&&u&&(c[":@"]=this.buildAttributesMap(d,o,a)),this.addChild(i,c,o),i=c}r="",s=h}else r+=e[s];return t.child}}function RS(n,e){return C0(n)}function C0(n,e){const t={};for(let i=0;i<n.length;i++){const r=n[i],o=AS(r);if(o!==void 0&&r[o]){const s=C0(r[o]);MS(s),r[":@"]&&BS(s,r[":@"]),t[o]!==void 0&&t.hasOwnProperty(o)?(Array.isArray(t[o])||(t[o]=[t[o]]),t[o].push(s)):t[o]=s}}return t}function AS(n){const e=Object.keys(n);for(let t=0;t<e.length;t++){const i=e[t];if(i!==":@")return i}}function BS(n,e,t){if(e){const i=Object.keys(e),r=i.length;for(let o=0;o<r;o++){const s=i[o];n[s]=e[s]}}}function MS(n){return Object.keys(n).length===0}class Zd{constructor(e){this.options=Object.assign({},Zd.defaultOptions,e)}valid(e){return e.startsWith("<")}parse(e){if(!this.valid)return!1;const t=new xS(this.options).parseXml(e);return RS(t,this.options)}}Zd.defaultOptions={};function TS(n){return n.startsWith("<svg")||n.startsWith("<?xml")}function ga(n,e,t,i=0){return n.expand(e+(i/2+(t?PS(t,e):0))),n}function PS(n,e){return n?e:0}let HS=0;function Et(){return HS++}var ho;(function(n){n[n.HORIZONTAL=0]="HORIZONTAL",n[n.VERTICAL=1]="VERTICAL"})(ho||(ho={}));function kS(n){const e=[];let t=0,i="";for(let r=0;r<n.length;r++)FS(n[r])?t?i+=n[r]:(t=1,i=n[r]):(t&&(e.push({text:i,direction:ho.VERTICAL}),i="",t=0),e.push({text:n[r],direction:ho.HORIZONTAL}));return i&&e.push({text:i,direction:ho.VERTICAL}),e}const ES=["…","（","）","—","【","】","「","」","《","》"],_0=new Map;ES.forEach(n=>_0.set(n,!0));const LS=[""],w0=new Map;function FS(n){if(_0.has(n))return!0;if(w0.has(n))return!1;let e=!1;return n.codePointAt(0)<256&&(e=!0),e}LS.forEach(n=>w0.set(n,!0));const Jd=Et(),zS=Et(),y0=Et(),Qd=Et();Et();const Tf=Et(),eu=Et(),il=Et(),tu=Et(),nu=Et();Et();const Pf=Et();Et();const Hf=Et(),iu=Et(),ru=Et(),v0=Symbol.for("GraphicService"),S0=Symbol.for("GraphicCreator"),x0={"stroke-linecap":"lineCap","stroke-linejoin":"lineJoin","stroke-dasharray":"lineDash","stroke-dashoffset":"lineDashOffset","stroke-width":"lineWidth","fill-opacity":"fillOpacity","stroke-opacity":"strokeOpacity",stroke:"stroke",fill:"fill"},IS=Object.keys(x0);var Zg;(function(n){n[n.LESS_GROUP=0]="LESS_GROUP",n[n.MORE_GROUP=1]="MORE_GROUP"})(Zg||(Zg={}));let jn=class zh extends en{constructor(e){super(e),this.type="group",this.parent=null,this.isContainer=!0,this.numberType=Tf,this._childUpdateTag=Ve.UPDATE_BOUNDS}setMode(e){e==="3d"?this.set3dMode():this.set2dMode()}set3dMode(){this.in3dMode=!0}set2dMode(){this.in3dMode=!1}setTheme(e){return this.theme||(this.theme=new ks),this.theme.setTheme(e,this)}createTheme(){this.theme||(this.theme=new ks)}visibleAll(e){this.setAttribute("visible",e),this.forEachChildren(t=>{t.isContainer&&t.visibleAll?t.visibleAll(e):t.setAttribute("visible",e)})}hideAll(){this.visibleAll(!1)}showAll(){this.visibleAll(!0)}containsPoint(e,t,i){if(i===Ts.GLOBAL){const r=new St(e,t);return this.parent&&this.parent.globalTransMatrix.transformPoint(r,r),this.AABBBounds.contains(r.x,r.y)}return this.AABBBounds.contains(e,t)}shouldUpdateAABBBounds(){return!!super.shouldUpdateAABBBounds()||!!(this._childUpdateTag&Ve.UPDATE_BOUNDS)}tryUpdateAABBBounds(){if(!this.shouldUpdateAABBBounds())return this._AABBBounds;U.graphicService.beforeUpdateAABBBounds(this,this.stage,!0,this._AABBBounds);const e=this.shouldSelfChangeUpdateAABBBounds(),t=this.doUpdateAABBBounds();return this.addUpdateLayoutTag(),U.graphicService.afterUpdateAABBBounds(this,this.stage,this._AABBBounds,this,e),t}doUpdateLocalMatrix(){const{x:e=yt.x,y:t=yt.y,dx:i=yt.dx,dy:r=yt.dy,scaleX:o=yt.scaleX,scaleY:s=yt.scaleY,angle:l=yt.angle,postMatrix:a}=this.attribute;if(e!==0||t!==0||i!==0||r!==0||o!==1||s!==1||l!==0||a)return super.doUpdateLocalMatrix();this._transMatrix.reset()}getGraphicTheme(){return ve(this).group}updateAABBBounds(e,t,i){const r=i;i=i.clone();const{width:o,height:s,path:l,clip:a=t.clip}=e;if(l&&l.length?l.forEach(d=>{i.union(d.AABBBounds)}):o!=null&&s!=null&&i.set(0,0,Math.max(0,o),Math.max(0,s)),!a){this.forEachChildren(h=>{i.union(h.AABBBounds)});const{scrollX:d=0,scrollY:u=0}=e;i.translate(d,u)}return U.graphicService.updateTempAABBBounds(i),U.graphicService.transformAABBBounds(e,i,t,!1,this),r.copy(i),r}doUpdateAABBBounds(){this.updateAABBBoundsStamp++;const e=super.doUpdateAABBBounds();return this.parent&&this.parent.addChildUpdateBoundTag(),this._emitCustomEvent("AAABBBoundsChange"),e}clearUpdateBoundTag(){this._updateTag&=Ve.CLEAR_BOUNDS,this._childUpdateTag&=Ve.CLEAR_BOUNDS}addUpdateBoundTag(){this._updateTag|=Ve.UPDATE_BOUNDS,this.parent&&this.parent.addChildUpdateBoundTag()}addChildUpdateBoundTag(){this._childUpdateTag&Ve.UPDATE_BOUNDS||(this._childUpdateTag|=Ve.UPDATE_BOUNDS,this.parent&&this.parent.addChildUpdateBoundTag())}getTheme(){return this.theme.getTheme(this)}incrementalAppendChild(e){const t=super.appendChild(e);return this.stage&&t&&(t.stage=this.stage,t.layer=this.layer),this.addUpdateBoundTag(),U.graphicService.onAddIncremental(e,this,this.stage),t}incrementalClearChild(){super.removeAllChild(),this.addUpdateBoundTag(),U.graphicService.onClearIncremental(this,this.stage)}_updateChildToStage(e){return this.stage&&e&&e.setStage(this.stage,this.layer),this.addUpdateBoundTag(),e}appendChild(e,t=!0){const i=super.appendChild(e);return t&&this.stage&&i&&i.setStage(this.stage,this.layer),this.addUpdateBoundTag(),i}insertBefore(e,t){return this._updateChildToStage(super.insertBefore(e,t))}insertAfter(e,t){return this._updateChildToStage(super.insertAfter(e,t))}insertInto(e,t){return this._updateChildToStage(super.insertInto(e,t))}removeChild(e){const t=super.removeChild(e);return e.stage=null,U.graphicService.onRemove(e),this.addUpdateBoundTag(),t}removeAllChild(e=!1){this.forEachChildren(t=>{U.graphicService.onRemove(t),e&&t.isContainer&&t.removeAllChild(e)}),super.removeAllChild(),this.addUpdateBoundTag()}setStage(e,t){this.stage!==e&&(this.stage=e,this.layer=t,this.setStageToShadowRoot(e,t),this._onSetStage&&this._onSetStage(this,e,t),U.graphicService.onSetStage(this,e),this.forEachChildren(i=>{i.setStage(e,this.layer)}))}addUpdatePositionTag(){super.addUpdatePositionTag(),this.forEachChildren(e=>{e.isContainer&&e.addUpdateGlobalPositionTag()})}addUpdateGlobalPositionTag(){super.addUpdateGlobalPositionTag(),this.forEachChildren(e=>{e.isContainer&&e.addUpdateGlobalPositionTag()})}tryUpdateGlobalTransMatrix(e=!0){if(this.shouldUpdateGlobalMatrix()){if(this._globalTransMatrix){if(this.parent){const t=this.parent.globalTransMatrix;this._globalTransMatrix.setValue(t.a,t.b,t.c,t.d,t.e,t.f)}}else this._globalTransMatrix=this.parent?this.parent.globalTransMatrix.clone():this.transMatrix.clone();this.doUpdateGlobalMatrix(),e&&this.clearUpdateGlobalPositionTag()}return this._globalTransMatrix}shouldUpdateGlobalMatrix(){return!!(this._updateTag&Ve.UPDATE_GLOBAL_MATRIX)}_getChildByName(e,t){return this.find(i=>i.name===e,t)}createOrUpdateChild(e,t,i){let r=this._getChildByName(e);return r?r.setAttributes(t):(r=U.graphicService.creator[i](t),r.name=e,this.add(r)),r}clone(){return new zh(Object.assign({},this.attribute))}getNoWorkAnimateAttr(){return zh.NOWORK_ANIMATE_ATTR}};jn.NOWORK_ANIMATE_ATTR=Gn;function pa(n){return new jn(n)}class OS extends jn{get offscreen(){return this.layerHandler.offscreen}get layerMode(){return this.layerHandler.type}get width(){return this.stage?this.stage.width:0}get height(){return this.stage?this.stage.height:0}get viewWidth(){return this.stage?this.stage.viewWidth:0}get viewHeight(){return this.stage?this.stage.viewHeight:0}get dirtyBound(){throw new Error("暂不支持")}get dpr(){return this._dpr}constructor(e,t,i,r){var o;super({}),this.stage=e,this.global=t,this.window=i,this.main=r.main,this.layerHandler=r.layerHandler,this.layerHandler.init(this,i,{main:r.main,canvasId:r.canvasId,width:this.viewWidth,height:this.viewHeight,zIndex:(o=r.zIndex)!==null&&o!==void 0?o:0}),this.layer=this,this.subLayers=new Map,this.theme=new ks,this.background="rgba(0, 0, 0, 0)",this.afterDrawCbs=[]}combineSubLayer(e=!0){const t=Array.from(this.subLayers.values()).sort((i,r)=>i.zIndex-r.zIndex);this.layerHandler.merge(t.map(i=>(i.layer.subLayers.size&&i.layer.combineSubLayer(e),i.layer.getNativeHandler()))),e&&t.forEach(i=>{i.group&&(i.group.incremental=0)}),t.forEach(i=>{U.layerService.releaseLayer(this.stage,i.layer)}),this.subLayers.clear()}getNativeHandler(){return this.layerHandler}setStage(e,t){super.setStage(e,this)}pick(e,t){throw new Error("暂不支持")}tryRenderSecondaryLayer(e,t){this.layerHandler.secondaryHandlers&&this.layerHandler.secondaryHandlers.length&&this.layerHandler.secondaryHandlers.forEach(i=>{i.layer.renderCount=this.renderCount,i.layer.render(e,t)})}render(e,t){var i;this.layerHandler.render([this],{renderService:e.renderService,stage:this.stage,layer:this,viewBox:e.viewBox,transMatrix:e.transMatrix,background:(i=e.background)!==null&&i!==void 0?i:this.background,updateBounds:e.updateBounds},t),this.afterDrawCbs.forEach(r=>r(this)),this.tryRenderSecondaryLayer(e,t)}resize(e,t){this.layerHandler.resize(e,t)}resizeView(e,t){this.layerHandler.resizeView(e,t)}setDpr(e){this.layerHandler.setDpr(e)}afterDraw(e){this.afterDrawCbs.push(e)}startAnimate(e){throw new Error("暂不支持")}setToFrame(e){throw new Error("暂不支持")}prepare(e,t){}release(){super.release(),this.layerHandler.release(),this.subLayers&&this.subLayers.forEach(e=>{U.layerService.releaseLayer(this.stage,e.layer)})}drawTo(e,t){var i;this.layerHandler.drawTo(e,[this],Object.assign({background:(i=t.background)!==null&&i!==void 0?i:this.background,renderService:t.renderService,viewBox:t.viewBox,transMatrix:t.transMatrix,stage:this.stage,layer:this},t)),this.afterDrawCbs.forEach(r=>r(this))}}const R0=Symbol.for("TransformUtil"),A0=Symbol.for("GraphicUtil"),kf=Symbol.for("LayerService"),B0=Symbol.for("StaticLayerHandlerContribution"),DS=Symbol.for("DynamicLayerHandlerContribution"),WS=Symbol.for("VirtualLayerHandlerContribution");var ss,NS=function(n,e,t,i){var r,o=arguments.length,s=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,e,t,i);else for(var l=n.length-1;l>=0;l--)(r=n[l])&&(s=(o<3?r(s):o>3?r(e,t,s):r(e,t))||s);return o>3&&s&&Object.defineProperty(e,t,s),s},VS=function(n,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,e)};let ls=ss=class{static GenerateLayerId(){return`${ss.idprefix}_${ss.prefix_count++}`}constructor(){this.layerMap=new Map,this.global=U.global}tryInit(){this.inited||(this.staticLayerCountInEnv=this.global.getStaticCanvasCount(),this.dynamicLayerCountInEnv=this.global.getDynamicCanvasCount(),this.inited=!0)}getStageLayer(n){return this.layerMap.get(n)}getRecommendedLayerType(n){return n||(this.staticLayerCountInEnv!==0?"static":this.dynamicLayerCountInEnv!==0?"dynamic":"virtual")}getLayerHandler(n){let e;return e=n==="static"?Ce.get(B0):n==="dynamic"?Ce.get(DS):Ce.get(WS),e}createLayer(n,e={main:!1}){var t;this.tryInit();let i=this.getRecommendedLayerType(e.layerMode);i=e.main||e.canvasId?"static":i;const r=this.getLayerHandler(i),o=new OS(n,this.global,n.window,Object.assign(Object.assign({main:!1},e),{layerMode:i,canvasId:(t=e.canvasId)!==null&&t!==void 0?t:ss.GenerateLayerId(),layerHandler:r})),s=this.layerMap.get(n)||[];return s.push(o),this.layerMap.set(n,s),this.staticLayerCountInEnv--,o}prepareStageLayer(n){let e;n.forEachChildren(t=>{const i=t.getNativeHandler();i.type==="virtual"?(i.mainHandler=e,e.secondaryHandlers.push(i)):(e=i,e.secondaryHandlers=[])})}releaseLayer(n,e){e.release();const t=this.layerMap.get(n)||[];this.layerMap.set(n,t.filter(i=>i!==e))}layerCount(n){return(this.layerMap.get(n)||[]).length}restLayerCount(n){return this.global.env==="browser"?10:0}releaseStage(n){this.layerMap.delete(n)}};ls.idprefix="visactor_layer",ls.prefix_count=0,ls=ss=NS([se(),VS("design:paramtypes",[])],ls);const GS=new we(n=>{n(yf).to(Rh).inSingletonScope(),n(Hs).to(kh),n(A0).to(Eh).inSingletonScope(),n(R0).to(Lh).inSingletonScope(),n(kf).to(ls).inSingletonScope()});function zo(n,e){return!(!n&&!e)}function rl(n,e){let t;return t=ee(n)?n.some(i=>i||i===void 0):!!n,t&&e>0}function Pr(n,e,t){return t&&n*e>0}function M0(n,e,t,i,r){return r&&n*e>0&&t!==0&&i!==0}function Ef(n,e){return n*e>0}function T0(n,e,t,i){return n*e>0&&t!==0&&i!==0}function jS(n,e,t,i,r,o,s,l){if(!n.pathProxy)return!1;const a=ve(n,o==null?void 0:o.theme)[n.type.replace("3d","")],{fill:d=a.fill,stroke:u=a.stroke,opacity:h=a.opacity,fillOpacity:c=a.fillOpacity,lineWidth:g=a.lineWidth,strokeOpacity:f=a.strokeOpacity,visible:p=a.visible,x:m=a.x,y:b=a.y}=n.attribute,C=Pr(h,c,d),_=Ef(h,f),w=zo(d),y=rl(u,g);if(!p||!w&&!y||!(C||_||s||l))return!0;e.beginPath();const v=typeof n.pathProxy=="function"?n.pathProxy(n.attribute):n.pathProxy;return Qi(v.commandList,e,t,i),e.setShadowBlendStyle&&e.setShadowBlendStyle(n,n.attribute,a),y&&_&&(e.setStrokeStyle(n,n.attribute,t-m,i-b,a),e.stroke()),w&&C&&(e.setCommonStyle(n,n.attribute,t-m,i-b,a),e.fill()),!0}function US(n,e,t,i,r,o,s,l){const a=t-n,d=i-e,u=s-r,h=l-o;let c=h*a-u*d;return c*c<Ye?[]:(c=(u*(e-o)-h*(n-r))/c,[n+c*a,e+c*d])}function $i(n,e,t,i,r,o,s){const l=n-t,a=e-i,d=(s?o:-o)/Math.sqrt(l*l+a*a),u=d*a,h=-d*l,c=n+u,g=e+h,f=t+u,p=i+h,m=(c+f)/2,b=(g+p)/2,C=f-c,_=p-g,w=C*C+_*_,y=r-o,v=c*p-f*g,x=(_<0?-1:1)*Math.sqrt(Math.max(0,y*y*w-v*v));let S=(v*_-C*x)/w,R=(-v*C-_*x)/w;const B=(v*_+C*x)/w,A=(-v*C+_*x)/w,M=S-m,H=R-b,E=B-m,T=A-b;return M*M+H*H>E*E+T*T&&(S=B,R=A),{cx:S,cy:R,x01:-u,y01:-h,x11:S*(r/y-1),y11:R*(r/y-1)}}function P0(n,e,t,i,r){const o=De(t-e),s=n.getParsedCornerRadius(),l=ee(s),{outerDeltaAngle:a,innerDeltaAngle:d,outerStartAngle:u,outerEndAngle:h,innerEndAngle:c,innerStartAngle:g}=n.getParsePadAngle(e,t),f=l?s[0]:s,p=l?s[1]:s,m=l?s[2]:s,b=l?s[3]:s,C=Math.max(p,f),_=Math.max(m,b);let w=C,y=_;const v=r*mt(u),x=r*it(u),S=i*mt(c),R=i*it(c);let B,A,M,H;if((_>Ye||C>Ye)&&(B=r*mt(h),A=r*it(h),M=i*mt(g),H=i*it(g),o<qe)){const E=US(v,x,M,H,B,A,S,R);if(E){const T=v-E[0],P=x-E[1],k=B-E[0],L=A-E[1],F=1/it(wv((T*k+P*L)/(Xi(T*T+P*P)*Xi(k*k+L*L)))/2),z=Xi(E[0]*E[0]+E[1]*E[1]);y=Ot(_,(i-z)/(F-1)),w=Ot(C,(r-z)/(F+1))}}return{outerDeltaAngle:a,xors:v,yors:x,xirs:M,yirs:H,xore:B,yore:A,xire:S,yire:R,limitedOcr:w,limitedIcr:y,outerCornerRadiusStart:f,outerCornerRadiusEnd:p,maxOuterCornerRadius:C,maxInnerCornerRadius:_,outerStartAngle:u,outerEndAngle:h,innerDeltaAngle:d,innerEndAngle:c,innerStartAngle:g,innerCornerRadiusStart:b,innerCornerRadiusEnd:m}}function Ih(n,e,t,i,r,o,s){const{startAngle:l,endAngle:a}=n.getParsedAngle(),d=De(a-l),u=a>l;let h=!1;if(r<o){const c=r;r=o,o=c}if(r<=Ye)e.moveTo(t,i);else if(d>=Ge-Ye)e.moveTo(t+r*mt(l),i+r*it(l)),e.arc(t,i,r,l,a,!u),o>Ye&&(e.moveTo(t+o*mt(a),i+o*it(a)),e.arc(t,i,o,a,l,u));else{const{outerDeltaAngle:c,xors:g,yors:f,xirs:p,yirs:m,limitedOcr:b,outerCornerRadiusStart:C,outerCornerRadiusEnd:_,maxOuterCornerRadius:w,xore:y,yore:v,xire:x,yire:S,outerStartAngle:R,outerEndAngle:B,limitedIcr:A,innerDeltaAngle:M,innerEndAngle:H,innerStartAngle:E,innerCornerRadiusStart:T,innerCornerRadiusEnd:P,maxInnerCornerRadius:k}=P0(n,l,a,o,r);if(c<.001)s&&(s[3]||s[1])&&e.moveTo(t+g,i+f),h=!0;else if(b>Ye){const L=Ot(C,b),F=Ot(_,b),z=$i(p,m,g,f,r,L,Number(u)),I=$i(y,v,x,S,r,F,Number(u));b<w&&L===F?!s||s[0]?(e.moveTo(t+z.cx+z.x01,i+z.cy+z.y01),e.arc(t+z.cx,i+z.cy,b,Fe(z.y01,z.x01),Fe(I.y01,I.x01),!u)):e.moveTo(t+z.cx+b*mt(Fe(I.y01,I.x01)),i+z.cy+b*it(Fe(I.y01,I.x01))):!s||s[0]?(e.moveTo(t+z.cx+z.x01,i+z.cy+z.y01),L>0&&e.arc(t+z.cx,i+z.cy,L,Fe(z.y01,z.x01),Fe(z.y11,z.x11),!u),e.arc(t,i,r,Fe(z.cy+z.y11,z.cx+z.x11),Fe(I.cy+I.y11,I.cx+I.x11),!u),F>0&&e.arc(t+I.cx,i+I.cy,F,Fe(I.y11,I.x11),Fe(I.y01,I.x01),!u)):F>0?e.moveTo(t+I.cx+F*mt(Fe(I.y01,I.x01)),i+I.cy+F*it(Fe(I.y01,I.x01))):e.moveTo(t+y,i+r*it(B))}else!s||s[0]?(e.moveTo(t+g,i+f),e.arc(t,i,r,R,B,!u)):e.moveTo(t+r*mt(B),i+r*it(B));if(!(o>Ye)||M<.001)!s||s[1]?e.lineTo(t+x,i+S):e.moveTo(t+x,i+S),h=!0;else if(A>Ye){const L=Ot(T,A),F=Ot(P,A),z=$i(x,S,y,v,o,-F,Number(u)),I=$i(g,f,p,m,o,-L,Number(u));if(!s||s[1]?e.lineTo(t+z.cx+z.x01,i+z.cy+z.y01):e.moveTo(t+z.cx+z.x01,i+z.cy+z.y01),A<k&&L===F){const N=Fe(I.y01,I.x01);!s||s[2]?e.arc(t+z.cx,i+z.cy,A,Fe(z.y01,z.x01),N,!u):e.moveTo(t+z.cx+mt(N),i+z.cy+it(N))}else!s||s[2]?(F>0&&e.arc(t+z.cx,i+z.cy,F,Fe(z.y01,z.x01),Fe(z.y11,z.x11),!u),e.arc(t,i,o,Fe(z.cy+z.y11,z.cx+z.x11),Fe(I.cy+I.y11,I.cx+I.x11),u),L>0&&e.arc(t+I.cx,i+I.cy,L,Fe(I.y11,I.x11),Fe(I.y01,I.x01),!u)):L>0?e.moveTo(t+I.cx+L*mt(Fe(I.y01,I.x01)),i+I.cy+L*it(Fe(I.y01,I.x01))):e.moveTo(t+p,i+m)}else!s||s[1]?e.lineTo(t+x,i+S):e.moveTo(t+x,i+S),!s||s[2]?e.arc(t,i,o,H,E,u):e.moveTo(t+o*mt(E),i+o*it(E))}return s?s[3]&&e.lineTo(t+r*mt(l),i+r*it(l)):e.closePath(),h}class yn{static GetCanvas(){try{return yn.canvas||(yn.canvas=U.global.createCanvas({})),yn.canvas}catch{return null}}static GetCtx(){if(!yn.ctx){const e=yn.GetCanvas();yn.ctx=e.getContext("2d")}return yn.ctx}}class pr extends yv{static getInstance(){return pr._instance||(pr._instance=new pr),pr._instance}constructor(e=[],t=100){super(),this.cacheParams={CLEAN_THRESHOLD:100,L_TIME:1e3},this.dataMap=new Map;const i=yn.GetCanvas(),r=yn.GetCtx();if(i.width=t,i.height=1,!r)return;if(r.translate(0,0),!r)throw new Error("获取ctx发生错误");const o=r.createLinearGradient(0,0,t,0);e.forEach(s=>{o.addColorStop(s[0],s[1])}),r.fillStyle=o,r.fillRect(0,0,t,1),this.rgbaSet=r.getImageData(0,0,t,1).data}getColor(e){const t=this.rgbaSet.slice(4*e,4*e+4);return`rgba(${t[0]}, ${t[1]}, ${t[2]}, ${t[3]/255})`}GetOrCreate(e,t,i,r,o=[],s=100){let l=`${e}${t}${i}${r}`;o.forEach(d=>l+=d.join()),l+=s;let a=this.dataMap.get(l);return a||(a={data:new pr(o,s),timestamp:[]},this.addLimitedTimestamp(a,Date.now(),{}),this.dataMap.set(l,a)),this.clearCache(this.dataMap,this.cacheParams),a.data}}class zt{static GetSize(e){for(let t=0;t<zt.ImageSize.length;t++)if(zt.ImageSize[t]>=e)return zt.ImageSize[t];return e}static Get(e,t,i,r,o,s,l){const a=zt.GenKey(e,t,i,r,o),d=zt.cache[a];if(!d||d.length===0)return null;for(let u=0;u<d.length;u++)if(d[u].width>=s&&d[u].height>=l)return d[u].pattern;return null}static Set(e,t,i,r,o,s,l,a){const d=zt.GenKey(e,t,i,r,o);zt.cache[d]?zt.cache[d].push({width:l,height:a,pattern:s}):zt.cache[d]=[{width:l,height:a,pattern:s}]}static GenKey(e,t,i,r,o){return`${t},${i},${r},${o},${e.join()}`}}zt.cache={},zt.ImageSize=[20,40,80,160,320,640,1280,2560];function $S(n,e,t,i){const{stops:r,startAngle:o,endAngle:s}=i;for(;t<0;)t+=Ge;for(;t>Ge;)t-=Ge;if(t<o||t>s)return r[0].color;let l,a,d=(t-o)/(s-o);for(let u=0;u<r.length;u++)if(r[u].offset>=d){l=r[u-1],a=r[u];break}return d=(d-l.offset)/(a.offset-l.offset),uo(l.color,a.color,d,!1)}function KS(n,e,t,i,r,o,s,l,a){const d=Math.floor(180*r/Math.PI),u=yn.GetCanvas(),h=yn.GetCtx();if(!h)return null;const c=zt.GetSize(l),g=zt.GetSize(a);let f=zt.Get(e,t,i,o,s,c,g);if(f)return f;const p=Math.sqrt(Math.max(Math.max(Math.pow(t,2)+Math.pow(i,2),Math.pow(c-t,2)+Math.pow(i,2)),Math.max(Math.pow(c-t,2)+Math.pow(g-i,2),Math.pow(t,2)+Math.pow(g-i,2)))),m=d+1,b=r/Math.max(1,m-1),C=pr.getInstance().GetOrCreate(t,i,c,g,e,m),_=2*Math.PI*p/360;u.width=c,u.height=g,h.setTransform(1,0,0,1,0,0),h.clearRect(0,0,c,g),h.translate(t,i),h.rotate(o);for(let y=0,v=m-1;y<v&&!(o+y*b>s);y++){const x=C.getColor(y);h.beginPath(),h.rotate(b),h.moveTo(0,0),h.lineTo(p,-2*_),h.lineTo(p,0),h.fillStyle=x,h.closePath(),h.fill()}const w=h.getImageData(0,0,c,g);return u.width=w.width,u.height=w.height,h.putImageData(w,0,0),f=n.createPattern(u,"no-repeat"),f&&zt.Set(e,t,i,o,s,f,c,g),f}const Oh=Symbol.for("ArcRenderContribution"),YS=Symbol.for("AreaRenderContribution"),Dh=Symbol.for("CircleRenderContribution"),En=Symbol.for("GroupRenderContribution"),yr=Symbol.for("ImageRenderContribution"),Wh=Symbol.for("PathRenderContribution"),Nh=Symbol.for("PolygonRenderContribution"),vr=Symbol.for("RectRenderContribution"),Vh=Symbol.for("SymbolRenderContribution"),ma=Symbol.for("TextRenderContribution"),Lf=Symbol.for("InteractiveSubRenderContribution");function So(n,e){return n==="end"||n==="right"?-e:n==="center"?-e/2:0}function Es(n,e,t,i=0){return n==="middle"?-e/2:n==="top"?0:n==="bottom"?i-e:n&&n!=="alphabetic"?0:(t||(t=e),-(e-t)/2-.79*t)}function cO(n){const e={},t=i=>/^\d+(\.\d+)?$/.test(`${i}`)?`${i}px`:`${i}`;return["textAlign","fontFamily","fontVariant","fontStyle","fontWeight"].forEach(i=>{n[i]&&(e[gg(i)]=n[i])}),["fontSize","lineHeight"].forEach(i=>{const r=gg(i);Te(n[i])||(e[r]=t(n[i]))}),O(n.maxLineWidth)&&(e["max-width"]=t(n.maxLineWidth)),n.underline?e["text-decoration"]="underline":n.lineThrough&&(e["text-decoration"]="line-through"),n.fill&&je(n.fill)&&(e.color=n.fill),e}function H0(n){return n[0]=1,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=1,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=1,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n}function XS(n,e,t){const i=Math.sin(t),r=Math.cos(t),o=e[4],s=e[5],l=e[6],a=e[7],d=e[8],u=e[9],h=e[10],c=e[11];return e!==n&&(n[0]=e[0],n[1]=e[1],n[2]=e[2],n[3]=e[3],n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15]),n[4]=o*r+d*i,n[5]=s*r+u*i,n[6]=l*r+h*i,n[7]=a*r+c*i,n[8]=d*r-o*i,n[9]=u*r-s*i,n[10]=h*r-l*i,n[11]=c*r-a*i,n}function qS(n,e,t){const i=Math.sin(t),r=Math.cos(t),o=e[0],s=e[1],l=e[2],a=e[3],d=e[8],u=e[9],h=e[10],c=e[11];return e!==n&&(n[4]=e[4],n[5]=e[5],n[6]=e[6],n[7]=e[7],n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15]),n[0]=o*r-d*i,n[1]=s*r-u*i,n[2]=l*r-h*i,n[3]=a*r-c*i,n[8]=o*i+d*r,n[9]=s*i+u*r,n[10]=l*i+h*r,n[11]=a*i+c*r,n}function ZS(n,e,t){const i=Math.sin(t),r=Math.cos(t),o=e[0],s=e[1],l=e[2],a=e[3],d=e[4],u=e[5],h=e[6],c=e[7];return e!==n&&(n[8]=e[8],n[9]=e[9],n[10]=e[10],n[11]=e[11],n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15]),n[0]=o*r+d*i,n[1]=s*r+u*i,n[2]=l*r+h*i,n[3]=a*r+c*i,n[4]=d*r-o*i,n[5]=u*r-s*i,n[6]=h*r-l*i,n[7]=c*r-a*i,n}function qo(n,e,t){const i=t[0],r=t[1],o=t[2];let s,l,a,d,u,h,c,g,f,p,m,b;return e===n?(n[12]=e[0]*i+e[4]*r+e[8]*o+e[12],n[13]=e[1]*i+e[5]*r+e[9]*o+e[13],n[14]=e[2]*i+e[6]*r+e[10]*o+e[14],n[15]=e[3]*i+e[7]*r+e[11]*o+e[15]):(s=e[0],l=e[1],a=e[2],d=e[3],u=e[4],h=e[5],c=e[6],g=e[7],f=e[8],p=e[9],m=e[10],b=e[11],n[0]=s,n[1]=l,n[2]=a,n[3]=d,n[4]=u,n[5]=h,n[6]=c,n[7]=g,n[8]=f,n[9]=p,n[10]=m,n[11]=b,n[12]=s*i+u*r+f*o+e[12],n[13]=l*i+h*r+p*o+e[13],n[14]=a*i+c*r+m*o+e[14],n[15]=d*i+g*r+b*o+e[15]),n}function Gh(n,e){n[0]=e.a,n[1]=e.b,n[2]=0,n[3]=0,n[4]=e.c,n[5]=e.d,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=1,n[11]=0,n[12]=e.e,n[13]=e.f,n[14]=0,n[15]=1}function JS(n,e,t){const i=t[0],r=t[1],o=t[2];return n[0]=e[0]*i,n[1]=e[1]*i,n[2]=e[2]*i,n[3]=e[3]*i,n[4]=e[4]*r,n[5]=e[5]*r,n[6]=e[6]*r,n[7]=e[7]*r,n[8]=e[8]*o,n[9]=e[9]*o,n[10]=e[10]*o,n[11]=e[11]*o,n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15],n}function ol(n,e,t){const i=e[0],r=e[1],o=e[2],s=e[3],l=e[4],a=e[5],d=e[6],u=e[7],h=e[8],c=e[9],g=e[10],f=e[11],p=e[12],m=e[13],b=e[14],C=e[15];let _=t[0],w=t[1],y=t[2],v=t[3];return n[0]=_*i+w*l+y*h+v*p,n[1]=_*r+w*a+y*c+v*m,n[2]=_*o+w*d+y*g+v*b,n[3]=_*s+w*u+y*f+v*C,_=t[4],w=t[5],y=t[6],v=t[7],n[4]=_*i+w*l+y*h+v*p,n[5]=_*r+w*a+y*c+v*m,n[6]=_*o+w*d+y*g+v*b,n[7]=_*s+w*u+y*f+v*C,_=t[8],w=t[9],y=t[10],v=t[11],n[8]=_*i+w*l+y*h+v*p,n[9]=_*r+w*a+y*c+v*m,n[10]=_*o+w*d+y*g+v*b,n[11]=_*s+w*u+y*f+v*C,_=t[12],w=t[13],y=t[14],v=t[15],n[12]=_*i+w*l+y*h+v*p,n[13]=_*r+w*a+y*c+v*m,n[14]=_*o+w*d+y*g+v*b,n[15]=_*s+w*u+y*f+v*C,n}function Hn(n,e,t){const i=e[0],r=e[1],o=e[2];let s=t[3]*i+t[7]*r+t[11]*o+t[15];return s=s||1,n[0]=(t[0]*i+t[4]*r+t[8]*o+t[12])/s,n[1]=(t[1]*i+t[5]*r+t[9]*o+t[13])/s,n[2]=(t[2]*i+t[6]*r+t[10]*o+t[14])/s,n}function Jg(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}class QS{constructor(){this.pools=[]}allocate(e,t,i,r,o,s){if(!this.pools.length)return new Ht(e,t,i,r,o,s);const l=this.pools.pop();return l.a=e,l.b=t,l.c=i,l.d=r,l.e=o,l.f=s,l}allocateByObj(e){if(!this.pools.length)return new Ht(e.a,e.b,e.c,e.d,e.e,e.f);const t=this.pools.pop();return t.a=e.a,t.b=e.b,t.c=e.c,t.d=e.d,t.e=e.e,t.f=e.f,t}free(e){this.pools.push(e)}get length(){return this.pools.length}release(...e){this.pools=[]}}class Ff{constructor(){this.pools=[]}static identity(e){return H0(e)}allocate(){if(!this.pools.length)return Jg();const e=this.pools.pop();return Ff.identity(e),e}allocateByObj(e){let t;t=this.pools.length?this.pools.pop():Jg();for(let i=0;i<t.length;i++)t[i]=e[i];return t}free(e){e&&this.pools.push(e)}get length(){return this.pools.length}release(...e){this.pools=[]}}const Zt=new QS,ft=new Ff;var ex=function(n,e,t,i){var r,o=arguments.length,s=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,e,t,i);else for(var l=n.length-1;l>=0;l--)(r=n[l])&&(s=(o<3?r(s):o>3?r(e,t,s):r(e,t))||s);return o>3&&s&&Object.defineProperty(e,t,s),s},tx=function(n,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,e)},nx=function(n,e){return function(t,i){e(t,i,n)}};function k0(n,e,t){var i;const{x:r=t.x,y:o=t.y,z:s=t.z,dx:l=t.dx,dy:a=t.dy,dz:d=t.dz,scaleX:u=t.scaleX,scaleY:h=t.scaleY,scaleZ:c=t.scaleZ,alpha:g=t.alpha,beta:f=t.beta,angle:p=t.angle,anchor3d:m=e.attribute.anchor,anchor:b}=e.attribute,C=[0,0,0];if(m){if(typeof m[0]=="string"){const _=parseFloat(m[0])/100,w=e.AABBBounds;C[0]=w.x1+(w.x2-w.x1)*_}else C[0]=m[0];if(typeof m[1]=="string"){const _=parseFloat(m[1])/100,w=e.AABBBounds;C[1]=w.x1+(w.x2-w.x1)*_}else C[1]=m[1];C[2]=(i=m[2])!==null&&i!==void 0?i:0}if(H0(n),qo(n,n,[r+l,o+a,s+d]),qo(n,n,[C[0],C[1],C[2]]),XS(n,n,f),qS(n,n,g),qo(n,n,[-C[0],-C[1],C[2]]),JS(n,n,[u,h,c]),p){const _=ft.allocate(),w=[0,0];if(b){if(typeof m[0]=="string"){const y=parseFloat(m[0])/100,v=e.AABBBounds;w[0]=v.x1+(v.x2-v.x1)*y}else w[0]=m[0];if(typeof m[1]=="string"){const y=parseFloat(m[1])/100,v=e.AABBBounds;w[1]=v.x1+(v.x2-v.x1)*y}else w[1]=m[1]}qo(_,_,[w[0],w[1],0]),ZS(_,_,p),qo(_,_,[-w[0],-w[1],0]),ol(n,n,_)}}function ix(n){const{alpha:e,beta:t}=n.attribute;return e||t}let jh=class{constructor(n){this.creator=n,this.hooks={onAttributeUpdate:new Xt(["graphic"]),onSetStage:new Xt(["graphic","stage"]),onRemove:new Xt(["graphic"]),onRelease:new Xt(["graphic"]),onAddIncremental:new Xt(["graphic","group","stage"]),onClearIncremental:new Xt(["graphic","group","stage"]),beforeUpdateAABBBounds:new Xt(["graphic","stage","willUpdate","aabbBounds"]),afterUpdateAABBBounds:new Xt(["graphic","stage","aabbBounds","globalAABBBounds","selfChange"]),clearAABBBounds:new Xt(["graphic","stage","aabbBounds"])},this.tempAABBBounds1=new Ue,this.tempAABBBounds2=new Ue}onAttributeUpdate(n){this.hooks.onAttributeUpdate.taps.length&&this.hooks.onAttributeUpdate.call(n)}onSetStage(n,e){this.hooks.onSetStage.taps.length&&this.hooks.onSetStage.call(n,e)}onRemove(n){this.hooks.onRemove.taps.length&&this.hooks.onRemove.call(n)}onRelease(n){this.hooks.onRelease.taps.length&&this.hooks.onRelease.call(n)}onAddIncremental(n,e,t){this.hooks.onAddIncremental.taps.length&&this.hooks.onAddIncremental.call(n,e,t)}onClearIncremental(n,e){this.hooks.onClearIncremental.taps.length&&this.hooks.onClearIncremental.call(n,e)}beforeUpdateAABBBounds(n,e,t,i){this.hooks.beforeUpdateAABBBounds.taps.length&&this.hooks.beforeUpdateAABBBounds.call(n,e,t,i)}afterUpdateAABBBounds(n,e,t,i,r){this.hooks.afterUpdateAABBBounds.taps.length&&this.hooks.afterUpdateAABBBounds.call(n,e,t,i,r)}clearAABBBounds(n,e,t){this.hooks.clearAABBBounds.taps.length&&this.hooks.clearAABBBounds.call(n,e,t)}updatePathProxyAABBBounds(n,e){const t=typeof e.pathProxy=="function"?e.pathProxy(e.attribute):e.pathProxy;if(!t)return!1;const i=new vf(n);return Qi(t.commandList,i,0,0),!0}updateHTMLTextAABBBounds(n,e,t,i){const{textAlign:r,textBaseline:o}=n;if(n.forceBoundsHeight!=null){const s=J(n.forceBoundsHeight)?n.forceBoundsHeight:n.forceBoundsHeight(),l=Es(o,s,s);t.set(t.x1,l,t.x2,l+s)}if(n.forceBoundsWidth!=null){const s=J(n.forceBoundsWidth)?n.forceBoundsWidth:n.forceBoundsWidth(),l=So(r,s);t.set(l,t.y1,l+s,t.y2)}}combindShadowAABBBounds(n,e){if(e&&e.shadowRoot){const t=e.shadowRoot.AABBBounds;n.union(t)}}transformAABBBounds(n,e,t,i,r){if(!e.empty()){const{scaleX:l=t.scaleX,scaleY:a=t.scaleY,stroke:d=t.stroke,shadowBlur:u=t.shadowBlur,lineWidth:h=t.lineWidth,pickStrokeBuffer:c=t.pickStrokeBuffer,strokeBoundsBuffer:g=t.strokeBoundsBuffer}=n,f=this.tempAABBBounds1,p=this.tempAABBBounds2;if(d&&h){const m=(h+c)/Math.abs(l+a);ga(f,m,i,g),e.union(f),f.setValue(p.x1,p.y1,p.x2,p.y2)}if(u){const{shadowOffsetX:m=t.shadowOffsetX,shadowOffsetY:b=t.shadowOffsetY}=n,C=u/Math.abs(l+a)*2;ga(f,C,!1,g+1),f.translate(m,b),e.union(f)}}if(this.combindShadowAABBBounds(e,r),e.empty())return;let o=!0;const s=r.transMatrix;r&&r.isContainer&&(o=!(s.a===1&&s.b===0&&s.c===0&&s.d===1&&s.e===0&&s.f===0)),o&&L_(e,e,s)}validCheck(n,e,t,i){if(!i||n.forceBoundsHeight!=null||n.forceBoundsWidth!=null||i.shadowRoot||i.isContainer)return!0;const{visible:r=e.visible}=n;return!(!i.valid||!r)||(t.empty()||(i.parent&&t.transformWithMatrix(i.parent.globalTransMatrix),U.graphicService.clearAABBBounds(i,i.stage,t),t.clear()),!1)}updateTempAABBBounds(n){const e=this.tempAABBBounds1,t=this.tempAABBBounds2;return e.setValue(n.x1,n.y1,n.x2,n.y2),t.setValue(n.x1,n.y1,n.x2,n.y2),{tb1:e,tb2:t}}};jh=ex([se(),nx(0,Be(S0)),tx("design:paramtypes",[Object])],jh);const st={x:0,y:0,z:0,lastModelMatrix:null};class tn{init(e){e&&(this._renderContribitions=e.getContributions()),this._renderContribitions||(this._renderContribitions=[]),this.builtinContributions&&this.builtinContributions.forEach(t=>this._renderContribitions.push(t)),this._renderContribitions.length&&(this._renderContribitions.sort((t,i)=>i.order-t.order),this._beforeRenderContribitions=this._renderContribitions.filter(t=>t.time===Ee.beforeFillStroke),this._afterRenderContribitions=this._renderContribitions.filter(t=>t.time===Ee.afterFillStroke))}beforeRenderStep(e,t,i,r,o,s,l,a,d,u,h,c,g){this._beforeRenderContribitions&&this._beforeRenderContribitions.forEach(f=>{f.supportedAppName&&e.stage&&e.stage.params&&e.stage.params.context&&e.stage.params.context.appName&&!(Array.isArray(f.supportedAppName)?f.supportedAppName:[f.supportedAppName]).includes(e.stage.params.context.appName)||f.drawShape(e,t,i,r,o,s,l,a,d,u,h,c,g)})}afterRenderStep(e,t,i,r,o,s,l,a,d,u,h,c,g){this._afterRenderContribitions&&this._afterRenderContribitions.forEach(f=>{f.supportedAppName&&e.stage&&e.stage.params&&e.stage.params.context&&e.stage.params.context.appName&&!(Array.isArray(f.supportedAppName)?f.supportedAppName:[f.supportedAppName]).includes(e.stage.params.context.appName)||f.drawShape(e,t,i,r,o,s,l,a,d,u,h,c,g)})}valid(e,t,i,r){const{fill:o=t.fill,background:s,stroke:l=t.stroke,opacity:a=t.opacity,fillOpacity:d=t.fillOpacity,lineWidth:u=t.lineWidth,strokeOpacity:h=t.strokeOpacity,visible:c=t.visible}=e.attribute,g=Pr(a,d,o),f=Ef(a,h),p=zo(o,s),m=rl(l,u);return!(!e.valid||!c)&&!(!p&&!m)&&!!(g||f||i||r||s)&&{fVisible:g,sVisible:f,doFill:p,doStroke:m}}transform(e,t,i,r=!1){const{x:o=t.x,y:s=t.y,z:l=t.z,scaleX:a=t.scaleX,scaleY:d=t.scaleY,angle:u=t.angle,postMatrix:h}=e.attribute,c=i.modelMatrix,g=i.camera;st.x=o,st.y=s,st.z=l,st.lastModelMatrix=c;const f=g&&(r||ix(e)),p=f?e.transMatrix.onlyTranslate()&&!h:a===1&&d===1&&u===0&&!h;if(f){const m=ft.allocate(),b=ft.allocate();k0(b,e,t),ol(m,c||m,b),st.x=0,st.y=0,st.z=0,i.modelMatrix=m,i.setTransform(1,0,0,1,0,0,!0),ft.free(b)}if(p&&!c){const m=e.getOffsetXY(t);st.x+=m.x,st.y+=m.y,st.z=l,i.setTransformForCurrent()}else if(f)st.x=0,st.y=0,st.z=0,i.setTransform(1,0,0,1,0,0,!0);else if(g&&i.project){const m=e.getOffsetXY(t);st.x+=m.x,st.y+=m.y,this.transformWithoutTranslate(i,st.x,st.y,st.z,a,d,u)}else i.transformFromMatrix(e.transMatrix,!0),st.x=0,st.y=0,st.z=0;return st}transformUseContext2d(e,t,i,r){const o=r.camera;if(this.camera=o,o){const s=e.AABBBounds,l=s.x2-s.x1,a=s.y2-s.y1,d=r.project(0,0,i),u=r.project(l,0,i),h=r.project(l,a,i),c={x:0,y:0},g={x:l,y:0},f={x:l,y:a};r.camera=null;const p=1/(c.x*(f.y-g.y)-g.x*f.y+f.x*g.y+(g.x-f.x)*c.y),m=-(c.y*(h.x-u.x)-g.y*h.x+f.y*u.x+(g.y-f.y)*d.x)*p,b=(g.y*h.y+c.y*(u.y-h.y)-f.y*u.y+(f.y-g.y)*d.y)*p,C=(c.x*(h.x-u.x)-g.x*h.x+f.x*u.x+(g.x-f.x)*d.x)*p,_=-(g.x*h.y+c.x*(u.y-h.y)-f.x*u.y+(f.x-g.x)*d.y)*p,w=(c.x*(f.y*u.x-g.y*h.x)+c.y*(g.x*h.x-f.x*u.x)+(f.x*g.y-g.x*f.y)*d.x)*p,y=(c.x*(f.y*u.y-g.y*h.y)+c.y*(g.x*h.y-f.x*u.y)+(f.x*g.y-g.x*f.y)*d.y)*p;r.setTransform(m,b,C,_,w,y,!0)}}restoreTransformUseContext2d(e,t,i,r){this.camera&&(r.camera=this.camera)}transformWithoutTranslate(e,t,i,r,o,s,l){const a=e.project(t,i,r);e.translate(a.x,a.y,!1),e.scale(o,s,!1),e.rotate(l,!1),e.translate(-a.x,-a.y,!1),e.setTransformForCurrent()}_draw(e,t,i,r,o){const{context:s}=r;if(!s)return;const{renderable:l}=e.attribute;if(l===!1)return;s.highPerformanceSave();const a=this.transform(e,t,s,i),{x:d,y:u,z:h,lastModelMatrix:c}=a;this.z=h,jS(e,s,d,u,r,o)||(this.drawShape(e,s,d,u,r,o),this.z=0,s.modelMatrix!==c&&ft.free(s.modelMatrix),s.modelMatrix=c),s.highPerformanceRestore()}}var rx=function(n,e,t,i){var r,o=arguments.length,s=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,e,t,i);else for(var l=n.length-1;l>=0;l--)(r=n[l])&&(s=(o<3?r(s):o>3?r(e,t,s):r(e,t))||s);return o>3&&s&&Object.defineProperty(e,t,s),s},ox=function(n,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,e)},Qg=function(n,e){return function(t,i){e(t,i,n)}};class ou{constructor(){this.time=Ee.beforeFillStroke,this.useStyle=!0,this.order=0}drawShape(e,t,i,r,o,s,l,a,d,u,h,c,g){var f;const{background:p,backgroundOpacity:m=(f=e.attribute.fillOpacity)!==null&&f!==void 0?f:d.backgroundOpacity,opacity:b=d.opacity,backgroundMode:C=d.backgroundMode,backgroundFit:_=d.backgroundFit}=e.attribute;if(p)if(e.backgroundImg&&e.resources){const w=e.resources.get(p);if(w.state!=="success"||!w.data)return;if(t.save(),e.parent&&!e.transMatrix.onlyTranslate()){const v=ve(e.parent).group,{scrollX:x=v.scrollX,scrollY:S=v.scrollY}=e.parent.attribute;t.setTransformFromMatrix(e.parent.globalTransMatrix,!0),t.translate(x,S)}t.clip();const y=e.AABBBounds;t.setCommonStyle(e,e.attribute,i,r,d),t.globalAlpha=m*b,this.doDrawImage(t,w.data,y,C,_),t.restore(),e.transMatrix.onlyTranslate()||t.setTransformForCurrent()}else t.highPerformanceSave(),t.setCommonStyle(e,e.attribute,i,r,d),t.globalAlpha=m*b,t.fillStyle=p,t.fill(),t.highPerformanceRestore()}doDrawImage(e,t,i,r,o){if(r==="no-repeat")e.drawImage(t,i.x1,i.y1,i.width(),i.height());else{const s=i.width(),l=i.height();let a=s,d=l;if(o&&r!=="repeat"&&(t.width||t.height)){const c=t.width,g=t.height;r==="repeat-x"?(a=c*(l/g),d=l):r==="repeat-y"&&(d=g*(s/c),a=s);const f=e.dpr,p=vo.allocate({width:a,height:d,dpr:f}),m=p.getContext("2d");m&&(m.inuse=!0,m.clearMatrix(),m.setTransformForCurrent(!0),m.clearRect(0,0,a,d),m.drawImage(t,0,0,a,d),t=p.nativeCanvas),vo.free(p)}const u=e.dpr,h=e.createPattern(t,r);h.setTransform&&h.setTransform(new DOMMatrix([1/u,0,0,1/u,0,0])),e.fillStyle=h,e.translate(i.x1,i.y1),e.fillRect(0,0,s,l),e.translate(-i.x1,-i.y1)}}}const tr=new ou;let Dn=class{constructor(n){this.subRenderContribitions=n,this.time=Ee.afterFillStroke,this.useStyle=!0,this.order=0}drawShape(n,e,t,i,r,o,s,l,a,d,u,h,c){this._subRenderContribitions||(this._subRenderContribitions=this.subRenderContribitions.getContributions()),this._subRenderContribitions.forEach(g=>{g.render(n,e,t,i,r,o,s,l,a,d,u,h,c)})}};Dn=rx([se(),Qg(0,Be(gt)),Qg(0,At(Lf)),ox("design:paramtypes",[Object])],Dn);class zf{constructor(){this.time=Ee.afterFillStroke,this.useStyle=!0,this.order=10}createCommonPattern(e,t,i,r,o){const s=(e-2*t)/2,l=r.dpr,a=vo.allocate({width:e,height:e,dpr:l}),d=a.getContext("2d");if(!d)return null;d.inuse=!0,d.clearMatrix(),d.setTransformForCurrent(!0),d.clearRect(0,0,e,e),o(s,d);const u=r.createPattern(a.nativeCanvas,"repeat");return u.setTransform&&u.setTransform(new DOMMatrix([1/l,0,0,1/l,0,0])),vo.free(a),u}createCirclePattern(e,t,i,r){return this.createCommonPattern(e,t,i,r,(o,s)=>{s.fillStyle=i,s.arc(o,o,o,0,Ge),s.fill()})}createDiamondPattern(e,t,i,r){return this.createCommonPattern(e,t,i,r,(o,s)=>{const l=e/2,a=l;s.fillStyle=i,s.moveTo(l,a-o),s.lineTo(o+l,a),s.lineTo(l,a+o),s.lineTo(l-o,a),s.closePath(),s.fill()})}createRectPattern(e,t,i,r){return this.createCommonPattern(e,t,i,r,(o,s)=>{const l=t,a=l;s.fillStyle=i,s.fillRect(l,a,2*o,2*o)})}createVerticalLinePattern(e,t,i,r){return this.createCommonPattern(e,t,i,r,(o,s)=>{const l=t;s.fillStyle=i,s.fillRect(l,0,2*o,e)})}createHorizontalLinePattern(e,t,i,r){return this.createCommonPattern(e,t,i,r,(o,s)=>{const l=t;s.fillStyle=i,s.fillRect(0,l,e,2*o)})}createBiasLRLinePattern(e,t,i,r){return this.createCommonPattern(e,t,i,r,(o,s)=>{s.strokeStyle=i,s.lineWidth=o,s.moveTo(0,0),s.lineTo(e,e);const l=e/2,a=-l;s.moveTo(l,a),s.lineTo(l+e,a+e),s.moveTo(-l,-a),s.lineTo(-l+e,-a+e),s.stroke()})}createBiasRLLinePattern(e,t,i,r){return this.createCommonPattern(e,t,i,r,(o,s)=>{s.strokeStyle=i,s.lineWidth=o,s.moveTo(e,0),s.lineTo(0,e);const l=e/2,a=l;s.moveTo(e+l,a),s.lineTo(l,a+e),s.moveTo(e-l,-a),s.lineTo(-l,-a+e),s.stroke()})}createGridPattern(e,t,i,r){return this.createCommonPattern(e,t,i,r,(o,s)=>{const l=t,a=l;s.fillStyle=i,s.fillRect(l,a,o,o),s.fillRect(l+o,a+o,o,o)})}initTextureMap(e,t){this.textureMap=new Map}drawShape(e,t,i,r,o,s,l,a,d,u,h,c,g){this.textureMap||this.initTextureMap(t,e.stage);const{texture:f=d.texture,textureColor:p=d.textureColor,textureSize:m=d.textureSize,texturePadding:b=d.texturePadding}=e.attribute;f&&this.drawTexture(f,e,t,i,r,d,p,m,b)}drawTexture(e,t,i,r,o,s,l,a,d){let u=this.textureMap.get(e);if(!u)switch(e){case"circle":u=this.createCirclePattern(a,d,l,i);break;case"diamond":u=this.createDiamondPattern(a,d,l,i);break;case"rect":u=this.createRectPattern(a,d,l,i);break;case"vertical-line":u=this.createVerticalLinePattern(a,d,l,i);break;case"horizontal-line":u=this.createHorizontalLinePattern(a,d,l,i);break;case"bias-lr":u=this.createBiasLRLinePattern(a,d,l,i);break;case"bias-rl":u=this.createBiasRLLinePattern(a,d,l,i);break;case"grid":u=this.createGridPattern(a,d,l,i)}u&&(i.highPerformanceSave(),i.setCommonStyle(t,t.attribute,r,o,s),i.fillStyle=u,i.fill(),i.highPerformanceRestore())}}const Io=new zf;class sx{constructor(){this.time=Ee.afterFillStroke,this.useStyle=!0,this.order=0}drawShape(e,t,i,r,o,s,l,a,d,u,h,c){const{outerBorder:g,innerBorder:f}=e.attribute,p=g&&g.visible!==!1,m=f&&f.visible!==!1;if(!p&&!m)return;const{innerPadding:b=d.innerPadding,outerPadding:C=d.outerPadding,startAngle:_=d.startAngle,endAngle:w=d.endAngle,opacity:y=d.opacity,x:v=d.x,y:x=d.y,scaleX:S=d.scaleX,scaleY:R=d.scaleY,keepStrokeScale:B=d.keepStrokeScale}=e.attribute;let{innerRadius:A=d.innerRadius,outerRadius:M=d.outerRadius}=e.attribute;M+=C,A-=b;const H=(E,T)=>{const P=!(!E||!E.stroke),{distance:k=d[T].distance}=E,L=B?k:Bi(t,k,t.dpr),F=k/M,z=T==="outerBorder"?1:-1;if(e.setAttributes({outerRadius:M+z*L,innerRadius:A-z*L,startAngle:_-z*F,endAngle:w+z*F}),t.beginPath(),Ih(e,t,i,r,M+z*L,A-z*L),t.setShadowBlendStyle&&t.setShadowBlendStyle(e,e.attribute,d),c)c(t,E,d[T]);else if(P){const I=d[T].opacity;d[T].opacity=y,t.setStrokeStyle(e,E,(v-i)/S,(x-r)/R,d[T]),d[T].opacity=I,t.stroke()}};p&&H(g,"outerBorder"),m&&H(f,"innerBorder"),e.setAttributes({outerRadius:M,innerRadius:A,startAngle:_,endAngle:w})}}const lx=new sx,ax=Io,dx=tr;class ux{constructor(){this.time=Ee.afterFillStroke,this.useStyle=!0,this.order=0}drawShape(e,t,i,r,o,s,l,a,d,u,h,c){const{outerBorder:g,innerBorder:f}=e.attribute,p=g&&g.visible!==!1,m=f&&f.visible!==!1;if(!p&&!m)return;const{radius:b=d.radius,startAngle:C=d.startAngle,endAngle:_=d.endAngle,opacity:w=d.opacity,x:y=d.x,y:v=d.y,scaleX:x=d.scaleX,scaleY:S=d.scaleY,keepStrokeScale:R=d.keepStrokeScale}=e.attribute,B=(A,M)=>{const H=!(!A||!A.stroke),{distance:E=d[M].distance}=A,T=R?E:Bi(t,E,t.dpr),P=M==="outerBorder"?1:-1;if(t.beginPath(),t.arc(i,r,b+P*T,C,_),t.closePath(),t.setShadowBlendStyle&&t.setShadowBlendStyle(e,e.attribute,d),c)c(t,A,d[M]);else if(H){const k=d[M].opacity;d[M].opacity=w,t.setStrokeStyle(e,A,(y-i)/x,(v-r)/S,d[M]),d[M].opacity=k,t.stroke()}};p&&B(g,"outerBorder"),m&&B(f,"innerBorder")}}const hx=new ux,cx=Io,fx=tr;class gx extends ou{constructor(){super(...arguments),this.time=Ee.beforeFillStroke}drawShape(e,t,i,r,o,s,l,a,d,u,h,c){const{background:g,backgroundMode:f=d.backgroundMode,backgroundFit:p=d.backgroundFit}=e.attribute;if(g)if(e.backgroundImg&&e.resources){const m=e.resources.get(g);if(m.state!=="success"||!m.data)return;t.highPerformanceSave(),t.setTransformFromMatrix(e.parent.globalTransMatrix,!0);const b=e.AABBBounds;this.doDrawImage(t,m.data,b,f,p),t.highPerformanceRestore(),t.setTransformForCurrent()}else t.highPerformanceSave(),t.fillStyle=g,t.fill(),t.highPerformanceRestore()}}const px=new gx,Al=qe/2;function ni(n,e,t,i,r,o,s){let l;if(i<0&&(e+=i,i=-i),r<0&&(t+=r,r=-r),J(o,!0))l=[o=De(o),o,o,o];else if(Array.isArray(o)){const v=o;let x,S;switch(v.length){case 0:l=[0,0,0,0];break;case 1:x=De(v[0]),l=[x,x,x,x];break;case 2:case 3:x=De(v[0]),S=De(v[1]),l=[x,S,x,S];break;default:l=v,l[0]=De(l[0]),l[1]=De(l[1]),l[2]=De(l[2]),l[3]=De(l[3])}}else l=[0,0,0,0];if(i<0||l[0]+l[1]+l[2]+l[3]<1e-12)return n.rect(e,t,i,r);const[a,d,u,h]=[[e,t],[e+i,t],[e+i,t+r],[e,t+r]],c=Math.min(i/2,r/2),g=[Math.min(c,l[0]),Math.min(c,l[1]),Math.min(c,l[2]),Math.min(c,l[3])],f=[a[0]+g[0],a[1]],p=[a[0],a[1]+g[0]],m=[d[0]-g[1],d[1]],b=[d[0],d[1]+g[1]],C=[u[0]-g[2],u[1]],_=[u[0],u[1]-g[2]],w=[h[0]+g[3],h[1]],y=[h[0],h[1]-g[3]];if(n.moveTo(f[0],f[1]),s&&s[0]?s[0](f[0],f[1],m[0],m[1]):n.lineTo(m[0],m[1]),!os(m,b)){s&&s[0]&&n.moveTo(m[0],m[1]);const v=m[0],x=m[1]+g[1];n.arc(v,x,g[1],-Al,0,!1)}if(s&&s[1]?s[1](b[0],b[1],_[0],_[1]):n.lineTo(_[0],_[1]),!os(C,_)){const v=_[0]-g[2],x=_[1];s&&s[1]&&n.moveTo(_[0],_[1]),n.arc(v,x,g[2],0,Al,!1)}if(s&&s[2]?s[2](C[0],C[1],w[0],w[1]):n.lineTo(w[0],w[1]),!os(w,y)){const v=w[0],x=w[1]-g[3];s&&s[2]&&n.moveTo(w[0],w[1]),n.arc(v,x,g[3],Al,qe,!1)}if(s&&s[3]?s[3](y[0],y[1],p[0],p[1]):n.lineTo(p[0],p[1]),!os(f,p)){const v=f[0],x=f[1]+g[0];s&&s[3]&&n.moveTo(p[0],p[1]),n.arc(v,x,g[0],qe,qe+Al,!1)}return!s&&n.closePath(),n}var E0=function(n,e,t,i){var r,o=arguments.length,s=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,e,t,i);else for(var l=n.length-1;l>=0;l--)(r=n[l])&&(s=(o<3?r(s):o>3?r(e,t,s):r(e,t))||s);return o>3&&s&&Object.defineProperty(e,t,s),s};class L0{constructor(){this.time=Ee.afterFillStroke,this.useStyle=!0,this.order=0}drawShape(e,t,i,r,o,s,l,a,d,u,h,c){const{outerBorder:g,innerBorder:f}=e.attribute,p=g&&g.visible!==!1,m=f&&f.visible!==!1;if(!p&&!m)return;const{cornerRadius:b=d.cornerRadius,opacity:C=d.opacity,x:_=d.x,y:w=d.y,scaleX:y=d.scaleX,scaleY:v=d.scaleY,x1:x,y1:S,keepStrokeScale:R=d.keepStrokeScale}=e.attribute;let{width:B,height:A}=e.attribute;B=(B??x-i)||0,A=(A??S-r)||0;const M=(H,E)=>{const T=!(!H||!H.stroke),P=E==="outerBorder"?-1:1,{distance:k=d[E].distance}=H,L=R?k:Bi(t,k,t.dpr),F=i+P*L,z=r+P*L,I=2*L;if(b===0||ee(b)&&b.every(N=>N===0)?(t.beginPath(),t.rect(F,z,B-P*I,A-P*I)):(t.beginPath(),ni(t,F,z,B-P*I,A-P*I,b)),t.setShadowBlendStyle&&t.setShadowBlendStyle(e,e.attribute,d),c)c(t,H,d[E]);else if(T){const N=d[E].opacity;d[E].opacity=C,t.setStrokeStyle(e,H,(_-i)/y,(w-r)/v,d[E]),d[E].opacity=N,t.stroke()}};p&&M(g,"outerBorder"),m&&M(f,"innerBorder")}}let xo=class{constructor(){this.time=Ee.beforeFillStroke,this.useStyle=!0,this.order=0}drawShape(e,t,i,r,o,s,l,a,d,u,h,c,g){const{stroke:f=d.stroke}=e.attribute;Array.isArray(f)&&f.some(p=>p===!1)&&(g.doStroke=!1)}};xo=E0([se()],xo);let Ro=class{constructor(){this.time=Ee.afterFillStroke,this.useStyle=!0,this.order=0}drawShape(e,t,i,r,o,s,l,a,d,u,h,c){const{x1:g,y1:f,x:p=d.x,y:m=d.y,stroke:b=d.stroke,cornerRadius:C=d.cornerRadius}=e.attribute;let{width:_,height:w}=e.attribute;if(_=(_??g-p)||0,w=(w??f-m)||0,Array.isArray(b)&&b.some(y=>y===!1)){if(t.setStrokeStyle(e,e.attribute,i,r,d),!(C===0||ee(C)&&C.every(y=>y===0))){let y,v=0;return ni(t,i,r,_,w,C,new Array(4).fill(0).map((x,S)=>(R,B,A,M)=>{b[S]&&(v===S-1&&b[S]===y||(t.setStrokeStyle(e,Object.assign(Object.assign({},e.attribute),{stroke:b[S]}),i,r,d),t.beginPath(),t.moveTo(R,B),y=b[S]),v=S,t.lineTo(A,M),t.stroke(),S===3&&t.beginPath())})),void t.stroke()}if(t.beginPath(),t.moveTo(i,r),b[0]?t.lineTo(i+_,r):t.moveTo(i+_,r),b[1]?t.lineTo(i+_,r+w):t.moveTo(i+_,r+w),b[2]?t.lineTo(i,r+w):t.moveTo(i,r+w),b[3]){const y=b[0]?r-t.lineWidth/2:r;t.lineTo(i,y)}else t.moveTo(i,r);t.stroke()}}};Ro=E0([se()],Ro);const mx=new L0,bx=Io,Cx=tr;class _x extends L0{constructor(){super(...arguments),this.time=Ee.afterFillStroke,this.useStyle=!0,this.order=0}drawShape(e,t,i,r,o,s,l,a,d,u,h,c){return super.drawShape(e,t,i,r,o,s,l,a,d,u,h,c)}}const wx=new _x,yx=tr;class vx{constructor(){this.time=Ee.afterFillStroke,this.useStyle=!0,this.order=0}drawShape(e,t,i,r,o,s,l,a,d,u,h,c){const g=e.getParsedPath();if(!g)return;const{outerBorder:f,innerBorder:p}=e.attribute,m=f&&f.visible!==!1,b=p&&p.visible!==!1;if(!m&&!b)return;const{size:C=d.size,opacity:_=d.opacity,x:w=d.x,y=d.y,scaleX:v=d.scaleX,scaleY:x=d.scaleY,keepStrokeScale:S=d.keepStrokeScale}=e.attribute,R=(B,A)=>{const M=!(!B||!B.stroke),{distance:H=d[A].distance}=B,E=S?H:Bi(t,H,t.dpr),T=A==="outerBorder"?1:-1;if(t.beginPath(),g.drawOffset(t,C,i,r,T*E)===!1&&t.closePath(),t.setShadowBlendStyle&&t.setShadowBlendStyle(e,e.attribute,d),c)c(t,B,d[A]);else if(M){const P=d[A].opacity;d[A].opacity=_,t.setStrokeStyle(e,B,(w-i)/v,(y-r)/x,d[A]),d[A].opacity=P,t.stroke()}};m&&R(f,"outerBorder"),b&&R(p,"innerBorder")}}const Sx=new vx,xx=Io,Rx=tr;class Ax extends zf{constructor(){super(...arguments),this.time=Ee.afterFillStroke}drawShape(e,t,i,r,o,s,l,a,d,u,h,c,g){var f,p,m,b;this.textureMap||this.initTextureMap(t,e.stage);const{attribute:C=e.attribute}=g||{},{texture:_=(f=e.attribute.texture)!==null&&f!==void 0?f:xl(d,"texture"),textureColor:w=(p=e.attribute.textureColor)!==null&&p!==void 0?p:xl(d,"textureColor"),textureSize:y=(m=e.attribute.textureSize)!==null&&m!==void 0?m:xl(d,"textureSize"),texturePadding:v=(b=e.attribute.texturePadding)!==null&&b!==void 0?b:xl(d,"texturePadding")}=C;_&&this.drawTexture(_,e,t,i,r,d,w,y,v)}}var Bx=function(n,e,t,i){var r,o=arguments.length,s=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,e,t,i);else for(var l=n.length-1;l>=0;l--)(r=n[l])&&(s=(o<3?r(s):o>3?r(e,t,s):r(e,t))||s);return o>3&&s&&Object.defineProperty(e,t,s),s},Mx=function(n,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,e)},ep=function(n,e){return function(t,i){e(t,i,n)}};let ba=class extends tn{constructor(n){super(),this.arcRenderContribitions=n,this.numberType=Jd,this.builtinContributions=[lx,dx,ax],this.init(n)}drawArcTailCapPath(n,e,t,i,r,o,s,l){const a=l-s,d=n.getParsedAngle(),u=d.startAngle;let h=d.endAngle;h=l;const c=h>u;let g=!1;if(r<o){const P=r;r=o,o=P}const{xors:f,yors:p,xirs:m,yirs:b,limitedOcr:C,outerCornerRadiusStart:_,outerCornerRadiusEnd:w,maxOuterCornerRadius:y,xore:v,yore:x,xire:S,yire:R,limitedIcr:B,innerDeltaAngle:A,innerStartAngle:M,innerCornerRadiusStart:H,innerCornerRadiusEnd:E,maxInnerCornerRadius:T}=P0(n,u,h,o,r);if(C>Ye){const P=Ot(_,C),k=Ot(w,C),L=$i(m,b,f,p,r,P,Number(c)),F=$i(v,x,S,R,r,k,Number(c));if(C<y&&P===k)e.moveTo(t+L.cx+L.x01,i+L.cy+L.y01),e.arc(t+L.cx,i+L.cy,C,Fe(L.y01,L.x01),Fe(F.y01,F.x01),!c);else{const z=h-a-.03,I=Fe(F.y11,F.x11);e.arc(t,i,r,z,I,!c),k>0&&e.arc(t+F.cx,i+F.cy,k,Fe(F.y11,F.x11),Fe(F.y01,F.x01),!c)}}else e.moveTo(t+f,i+p);if(!(o>Ye)||A<.001)e.lineTo(t+S,i+R),g=!0;else if(B>Ye){const P=Ot(H,B),k=Ot(E,B),L=$i(S,R,v,x,o,-k,Number(c)),F=$i(f,p,m,b,o,-P,Number(c));if(e.lineTo(t+L.cx+L.x01,i+L.cy+L.y01),B<T&&P===k){const z=Fe(F.y01,F.x01);e.arc(t+L.cx,i+L.cy,B,Fe(L.y01,L.x01),z,!c)}else{k>0&&e.arc(t+L.cx,i+L.cy,k,Fe(L.y01,L.x01),Fe(L.y11,L.x11),!c);const z=Fe(L.cy+L.y11,L.cx+L.x11),I=h-a-.03;e.arc(t,i,o,z,I,c)}}else e.lineTo(t+o*mt(M),i+o*it(M));return g}drawShape(n,e,t,i,r,o,s,l){const a=ve(n,o==null?void 0:o.theme).arc,{fill:d=a.fill,stroke:u=a.stroke,x:h=a.x,y:c=a.y,fillStrokeOrder:g=a.fillStrokeOrder}=n.attribute,f=this.valid(n,a,s,l);if(!f)return;const{fVisible:p,sVisible:m,doFill:b,doStroke:C}=f,{outerPadding:_=a.outerPadding,innerPadding:w=a.innerPadding,cap:y=a.cap,forceShowCap:v=a.forceShowCap}=n.attribute;let{outerRadius:x=a.outerRadius,innerRadius:S=a.innerRadius}=n.attribute;x+=_,S-=w;let R=0;const B=(kt(y)&&y||y[0])&&d.gradient==="conical";if(B){const{sc:E,startAngle:T,endAngle:P}=n.getParsedAngle();De(P-T)<Ge-Ye&&(R=E||0,d.startAngle-=R,d.endAngle-=R)}let A=!1;const{isFullStroke:M,stroke:H}=cS(u);if(b||M){e.beginPath(),Ih(n,e,t,i,x,S),A=!0,e.setShadowBlendStyle&&e.setShadowBlendStyle(n,n.attribute,a),this.beforeRenderStep(n,e,t,i,b,C,p,m,a,r,s,l);const E=()=>{b&&(s?s(e,n.attribute,a):p&&(e.setCommonStyle(n,n.attribute,h-t,c-i,a),e.fill()))},T=()=>{C&&M&&(l?l(e,n.attribute,a):m&&(e.setStrokeStyle(n,n.attribute,h-t,c-i,a),e.stroke()))};g?(T(),E()):(E(),T())}if(!M&&C&&(e.beginPath(),Ih(n,e,t,i,x,S,H),A||this.beforeRenderStep(n,e,t,i,b,C,p,m,a,r,s,l),l?l(e,n.attribute,a):m&&(e.setStrokeStyle(n,n.attribute,t,i,a),e.stroke())),(kt(y)&&y||y[1])&&v){const{startAngle:E,endAngle:T}=n.getParsedAngle();if(De(T-E)>=Ge-Ye){e.beginPath();const P=Math.abs(x-S)/2/x,{endAngle:k=a.endAngle,fill:L=a.fill}=n.attribute,F=k;this.drawArcTailCapPath(n,e,t,i,x,S,F,F+P),A||this.beforeRenderStep(n,e,t,i,b,C,p,m,a,r,s,l);const z=()=>{if(b){const N=L;if(N.gradient==="conical"){const W=$S(0,0,k,N);s||Pr&&(e.setCommonStyle(n,n.attribute,t,i,a),e.fillStyle=W,e.fill())}}},I=()=>{C&&(l||m&&(e.setStrokeStyle(n,n.attribute,t,i,a),e.stroke()))};z(),I()}}this.afterRenderStep(n,e,t,i,b,C,p,m,a,r,s,l),B&&(d.startAngle+=R,d.endAngle+=R)}draw(n,e,t,i){const r=ve(n,i==null?void 0:i.theme).arc;this._draw(n,r,!1,t,i)}};ba=Bx([se(),ep(0,Be(gt)),ep(0,At(Oh)),Mx("design:paramtypes",[Object])],ba);var Tx=function(n,e,t,i){var r,o=arguments.length,s=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,e,t,i);else for(var l=n.length-1;l>=0;l--)(r=n[l])&&(s=(o<3?r(s):o>3?r(e,t,s):r(e,t))||s);return o>3&&s&&Object.defineProperty(e,t,s),s},Px=function(n,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,e)},tp=function(n,e){return function(t,i){e(t,i,n)}};let Ca=class extends tn{constructor(n){super(),this.circleRenderContribitions=n,this.numberType=Qd,this.builtinContributions=[hx,fx,cx],this.init(n)}drawShape(n,e,t,i,r,o,s,l){const a=ve(n,o==null?void 0:o.theme).circle,{radius:d=a.radius,startAngle:u=a.startAngle,endAngle:h=a.endAngle,x:c=a.x,y:g=a.y,fillStrokeOrder:f=a.fillStrokeOrder}=n.attribute,p=this.valid(n,a,s,l);if(!p)return;const{fVisible:m,sVisible:b,doFill:C,doStroke:_}=p;e.beginPath(),e.arc(t,i,d,u,h),e.closePath(),e.setShadowBlendStyle&&e.setShadowBlendStyle(n,n.attribute,a),this.beforeRenderStep(n,e,t,i,C,_,m,b,a,r,s,l);const w=()=>{C&&(s?s(e,n.attribute,a):m&&(e.setCommonStyle(n,n.attribute,c-t,g-i,a),e.fill()))},y=()=>{_&&(l?l(e,n.attribute,a):b&&(e.setStrokeStyle(n,n.attribute,c-t,g-i,a),e.stroke()))};f?(y(),w()):(w(),y()),this.afterRenderStep(n,e,t,i,C,_,m,b,a,r,s,l)}draw(n,e,t,i){const r=ve(n,i==null?void 0:i.theme).circle;this._draw(n,r,!1,t,i)}};Ca=Tx([se(),tp(0,Be(gt)),tp(0,At(Dh)),Px("design:paramtypes",[Object])],Ca);function _a(n,e,t,i){if(!e.p1)return;const{offsetX:r=0,offsetY:o=0,offsetZ:s=0}=i||{};if(t===1)e.p2&&e.p3?n.bezierCurveTo(r+e.p1.x,o+e.p1.y,r+e.p2.x,o+e.p2.y,r+e.p3.x,o+e.p3.y,s):n.lineTo(r+e.p1.x,o+e.p1.y,s);else if(e.p2&&e.p3){const[l]=Ah(e,t);n.bezierCurveTo(r+l.p1.x,o+l.p1.y,r+l.p2.x,o+l.p2.y,r+l.p3.x,o+l.p3.y,s)}else{const l=e.getPointAt(t);n.lineTo(r+l.x,o+l.y,s)}}function np(n,e,t,i,r,o,s){var l;let a=e.p0,d=i;if(t&&t.originP1===t.originP2&&(a=t.p0),e.defined)i||(n.lineTo(a.x+r,a.y+o,s),d=!i);else{const{originP1:u,originP2:h}=e;let c;if(u&&u.defined!==!1&&!t?c=a:u&&h.defined!==!1&&(c=(l=e.p3)!==null&&l!==void 0?l:e.p1),i){d=!i;const g=c?c.x:e.p0.x,f=c?c.y:e.p0.y;n.moveTo(g+r,f+o,s)}else c&&(d=!i,n.lineTo(c.x+r,c.y+o,s))}return d}function Uh(n,e,t,i,r){const{offsetX:o=0,offsetY:s=0,offsetZ:l=0,mode:a="none",drawConnect:d=!1}=r||{};if(d&&a==="none"||!e)return;let u=!0;const{curves:h}=e;if(t>=1){if(d){let b,C=!0;h.forEach((_,w)=>{_.originP1!==_.originP2&&(C=np(n,_,b,C,o,s,l)),b=_})}else h.forEach(b=>{b.defined?(u&&n.moveTo(b.p0.x+o,b.p0.y+s,l),_a(n,b,1,r),u=!1):u=!0});return}if(t<=0)return;let c;i==="x"?c=$e.ROW:i==="y"?c=$e.COLUMN:i==="auto"&&(c=e.direction);const g=t*e.tryUpdateLength(c);let f=0,p=!0,m=null;for(let b=0,C=h.length;b<C;b++){const _=h[b],w=_.getLength(c),y=(g-f)/w;if(f+=w,y<0)break;if(d){if(_.originP1===_.originP2){m=_;continue}p=np(n,_,m,p,o,s,l),m=_}else{if(!_.defined){u=!0;continue}u&&n.moveTo(_.p0.x+o,_.p0.y+s,l),_a(n,_,Ot(y,1),r),u=!1}}}function Hx(n,e,t,i){const{offsetX:r=0,offsetY:o=0}=i||{},s=e?e.points[e.points.length-1]:t.points[0];n.moveTo(s.x+r,s.y+o),t.points.forEach(l=>{l.defined!==!1?n.lineTo(l.x+r,l.y+o):n.moveTo(l.x+r,l.y+o)})}function kx(n,e,t,i){const{offsetX:r=0,offsetY:o=0}=i||{},{points:s}=t,l=[];for(let a=0;a<s.length;a++)s[a].defined;l.push(s),l.forEach((a,d)=>{var u,h,c,g;const f=e&&d===0?e.points[e.points.length-1]:a[0];n.moveTo(f.x+r,f.y+o),a.forEach(p=>{p.defined!==!1?n.lineTo(p.x+r,p.y+o):n.moveTo(p.x+r,p.y+o)});for(let p=a.length-1;p>=0;p--){const m=a[p];n.lineTo((u=m.x1)!==null&&u!==void 0?u:m.x,(h=m.y1)!==null&&h!==void 0?h:m.y)}n.lineTo((c=f.x1)!==null&&c!==void 0?c:f.x,(g=f.y1)!==null&&g!==void 0?g:f.y),n.closePath()})}var Ex=function(n,e,t,i){var r,o=arguments.length,s=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,e,t,i);else for(var l=n.length-1;l>=0;l--)(r=n[l])&&(s=(o<3?r(s):o>3?r(e,t,s):r(e,t))||s);return o>3&&s&&Object.defineProperty(e,t,s),s};let Ls=class extends tn{constructor(){super(...arguments),this.numberType=il}draw(n,e,t,i){const r=ve(n,i==null?void 0:i.theme).line;this._draw(n,r,!1,t,i)}drawSegmentItem(n,e,t,i,r,o,s,l,a,d,u,h,c,g,f){var p,m,b,C,_;if(!e)return;n.beginPath();const w=(p=this.z)!==null&&p!==void 0?p:0;Uh(n.camera?n:n.nativeContext,e,a,d,{offsetX:u,offsetY:h,offsetZ:w}),c.cache&&!ee(c.cache)&&c.cache.curves.every(A=>A.defined)&&c.attribute.curveType&&c.attribute.curveType.includes("Closed")&&n.closePath(),n.setShadowBlendStyle&&n.setShadowBlendStyle(c,s,l);const{x:y=0,x:v=0}=s;t!==!1&&(g?g(n,s,l):r&&(n.setCommonStyle(c,s,y-u,v-h,l),n.fill())),i!==!1&&(f?f(n,s,l):o&&(n.setStrokeStyle(c,s,y-u,v-h,l),n.stroke()));let{connectedType:x,connectedX:S,connectedY:R,connectedStyle:B}=s;if(ee(l)?(x=(m=x??l[0].connectedType)!==null&&m!==void 0?m:l[1].connectedType,S=(b=S??l[0].connectedX)!==null&&b!==void 0?b:l[1].connectedX,R=(C=R??l[0].connectedY)!==null&&C!==void 0?C:l[1].connectedY,B=(_=B??l[0].connectedStyle)!==null&&_!==void 0?_:l[1].connectedStyle):(x=x??l.connectedType,S=S??l.connectedX,R=R??l.connectedY,B=B??l.connectedStyle),x!=="connect"&&x!=="zero"&&(x="none"),x!=="none"){n.beginPath(),Uh(n.camera?n:n.nativeContext,e,a,d,{offsetX:u,offsetY:h,offsetZ:w,drawConnect:!0,mode:x});const A=[];ee(l)?l.forEach(M=>A.push(M)):A.push(l),A.push(s),t!==!1&&(g?g(n,s,l):r&&(n.setCommonStyle(c,B,y-u,v-h,A),n.fill())),i!==!1&&(f?f(n,s,l):o&&(n.setStrokeStyle(c,B,y-u,v-h,A),n.stroke()))}return!1}drawLinearLineHighPerformance(n,e,t,i,r,o,s,l,a,d,u,h,c){var g;e.beginPath();const f=(g=this.z)!==null&&g!==void 0?g:0,{points:p}=n.attribute,m=p[0];e.moveTo(m.x+s,m.y+l,f);for(let _=1;_<p.length;_++){const w=p[_];e.lineTo(w.x+s,w.y+l,f)}e.setShadowBlendStyle&&e.setShadowBlendStyle(n,n.attribute,a);const{x:b=0,x:C=0}=n.attribute;t!==!1&&(h?h(e,n.attribute,a):r&&(e.setCommonStyle(n,n.attribute,b-s,C-l,a),e.fill())),i!==!1&&(c?c(e,n.attribute,a):o&&(e.setStrokeStyle(n,n.attribute,b-s,C-l,a),e.stroke()))}drawShape(n,e,t,i,r,o,s,l){const a=ve(n,o==null?void 0:o.theme).line,{fill:d=a.fill,stroke:u=a.stroke,fillOpacity:h=a.fillOpacity,strokeOpacity:c=a.strokeOpacity,segments:g,points:f,closePath:p,curveTension:m=a.curveTension}=n.attribute;if(!this.valid(n,a,s,l))return;let{curveType:b=a.curveType}=n.attribute;p&&b==="linear"&&(b="linearClosed");const{clipRange:C=a.clipRange,clipRangeByDimension:_=a.clipRangeByDimension}=n.attribute;if(C===1&&!g&&!f.some(w=>w.defined===!1)&&b==="linear")return this.drawLinearLineHighPerformance(n,e,!!d,!!u,h,c,t,i,a,r,o,s,l);if(n.shouldUpdateShape()){const{points:w,segments:y}=n.attribute,v=w;if(y&&y.length){let x,S;if(n.cache=y.map((R,B)=>{if(R.points.length<=1&&B===0)return R.points[0]&&(S={endX:R.points[0].x,endY:R.points[0].y,curves:[{defined:R.points[0].defined!==!1}]}),null;B===1?x={x:S.endX,y:S.endY,defined:S.curves[S.curves.length-1].defined}:B>1&&(x.x=S.endX,x.y=S.endY,x.defined=S.curves[S.curves.length-1].defined);const A=_r(R.points,b,{startPoint:x,curveTension:m});return S=A,A}).filter(R=>!!R),b==="linearClosed"){let R;for(let B=0;B<n.cache.length;B++){const A=n.cache[B];for(let M=0;M<A.curves.length;M++)if(A.curves[M].defined){R=A.curves[M].p0;break}if(R)break}n.cache[n.cache.length-1]&&n.cache[n.cache.length-1].lineTo(R.x,R.y,!0)}}else{if(!w||!w.length)return n.cache=null,void n.clearUpdateShapeTag();n.cache=_r(v,b,{curveTension:m})}n.clearUpdateShapeTag()}if(Array.isArray(n.cache)){const w=n.attribute.segments.filter(y=>y.points.length);if(w[0].points.length===1&&w.shift(),C===1){let y=!1;n.cache.forEach((v,x)=>{y||(y=this.drawSegmentItem(e,v,!!d,!!u,h,c,w[x],[a,n.attribute],C,_,t,i,n,s,l))})}else{const y=n.cache.reduce((R,B)=>R+B.getLength(),0),v=C*y;let x=0,S=!1;n.cache.forEach((R,B)=>{if(S)return;const A=R.getLength(),M=(v-x)/A;x+=A,M>0&&(S=this.drawSegmentItem(e,R,!!d,!!u,h,c,w[B],[a,n.attribute],Ot(M,1),_,t,i,n,s,l))})}}else this.drawSegmentItem(e,n.cache,!!d,!!u,h,c,n.attribute,a,C,_,t,i,n,s,l)}};Ls=Ex([se()],Ls);function Lx(n,e,t,i){var r;const{drawConnect:o=!1,mode:s="none"}=i||{};if(o&&s==="none")return;const{top:l,bottom:a}=e;if(l.curves.length!==a.curves.length)return;if(t>=1){const v=[],x=[];let S=!0;if(o){let R,B,A=!0;const M=l.curves.length;l.curves.forEach((H,E)=>{const T=a.curves[M-E-1];let P=H,k=T;if(H.originP1===H.originP2)return R=H,void(B=T);if(R&&R.originP1===R.originP2&&(P=R,k=B),H.defined)A||(v.push(P),x.push(k),Nr(n,v,x,i),v.length=0,x.length=0,A=!A);else{const{originP1:L,originP2:F}=H;let z,I;L&&L.defined!==!1?(z=P,I=k):L&&F.defined!==!1&&(z=H,I=T),A?(A=!A,v.push(z||H),x.push(I||T)):z&&(A=!A,v.push(z||H),x.push(I||T),Nr(n,v,x,i),v.length=0,x.length=0)}R=H}),Nr(n,v,x,i)}else{for(let R=0,B=l.curves.length;R<B;R++){const A=l.curves[R];S!==A.defined?(S?(Bl(n,v,x,i),v.length=0,x.length=0):(v.push(A),x.push(a.curves[B-R-1])),S=!S):S&&(v.push(A),x.push(a.curves[B-R-1]))}Bl(n,v,x,i)}return}if(t<=0)return;let{direction:d}=i||{};const{curves:u}=l,h=(r=u[u.length-1].p3)!==null&&r!==void 0?r:u[u.length-1].p1,c=De(h.x-u[0].p0.x),g=De(h.y-u[0].p0.y);d=d??(c>g?$e.ROW:$e.COLUMN),Number.isFinite(c)||(d=$e.COLUMN),Number.isFinite(g)||(d=$e.ROW);const f=t*(d===$e.ROW?c:g);let p=0,m=!0;const b=[],C=[];let _,w,y=!0;for(let v=0,x=l.curves.length;v<x;v++){const S=l.curves[v],R=S.getLength(d),B=(f-p)/R;if(B<0)break;if(p+=R,o){const A=a.curves[x-v-1];let M=S,H=A;if(S.originP1===S.originP2){_=S,w=A;continue}if(_&&_.originP1===_.originP2&&(M=_,H=w),S.defined)y||(b.push(M),C.push(H),Nr(n,b,C,i),b.length=0,C.length=0,y=!y);else{const{originP1:E,originP2:T}=S;let P,k;E&&E.defined!==!1?(P=M,k=H):E&&T.defined!==!1&&(P=S,k=A),y?(y=!y,b.push(P||S),C.push(k||A)):P&&(y=!y,b.push(P||S),C.push(k||A),Nr(n,b,C,i),b.length=0,C.length=0)}_=S}else{let A=null,M=null;m!==S.defined?(m?(Bl(n,b,C,i),b.length=0,C.length=0):(A=S,M=a.curves[x-v-1]),m=!m):m&&(A=S,M=a.curves[x-v-1]),A&&M&&(B<1&&(A=A.p2&&A.p3?Ah(A,B)[0]:Pg(A,B)[0],M=M.p2&&M.p3?Ah(M,1-B)[1]:Pg(M,1-B)[1]),A.defined=m,M.defined=m,b.push(A),C.push(M)),A=null,M=null}}o?Nr(n,b,C,i):Bl(n,b,C,i)}function Nr(n,e,t,i){if(e.length<2)return;const{offsetX:r=0,offsetY:o=0,offsetZ:s=0}=i||{};let l=e[0];n.moveTo(l.p0.x+r,l.p0.y+o,s),l=e[e.length-1];let a=l.p3||l.p1;n.lineTo(a.x+r,a.y+o,s),l=t[t.length-1],n.lineTo(l.p0.x+r,l.p0.y+o,s),l=t[0],a=l.p3||l.p1,n.lineTo(a.x+r,a.y+o,s),n.closePath()}function Bl(n,e,t,i){const{offsetX:r=0,offsetY:o=0,offsetZ:s=0}=i||{};let l=!0;e.forEach(a=>{a.defined?(l&&n.moveTo(a.p0.x+r,a.p0.y+o,s),_a(n,a,1,i),l=!1):l=!0}),l=!0;for(let a=t.length-1;a>=0;a--){const d=t[a];d.defined?(l&&n.lineTo(d.p0.x+r,d.p0.y+o,s),_a(n,d,1,i),l=!1):l=!0}n.closePath()}const Fx=new Ax,zx=tr;var Ix=function(n,e,t,i){var r,o=arguments.length,s=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,e,t,i);else for(var l=n.length-1;l>=0;l--)(r=n[l])&&(s=(o<3?r(s):o>3?r(e,t,s):r(e,t))||s);return o>3&&s&&Object.defineProperty(e,t,s),s},Ox=function(n,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,e)},ip=function(n,e){return function(t,i){e(t,i,n)}};let $h=class extends tn{constructor(n){super(),this.areaRenderContribitions=n,this.numberType=y0,this.builtinContributions=[Fx,zx],this.init(n)}drawLinearAreaHighPerformance(n,e,t,i,r,o,s,l,a,d,u,h,c){var g,f,p;const{points:m}=n.attribute;if(m.length<2)return;e.beginPath();const b=(g=this.z)!==null&&g!==void 0?g:0,C=m[0];e.moveTo(C.x+s,C.y+l,b);for(let y=1;y<m.length;y++){const v=m[y];e.lineTo(v.x+s,v.y+l,b)}for(let y=m.length-1;y>=0;y--){const v=m[y];e.lineTo(((f=v.x1)!==null&&f!==void 0?f:v.x)+s,((p=v.y1)!==null&&p!==void 0?p:v.y)+l,b)}e.closePath(),e.setShadowBlendStyle&&e.setShadowBlendStyle(n,n.attribute,a),this.beforeRenderStep(n,e,s,l,!!r,!1,t,!1,a,d,h,null,{attribute:n.attribute});const{x:_=0,x:w=0}=n.attribute;t!==!1&&(h?h(e,n.attribute,a):r&&(e.setCommonStyle(n,n.attribute,_-s,w-l,a),e.fill())),this.afterRenderStep(n,e,s,l,!!r,!1,t,!1,a,d,h,null,{attribute:n.attribute}),(()=>{var y,v;if(i){const{stroke:x=a&&a.stroke}=n.attribute;if(ee(x)&&(x[0]||x[2])&&x[1]===!1){if(e.beginPath(),x[0]){e.moveTo(C.x+s,C.y+l,b);for(let S=1;S<m.length;S++){const R=m[S];e.lineTo(R.x+s,R.y+l,b)}}else if(x[2]){const S=m[m.length-1];e.moveTo(S.x+s,S.y+l,b);for(let R=m.length-2;R>=0;R--){const B=m[R];e.lineTo(((y=B.x1)!==null&&y!==void 0?y:B.x)+s,((v=B.y1)!==null&&v!==void 0?v:B.y)+l,b)}}}c?c(e,n.attribute,a):(e.setStrokeStyle(n,n.attribute,_-s,w-l,a),e.stroke())}})()}drawShape(n,e,t,i,r,o,s,l){var a,d,u,h,c,g;const f=ve(n,o==null?void 0:o.theme).area,{fill:p=f.fill,stroke:m=f.stroke,fillOpacity:b=f.fillOpacity,z:C=f.z,strokeOpacity:_=f.strokeOpacity,curveTension:w=f.curveTension}=n.attribute,y=this.valid(n,f,s,l);if(!y)return;const{doFill:v}=y,x=y.doStroke&&y.sVisible,{clipRange:S=f.clipRange,closePath:R,points:B,segments:A}=n.attribute;let{curveType:M=f.curveType}=n.attribute;if(R&&M==="linear"&&(M="linearClosed"),S===1&&!A&&!B.some(H=>H.defined===!1)&&M==="linear")return this.drawLinearAreaHighPerformance(n,e,!!p,x,b,_,t,i,f,r,o,s,l);if(n.shouldUpdateShape()){if(A&&A.length){let H,E;const T=A.map((L,F)=>{if(L.points.length<=1&&F===0)return L.points[0]&&(E={endX:L.points[0].x,endY:L.points[0].y}),null;F===1?H={x:E.endX,y:E.endY}:F>1&&(H.x=E.endX,H.y=E.endY);const z=_r(L.points,M,{startPoint:H,curveTension:w});return E=z,z}).filter(L=>!!L);let P;const k=[];for(let L=A.length-1;L>=0;L--){const F=A[L].points,z=[];for(let I=F.length-1;I>=0;I--)z.push({x:(a=F[I].x1)!==null&&a!==void 0?a:F[I].x,y:(d=F[I].y1)!==null&&d!==void 0?d:F[I].y});if(L!==0){const I=A[L-1].points,N=I[I.length-1];N&&z.push({x:(u=N.x1)!==null&&u!==void 0?u:N.x,y:(h=N.y1)!==null&&h!==void 0?h:N.y})}z.length>1&&(P=_r(z,M==="stepBefore"?"stepAfter":M==="stepAfter"?"stepBefore":M,{curveTension:w}),k.unshift(P))}n.cacheArea=k.map((L,F)=>({top:T[F],bottom:L}))}else{if(!B||!B.length)return n.cacheArea=null,void n.clearUpdateShapeTag();{const H=B,E=[];for(let k=B.length-1;k>=0;k--)E.push({x:(c=B[k].x1)!==null&&c!==void 0?c:B[k].x,y:(g=B[k].y1)!==null&&g!==void 0?g:B[k].y});const T=_r(H,M,{curveTension:w}),P=_r(E,M==="stepBefore"?"stepAfter":M==="stepAfter"?"stepBefore":M,{curveTension:w});n.cacheArea={top:T,bottom:P}}}n.clearUpdateShapeTag()}if(Array.isArray(n.cacheArea)){const H=n.attribute.segments.filter(E=>E.points.length);if(H[0].points.length===1&&H.shift(),S===1){let E=!1;n.cacheArea.forEach((T,P)=>{E||(E=this.drawSegmentItem(e,T,v,b,x,_,H[P],[f,n.attribute],S,t,i,C,n,r,s,l))})}else{const E=n.cacheArea.reduce((L,F)=>L+F.top.getLength(),0),T=S*E;let P=0,k=!1;n.cacheArea.forEach((L,F)=>{if(k)return;const z=L.top.getLength(),I=(T-P)/z;P+=z,I>0&&(k=this.drawSegmentItem(e,L,v,b,x,_,H[F],[f,n.attribute],Ot(I,1),t,i,C,n,r,s,l))})}}else this.drawSegmentItem(e,n.cacheArea,v,b,x,_,n.attribute,f,S,t,i,C,n,r,s,l)}draw(n,e,t,i){const r=ve(n,i==null?void 0:i.theme).area;this._draw(n,r,!1,t,i)}drawSegmentItem(n,e,t,i,r,o,s,l,a,d,u,h,c,g,f,p){let m=!1;return m=m||this._drawSegmentItem(n,e,t,i,r,o,s,l,a,d,u,h,c,g,!1,f,p),m=m||this._drawSegmentItem(n,e,t,i,r,o,s,l,a,d,u,h,c,g,!0,f,p),m}_drawSegmentItem(n,e,t,i,r,o,s,l,a,d,u,h,c,g,f,p,m){var b,C,_,w;if(!(e&&e.top&&e.bottom&&e.top.curves&&e.top.curves.length&&e.bottom.curves&&e.bottom.curves.length))return;let{connectedType:y,connectedX:v,connectedY:x,connectedStyle:S}=s;const R=[];if(f&&(ee(l)?(y=(b=y??l[0].connectedType)!==null&&b!==void 0?b:l[1].connectedType,v=(C=v??l[0].connectedX)!==null&&C!==void 0?C:l[1].connectedX,x=(_=x??l[0].connectedY)!==null&&_!==void 0?_:l[1].connectedY,S=(w=S??l[0].connectedStyle)!==null&&w!==void 0?w:l[1].connectedStyle):(y=y??l.connectedType,v=v??l.connectedX,x=x??l.connectedY,S=S??l.connectedStyle),y!=="connect"&&y!=="zero"&&(y="none"),ee(l)?l.forEach(F=>R.push(F)):R.push(l),R.push(s)),f&&y==="none")return!1;n.beginPath();const{points:B,segments:A}=c.attribute;let M,H,E=$e.ROW;if(A){const F=A[A.length-1];H=A[0].points[0],M=F.points[F.points.length-1]}else H=B[0],M=B[B.length-1];const T=De(M.x-H.x),P=De(M.y-H.y);E=M.x1==null?$e.ROW:M.y1==null?$e.COLUMN:Number.isFinite(T+P)?T>P?$e.ROW:$e.COLUMN:$e.ROW,Lx(n.camera?n:n.nativeContext,e,a,{offsetX:d,offsetY:u,offsetZ:h,direction:E,drawConnect:f,mode:y}),this.beforeRenderStep(c,n,d,u,!!i,!1,t,!1,l,g,p,null,{attribute:s}),n.setShadowBlendStyle&&n.setShadowBlendStyle(c,s,l);const{x:k=0,x:L=0}=s;return t!==!1&&(p?p(n,s,l):i&&(n.setCommonStyle(c,f?S:s,k-d,L-u,f?R:l),n.fill())),this.afterRenderStep(c,n,d,u,!!i,!1,t,!1,l,g,p,null,{attribute:s}),(()=>{if(r!==!1)if(m)m(n,s,l);else{const{stroke:F=l&&l[1]&&l[1].stroke}=s;ee(F)&&(F[0]||F[2])&&F[1]===!1&&(n.beginPath(),Uh(n.camera?n:n.nativeContext,F[0]?e.top:e.bottom,a,E===$e.ROW?"x":"y",{offsetX:d,offsetY:u,offsetZ:h,drawConnect:f,mode:y})),n.setStrokeStyle(c,f?S:s,k-d,L-u,f?R:l),n.stroke()}})(),!1}};$h=Ix([se(),ip(0,Be(gt)),ip(0,At(YS)),Ox("design:paramtypes",[Object])],$h);const Dx=Io,Wx=tr;var Nx=function(n,e,t,i){var r,o=arguments.length,s=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,e,t,i);else for(var l=n.length-1;l>=0;l--)(r=n[l])&&(s=(o<3?r(s):o>3?r(e,t,s):r(e,t))||s);return o>3&&s&&Object.defineProperty(e,t,s),s},Vx=function(n,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,e)},rp=function(n,e){return function(t,i){e(t,i,n)}};let wa=class extends tn{constructor(n){super(),this.pathRenderContribitions=n,this.numberType=tu,this.builtinContributions=[Wx,Dx],this.init(n)}drawShape(n,e,t,i,r,o,s,l){var a,d,u;const h=(a=this.tempTheme)!==null&&a!==void 0?a:ve(n,o==null?void 0:o.theme).path,{x:c=h.x,y:g=h.y,fillStrokeOrder:f=h.fillStrokeOrder}=n.attribute,p=(d=this.z)!==null&&d!==void 0?d:0,m=this.valid(n,h,s,l);if(!m)return;const{fVisible:b,sVisible:C,doFill:_,doStroke:w}=m;if(e.beginPath(),n.pathShape)Qi(n.pathShape.commandList,e,t,i,1,1,p);else{const x=(u=n.attribute.path)!==null&&u!==void 0?u:h.path;Qi(x.commandList,e,t,i,1,1,p)}e.setShadowBlendStyle&&e.setShadowBlendStyle(n,n.attribute,h),this.beforeRenderStep(n,e,t,i,_,w,b,C,h,r,s,l);const y=()=>{w&&(l?l(e,n.attribute,h):C&&(e.setStrokeStyle(n,n.attribute,c-t,g-i,h),e.stroke()))},v=()=>{_&&(s?s(e,n.attribute,h):b&&(e.setCommonStyle(n,n.attribute,c-t,g-i,h),e.fill()))};f?(y(),v()):(v(),y()),this.afterRenderStep(n,e,t,i,_,w,b,C,h,r,s,l)}draw(n,e,t,i){const r=ve(n,i==null?void 0:i.theme).path;this.tempTheme=r,this._draw(n,r,!1,t,i),this.tempTheme=null}};wa=Nx([se(),rp(0,Be(gt)),rp(0,At(Wh)),Vx("design:paramtypes",[Object])],wa);var Gx=function(n,e,t,i){var r,o=arguments.length,s=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,e,t,i);else for(var l=n.length-1;l>=0;l--)(r=n[l])&&(s=(o<3?r(s):o>3?r(e,t,s):r(e,t))||s);return o>3&&s&&Object.defineProperty(e,t,s),s},jx=function(n,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,e)},op=function(n,e){return function(t,i){e(t,i,n)}};let ya=class extends tn{constructor(n){super(),this.rectRenderContribitions=n,this.type="rect",this.numberType=Pf,this.builtinContributions=[mx,Cx,bx],this.init(n)}drawShape(n,e,t,i,r,o,s,l){var a;const d=(a=this.tempTheme)!==null&&a!==void 0?a:ve(n,o==null?void 0:o.theme).rect,{fill:u=d.fill,background:h,stroke:c=d.stroke,cornerRadius:g=d.cornerRadius,opacity:f=d.opacity,fillOpacity:p=d.fillOpacity,lineWidth:m=d.lineWidth,strokeOpacity:b=d.strokeOpacity,visible:C=d.visible,x1:_,y1:w,x:y=d.x,y:v=d.y,fillStrokeOrder:x=d.fillStrokeOrder}=n.attribute;let{width:S,height:R}=n.attribute;S=(S??_-y)||0,R=(R??w-v)||0;const B=M0(f,p,S,R,u),A=T0(f,b,S,R),M=zo(u,h),H=rl(c,m);if(!n.valid||!C||!M&&!H||!(B||A||s||l||h))return;g===0||ee(g)&&g.every(k=>k===0)?(e.beginPath(),e.rect(t,i,S,R)):(e.beginPath(),ni(e,t,i,S,R,g));const E={doFill:M,doStroke:H};e.setShadowBlendStyle&&e.setShadowBlendStyle(n,n.attribute,d),this.beforeRenderStep(n,e,t,i,M,H,B,A,d,r,s,l,E);const T=()=>{E.doFill&&(s?s(e,n.attribute,d):B&&(e.setCommonStyle(n,n.attribute,y-t,v-i,d),e.fill()))},P=()=>{E.doStroke&&(l?l(e,n.attribute,d):A&&(e.setStrokeStyle(n,n.attribute,y-t,v-i,d),e.stroke()))};x?(P(),T()):(T(),P()),this.afterRenderStep(n,e,t,i,M,H,B,A,d,r,s,l)}draw(n,e,t,i){const r=ve(n,i==null?void 0:i.theme).rect;this.tempTheme=r,this._draw(n,r,!1,t,i),this.tempTheme=null}};ya=Gx([se(),op(0,Be(gt)),op(0,At(vr)),jx("design:paramtypes",[Object])],ya);var Ux=function(n,e,t,i){var r,o=arguments.length,s=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,e,t,i);else for(var l=n.length-1;l>=0;l--)(r=n[l])&&(s=(o<3?r(s):o>3?r(e,t,s):r(e,t))||s);return o>3&&s&&Object.defineProperty(e,t,s),s},$x=function(n,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,e)},sp=function(n,e){return function(t,i){e(t,i,n)}};let va=class extends tn{constructor(n){super(),this.symbolRenderContribitions=n,this.numberType=iu,this.builtinContributions=[Sx,Rx,xx],this.init(n)}drawShape(n,e,t,i,r,o,s,l){var a;const d=ve(n,o==null?void 0:o.theme).symbol,{size:u=d.size,x:h=d.x,y:c=d.y,scaleX:g=d.scaleX,scaleY:f=d.scaleY,fillStrokeOrder:p=d.fillStrokeOrder}=n.attribute,m=this.valid(n,d,s,l);if(!m)return;const{fVisible:b,sVisible:C,doFill:_,doStroke:w}=m,y=n.getParsedPath();if(!y)return;const{keepDirIn3d:v=d.keepDirIn3d}=n.attribute,x=(a=this.z)!==null&&a!==void 0?a:0;e.beginPath();const S=(A,M)=>{var H,E,T;if(n._parsedPath.svgCache){const L=Object.assign({},M);L.fill=(H=M.fill)!==null&&H!==void 0?H:n.attribute.fill,L.opacity=(E=M.opacity)!==null&&E!==void 0?E:n.attribute.opacity,L.fillOpacity=n.attribute.fillOpacity,L.stroke=(T=M.stroke)!==null&&T!==void 0?T:n.attribute.stroke,M=L}const P=()=>{M.fill&&(s?s(e,n.attribute,d):(e.setCommonStyle(n,M,h-t,c-i,d),e.fill()))},k=()=>{M.stroke&&(l?l(e,n.attribute,d):(e.setStrokeStyle(n,M,(h-t)/g,(c-i)/f,d),e.stroke()))};p?(k(),P()):(P(),k())};if(v&&e.camera&&e.project){const A=e.project(t,i,x),M=e.camera;e.camera=null,y.draw(e,ee(u)?[u[0]*g,u[1]*f]:u*g,A.x,A.y,void 0,S)===!1&&e.closePath(),e.camera=M}else y.draw(e,u,t,i,x,S)===!1&&e.closePath();e.setShadowBlendStyle&&e.setShadowBlendStyle(n,n.attribute,d),this.beforeRenderStep(n,e,t,i,_,w,b,C,d,r,s,l);const R=()=>{_&&!y.isSvg&&(s?s(e,n.attribute,d):b&&(e.setCommonStyle(n,n.attribute,h-t,c-i,d),e.fill()))},B=()=>{w&&!y.isSvg&&(l?l(e,n.attribute,d):C&&(e.setStrokeStyle(n,n.attribute,(h-t)/g,(c-i)/f,d),e.stroke()))};p?(B(),R()):(R(),B()),this.afterRenderStep(n,e,t,i,_,w,b,C,d,r,s,l)}draw(n,e,t,i){const r=ve(n,i==null?void 0:i.theme).symbol;this._draw(n,r,!1,t,i)}};va=Ux([se(),sp(0,Be(gt)),sp(0,At(Vh)),$x("design:paramtypes",[Object])],va);class Kx{constructor(){this.pools=[];for(let e=0;e<10;e++)this.pools.push(new Ue)}allocate(e,t,i,r){if(!this.pools.length)return new Ue().setValue(e,t,i,r);const o=this.pools.pop();return o.x1=e,o.y1=t,o.x2=i,o.y2=r,o}allocateByObj(e){if(!this.pools.length)return new Ue(e);const t=this.pools.pop();return t.x1=e.x1,t.y1=e.y1,t.x2=e.x2,t.y2=e.y2,t}free(e){this.pools.push(e)}get length(){return this.pools.length}release(...e){this.pools=[]}}const Sa=new Kx;class Yx{constructor(){this.store=new Map}RegisterGraphicCreator(e,t){this.store.set(e,t),this[e]=t}CreateGraphic(e,t){const i=this.store.get(e);return i?i(t):null}}const ge=new Yx;let Ml;function su(n){return Ml||(Ml=ge.CreateGraphic("text",{})),Ml.initAttributes(n),Ml.AABBBounds}class Xx extends ou{constructor(){super(...arguments),this.time=Ee.beforeFillStroke}drawShape(e,t,i,r,o,s,l,a,d,u,h,c){var g,f,p,m,b,C,_,w,y,v;const{backgroundMode:x=d.backgroundMode,backgroundFit:S=d.backgroundFit}=e.attribute;let R,{background:B}=e.attribute;if(!B)return;const A=()=>{e.type==="richtext"&&(t.restore(),t.save(),R&&t.setTransformFromMatrix(R,!0,1))};let M;e.type==="richtext"&&(R=t.currentMatrix.clone(),t.restore(),t.save(),t.setTransformForCurrent());const H=ke(B)&&B.background,E=e.transMatrix.onlyTranslate();if(H){const T=e.AABBBounds,P=((g=B.x)!==null&&g!==void 0?g:T.x1)+((f=B.dx)!==null&&f!==void 0?f:0),k=((p=B.y)!==null&&p!==void 0?p:T.y1)+((m=B.dy)!==null&&m!==void 0?m:0),L=(b=B.width)!==null&&b!==void 0?b:T.width(),F=(C=B.height)!==null&&C!==void 0?C:T.height();if(M=Sa.allocate(P,k,P+L,k+F),B=B.background,!E){const z=M.width(),I=M.height();M.set(((_=B.x)!==null&&_!==void 0?_:0)+((w=B.dx)!==null&&w!==void 0?w:0),((y=B.y)!==null&&y!==void 0?y:0)+((v=B.dy)!==null&&v!==void 0?v:0),z,I)}}else M=e.AABBBounds,E||(M=su(Object.assign(Object.assign({},e.attribute),{angle:0,scaleX:1,scaleY:1,x:0,y:0,dx:0,dy:0})).clone());if(e.backgroundImg&&e.resources){const T=e.resources.get(B);if(T.state!=="success"||!T.data)return void A();t.highPerformanceSave(),E&&t.setTransformFromMatrix(e.parent.globalTransMatrix,!0),t.setCommonStyle(e,e.attribute,i,r,d),this.doDrawImage(t,T.data,M,x,S),t.highPerformanceRestore(),t.setTransformForCurrent()}else{const{backgroundCornerRadius:T}=e.attribute;t.highPerformanceSave(),t.setCommonStyle(e,e.attribute,i,r,d),t.fillStyle=B,T?(ni(t,M.x1,M.y1,M.width(),M.height(),T),t.fill()):t.fillRect(M.x1,M.y1,M.width(),M.height()),t.highPerformanceRestore()}H&&Sa.free(M),A()}}const F0=new Xx;var qx=function(n,e,t,i){var r,o=arguments.length,s=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,e,t,i);else for(var l=n.length-1;l>=0;l--)(r=n[l])&&(s=(o<3?r(s):o>3?r(e,t,s):r(e,t))||s);return o>3&&s&&Object.defineProperty(e,t,s),s},Zx=function(n,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,e)},lp=function(n,e){return function(t,i){e(t,i,n)}};let Kh=class extends tn{constructor(n){super(),this.textRenderContribitions=n,this.numberType=ru,this.builtinContributions=[F0],this.init(n)}drawShape(n,e,t,i,r,o,s,l){var a,d,u;const h=ve(n,o==null?void 0:o.theme).text,{text:c,underline:g=h.underline,lineThrough:f=h.lineThrough,keepDirIn3d:p=h.keepDirIn3d,direction:m=h.direction,fontSize:b=h.fontSize,verticalMode:C=h.verticalMode,x:_=h.x,y:w=h.y}=n.attribute,y=(a=nl(n.attribute.lineHeight,b))!==null&&a!==void 0?a:b,v=this.valid(n,h,s,l);if(!v)return;const{fVisible:x,sVisible:S,doFill:R,doStroke:B}=v,A=!p,M=this.z||0;e.beginPath(),e.setShadowBlendStyle&&e.setShadowBlendStyle(n,n.attribute,h),this.beforeRenderStep(n,e,t,i,R,B,x,S,h,r,s,l),A&&this.transformUseContext2d(n,h,M,e);const H=(E,T,P,k)=>{let L=t+T;const F=i+P;if(k){e.highPerformanceSave(),L+=b;const z=Zt.allocate(1,0,0,1,0,0);z.rotateByCenter(Math.PI/2,L,F),e.transformFromMatrix(z,!0),Zt.free(z)}B&&(l?l(e,n.attribute,h):S&&(e.setStrokeStyle(n,n.attribute,_-t,w-i,h),e.strokeText(E,L,F,M))),R&&(s?s(e,n.attribute,h):x&&(e.setCommonStyle(n,n.attribute,_-t,w-i,h),e.fillText(E,L,F,M))),k&&(e.highPerformanceRestore(),e.setTransformForCurrent())};if(e.setTextStyleWithoutAlignBaseline(n.attribute,h,M),m==="horizontal"){const{multilineLayout:E}=n;if(!E)return void e.highPerformanceRestore();const{xOffset:T,yOffset:P}=E.bbox;B&&(l?l(e,n.attribute,h):S&&(e.setStrokeStyle(n,n.attribute,_-t,w-i,h),E.lines.forEach(k=>{e.strokeText(k.str,(k.leftOffset||0)+T+t,(k.topOffset||0)+P+i,M)}))),R&&(s?s(e,n.attribute,h):x&&(e.setCommonStyle(n,n.attribute,_-t,w-i,h),E.lines.forEach(k=>{e.fillText(k.str,(k.leftOffset||0)+T+t,(k.topOffset||0)+P+i,M),this.drawUnderLine(g,f,n,(k.leftOffset||0)+T+t,(k.topOffset||0)+P+i,k.descent,(k.descent-k.ascent)/2,M,h,e,{width:k.width})})))}else{let{textAlign:E=h.textAlign,textBaseline:T=h.textBaseline}=n.attribute;if(!C){const N=E;E=(d=n.getBaselineMapAlign()[T])!==null&&d!==void 0?d:"left",T=(u=n.getAlignMapBaseline()[N])!==null&&u!==void 0?u:"top"}n.tryUpdateAABBBounds();const P=n.cache,{verticalList:k}=P;e.textAlign="left",e.textBaseline="top";const L=y*k.length;let F=0;k.forEach(N=>{const W=N.reduce((D,G)=>D+(G.width||0),0);F=Ji(W,F)});let z=0,I=0;T==="bottom"?I=-L:T==="middle"&&(I=-L/2),E==="center"?z-=F/2:E==="right"&&(z-=F),k.forEach((N,W)=>{const D=N.reduce((X,$)=>X+($.width||0),0),G=F-D;let V=z;E==="center"?V+=G/2:E==="right"&&(V+=G),N.forEach(X=>{const{text:$,width:Q,direction:te}=X;H($,L-(W+1)*y+I,V,te),V+=Q})})}A&&this.restoreTransformUseContext2d(n,h,M,e),this.afterRenderStep(n,e,t,i,R,B,x,S,h,r,s,l)}draw(n,e,t,i){const r=ve(n,i==null?void 0:i.theme).text,{keepDirIn3d:o=r.keepDirIn3d}=n.attribute,s=!o;this._draw(n,r,s,t,i)}drawUnderLine(n,e,t,i,r,o,s,l,a,d,u){if(e+n<=0)return;const{textAlign:h=a.textAlign,fill:c=a.fill,opacity:g=a.opacity,underlineOffset:f=a.underlineOffset,underlineDash:p=a.underlineDash,fillOpacity:m=a.fillOpacity}=t.attribute,b=!Te(u),C=b?u.width:t.clipedWidth,_=b?0:So(h,C),w={lineWidth:0,stroke:c,opacity:g,strokeOpacity:m};if(n){w.lineWidth=n,d.setStrokeStyle(t,w,i,r,a),p&&d.setLineDash(p),d.beginPath();const y=r+o+f;d.moveTo(i+_,y,l),d.lineTo(i+_+C,y,l),d.stroke()}if(e){w.lineWidth=e,d.setStrokeStyle(t,w,i,r,a),d.beginPath();const y=r+s;d.moveTo(i+_,y,l),d.lineTo(i+_+C,y,l),d.stroke()}}};Kh=qx([se(),lp(0,Be(gt)),lp(0,At(ma)),Zx("design:paramtypes",[Object])],Kh);function z0(n,e,t,i){n.moveTo(e[0].x+t,e[0].y+i);for(let r=1;r<e.length;r++)n.lineTo(e[r].x+t,e[r].y+i)}function Jx(n,e,t,i,r,o=!0){var s;if(e.length<3)return void z0(n,e,t,i);let l=0,a=e.length-1;o||(l+=1,a-=1,n.moveTo(e[0].x+t,e[0].y+i));for(let d=l;d<=a;d++){const u=e[d===0?a:(d-1)%e.length],h=e[d%e.length],c=e[(d+1)%e.length],g=h.x-u.x,f=h.y-u.y,p=h.x-c.x,m=h.y-c.y,b=(Math.atan2(f,g)-Math.atan2(m,p))/2,C=Math.abs(Math.tan(b));let _=Array.isArray(r)?(s=r[d%e.length])!==null&&s!==void 0?s:0:r,w=_/C;const y=Tl(g,f),v=Tl(p,m),x=Math.min(y,v);w>x&&(w=x,_=x*C);const S=Wu(h,w,y,g,f),R=Wu(h,w,v,p,m),B=2*h.x-S.x-R.x,A=2*h.y-S.y-R.y,M=Tl(B,A),H=Wu(h,Tl(w,_),M,B,A);let E=Math.atan2(S.y-H.y,S.x-H.x);const T=Math.atan2(R.y-H.y,R.x-H.x);let P=T-E;P<0&&(E=T,P=-P),P>Math.PI&&(P-=Math.PI),d===0?n.moveTo(S.x+t,S.y+i):n.lineTo(S.x+t,S.y+i),P&&n.arcTo(h.x+t,h.y+i,R.x+t,R.y+i,_),n.lineTo(R.x+t,R.y+i)}o||n.lineTo(e[a+1].x+t,e[a+1].y+i)}function Tl(n,e){return Math.sqrt(n*n+e*e)}function Wu(n,e,t,i,r){const o=e/t;return{x:n.x-i*o,y:n.y-r*o}}const Qx=Io,eR=tr;var tR=function(n,e,t,i){var r,o=arguments.length,s=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,e,t,i);else for(var l=n.length-1;l>=0;l--)(r=n[l])&&(s=(o<3?r(s):o>3?r(e,t,s):r(e,t))||s);return o>3&&s&&Object.defineProperty(e,t,s),s},nR=function(n,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,e)},ap=function(n,e){return function(t,i){e(t,i,n)}};let Yh=class extends tn{constructor(n){super(),this.polygonRenderContribitions=n,this.numberType=nu,this.builtinContributions=[eR,Qx],this.init(n)}drawShape(n,e,t,i,r,o,s,l){const a=ve(n,o==null?void 0:o.theme).polygon,{points:d=a.points,cornerRadius:u=a.cornerRadius,x:h=a.x,y:c=a.y,closePath:g=a.closePath,fillStrokeOrder:f=a.fillStrokeOrder}=n.attribute,p=this.valid(n,a,s,l);if(!p)return;const{fVisible:m,sVisible:b,doFill:C,doStroke:_}=p;e.beginPath(),u<=0||ee(u)&&u.every(v=>v===0)?z0(e.camera?e:e.nativeContext,d,t,i):Jx(e.camera?e:e.nativeContext,d,t,i,u,g),g&&e.closePath(),e.setShadowBlendStyle&&e.setShadowBlendStyle(n,n.attribute,a),this.beforeRenderStep(n,e,t,i,C,_,m,b,a,r,s,l);const w=()=>{C&&(s?s(e,n.attribute,a):m&&(e.setCommonStyle(n,n.attribute,h-t,c-i,a),e.fill()))},y=()=>{_&&(l?l(e,n.attribute,a):b&&(e.setStrokeStyle(n,n.attribute,h-t,c-i,a),e.stroke()))};f?(y(),w()):(w(),y()),this.afterRenderStep(n,e,t,i,C,_,m,b,a,r,s,l)}draw(n,e,t,i){const r=ve(n,i==null?void 0:i.theme).polygon;this._draw(n,r,!1,t,i)}};Yh=tR([se(),ap(0,Be(gt)),ap(0,At(Nh)),nR("design:paramtypes",[Object])],Yh);var iR=function(n,e,t,i){var r,o=arguments.length,s=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,e,t,i);else for(var l=n.length-1;l>=0;l--)(r=n[l])&&(s=(o<3?r(s):o>3?r(e,t,s):r(e,t))||s);return o>3&&s&&Object.defineProperty(e,t,s),s},rR=function(n,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,e)},dp=function(n,e){return function(t,i){e(t,i,n)}};let Xh=class{constructor(n){this.groupRenderContribitions=n,this.numberType=Tf}drawShape(n,e,t,i,r,o,s,l){const a=ve(n,o==null?void 0:o.theme).group,{fill:d=a.fill,background:u,stroke:h=a.stroke,opacity:c=a.opacity,width:g=a.width,height:f=a.height,clip:p=a.clip,fillOpacity:m=a.fillOpacity,strokeOpacity:b=a.strokeOpacity,cornerRadius:C=a.cornerRadius,path:_=a.path,lineWidth:w=a.lineWidth,visible:y=a.visible,fillStrokeOrder:v=a.fillStrokeOrder,x=a.x,y:S=a.y}=n.attribute,R=M0(c,m,g,f,d),B=T0(c,b,g,f),A=zo(d,u),M=rl(h,w);if(!n.valid||!y||!p&&(!A&&!M||!(R||B||s||l||u)))return;if(_&&_.length&&r.drawContribution){const P=e.disableFill,k=e.disableStroke,L=e.disableBeginPath;e.disableFill=!0,e.disableStroke=!0,e.disableBeginPath=!0,_.forEach(F=>{r.drawContribution.getRenderContribution(F).draw(F,r.renderService,r,o)}),e.disableFill=P,e.disableStroke=k,e.disableBeginPath=L}else C===0||ee(C)&&C.every(P=>P===0)?(e.beginPath(),e.rect(t,i,g,f)):(e.beginPath(),ni(e,t,i,g,f,C));this._groupRenderContribitions||(this._groupRenderContribitions=this.groupRenderContribitions.getContributions()||[],this._groupRenderContribitions.push(px));const H={doFill:A,doStroke:M};this._groupRenderContribitions.forEach(P=>{P.time===Ee.beforeFillStroke&&P.drawShape(n,e,t,i,A,M,R,B,a,r,s,l,H)}),p&&e.clip(),e.setShadowBlendStyle&&e.setShadowBlendStyle(n,n.attribute,a);const E=()=>{H.doFill&&(s?s(e,n.attribute,a):R&&(e.setCommonStyle(n,n.attribute,x-t,S-i,a),e.fill()))},T=()=>{H.doStroke&&(l?l(e,n.attribute,a):B&&(e.setStrokeStyle(n,n.attribute,x-t,S-i,a),e.stroke()))};v?(T(),E()):(E(),T()),this._groupRenderContribitions.forEach(P=>{P.time===Ee.afterFillStroke&&P.drawShape(n,e,t,i,A,M,R,B,a,r,s,l)})}draw(n,e,t,i){const{context:r}=t;if(!r)return;const{clip:o,baseOpacity:s=1}=n.attribute;o?r.save():r.highPerformanceSave();const l=r.baseGlobalAlpha;r.baseGlobalAlpha*=s;const a=ve(n,i==null?void 0:i.theme).group,d=r.modelMatrix;if(r.camera){const g=ft.allocate(),f=ft.allocate();k0(f,n,a),ol(g,d||g,f),r.modelMatrix=g,ft.free(f),r.setTransform(1,0,0,1,0,0,!0)}else r.transformFromMatrix(n.transMatrix,!0);r.beginPath(),i.skipDraw?this.drawShape(n,r,0,0,t,i,()=>!1,()=>!1):this.drawShape(n,r,0,0,t);const{scrollX:u=a.scrollX,scrollY:h=a.scrollY}=n.attribute;let c;(u||h)&&r.translate(u,h),i&&i.drawingCb&&(c=i.drawingCb()),r.modelMatrix!==d&&ft.free(r.modelMatrix),r.modelMatrix=d,r.baseGlobalAlpha=l,c&&c.then?c.then(()=>{o?r.restore():r.highPerformanceRestore()}):o?r.restore():r.highPerformanceRestore()}};Xh=iR([se(),dp(0,Be(gt)),dp(0,At(En)),rR("design:paramtypes",[Object])],Xh);var oR=function(n,e,t,i){var r,o=arguments.length,s=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,e,t,i);else for(var l=n.length-1;l>=0;l--)(r=n[l])&&(s=(o<3?r(s):o>3?r(e,t,s):r(e,t))||s);return o>3&&s&&Object.defineProperty(e,t,s),s},sR=function(n,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,e)},up=function(n,e){return function(t,i){e(t,i,n)}};const lR=["","repeat-x","repeat-y","repeat"];let qh=class extends tn{constructor(n){super(),this.imageRenderContribitions=n,this.numberType=eu,this.builtinContributions=[wx,yx],this.init(n)}drawShape(n,e,t,i,r,o,s,l){const a=ve(n).image,{width:d=a.width,height:u=a.height,repeatX:h=a.repeatX,repeatY:c=a.repeatY,x:g=a.x,y:f=a.y,cornerRadius:p=a.cornerRadius,fillStrokeOrder:m=a.fillStrokeOrder,image:b}=n.attribute,C=this.valid(n,a,s);if(!C)return;const{fVisible:_,sVisible:w,doFill:y,doStroke:v}=C;if(!b||!n.resources)return;const x=n.resources.get(b);if(x.state!=="success")return;let S=!1;p===0||ee(p)&&p.every(A=>A===0)||(e.beginPath(),ni(e,t,i,d,u,p),S=!0),e.setShadowBlendStyle&&e.setShadowBlendStyle(n,n.attribute,a);const R=()=>{if(y){if(s)s(e,n.attribute,a);else if(_){e.setCommonStyle(n,n.attribute,t,i,a);let A=0;if(h==="repeat"&&(A|=1),c==="repeat"&&(A|=2),A){const M=e.createPattern(x.data,lR[A]);e.fillStyle=M,e.translate(t,i,!0),e.fillRect(0,0,d,u),e.translate(-t,-i,!0)}else e.drawImage(x.data,t,i,d,u)}}},B=()=>{v&&(l?l(e,n.attribute,a):w&&(e.setStrokeStyle(n,n.attribute,g-t,f-i,a),e.stroke()))};m?(B(),S&&(e.save(),e.clip()),this.beforeRenderStep(n,e,t,i,y,!1,_,!1,a,r,s),R(),S&&e.restore()):(S&&(e.save(),e.clip()),this.beforeRenderStep(n,e,t,i,y,!1,_,!1,a,r,s),R(),S&&e.restore(),B()),this.afterRenderStep(n,e,t,i,y,!1,_,!1,a,r,s)}draw(n,e,t){const{image:i}=n.attribute;if(!i||!n.resources)return;const r=n.resources.get(i);if(r.state==="loading"&&je(i))return void Ne.improveImageLoading(i);if(r.state!=="success")return;const{context:o}=e.drawParams;if(!o)return;const s=ve(n).image;this._draw(n,s,!1,t)}};qh=oR([se(),up(0,Be(gt)),up(0,At(yr)),sR("design:paramtypes",[Object])],qh);const I0=Symbol.for("IncrementalDrawContribution"),xa=Symbol.for("ArcRender"),Ra=Symbol.for("CircleRender"),$t=Symbol.for("GraphicRender"),hp=Symbol.for("GroupRender"),Aa=Symbol.for("LineRender"),Ba=Symbol.for("PathRender"),Ma=Symbol.for("PolygonRender"),Ta=Symbol.for("RectRender"),Pa=Symbol.for("SymbolRender"),Zh=Symbol.for("TextRender"),Jh=Symbol.for("RichTextRender"),cp=Symbol.for("ImageRender"),If=Symbol.for("DrawContribution"),O0=(n,e,t,i)=>{let r,o=!1,s=!1;if(e.forEachChildren(l=>(o=l.numberType===zS,!o)),e.forEachChildren(l=>(s=!!l.findFace,!s)),o){const l=e.getChildren(),a=[...l];a.sort((d,u)=>{var h,c,g,f;let p=((c=(h=d.attribute.startAngle)!==null&&h!==void 0?h:0+d.attribute.endAngle)!==null&&c!==void 0?c:0)/2,m=((f=(g=u.attribute.startAngle)!==null&&g!==void 0?g:0+u.attribute.endAngle)!==null&&f!==void 0?f:0)/2;for(;p<0;)p+=Ge;for(;m<0;)m+=Ge;return m-p}),a.forEach(d=>{d._next=null,d._prev=null}),e.removeAllChild(),e.update(),a.forEach(d=>{e.appendChild(d)}),i.hack_pieFace="outside",r=t(o,s),r&&r.graphic||(i.hack_pieFace="inside",r=t(o,s)),r&&r.graphic||(i.hack_pieFace="top",r=t(o,s)),e.removeAllChild(),l.forEach(d=>{d._next=null,d._prev=null}),l.forEach(d=>{e.appendChild(d)})}else if(s){const l=e.getChildren(),a=l.map(d=>({ave_z:d.findFace().vertices.map(u=>{var h;return n.view(u[0],u[1],(h=u[2]+d.attribute.z)!==null&&h!==void 0?h:0)[2]}).reduce((u,h)=>u+h,0),g:d}));a.sort((d,u)=>u.ave_z-d.ave_z),e.removeAllChild(),a.forEach(d=>{d.g._next=null,d.g._prev=null}),e.update(),a.forEach(d=>{e.add(d.g)}),r=t(o,s),e.removeAllChild(),l.forEach(d=>{d._next=null,d._prev=null}),e.update(),l.forEach(d=>{e.add(d)})}else r=t(o,s);return r};var aR=function(n,e,t,i){var r,o=arguments.length,s=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,e,t,i);else for(var l=n.length-1;l>=0;l--)(r=n[l])&&(s=(o<3?r(s):o>3?r(e,t,s):r(e,t))||s);return o>3&&s&&Object.defineProperty(e,t,s),s},dR=function(n,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,e)};const Fs=Symbol.for("DrawItemInterceptor"),fp=new Ue,gp=new Ue;class uR{constructor(){this.order=1}afterDrawItem(e,t,i,r,o){return e.attribute.shadowRootIdx==null&&e.shadowRoot&&e.shadowRoot.attribute.shadowRootIdx<0||(e.attribute.shadowRootIdx>0||!e.attribute.shadowRootIdx||e.shadowRoot&&e.shadowRoot.attribute.shadowRootIdx>0)&&this.drawItem(e,t,i,r,o),!1}beforeDrawItem(e,t,i,r,o){return e.attribute.shadowRootIdx==null&&e.shadowRoot&&e.shadowRoot.attribute.shadowRootIdx>0||(e.attribute.shadowRootIdx<0||e.shadowRoot&&e.shadowRoot.attribute.shadowRootIdx<0)&&this.drawItem(e,t,i,r,o),!1}drawItem(e,t,i,r,o){if(!e.shadowRoot)return!1;const{context:s}=i;if(s.highPerformanceSave(),s.transformFromMatrix(e.transMatrix,!0),r.dirtyBounds&&r.backupDirtyBounds){fp.copy(r.dirtyBounds),gp.copy(r.backupDirtyBounds);const l=e.globalTransMatrix.getInverse();r.dirtyBounds.copy(r.backupDirtyBounds).transformWithMatrix(l),r.backupDirtyBounds.copy(r.dirtyBounds)}return r.renderGroup(e.shadowRoot,i,Zt.allocate(1,0,0,1,0,0)),s.highPerformanceRestore(),r.dirtyBounds&&r.backupDirtyBounds&&(r.dirtyBounds.copy(fp),r.backupDirtyBounds.copy(gp)),!0}}class hR{constructor(){this.order=1}afterDrawItem(e,t,i,r,o){return e.attribute._debug_bounds&&this.drawItem(e,t,i,r,o),!1}drawItem(e,t,i,r,o){if(!e.attribute._debug_bounds)return!1;const{context:s}=i;s.highPerformanceSave(),e.parent&&s.setTransformFromMatrix(e.parent.globalTransMatrix,!0),e.glyphHost&&e.glyphHost.parent&&s.setTransformFromMatrix(e.glyphHost.parent.globalTransMatrix,!0);const l=e.AABBBounds;return e.attribute._debug_bounds!==!0&&e.attribute._debug_bounds(s,e),s.strokeRect(l.x1,l.y1,l.width(),l.height()),s.highPerformanceRestore(),!0}}let Ha=class{constructor(){this.order=1,this.interceptors=[new uR,new fR,new cR,new hR]}afterDrawItem(n,e,t,i,r){for(let o=0;o<this.interceptors.length;o++)if(this.interceptors[o].afterDrawItem&&this.interceptors[o].afterDrawItem(n,e,t,i,r))return!0;return!1}beforeDrawItem(n,e,t,i,r){if((!n.in3dMode||t.in3dInterceptor)&&!n.shadowRoot&&!(n.baseGraphic||n.attribute.globalZIndex||n.interactiveGraphic))return!1;for(let o=0;o<this.interceptors.length;o++)if(this.interceptors[o].beforeDrawItem&&this.interceptors[o].beforeDrawItem(n,e,t,i,r))return!0;return!1}};Ha=aR([se(),dR("design:paramtypes",[])],Ha);class cR{constructor(){this.order=1}beforeDrawItem(e,t,i,r,o){return!this.processing&&(e.baseGraphic?this.beforeDrawInteractive(e,t,i,r,o):this.beforeSetInteractive(e,t,i,r,o))}beforeSetInteractive(e,t,i,r,o){let s=e.interactiveGraphic;if(e.attribute.globalZIndex){s||(s=e.clone(),e.interactiveGraphic=s,s.baseGraphic=e),s.setAttributes({globalZIndex:0,zIndex:e.attribute.globalZIndex},!1,{skipUpdateCallback:!0}),i.stage.tryInitInteractiveLayer();const l=i.stage.getLayer("_builtin_interactive");return l&&this.getShadowRoot(l).add(s),!0}if(s){i.stage.tryInitInteractiveLayer();const l=i.stage.getLayer("_builtin_interactive");l&&this.getShadowRoot(l).removeChild(s),e.interactiveGraphic=null,s.baseGraphic=null}return!1}beforeDrawInteractive(e,t,i,r,o){const s=e.baseGraphic;let l=!!s.stage,a=s.parent;for(;l&&a&&a.stage!==a;)l=!!a.stage,a=a.parent;if(!l){const d=i.stage.getLayer("_builtin_interactive");return d&&this.getShadowRoot(d).removeChild(e),!0}if(s){this.processing=!0;const{context:d}=i;return d.highPerformanceSave(),d.setTransformFromMatrix(s.parent.globalTransMatrix,!0),s.isContainer?r.renderGroup(s,i,s.parent.globalTransMatrix):r.renderItem(s,i),d.highPerformanceRestore(),this.processing=!1,!0}return!1}getShadowRoot(e){var t;let i=e.getElementById("_interactive_group");return i||(i=ge.CreateGraphic("group",{}),i.id="_interactive_group",e.add(i)),(t=i.shadowRoot)!==null&&t!==void 0?t:i.attachShadow()}}class fR{constructor(){this.order=1}beforeDrawItem(e,t,i,r,o){if(!e.in3dMode||i.in3dInterceptor)return!1;i.in3dInterceptor=!0;const{context:s,stage:l}=t.drawParams;s.canvas,s.save(),this.initCanvasCtx(s),s.camera=l.camera;const a=s.currentMatrix;a.a/=s.dpr,a.b/=s.dpr,a.c/=s.dpr,a.d/=s.dpr,a.e/=s.dpr,a.f/=s.dpr;const d=ft.allocate();Gh(d,a);const u=s.modelMatrix;if(u){if(d){const h=ft.allocate();s.modelMatrix=ol(h,u,d)}}else s.modelMatrix=d;return s.setTransform(1,0,0,1,0,0,!0),e.isContainer?O0(s,e,(h,c)=>r.renderGroup(e,i,e.parent.globalTransMatrix,!h&&c),i):r.renderItem(e,i),s.camera=null,s.restore(),s.modelMatrix!==u&&ft.free(s.modelMatrix),s.modelMatrix=u,i.in3dInterceptor=!1,!0}initCanvasCtx(e){e.setTransformForCurrent()}}var gR=function(n,e,t,i){var r,o=arguments.length,s=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,e,t,i);else for(var l=n.length-1;l>=0;l--)(r=n[l])&&(s=(o<3?r(s):o>3?r(e,t,s):r(e,t))||s);return o>3&&s&&Object.defineProperty(e,t,s),s},pR=function(n,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,e)},mR=function(n,e){return function(t,i){e(t,i,n)}};const D0=Symbol.for("RenderService");let Qh=class{constructor(n){this.drawContribution=n}prepare(n){n&&this.renderTreeRoots.forEach(e=>{this._prepare(e,n)})}_prepare(n,e){n.forEachChildren(t=>{this._prepare(t,e)}),n.update({bounds:e,trans:!0})}prepareRenderList(){}beforeDraw(n){}draw(n){this.drawContribution.draw(this,Object.assign({},this.drawParams))}afterDraw(n){this.drawContribution.afterDraw&&this.drawContribution.afterDraw(this,Object.assign({},this.drawParams))}render(n,e){this.renderTreeRoots=n,this.drawParams=e;const t=e.updateBounds;this.prepare(t),this.prepareRenderList(),this.beforeDraw(e),this.draw(e),this.afterDraw(e),this.drawParams=null}};Qh=gR([se(),mR(0,Be(If)),pR("design:paramtypes",[Object])],Qh);const bR=new we(n=>{n(D0).to(Qh)}),co=Symbol.for("PickerService"),pp=Symbol.for("GlobalPickerService"),sl=(n,e,t)=>{const{outerBorder:i,shadowBlur:r=e.shadowBlur}=n;if(i){const o=e.outerBorder,{distance:s=o.distance,lineWidth:l=o.lineWidth}=i;t.expand(s+(r+l)/2)}return t},mp=["radius","startAngle","endAngle",...Pn];class Ao extends en{constructor(e={radius:1}){super(e),this.type="circle",this.numberType=Qd}isValid(){return super.isValid()&&this._isValid()}_isValid(){const{startAngle:e,endAngle:t,radius:i}=this.attribute;return this._validNumber(e)&&this._validNumber(t)&&this._validNumber(i)}getGraphicTheme(){return ve(this).circle}updateAABBBounds(e,t,i,r){this.updatePathProxyAABBBounds(i)||(r?this.updateCircleAABBBoundsImprecise(e,t,i):this.updateCircleAABBBoundsAccurate(e,t,i));const{tb1:o,tb2:s}=U.graphicService.updateTempAABBBounds(i);return sl(e,t,o),i.union(o),o.setValue(s.x1,s.y1,s.x2,s.y2),U.graphicService.transformAABBBounds(e,i,t,!1,this),i}updateCircleAABBBoundsImprecise(e,t,i){const{radius:r=t.radius}=e;return i.set(-r,-r,r,r),i}updateCircleAABBBoundsAccurate(e,t,i){const{startAngle:r=t.startAngle,endAngle:o=t.endAngle,radius:s=t.radius}=e;return o-r>Ge-Ye?i.set(-s,-s,s,s):Fh(r,o,s,i),i}needUpdateTags(e){return super.needUpdateTags(e,mp)}needUpdateTag(e){return super.needUpdateTag(e,mp)}toCustomPath(){var e,t,i;const r=this.attribute,o=(e=r.radius)!==null&&e!==void 0?e:this.getDefaultAttribute("radius"),s=(t=r.startAngle)!==null&&t!==void 0?t:this.getDefaultAttribute("startAngle"),l=(i=r.endAngle)!==null&&i!==void 0?i:this.getDefaultAttribute("endAngle"),a=new Bt;return a.arc(0,0,o,s,l),a}clone(){return new Ao(Object.assign({},this.attribute))}getNoWorkAnimateAttr(){return Ao.NOWORK_ANIMATE_ATTR}}Ao.NOWORK_ANIMATE_ATTR=Gn;function W0(n){return new Ao(n)}class ec{constructor(e,t,i){this.fontFamily=e,this.textOptions=t,this.textMeasure=i}LayoutBBox(e,t,i,r){if(e.xOffset=t==="left"||t==="start"?0:t==="center"?e.width/-2:t==="right"||t==="end"?-e.width:0,i==="top")e.yOffset=0;else if(i==="middle")e.yOffset=e.height/-2;else if(i==="alphabetic"){let o=.79;if(r.length===1){const s=r[0];o=s.ascent/(s.ascent+s.descent)}e.yOffset=e.height*-o}else e.yOffset=-e.height;return e}GetLayoutByLines(e,t,i,r,o="",s,l){const{lineWidth:a,suffixPosition:d="end",measureMode:u=Sr.actualBounding,keepCenterInLine:h=!1}=l??{};e=e.map(p=>p.toString());const c=[],g=[0,0];if(typeof a=="number"&&a!==1/0){let p;for(let m=0,b=e.length;m<b;m++){const C=this.textMeasure.measureTextPixelADscentAndWidth(e[m],this.textOptions,u);let _=e[m].toString();if(C.width>a){const w=this.textMeasure.clipTextWithSuffix(e[m],this.textOptions,a,o,s,d);_=w.str,p=w.width}else p=C.width;c.push({str:_,width:p,ascent:C.ascent,descent:C.descent,keepCenterInLine:h})}g[0]=a}else{let p,m,b=0;for(let C=0,_=e.length;C<_;C++){m=e[C];const w=this.textMeasure.measureTextPixelADscentAndWidth(e[C],this.textOptions,u);p=w.width,b=Math.max(b,p),c.push({str:m,width:p,ascent:w.ascent,descent:w.descent,keepCenterInLine:h})}g[0]=b}g[1]=c.length*r,g[0]=c.reduce((p,m)=>Math.max(p,m.width),0);const f={xOffset:0,yOffset:0,width:g[0],height:g[1]};return this.LayoutBBox(f,t,i,c),this.layoutWithBBox(f,c,t,i,r)}layoutWithBBox(e,t,i,r,o){const s=[0,0],l=t.length*o;r==="top"||(r==="middle"?s[1]=(e.height-l)/2:r==="bottom"&&(s[1]=e.height-l));for(let a=0;a<t.length;a++)this.lineOffset(e,t[a],i,r,o,s);return{bbox:e,lines:t,fontFamily:this.fontFamily,fontSize:this.textOptions.fontSize,fontWeight:this.textOptions.fontWeight,lineHeight:o,textAlign:i,textBaseline:r}}lineOffset(e,t,i,r,o,s){if(i==="left"||i==="start"?t.leftOffset=0:i==="center"?t.leftOffset=(e.width-t.width)/2:i!=="right"&&i!=="end"||(t.leftOffset=e.width-t.width),t.topOffset=o/2+(t.ascent-t.descent)/2+s[1],!t.keepCenterInLine){const a=t.ascent+t.descent+0;if(a<o-0&&(r==="bottom"?t.topOffset+=(o-a)/2:r==="top"&&(t.topOffset-=(o-a)/2)),r==="alphabetic"){const d=o/(t.ascent+t.descent);t.topOffset=o/2+(t.ascent-t.descent)/2*d+s[1]}}return s[1]+=o,t}}const bp=["text","maxLineWidth","maxWidth","textAlign","textBaseline","heightLimit","lineClamp","fontSize","fontFamily","fontWeight","ellipsis","lineHeight","direction","wordBreak","heightLimit","lineClamp",...Pn];let Rt=class Di extends en{get font(){const e=this.getGraphicTheme();return this._font||(this._font=vh(this.attribute,e)),this._font}get clipedText(){var e;const t=this.attribute,i=this.getGraphicTheme(),r=this.getMaxWidth(i);return Number.isFinite(r)?(this.tryUpdateAABBBounds(),this.cache.clipedText):((e=t.text)!==null&&e!==void 0?e:i.text).toString()}get clipedWidth(){return this.tryUpdateAABBBounds(),this.cache.clipedWidth}get cliped(){var e,t;const i=this.getGraphicTheme(),r=this.attribute,o=this.getMaxWidth(i);if(!Number.isFinite(o))return!1;const{text:s}=this.attribute;if(this.tryUpdateAABBBounds(),(t=(e=this.cache)===null||e===void 0?void 0:e.layoutData)===null||t===void 0?void 0:t.lines){let l="";return this.cache.layoutData.lines.forEach(a=>{l+=a.str}),(Array.isArray(s)?s.join(""):s)!==l}return r.direction==="vertical"&&this.cache.verticalList&&this.cache.verticalList[0]?this.cache.verticalList[0].map(l=>l.text).join("")!==r.text.toString():this.clipedText!=null&&this.clipedText!==r.text.toString()}get multilineLayout(){return this.tryUpdateAABBBounds(),this.cache.layoutData}get isMultiLine(){return Array.isArray(this.attribute.text)||this.attribute.whiteSpace==="normal"}constructor(e={text:"",fontSize:16}){super(e),this.type="text",this.numberType=ru,this.cache={}}isValid(){return super.isValid()&&this._isValid()}_isValid(){const{text:e}=this.attribute;return ee(e)?!e.every(t=>t==null||t===""):e!=null&&e!==""}getGraphicTheme(){return ve(this).text}doUpdateOBBBounds(){const e=this.getGraphicTheme();this._OBBBounds.clear();const t=this.attribute,{angle:i=e.angle}=t;if(!i){const d=this.AABBBounds;return this._OBBBounds.setValue(d.x1,d.y1,d.x2,d.y2),this._OBBBounds}this.obbText||(this.obbText=new Di({})),this.obbText.setAttributes(Object.assign(Object.assign({},t),{angle:0}));const r=this.obbText.AABBBounds,{x:o,y:s}=t,l={x:(r.x1+r.x2)/2,y:(r.y1+r.y2)/2},a=F_(l,i,{x:o,y:s});return this._OBBBounds.copy(r),this._OBBBounds.translate(a.x-l.x,a.y-l.y),this._OBBBounds.angle=i,this._OBBBounds}updateAABBBounds(e,t,i){const{text:r=t.text}=this.attribute;Array.isArray(r)?this.updateMultilineAABBBounds(r):this.updateSingallineAABBBounds(r);const{tb1:o}=U.graphicService.updateTempAABBBounds(i),{scaleX:s=t.scaleX,scaleY:l=t.scaleY,shadowBlur:a=t.shadowBlur,strokeBoundsBuffer:d=t.strokeBoundsBuffer}=e;if(a){const u=a/Math.abs(s+l);ga(o,u,!0,d),i.union(o)}return U.graphicService.combindShadowAABBBounds(i,this),e.forceBoundsHeight==null&&e.forceBoundsWidth==null||U.graphicService.updateHTMLTextAABBBounds(e,t,i),L_(i,i,this.transMatrix),i}updateSingallineAABBBounds(e){this.updateMultilineAABBBounds([e]);const t=this.cache.layoutData;if(t&&t.lines&&t.lines.length){const i=t.lines[0];this.cache.clipedText=i.str,this.cache.clipedWidth=i.width}return this._AABBBounds}updateMultilineAABBBounds(e){const t=this.getGraphicTheme(),{direction:i=t.direction,underlineOffset:r=t.underlineOffset}=this.attribute,o=i==="horizontal"?this.updateHorizontalMultilineAABBBounds(e):this.updateVerticalMultilineAABBBounds(e);return i==="horizontal"&&r&&this._AABBBounds.add(this._AABBBounds.x1,this._AABBBounds.y2+r),o}guessLineHeightBuf(e){return e?.1*e:0}updateHorizontalMultilineAABBBounds(e){var t;const i=this.getGraphicTheme(),r=this.attribute,{fontFamily:o=i.fontFamily,textAlign:s=i.textAlign,textBaseline:l=i.textBaseline,fontSize:a=i.fontSize,fontWeight:d=i.fontWeight,ellipsis:u=i.ellipsis,maxLineWidth:h,stroke:c=i.stroke,wrap:g=i.wrap,measureMode:f=i.measureMode,lineWidth:p=i.lineWidth,whiteSpace:m=i.whiteSpace,suffixPosition:b=i.suffixPosition,ignoreBuf:C=i.ignoreBuf,keepCenterInLine:_=i.keepCenterInLine}=r,w=C?0:this.guessLineHeightBuf(a),y=this.getLineHeight(r,i,w);if(m==="normal"||g)return this.updateWrapAABBBounds(e);if(!this.shouldUpdateShape()&&(!((t=this.cache)===null||t===void 0)&&t.layoutData)){const R=this.cache.layoutData.bbox;return this._AABBBounds.set(R.xOffset,R.yOffset,R.xOffset+R.width,R.yOffset+R.height),c&&this._AABBBounds.expand(p/2),this._AABBBounds}const v=U.graphicUtil.textMeasure,x=new ec(o,{fontSize:a,fontWeight:d,fontFamily:o,lineHeight:y},v).GetLayoutByLines(e,s,l,y,u===!0?i.ellipsis:u||void 0,!1,{lineWidth:h,suffixPosition:b,measureMode:f,keepCenterInLine:_}),{bbox:S}=x;return this.cache.layoutData=x,this.clearUpdateShapeTag(),this._AABBBounds.set(S.xOffset,S.yOffset,S.xOffset+S.width,S.yOffset+S.height),c&&this._AABBBounds.expand(p/2),this._AABBBounds}updateWrapAABBBounds(e){var t,i,r;const o=this.getGraphicTheme(),{fontFamily:s=o.fontFamily,textAlign:l=o.textAlign,textBaseline:a=o.textBaseline,fontSize:d=o.fontSize,ellipsis:u=o.ellipsis,maxLineWidth:h,stroke:c=o.stroke,lineWidth:g=o.lineWidth,wordBreak:f=o.wordBreak,fontWeight:p=o.fontWeight,ignoreBuf:m=o.ignoreBuf,measureMode:b=o.measureMode,suffixPosition:C=o.suffixPosition,heightLimit:_=0,lineClamp:w,keepCenterInLine:y=o.keepCenterInLine}=this.attribute,v=m?0:this.guessLineHeightBuf(d),x=this.getLineHeight(this.attribute,o,v);if(!this.shouldUpdateShape()&&(!((t=this.cache)===null||t===void 0)&&t.layoutData)){const k=this.cache.layoutData.bbox;return this._AABBBounds.set(k.xOffset,k.yOffset,k.xOffset+k.width,k.yOffset+k.height),c&&this._AABBBounds.expand(g/2),this._AABBBounds}const S=U.graphicUtil.textMeasure,R={fontSize:d,fontWeight:p,fontFamily:s,lineHeight:x},B=new ec(s,R,S),A=ee(e)?e.map(k=>k.toString()):[e.toString()],M=[],H=[0,0];let E=1/0;if(_>0&&(E=Math.max(Math.floor(_/x),1)),w&&(E=Math.min(E,w)),typeof h=="number"&&h!==1/0){if(h>0)for(let L=0;L<A.length;L++){const F=A[L];let z=!0;if(L===E-1){const D=S.clipTextWithSuffix(F,R,h,u,!1,C,L!==A.length-1),G=S.measureTextPixelADscentAndWidth(D.str,R,b);M.push({str:D.str,width:D.width,ascent:G.ascent,descent:G.descent,keepCenterInLine:y});break}const I=S.clipText(F,R,h,f!=="break-all",f==="keep-all");if(F!==""&&I.str===""||I.wordBreaked){if(u){const D=S.clipTextWithSuffix(F,R,h,u,!1,C);I.str=(i=D.str)!==null&&i!==void 0?i:"",I.width=(r=D.width)!==null&&r!==void 0?r:0}else I.str="",I.width=0;z=!1}const N=S.measureTextPixelADscentAndWidth(I.str,R,b);M.push({str:I.str,width:I.width,ascent:N.ascent,descent:N.descent,keepCenterInLine:y});let W=I.str.length;if(!I.wordBreaked||F!==""&&I.str===""||(z=!0,W=I.wordBreaked),I.str.length!==F.length){if(z){let D=F.substring(W);f==="keep-all"&&(D=D.replace(/^\s+/g,"")),A.splice(L+1,0,D)}}}let k=0;M.forEach(L=>{k=Math.max(k,L.width)}),H[0]=k}else{let k,L,F=0;for(let z=0,I=A.length;z<I;z++){if(z===E-1){const W=S.clipTextWithSuffix(A[z],R,h,u,!1,C),D=S.measureTextPixelADscentAndWidth(W.str,R,b);M.push({str:W.str,width:W.width,ascent:D.ascent,descent:D.descent,keepCenterInLine:y}),F=Math.max(F,W.width);break}L=A[z],k=S.measureTextWidth(L,R),F=Math.max(F,k);const N=S.measureTextPixelADscentAndWidth(L,R,b);M.push({str:L,width:k,ascent:N.ascent,descent:N.descent,keepCenterInLine:y})}H[0]=F}H[1]=M.length*x;const T={xOffset:0,yOffset:0,width:H[0],height:H[1]};B.LayoutBBox(T,l,a,M);const P=B.layoutWithBBox(T,M,l,a,x);return this.cache.layoutData=P,this.clearUpdateShapeTag(),this._AABBBounds.set(T.xOffset,T.yOffset,T.xOffset+T.width,T.yOffset+T.height),c&&this._AABBBounds.expand(g/2),this._AABBBounds}updateVerticalMultilineAABBBounds(e){var t,i;const r=this.getGraphicTheme(),o=U.graphicUtil.textMeasure;let s;const l=this.attribute,{maxLineWidth:a=r.maxLineWidth,ellipsis:d=r.ellipsis,fontFamily:u=r.fontFamily,fontSize:h=r.fontSize,fontWeight:c=r.fontWeight,stroke:g=r.stroke,lineWidth:f=r.lineWidth,verticalMode:p=r.verticalMode,suffixPosition:m=r.suffixPosition}=l,b=this.getLineHeight(l,r,0);let{textAlign:C=r.textAlign,textBaseline:_=r.textBaseline}=l;if(!p){const S=C;C=(t=Di.baselineMapAlign[_])!==null&&t!==void 0?t:"left",_=(i=Di.alignMapBaseline[S])!==null&&i!==void 0?i:"top"}if(s=0,!this.shouldUpdateShape()&&this.cache){this.cache.verticalList.forEach(A=>{const M=A.reduce((H,E)=>H+E.width,0);s=Ji(M,s)});const S=So(C,s),R=this.cache.verticalList.length*b,B=Es(_,R,h);return this._AABBBounds.set(B,S,B+R,S+s),g&&this._AABBBounds.expand(f/2),this._AABBBounds}const w=e.map(S=>kS(S.toString()));w.forEach((S,R)=>{if(Number.isFinite(a))if(d){const B=d===!0?r.ellipsis:d,A=o.clipTextWithSuffixVertical(S,{fontSize:h,fontWeight:c,fontFamily:u},a,B,!1,m);w[R]=A.verticalList,s=A.width}else{const B=o.clipTextVertical(S,{fontSize:h,fontWeight:c,fontFamily:u},a,!1);w[R]=B.verticalList,s=B.width}else s=0,S.forEach(B=>{const A=B.direction===ho.HORIZONTAL?h:o.measureTextWidth(B.text,{fontSize:h,fontWeight:c,fontFamily:u});s+=A,B.width=A})}),this.cache.verticalList=w,this.clearUpdateShapeTag(),this.cache.verticalList.forEach(S=>{const R=S.reduce((B,A)=>B+A.width,0);s=Ji(R,s)});const y=So(C,s),v=this.cache.verticalList.length*b,x=Es(_,v,h);return this._AABBBounds.set(x,y,x+v,y+s),g&&this._AABBBounds.expand(f/2),this._AABBBounds}getMaxWidth(e){var t,i;const r=this.attribute;return(i=(t=r.maxLineWidth)!==null&&t!==void 0?t:r.maxWidth)!==null&&i!==void 0?i:e.maxWidth}getLineHeight(e,t,i){var r;return(r=nl(e.lineHeight,e.fontSize||t.fontSize))!==null&&r!==void 0?r:(e.fontSize||t.fontSize)+i}needUpdateTags(e,t=bp){return super.needUpdateTags(e,t)}needUpdateTag(e,t=bp){return super.needUpdateTag(e,t)}clone(){return new Di(Object.assign({},this.attribute))}getNoWorkAnimateAttr(){return Di.NOWORK_ANIMATE_ATTR}getBaselineMapAlign(){return Di.baselineMapAlign}getAlignMapBaseline(){return Di.alignMapBaseline}};Rt.NOWORK_ANIMATE_ATTR=Object.assign({ellipsis:1,wordBreak:1,direction:1,textAlign:1,textBaseline:1,fontFamily:1,fontWeight:1},Gn),Rt.baselineMapAlign={top:"left",bottom:"right",middle:"center"},Rt.alignMapBaseline={left:"top",right:"bottom",center:"middle"};function tc(n){return new Rt(n)}const Pl=["heightLimit","lineClamp"];class Of extends Rt{constructor(e){super(Object.assign(Object.assign({},e),{wrap:!0}))}_isValid(){const{text:e}=this.attribute;return ee(e)?!e.every(t=>t==null||t===""):e!=null&&e!==""}updateMultilineAABBBounds(e){var t,i,r,o;const s=this.getGraphicTheme(),{fontFamily:l=s.fontFamily,textAlign:a=s.textAlign,textBaseline:d=s.textBaseline,fontSize:u=s.fontSize,ellipsis:h=s.ellipsis,maxLineWidth:c,stroke:g=s.stroke,lineWidth:f=s.lineWidth,wordBreak:p=s.wordBreak,fontWeight:m=s.fontWeight,ignoreBuf:b=s.ignoreBuf,heightLimit:C=0,suffixPosition:_=s.suffixPosition,lineClamp:w}=this.attribute,y=(t=nl(this.attribute.lineHeight,this.attribute.fontSize||s.fontSize))!==null&&t!==void 0?t:this.attribute.fontSize||s.fontSize,v=b?0:2;if(!this.shouldUpdateShape()&&(!((i=this.cache)===null||i===void 0)&&i.layoutData)){const T=this.cache.layoutData.bbox;return this._AABBBounds.set(T.xOffset,T.yOffset,T.xOffset+T.width,T.yOffset+T.height),g&&this._AABBBounds.expand(f/2),this._AABBBounds}const x=U.graphicUtil.textMeasure,S=new ec(l,{fontSize:u,fontWeight:m,fontFamily:l},x),R=e.map(T=>T.toString()),B=[],A=[0,0];let M=1/0;if(C>0&&(M=Math.max(Math.floor(C/y),1)),w&&(M=Math.min(M,w)),typeof c=="number"&&c!==1/0){if(c>0)for(let P=0;P<R.length;P++){const k=R[P];let L=!0;if(P===M-1){const z=S.textMeasure.clipTextWithSuffix(k,S.textOptions,c,h,!1,_);B.push({str:z.str,width:z.width,ascent:0,descent:0,keepCenterInLine:!1});break}const F=S.textMeasure.clipText(k,S.textOptions,c,p==="break-word");if(k!==""&&F.str===""){if(h){const z=S.textMeasure.clipTextWithSuffix(k,S.textOptions,c,h,!1,_);F.str=(r=z.str)!==null&&r!==void 0?r:"",F.width=(o=z.width)!==null&&o!==void 0?o:0}else F.str="",F.width=0;L=!1}if(B.push({str:F.str,width:F.width,ascent:0,descent:0,keepCenterInLine:!1}),F.str.length!==k.length){if(L){const z=k.substring(F.str.length);R.splice(P+1,0,z)}}}let T=0;B.forEach(P=>{T=Math.max(T,P.width)}),A[0]=T}else{let T,P,k=0;for(let L=0,F=R.length;L<F;L++){if(L===M-1){const z=S.textMeasure.clipTextWithSuffix(R[L],S.textOptions,c,h,!1,_);B.push({str:z.str,width:z.width,ascent:0,descent:0,keepCenterInLine:!1}),k=Math.max(k,z.width);break}P=R[L],T=S.textMeasure.measureTextWidth(P,S.textOptions,p==="break-word"),k=Math.max(k,T),B.push({str:P,width:T,ascent:0,descent:0,keepCenterInLine:!1})}A[0]=k}A[1]=B.length*(y+v);const H={xOffset:0,yOffset:0,width:A[0],height:A[1]};S.LayoutBBox(H,a,d);const E=S.layoutWithBBox(H,B,a,d,y);return this.cache.layoutData=E,this.clearUpdateShapeTag(),this._AABBBounds.set(H.xOffset,H.yOffset,H.xOffset+H.width,H.yOffset+H.height),g&&this._AABBBounds.expand(f/2),this._AABBBounds}needUpdateTags(e){for(let t=0;t<Pl.length;t++){const i=Pl[t];if(e.indexOf(i)!==-1)return!0}return super.needUpdateTags(e)}needUpdateTag(e){for(let t=0;t<Pl.length;t++)if(e===Pl[t])return!0;return super.needUpdateTag(e)}getNoWorkAnimateAttr(){return Of.NOWORK_ANIMATE_ATTR}}function CR(n){return new Of(n)}class dt{bounds(e,t){if(J(e)){const i=e/2;t.x1=-i,t.x2=i,t.y1=-i,t.y2=i}else t.x1=-e[0]/2,t.x2=e[0]/2,t.y1=-e[1]/2,t.y2=e[1]/2}parseSize(e){return J(e)?e:Math.min(e[0],e[1])}}function Cp(n,e,t,i,r){return r?n.arc(t,i,e,0,dn,!1,r):n.arc(t,i,e,0,dn),!1}class _R extends dt{constructor(){super(...arguments),this.type="circle",this.pathStr="M0.5,0A0.5,0.5,0,1,1,-0.5,0A0.5,0.5,0,1,1,0.5,0"}draw(e,t,i,r,o){return Cp(e,this.parseSize(t)/2,i,r,o)}drawOffset(e,t,i,r,o,s){return Cp(e,this.parseSize(t)/2+o,i,r,s)}drawToSvgPath(e,t,i,r){const o=this.parseSize(e)/2;return`M ${t-o}, ${i} a ${o},${o} 0 1,0 ${2*o},0 a ${o},${o} 0 1,0 -${2*o},0`}}const wR=new _R;function yR(n,e,t,i,r){return n.moveTo(-3*e+t,-e+i,r),n.lineTo(-e+t,-e+i,r),n.lineTo(-e+t,-3*e+i,r),n.lineTo(e+t,-3*e+i,r),n.lineTo(e+t,-e+i,r),n.lineTo(3*e+t,-e+i,r),n.lineTo(3*e+t,e+i,r),n.lineTo(e+t,e+i,r),n.lineTo(e+t,3*e+i,r),n.lineTo(-e+t,3*e+i,r),n.lineTo(-e+t,e+i,r),n.lineTo(-3*e+t,e+i,r),n.closePath(),!0}function vR(n,e,t,i,r,o){return n.moveTo(-3*e+t-r,-e+i-r,o),n.lineTo(-e+t-r,-e+i-r,o),n.lineTo(-e+t-r,-3*e+i-r,o),n.lineTo(e+t+r,-3*e+i-r,o),n.lineTo(e+t+r,-e+i-r,o),n.lineTo(3*e+t+r,-e+i-r,o),n.lineTo(3*e+t+r,e+i+r,o),n.lineTo(e+t+r,e+i+r,o),n.lineTo(e+t+r,3*e+i+r,o),n.lineTo(-e+t-r,3*e+i+r,o),n.lineTo(-e+t-r,e+i+r,o),n.lineTo(-3*e+t-r,e+i+r,o),n.closePath(),!0}class SR extends dt{constructor(){super(...arguments),this.type="cross",this.pathStr="M-0.5,-0.2L-0.5,0.2L-0.2,0.2L-0.2,0.5L0.2,0.5L0.2,0.2L0.5,0.2L0.5,-0.2L0.2,-0.2L0.2,-0.5L-0.2,-0.5L-0.2,-0.2Z"}draw(e,t,i,r,o){return yR(e,this.parseSize(t)/6,i,r,o)}drawOffset(e,t,i,r,o,s){return vR(e,this.parseSize(t)/6,i,r,o,s)}}const xR=new SR;function Nu(n,e,t,i,r){return n.moveTo(t,i-e,r),n.lineTo(e+t,i,r),n.lineTo(t,i+e,r),n.lineTo(t-e,i,r),n.closePath(),!0}class RR extends dt{constructor(){super(...arguments),this.type="diamond",this.pathStr="M-0.5,0L0,-0.5L0.5,0L0,0.5Z"}draw(e,t,i,r,o){return Nu(e,this.parseSize(t)/2,i,r,o)}drawFitDir(e,t,i,r,o){return Nu(e,this.parseSize(t)/2,i,r,o)}drawOffset(e,t,i,r,o,s){return Nu(e,this.parseSize(t)/2+o,i,r,s)}}const AR=new RR;function _p(n,e,t,i){const r=2*e;return n.rect(t-e,i-e,r,r),!1}class BR extends dt{constructor(){super(...arguments),this.type="square",this.pathStr="M-0.5,-0.5h1v1h-1Z"}draw(e,t,i,r){return _p(e,this.parseSize(t)/2,i,r)}drawOffset(e,t,i,r,o){return _p(e,this.parseSize(t)/2+o,i,r)}}const MR=new BR;function wp(n,e,t,i,r=0){return n.moveTo(t+e+2*r,e+i+r),n.lineTo(t-e-2*r,e+i+r),n.lineTo(t,i-e-2*r),n.closePath(),!0}class N0 extends dt{constructor(){super(...arguments),this.type="triangleUp",this.pathStr="M0.5,0.5 L-0.5,0.5 L0,-0.5 Z"}draw(e,t,i,r){return wp(e,this.parseSize(t)/2,i,r)}drawOffset(e,t,i,r,o){return wp(e,this.parseSize(t)/2,i,r,o)}}const TR=new N0;class PR extends N0{constructor(){super(...arguments),this.type="triangle"}}const HR=new PR,V0=Math.sin(Math.PI/10)/Math.sin(7*Math.PI/10),kR=Math.sin(dn/10)*V0,ER=-Math.cos(dn/10)*V0;function yp(n,e,t,i){const r=kR*e,o=ER*e;n.moveTo(t,-e+i),n.lineTo(r+t,o+i);for(let s=1;s<5;++s){const l=dn*s/5,a=Math.cos(l),d=Math.sin(l);n.lineTo(d*e+t,-a*e+i),n.lineTo(a*r-d*o+t,d*r+a*o+i)}return n.closePath(),!0}class LR extends dt{constructor(){super(...arguments),this.type="star",this.pathStr="M0 -1L0.22451398828979266 -0.3090169943749474L0.9510565162951535 -0.30901699437494745L0.3632712640026804 0.1180339887498948L0.5877852522924732 0.8090169943749473L8.326672684688674e-17 0.3819660112501051L-0.587785252292473 0.8090169943749476L-0.3632712640026804 0.11803398874989487L-0.9510565162951536 -0.30901699437494723L-0.22451398828979274 -0.30901699437494734Z"}draw(e,t,i,r){return yp(e,this.parseSize(t)/2,i,r)}drawOffset(e,t,i,r,o){return yp(e,this.parseSize(t)/2+o,i,r)}}const FR=new LR,zR=Xi(3);function vp(n,e,t,i){const r=e,o=r/zR,s=o/5,l=e;return n.moveTo(0+t,-r+i),n.lineTo(o/2+t,i),n.lineTo(s/2+t,i),n.lineTo(s/2+t,l+i),n.lineTo(-s/2+t,l+i),n.lineTo(-s/2+t,i),n.lineTo(-o/2+t,i),n.closePath(),!0}class IR extends dt{constructor(){super(...arguments),this.type="arrow",this.pathStr="M-0.07142857142857142,0.5L0.07142857142857142,0.5L0.07142857142857142,-0.0625L0.2,-0.0625L0,-0.5L-0.2,-0.0625L-0.07142857142857142,-0.0625Z"}draw(e,t,i,r){return vp(e,this.parseSize(t)/2,i,r)}drawOffset(e,t,i,r,o){return vp(e,this.parseSize(t)/2+o,i,r)}}const OR=new IR;function Sp(n,e,t,i){const r=2*e;return n.moveTo(t,-e+i),n.lineTo(r/3/2+t,e+i),n.lineTo(-r/3/2+t,e+i),n.closePath(),!0}class DR extends dt{constructor(){super(...arguments),this.type="wedge",this.pathStr="M0,-0.5773502691896257L-0.125,0.28867513459481287L0.125,0.28867513459481287Z"}draw(e,t,i,r){return Sp(e,this.parseSize(t)/2,i,r)}drawOffset(e,t,i,r,o){return Sp(e,this.parseSize(t)/2+o,i,r)}}const WR=new DR;function xp(n,e,t,i){return n.moveTo(-e+t,i),n.lineTo(t,e+i),!1}class NR extends dt{constructor(){super(...arguments),this.type="stroke",this.pathStr=""}draw(e,t,i,r){return xp(e,this.parseSize(t)/2,i,r)}drawOffset(e,t,i,r,o){return xp(e,this.parseSize(t)/2+o,i,r)}}const VR=new NR,bn=-.5,Cn=Xi(3)/2,Rp=1/Xi(12);function Ap(n,e,t,i){const r=e/2,o=e*Rp,s=r,l=e*Rp+e,a=-s,d=l;return n.moveTo(r+t,o+i),n.lineTo(s+t,l+i),n.lineTo(a+t,d+i),n.lineTo(bn*r-Cn*o+t,Cn*r+bn*o+i),n.lineTo(bn*s-Cn*l+t,Cn*s+bn*l+i),n.lineTo(bn*a-Cn*d+t,Cn*a+bn*d+i),n.lineTo(bn*r+Cn*o+t,bn*o-Cn*r+i),n.lineTo(bn*s+Cn*l+t,bn*l-Cn*s+i),n.lineTo(bn*a+Cn*d+t,bn*d-Cn*a+i),n.closePath(),!1}class GR extends dt{constructor(){super(...arguments),this.type="wye",this.pathStr="M0.25 0.14433756729740646L0.25 0.6443375672974064L-0.25 0.6443375672974064L-0.25 0.14433756729740643L-0.6830127018922193 -0.10566243270259357L-0.4330127018922193 -0.5386751345948129L0 -0.28867513459481287L0.4330127018922193 -0.5386751345948129L0.6830127018922193 -0.10566243270259357Z"}draw(e,t,i,r){return Ap(e,this.parseSize(t)/2,i,r)}drawOffset(e,t,i,r,o){return Ap(e,this.parseSize(t)/2+o,i,r)}}const jR=new GR;function Bp(n,e,t,i,r){return n.moveTo(-e+t-2*r,i),n.lineTo(e+t+r,e+i+2*r),n.lineTo(e+t+r,i-e-2*r),n.closePath(),!0}class UR extends dt{constructor(){super(...arguments),this.type="triangleLeft",this.pathStr="M-0.5,0 L0.5,0.5 L0.5,-0.5 Z"}draw(e,t,i,r){return Bp(e,this.parseSize(t)/2,i,r,0)}drawOffset(e,t,i,r,o){return Bp(e,this.parseSize(t)/2,i,r,o)}}const $R=new UR;function Mp(n,e,t,i,r=0){return n.moveTo(t-e-r,e+i+2*r),n.lineTo(e+t+2*r,i),n.lineTo(t-e-r,i-e-2*r),n.closePath(),!0}class KR extends dt{constructor(){super(...arguments),this.type="triangleRight",this.pathStr="M-0.5,0.5 L0.5,0 L-0.5,-0.5 Z"}draw(e,t,i,r){return Mp(e,this.parseSize(t)/2,i,r)}drawOffset(e,t,i,r,o){return Mp(e,this.parseSize(t)/2,i,r,o)}}const YR=new KR;function Tp(n,e,t,i,r=0){return n.moveTo(t-e-2*r,i-e-r),n.lineTo(t+e+2*r,i-e-r),n.lineTo(t,i+e+2*r),n.closePath(),!0}class XR extends dt{constructor(){super(...arguments),this.type="triangleDown",this.pathStr="M-0.5,-0.5 L0.5,-0.5 L0,0.5 Z"}draw(e,t,i,r){return Tp(e,this.parseSize(t)/2,i,r)}drawOffset(e,t,i,r,o){return Tp(e,this.parseSize(t)/2,i,r,o)}}const qR=new XR,nc=Xi(3);function Pp(n,e,t,i){const r=e*nc;return n.moveTo(t,i+-r/3*2),n.lineTo(e+t,i+r),n.lineTo(t-e,i+r),n.closePath(),!0}class ZR extends dt{constructor(){super(...arguments),this.type="thinTriangle",this.pathStr="M0,-0.5773502691896257L-0.5,0.28867513459481287L0.5,0.28867513459481287Z"}draw(e,t,i,r){return Pp(e,this.parseSize(t)/2/nc,i,r)}drawOffset(e,t,i,r,o){return Pp(e,this.parseSize(t)/2/nc+o,i,r)}}const JR=new ZR;function Hp(n,e,t,i){const r=2*e;return n.moveTo(e+t,i-r),n.lineTo(t-e,i),n.lineTo(e+t,r+i),!0}class QR extends dt{constructor(){super(...arguments),this.type="arrow2Left",this.pathStr="M 0.25 -0.5 L -0.25 0 l 0.25 0.5"}draw(e,t,i,r){return Hp(e,this.parseSize(t)/4,i,r)}drawOffset(e,t,i,r,o){return Hp(e,this.parseSize(t)/4+o,i,r)}}const eA=new QR;function kp(n,e,t,i){const r=2*e;return n.moveTo(t-e,i-r),n.lineTo(t+e,i),n.lineTo(t-e,r+i),!0}class tA extends dt{constructor(){super(...arguments),this.type="arrow2Right",this.pathStr="M -0.25 -0.5 l 0.25 0 l -0.25 0.5"}draw(e,t,i,r){return kp(e,this.parseSize(t)/4,i,r)}drawOffset(e,t,i,r,o){return kp(e,this.parseSize(t)/4+o,i,r)}}const nA=new tA;function Ep(n,e,t,i){const r=2*e;return n.moveTo(t-r,i+e),n.lineTo(t,i-e),n.lineTo(t+r,i+e),!0}class iA extends dt{constructor(){super(...arguments),this.type="arrow2Up",this.pathStr="M -0.5 0.25 L 0 -0.25 l 0.5 0.25"}draw(e,t,i,r){return Ep(e,this.parseSize(t)/4,i,r)}drawOffset(e,t,i,r,o){return Ep(e,this.parseSize(t)/4+o,i,r)}}const rA=new iA;function Lp(n,e,t,i){const r=2*e;return n.moveTo(t-r,i-e),n.lineTo(t,i+e),n.lineTo(t+r,i-e),!0}class oA extends dt{constructor(){super(...arguments),this.type="arrow2Down",this.pathStr="M -0.5 -0.25 L 0 0.25 l 0.5 -0.25"}draw(e,t,i,r){return Lp(e,this.parseSize(t)/4,i,r)}drawOffset(e,t,i,r,o){return Lp(e,this.parseSize(t)/4+o,i,r)}}const sA=new oA;function Fp(n,e,t,i,r){return n.moveTo(t,i-e),n.lineTo(t,i+e),!0}class lA extends dt{constructor(){super(...arguments),this.type="lineV",this.pathStr="M0,-0.5L0,0.5"}draw(e,t,i,r,o){return Fp(e,this.parseSize(t)/2,i,r)}drawOffset(e,t,i,r,o,s){return Fp(e,this.parseSize(t)/2+o,i,r)}drawToSvgPath(e,t,i,r){const o=this.parseSize(e)/2;return`M ${t}, ${i-o} L ${t},${i+o}`}}const aA=new lA;function zp(n,e,t,i,r){return n.moveTo(t-e,i),n.lineTo(t+e,i),!0}class dA extends dt{constructor(){super(...arguments),this.type="lineH",this.pathStr="M-0.5,0L0.5,0"}draw(e,t,i,r,o){return zp(e,this.parseSize(t)/2,i,r)}drawOffset(e,t,i,r,o,s){return zp(e,this.parseSize(t)/2+o,i,r)}drawToSvgPath(e,t,i,r){const o=this.parseSize(e)/2;return`M ${t-o}, ${i} L ${t+o},${i}`}}const uA=new dA;function Ip(n,e,t,i,r){return n.moveTo(t-e,i-e),n.lineTo(t+e,i+e),n.moveTo(t+e,i-e),n.lineTo(t-e,i+e),!0}class hA extends dt{constructor(){super(...arguments),this.type="close",this.pathStr="M-0.5,-0.5L0.5,0.5,M0.5,-0.5L-0.5,0.5"}draw(e,t,i,r,o){return Ip(e,this.parseSize(t)/2,i,r)}drawOffset(e,t,i,r,o,s){return Ip(e,this.parseSize(t)/2+o,i,r)}drawToSvgPath(e,t,i,r){const o=this.parseSize(e)/2;return`M ${t-o}, ${i-o} L ${t+o},${i+o} M ${t+o}, ${i-o} L ${t-o},${i+o}`}}const cA=new hA;function Op(n,e,t,i){return n.rect(t-e[0]/2,i-e[1]/2,e[0],e[1]),!1}function Dp(n,e,t,i){const r=e,o=e/2;return n.rect(t-r/2,i-o/2,r,o),!1}class fA extends dt{constructor(){super(...arguments),this.type="rect",this.pathStr="M -0.5,0.25 L 0.5,0.25 L 0.5,-0.25,L -0.5,-0.25 Z"}draw(e,t,i,r){return J(t)?Dp(e,t,i,r):Op(e,t,i,r)}drawOffset(e,t,i,r,o){return J(t)?Dp(e,t+2*o,i,r):Op(e,[t[0]+2*o,t[1]+2*o],i,r)}}const gA=new fA,Zo=new Ue;class Wp{constructor(e,t,i=!1){this.pathStr="",this.type=e,ee(t)?this.svgCache=t:this.path=t,this.isSvg=i}drawOffset(e,t,i,r,o,s,l){return t=this.parseSize(t),this.isSvg?!!this.svgCache&&(this.svgCache.forEach(a=>{e.beginPath(),Qi(a.path.commandList,e,i,r,t,t),l&&l(a.path,a.attribute)}),!1):(Qi(this.path.commandList,e,i,r,t+o,t+o),!1)}draw(e,t,i,r,o,s){return t=this.parseSize(t),this.drawOffset(e,t,i,r,0,o,s)}parseSize(e){return J(e)?e:Math.min(e[0],e[1])}bounds(e,t){if(e=this.parseSize(e),this.isSvg)return this.svgCache?(t.clear(),void this.svgCache.forEach(({path:i})=>{Zo.x1=i.bounds.x1*e,Zo.y1=i.bounds.y1*e,Zo.x2=i.bounds.x2*e,Zo.y2=i.bounds.y2*e,t.union(Zo)})):void 0;this.path.bounds&&(t.x1=this.path.bounds.x1*e,t.y1=this.path.bounds.y1*e,t.x2=this.path.bounds.x2*e,t.y2=this.path.bounds.y2*e)}}const pA=[wR,xR,AR,MR,JR,HR,FR,OR,WR,VR,jR,$R,YR,TR,qR,eA,nA,rA,sA,gA,aA,uA,cA],G0={};pA.forEach(n=>{G0[n.type]=n});const mA={arrowLeft:"M 0.25 -0.5 L -0.25 0 l 0.5 0.5",arrowRight:"M -0.25 -0.5 l 0.5 0.5 l -0.5 0.5",rectRound:"M 0.3 -0.5 C 0.41 -0.5 0.5 -0.41 0.5 -0.3 C 0.5 -0.3 0.5 0.3 0.5 0.3 C 0.5 0.41 0.41 0.5 0.3 0.5 C 0.3 0.5 -0.3 0.5 -0.3 0.5 C -0.41 0.5 -0.5 0.41 -0.5 0.3 C -0.5 0.3 -0.5 -0.3 -0.5 -0.3 C -0.5 -0.41 -0.41 -0.5 -0.3 -0.5 C -0.3 -0.5 0.3 -0.5 0.3 -0.5 Z",roundLine:"M 1.2392 -0.258 L -1.3432 -0.258 C -1.4784 -0.258 -1.588 -0.1436 -1.588 -0.002 c 0 0.1416 0.1096 0.256 0.2448 0.256 l 2.5824 0 c 0.1352 0 0.2448 -0.1144 0.2448 -0.256 C 1.484 -0.1436 1.3744 -0.258 1.2392 -0.258 z"},bA=(n,e,t)=>{const{outerBorder:i,shadowBlur:r=e.shadowBlur,strokeBoundsBuffer:o=e.strokeBoundsBuffer}=n;if(i){const s=e.outerBorder,{distance:l=s.distance,lineWidth:a=s.lineWidth}=i;ga(t,l+(r+a)/2,!0,o)}return t},Hl=new Ue,Np=["symbolType","size",...Pn];let ic=class Zr extends en{constructor(e={symbolType:"circle"}){super(e),this.type="symbol",this.numberType=iu}getParsedPath(){return this.shouldUpdateShape()&&(this.doUpdateParsedPath(),this.clearUpdateShapeTag()),this._parsedPath}isValid(){return super.isValid()&&this._isValid()}_isValid(){const{size:e}=this.attribute;return ee(e)?e.length===2&&e.every(this._validNumber):this._validNumber(e)}doUpdateParsedPath(){const e=this.getGraphicTheme();let{symbolType:t=e.symbolType}=this.attribute,i=G0[t];if(i)return this._parsedPath=i,i;if(i=Zr.userSymbolMap[t],i)return this._parsedPath=i,i;if(t=mA[t]||t,TS(t)===!0){const a=new Zd,{svg:d}=a.parse(t);if(!d)return null;const u=ee(d.path)?d.path:[d.path];Hl.clear();const h=[];u.forEach(p=>{const m=new Bt().fromString(p.d),b={};IS.forEach(C=>{p[C]&&(b[x0[C]]=p[C])}),h.push({path:m,attribute:b}),Hl.union(m.bounds)});const c=Hl.width(),g=Hl.height(),f=1/Ji(c,g);return h.forEach(p=>p.path.transform(0,0,f,f)),this._parsedPath=new Wp(t,h,!0),Zr.userSymbolMap[t]=this._parsedPath,this._parsedPath}const r=new Bt().fromString(t),o=r.bounds.width(),s=r.bounds.height(),l=1/Ji(o,s);return r.transform(0,0,l,l),this._parsedPath=new Wp(t,r),Zr.userSymbolMap[t]=this._parsedPath,this._parsedPath}getGraphicTheme(){return ve(this).symbol}updateAABBBounds(e,t,i,r){this.updatePathProxyAABBBounds(i)||(r?this.updateSymbolAABBBoundsImprecise(e,t,i):this.updateSymbolAABBBoundsAccurate(e,t,i));const{tb1:o,tb2:s}=U.graphicService.updateTempAABBBounds(i);bA(e,t,o),i.union(o),o.setValue(s.x1,s.y1,s.x2,s.y2);const{lineJoin:l=t.lineJoin}=e;return U.graphicService.transformAABBBounds(e,i,t,l==="miter",this),i}updateSymbolAABBBoundsImprecise(e,t,i){const{size:r=t.size}=e;if(ee(r))i.set(-r[0]/2,-r[1]/2,r[0]/2,r[1]/2);else{const o=r/2;i.set(-o,-o,o,o)}return i}updateSymbolAABBBoundsAccurate(e,t,i){const{size:r=t.size}=e;return this.getParsedPath().bounds(r,i),i}needUpdateTags(e){return super.needUpdateTags(e,Np)}needUpdateTag(e){return super.needUpdateTag(e,Np)}toCustomPath(){const e=this.getParsedPath(),t=this.attribute.size,i=ee(t)?t:[t,t];return e.path?new Bt().fromCustomPath2D(e.path,0,0,i[0],i[1]):new Bt().fromString(e.pathStr,0,0,i[0],i[1])}clone(){return new Zr(Object.assign({},this.attribute))}getNoWorkAnimateAttr(){return Zr.NOWORK_ANIMATE_ATTR}};ic.userSymbolMap={},ic.NOWORK_ANIMATE_ATTR=Object.assign({symbolType:1},Gn);function zs(n){return new ic(n)}const Vp=["segments","points","curveType","curveTension",...Pn];let j0=class rc extends en{constructor(e={}){super(e),this.type="line",this.numberType=il}isValid(){return super.isValid()&&this._isValid()}_isValid(){if(this.pathProxy)return!0;const{points:e,segments:t}=this.attribute;return t?t.length!==0:!!e&&!(e.length<=1)}_interpolate(e,t,i,r,o){e==="points"&&(o.points=b0(i,r,t))}getGraphicTheme(){return ve(this).line}updateAABBBounds(e,t,i){this.updatePathProxyAABBBounds(i)||(e.segments?this.updateLineAABBBoundsBySegments(e,t,i):this.updateLineAABBBoundsByPoints(e,t,i)),U.graphicService.updateTempAABBBounds(i);const{lineJoin:r=t.lineJoin}=e;return U.graphicService.transformAABBBounds(e,i,t,r==="miter",this),i}updateLineAABBBoundsByPoints(e,t,i,r){const{points:o=t.points,connectedType:s}=e,l=i;return o.forEach(a=>{a.defined===!1&&s!=="zero"&&s!=="connect"||l.add(a.x,a.y)}),l}updateLineAABBBoundsBySegments(e,t,i,r){const{segments:o=t.segments,connectedType:s}=e,l=i;return o.forEach(a=>{a.points.forEach(d=>{d.defined===!1&&s!=="zero"&&s!=="connect"||l.add(d.x,d.y)})}),l}needUpdateTags(e){return super.needUpdateTags(e,Vp)}needUpdateTag(e){return super.needUpdateTag(e,Vp)}toCustomPath(){const e=this.attribute,t=new Bt,i=e.segments,r=o=>{if(o&&o.length){let s=!0;o.forEach(l=>{l.defined!==!1&&(s?t.moveTo(l.x,l.y):t.lineTo(l.x,l.y),s=!1)})}};return i&&i.length?i.forEach(o=>{r(o.points)}):e.points&&r(e.points),t}clone(){return new rc(Object.assign({},this.attribute))}getNoWorkAnimateAttr(){return rc.NOWORK_ANIMATE_ATTR}};j0.NOWORK_ANIMATE_ATTR=Object.assign({segments:1,curveType:1},Gn);function un(n){return new j0(n)}const Gp=["width","x1","y1","height","cornerRadius",...Pn];let lu=class oc extends en{constructor(e){super(e),this.type="rect",this.numberType=Pf}isValid(){return super.isValid()&&this._isValid()}_isValid(){return!0}getGraphicTheme(){return ve(this).rect}updateAABBBounds(e,t,i){if(!this.updatePathProxyAABBBounds(i)){let{width:s,height:l}=e;const{x1:a,y1:d,x:u,y:h}=e;s=s??a-u,l=l??d-h,(isFinite(s)||isFinite(l)||isFinite(u)||isFinite(h))&&i.set(0,0,s||0,l||0)}const{tb1:r,tb2:o}=U.graphicService.updateTempAABBBounds(i);return sl(e,t,r),i.union(r),r.setValue(o.x1,o.y1,o.x2,o.y2),U.graphicService.transformAABBBounds(e,i,t,!1,this),i}needUpdateTags(e){return super.needUpdateTags(e,Gp)}needUpdateTag(e){return super.needUpdateTag(e,Gp)}toCustomPath(){const e=this.attribute,{x:t,y:i,width:r,height:o}=gS(e),s=new Bt;return s.moveTo(t,i),s.rect(t,i,r,o),s}clone(){return new oc(Object.assign({},this.attribute))}getNoWorkAnimateAttr(){return oc.NOWORK_ANIMATE_ATTR}};lu.NOWORK_ANIMATE_ATTR=Gn;function Ze(n){return new lu(n)}class CA{constructor(e,t,i,r,o,s,l,a,d,u,h,c,g,f){this.left=e,this.top=t,this.width=i,this.height=r,this.actualHeight=0,this.bottom=t+r,this.right=e+i,this.ellipsis=o,this.wordBreak=s,this.verticalDirection=l,this.lines=[],this.globalAlign=a,this.globalBaseline=d,this.layoutDirection=u,this.directionKey=xf[this.layoutDirection],this.isWidthMax=h,this.isHeightMax=c,this.singleLine=g,f?(f.clear(),this.icons=f):this.icons=new Map}draw(e,t){const{width:i,height:r}=this.getActualSize(),o=this.isWidthMax?Math.min(this.width,i):this.width||i||0;let s=this.isHeightMax?Math.min(this.height,r):this.height||r||0;s=Math.min(s,r);let l=0;switch(this.globalBaseline){case"top":l=0;break;case"middle":l=-s/2;break;case"bottom":l=-s}let a=0;this.globalAlign==="right"||this.globalAlign==="end"?a=-o:this.globalAlign==="center"&&(a=-o/2);let d=this[this.directionKey.height];this.singleLine&&(d=this.lines[0].height+1);let u=!1;if(this.verticalDirection==="middle")if(this.actualHeight>=d&&d!==0)for(let h=0;h<this.lines.length;h++){const{top:c,height:g}=this.lines[h];if(c+g<this[this.directionKey.top]||c+g>this[this.directionKey.top]+d)return u;let f=!1;this.ellipsis&&this.lines[h+1]&&this.lines[h+1].top+this.lines[h+1].height>this[this.directionKey.top]+d&&(f=!0,u=!0),this.lines[h].draw(e,f,this.lines[h][this.directionKey.left]+a,this.lines[h][this.directionKey.top]+l,this.ellipsis,t)}else{const h=Math.floor((d-this.actualHeight)/2);this.layoutDirection==="vertical"?a+=h:l+=h;for(let c=0;c<this.lines.length;c++)this.lines[c].draw(e,!1,this.lines[c][this.directionKey.left]+a,this.lines[c][this.directionKey.top]+l,this.ellipsis,t)}else if(this.verticalDirection==="bottom"&&this.layoutDirection!=="vertical")for(let h=0;h<this.lines.length;h++){const{top:c,height:g}=this.lines[h],f=d-this.lines[h].top-this.lines[h].height;if(d===0)this.lines[h].draw(e,!1,a,f+l,this.ellipsis,t);else{if(f+g>this[this.directionKey.top]+d||f<this[this.directionKey.top])return u;{let p=!1;this.ellipsis&&this.lines[h+1]&&f-this.lines[h+1].height<this[this.directionKey.top]&&(p=!0,u=!0),this.lines[h].draw(e,p,a,f+l,this.ellipsis,t)}}}else{this.verticalDirection==="bottom"&&this.layoutDirection==="vertical"&&this.singleLine&&this.isWidthMax&&(a+=this.lines[0].height+1);for(let h=0;h<this.lines.length;h++){this.verticalDirection==="bottom"&&this.layoutDirection==="vertical"&&(a-=this.lines[h].height+this.lines[h].top);const{top:c,height:g}=this.lines[h];if(d===0)this.lines[h].draw(e,!1,this.lines[h][this.directionKey.left]+a,this.lines[h][this.directionKey.top]+l,this.ellipsis,t);else{if(c+g<this[this.directionKey.top]||c+g>this[this.directionKey.top]+d)return u;{let f=!1;this.ellipsis&&this.lines[h+1]&&this.lines[h+1].top+this.lines[h+1].height>this[this.directionKey.top]+d&&(f=!0,u=!0),this.lines[h].draw(e,f,this.lines[h][this.directionKey.left]+a,this.lines[h][this.directionKey.top]+l,this.ellipsis,t)}}}}return u}getActualSize(){return this.ellipsis?this.getActualSizeWidthEllipsis():this.getRawActualSize()}getRawActualSize(){let e=0,t=0;for(let i=0;i<this.lines.length;i++){const r=this.lines[i];r.actualWidth>e&&(e=r.actualWidth),t+=r.height}return{width:this.layoutDirection==="vertical"?t:e,height:this.layoutDirection==="vertical"?e:t}}getActualSizeWidthEllipsis(){let e=0,t=0;const{width:i,height:r}=this.getRawActualSize();this.width,this.height;let o=this[this.directionKey.height];if(this.singleLine&&(o=this.lines[0].height+1),this.verticalDirection==="middle")if(this.actualHeight>=o&&o!==0)for(let s=0;s<this.lines.length;s++){const{top:l,height:a}=this.lines[s];if(!(l+a<this[this.directionKey.top]||l+a>this[this.directionKey.top]+o))if(this.ellipsis&&this.lines[s+1]&&this.lines[s+1].top+this.lines[s+1].height>this[this.directionKey.top]+o){const d=this.ellipsis===!0?"...":this.ellipsis||"",u=this.lines[s].getWidthWithEllips(d);u>e&&(e=u),t+=this.lines[s].height}else this.lines[s].actualWidth>e&&(e=this.lines[s].actualWidth),t+=this.lines[s].height}else{Math.floor((o-this.actualHeight)/2);for(let s=0;s<this.lines.length;s++)this.lines[s].actualWidth>e&&(e=this.lines[s].actualWidth),t+=this.lines[s].height}else if(this.verticalDirection==="bottom")for(let s=0;s<this.lines.length;s++){const{top:l,height:a}=this.lines[s],d=o-this.lines[s].top-this.lines[s].height;if(o===0)this.lines[s].actualWidth>e&&(e=this.lines[s].actualWidth),t+=this.lines[s].height;else if(!(d+a>this[this.directionKey.top]+o||d<this[this.directionKey.top]))if(this.ellipsis&&this.lines[s+1]&&d-this.lines[s+1].height<this[this.directionKey.top]){const u=this.ellipsis===!0?"...":this.ellipsis||"",h=this.lines[s].getWidthWithEllips(u);h>e&&(e=h),t+=this.lines[s].height}else this.lines[s].actualWidth>e&&(e=this.lines[s].actualWidth),t+=this.lines[s].height}else for(let s=0;s<this.lines.length;s++){const{top:l,height:a}=this.lines[s];if(o===0)this.lines[s].actualWidth>e&&(e=this.lines[s].actualWidth),t+=this.lines[s].height;else if(!(l+a<this[this.directionKey.top]||l+a>this[this.directionKey.top]+o))if(this.ellipsis&&this.lines[s+1]&&this.lines[s+1].top+this.lines[s+1].height>this[this.directionKey.top]+o){const d=this.ellipsis===!0?"...":this.ellipsis||"",u=this.lines[s].getWidthWithEllips(d);u>e&&(e=u),t+=this.lines[s].height}else this.lines[s].actualWidth>e&&(e=this.lines[s].actualWidth),t+=this.lines[s].height}return{width:this.layoutDirection==="vertical"?t:e,height:this.layoutDirection==="vertical"?e:t}}}class Is{constructor(e,t,i){this.fontSize=i.fontSize||16,this.textBaseline=i.textBaseline||"alphabetic";const r=nl(i.lineHeight,this.fontSize);this.lineHeight=typeof r=="number"?r>this.fontSize?r:this.fontSize:Math.floor(1.2*this.fontSize),this.height=this.lineHeight;const{ascent:o,height:s,descent:l,width:a}=no(e,i);let d=0,u=0,h=0;this.height>s&&(d=(this.height-s)/2,u=Math.ceil(d),h=Math.floor(d)),this.textBaseline==="top"?(this.ascent=d,this.descent=s-d):this.textBaseline==="bottom"?(this.ascent=s-d,this.descent=d):this.textBaseline==="middle"?(this.ascent=this.height/2,this.descent=this.height/2):(this.ascent=o+u,this.descent=l+h),this.length=e.length,this.width=a||0,this.text=e||"",this.newLine=t||!1,this.character=i,this.left=0,this.top=0,this.ellipsis="normal",this.ellipsisWidth=0,this.ellipsisOtherParagraphWidth=0,i.direction==="vertical"&&(this.direction=i.direction,this.widthOrigin=this.width,this.heightOrigin=this.height,this.width=this.heightOrigin,this.height=this.widthOrigin,this.lineHeight=this.height),this.ellipsisStr="..."}updateWidth(){const{width:e}=no(this.text,this.character);this.width=e,this.direction==="vertical"&&(this.widthOrigin=this.width,this.width=this.heightOrigin,this.height=this.widthOrigin)}draw(e,t,i,r,o){let s=this.text,l=this.left+i;t+=this.top;let a=this.direction;if(this.verticalEllipsis)s=this.ellipsisStr,a="vertical",t-=this.ellipsisWidth/2;else{if(this.ellipsis==="hide")return;if(this.ellipsis==="add")s+=this.ellipsisStr,o!=="right"&&o!=="end"||(l-=this.ellipsisWidth);else if(this.ellipsis==="replace"){const u=Th(s,(a==="vertical"?this.height:this.width)-this.ellipsisWidth+this.ellipsisOtherParagraphWidth,this.character,s.length-1);if(s=s.slice(0,u),s+=this.ellipsisStr,o==="right"||o==="end"){const{width:h}=no(this.text.slice(u),this.character);a==="vertical"||(l-=this.ellipsisWidth-h)}}}switch(this.character.script){case"super":t-=this.ascent*(1/3);break;case"sub":t+=this.descent/2}a==="vertical"&&(e.save(),e.rotateAbout(Math.PI/2,l,t),e.translate(-this.heightOrigin||-this.lineHeight/2,-this.descent/2),e.translate(l,t),l=0,t=0);const{lineWidth:d=1}=this.character;this.character.stroke&&d&&e.strokeText(s,l,t),this.character.fill&&e.fillText(s,l,t),this.character.fill&&(typeof this.character.lineThrough=="boolean"||typeof this.character.underline=="boolean"?(this.character.underline&&e.fillRect(l,1+t,this.widthOrigin||this.width,this.character.fontSize?Math.max(1,Math.floor(this.character.fontSize/10)):1),this.character.lineThrough&&e.fillRect(l,1+t-this.ascent/2,this.widthOrigin||this.width,this.character.fontSize?Math.max(1,Math.floor(this.character.fontSize/10)):1)):this.character.textDecoration==="underline"?e.fillRect(l,1+t,this.widthOrigin||this.width,this.character.fontSize?Math.max(1,Math.floor(this.character.fontSize/10)):1):this.character.textDecoration==="line-through"&&e.fillRect(l,1+t-this.ascent/2,this.widthOrigin||this.width,this.character.fontSize?Math.max(1,Math.floor(this.character.fontSize/10)):1)),a==="vertical"&&e.restore()}getWidthWithEllips(e){let t=this.text;const i=e==="vertical"?this.height:this.width;if(this.ellipsis==="hide")return i;if(this.ellipsis==="add")return i+this.ellipsisWidth;if(this.ellipsis==="replace"){const r=Th(t,i-this.ellipsisWidth+this.ellipsisOtherParagraphWidth,this.character,t.length-1);t=t.slice(0,r),t+=this.ellipsisStr;const{width:o}=no(this.text.slice(r),this.character);return i+this.ellipsisWidth-o}return i}}function _A(n,e){const t=n.text.slice(0,e),i=n.text.slice(e);return[new Is(t,n.newLine,n.character),new Is(i,!0,n.character)]}const jp=["width","height","image",...Pn];let Hr=class sc extends en{constructor(e){super(e),this.type="image",this.numberType=eu,this.loadImage(this.attribute.image)}get width(){var e;return(e=this.attribute.width)!==null&&e!==void 0?e:0}set width(e){this.attribute.width===e&&(this.attribute.width=e,this.addUpdateShapeAndBoundsTag())}get height(){var e;return(e=this.attribute.height)!==null&&e!==void 0?e:0}set height(e){this.attribute.height===e&&(this.attribute.height=e,this.addUpdateShapeAndBoundsTag())}get repeatX(){var e;return(e=this.attribute.repeatX)!==null&&e!==void 0?e:"no-repeat"}set repeatX(e){this.attribute.repeatX===e&&(this.attribute.repeatX=e)}get repeatY(){var e;return(e=this.attribute.repeatY)!==null&&e!==void 0?e:"no-repeat"}set repeatY(e){this.attribute.repeatY===e&&(this.attribute.repeatY=e)}get image(){return this.attribute.image}set image(e){e!==this.attribute.image&&(this.attribute.image=e,this.loadImage(this.attribute.image))}imageLoadSuccess(e,t,i){super.imageLoadSuccess(e,t,()=>{this.successCallback&&this.successCallback()})}imageLoadFail(e,t){super.imageLoadFail(e,()=>{this.failCallback&&this.failCallback()})}setAttributes(e,t,i){return e.image&&this.loadImage(e.image),super.setAttributes(e,t,i)}setAttribute(e,t,i,r){return e==="image"&&this.loadImage(t),super.setAttribute(e,t,i,r)}getGraphicTheme(){return ve(this).image}updateAABBBounds(e,t,i){if(!this.updatePathProxyAABBBounds(i)){const{width:s=t.width,height:l=t.height}=e;i.set(0,0,s,l)}const{tb1:r,tb2:o}=U.graphicService.updateTempAABBBounds(i);return sl(e,t,r),i.union(r),r.setValue(o.x1,o.y1,o.x2,o.y2),U.graphicService.transformAABBBounds(e,i,t,!1,this),i}getDefaultAttribute(e){return Ps[e]}needUpdateTags(e){return super.needUpdateTags(e,jp)}needUpdateTag(e){return super.needUpdateTag(e,jp)}clone(){return new sc(Object.assign({},this.attribute))}getNoWorkAnimateAttr(){return sc.NOWORK_ANIMATE_ATTR}};Hr.NOWORK_ANIMATE_ATTR=Object.assign({image:1,repeatX:1,repeatY:1},Gn);function au(n){return new Hr(n)}class bi extends Hr{constructor(e){if(super(e),this._x=0,this._y=0,this._hovered=!1,this._marginArray=[0,0,0,0],e.backgroundShowMode==="always"&&(this._hovered=!0),e.margin){const t=fa(e.margin);this._marginArray=typeof t=="number"?[t,t,t,t]:t}this.onBeforeAttributeUpdate=(t,i,r)=>{if(ee(r)&&r.indexOf("margin")!==-1||r==="margin")if(i.margin){const o=fa(i.margin);this._marginArray=typeof o=="number"?[o,o,o,o]:o}else this._marginArray=[0,0,0,0]}}get width(){var e;return((e=this.attribute.width)!==null&&e!==void 0?e:0)+this._marginArray[1]+this._marginArray[3]}get height(){var e;return((e=this.attribute.height)!==null&&e!==void 0?e:0)+this._marginArray[0]+this._marginArray[2]}tryUpdateAABBBounds(){if(!this.shouldUpdateAABBBounds())return this._AABBBounds;this.doUpdateAABBBounds();const{width:e=Ps.width,height:t=Ps.height}=this.attribute,{backgroundWidth:i=e,backgroundHeight:r=t}=this.attribute,o=(i-e)/2,s=(r-t)/2;return this._AABBBounds.expand([0,2*o,2*s,0]),this._AABBBounds}setHoverState(e){this.attribute.backgroundShowMode==="hover"&&this._hovered!==e&&(this._hovered=e)}}class wA{constructor(e,t,i,r,o,s,l,a){this.left=e,this.width=t,this.baseline=i,this.ascent=r,this.descent=o,this.top=i-r,this.paragraphs=s.map(u=>u),this.textAlign=(this.paragraphs[0]instanceof bi?this.paragraphs[0].attribute.textAlign:this.paragraphs[0].character.textAlign)||"left",this.direction=l,this.directionKey=xf[this.direction],this.actualWidth=0;let d=0;this.paragraphs.forEach((u,h)=>{if(h===0&&u instanceof Is){const c=K1.exec(u.text);(c==null?void 0:c.index)!==0&&(u.text=u.text.slice(c==null?void 0:c.index),u.updateWidth())}this.actualWidth+=u[this.directionKey.width],d=Math.max(u[this.directionKey.height],d)}),this.height=d,this.blankWidth=a?0:this.width-this.actualWidth,this.calcOffset(t,a)}calcOffset(e,t){const i=this.directionKey,r=this.height;let o=this.left,s=0;this.actualWidth<e&&!t&&(this.textAlign==="right"||this.textAlign==="end"?o=e-this.actualWidth:this.textAlign==="center"?o=(e-this.actualWidth)/2:this.textAlign==="justify"&&(this.paragraphs.length<2?o=(e-this.actualWidth)/2:s=(e-this.actualWidth)/(this.paragraphs.length-1))),this.paragraphs.map(function(l){l instanceof bi?(l["_"+i.x]=o,o+=l[i.width]+s,l["_"+i.y]=l.attribute.textBaseline==="top"?0:l.attribute.textBaseline==="bottom"?r-l.height:(r-l.height)/2):(l[i.left]=o,o+=l[i.width]+s)})}draw(e,t,i,r,o,s){if(o&&(t||this.paragraphs.some(l=>l.overflow))){let l=!0,a=!1;for(let u=this.paragraphs.length-1;u>=0;u--){const h=this.paragraphs[u];if(h.overflow)l=l&&h.text==="";else if(l){a=!0;break}}let d=0;if(!a)for(let u=this.paragraphs.length-1;u>=0;u--){const h=this.paragraphs[u];if(h.overflow){if(h.text==="")break;continue}if(h instanceof bi)break;if(this.direction==="vertical"&&h.direction!=="vertical"){h.verticalEllipsis=!0;break}const c=o===!0?"...":o||"";h.ellipsisStr=c;const{width:g}=no(c,h.character),f=g||0;if(f<=this.blankWidth+d){t&&(h.ellipsis="add");break}if(f<=this.blankWidth+d+h.width){h.ellipsis="replace",h.ellipsisWidth=f,h.ellipsisOtherParagraphWidth=this.blankWidth+d;break}h.ellipsis="hide",d+=h.width}}this.paragraphs.forEach((l,a)=>{if(l instanceof bi)return l.setAttributes({x:i+l._x,y:r+l._y}),void s(l,e,i+l._x,r+l._y,this.ascent);const d={x1:this.left,y1:this.top,x2:this.left+this.actualWidth,y2:this.top+this.height};X1(e,l.character),Y1(e,l.character,d),l.draw(e,r+this.ascent,i,a===0,this.textAlign)})}getWidthWithEllips(e){let t=0;for(let r=this.paragraphs.length-1;r>=0;r--){const o=this.paragraphs[r];if(o instanceof bi)break;const{width:s}=no(e,o.character),l=s||0;if(l<=this.blankWidth+t){o.ellipsis="add",o.ellipsisWidth=l;break}if(l<=this.blankWidth+t+o.width){o.ellipsis="replace",o.ellipsisWidth=l,o.ellipsisOtherParagraphWidth=this.blankWidth+t;break}o.ellipsis="hide",t+=o.width}let i=0;return this.paragraphs.forEach((r,o)=>{i+=r instanceof bi?r.width:r.getWidthWithEllips(this.direction)}),i}}class yA{constructor(e){this.frame=e,this.width=this.frame.width,this.height=this.frame.height,this.lineWidth=0,this.y=this.frame.top,this.maxAscent=0,this.maxDescent=0,this.maxAscentForBlank=0,this.maxDescentForBlank=0,this.lineBuffer=[],this.direction=e.layoutDirection,this.directionKey=xf[this.direction]}store(e){if(e instanceof bi){this.frame.icons.set(e.richtextId,e),this.lineBuffer.push(e),this.lineWidth+=e[this.directionKey.width];let t=0,i=0;e.attribute.textBaseline==="top"?(t=0,i=e.height):e.attribute.textBaseline==="bottom"?(t=e.height,i=0):(t=e.height/2,i=e.height/2),this.maxAscent=Math.max(this.maxAscent,t),this.maxDescent=Math.max(this.maxDescent,i)}else this.lineBuffer.push(e),e.text.length!==0?(this.lineWidth+=e[this.directionKey.width],this.maxAscent=Math.max(this.maxAscent,e.ascent),this.maxDescent=Math.max(this.maxDescent,e.descent)):(this.maxAscentForBlank=Math.max(this.maxAscentForBlank,e.ascent),this.maxDescentForBlank=Math.max(this.maxDescentForBlank,e.descent))}send(){if(this.lineBuffer.length===0)return;const e=this.maxAscent===0?this.maxAscentForBlank:this.maxAscent,t=this.maxDescent===0?this.maxDescentForBlank:this.maxDescent,i=new wA(this.frame.left,this[this.directionKey.width],this.y+e,e,t,this.lineBuffer,this.direction,this.direction==="horizontal"?this.frame.isWidthMax:this.frame.isHeightMax);this.frame.lines.push(i),this.frame.actualHeight+=i.height,this.y+=i.height,this.lineBuffer.length=0,this.lineWidth=this.maxAscent=this.maxDescent=this.maxAscentForBlank=this.maxDescentForBlank=0}deal(e,t=!1){e instanceof bi?this.direction==="horizontal"&&this.width===0||this.direction==="vertical"&&this.height===0||this.lineWidth+e[this.directionKey.width]<=this[this.directionKey.width]?this.store(e):this.lineBuffer.length===0?(this.store(e),this.send()):(this.send(),this.deal(e)):typeof this.width!="number"||this.width<0||(e.newLine&&this.send(),e.text.length!==0&&(this.direction==="horizontal"&&this.width===0||this.direction==="vertical"&&this.height===0||this.lineWidth+e[this.directionKey.width]<=this[this.directionKey.width]?this.store(e):this.lineWidth===this[this.directionKey.width]?(this.send(),this.deal(e)):this.cut(e,t)))}cut(e,t){const i=this[this.directionKey.width]-this.lineWidth||0,r=Math.ceil(i/e[this.directionKey.width]*e.length)||0,o=Th(e.text,i,e.character,r,this.frame.wordBreak==="break-word");if(o!==0){const[s,l]=_A(e,o);this.store(s),t?this.send():this.deal(l)}else this.lineBuffer.length!==0&&(this.send(),this.deal(e))}}const Up=["width","height","ellipsis","wordBreak","verticalDirection","maxHeight","maxWidth","textAlign","textBaseline","textConfig","layoutDirection","fill","stroke","fontSize","fontFamily","fontStyle","fontWeight","lineWidth","opacity","fillOpacity","strokeOpacity",...Pn];class Wn extends en{constructor(e){super(e),this.type="richtext",this._currentHoverIcon=null,this.numberType=Hf,this.onBeforeAttributeUpdate=(t,i,r)=>{for(const o in t)if(o==="hoverIconId"){if(t[o]===i[o])continue;const s=this._frameCache.icons.get(t[o]);this.updateHoverIconState(s)}}}get width(){var e;return(e=this.attribute.width)!==null&&e!==void 0?e:mi.width}set width(e){this.attribute.width!==e&&(this.attribute.width=e,this.addUpdateShapeAndBoundsTag())}get height(){var e;return(e=this.attribute.height)!==null&&e!==void 0?e:mi.height}set height(e){this.attribute.height!==e&&(this.attribute.height=e,this.addUpdateShapeAndBoundsTag())}get maxWidth(){return this.attribute.maxWidth}set maxWidth(e){this.attribute.maxWidth!==e&&(this.attribute.maxWidth=e,this.addUpdateShapeAndBoundsTag())}get maxHeight(){return this.attribute.maxHeight}set maxHeight(e){this.attribute.maxHeight!==e&&(this.attribute.maxHeight=e,this.addUpdateShapeAndBoundsTag())}get ellipsis(){var e;return(e=this.attribute.ellipsis)!==null&&e!==void 0?e:mi.ellipsis}set ellipsis(e){this.attribute.ellipsis!==e&&(this.attribute.ellipsis=e,this.addUpdateShapeAndBoundsTag())}get wordBreak(){var e;return(e=this.attribute.wordBreak)!==null&&e!==void 0?e:mi.wordBreak}set wordBreak(e){this.attribute.wordBreak!==e&&(this.attribute.wordBreak=e,this.addUpdateShapeAndBoundsTag())}get verticalDirection(){var e;return(e=this.attribute.verticalDirection)!==null&&e!==void 0?e:mi.verticalDirection}set verticalDirection(e){this.attribute.verticalDirection!==e&&(this.attribute.verticalDirection=e,this.addUpdateShapeAndBoundsTag())}get textAlign(){var e;return(e=this.attribute.textAlign)!==null&&e!==void 0?e:mi.textAlign}set textAlign(e){this.attribute.textAlign!==e&&(this.attribute.textAlign=e,this.addUpdateShapeAndBoundsTag())}get textBaseline(){var e;return(e=this.attribute.textBaseline)!==null&&e!==void 0?e:mi.textBaseline}set textBaseline(e){this.attribute.textBaseline!==e&&(this.attribute.textBaseline=e,this.addUpdateShapeAndBoundsTag())}get textConfig(){var e;return(e=this.attribute.textConfig)!==null&&e!==void 0?e:mi.textConfig}set textConfig(e){this.attribute.textConfig=e,this.addUpdateShapeAndBoundsTag()}getGraphicTheme(){return ve(this).richtext}updateAABBBounds(e,t,i){const{width:r=t.width,height:o=t.height,maxWidth:s=t.maxWidth,maxHeight:l=t.maxHeight,textAlign:a=t.textAlign,textBaseline:d=t.textBaseline}=e;if(r>0&&o>0)i.set(0,0,r,o);else{const c=this.getFrameCache(),{width:g,height:f}=c.getActualSize();let p=r||g||0,m=o||f||0;m=typeof l=="number"&&m>l?l:m||0,p=typeof s=="number"&&p>s?s:p||0,i.set(0,0,p,m)}let u=0;switch(d){case"top":u=0;break;case"middle":u=-i.height()/2;break;case"bottom":u=-i.height()}let h=0;switch(a){case"left":h=0;break;case"center":h=-i.width()/2;break;case"right":h=-i.width()}return i.translate(h,u),U.graphicService.updateTempAABBBounds(i),e.forceBoundsHeight==null&&e.forceBoundsWidth==null||U.graphicService.updateHTMLTextAABBBounds(e,t,i),U.graphicService.transformAABBBounds(e,i,t,!1,this),i}needUpdateTags(e){return super.needUpdateTags(e,Up)}needUpdateTag(e){return super.needUpdateTag(e,Up)}getFrameCache(){return this.shouldUpdateShape()&&(this.doUpdateFrameCache(),this.clearUpdateShapeTag()),this._frameCache}get cliped(){const e=this.getFrameCache();if(e.actualHeight>e.height)return!0;const{disableAutoWrapLine:t}=this.attribute;if(t)for(let i=0;i<e.lines.length;i++){const r=e.lines[i];for(let o=0;o<r.paragraphs.length;o++){const s=r.paragraphs[o];if(s.overflow&&s.text!=="")return!0}}return!1}combinedStyleToCharacter(e){const{fill:t,stroke:i,fontSize:r,fontFamily:o,fontStyle:s,fontWeight:l,lineWidth:a,opacity:d,fillOpacity:u,strokeOpacity:h}=this.attribute;return Object.assign({fill:t,stroke:i,fontSize:r,fontFamily:o,fontStyle:s,fontWeight:l,lineWidth:a,opacity:d,fillOpacity:u,strokeOpacity:h},e)}doUpdateFrameCache(e){var t;const{textConfig:i=[],maxWidth:r,maxHeight:o,width:s,height:l,ellipsis:a,wordBreak:d,verticalDirection:u,textAlign:h,textBaseline:c,layoutDirection:g,singleLine:f,disableAutoWrapLine:p}=this.attribute,m=[],b=e??i;for(let S=0;S<b.length;S++)if("image"in b[S]){const R=this.combinedStyleToCharacter(b[S]);R.lineWidth=void 0;const B=R.id&&this._frameCache&&this._frameCache.icons&&this._frameCache.icons.get(R.id);if(B)m.push(B);else{const A=new bi(R);A.successCallback=()=>{var M;this.addUpdateBoundTag(),(M=this.stage)===null||M===void 0||M.renderNextFrame()},A.richtextId=R.id,m.push(A)}}else{const R=this.combinedStyleToCharacter(b[S]);if(J(R.text)&&(R.text=`${R.text}`),R.text&&R.text.includes(`
`)){const B=R.text.split(`
`);for(let A=0;A<B.length;A++)m.push(new Is(B[A],A!==0,R))}else R.text&&m.push(new Is(R.text,!1,R))}const C=typeof r=="number"&&Number.isFinite(r)&&r>0,_=typeof o=="number"&&Number.isFinite(o)&&o>0,w=typeof s=="number"&&Number.isFinite(s)&&s>0&&(!C||s<=r),y=typeof l=="number"&&Number.isFinite(l)&&l>0&&(!_||l<=o),v=new CA(0,0,(w?s:C?r:0)||0,(y?l:_?o:0)||0,a,d,u,h,c,g||"horizontal",!w&&C,!y&&_,f||!1,(t=this._frameCache)===null||t===void 0?void 0:t.icons),x=new yA(v);if(p){let S=0,R=!1;for(let B=0;B<m.length;B++){const A=m[B];R?(A.overflow=!0,A.left=1/0,A.top=1/0,!A.newLine&&v.lines[v.lines.length-1].paragraphs.push(A)):x.deal(A,!0),v.lines.length!==S&&(S=v.lines.length,x.lineBuffer.length=0,A.overflow=!0,A.left=1e3,A.top=1e3,v.lines[v.lines.length-1].paragraphs.push(A),R=!0),A.newLine&&(R=!1,x.lineWidth=0),x.send()}}else for(let S=0;S<m.length;S++)x.deal(m[S]);if(x.send(),!(v.layoutDirection==="horizontal"?w:y)){const S=v.getActualSizeWidthEllipsis();let R=v.layoutDirection==="horizontal"?S.width:S.height;(v.layoutDirection==="horizontal"?C:_)&&(R=Math.min(R,v.layoutDirection==="horizontal"?r:o)),v.lines.forEach(function(B){B.calcOffset(R,!1)})}this._frameCache=v}clone(){return new Wn(Object.assign({},this.attribute))}setStage(e,t){super.setStage(e,t),this.getFrameCache().icons.forEach(i=>{i.setStage(e,t)})}bindIconEvent(){this.addEventListener("pointermove",e=>{const t=this.pickIcon(e.global);t&&t===this._currentHoverIcon||(t?this.setAttribute("hoverIconId",t.richtextId):!t&&this._currentHoverIcon&&this.setAttribute("hoverIconId",void 0))}),this.addEventListener("pointerleave",e=>{this._currentHoverIcon&&this.setAttribute("hoverIconId",void 0)})}updateHoverIconState(e){var t,i,r,o,s;e?((t=this._currentHoverIcon)===null||t===void 0||t.setHoverState(!1),this._currentHoverIcon=e,this._currentHoverIcon.setHoverState(!0),(i=this.stage)===null||i===void 0||i.setCursor(e.attribute.cursor),(r=this.stage)===null||r===void 0||r.renderNextFrame()):(this._currentHoverIcon.setHoverState(!1),this._currentHoverIcon=null,(o=this.stage)===null||o===void 0||o.setCursor(),(s=this.stage)===null||s===void 0||s.renderNextFrame())}pickIcon(e){const t=this.getFrameCache(),{e:i,f:r}=this.globalTransMatrix;let o;return t.icons.forEach((s,l)=>{var a,d;const u=s.AABBBounds.clone();u.translate(s._marginArray[3],s._marginArray[0]),u.containsPoint({x:e.x-i,y:e.y-r})&&(o=s,o.globalX=((a=o.attribute.x)!==null&&a!==void 0?a:0)+i+s._marginArray[3],o.globalY=((d=o.attribute.y)!==null&&d!==void 0?d:0)+r+s._marginArray[0])}),o}getNoWorkAnimateAttr(){return Wn.NOWORK_ANIMATE_ATTR}}Wn.NOWORK_ANIMATE_ATTR=Object.assign({ellipsis:1,wordBreak:1,verticalDirection:1,textAlign:1,textBaseline:1,textConfig:1,layoutDirection:1},Gn);function vA(n){return new Wn(n)}const $p=["path","customPath",...Pn];class Os extends en{constructor(e){super(e),this.type="path",this.numberType=tu}get pathShape(){return this.tryUpdateAABBBounds(),this.getParsedPathShape()}isValid(){return super.isValid()&&this._isValid()}_isValid(){const{path:e}=this.attribute;return e!=null&&e!==""}getParsedPathShape(){const e=this.getGraphicTheme();if(!this.valid)return e.path;const t=this.attribute;return t.path instanceof Bt?t.path:(Te(this.cache)&&this.doUpdatePathShape(),this.cache instanceof Bt?this.cache:e.path)}getGraphicTheme(){return ve(this).path}updateAABBBounds(e,t,i){if(!this.updatePathProxyAABBBounds(i)){const l=this.getParsedPathShape();i.union(l.getBounds())}const{tb1:r,tb2:o}=U.graphicService.updateTempAABBBounds(i);sl(e,t,r),i.union(r),r.setValue(o.x1,o.y1,o.x2,o.y2);const{lineJoin:s=t.lineJoin}=e;return U.graphicService.transformAABBBounds(e,i,t,s==="miter",this),i}doUpdateAABBBounds(e){return this.doUpdatePathShape(),super.doUpdateAABBBounds(e)}doUpdatePathShape(){const e=this.attribute;je(e.path,!0)?this.cache=new Bt().fromString(e.path):e.customPath&&(this.cache=new Bt,e.customPath(this.cache,this))}needUpdateTags(e){return super.needUpdateTags(e,$p)}needUpdateTag(e){return super.needUpdateTag(e,$p)}toCustomPath(){return new Bt().fromCustomPath2D(this.getParsedPathShape(),0,0)}clone(){return new Os(Object.assign({},this.attribute))}getNoWorkAnimateAttr(){return Os.NOWORK_ANIMATE_ATTR}}Os.NOWORK_ANIMATE_ATTR=Object.assign({path:1,customPath:1},Gn);function SA(n){return new Os(n)}const Kp=["innerRadius","outerRadius","startAngle","endAngle","cornerRadius","padAngle","padRadius","cap",...Pn];class Bo extends en{constructor(e){super(e),this.type="arc",this.numberType=Jd}isValid(){return super.isValid()&&this._isValid()}_isValid(){const{startAngle:e,endAngle:t,outerRadius:i,innerRadius:r}=this.attribute;return this._validNumber(e)&&this._validNumber(t)&&this._validNumber(i)&&this._validNumber(r)}getParsedCornerRadius(){const e=this.getGraphicTheme(),{cornerRadius:t=e.cornerRadius,innerPadding:i=e.innerPadding,outerPadding:r=e.outerPadding}=this.attribute;let{outerRadius:o=e.outerRadius,innerRadius:s=e.innerRadius}=this.attribute;if(o+=r,s-=i,t===0||t==="0%")return 0;const l=Math.abs(o-s),a=d=>Math.min(J(d,!0)?d:l*parseFloat(d)/100,l/2);if(ee(t)){const d=t.map(u=>a(u)||0);return d.length===0?[d[0],d[0],d[0],d[0]]:d.length===2?[d[0],d[1],d[0],d[1]]:(d.length===3&&d.push(0),d)}return a(t)}getParsedAngle(){const e=this.getGraphicTheme();let{startAngle:t=e.startAngle,endAngle:i=e.endAngle}=this.attribute;const{cap:r=e.cap}=this.attribute,o=i-t>=0?1:-1,s=i-t;if(t=vv(t),i=t+s,r&&De(s)<Ge-Ye){let l=1,a=1;r.length&&(l=Number(r[0]),a=Number(r[1]));let{outerRadius:d=e.outerRadius,innerRadius:u=e.innerRadius}=this.attribute;const{outerPadding:h=e.outerPadding,innerPadding:c=e.innerPadding}=this.attribute;d+=h,u-=c;const g=Math.abs(d-u)/2,f=g/d;if(g>Ye&&d>Ye)return{startAngle:t-o*f*l,endAngle:i+o*f*a,sc:o*f*l,ec:o*f*a}}return{startAngle:t,endAngle:i}}getParsePadAngle(e,t){const i=this.getGraphicTheme(),{innerPadding:r=i.innerPadding,outerPadding:o=i.outerPadding,padAngle:s=i.padAngle}=this.attribute;let{outerRadius:l=i.outerRadius,innerRadius:a=i.innerRadius}=this.attribute;l+=o,a-=r;const{padRadius:d=Xi(l*l+a*a)}=this.attribute,u=De(t-e);let h=e,c=t,g=e,f=t;const p=s/2;let m=u,b=u;if(p>Ye&&d>Ye){const C=t>e?1:-1;let _=pg(Number(d)/a*it(p)),w=pg(Number(d)/l*it(p));return(m-=2*_)>Ye?(_*=C,g+=_,f-=_):(m=0,g=f=(e+t)/2),(b-=2*w)>Ye?(w*=C,h+=w,c-=w):(b=0,h=c=(e+t)/2),{outerStartAngle:h,outerEndAngle:c,innerStartAngle:g,innerEndAngle:f,innerDeltaAngle:m,outerDeltaAngle:b}}return{outerStartAngle:h,outerEndAngle:c,innerStartAngle:g,innerEndAngle:f,innerDeltaAngle:m,outerDeltaAngle:b}}getGraphicTheme(){return ve(this).arc}updateAABBBounds(e,t,i,r){this.updatePathProxyAABBBounds(i)||(r?this.updateArcAABBBoundsImprecise(e,t,i):this.updateArcAABBBoundsAccurate(e,t,i));const{tb1:o,tb2:s}=U.graphicService.updateTempAABBBounds(i);sl(e,t,o),i.union(o),o.setValue(s.x1,s.y1,s.x2,s.y2);const{lineJoin:l=t.lineJoin}=e;return U.graphicService.transformAABBBounds(e,i,t,l==="miter",this),i}updateArcAABBBoundsImprecise(e,t,i){let{outerRadius:r=t.outerRadius,innerRadius:o=t.innerRadius}=e;const{outerPadding:s=t.outerPadding,innerPadding:l=t.innerPadding}=e;return r+=s,o-=l,r<o&&(r=o),i.set(-r,-r,r,r),i}updateArcAABBBoundsAccurate(e,t,i){let{outerRadius:r=t.outerRadius,innerRadius:o=t.innerRadius}=e;const{outerPadding:s=t.outerPadding,innerPadding:l=t.innerPadding}=e;if(r+=s,o-=l,r<o){const u=r;r=o,o=u}let{endAngle:a=t.endAngle,startAngle:d=t.startAngle}=e;if(d>a){const u=d;d=a,a=u}return r<=Ye?i.set(0,0,0,0):Math.abs(a-d)>Ge-Ye?i.set(-r,-r,r,r):(Fh(d,a,r,i),Fh(d,a,o,i)),i}needUpdateTags(e){return super.needUpdateTags(e,Kp)}needUpdateTag(e){return super.needUpdateTag(e,Kp)}toCustomPath(){var e,t,i,r;const o=this.attribute,{startAngle:s,endAngle:l}=this.getParsedAngle();let a=((e=o.innerRadius)!==null&&e!==void 0?e:0)-((t=o.innerPadding)!==null&&t!==void 0?t:0),d=((i=o.outerRadius)!==null&&i!==void 0?i:0)-((r=o.outerPadding)!==null&&r!==void 0?r:0);const u=De(l-s),h=l>s;if(d<a){const g=d;d=a,a=g}const c=new Bt;if(d<=Ye)c.moveTo(0,0);else if(u>=Ge-Ye)c.moveTo(0+d*mt(s),0+d*it(s)),c.arc(0,0,d,s,l,!h),a>Ye&&(c.moveTo(0+a*mt(l),0+a*it(l)),c.arc(0,0,a,l,s,h));else{const g=d*mt(s),f=d*it(s),p=a*mt(l),m=a*it(l);c.moveTo(0+g,0+f),c.arc(0,0,d,s,l,!h),c.lineTo(0+p,0+m),c.arc(0,0,a,l,s,h),c.closePath()}return c}clone(){return new Bo(Object.assign({},this.attribute))}getNoWorkAnimateAttr(){return Bo.NOWORK_ANIMATE_ATTR}}Bo.NOWORK_ANIMATE_ATTR=Object.assign({cap:1},Gn);function Df(n){return new Bo(n)}const Yp=["points","cornerRadius",...Pn];class Ds extends en{constructor(e){super(e),this.type="polygon",this.numberType=nu}isValid(){return super.isValid()&&this._isValid()}_isValid(){const{points:e}=this.attribute;return e&&e.length>=2}getGraphicTheme(){return ve(this).polygon}updateAABBBounds(e,t,i){this.updatePathProxyAABBBounds(i)||this.updatePolygonAABBBoundsImprecise(e,t,i),U.graphicService.updateTempAABBBounds(i);const{lineJoin:r=t.lineJoin}=e;return U.graphicService.transformAABBBounds(e,i,t,r==="miter",this),i}updatePolygonAABBBoundsImprecise(e,t,i){const{points:r=t.points}=e;return r.forEach(o=>{i.add(o.x,o.y)}),i}_interpolate(e,t,i,r,o){e==="points"&&(o.points=b0(i,r,t))}needUpdateTags(e){return super.needUpdateTags(e,Yp)}needUpdateTag(e){return super.needUpdateTag(e,Yp)}toCustomPath(){const e=this.attribute.points,t=new Bt;return e.forEach((i,r)=>{r===0?t.moveTo(i.x,i.y):t.lineTo(i.x,i.y)}),t.closePath(),t}clone(){return new Ds(Object.assign({},this.attribute))}getNoWorkAnimateAttr(){return Ds.NOWORK_ANIMATE_ATTR}}Ds.NOWORK_ANIMATE_ATTR=Gn;function xA(n){return new Ds(n)}class RA extends jn{constructor(e){super({x:0,y:0}),this.type="shadowroot",this.shadowHost=e}clearUpdateBoundTag(){super.clearUpdateBoundTag(),this.shadowHost&&this.shadowHost.clearUpdateBoundTag()}addUpdateBoundTag(){super.addUpdateBoundTag(),this.shadowHost&&this.shadowHost.addUpdateBoundTag()}addUpdateShapeAndBoundsTag(){super.addUpdateShapeAndBoundsTag(),this.shadowHost&&this.shadowHost.addUpdateBoundTag()}tryUpdateGlobalTransMatrix(e=!0){if(this.shouldUpdateGlobalMatrix()){const t=this.transMatrix;this._globalTransMatrix?this._globalTransMatrix.setValue(t.a,t.b,t.c,t.d,t.e,t.f):this._globalTransMatrix=t.clone(),this.doUpdateGlobalMatrix(),e&&this.clearUpdateGlobalPositionTag()}return this._globalTransMatrix}doUpdateGlobalMatrix(){if(this.shadowHost){const e=this.shadowHost.globalTransMatrix;this._globalTransMatrix.multiply(e.a,e.b,e.c,e.d,e.e,e.f)}}tryUpdateGlobalAABBBounds(){return this._globalAABBBounds?this._globalAABBBounds.setValue(this._AABBBounds.x1,this._AABBBounds.y1,this._AABBBounds.x2,this._AABBBounds.y2):this._globalAABBBounds=this._AABBBounds.clone(),this.shadowHost&&this._globalAABBBounds.transformWithMatrix(this.shadowHost.globalTransMatrix),this._globalAABBBounds}}function AA(n){return new RA(n)}var Wf=function(n,e,t,i){var r,o=arguments.length,s=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,e,t,i);else for(var l=n.length-1;l>=0;l--)(r=n[l])&&(s=(o<3?r(s):o>3?r(e,t,s):r(e,t))||s);return o>3&&s&&Object.defineProperty(e,t,s),s};const io=Symbol.for("PickItemInterceptor");let ka=class{constructor(){this.order=1}afterPickItem(n,e,t,i,r){return n.attribute.shadowRootIdx>0||!n.attribute.shadowRootIdx?this._pickItem(n,e,t,i,r):null}beforePickItem(n,e,t,i,r){return n.attribute.shadowRootIdx<0?this._pickItem(n,e,t,i,r):null}_pickItem(n,e,t,i,r){var o;if(!n.shadowRoot)return null;const{parentMatrix:s}=r||{};if(!s)return null;const l=e.pickContext;l.highPerformanceSave();const a=(o=ve(n))===null||o===void 0?void 0:o[n.type],{shadowPickMode:d=a==null?void 0:a.shadowPickMode}=n.attribute,u=n.shadowRoot,h=Zt.allocateByObj(s),c=new St(h.a*t.x+h.c*t.y+h.e,h.b*t.x+h.d*t.y+h.f),g=e.pickGroup(u,c,h,i);return l.highPerformanceRestore(),!g.graphic&&g.group&&d==="full"&&(g.graphic=g.group),g}};ka=Wf([se()],ka);let Ea=class{constructor(){this.order=1}beforePickItem(n,e,t,i,r){const o=n.baseGraphic;if(o&&o.parent){const s=new St(t.x,t.y),l=e.pickContext;l.highPerformanceSave();const a=o.parent.globalTransMatrix;a.transformPoint(s,s);const d=o.isContainer?e.pickGroup(o,s.clone(),a,i):e.pickItem(o,s.clone(),a,i);return l.highPerformanceRestore(),d}return null}};Ea=Wf([se()],Ea);let La=class{constructor(){this.order=1}beforePickItem(n,e,t,i,r){if(!n.in3dMode||i.in3dInterceptor)return null;const o=e.pickContext,s=n.stage;if(!o||!s)return null;if(i.in3dInterceptor=!0,o.save(),this.initCanvasCtx(o),o.camera=s.camera,n.isContainer){const l=O0(o,n,()=>e.pickGroup(n,t,r.parentMatrix,i),i);return o.camera=null,i.in3dInterceptor=!1,o.restore(),l}return o.restore(),null}initCanvasCtx(n){n.setTransformForCurrent()}};La=Wf([se()],La);const BA=new we((n,e,t)=>{t(co)||(n(pp).toSelf(),n(co).toService(pp)),n(La).toSelf().inSingletonScope(),n(io).toService(La),n(ka).toSelf().inSingletonScope(),n(io).toService(ka),n(Ea).toSelf().inSingletonScope(),n(io).toService(Ea),Dt(n,io)}),MA=new we(n=>{n(v0).to(jh).inSingletonScope(),n(S0).toConstantValue(ge)}),Ws=Symbol.for("AutoEnablePlugins"),U0=Symbol.for("PluginService");var TA=function(n,e,t,i){var r,o=arguments.length,s=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,e,t,i);else for(var l=n.length-1;l>=0;l--)(r=n[l])&&(s=(o<3?r(s):o>3?r(e,t,s):r(e,t))||s);return o>3&&s&&Object.defineProperty(e,t,s),s},PA=function(n,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,e)},Xp=function(n,e){return function(t,i){e(t,i,n)}};let lc=class{constructor(n){this.autoEnablePlugins=n,this.onStartupFinishedPlugin=[],this.onRegisterPlugin=[],this.actived=!1}active(n,e){this.stage=n,this.actived=!0;const{pluginList:t}=e;t&&Ce.isBound(Ws)&&this.autoEnablePlugins.getContributions().forEach(i=>{t.includes(i.name)&&this.register(i)})}findPluginsByName(n){const e=[];return this.onStartupFinishedPlugin.forEach(t=>{t.name===n&&e.push(t)}),this.onRegisterPlugin.forEach(t=>{t.name===n&&e.push(t)}),e}register(n){n.activeEvent==="onStartupFinished"?this.onStartupFinishedPlugin.push(n):n.activeEvent==="onRegister"&&(this.onRegisterPlugin.push(n),n.activate(this))}unRegister(n){n.activeEvent==="onStartupFinished"?this.onStartupFinishedPlugin.splice(this.onStartupFinishedPlugin.indexOf(n),1):n.activeEvent==="onRegister"&&this.onRegisterPlugin.splice(this.onStartupFinishedPlugin.indexOf(n),1),n.deactivate(this)}release(...n){this.onStartupFinishedPlugin.forEach(e=>{e.deactivate(this)}),this.onStartupFinishedPlugin=[],this.onRegisterPlugin.forEach(e=>{e.deactivate(this)}),this.onRegisterPlugin=[]}};lc=TA([se(),Xp(0,Be(gt)),Xp(0,At(Ws)),PA("design:paramtypes",[Object])],lc);const HA=new we(n=>{n(U0).to(lc),Uv(n,Ws)}),kA=new we(n=>{Dt(n,Xd)}),EA=new we(n=>{n(vi).to(yo).inSingletonScope(),Dt(n,vi)});var LA=function(n,e,t,i){var r,o=arguments.length,s=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,e,t,i);else for(var l=n.length-1;l>=0;l--)(r=n[l])&&(s=(o<3?r(s):o>3?r(e,t,s):r(e,t))||s);return o>3&&s&&Object.defineProperty(e,t,s),s},FA=function(n,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,e)};let Fa=class{constructor(){this.type="static",this.offscreen=!1,this.global=U.global}setDpr(n){this.canvas.dpr=n}init(n,e,t){if(this.layer=n,this.window=e,t.main)this.main=!0,this.context=e.getContext(),this.canvas=this.context.getCanvas();else{let i;this.main=!1,t.canvasId&&(i=this.global.getElementById(t.canvasId)),i||(i=this.global.createCanvas({width:e.width,height:e.height})),i.style&&(i.style["pointer-events"]="none");const r=e.getContext().getCanvas().nativeCanvas,o=Hh({nativeCanvas:i,width:e.width,height:e.height,dpr:e.dpr,id:t.canvasId,canvasControled:!0,container:e.getContainer(),x:r.offsetLeft,y:r.offsetTop});o.applyPosition(),this.canvas=o,this.context=o.getContext()}}resize(n,e){this.canvas.resize(n,e)}resizeView(n,e){}render(n,e,t){var i;if(!this.main){const r=this.window.getContext().getCanvas().nativeCanvas;!r||this.canvas.x===r.offsetLeft&&this.canvas.y===r.offsetTop||(this.canvas.x=r.offsetLeft,this.canvas.y=r.offsetTop,this.canvas.applyPosition())}e.renderService.render(n,Object.assign(Object.assign({context:this.context,clear:(i=e.background)!==null&&i!==void 0?i:"#ffffff"},e),t))}merge(n){n.forEach(e=>{const t=e.getContext().canvas.nativeCanvas;this.context.drawImage(t,0,0)})}prepare(n,e){}drawTo(n,e,t){var i;const r=n.getContext();t.renderService.render(e,Object.assign(Object.assign({context:r},t),{clear:t.clear?(i=t.background)!==null&&i!==void 0?i:"#fff":void 0}))}getContext(){return this.context}release(){this.canvas.release()}};Fa=LA([se(),FA("design:paramtypes",[])],Fa);const zA=new we(n=>{n(Fa).toSelf(),n(B0).toService(Fa)});function IA(n){n.load(kA),n.load(EA),n.load(zA)}var OA=function(n,e,t,i){return new(t||(t=Promise))(function(r,o){function s(d){try{a(i.next(d))}catch(u){o(u)}}function l(d){try{a(i.throw(d))}catch(u){o(u)}}function a(d){var u;d.done?r(d.value):(u=d.value,u instanceof t?u:new t(function(h){h(u)})).then(s,l)}a((i=i.apply(n,e||[])).next())})};function $0(n,e,t){const i={},r=[];return n.forEachChildren(o=>{const{zIndex:s=e}=o.attribute;i[s]?i[s].push(o):(i[s]=[o],r.push(s))},t),r.sort((o,s)=>t?s-o:o-s),{childMap:i,zIdxArray:r}}function K0(n,e,t,i=!1,r=!1){let o=!1;if(r)o=!0;else{let s;n.forEachChildren((l,a)=>{const{zIndex:d=e}=l.attribute;if(a===0)s=d;else if(s!==d)return o=!0,!0;return!1},i)}if(o){const{childMap:s,zIdxArray:l}=$0(n,e,i);let a=!1;for(let d=0;d<l.length&&!a;d++){const u=s[l[d]];r&&u.sort((h,c)=>{var g,f;return(i?-1:1)*(((g=c.attribute.z)!==null&&g!==void 0?g:0)-((f=h.attribute.z)!==null&&f!==void 0?f:0))});for(let h=0;h<u.length;h++)if(t(u[h],h)){a=!0;break}}}else n.forEachChildren(t,i)}function qp(n,e,t,i=!1){return OA(this,void 0,void 0,function*(){yield n.forEachChildrenAsync(t,i)})}function DA(n,e,t,i=!1){let r=!1;n.forEachChildren((l,a)=>{const{zIndex:d=t}=l.attribute;if(a!==0){if(d!==void 0)return r=!0,!0}return!1},i);let o=null,s=!1;if(r){const{childMap:l,zIdxArray:a}=$0(n,t,i);let d=!1;for(let u=0;u<a.length&&!d;u++){const h=l[a[u]];for(let c=0;c<h.length;c++){if(s){d=!0,o=h[c];break}h[c]._uid!==e||(s=!0)}}}else n.forEachChildren(l=>s?(o=l,!0):(l._uid===e&&(s=!0),!1),i);return o}var WA=function(n,e,t,i){var r,o=arguments.length,s=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,e,t,i);else for(var l=n.length-1;l>=0;l--)(r=n[l])&&(s=(o<3?r(s):o>3?r(e,t,s):r(e,t))||s);return o>3&&s&&Object.defineProperty(e,t,s),s},NA=function(n,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,e)},Vu=function(n,e){return function(t,i){e(t,i,n)}};let za=class{constructor(n,e){this.contributions=n,this.drawItemInterceptorContributions=e,this.currentRenderMap=new Map,this.defaultRenderMap=new Map,this.styleRenderMap=new Map,this.dirtyBounds=new Ri,this.backupDirtyBounds=new Ri,this.global=U.global,this.layerService=U.layerService,this.init()}init(){this.contributions.forEach(n=>{if(n.style){const e=this.styleRenderMap.get(n.style)||new Map;e.set(n.numberType,n),this.styleRenderMap.set(n.style,e)}else this.defaultRenderMap.set(n.numberType,n)}),this.InterceptorContributions=this.drawItemInterceptorContributions.getContributions().sort((n,e)=>n.order-e.order)}prepareForDraw(n,e){e.updateBounds?this.useDirtyBounds=!0:this.useDirtyBounds=!e.stage.params.optimize.disableCheckGraphicWidthOutRange}draw(n,e){this.prepareForDraw(n,e),e.drawContribution=this,this.currentRenderMap=this.styleRenderMap.get(e.renderStyle)||this.defaultRenderMap,this.currentRenderService=n;const{context:t,stage:i,viewBox:r,transMatrix:o}=e;if(!t)return;const s=this.dirtyBounds.setValue(0,0,r.width(),r.height());if(i.dirtyBounds&&!i.dirtyBounds.empty()){const a=z_(s,i.dirtyBounds,!1);s.x1=Math.floor(a.x1),s.y1=Math.floor(a.y1),s.x2=Math.ceil(a.x2),s.y2=Math.ceil(a.y2)}const l=t.dpr%1;(l||l!==.5)&&(s.x1=Math.floor(s.x1*t.dpr)/t.dpr,s.y1=Math.floor(s.y1*t.dpr)/t.dpr,s.x2=Math.ceil(s.x2*t.dpr)/t.dpr,s.y2=Math.ceil(s.y2*t.dpr)/t.dpr),this.backupDirtyBounds.copy(s),t.inuse=!0,t.setClearMatrix(o.a,o.b,o.c,o.d,o.e,o.f),t.clearMatrix(),t.setTransformForCurrent(!0),t.translate(r.x1,r.y1,!0),t.beginPath(),t.rect(s.x1,s.y1,s.width(),s.height()),t.clip(),i.camera&&(this.dirtyBounds.setValue(-1/0,-1/0,1/0,1/0),this.backupDirtyBounds.setValue(-1/0,-1/0,1/0,1/0)),this.clearScreen(n,t,e),t.save(),n.renderTreeRoots.sort((a,d)=>{var u,h;return((u=a.attribute.zIndex)!==null&&u!==void 0?u:ot.zIndex)-((h=d.attribute.zIndex)!==null&&h!==void 0?h:ot.zIndex)}).forEach(a=>{a.isContainer?this.renderGroup(a,e,Zt.allocate(1,0,0,1,0,0)):this.renderItem(a,e)}),t.restore(),t.setClearMatrix(1,0,0,1,0,0),t.inuse=!1,t.draw()}doRegister(){throw new Error("暂不支持")}_findNextGraphic(n){let e=n.parent,t=n._uid;for(;e;){const i=DA(e,t,ot.zIndex);if(i)return i;t=e._uid,e=e.parent}return null}renderGroup(n,e,t,i){if(e.break||n.attribute.visibleAll===!1)return;if(n.incremental&&(e.startAtId==null||e.startAtId===n._uid))return e.break=!0,void this._increaseRender(n,e);if(this.useDirtyBounds&&!Sh(n.AABBBounds,this.dirtyBounds,!1))return;let r,o=t;if(this.useDirtyBounds){r=Sa.allocateByObj(this.dirtyBounds);const s=n.transMatrix;o=Zt.allocateByObj(t).multiply(s.a,s.b,s.c,s.d,s.e,s.f),this.dirtyBounds.copy(this.backupDirtyBounds).transformWithMatrix(o.getInverse())}this.renderItem(n,e,{drawingCb:()=>{var s;i?n.forEachChildren(l=>{e.break||(l.isContainer?this.renderGroup(l,e,o):this.renderItem(l,e))}):K0(n,ot.zIndex,l=>{e.break||(l.isContainer?this.renderGroup(l,e,o):this.renderItem(l,e))},!1,!!(!((s=e.context)===null||s===void 0)&&s.camera))}}),this.useDirtyBounds&&(this.dirtyBounds.copy(r),Sa.free(r),Zt.free(o))}_increaseRender(n,e){const{layer:t,stage:i}=e,{subLayers:r}=t;let o=r.get(n._uid);o||(o={layer:this.layerService.createLayer(i),zIndex:r.size,group:n},r.set(n._uid,o));const s=o.layer.getNativeHandler().getContext(),l=o.drawContribution||Ce.get(I0);l.dirtyBounds.setValue(-1/0,-1/0,1/0,1/0),l.backupDirtyBounds.setValue(-1/0,-1/0,1/0,1/0),l.draw(this.currentRenderService,Object.assign(Object.assign({},e),{drawContribution:l,clear:"transparent",layer:o.layer,context:s,startAtId:n._uid,break:!1})),o.drawContribution=l;const a=this._findNextGraphic(n);if(a)if(a.isContainer&&a.incremental)this._increaseRender(a,e);else{let d=r.get(a._uid);d||(d={layer:this.layerService.createLayer(i),zIndex:r.size},r.set(a._uid,d));const u=d.layer.getNativeHandler().getContext();this.draw(this.currentRenderService,Object.assign(Object.assign({},e),{drawContribution:l,clear:"transparent",layer:d.layer,context:u,startAtId:a._uid,break:!1}))}}getRenderContribution(n){let e;return e||(e=this.selectRenderByNumberType(n.numberType,n)),e||(e=this.selectRenderByType(n.type)),e}renderItem(n,e,t){if(this.InterceptorContributions.length)for(let l=0;l<this.InterceptorContributions.length;l++){const a=this.InterceptorContributions[l];if(a.beforeDrawItem&&a.beforeDrawItem(n,this.currentRenderService,e,this,t))return}const i=this.getRenderContribution(n);if(!i)return;let r,o=this.scrollMatrix&&(this.scrollMatrix.e!==0||this.scrollMatrix.f!==0);if(n.parent){const{scrollX:l=0,scrollY:a=0}=n.parent.attribute;(l||a)&&(o=!0,this.scrollMatrix||(this.scrollMatrix=Zt.allocate(1,0,0,1,0,0)),this.scrollMatrix.translate(-l,-a))}if(o&&(r=this.dirtyBounds.clone().transformWithMatrix(this.scrollMatrix)),this.useDirtyBounds&&!n.isContainer&&!Sh(n.AABBBounds,r??this.dirtyBounds,!1)){if(o&&n.parent){const{scrollX:l=0,scrollY:a=0}=n.parent.attribute;this.scrollMatrix&&this.scrollMatrix.translate(l,a)}return}const s=e.startAtId!=null&&n._uid!==e.startAtId;if(n._uid===e.startAtId&&(e.startAtId=null),t&&(t.skipDraw=s),s?n.isContainer&&i.draw(n,this.currentRenderService,e,t):i.draw(n,this.currentRenderService,e,t),o&&n.parent){const{scrollX:l=0,scrollY:a=0}=n.parent.attribute;this.scrollMatrix&&this.scrollMatrix.translate(l,a)}if(this.InterceptorContributions.length)for(let l=0;l<this.InterceptorContributions.length;l++){const a=this.InterceptorContributions[l];if(a.afterDrawItem&&a.afterDrawItem(n,this.currentRenderService,e,this))return}}selectRenderByType(n){return It.getInstance().warn("未知错误，不应该走到这里"),null}selectRenderByNumberType(n,e){let t;if(e.attribute.renderStyle){const i=this.styleRenderMap.get(e.attribute.renderStyle);t=i&&i.get(n)}return t||this.currentRenderMap.get(n)||this.defaultRenderMap.get(n)}clearScreen(n,e,t){var i,r;const{clear:o,viewBox:s}=t,l=s.width(),a=s.height();if(o){e.clearRect(0,0,l,a);const d=(i=n.drawParams)===null||i===void 0?void 0:i.stage;if(d&&(e.globalAlpha=(r=d.attribute.opacity)!==null&&r!==void 0?r:1),d&&d.backgroundImg&&d.resources){const u=d.resources.get(o);u&&u.state==="success"&&u.data&&e.drawImage(u.data,0,0,l,a)}else e.fillStyle=da(e,o,{AABBBounds:{x1:0,y1:0,x2:0+l,y2:0+a}},0,0),e.fillRect(0,0,l,a)}}afterDraw(n,e){}};za=WA([se(),Vu(0,Y_($t)),Vu(1,Be(gt)),Vu(1,At(Fs)),NA("design:paramtypes",[Array,Object])],za);var VA=function(n,e,t,i){var r,o=arguments.length,s=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,e,t,i);else for(var l=n.length-1;l>=0;l--)(r=n[l])&&(s=(o<3?r(s):o>3?r(e,t,s):r(e,t))||s);return o>3&&s&&Object.defineProperty(e,t,s),s};let Ia=class extends Ls{constructor(){super(...arguments),this.numberType=il}drawShape(n,e,t,i,r,o,s,l){if(n.incremental&&r.multiGraphicOptions){const{startAtIdx:a,length:d}=r.multiGraphicOptions,{segments:u=[]}=n.attribute;if(a>u.length)return;const h=ve(n).line,{fill:c=h.fill,stroke:g=h.stroke,opacity:f=h.opacity,fillOpacity:p=h.fillOpacity,strokeOpacity:m=h.strokeOpacity,lineWidth:b=h.lineWidth,visible:C=h.visible}=n.attribute,_=Pr(f,p,c),w=Ef(f,m),y=zo(c),v=rl(g,b);if(!n.valid||!C||!y&&!v||!(_||w||s||l))return;const{context:x}=r;for(let S=a;S<a+d;S++)this.drawIncreaseSegment(n,x,u[S-1],u[S],n.attribute.segments[S],[h,n.attribute],t,i)}else super.drawShape(n,e,t,i,r,o,s,l)}drawIncreaseSegment(n,e,t,i,r,o,s,l){i&&(e.beginPath(),Hx(e.nativeContext,t,i,{offsetX:s,offsetY:l}),e.setShadowBlendStyle&&e.setShadowBlendStyle(n,r,o),e.setStrokeStyle(n,r,s,l,o),e.stroke())}};Ia=VA([se()],Ia);var GA=function(n,e,t,i){var r,o=arguments.length,s=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,e,t,i);else for(var l=n.length-1;l>=0;l--)(r=n[l])&&(s=(o<3?r(s):o>3?r(e,t,s):r(e,t))||s);return o>3&&s&&Object.defineProperty(e,t,s),s};let ac=class extends $h{constructor(){super(...arguments),this.numberType=y0}drawShape(n,e,t,i,r,o,s){if(n.incremental&&r.multiGraphicOptions){const{startAtIdx:l,length:a}=r.multiGraphicOptions,{segments:d=[]}=n.attribute;if(l>d.length)return;const u=ve(n).area,{fill:h=u.fill,fillOpacity:c=u.fillOpacity,opacity:g=u.opacity,visible:f=u.visible}=n.attribute,p=Pr(g,c,h),m=zo(h);if(!n.valid||!f||!m||!p&&!s)return;for(let b=l;b<l+a;b++)this.drawIncreaseSegment(n,e,d[b-1],d[b],n.attribute.segments[b],[u,n.attribute],t,i)}else super.drawShape(n,e,t,i,r,o,s)}drawIncreaseSegment(n,e,t,i,r,o,s,l){i&&(e.beginPath(),kx(e.camera?e:e.nativeContext,t,i,{offsetX:s,offsetY:l}),e.setShadowBlendStyle&&e.setShadowBlendStyle(n,r,o),e.setCommonStyle(n,r,s,l,o),e.fill())}};ac=GA([se()],ac);var ro,jA=function(n,e,t,i){var r,o=arguments.length,s=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,e,t,i);else for(var l=n.length-1;l>=0;l--)(r=n[l])&&(s=(o<3?r(s):o>3?r(e,t,s):r(e,t))||s);return o>3&&s&&Object.defineProperty(e,t,s),s},UA=function(n,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,e)},Jo=function(n,e){return function(t,i){e(t,i,n)}},Kn=function(n,e,t,i){return new(t||(t=Promise))(function(r,o){function s(d){try{a(i.next(d))}catch(u){o(u)}}function l(d){try{a(i.throw(d))}catch(u){o(u)}}function a(d){var u;d.done?r(d.value):(u=d.value,u instanceof t?u:new t(function(h){h(u)})).then(s,l)}a((i=i.apply(n,e||[])).next())})};(function(n){n[n.NORMAL=0]="NORMAL",n[n.STOP=1]="STOP"})(ro||(ro={}));let dc=class extends za{constructor(n,e,t,i){super(n,i),this.contributions=n,this.lineRender=e,this.areaRender=t,this.drawItemInterceptorContributions=i,this.rendering=!1,this.currFrameStartAt=0,this.currentIdx=0,this.status=ro.NORMAL,this.checkingForDrawPromise=null,this.hooks={completeDraw:new Xt([])},this.defaultRenderMap.set(this.lineRender.numberType,this.lineRender),this.defaultRenderMap.set(this.areaRender.numberType,this.areaRender)}draw(n,e){return Kn(this,void 0,void 0,function*(){if(this.checkingForDrawPromise)return;this.lastRenderService=n,this.lastDrawContext=e,this.checkingForDrawPromise=this.checkForDraw(e);const t=yield this.checkingForDrawPromise;if(this.checkingForDrawPromise=null,t)return;this.currentRenderService=n;const{context:i,viewBox:r}=e;i&&(i.inuse=!0,i.clearMatrix(),i.setTransformForCurrent(!0),i.save(),e.restartIncremental&&this.clearScreen(this.currentRenderService,i,e),i.translate(r.x1,r.y1,!0),i.save(),n.renderTreeRoots.sort((o,s)=>{var l,a;return((l=o.attribute.zIndex)!==null&&l!==void 0?l:ot.zIndex)-((a=s.attribute.zIndex)!==null&&a!==void 0?a:ot.zIndex)}).forEach(o=>{this.renderGroup(o,e)}),this.hooks.completeDraw.tap("top-draw",()=>{i.restore(),i.restore(),i.draw(),i.inuse=!1,this.rendering=!1}))})}_increaseRender(n,e){return Kn(this,void 0,void 0,function*(){this.rendering=!0,yield this._renderIncrementalGroup(n,e)})}_renderIncrementalGroup(n,e){return Kn(this,void 0,void 0,function*(){this.count=n.count,yield new Promise(t=>{this.renderItem(n,e,{drawingCb:()=>Kn(this,void 0,void 0,function*(){if(n.count!==2)yield qp(n,ot.zIndex,(i,r)=>{if(this.status===ro.STOP)return!0;if(i.isContainer||r<this.currentIdx)return!1;const o=this.currFrameStartAt+n.incremental;return r<o&&(this.currentIdx=r+1,this.renderItem(i,e)),r===o-1&&(this.currFrameStartAt=this.currentIdx,this.waitToNextFrame())}),t(!1);else{const i=n.getChildAt(0);if(i.incremental&&i.attribute.segments)for(i.incrementalAt||(i.incrementalAt=0);i.incrementalAt<i.attribute.segments.length;)e.multiGraphicOptions={startAtIdx:i.incrementalAt,length:i.incremental},this.renderItem(i,e),i.incrementalAt+=i.incremental,yield this.waitToNextFrame();else this.renderItem(i,e);t(!1)}})})}),this.hooks.completeDraw.call()})}waitToNextFrame(){return Kn(this,void 0,void 0,function*(){return new Promise(n=>{this.global.getRequestAnimationFrame()(()=>{n(!1)})})})}checkForDraw(n){return Kn(this,void 0,void 0,function*(){let e=this.rendering;return n.restartIncremental&&(e=!1,yield this.forceStop(),this.resetToInit()),e})}forceStop(){return Kn(this,void 0,void 0,function*(){this.rendering&&(this.status=ro.STOP,yield new Promise(n=>{this.hooks.completeDraw.tap("stopCb",()=>{this.status=ro.NORMAL,this.hooks.completeDraw.taps=this.hooks.completeDraw.taps.filter(e=>e.name!=="stopCb"),n(!1)})}))})}resetToInit(){this.currFrameStartAt=0,this.currentIdx=0}renderGroup(n,e){return Kn(this,void 0,void 0,function*(){if(!e.break&&n.attribute.visibleAll!==!1)return n.incremental&&e.startAtId===n._uid?(yield this._increaseRender(n,e),void(e.break=!0)):void(yield new Promise(t=>{this.renderItem(n,e,{drawingCb:()=>Kn(this,void 0,void 0,function*(){yield qp(n,ot.zIndex,i=>Kn(this,void 0,void 0,function*(){e.break||i.isContainer&&(yield this.renderGroup(i,e))})),t(!1)})})}))})}};dc=jA([se(),Jo(0,Y_($t)),Jo(1,Be(Ia)),Jo(2,Be(ac)),Jo(3,Be(gt)),Jo(3,At(Fs)),UA("design:paramtypes",[Array,Object,Object,Object])],dc);const $A=new we(n=>{n(ou).toSelf().inSingletonScope(),n(zf).toSelf().inSingletonScope(),n(If).to(za),n(I0).to(dc),n(hp).to(Xh).inSingletonScope(),n($t).toService(hp),Dt(n,En),n(Dn).toSelf().inSingletonScope(),Dt(n,Lf),Dt(n,$t),n(Ha).toSelf().inSingletonScope(),n(Fs).toService(Ha),Dt(n,Fs)});function KA(n){n.load($A)}function Ns(){Ns.__loaded||(Ns.__loaded=!0,Ce.load(GS),Ce.load(MA),Ce.load(bR),Ce.load(BA),Ce.load(HA),IA(Ce),KA(Ce))}Ns.__loaded=!1,Ns();const et=Ce.get(yf);U.global=et;const YA=Ce.get(A0);U.graphicUtil=YA;const XA=Ce.get(R0);U.transformUtil=XA;const qA=Ce.get(v0);U.graphicService=qA;const ZA=Ce.get(kf);U.layerService=ZA;class JA{constructor(){this.name="AutoRenderPlugin",this.activeEvent="onRegister",this._uid=pt.GenAutoIncrementId(),this.key=this.name+this._uid,this.handleChange=e=>{e.glyphHost&&(e=e.glyphHost),e.stage===this.pluginService.stage&&e.stage!=null&&e.stage.renderNextFrame()}}activate(e){this.pluginService=e,U.graphicService.hooks.onAttributeUpdate.tap(this.key,this.handleChange),U.graphicService.hooks.onSetStage.tap(this.key,this.handleChange),U.graphicService.hooks.onRemove.tap(this.key,this.handleChange)}deactivate(e){const t=i=>i.filter(r=>r.name!==this.key);U.graphicService.hooks.onAttributeUpdate.taps=t(U.graphicService.hooks.onAttributeUpdate.taps),U.graphicService.hooks.onSetStage.taps=t(U.graphicService.hooks.onSetStage.taps),U.graphicService.hooks.onRemove.taps=t(U.graphicService.hooks.onRemove.taps)}}class QA{constructor(){this.name="AutoRefreshPlugin",this.activeEvent="onRegister",this._uid=pt.GenAutoIncrementId(),this.key=this.name+this._uid,this.handleChange=e=>{e.glyphHost&&(e=e.glyphHost),e.stage===this.pluginService.stage&&e.stage!=null&&e.stage.renderNextFrame()}}activate(e){this.pluginService=e,this.dpr=U.global.devicePixelRatio,this.refresh()}refresh(){this._refreshByMediaQuery()||this._refreshByRaf()}_refreshByRaf(){const e=U.global.getRequestAnimationFrame();this.rafId=e(()=>{U.global.devicePixelRatio!==this.dpr&&(this.dpr=U.global.devicePixelRatio,this.pluginService.stage.setDpr(this.dpr,!0)),this.refresh()})}_refreshByMediaQuery(){try{const e=`(resolution: ${window.devicePixelRatio}dppx)`,t=()=>{window.devicePixelRatio!==this.dpr&&(this.dpr=window.devicePixelRatio,this.pluginService.stage.setDpr(this.dpr,!0))};matchMedia(e).addEventListener("change",t)}catch{return!1}return!0}deactivate(e){const t=U.global.getCancelAnimationFrame();t&&this.rafId&&t(this.rafId)}}class eB{constructor(){this.name="IncrementalAutoRenderPlugin",this.activeEvent="onRegister",this.nextFrameRenderGroupSet=new Set,this.willNextFrameRender=!1,this.nextUserParams={},this._uid=pt.GenAutoIncrementId(),this.key=this.name+this._uid}activate(e){this.pluginService=e,U.graphicService.hooks.onAddIncremental.tap(this.key,(t,i,r)=>{t.glyphHost&&(t=t.glyphHost),t.stage===e.stage&&t.stage!=null&&(this.nextUserParams.startAtId=i._uid,this.renderNextFrame(i))}),U.graphicService.hooks.onClearIncremental.tap(this.key,(t,i)=>{t.stage===e.stage&&t.stage!=null&&(this.nextUserParams.startAtId=t._uid,this.nextUserParams.restartIncremental=!0,this.renderNextFrame(t))})}deactivate(e){U.graphicService.hooks.onAddIncremental.taps=U.graphicService.hooks.onAddIncremental.taps.filter(t=>t.name!==this.key),U.graphicService.hooks.onClearIncremental.taps=U.graphicService.hooks.onClearIncremental.taps.filter(t=>t.name!==this.key)}renderNextFrame(e){this.nextFrameRenderGroupSet.add(e),this.willNextFrameRender||(this.willNextFrameRender=!0,U.global.getRequestAnimationFrame()(()=>{this._doRenderInThisFrame(),this.willNextFrameRender=!1}))}_doRenderInThisFrame(){const e=this.pluginService.stage;this.nextFrameRenderGroupSet.size&&(this.nextFrameRenderGroupSet.forEach(t=>{const i=t.layer;if(!i||!t.layer.subLayers)return;const r=t.layer.subLayers.get(t._uid);r&&r.drawContribution&&r.drawContribution.draw(e.renderService,Object.assign({stage:e,layer:i,viewBox:e.window.getViewBox(),transMatrix:e.window.getViewBoxTransform(),clear:"transparent",renderService:e.renderService,updateBounds:!1,startAtId:t._uid,context:r.layer.getNativeHandler().getContext()},this.nextUserParams))}),this.nextUserParams={},this.nextFrameRenderGroupSet.clear())}}const Zp=new Ue;class tB{constructor(){this.name="DirtyBoundsPlugin",this.activeEvent="onRegister",this._uid=pt.GenAutoIncrementId(),this.key=this.name+this._uid}activate(e){this.pluginService=e,e.stage.hooks.afterRender.tap(this.key,t=>{t&&t===this.pluginService.stage&&t.dirtyBounds.clear()}),U.graphicService.hooks.beforeUpdateAABBBounds.tap(this.key,(t,i,r,o)=>{t.glyphHost&&(t=t.glyphHost),i&&i===this.pluginService.stage&&i.renderCount&&(t.isContainer&&!t.shouldSelfChangeUpdateAABBBounds()||r&&(Zp.setValue(o.x1,o.y1,o.x2,o.y2),i.dirty(Zp,t.parent&&t.parent.globalTransMatrix)))}),U.graphicService.hooks.afterUpdateAABBBounds.tap(this.key,(t,i,r,o,s)=>{i&&i===this.pluginService.stage&&i.renderCount&&(t.isContainer&&!s||i.dirty(o.globalAABBBounds))}),U.graphicService.hooks.clearAABBBounds.tap(this.key,(t,i,r)=>{i&&i===this.pluginService.stage&&i.renderCount&&i&&i.dirty(r)}),U.graphicService.hooks.onRemove.tap(this.key,t=>{const i=t.stage;i&&i===this.pluginService.stage&&i.renderCount&&i&&i.dirty(t.globalAABBBounds)})}deactivate(e){U.graphicService.hooks.beforeUpdateAABBBounds.taps=U.graphicService.hooks.beforeUpdateAABBBounds.taps.filter(t=>t.name!==this.key),U.graphicService.hooks.afterUpdateAABBBounds.taps=U.graphicService.hooks.afterUpdateAABBBounds.taps.filter(t=>t.name!==this.key),U.graphicService.hooks.clearAABBBounds.taps=U.graphicService.hooks.clearAABBBounds.taps.filter(t=>t.name!==this.key),e.stage.hooks.afterRender.taps=e.stage.hooks.afterRender.taps.filter(t=>t.name!==this.key),U.graphicService.hooks.onRemove.taps=U.graphicService.hooks.onRemove.taps.filter(t=>t.name!==this.key)}}const Nf=new g0;Nf.addTimeline(p0);Nf.setFPS(60);let mr;function Y0(){if(mr==null)try{const n=document.createElement("canvas"),e=n.getContext("2d");mr=!!(window&&n.getBoundingClientRect&&requestAnimationFrame&&window.devicePixelRatio&&e&&e.isPointInPath&&e.isPointInStroke),mr&&(mr=!!document.createElement)}catch{mr=!1}}function Vf(){Y0();const n=U.global&&U.global.env;return n?n==="browser":mr}function nB(){Y0();const n=U.global&&U.global.env;return n?n==="node":!mr}let Ni=class uc{static registerPlugin(e,t){uc._pluginClasses[e]=t}static getPlugin(e){return uc._pluginClasses[e]}};Ni._pluginClasses={};const Jp={BACKGROUND:"white"};class iB extends jn{set viewBox(e){this.window.setViewBox(e)}get viewBox(){return this.window.getViewBox()}get x(){return this.window.getViewBox().x1}set x(e){const t=this.window.getViewBox();t.translate(e-t.x1,0),this.window.setViewBox(t)}get y(){return this.window.getViewBox().y1}set y(e){const t=this.window.getViewBox();t.translate(0,e-t.y1),this.window.setViewBox(t)}get width(){return this.window.width}set width(e){this.resize(e,this.height)}get viewWidth(){return this.window.getViewBox().width()}set viewWidth(e){this.resizeView(e,this.viewHeight)}get viewHeight(){return this.window.getViewBox().height()}set viewHeight(e){this.resizeView(this.viewWidth,e)}get height(){return this.window.height}set height(e){this.resize(this.width,e)}get dpr(){return this.window.dpr}set dpr(e){this.setDpr(e)}get background(){var e;return(e=this._background)!==null&&e!==void 0?e:Jp.BACKGROUND}set background(e){this._background=e}get defaultLayer(){return this.at(0)}get eventSystem(){return this._eventSystem}constructor(e={}){var t;super({}),this.tickedBeforeRender=!0,this._onVisibleChange=i=>{if(!(this._skipRender<0))if(i){if(this.dirtyBounds){const r=this.window.getViewBox();this.dirtyBounds.setValue(r.x1,r.y1,r.width(),r.height())}this._skipRender>1&&this.renderNextFrame(),this._skipRender=0}else this._skipRender=1},this.beforeRender=i=>{this._beforeRender&&this._beforeRender(i)},this.afterRender=i=>{this.renderCount++,this._afterRender&&this._afterRender(i),this._afterNextRenderCbs&&this._afterNextRenderCbs.forEach(r=>r(i)),this._afterNextRenderCbs=null,this.tickedBeforeRender=!1},this.afterTickCb=()=>{var i;this.tickedBeforeRender=!0,((i=this.params.optimize)===null||i===void 0?void 0:i.tickRenderMode)==="performance"||this.state!=="rendering"&&this.render()},this.params=e,this.theme=new ks,this.hooks={beforeRender:new Xt(["stage"]),afterRender:new Xt(["stage"])},this.global=U.global,!this.global.env&&Vf()&&this.global.setEnv("browser"),this.window=Ce.get(Hs),this.renderService=Ce.get(D0),this.pluginService=Ce.get(U0),this.layerService=Ce.get(kf),this.pluginService.active(this,e),this.window.create({width:e.width,height:e.height,viewBox:e.viewBox,container:e.container,dpr:e.dpr||this.global.devicePixelRatio,canvasControled:e.canvasControled!==!1,title:e.title||"",canvas:e.canvas}),this.state="normal",this.renderCount=0,this.tryInitEventSystem(),this._background=(t=e.background)!==null&&t!==void 0?t:Jp.BACKGROUND,this.appendChild(this.layerService.createLayer(this,{main:!0})),this.nextFrameRenderLayerSet=new Set,this.willNextFrameRender=!1,this.stage=this,this.renderStyle=e.renderStyle,e.autoRender&&this.enableAutoRender(),e.autoRefresh&&this.enableAutoRefresh(),e.disableDirtyBounds===!1&&this.enableDirtyBounds(),e.enableHtmlAttribute&&this.enableHtmlAttribute(e.enableHtmlAttribute),e.ReactDOM&&this.enableReactAttribute(e.ReactDOM),e.enableLayout&&this.enableLayout(),this.hooks.beforeRender.tap("constructor",this.beforeRender),this.hooks.afterRender.tap("constructor",this.afterRender),this._beforeRender=e.beforeRender,this._afterRender=e.afterRender,this.ticker=e.ticker||Nf,this.supportInteractiveLayer=e.interactiveLayer!==!1,this.timeline=new Bf,this.ticker.addTimeline(this.timeline),this.timeline.pause(),e.optimize||(e.optimize={}),this.optmize(e.optimize),e.background&&je(this._background)&&this._background.includes("/")&&this.setAttributes({background:this._background}),this.ticker.on("afterTick",this.afterTickCb)}pauseRender(e=-1){this._skipRender=e}resumeRender(){this._skipRender=0}tryInitEventSystem(){this.global.supportEvent&&!this._eventSystem&&(this._eventSystem=new uS(Object.assign({targetElement:this.window,resolution:this.window.dpr||this.global.devicePixelRatio,rootNode:this,global:this.global,supportsPointerEvents:this.params.supportsPointerEvents,supportsTouchEvents:this.params.supportsTouchEvents},this.params.event)))}preventRender(e){e?this._skipRender=-1/0:this.params.optimize.skipRenderWithOutRange!==!1?this._skipRender=this.window.isVisible()?0:1:this._skipRender=0}optmize(e){this.optmizeRender(e.skipRenderWithOutRange),this.params.optimize=e}optmizeRender(e=!1){e&&(this._skipRender=this._skipRender<0?this._skipRender:this.window.isVisible()?0:1,this.window.onVisibleChange(this._onVisibleChange))}getTimeline(){return this.timeline}get3dOptions(e){const{center:t={x:this.width/2,y:this.height/2,z:0,dx:0,dy:0,dz:0},light:i={},alpha:r=0,beta:o=0,camera:s,fieldRatio:l=1,fieldDepth:a}=e;return Object.assign(Object.assign({},e),{center:t,light:i,alpha:r,beta:o,camera:s,fieldRatio:l,fieldDepth:a})}set3dOptions(e){var t,i,r,o,s,l;this.option3d=e;const a=this.get3dOptions(e),{light:d,center:u,camera:h,alpha:c,beta:g,fieldRatio:f,fieldDepth:p}=a,{dir:m=[1,1,-1],color:b="white",ambient:C}=d,_=((t=u.x)!==null&&t!==void 0?t:this.width/2)+((i=u.dx)!==null&&i!==void 0?i:0),w=((r=u.y)!==null&&r!==void 0?r:this.height/2)+((o=u.dy)!==null&&o!==void 0?o:0),y=[_,w,((s=u.z)!==null&&s!==void 0?s:0)+((l=u.dz)!==null&&l!==void 0?l:0)];let v=0,x=0,S=0;h||(v=Math.sin(c)+_,x=Math.sin(g)+w,S=Math.cos(c)*Math.cos(g)*1);const R=Ni.getPlugin("DirectionalLight");R&&(this.light=new R(m,b,C));const B={left:0,right:this.width,top:0,bottom:this.height,fieldRatio:f,fieldDepth:p,viewParams:{pos:[v,x,S],center:y,up:[0,1,0]}};if(this.camera)this.camera.params=B;else{const A=Ni.getPlugin("OrthoCamera");A&&(this.camera=new A(B))}e.enableView3dTransform&&this.enableView3dTransform()}setBeforeRender(e){this._beforeRender=e}setAfterRender(e){this._afterRender=e}afterNextRender(e){this._afterNextRenderCbs||(this._afterNextRenderCbs=[]),this._afterNextRenderCbs.push(e)}enableView3dTransform(){if(this.view3dTranform)return;this.view3dTranform=!0;const e=Ni.getPlugin("ViewTransform3dPlugin");e&&this.pluginService.register(new e)}disableView3dTranform(){this.view3dTranform&&(this.view3dTranform=!1,this.pluginService.findPluginsByName("ViewTransform3dPlugin").forEach(e=>{this.pluginService.unRegister(e)}))}enableAutoRender(){this.autoRender||(this.autoRender=!0,this.pluginService.register(new JA))}disableAutoRender(){this.autoRender&&(this.autoRender=!1,this.pluginService.findPluginsByName("AutoRenderPlugin").forEach(e=>{this.pluginService.unRegister(e)}))}enableAutoRefresh(){this.autoRefresh||(this.autoRefresh=!0,this.pluginService.register(new QA))}disableAutoRefresh(){this.autoRefresh&&(this.autoRefresh=!1,this.pluginService.findPluginsByName("AutoRefreshPlugin").forEach(e=>{this.pluginService.unRegister(e)}))}enableIncrementalAutoRender(){this.increaseAutoRender||(this.increaseAutoRender=!0,this.pluginService.register(new eB))}disableIncrementalAutoRender(){this.increaseAutoRender&&(this.increaseAutoRender=!1,this.pluginService.findPluginsByName("IncrementalAutoRenderPlugin").forEach(e=>{this.pluginService.unRegister(e)}))}enableDirtyBounds(){if(this.dirtyBounds)return;this.dirtyBounds=new Ri;let e=this.pluginService.findPluginsByName("DirtyBoundsPlugin")[0];e?e.activate(this.pluginService):(e=new tB,this.pluginService.register(e))}disableDirtyBounds(){this.dirtyBounds&&(this.dirtyBounds=null,this.pluginService.findPluginsByName("DirtyBoundsPlugin").forEach(e=>{this.pluginService.unRegister(e)}))}enableLayout(){if(this._enableLayout)return;this._enableLayout=!0;const e=Ni.getPlugin("FlexLayoutPlugin");e&&this.pluginService.register(new e)}disableLayout(){this._enableLayout&&(this._enableLayout=!1,this.pluginService.findPluginsByName("FlexLayoutPlugin").forEach(e=>{this.pluginService.unRegister(e)}))}enableHtmlAttribute(e){if(this.htmlAttribute)return;const t=Ni.getPlugin("HtmlAttributePlugin");t&&(this.htmlAttribute=e,this.pluginService.register(new t))}disableHtmlAttribute(){this.htmlAttribute&&(this.htmlAttribute=!1,this.pluginService.findPluginsByName("HtmlAttributePlugin").forEach(e=>{this.pluginService.unRegister(e)}))}enableReactAttribute(e){if(this.reactAttribute)return;const t=Ni.getPlugin("ReactAttributePlugin");t&&(this.reactAttribute=e,this.pluginService.register(new t))}disableReactAttribute(){this.reactAttribute&&(this.reactAttribute=!1,this.pluginService.findPluginsByName("ReactAttributePlugin").forEach(e=>{this.pluginService.unRegister(e)}))}getPluginsByName(e){return this.pluginService.findPluginsByName(e)}tryUpdateAABBBounds(){const e=this.window.getViewBox();return this._AABBBounds.setValue(e.x1,e.y1,e.x2,e.y2),this._AABBBounds}combineLayer(e,t){throw new Error("暂不支持")}createLayer(e,t){if(this.releaseStatus==="released")return;const i=this.layerService.createLayer(this,{main:!1,layerMode:t,canvasId:e});return this.appendChild(i),i}sortLayer(e){const t=this.children;t.sort(e),this.removeAllChild(),t.forEach(i=>{this.appendChild(i)})}removeLayer(e){return this.removeChild(this.findChildByUid(e))}tryInitInteractiveLayer(){this.releaseStatus!=="released"&&this.supportInteractiveLayer&&!this.interactiveLayer&&(this.interactiveLayer=this.createLayer(),this.interactiveLayer.name="_builtin_interactive",this.interactiveLayer.attribute.pickable=!1,this.nextFrameRenderLayerSet.add(this.interactiveLayer))}clearViewBox(e){this.window.clearViewBox(e)}render(e,t){if(this.releaseStatus==="released")return;this.ticker.start(),this.timeline.resume();const i=this.state;this.state="rendering",this.tickedBeforeRender||this.ticker.trySyncTickStatus(),this.layerService.prepareStageLayer(this),this._skipRender||(this.lastRenderparams=t,this.hooks.beforeRender.call(this),this._skipRender||(this.renderLayerList(this.children),this.combineLayersToWindow(),this.nextFrameRenderLayerSet.clear()),this.hooks.afterRender.call(this)),this.state=i,this._skipRender&&this._skipRender++}combineLayersToWindow(){if(this.global.env==="harmony"){const e=this.window.getContext().nativeContext;this.forEachChildren((t,i)=>{if(i>0){const r=t.getNativeHandler().getContext().canvas.nativeCanvas.nativeCanvas._c.transferToImageBitmap();e.transferFromImageBitmap(r)}})}}renderNextFrame(e,t){this.nextFrameRenderLayerSet.size!==this.childrenCount&&(e||this).forEach(i=>{this.nextFrameRenderLayerSet.add(i)}),this.willNextFrameRender||(this.willNextFrameRender=!0,this.global.getRequestAnimationFrame()(()=>{this._doRenderInThisFrame(),this.willNextFrameRender=!1}))}_doRenderInThisFrame(){if(this.releaseStatus==="released")return;this.timeline.resume(),this.ticker.start();const e=this.state;this.state="rendering",this.layerService.prepareStageLayer(this),this.nextFrameRenderLayerSet.size&&!this._skipRender&&(this.hooks.beforeRender.call(this),this._skipRender||(this.renderLayerList(Array.from(this.nextFrameRenderLayerSet.values()),this.lastRenderparams||{}),this.combineLayersToWindow(),this.nextFrameRenderLayerSet.clear()),this.hooks.afterRender.call(this)),this.state=e,this._skipRender&&this._skipRender++}renderLayerList(e,t){const i=[];for(let r=0;r<e.length;r++){let o=e[r];o.layerMode==="virtual"&&(o=o.getNativeHandler().mainHandler.layer),i.includes(o)||i.push(o)}i.forEach(r=>{r.renderCount>this.renderCount||(r.renderCount=this.renderCount+1,r===this.interactiveLayer&&this.dirtyBounds&&this.dirtyBounds.clear(),r.render({renderService:this.renderService,background:r===this.defaultLayer?this.background:void 0,updateBounds:!(!this.dirtyBounds||this.dirtyBounds.empty()),viewBox:this.window.getViewBox(),transMatrix:this.window.getViewBoxTransform()},Object.assign({renderStyle:this.renderStyle},t)))}),this.interactiveLayer&&!e.includes(this.interactiveLayer)&&(this.dirtyBounds&&this.dirtyBounds.clear(),this.interactiveLayer.render({renderService:this.renderService,updateBounds:!(!this.dirtyBounds||this.dirtyBounds.empty()),viewBox:this.window.getViewBox(),transMatrix:this.window.getViewBoxTransform()},Object.assign({renderStyle:this.renderStyle},t)))}resizeWindow(e,t,i=!0){this.window.resize(e,t),i&&this.render()}resize(e,t,i=!0){this.releaseStatus!=="released"&&(this.window.hasSubView()||this.viewBox.setValue(this.viewBox.x1,this.viewBox.y1,this.viewBox.x1+e,this.viewBox.y1+t),this.window.resize(e,t),this.forEachChildren(r=>{r.resize(e,t)}),this.camera&&this.option3d&&this.set3dOptions(this.option3d),i&&this.render())}resizeView(e,t,i=!0){this.releaseStatus!=="released"&&(this.viewBox.setValue(this.viewBox.x1,this.viewBox.y1,this.viewBox.x1+e,this.viewBox.y1+t),this.forEachChildren(r=>{r.resizeView(e,t)}),this.camera&&(this.camera.params=Object.assign(Object.assign({},this.camera.params),{right:this.width,bottom:this.height})),i&&this.render())}setViewBox(e,t,i,r,o){let s=!0;typeof e=="object"?(this.viewBox.setValue(e.x1,e.y1,e.x2,e.y2),t===!1&&(s=!1)):(this.viewBox.setValue(e,t,e+i,t+r),o===!1&&(s=!1)),this.forEachChildren(l=>{l.resizeView(this.viewBox.width(),this.viewBox.height())}),s&&this.render()}setDpr(e,t=!0){this.forEachChildren(i=>{i.setDpr(e)}),t&&this.render()}setOrigin(e,t){throw new Error("暂不支持")}export(e){throw new Error("暂不支持")}pick(e,t){if(this.releaseStatus==="released")return;const i=this.getPickerService().pick(this.children,new St(e,t),{bounds:this.AABBBounds});return!(!(i!=null&&i.graphic)&&!(i!=null&&i.group))&&i}startAnimate(e){throw new Error("暂不支持")}setToFrame(e){throw new Error("暂不支持")}release(){super.release(),this.hooks.beforeRender.unTap("constructor",this.beforeRender),this.hooks.afterRender.unTap("constructor",this.afterRender),this.eventSystem&&this.eventSystem.release(),this.layerService.releaseStage(this),this.pluginService.release(),this.forEach(e=>{e.release()}),this.interactiveLayer&&(this.interactiveLayer.forEachChildren(e=>{e.setStage&&e.setStage(null,null),this.interactiveLayer.removeChild(e)}),this.interactiveLayer.release()),this.window.release(),this.ticker.remTimeline(this.timeline),this.ticker.removeListener("afterTick",this.afterTickCb),this.renderService.renderTreeRoots=[]}setStage(e){}dirty(e,t){this.releaseStatus!=="released"&&(t&&e.transformWithMatrix(t),this.dirtyBounds.empty()&&this.dirtyBounds.setValue(e.x1,e.y1,e.x2,e.y2),this.dirtyBounds.union(e))}getLayer(e){return this.children.filter(t=>t.name===e)[0]}renderTo(e){this.releaseStatus!=="released"&&this.forEachChildren((t,i)=>{t.drawTo(e,{renderService:this.renderService,viewBox:e.getViewBox(),transMatrix:e.getViewBoxTransform(),background:t===this.defaultLayer?this.background:void 0,clear:i===0,updateBounds:!(!this.dirtyBounds||this.dirtyBounds.empty())})})}renderToNewWindow(e=!0,t){if(this.releaseStatus==="released")return;const i=Ce.get(Hs),r=t?-t.x1:0,o=t?-t.y1:0,s=t?t.x2:this.viewWidth,l=t?t.y2:this.viewHeight,a=t?t.width():this.viewWidth,d=t?t.height():this.viewHeight;return i.create({viewBox:{x1:r,y1:o,x2:s,y2:l},width:a,height:d,dpr:this.window.dpr,canvasControled:!0,offscreen:!0,title:""}),this.renderTo(i),i}toCanvas(e=!0,t){if(this.releaseStatus==="released")return;const i=this.renderToNewWindow(e,t).getNativeHandler();return i.nativeCanvas?i.nativeCanvas:null}setCursor(e){this._cursor=e,this.eventSystem.setCursor(e,"ignore")}getCursor(){return this._cursor}eventPointTransform(e){const t=this.global.mapToCanvasPoint(e,this.window.getContext().canvas.nativeCanvas);return this.stage.window.pointTransform(t.x,t.y)}pauseTriggerEvent(){this._eventSystem&&this._eventSystem.pauseTriggerEvent()}resumeTriggerEvent(){this._eventSystem&&this._eventSystem.resumeTriggerEvent()}getPickerService(){return this.pickerService||(this.pickerService=Ce.get(co)),this.pickerService}}function rB(n){return new iB(n)}const Gu={WIDTH:500,HEIGHT:500,DPR:1};class Gf{get displayWidth(){return this._pixelWidth/this._dpr}get displayHeight(){return this._pixelHeight/this._dpr}get id(){return this._id}get x(){return this._x}set x(e){this._x=e}get y(){return this._y}set y(e){this._y=e}get nativeCanvas(){return this._nativeCanvas}get width(){return this._pixelWidth}set width(e){this._pixelWidth=e,this._displayWidth=e/(this._dpr||1)}get height(){return this._pixelHeight}set height(e){this._pixelHeight=e,this._displayHeight=e/(this._dpr||1)}getContext(e){return this._context}get visiable(){return this._visiable}set visiable(e){this._visiable=e,e?this.show():this.hide()}get dpr(){return this._dpr}set dpr(e){this._dpr=e,this.resize(this._displayWidth,this._displayHeight)}constructor(e){var t;const{nativeCanvas:i,width:r=Gu.WIDTH,height:o=Gu.HEIGHT,dpr:s=Gu.DPR,x:l,y:a,id:d,canvasControled:u=!0}=e;this._x=l??0,this._y=a??0,this._pixelWidth=r*s,this._pixelHeight=o*s,this._visiable=e.visiable!==!1,this.controled=u,this._displayWidth=r,this._displayHeight=o,this._dpr=s,this._nativeCanvas=i,this._id=(t=i.id)!==null&&t!==void 0?t:d,d&&(i.id=d),this.init(e)}getNativeCanvas(){return this._nativeCanvas}hide(){}show(){}applyPosition(){}resetStyle(e){}resize(e,t){}toDataURL(e,t){return""}readPixels(e,t,i,r){return this._context.getImageData(e,t,i,r)}convertToBlob(e){throw new Error("暂未实现")}transferToImageBitmap(){throw new Error("暂未实现")}release(...e){this.controled&&this._nativeCanvas.parentElement&&this._nativeCanvas.parentElement.removeChild(this._nativeCanvas)}}Gf.env="browser";var oB=function(n,e,t,i){var r,o=arguments.length,s=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,e,t,i);else for(var l=n.length-1;l>=0;l--)(r=n[l])&&(s=(o<3?r(s):o>3?r(e,t,s):r(e,t))||s);return o>3&&s&&Object.defineProperty(e,t,s),s},sB=function(n,e,t,i){return new(t||(t=Promise))(function(r,o){function s(d){try{a(i.next(d))}catch(u){o(u)}}function l(d){try{a(i.throw(d))}catch(u){o(u)}}function a(d){var u;d.done?r(d.value):(u=d.value,u instanceof t?u:new t(function(h){h(u)})).then(s,l)}a((i=i.apply(n,e||[])).next())})};let Oa=class{configure(n,...e){n.env===this.type&&n.setActiveEnvContribution(this)}getNativeAABBBounds(n){return new Ue}removeDom(n){return!1}createDom(n){return null}updateDom(n,e){return!1}getDynamicCanvasCount(){return 999}getStaticCanvasCount(){return 999}getElementById(n){return document.getElementById(n)}getRootElement(){return document.body}loadJson(n){const e=fetch(n).then(t=>t.json());return e.then(t=>({data:t,state:"success"})).catch(()=>({data:null,state:"fail"})),e}loadArrayBuffer(n){return fetch(n).then(e=>e.arrayBuffer()).then(e=>({data:e,loadState:"success"})).catch(()=>({data:null,loadState:"fail"}))}loadBlob(n){return fetch(n).then(e=>e.blob()).then(e=>({data:e,loadState:"success"})).catch(()=>({data:null,loadState:"fail"}))}getElementTop(n,e){return 0}getElementLeft(n,e){return 0}getElementTopLeft(n,e){return{top:0,left:0}}loadFont(n,e,t){return sB(this,void 0,void 0,function*(){return{loadState:"fail"}})}};Oa=oB([se()],Oa);var lB=function(n,e,t,i){var r,o=arguments.length,s=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,e,t,i);else for(var l=n.length-1;l>=0;l--)(r=n[l])&&(s=(o<3?r(s):o>3?r(e,t,s):r(e,t))||s);return o>3&&s&&Object.defineProperty(e,t,s),s},aB=function(n,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,e)};let Da=class{constructor(){this._uid=pt.GenAutoIncrementId(),this.viewBox=new Ue,this.modelMatrix=new Ht(1,0,0,1,0,0)}onChange(n){this._onChangeCb=n}configure(n,e){e.env===this.type&&n.setWindowHandler(this)}release(...n){this.releaseWindow()}isVisible(n){return!0}onVisibleChange(n){}getTopLeft(n){return{top:0,left:0}}setViewBox(n){this.viewBox.setValue(n.x1,n.y1,n.x2,n.y2)}getViewBox(){return this.viewBox}setViewBoxTransform(n,e,t,i,r,o){this.modelMatrix.setValue(n,e,t,i,r,o)}getViewBoxTransform(){return this.modelMatrix}};Da=lB([se(),aB("design:paramtypes",[])],Da);var dB=function(n,e,t,i){var r,o=arguments.length,s=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,e,t,i);else for(var l=n.length-1;l>=0;l--)(r=n[l])&&(s=(o<3?r(s):o>3?r(e,t,s):r(e,t))||s);return o>3&&s&&Object.defineProperty(e,t,s),s},uB=function(n,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,e)},Qp=function(n,e){return function(t,i){e(t,i,n)}};let hc=class{constructor(n){this.pickItemInterceptorContributions=n,this.type="default",this.global=U.global}_init(){this.InterceptorContributions=this.pickItemInterceptorContributions.getContributions().sort((n,e)=>n.order-e.order)}pick(n,e,t){let i={graphic:null,group:null};t.pickerService=this;const r=t.bounds.width(),o=t.bounds.height();if(!new Ue().setValue(0,0,r,o).containsPoint(e))return i;this.pickContext&&(this.pickContext.inuse=!0),t.pickContext=this.pickContext,this.pickContext&&this.pickContext.clearMatrix(!0,1);const s=new Ht(1,0,0,1,0,0);let l;for(let a=n.length-1;a>=0&&(i=n[a].isContainer?this.pickGroup(n[a],e,s,t):this.pickItem(n[a],e,s,t),!i.graphic);a--)l||(l=i.group);if(i.graphic||(i.group=l),this.pickContext&&(this.pickContext.inuse=!1),i.graphic){let a=i.graphic;for(;a.parent;)a=a.parent;a.shadowHost&&(i.params={shadowTarget:i.graphic},i.graphic=a.shadowHost)}return i}containsPoint(n,e,t){var i;return!!(!((i=this.pickItem(n,e,null,t??{pickContext:this.pickContext,pickerService:this}))===null||i===void 0)&&i.graphic)}pickGroup(n,e,t,i){let r={group:null,graphic:null};if(n.attribute.visibleAll===!1)return r;const o=i.pickContext,s=o.modelMatrix;if(o.camera){const g=n.transMatrix,f=ft.allocate();if(Gh(f,g),s){if(f){const p=ft.allocate();o.modelMatrix=ol(p,s,f),ft.free(f)}}else Gh(f,n.globalTransMatrix),o.modelMatrix=f}if(this.InterceptorContributions.length)for(let g=0;g<this.InterceptorContributions.length;g++){const f=this.InterceptorContributions[g];if(f.beforePickItem){const p=f.beforePickItem(n,this,e,i,{parentMatrix:t});if(p)return o.modelMatrix!==s&&ft.free(o.modelMatrix),o.modelMatrix=s,p}}const l=n.transMatrix,a=Zt.allocateByObj(t),d=new St(e.x,e.y);a.transformPoint(d,d);const u=n.AABBBounds.containsPoint(d);if(!u&&!n.stage.camera)return r;const h=this.pickItem(n,d.clone(),t,i);h&&h.graphic&&(r.graphic=h.graphic,r.params=h.params);const c=n.attribute.pickable!==!1&&u;return a.multiply(l.a,l.b,l.c,l.d,l.e,l.f),n.attribute.childrenPickable===!1||h&&h.graphic||K0(n,ot.zIndex,g=>{if(g.isContainer){const f=new St(e.x,e.y),p=ve(n).group,{scrollX:m=p.scrollX,scrollY:b=p.scrollY}=n.attribute;f.x-=m,f.y-=b,r=this.pickGroup(g,f,a,i)}else{const f=new St(e.x,e.y);a.transformPoint(f,f);const p=ve(n).group,{scrollX:m=p.scrollX,scrollY:b=p.scrollY}=n.attribute;f.x-=m,f.y-=b;const C=this.pickItem(g,f,t,i);C&&C.graphic&&(r.graphic=C.graphic,r.params=C.params)}return!!r.graphic||!!r.group},!0,!!o.camera),o.modelMatrix!==s&&ft.free(o.modelMatrix),o.modelMatrix=s,r.graphic||r.group||!c||n.stage.camera||(r.group=n),Zt.free(a),r}selectPicker(n){return this.pickerMap.get(n.numberType)||null}};hc=dB([se(),Qp(0,Be(gt)),Qp(0,At(io)),uB("design:paramtypes",[Object])],hc);let em=!1;const hB=new we(n=>{em||(em=!0,n(ba).toSelf().inSingletonScope(),n(xa).to(ba).inSingletonScope(),n($t).toService(xa),n(Oh).toService(Dn),Dt(n,Oh))});let tm=!1;const cB=new we(n=>{tm||(tm=!0,n(ya).toSelf().inSingletonScope(),n(Ta).to(ya).inSingletonScope(),n($t).toService(Ta),n(Ro).toSelf(),n(xo).toSelf(),n(vr).toService(Ro),n(vr).toService(xo),n(vr).toService(Dn),Dt(n,vr))});let nm=!1;const fB=new we(n=>{nm||(nm=!0,n(Ls).toSelf().inSingletonScope(),n(Ia).toSelf().inSingletonScope(),n(Aa).to(Ls).inSingletonScope(),n($t).toService(Aa))});let im=!1;const gB=new we(n=>{im||(im=!0,n(va).toSelf().inSingletonScope(),n(Pa).to(va).inSingletonScope(),n($t).toService(Pa),n(Vh).toService(Dn),Dt(n,Vh))});let rm=!1;const pB=new we(n=>{rm||(rm=!0,n(Ca).toSelf().inSingletonScope(),n(Ra).to(Ca).inSingletonScope(),n($t).toService(Ra),n(Dh).toService(Dn),Dt(n,Dh))});let om=!1;const mB=new we(n=>{om||(om=!0,n(Zh).to(Kh).inSingletonScope(),n($t).toService(Zh),n(ma).toService(Dn),Dt(n,ma))});let sm=!1;const bB=new we(n=>{sm||(sm=!0,n(wa).toSelf().inSingletonScope(),n(Ba).to(wa).inSingletonScope(),n($t).toService(Ba),n(Wh).toService(Dn),Dt(n,Wh))});let lm=!1;const CB=new we(n=>{lm||(lm=!0,n(Ma).to(Yh).inSingletonScope(),n($t).toService(Ma),n(Nh).toService(Dn),Dt(n,Nh))});var _B=function(n,e,t,i){var r,o=arguments.length,s=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,e,t,i);else for(var l=n.length-1;l>=0;l--)(r=n[l])&&(s=(o<3?r(s):o>3?r(e,t,s):r(e,t))||s);return o>3&&s&&Object.defineProperty(e,t,s),s},wB=function(n,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,e)};let cc=class extends tn{constructor(){super(),this.numberType=Hf,this.builtinContributions=[F0],this.init()}drawShape(n,e,t,i,r){const o=ve(n).richtext,{strokeOpacity:s=o.strokeOpacity,opacity:l=o.opacity,fillOpacity:a=o.fillOpacity,visible:d=o.visible}=n.attribute;if(!n.valid||!d)return;const u=Pr(l,a,!0),h=Pr(l,s,!0);u&&(e.setShadowBlendStyle&&e.setShadowBlendStyle(n,n.attribute,o),e.translate(t,i),this.beforeRenderStep(n,e,t,i,u,h,u,h,o,r),n.getFrameCache().draw(e,this.drawIcon),this.afterRenderStep(n,e,t,i,u,h,u,h,o,r))}drawIcon(n,e,t,i,r){var o;const s=ve(n).richtextIcon,{width:l=s.width,height:a=s.height,opacity:d=s.opacity,image:u,backgroundFill:h=s.backgroundFill,backgroundFillOpacity:c=s.backgroundFillOpacity,backgroundStroke:g=s.backgroundStroke,backgroundStrokeOpacity:f=s.backgroundStrokeOpacity,backgroundRadius:p=s.backgroundRadius,margin:m}=n.attribute,{backgroundWidth:b=l,backgroundHeight:C=a}=n.attribute;if(m&&(t+=n._marginArray[3],i+=n._marginArray[0]),n._hovered){const w=(b-l)/2,y=(C-a)/2;p===0?(e.beginPath(),e.rect(t-w,i-y,b,C)):(e.beginPath(),ni(e,t-w,i-y,b,C,p)),h&&(e.globalAlpha=c,e.fillStyle=h,e.fill()),g&&(e.globalAlpha=f,e.strokeStyle=g,e.stroke())}const _=u&&((o=n==null?void 0:n.resources)===null||o===void 0?void 0:o.get(u));_&&_.state==="success"&&(e.globalAlpha=d,e.drawImage(_.data,t,i,l,a))}draw(n,e,t){const i=ve(n).richtext;this._draw(n,i,!1,t)}};cc=_B([se(),wB("design:paramtypes",[])],cc);let am=!1;const yB=new we(n=>{am||(am=!0,n(Jh).to(cc).inSingletonScope(),n($t).toService(Jh))});let dm=!1;const vB=new we(n=>{dm||(dm=!0,n(cp).to(qh).inSingletonScope(),n($t).toService(cp),n(yr).toService(Dn),Dt(n,yr))});function SB(){ge.RegisterGraphicCreator("arc",Df)}function xB(){ge.RegisterGraphicCreator("circle",W0)}function RB(){ge.RegisterGraphicCreator("group",pa)}function AB(){ge.RegisterGraphicCreator("image",au)}function BB(){ge.RegisterGraphicCreator("line",un)}function MB(){ge.RegisterGraphicCreator("path",SA)}function TB(){ge.RegisterGraphicCreator("polygon",xA)}function PB(){ge.RegisterGraphicCreator("rect",Ze)}function HB(){ge.RegisterGraphicCreator("richtext",vA)}function kB(){ge.RegisterGraphicCreator("symbol",zs)}function EB(){ge.RegisterGraphicCreator("text",tc)}function LB(){ge.RegisterGraphicCreator("shadowRoot",AA)}function FB(){ge.RegisterGraphicCreator("wrapText",CR)}const um=new Ue;class zB{constructor(){this.name="FlexLayoutPlugin",this.activeEvent="onRegister",this.id=pt.GenAutoIncrementId(),this.key=this.name+this.id,this.tempBounds=new Ue}pauseLayout(e){this.pause=e}tryLayoutChildren(e){e.firstChild&&this.tryLayout(e.firstChild)}tryLayout(e,t=!0){if(this.pause)return;const i=e.parent;if(!(t||i&&e.needUpdateLayout()))return;const r=ve(i).group,{display:o=r.display}=i.attribute;if(o!=="flex")return;const{flexDirection:s=r.flexDirection,flexWrap:l=r.flexWrap,alignItems:a=r.alignItems,clip:d=r.clip}=i.attribute,{alignContent:u=a??r.alignContent}=i.attribute;let{width:h,height:c,justifyContent:g=r.justifyContent}=i.attribute;const f=i.getChildren();if(h==null||c==null){let S=0,R=0,B=0;if(f.forEach(A=>{const M=this.getAABBBounds(A);M.empty()||(s==="column"||s==="column-reverse"?(R+=M.height(),S=Math.max(S,M.width())):(S+=M.width(),R=Math.max(R,M.height())),B+=M.x1,B+=M.y1,B+=M.x2,B+=M.y2)}),!isFinite(B))return;h=S,c=R}i.attribute.width==null?i.attribute.width=h:h=i.attribute.width,i.attribute.height==null?i.attribute.height=c:c=i.attribute.height,this.tempBounds.copy(i._AABBBounds);const p={main:{len:h,field:"x"},cross:{len:c,field:"y"}},m=p.main,b=p.cross;s!=="column"&&s!=="column-reverse"||(m.len=c,b.len=h,m.field="y",b.field="x"),s!=="row-reverse"&&s!=="column-reverse"||(g==="flex-start"?g="flex-end":g==="flex-end"?g="flex-start":f.reverse());let C=0,_=0;const w=[];f.forEach(S=>{const R=this.getAABBBounds(S);if(R.empty())return;const B=m.field==="x"?R.width():R.height(),A=b.field==="x"?R.width():R.height();w.push({mainLen:B,crossLen:A}),C+=B,_=Math.max(_,A)});const y=[];if(C>m.len&&l==="wrap"){let S=0,R=0;w.forEach(({mainLen:B,crossLen:A},M)=>{S+B>m.len?S===0?(y.push({idx:M,mainLen:S+B,crossLen:A}),S=0,R=0):(y.push({idx:M-1,mainLen:S,crossLen:R}),S=B,R=A):(S+=B,R=Math.max(R,A))}),y.push({idx:w.length-1,mainLen:S,crossLen:R})}else y.push({idx:w.length-1,mainLen:C,crossLen:_});let v=0;if(y.forEach(S=>{this.layoutMain(i,f,g,m,w,v,S),v=S.idx+1}),_=y.reduce((S,R)=>S+R.crossLen,0),y.length===1){const S={"flex-start":0,"flex-end":b.len,center:b.len/2};this.layoutCross(f,a,b,S,w,y[0],0)}else if(u==="flex-start"){v=0;let S=0;y.forEach((R,B)=>{const A={"flex-start":S,"flex-end":S+R.crossLen,center:S+R.crossLen/2};this.layoutCross(f,"flex-start",b,A,w,y[B],v),v=R.idx+1,S+=R.crossLen})}else if(u==="center"){v=0;let S=Math.max(0,(b.len-_)/2);y.forEach((R,B)=>{const A={"flex-start":S,"flex-end":S+R.crossLen,center:S+R.crossLen/2};this.layoutCross(f,"center",b,A,w,y[B],v),v=R.idx+1,S+=R.crossLen})}else if(u==="space-around"){v=0;const S=Math.max(0,(b.len-_)/y.length/2);let R=S;y.forEach((B,A)=>{const M={"flex-start":R,"flex-end":R+B.crossLen,center:R+B.crossLen/2};this.layoutCross(f,"flex-start",b,M,w,y[A],v),v=B.idx+1,R+=B.crossLen+2*S})}else if(u==="space-between"){v=0;const S=Math.max(0,(b.len-_)/(2*y.length-2));let R=0;y.forEach((B,A)=>{const M={"flex-start":R,"flex-end":R+B.crossLen,center:R+B.crossLen/2};this.layoutCross(f,"flex-start",b,M,w,y[A],v),v=B.idx+1,R+=B.crossLen+2*S})}f.forEach((S,R)=>{S.addUpdateBoundTag(),S.addUpdatePositionTag(),S.clearUpdateLayoutTag()}),i.addUpdateLayoutTag();const x=this.getAABBBounds(i);d||this.tempBounds.equals(x)||this.tryLayout(i,!1)}getAABBBounds(e){this.skipBoundsTrigger=!0;const t=e.AABBBounds;return this.skipBoundsTrigger=!1,t}updateChildPos(e,t,i){return e+(t??0)-i}layoutMain(e,t,i,r,o,s,l){if(i==="flex-start"){let a=0;for(let d=s;d<=l.idx;d++){const u=a+Yn(t[d],r.field),h=this.getAABBBounds(t[d]);!h.empty()&&(t[d].attribute[r.field]=this.updateChildPos(u,t[d].attribute[r.field],h[`${r.field}1`])),a+=o[d].mainLen}}else if(i==="flex-end"){let a=r.len;for(let d=l.idx;d>=s;d--){a-=o[d].mainLen;const u=a+Yn(t[d],r.field),h=this.getAABBBounds(t[d]);!h.empty()&&(t[d].attribute[r.field]=this.updateChildPos(u,t[d].attribute[r.field],h[`${r.field}1`]))}}else if(i==="space-around")if(l.mainLen>=r.len){let a=0;for(let d=s;d<=l.idx;d++){const u=a+Yn(t[d],r.field),h=this.getAABBBounds(t[d]);!h.empty()&&(t[d].attribute[r.field]=this.updateChildPos(u,t[d].attribute[r.field],h[`${r.field}1`])),a+=o[d].mainLen}}else{const a=l.idx-s+1,d=(r.len-l.mainLen)/a/2;let u=d;for(let h=s;h<=l.idx;h++){const c=u+Yn(t[h],r.field),g=this.getAABBBounds(t[h]);!g.empty()&&(t[h].attribute[r.field]=this.updateChildPos(c,t[h].attribute[r.field],g[`${r.field}1`])),u+=o[h].mainLen+2*d}}else if(i==="space-between")if(l.mainLen>=r.len){let a=0;for(let d=s;d<=l.idx;d++){const u=a+Yn(t[d],r.field),h=this.getAABBBounds(t[d]);!h.empty()&&(t[d].attribute[r.field]=this.updateChildPos(u,t[d].attribute[r.field],h[`${r.field}1`])),a+=o[d].mainLen}}else{const a=l.idx-s+1,d=(r.len-l.mainLen)/(2*a-2);let u=0;for(let h=s;h<=l.idx;h++){const c=u+Yn(t[h],r.field),g=this.getAABBBounds(t[h]);!g.empty()&&(t[h].attribute[r.field]=this.updateChildPos(c,t[h].attribute[r.field],g[`${r.field}1`])),u+=o[h].mainLen+2*d}}else if(i==="center"){let a=(r.len-l.mainLen)/2;for(let d=s;d<=l.idx;d++){const u=a+Yn(t[d],r.field),h=this.getAABBBounds(t[d]);!h.empty()&&(t[d].attribute[r.field]=this.updateChildPos(u,t[d].attribute[r.field],h[`${r.field}1`])),a+=o[d].mainLen}}}layoutCross(e,t,i,r,o,s,l){var a;for(let d=l;d<=s.idx;d++){const u=e[d];let{alignSelf:h}=u.attribute;h&&h!=="auto"||(h=t);const c=this.getAABBBounds(u),g=(a=r[h])!==null&&a!==void 0?a:r["flex-start"];h==="flex-end"?!c.empty()&&(u.attribute[i.field]=this.updateChildPos(g-o[d].crossLen+Yn(u,i.field),u.attribute[i.field],c[`${i.field}1`])):h==="center"?!c.empty()&&(u.attribute[i.field]=this.updateChildPos(g-o[d].crossLen/2+Yn(u,i.field),u.attribute[i.field],c[`${i.field}1`])):!c.empty()&&(u.attribute[i.field]=this.updateChildPos(g+Yn(u,i.field),u.attribute[i.field],c[`${i.field}1`]))}}activate(e){this.pluginService=e,U.graphicService.hooks.onAttributeUpdate.tap(this.key,t=>{t.glyphHost&&(t=t.glyphHost),t.stage&&t.stage===this.pluginService.stage&&this.tryLayout(t,!1)}),U.graphicService.hooks.beforeUpdateAABBBounds.tap(this.key,(t,i,r,o)=>{t.glyphHost&&(t=t.glyphHost),i&&i===this.pluginService.stage&&t.isContainer&&!this.skipBoundsTrigger&&um.copy(o)}),U.graphicService.hooks.afterUpdateAABBBounds.tap(this.key,(t,i,r,o,s)=>{i&&i===this.pluginService.stage&&t.isContainer&&!this.skipBoundsTrigger&&(um.equals(r)||this.tryLayout(t,!1))}),U.graphicService.hooks.onSetStage.tap(this.key,t=>{t.glyphHost&&(t=t.glyphHost),this.tryLayout(t,!1)})}deactivate(e){U.graphicService.hooks.onAttributeUpdate.taps=U.graphicService.hooks.onAttributeUpdate.taps.filter(t=>t.name!==this.key),U.graphicService.hooks.beforeUpdateAABBBounds.taps=U.graphicService.hooks.beforeUpdateAABBBounds.taps.filter(t=>t.name!==this.key),U.graphicService.hooks.afterUpdateAABBBounds.taps=U.graphicService.hooks.afterUpdateAABBBounds.taps.filter(t=>t.name!==this.key),U.graphicService.hooks.onSetStage.taps=U.graphicService.hooks.onSetStage.taps.filter(t=>t.name!==this.key)}}function Yn(n,e){return 0}const hm=()=>{Ni.registerPlugin("FlexLayoutPlugin",zB)},cm=["x","y","dx","dy","scaleX","scaleY","angle","anchor","postMatrix","visible","clip","pickable","childrenPickable","zIndex","cursor"];class gn extends jn{constructor(e,t){super(e),t!=null&&t.mode&&(this.mode=t.mode,this.setMode(t.mode)),t!=null&&t.skipDefault&&(this.skipDefault=!0),this.setTheme({common:{strokeBoundsBuffer:0}}),this.attribute=e,this.onSetStage(()=>{this.render(),this.bindEvents()})}setAttribute(e,t,i,r){const o=this.onBeforeAttributeUpdate&&this.onBeforeAttributeUpdate({[e]:t},this.attribute,e,r);if(o)return this._setAttributes(o,i);Hu(this.attribute[e])&&Hu(t)&&!Ae(this.attribute[e])&&!Ae(t)?re(this.attribute[e],t):this.attribute[e]=t,cm.includes(e)||this.render(),this.valid=this.isValid(),this.updateShapeAndBoundsTagSetted()||!i&&!this.needUpdateTag(e)?this.addUpdateBoundTag():this.addUpdateShapeAndBoundsTag(),this.addUpdatePositionTag(),this.onAttributeUpdate()}setAttributes(e,t,i){return e=this.onBeforeAttributeUpdate&&this.onBeforeAttributeUpdate(e,this.attribute,null,i)||e,this._setAttributes(e,t)}_setAttributes(e,t){const i=Object.keys(e);this._mergeAttributes(e,i),i.every(r=>cm.includes(r))||this.render(),this.valid=this.isValid(),this.updateShapeAndBoundsTagSetted()||!t&&!this.needUpdateTags(i)?this.addUpdateBoundTag():this.addUpdateShapeAndBoundsTag(),this.addUpdatePositionTag(),this.onAttributeUpdate()}_mergeAttributes(e,t){Te(t)&&(t=Object.keys(e));for(let i=0;i<t.length;i++){const r=t[i];!Hu(this.attribute[r])||Ae(this.attribute[r])||Ae(e[r])?this.attribute[r]=e[r]:re(this.attribute[r],e[r])}}bindEvents(){}_getNodeId(e){var t;return`${(t=this.id)!==null&&t!==void 0?t:this._uid}-${this.name}-${e}`}_dispatchEvent(e,t){var i;const r=new Af(e,t);r.manager=(i=this.stage)===null||i===void 0?void 0:i.eventSystem.manager,this.dispatchEvent(r)}}const nr=Symbol.for("MathPickerContribution"),fm=Symbol.for("MathArcPicker"),gm=Symbol.for("MathCirclePicker"),Wa=Symbol.for("MathImagePicker"),pm=Symbol.for("MathLinePicker"),mm=Symbol.for("MathPathPicker"),bm=Symbol.for("MathRectPicker"),Cm=Symbol.for("MathSymbolPicker"),_m=Symbol.for("MathTextPicker"),wm=Symbol.for("MathPolygonPicker"),ym=Symbol.for("CanvasArcPicker"),vm=Symbol.for("CanvasCirclePicker"),Sm=Symbol.for("CanvasImagePicker"),xm=Symbol.for("CanvasLinePicker"),Rm=Symbol.for("CanvasPathPicker"),Am=Symbol.for("CanvasRectPicker"),Bm=Symbol.for("CanvasSymbolPicker"),Mm=Symbol.for("CanvasTextPicker"),Tm=Symbol.for("CanvasPolygonPicker"),Pm=Symbol.for("CanvasRichTextPicker"),Hm=Symbol.for("CanvasGroupPicker"),fn=Symbol.for("CanvasPickerContribution"),IB={onPointerDown:"pointerdown",onPointerUp:"pointerup",onPointerUpOutside:"pointerupoutside",onPointerTap:"pointertap",onPointerOver:"pointerover",onPointerMove:"pointermove",onPointerEnter:"pointerenter",onPointerLeave:"pointerleave",onPointerOut:"pointerout",onMouseDown:"mousedown",onMouseUp:"mouseup",onMouseUpOutside:"mouseupoutside",onMouseMove:"mousemove",onMouseOver:"mouseover",onMouseOut:"mouseout",onMouseEnter:"mouseenter",onMouseLeave:"mouseleave",onPinch:"pinch",onPinchStart:"pinchstart",onPinchEnd:"pinchend",onPan:"pan",onPanStart:"panstart",onPanEnd:"panend",onDrag:"drag",onDragStart:"dragstart",onDragEnter:"dragenter",onDragLeave:"dragleave",onDragOver:"dragover",onDragEnd:"dragend",onRightDown:"rightdown",onRightUp:"rightup",onRightUpOutside:"rightupoutside",onTouchStart:"touchstart",onTouchEnd:"touchend",onTouchEndOutside:"touchendoutside",onTouchMove:"touchmove",onTouchCancel:"touchcancel",onPress:"press",onPressUp:"pressup",onPressEnd:"pressend",onSwipe:"swipe",onDrop:"drop",onWeel:"wheel",onClick:"click",onDblClick:"dblclick"},km=(n,e)=>{const t=e.x-n.x,i=e.y-n.y;return Math.abs(t)>Math.abs(i)?t>0?"right":"left":i>0?"down":"up"},kl=(n,e)=>{const t=Math.abs(e.x-n.x),i=Math.abs(e.y-n.y);return Math.sqrt(t*t+i*i)},OB=n=>{const e=n.length;if(e===1)return{x:Math.round(n[0].x),y:Math.round(n[0].y)};let t=0,i=0,r=0;for(;r<e;)t+=n[r].x,i+=n[r].y,r++;return{x:Math.round(t/e),y:Math.round(i/e)}};class DB extends Lo{constructor(e,t={}){var i,r,o,s,l,a,d,u,h,c;super(),this.cachedEvents=[],this.startPoints=[],this.processEvent={},this.throttleTimer=0,this.emitThrottles=[],this.lastTapTarget=null,this.onStart=g=>{this.cachedEvents=[],this.startPoints=[],this.reset(),this.startTime=wr.now();const{cachedEvents:f,startPoints:p}=this;g&&f.push(g.clone()),p.length=f.length;for(let m=0;m<f.length;m++){const{x:b,y:C}=f[m],_={x:b,y:C};p[m]=_}if(p.length!==1)this.startDistance=kl(p[0],p[1]),this.center=OB([p[0],p[1]]);else{const m=f[0];this.pressTimeout=setTimeout(()=>{m.direction="none",m.deltaX=0,m.deltaY=0,m.points=p,this.triggerStartEvent("press",m),this.triggerEvent("press",m),this.eventType="press",this.direction="none",this.pressTimeout=null},this.config.press.time)}},this.onMove=g=>{this.clearPressTimeout();const{startPoints:f,cachedEvents:p}=this;if(!f.length)return;const m=g.clone(),{x:b,y:C,pointerId:_}=m;for(let R=0,B=p.length;R<B;R++)if(_===p[R].pointerId){p[R]=m;break}const w={x:b,y:C},y=p.map(R=>({x:R.x,y:R.y})),v=wr.now();if(this.prevMoveTime=this.lastMoveTime,this.prevMovePoint=this.lastMovePoint,this.lastMoveTime=v,this.lastMovePoint=w,f.length===1){const R=f[0],B=b-R.x,A=C-R.y,M=this.direction||km(R,w);this.direction=M;const H=this.getEventType(w);return m.direction=M,m.deltaX=B,m.deltaY=A,m.points=y,this.triggerStartEvent(H,m),void this.triggerEvent(H,m)}const{startDistance:x}=this,S=kl(y[0],y[1]);m.scale=S/x,m.center=this.center,m.points=y,this.triggerStartEvent("pinch",m),this.triggerEvent("pinch",m)},this.onEnd=g=>{const f=g.clone(),{cachedEvents:p,startPoints:m}=this,b=p.map(C=>({x:C.x,y:C.y}));if(f.points=b,this.triggerEndEvent(f),p.length===1){const C=wr.now(),_=this.lastMoveTime;if(C-_<100){const w=_-(this.prevMoveTime||this.startTime);if(w>0){const y=this.prevMovePoint||m[0],v=this.lastMovePoint||m[0],x=kl(y,v),S=x/w;if(S>this.config.swipe.velocity&&x>this.config.swipe.threshold)return f.velocity=S,f.direction=km(y,v),this.triggerEvent("swipe",f),this.cachedEvents=[],this.startPoints=[],void this.reset()}}C-this.startTime<this.config.press.time&&(C-this.lastTapTime<this.config.tap.interval&&g.target===this.lastTapTarget?this.tapCount++:this.tapCount=1,this.lastTapTime=C,this.lastTapTarget=g.target,this.tapCount===1?this.triggerEvent("tap",f):this.tapCount===2&&(this.triggerEvent("doubletap",f),this.tapCount=0))}for(let C=0,_=p.length;C<_;C++)if(p[C].pointerId===f.pointerId){p.splice(C,1),m.splice(C,1);break}this.reset(),p.length>0&&this.onStart()},this.element=e,this.tapCount=0,this.lastTapTime=0,this.config={press:{time:(r=(i=t==null?void 0:t.press)===null||i===void 0?void 0:i.time)!==null&&r!==void 0?r:251,threshold:(s=(o=t==null?void 0:t.press)===null||o===void 0?void 0:o.threshold)!==null&&s!==void 0?s:9},swipe:{threshold:(a=(l=t==null?void 0:t.swipe)===null||l===void 0?void 0:l.threshold)!==null&&a!==void 0?a:10,velocity:(u=(d=t==null?void 0:t.swipe)===null||d===void 0?void 0:d.velocity)!==null&&u!==void 0?u:.3},tap:{interval:(c=(h=t==null?void 0:t.tap)===null||h===void 0?void 0:h.interval)!==null&&c!==void 0?c:300}},this.initEvents()}initEvents(){const{element:e}=this;e&&(e.addEventListener("pointerdown",this.onStart),e.addEventListener("pointermove",this.onMove),e.addEventListener("pointerup",this.onEnd),e.addEventListener("pointerupoutside",this.onEnd))}removeEvents(){const{element:e}=this;e&&(e.removeEventListener("pointerdown",this.onStart),e.removeEventListener("pointermove",this.onMove),e.removeEventListener("pointerup",this.onEnd),e.removeEventListener("pointerupoutside",this.onEnd))}release(){this.removeEvents(),this.element=null}getEventType(e){const{eventType:t,startTime:i,startPoints:r}=this;if(t==="press")return t;let o;return o=wr.now()-i>this.config.press.time&&kl(r[0],e)<this.config.press.threshold?"press":"pan",this.eventType=o,o}enable(e){this.processEvent[e]=!0}isProcess(e){return this.processEvent[e]}pushEvent(e,t){const{emitThrottles:i}=this,r={type:e,ev:t};for(let o=0,s=i.length;o<s;o++)if(i[o].type===e)return void i.splice(o,1,r);i.push(r)}clearPressTimeout(){this.pressTimeout&&(clearTimeout(this.pressTimeout),this.pressTimeout=null)}reset(){this.clearPressTimeout(),this.startTime=0,this.startDistance=0,this.direction=null,this.eventType=null,this.prevMoveTime=0,this.prevMovePoint=null,this.lastMoveTime=0,this.lastMovePoint=null}triggerEvent(e,t){this.pushEvent(e,t);const{throttleTimer:i,emitThrottles:r}=this;i||(this.throttleTimer=U.global.getRequestAnimationFrame()(()=>{U.global.getCancelAnimationFrame()(this.throttleTimer),this.throttleTimer=null;for(let o=0,s=r.length;o<s;o++){const{type:l,ev:a}=r[o];this.emitEvent(l,a)}this.emitThrottles.length=0}))}triggerStartEvent(e,t){this.isProcess(e)||(this.enable(e),this.triggerEvent(`${e}start`,t))}triggerEndEvent(e){const t=this.processEvent;Object.keys(t).forEach(i=>{this.triggerEvent(`${i}end`,e),i==="press"&&this.triggerEvent(`${i}up`,e),delete t[i]})}emitEvent(e,t){if(!this.element)return;const i=this.element._events[f0];if(i)if("fn"in i)i.fn.call(i.context,t,e);else for(let r=0,o=i.length;r<o&&!t.propagationImmediatelyStopped;r++)i[r].fn.call(i[r].context,t,e);this.emit(e,t)}}var WB=function(n,e,t,i){var r,o=arguments.length,s=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,e,t,i);else for(var l=n.length-1;l>=0;l--)(r=n[l])&&(s=(o<3?r(s):o>3?r(e,t,s):r(e,t))||s);return o>3&&s&&Object.defineProperty(e,t,s),s},NB=function(n,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,e)};const Se=[0,0,0],VB=(n,e,t,i,r,o,s,l)=>{if(l)for(;t>e;)t-=Ge;else for(;t<e;)t+=Ge;const a=qe/3*(t>e?1:-1);let d=e,u=d;for(;u!==t;){u=a>0?Math.min(u+a,t):Math.max(u+a,t);const h=Math.abs(u-d),c=4*Math.tan(h/4)/3,g=u<d?-1:1,f=Math.cos(d),p=Math.sin(d),m=Math.cos(u),b=Math.sin(u),C=f*o+i,_=p*s+r,w=m*o+i,y=b*s+r,v=o*c*g,x=s*c*g;n.push([C-v*p,_+x*f,w+v*b,y-x*m,w,y]),d=u}};let fo=class{set fillStyle(n){this.nativeContext.fillStyle=n}get fillStyle(){return this.nativeContext.fillStyle}set font(n){this.nativeContext.font=n}get font(){return this.nativeContext.font}set globalAlpha(n){this.nativeContext.globalAlpha=n*this.baseGlobalAlpha}get globalAlpha(){return this.nativeContext.globalAlpha}set lineCap(n){this.nativeContext.lineCap=n}get lineCap(){return this.nativeContext.lineCap}set lineDashOffset(n){this.nativeContext.lineDashOffset=n}get lineDashOffset(){return this.nativeContext.lineDashOffset}set lineJoin(n){this.nativeContext.lineJoin=n}get lineJoin(){return this.nativeContext.lineJoin}set lineWidth(n){this.nativeContext.lineWidth=n}get lineWidth(){return this.nativeContext.lineWidth}set miterLimit(n){this.nativeContext.miterLimit=n}get miterLimit(){return this.nativeContext.miterLimit}set shadowBlur(n){this.nativeContext.shadowBlur=n}get shadowBlur(){return this.nativeContext.shadowBlur}set shadowColor(n){this.nativeContext.shadowColor=n}get shadowColor(){return this.nativeContext.shadowColor}set shadowOffsetX(n){this.nativeContext.shadowOffsetX=n}get shadowOffsetX(){return this.nativeContext.shadowOffsetX}set shadowOffsetY(n){this.nativeContext.shadowOffsetY=n}get shadowOffsetY(){return this.nativeContext.shadowOffsetY}set strokeStyle(n){this.nativeContext.strokeStyle=n}get strokeStyle(){return this.nativeContext.strokeStyle}set textAlign(n){this.nativeContext.textAlign=n}get textAlign(){return this.nativeContext.textAlign}set textBaseline(n){this.nativeContext.textBaseline=n}get textBaseline(){return this.nativeContext.textBaseline}get inuse(){return!!this._inuse}set inuse(n){n!==!!this._inuse&&(this._inuse=n,n?(this.nativeContext.save(),this.reset()):this.nativeContext.restore())}constructor(n,e){this.fillAttributes=Object.assign(Object.assign({},n0),{opacity:1}),this.strokeAttributes=Object.assign(Object.assign({},i0),{opacity:1}),this.textAttributes=Object.assign(Object.assign({},qt),{opacity:1}),this._clearShadowStyle=!1,this._clearFilterStyle=!1,this._clearGlobalCompositeOperationStyle=!1;const t=n.nativeCanvas.getContext("2d");if(!t)throw new Error("发生错误，获取2d上下文失败");this.nativeContext=t,this.canvas=n,this.matrix=new Ht(1,0,0,1,0,0),this.stack=[],this.dpr=e,this.applyedMatrix=new Ht(1,0,0,1,0,0),this._clearMatrix=new Ht(1,0,0,1,0,0),this.baseGlobalAlpha=1}reset(){this.stack.length&&It.getInstance().warn("可能存在bug，matrix没有清空"),this.matrix.setValue(1,0,0,1,0,0),this.applyedMatrix=new Ht(1,0,0,1,0,0),this.stack.length=0,this.nativeContext.setTransform(1,0,0,1,0,0)}getCanvas(){return this.canvas}getContext(){return this.nativeContext}setTransformForCurrent(n=!1){!n&&this.applyedMatrix.equalToMatrix(this.matrix)||(this.applyedMatrix.setValue(this.matrix.a,this.matrix.b,this.matrix.c,this.matrix.d,this.matrix.e,this.matrix.f),this.nativeContext.setTransform(this.matrix.a,this.matrix.b,this.matrix.c,this.matrix.d,this.matrix.e,this.matrix.f))}get currentMatrix(){return this.matrix}cloneMatrix(n){return Zt.allocateByObj(n)}clear(){this.save(),this.resetTransform(),this.nativeContext.clearRect(0,0,this.canvas.width,this.canvas.height),this.restore()}restore(){this.nativeContext.restore(),this.stack.length>0&&(Zt.free(this.matrix),this.matrix=this.stack.pop(),this.setTransformForCurrent(!0))}highPerformanceRestore(){this.stack.length>0&&(Zt.free(this.matrix),this.matrix=this.stack.pop())}rotate(n,e=!0){this.matrix.rotate(n),e&&this.setTransformForCurrent()}save(){const n=this.cloneMatrix(this.matrix);this.stack.push(n),this.nativeContext.save()}highPerformanceSave(){const n=this.cloneMatrix(this.matrix);this.stack.push(n)}scale(n,e,t=!0){this.matrix.scale(n,e),t&&this.setTransformForCurrent()}setScale(n,e,t=!0){this.matrix.setScale(n,e),t&&this.setTransformForCurrent()}scalePoint(n,e,t,i,r=!0){this.translate(t,i,!1),this.scale(n,e,!1),this.translate(-t,-i,!1),r&&this.setTransformForCurrent()}setTransform(n,e,t,i,r,o,s=!0,l=this.dpr){this.matrix.setValue(l*n,l*e,l*t,l*i,l*r,l*o),s&&this.setTransformForCurrent()}setTransformFromMatrix(n,e=!0,t=this.dpr){this.matrix.setValue(n.a*t,n.b*t,n.c*t,n.d*t,n.e*t,n.f*t),e&&this.setTransformForCurrent()}resetTransform(n=!0,e=this.dpr){this.setTransform(e,0,0,e,0,0),n&&this.setTransformForCurrent()}transform(n,e,t,i,r,o,s=!0){this.matrix.multiply(n,e,t,i,r,o),s&&this.setTransformForCurrent()}transformFromMatrix(n,e){this.matrix.multiply(n.a,n.b,n.c,n.d,n.e,n.f),e&&this.setTransformForCurrent()}translate(n,e,t=!0){this.matrix.translate(n,e),t&&this.setTransformForCurrent()}rotateDegrees(n,e=!0){const t=n*Math.PI/180;this.rotate(t,e)}rotateAbout(n,e,t,i=!0){this.translate(e,t,!1),this.rotate(n,!1),this.translate(-e,-t,!1),i&&this.setTransformForCurrent()}rotateDegreesAbout(n,e,t,i=!0){this.translate(e,t,!1),this.rotateDegrees(n,!1),this.translate(-e,-t,!1),i&&this.setTransformForCurrent()}beginPath(){this.disableBeginPath||this.nativeContext.beginPath()}clip(n,e){n?typeof n=="string"?this.nativeContext.clip(n):this.nativeContext.clip(n,e):this.nativeContext.clip()}arc(n,e,t,i,r,o,s){if(s=s||0,this.camera){const l=[];VB(l,i,r,n,e,t,t,o);for(let a=0;a<l.length;++a){const d=l[a];this.bezierCurveTo(d[0],d[1],d[2],d[3],d[4],d[5],s)}}else this.nativeContext.arc(n,e,Math.max(0,t),i,r,o)}arcTo(n,e,t,i,r){this.nativeContext.arcTo(n,e,t,i,r)}bezierCurveTo(n,e,t,i,r,o,s){if(s=s||0,this.camera){let l=s,a=s;this.modelMatrix&&(Hn(Se,[n,e,s],this.modelMatrix),n=Se[0],e=Se[1],l=Se[2],Hn(Se,[t,i,s],this.modelMatrix),t=Se[0],i=Se[1],a=Se[2],Hn(Se,[r,o,s],this.modelMatrix),r=Se[0],o=Se[1],s=Se[2]);let d=this.camera.vp(r,o,s);r=d.x,o=d.y,d=this.camera.vp(n,e,l),n=d.x,e=d.y,d=this.camera.vp(t,i,a),t=d.x,i=d.y}this.nativeContext.bezierCurveTo(n,e,t,i,r,o)}closePath(){this.nativeContext.closePath()}ellipse(n,e,t,i,r,o,s,l){l==null?this.nativeContext.ellipse(n,e,t,i,r,o,s):this.nativeContext.ellipse(n,e,t,i,r,o,s,l)}lineTo(n,e,t){if(t=t||0,this.camera){this.modelMatrix&&(Hn(Se,[n,e,t],this.modelMatrix),n=Se[0],e=Se[1],t=Se[2]);const i=this.camera.vp(n,e,t);n=i.x,e=i.y}this.nativeContext.lineTo(n,e)}moveTo(n,e,t){if(t=t||0,this.camera){this.modelMatrix&&(Hn(Se,[n,e,t],this.modelMatrix),n=Se[0],e=Se[1],t=Se[2]);const i=this.camera.vp(n,e,t);n=i.x,e=i.y}this.nativeContext.moveTo(n,e)}quadraticCurveTo(n,e,t,i,r){if(r=r||0,this.camera){let o=r;this.modelMatrix&&(Hn(Se,[n,e,r],this.modelMatrix),n=Se[0],e=Se[1],o=Se[2],Hn(Se,[t,i,r],this.modelMatrix),t=Se[0],i=Se[1],r=Se[2]);let s=this.camera.vp(t,i,r);t=s.x,i=s.y,s=this.camera.vp(n,e,o),n=s.x,e=s.y}this.nativeContext.quadraticCurveTo(n,e,t,i)}rect(n,e,t,i,r){r=r||0,this.camera?(this.moveTo(n,e,r),this.lineTo(n+t,e,r),this.lineTo(n+t,e+i,r),this.lineTo(n,e+i,r),this.closePath()):this.nativeContext.rect(n,e,t,i)}createImageData(){const n=arguments;return n.length===2?this.nativeContext.createImageData(n[0],n[1]):n.length===1?this.nativeContext.createImageData(n[0]):null}createLinearGradient(n,e,t,i){return isFinite(n+e+t+i)||(n=0,e=0,t=0,i=0),this.nativeContext.createLinearGradient(n,e,t,i)}createPattern(n,e){return n.width===0||n.height===0?null:this.nativeContext.createPattern(n,e)}createRadialGradient(n,e,t,i,r,o){return this.nativeContext.createRadialGradient(n,e,t,i,r,o)}createConicGradient(n,e,t,i){let r,o=!1;const s=this;return{stops:[],addColorStop(l,a){this.stops.push([l,a]),o=!0},GetPattern(l,a,d){return o&&(d||(d=i-t),r=KS(s,this.stops,n,e,d,t,i,l,a),o=!1),r}}}fill(n,e){this.disableFill||(n?this.nativeContext.fill(n):this.nativeContext.fill())}fillRect(n,e,t,i){this.nativeContext.fillRect(n,e,t,i)}clearRect(n,e,t,i){this.nativeContext.clearRect(n,e,t,i)}project(n,e,t){if(t=t||0,this.camera){this.modelMatrix&&(Hn(Se,[n,e,t],this.modelMatrix),n=Se[0],e=Se[1],t=Se[2]);const i=this.camera.vp(n,e,t);n=i.x,e=i.y}return{x:n,y:e}}view(n,e,t){return t=t||0,this.camera?(this.modelMatrix&&(Hn(Se,[n,e,t],this.modelMatrix),n=Se[0],e=Se[1],t=Se[2]),this.camera.view(n,e,t)):[n,e,t]}fillText(n,e,t,i){if(i=i||0,this.camera){this.modelMatrix&&(Hn(Se,[e,t,i],this.modelMatrix),e=Se[0],t=Se[1],i=Se[2]);const r=this.camera.vp(e,t,i);e=r.x,t=r.y}this.nativeContext.fillText(n,e,t)}getImageData(n,e,t,i){return this.nativeContext.getImageData(n,e,t,i)}getLineDash(){return this.nativeContext.getLineDash()}isPointInPath(n,e){return this.nativeContext.isPointInPath(n,e)}isPointInStroke(n,e){return this.nativeContext.isPointInStroke(n,e)}measureText(n,e=U.global.measureTextMethod){var t,i;if(!e||e==="native")return this.nativeContext.measureText(n);this.mathTextMeasure||(this.mathTextMeasure=U.graphicUtil.createTextMeasureInstance({},{},()=>this.canvas.nativeCanvas));const r=(t=this.fontFamily)!==null&&t!==void 0?t:qt.fontFamily,o=(i=this.fontSize)!==null&&i!==void 0?i:qt.fontSize;return this.mathTextMeasure.textSpec.fontFamily===r&&this.mathTextMeasure.textSpec.fontSize===o||(this.mathTextMeasure.textSpec.fontFamily=r,this.mathTextMeasure.textSpec.fontSize=o,this.mathTextMeasure._numberCharSize=null,this.mathTextMeasure._fullCharSize=null,this.mathTextMeasure._letterCharSize=null,this.mathTextMeasure._specialCharSizeMap={}),this.mathTextMeasure.measure(n,e)}putImageData(n,e,t){this.nativeContext.putImageData(n,e,t)}setLineDash(n){const e=arguments,t=this.nativeContext;this.nativeContext.setLineDash?e[0]&&t.setLineDash(e[0]):"mozDash"in t?t.mozDash=e[0]:"webkitLineDash"in t&&(t.webkitLineDash=e[0])}stroke(n){this.disableStroke||(n?this.nativeContext.stroke(n):this.nativeContext.stroke())}strokeRect(n,e,t,i){this.nativeContext.strokeRect(n,e,t,i)}strokeText(n,e,t,i){if(i=i||0,this.camera){this.modelMatrix&&(Hn(Se,[e,t,i],this.modelMatrix),e=Se[0],t=Se[1],i=Se[2]);const r=this.camera.vp(e,t,i);e=r.x,t=r.y}this.nativeContext.strokeText(n,e,t)}drawImage(){const n=this.nativeContext,e=arguments;e.length===3?n.drawImage(e[0],e[1],e[2]):e.length===5?n.drawImage(e[0],e[1],e[2],e[3],e[4]):e.length===9&&n.drawImage(e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8])}setCommonStyle(n,e,t,i,r){if(Array.isArray(r)){if(r.length<=1)return this._setCommonStyle(n,e,t,i,r[0]);const o=Object.create(r[0]);return r.forEach((s,l)=>{l!==0&&Object.assign(o,s)}),this._setCommonStyle(n,e,t,i,o)}return this._setCommonStyle(n,e,t,i,r)}_setCommonStyle(n,e,t,i,r){const o=this.nativeContext;r||(r=this.fillAttributes);const{fillOpacity:s=r.fillOpacity,opacity:l=r.opacity,fill:a=r.fill}=e;o.globalAlpha=s*l*this.baseGlobalAlpha,s>1e-12&&l>1e-12&&(o.fillStyle=da(this,a,n,t,i))}setShadowBlendStyle(n,e,t){if(Array.isArray(t)){if(t.length<=1)return this._setShadowBlendStyle(n,t[0]);const i=Object.create(t[0]);return t.forEach((r,o)=>{o!==0&&Object.assign(i,r)}),this._setShadowBlendStyle(n,e,i)}return this._setShadowBlendStyle(n,e,t)}_setShadowBlendStyle(n,e,t){const i=this.nativeContext;t||(t=this.fillAttributes);const{opacity:r=t.opacity,shadowBlur:o=t.shadowBlur,shadowColor:s=t.shadowColor,shadowOffsetX:l=t.shadowOffsetX,shadowOffsetY:a=t.shadowOffsetY,blur:d=t.blur,globalCompositeOperation:u=t.globalCompositeOperation}=e;r<=1e-12||(o||l||a?(i.shadowBlur=o*this.dpr,i.shadowColor=s,i.shadowOffsetX=l*this.dpr,i.shadowOffsetY=a*this.dpr,this._clearShadowStyle=!0):this._clearShadowStyle&&(i.shadowBlur=0,i.shadowOffsetX=0,i.shadowOffsetY=0),d?(i.filter=`blur(${d}px)`,this._clearFilterStyle=!0):this._clearFilterStyle&&(i.filter="blur(0px)",this._clearFilterStyle=!1),u?(i.globalCompositeOperation=u,this._clearGlobalCompositeOperationStyle=!0):this._clearGlobalCompositeOperationStyle&&(i.globalCompositeOperation="source-over",this._clearGlobalCompositeOperationStyle=!1))}setStrokeStyle(n,e,t,i,r){if(Array.isArray(r)){if(r.length<=1)return this._setStrokeStyle(n,e,t,i,r[0]);const o=Object.create(r[0]);return r.forEach((s,l)=>{l!==0&&Object.assign(o,s)}),this._setStrokeStyle(n,e,t,i,o)}return this._setStrokeStyle(n,e,t,i,r)}_setStrokeStyle(n,e,t,i,r){const o=this.nativeContext;r||(r=this.strokeAttributes);const{strokeOpacity:s=r.strokeOpacity,opacity:l=r.opacity}=e;if(o.globalAlpha=s*l*this.baseGlobalAlpha,s>1e-12&&l>1e-12){const{lineWidth:a=r.lineWidth,stroke:d=r.stroke,lineJoin:u=r.lineJoin,lineDash:h=r.lineDash,lineCap:c=r.lineCap,miterLimit:g=r.miterLimit,keepStrokeScale:f=r.keepStrokeScale}=e;o.lineWidth=f?a:Bi(this,a,this.dpr),o.strokeStyle=da(this,d,n,t,i),o.lineJoin=u,h&&o.setLineDash(h),o.lineCap=c,o.miterLimit=g}}setTextStyleWithoutAlignBaseline(n,e,t){const i=this.nativeContext;e||(e=this.textAttributes);const{scaleIn3d:r=e.scaleIn3d}=n;n.font?i.font=n.font:i.font=vh(n,e,r&&this.camera&&this.camera.getProjectionScale(t));const{fontFamily:o=e.fontFamily,fontSize:s=e.fontSize}=n;this.fontFamily=o,this.fontSize=s,i.textAlign="left",i.textBaseline="alphabetic"}setTextStyle(n,e,t){var i,r;const o=this.nativeContext;e||(e=this.textAttributes),n.font?o.font=n.font:o.font=vh(n,e,this.camera&&this.camera.getProjectionScale(t));const{fontFamily:s=e.fontFamily,fontSize:l=e.fontSize}=n;this.fontFamily=s,this.fontSize=l,o.textAlign=(i=n.textAlign)!==null&&i!==void 0?i:e.textAlign,o.textBaseline=(r=n.textBaseline)!==null&&r!==void 0?r:e.textBaseline}draw(){}clearMatrix(n=!0,e=this.dpr){this.setTransformFromMatrix(this._clearMatrix,n,e)}setClearMatrix(n,e,t,i,r,o){this._clearMatrix.setValue(n,e,t,i,r,o)}onlyTranslate(n=this.dpr){return this.matrix.a===n&&this.matrix.b===0&&this.matrix.c===0&&this.matrix.d===n}release(...n){this.stack.forEach(e=>Zt.free(e)),this.stack.length=0}};fo.env="browser",fo=WB([se(),NB("design:paramtypes",[Object,Number])],fo);var GB=function(n,e,t,i){var r,o=arguments.length,s=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,e,t,i);else for(var l=n.length-1;l>=0;l--)(r=n[l])&&(s=(o<3?r(s):o>3?r(e,t,s):r(e,t))||s);return o>3&&s&&Object.defineProperty(e,t,s),s},jB=function(n,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,e)};let go=class extends Gf{constructor(n){super(n)}init(n){const{container:e}=n;if(typeof e=="string"){const t=U.global.getElementById(e);t&&(this._container=t)}else this._container=e;this._context=new fo(this,this._dpr),this.initStyle()}initStyle(){if(!this.controled)return;const{nativeCanvas:n}=this;n.width=this._pixelWidth,n.height=this._pixelHeight,!n.style||this.setCanvasStyle(n,this._x,this._y,this._displayWidth,this._displayHeight),this._container&&this._container.appendChild(n),this.visiable||this.hide()}hide(){this._nativeCanvas&&(this._nativeCanvas.style.display="none")}show(){this._nativeCanvas&&(this._nativeCanvas.style.display="block")}applyPosition(){const n=this._nativeCanvas;n.style.position="absolute",n.style.top=`${this._y}px`,n.style.left=`${this._x}px`}resetStyle(n){if(!this.controled)return;const{width:e=this._displayWidth,height:t=this._displayHeight,dpr:i=this._dpr,x:r=this._x,y:o=this._y}=n,{nativeCanvas:s}=this;s.width=e*i,s.height=t*i,!s.style||this.setCanvasStyle(s,r,o,e,t),n.id&&(s.id=n.id),this.visiable||this.hide()}setCanvasStyle(n,e,t,i,r){this.controled&&(n.style.width=`${i}px`,n.style.height=`${r}px`)}toDataURL(n,e){return n==="image/jpeg"?this._nativeCanvas.toDataURL(n,e):n==="image/png"?this._nativeCanvas.toDataURL(n):this._nativeCanvas.toDataURL(n,e)}resize(n,e){this.controled&&(this._pixelWidth=n*this._dpr,this._pixelHeight=e*this._dpr,this._displayWidth=n,this._displayHeight=e,this._nativeCanvas.style&&(this._nativeCanvas.style.width=`${n}px`,this._nativeCanvas.style.height=`${e}px`),this._nativeCanvas.width=this._pixelWidth,this._nativeCanvas.height=this._pixelHeight,this._context.dpr=this._dpr)}};go.env="browser",go=GB([se(),jB("design:paramtypes",[Object])],go);function X0(n,e){return new we(t=>{t(d0).toDynamicValue(()=>i=>new n(i)).whenTargetNamed(n.env),t(Q1).toDynamicValue(()=>(i,r)=>new e(i,r)).whenTargetNamed(e.env)})}const UB=X0(go,fo);var $B=function(n,e,t,i){var r,o=arguments.length,s=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,e,t,i);else for(var l=n.length-1;l>=0;l--)(r=n[l])&&(s=(o<3?r(s):o>3?r(e,t,s):r(e,t))||s);return o>3&&s&&Object.defineProperty(e,t,s),s},KB=function(n,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,e)},Qo=function(n,e){return function(t,i){e(t,i,n)}};let oo=class extends hc{constructor(n,e,t){super(t),this.contributions=n,this.drawContribution=e,this.pickItemInterceptorContributions=t,this.global.hooks.onSetEnv.tap("canvas-picker-service",(i,r,o)=>{this.configure(o,r)}),this.configure(this.global,this.global.env),this.pickerMap=new Map,this.init()}init(){this.contributions.getContributions().forEach(n=>{this.pickerMap.set(n.numberType,n)}),super._init()}configure(n,e){this.pickCanvas=vo.shareCanvas(),this.pickContext=this.pickCanvas.getContext("2d")}pickItem(n,e,t,i){if(n.attribute.pickable===!1)return null;if(this.InterceptorContributions.length)for(let a=0;a<this.InterceptorContributions.length;a++){const d=this.InterceptorContributions[a];if(d.beforePickItem){const u=d.beforePickItem(n,this,e,i,{parentMatrix:t});if(u)return u}}const r=this.pickerMap.get(n.numberType);if(!r)return null;const o=r.contains(n,e,i),s=o?n:null,l={graphic:s,params:o};if(s)return l;if(this.InterceptorContributions.length)for(let a=0;a<this.InterceptorContributions.length;a++){const d=this.InterceptorContributions[a];if(d.afterPickItem){const u=d.afterPickItem(n,this,e,i,{parentMatrix:t});if(u)return u}}return l}};oo=$B([se(),Qo(0,Be(gt)),Qo(0,At(fn)),Qo(1,Be(If)),Qo(2,Be(gt)),Qo(2,At(io)),KB("design:paramtypes",[Object,Object,Object])],oo);var YB=function(n,e,t,i){var r,o=arguments.length,s=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,e,t,i);else for(var l=n.length-1;l>=0;l--)(r=n[l])&&(s=(o<3?r(s):o>3?r(e,t,s):r(e,t))||s);return o>3&&s&&Object.defineProperty(e,t,s),s};let fc=class{constructor(){this.type="group",this.numberType=Tf}contains(n,e,t){return!1}};fc=YB([se()],fc);const Na=new we((n,e,t,i)=>{Na.__vloaded||(Na.__vloaded=!0,n(Hm).to(fc).inSingletonScope(),n(fn).toService(Hm),Dt(n,fn))});Na.__vloaded=!1;const XB=new we((n,e,t,i)=>{t(oo)||n(oo).toSelf().inSingletonScope(),t(co)?i(co).toService(oo):n(co).toService(oo)});function qB(n){n.load(Na),n.load(XB)}var as,ZB=function(n,e,t,i){var r,o=arguments.length,s=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,e,t,i);else for(var l=n.length-1;l>=0;l--)(r=n[l])&&(s=(o<3?r(s):o>3?r(e,t,s):r(e,t))||s);return o>3&&s&&Object.defineProperty(e,t,s),s},JB=function(n,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,e)};let Gi=as=class extends Da{get container(){return this.canvas.nativeCanvas.parentElement}static GenerateCanvasId(){return`${as.idprefix}_${as.prefix_count++}`}constructor(){super(),this.type="browser",this._canvasIsIntersecting=!0,this.global=U.global,this.viewBox=new Ue,this.modelMatrix=new Ht(1,0,0,1,0,0)}getTitle(){return this.canvas.id&&this.canvas.id.toString()}getWH(){return{width:this.canvas.width/(this.canvas.dpr||1),height:this.canvas.height/(this.canvas.dpr||1)}}getXY(){return this.canvas.nativeCanvas.getBoundingClientRect()}createWindow(n){n.canvas?this.createWindowByCanvas(n):this.createWindowByConfig(n),this.postInit()}postInit(){if(this.global.optimizeVisible)try{this.observerCanvas()}catch{console.error("发生错误，该环境不存在IntersectionObserver")}}isElementVisible(n){const e=n.getBoundingClientRect(),t=window.innerWidth||document.documentElement.clientWidth,i=window.innerHeight||document.documentElement.clientHeight;return!(e.right<0||e.bottom<0||e.left>t||e.top>i)}observerCanvas(){this._canvasIsIntersecting=this.isElementVisible(this.canvas.nativeCanvas);const n=new IntersectionObserver((e,t)=>{e.forEach(i=>{this._canvasIsIntersecting!==i.isIntersecting?(this._canvasIsIntersecting=i.isIntersecting,this._onVisibleChangeCb&&this._onVisibleChangeCb(i.isIntersecting)):this._canvasIsIntersecting=i.isIntersecting})});n&&n.observe(this.canvas.nativeCanvas)}createWindowByConfig(n){const e=this.global.createCanvas({width:n.width,height:n.height});let t;if(t=typeof n.container=="string"?this.global.getElementById(n.container):n.container?n.container:this.global.getRootElement(),!t)throw new Error("发生错误，containerId可能传入有误");n.offscreen?t=null:t.appendChild(e);const i={width:n.width,height:n.height,dpr:n.dpr,nativeCanvas:e,container:t,id:as.GenerateCanvasId(),canvasControled:!0};this.canvas=new go(i)}createWindowByCanvas(n){var e;let t;if(typeof n.canvas=="string"){if(t=this.global.getElementById(n.canvas),!t)throw new Error("canvasId 参数不正确，请确认canvas存在并插入dom")}else t=n.canvas;if(!t)throw new Error("发生错误，传入的canvas不正确");let i=n.width,r=n.height;if(i==null||r==null||!n.canvasControled){const s=t.getBoundingClientRect();i=s.width,r=s.height}let o=n.dpr;o==null&&(o=(e=t.getContext("2d").pixelRatio)!==null&&e!==void 0?e:t.width/i),this.canvas=new go({width:i,height:r,dpr:o,nativeCanvas:t,canvasControled:n.canvasControled})}releaseWindow(){this.canvas.release()}resizeWindow(n,e){this.canvas.resize(n,e)}setDpr(n){this.canvas.dpr=n}getContext(){return this.canvas.getContext()}getNativeHandler(){return this.canvas}getDpr(){return this.canvas.dpr}addEventListener(n,e,t){return this.canvas.nativeCanvas.addEventListener(n,e,t)}removeEventListener(n,e,t){return this.canvas.nativeCanvas.removeEventListener(n,e,t)}dispatchEvent(n){return this.canvas.nativeCanvas.dispatchEvent(n)}getStyle(){var n;return(n=this.canvas.nativeCanvas.style)!==null&&n!==void 0?n:{}}setStyle(n){this.canvas.nativeCanvas.style=n}getBoundingClientRect(){const n=this.canvas.nativeCanvas,e=this.getWH();return n.parentElement?this.canvas.nativeCanvas.getBoundingClientRect():{x:0,y:0,width:e.width,height:e.height,left:0,top:0,right:0,bottom:0}}clearViewBox(n){const e=this.viewBox,t=this.getContext(),i=this.getDpr();t.nativeContext.save(),t.nativeContext.setTransform(i,0,0,i,0,0),t.clearRect(e.x1,e.y1,e.x2-e.x1,e.y2-e.y1),n&&(t.fillStyle=n,t.fillRect(e.x1,e.y1,e.x2-e.x1,e.y2-e.y1)),t.nativeContext.restore()}isVisible(n){return this._canvasIsIntersecting}onVisibleChange(n){this._onVisibleChangeCb=n}getTopLeft(n){return this.global.getElementTopLeft(this.canvas.nativeCanvas,n)}};Gi.env="browser",Gi.idprefix="visactor_window",Gi.prefix_count=0,Gi=as=ZB([se(),JB("design:paramtypes",[])],Gi);const QB=new we(n=>{n(Gi).toSelf(),n(Rf).toDynamicValue(e=>e.container.get(Gi)).whenTargetNamed(Gi.env)});var eM=function(n,e,t,i){var r,o=arguments.length,s=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,e,t,i);else for(var l=n.length-1;l>=0;l--)(r=n[l])&&(s=(o<3?r(s):o>3?r(e,t,s):r(e,t))||s);return o>3&&s&&Object.defineProperty(e,t,s),s},tM=function(n,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,e)},nM=function(n,e,t,i){return new(t||(t=Promise))(function(r,o){function s(d){try{a(i.next(d))}catch(u){o(u)}}function l(d){try{a(i.throw(d))}catch(u){o(u)}}function a(d){var u;d.done?r(d.value):(u=d.value,u instanceof t?u:new t(function(h){h(u)})).then(s,l)}a((i=i.apply(n,e||[])).next())})};class iM{get x1(){return this.dom.getBoundingClientRect().left}get x2(){return this.dom.getBoundingClientRect().right}get y1(){return this.dom.getBoundingClientRect().top}get y2(){return this.dom.getBoundingClientRect().bottom}get width(){return this.dom.getBoundingClientRect().width}get height(){return this.dom.getBoundingClientRect().height}constructor(e){this.dom=e}}function Em(n,e=!1){const t=document.createElement("img");if(U.global.isImageAnonymous&&(t.crossOrigin="anonymous"),e){const i=new Blob([n],{type:"image/svg+xml"});n=window.URL.createObjectURL(i)}return t.src=n,t.complete?Promise.resolve(t):new Promise((i,r)=>{t.onload=()=>{i(t)},t.onerror=()=>{r(new Error("加载失败"))}})}let Va=class extends Oa{constructor(){super(),this.type="browser",this.supportEvent=!0;try{this.supportsTouchEvents="ontouchstart"in globalThis,this.supportsPointerEvents=!!globalThis.PointerEvent,this.supportsMouseEvents=!!globalThis.MouseEvent}catch{this.supportsTouchEvents=!1,this.supportsPointerEvents=!1,this.supportsPointerEvents=!1}this.applyStyles=!0}mapToCanvasPoint(n,e){var t,i;let r=0,o=0,s=0,l=0;if(n.changedTouches){const a=(t=n.changedTouches[0])!==null&&t!==void 0?t:{};r=a.clientX||0,o=a.clientY||0,s=r,l=o}else r=n.clientX||0,o=n.clientY||0,s=n.offsetX||0,l=n.offsetY||0;if(e){const a=r,d=o,u=e.getBoundingClientRect(),h=(i=e.getNativeHandler)===null||i===void 0?void 0:i.call(e).nativeCanvas;let c,g;return h&&(c=u.width/h.offsetWidth,g=u.height/h.offsetHeight),{x:(a-u.left)/(Xe(c)?c:1),y:(d-u.top)/(Xe(g)?g:1)}}return{x:s,y:l}}getNativeAABBBounds(n){let e=n;if(typeof n=="string"&&(e=new DOMParser().parseFromString(n,"text/html").firstChild,e.lastChild&&(e=e.lastChild.firstChild)),e.getBoundingClientRect){const t=e.getBoundingClientRect();return new iM(t)}return new Ue}removeDom(n){return n.parentElement.removeChild(n),!0}updateDom(n,e){const{width:t,height:i,style:r}=e;return r&&(je(r)?n.setAttribute("style",r):Object.keys(r).forEach(o=>{n.style[o]=r[o]})),t!=null&&(n.style.width=`${t}px`),i!=null&&(n.style.height=`${i}px`),!0}createDom(n){const{tagName:e="div",parent:t}=n,i=document.createElement(e);if(this.updateDom(i,n),t){const r=je(t)?this.getElementById(t):t;r&&r.appendChild&&r.appendChild(i)}return i}loadImage(n){return Em(n,!1).then(e=>({data:e,loadState:"success"})).catch(()=>({data:null,loadState:"fail"}))}loadSvg(n){return Em(n,!0).then(e=>({data:e,loadState:"success"})).catch(()=>({data:null,loadState:"fail"}))}createCanvas(n){var e,t;const i=document.createElement("canvas");n.id&&(i.id=(e=n.id)!==null&&e!==void 0?e:pt.GenAutoIncrementId().toString());const r=(t=n.dpr)!==null&&t!==void 0?t:window.devicePixelRatio;return n.width&&n.height&&(i.style.width=`${n.width}px`,i.style.height=`${n.height}px`,i.width=n.width*r,i.height=n.height*r),i}createOffscreenCanvas(n){var e;const t=(e=n.dpr)!==null&&e!==void 0?e:window.devicePixelRatio;return new OffscreenCanvas(n.width*t,n.height*t)}releaseCanvas(n){let e;e=typeof n=="string"?document.getElementById(n):n,e&&e.parentElement&&e.parentElement.removeChild(e)}getDevicePixelRatio(){return window.devicePixelRatio}getRequestAnimationFrame(){return window.requestAnimationFrame}getCancelAnimationFrame(){return window.cancelAnimationFrame}addEventListener(n,e,t){return document.addEventListener(n,e,t)}removeEventListener(n,e,t){return document.removeEventListener(n,e,t)}dispatchEvent(n){return document.dispatchEvent(n)}getElementById(n){return document.getElementById(n)}getRootElement(){return document.body}getDocument(){return document}release(...n){}getElementTop(n,e){let t=n.offsetTop,i=n.offsetParent;for(;i!==null;)t+=i.offsetTop,i=i.offsetParent;return t}getElementLeft(n,e){let t=n.offsetLeft,i=n.offsetParent;for(;i!==null;)t+=i.offsetLeft,i=i.offsetParent;return t}getElementTopLeft(n,e){let t=n.offsetTop,i=n.offsetLeft,r=n.offsetParent;for(;r!==null;)t+=r.offsetTop,i+=r.offsetLeft,r=r.offsetParent;return{top:t,left:i}}loadFont(n,e,t){return nM(this,void 0,void 0,function*(){return new FontFace(n,je(e)?`url(${e})`:e,t).load().then(function(i){return document.fonts.add(i),{loadState:"success"}}).catch(function(i){return console.error("Failed to load font:",i),{loadState:"fail"}})})}};Va=eM([se(),tM("design:paramtypes",[])],Va);const Ga=new we(n=>{Ga.isBrowserBound||(Ga.isBrowserBound=!0,n(Va).toSelf().inSingletonScope(),n(Xd).toService(Va))});Ga.isBrowserBound=!1;function ja(n,e=!0){ja.__loaded||(ja.__loaded=!0,n.load(Ga),n.load(UB),n.load(QB),e&&qB(n))}ja.__loaded=!1;class Mi{contains(e,t,i){if(!e.AABBBounds.containsPoint(t))return!1;if(e.attribute.pickMode==="imprecise")return!0;const{pickContext:r}=i??{};if(!r)return!1;const o=e.getGraphicTheme();r.highPerformanceSave();let{x:s=o.x,y:l=o.y}=e.attribute;if(e.transMatrix.onlyTranslate()){const d=e.getOffsetXY(o);s+=d.x,l+=d.y,r.setTransformForCurrent()}else s=0,l=0,r.transformFromMatrix(e.transMatrix,!0);let a=!1;return this.canvasRenderer.drawShape(e,r,s,l,{},null,(d,u,h)=>!!a||(a=d.isPointInPath(t.x,t.y),a),(d,u,h)=>{if(a)return!0;const c=u.lineWidth||h.lineWidth,g=u.pickStrokeBuffer||h.pickStrokeBuffer,f=u.keepStrokeScale||h.keepStrokeScale;return r.lineWidth=f?c+g:Bi(r,c+g,r.dpr),a=d.isPointInStroke(t.x,t.y),a}),r.highPerformanceRestore(),a}}var rM=function(n,e,t,i){var r,o=arguments.length,s=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,e,t,i);else for(var l=n.length-1;l>=0;l--)(r=n[l])&&(s=(o<3?r(s):o>3?r(e,t,s):r(e,t))||s);return o>3&&s&&Object.defineProperty(e,t,s),s},oM=function(n,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,e)},sM=function(n,e){return function(t,i){e(t,i,n)}};let gc=class extends Mi{constructor(n){super(),this.canvasRenderer=n,this.type="arc",this.numberType=Jd}};gc=rM([se(),sM(0,Be(xa)),oM("design:paramtypes",[Object])],gc);let Lm=!1;const lM=new we((n,e,t,i)=>{Lm||(Lm=!0,n(fm).to(gc).inSingletonScope(),n(nr).toService(fm))});var aM=function(n,e,t,i){var r,o=arguments.length,s=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,e,t,i);else for(var l=n.length-1;l>=0;l--)(r=n[l])&&(s=(o<3?r(s):o>3?r(e,t,s):r(e,t))||s);return o>3&&s&&Object.defineProperty(e,t,s),s},dM=function(n,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,e)},uM=function(n,e){return function(t,i){e(t,i,n)}};let pc=class extends Mi{constructor(n){super(),this.canvasRenderer=n,this.type="circle",this.numberType=Qd}};pc=aM([se(),uM(0,Be(Ra)),dM("design:paramtypes",[Object])],pc);let Fm=!1;const hM=new we((n,e,t,i)=>{Fm||(Fm=!0,n(gm).to(pc).inSingletonScope(),n(nr).toService(gm))});var cM=function(n,e,t,i){var r,o=arguments.length,s=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,e,t,i);else for(var l=n.length-1;l>=0;l--)(r=n[l])&&(s=(o<3?r(s):o>3?r(e,t,s):r(e,t))||s);return o>3&&s&&Object.defineProperty(e,t,s),s};let Mo=class{constructor(){this.type="image",this.numberType=eu}contains(n,e,t){const{pickContext:i}=t??{};return!!i&&!!n.AABBBounds.containsPoint(e)}};Mo=cM([se()],Mo);let zm=!1;const fM=new we((n,e,t,i)=>{zm||(zm=!0,n(Wa).to(Mo).inSingletonScope(),n(Mo).toService(Wa))});var gM=function(n,e,t,i){var r,o=arguments.length,s=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,e,t,i);else for(var l=n.length-1;l>=0;l--)(r=n[l])&&(s=(o<3?r(s):o>3?r(e,t,s):r(e,t))||s);return o>3&&s&&Object.defineProperty(e,t,s),s},pM=function(n,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,e)},mM=function(n,e){return function(t,i){e(t,i,n)}};let mc=class extends Mi{constructor(n){super(),this.canvasRenderer=n,this.type="line",this.numberType=il}};mc=gM([se(),mM(0,Be(Aa)),pM("design:paramtypes",[Object])],mc);let Im=!1;const bM=new we((n,e,t,i)=>{Im||(Im=!0,n(pm).to(mc).inSingletonScope(),n(nr).toService(pm))});var CM=function(n,e,t,i){var r,o=arguments.length,s=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,e,t,i);else for(var l=n.length-1;l>=0;l--)(r=n[l])&&(s=(o<3?r(s):o>3?r(e,t,s):r(e,t))||s);return o>3&&s&&Object.defineProperty(e,t,s),s},_M=function(n,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,e)},wM=function(n,e){return function(t,i){e(t,i,n)}};let bc=class extends Mi{constructor(n){super(),this.canvasRenderer=n,this.type="polygon",this.numberType=nu}};bc=CM([se(),wM(0,Be(Ma)),_M("design:paramtypes",[Object])],bc);let Om=!1;const yM=new we((n,e,t,i)=>{Om||(Om=!0,n(wm).to(bc).inSingletonScope(),n(nr).toService(wm))});var vM=function(n,e,t,i){var r,o=arguments.length,s=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,e,t,i);else for(var l=n.length-1;l>=0;l--)(r=n[l])&&(s=(o<3?r(s):o>3?r(e,t,s):r(e,t))||s);return o>3&&s&&Object.defineProperty(e,t,s),s},SM=function(n,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,e)},xM=function(n,e){return function(t,i){e(t,i,n)}};let Cc=class extends Mi{constructor(n){super(),this.canvasRenderer=n,this.type="path",this.numberType=tu}};Cc=vM([se(),xM(0,Be(Ba)),SM("design:paramtypes",[Object])],Cc);let Dm=!1;const RM=new we((n,e,t,i)=>{Dm||(Dm=!0,n(mm).to(Cc).inSingletonScope(),n(nr).toService(mm))}),ju=new Ue;class q0{constructor(){this.type="rect",this.numberType=Pf}contains(e,t,i){if(!e.AABBBounds.containsPoint(t))return!1;if(e.attribute.pickMode==="imprecise")return!0;const{pickContext:r}=i??{};if(!r)return!1;const o=e.getGraphicTheme(),{cornerRadius:s=o.cornerRadius}=e.attribute;let{x:l=o.x,y:a=o.y}=e.attribute;r.highPerformanceSave();let d=!0;if(e.transMatrix.onlyTranslate()){const h=e.getOffsetXY(o);l+=h.x,a+=h.y,r.setTransformForCurrent()}else l=0,a=0,d=!1,r.transformFromMatrix(e.transMatrix,!0);let u=!0;if(!d||e.shadowRoot||J(s,!0)&&s!==0||ee(s)&&s.some(h=>h!==0))u=!1,this.canvasRenderer.drawShape(e,r,l,a,{},null,(h,c,g)=>!!u||(u=h.isPointInPath(t.x,t.y),u),(h,c,g)=>{if(u)return!0;const f=c.lineWidth||g.lineWidth,p=c.pickStrokeBuffer||g.pickStrokeBuffer,m=c.keepStrokeScale||g.keepStrokeScale;return r.lineWidth=m?f+p:Bi(r,f+p,r.dpr),u=h.isPointInStroke(t.x,t.y),u});else{const{fill:h=o.fill,stroke:c=o.stroke,lineWidth:g=o.lineWidth}=e.attribute;if(h)u=!0;else if(c){const f=e.AABBBounds;ju.setValue(f.x1,f.y1,f.x2,f.y2),ju.expand(-g/2),u=!ju.containsPoint(t)}}return r.highPerformanceRestore(),u}}var AM=function(n,e,t,i){var r,o=arguments.length,s=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,e,t,i);else for(var l=n.length-1;l>=0;l--)(r=n[l])&&(s=(o<3?r(s):o>3?r(e,t,s):r(e,t))||s);return o>3&&s&&Object.defineProperty(e,t,s),s},BM=function(n,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,e)},MM=function(n,e){return function(t,i){e(t,i,n)}};let _c=class extends q0{constructor(n){super(),this.canvasRenderer=n}};_c=AM([se(),MM(0,Be(Ta)),BM("design:paramtypes",[Object])],_c);let Wm=!1;const TM=new we((n,e,t,i)=>{Wm||(Wm=!0,n(bm).to(_c).inSingletonScope(),n(nr).toService(bm))});let Nm=!1;const PM=new we((n,e,t,i)=>{Nm||(Nm=!0,n(Wa).to(Mo).inSingletonScope(),n(Mo).toService(Wa))});var HM=function(n,e,t,i){var r,o=arguments.length,s=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,e,t,i);else for(var l=n.length-1;l>=0;l--)(r=n[l])&&(s=(o<3?r(s):o>3?r(e,t,s):r(e,t))||s);return o>3&&s&&Object.defineProperty(e,t,s),s},kM=function(n,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,e)},EM=function(n,e){return function(t,i){e(t,i,n)}};let wc=class extends Mi{constructor(n){super(),this.canvasRenderer=n,this.type="symbol",this.numberType=iu}};wc=HM([se(),EM(0,Be(Pa)),kM("design:paramtypes",[Object])],wc);let Vm=!1;const LM=new we((n,e,t,i)=>{Vm||(Vm=!0,n(Cm).to(wc).inSingletonScope(),n(nr).toService(Cm))});var FM=function(n,e,t,i){var r,o=arguments.length,s=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,e,t,i);else for(var l=n.length-1;l>=0;l--)(r=n[l])&&(s=(o<3?r(s):o>3?r(e,t,s):r(e,t))||s);return o>3&&s&&Object.defineProperty(e,t,s),s};let yc=class{constructor(){this.type="text",this.numberType=ru}contains(n,e,t){return!!n.AABBBounds.containsPoint(e)}};yc=FM([se()],yc);let Gm=!1;const zM=new we((n,e,t,i)=>{Gm||(Gm=!0,n(_m).to(yc).inSingletonScope(),n(nr).toService(_m))});var IM=function(n,e,t,i){var r,o=arguments.length,s=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,e,t,i);else for(var l=n.length-1;l>=0;l--)(r=n[l])&&(s=(o<3?r(s):o>3?r(e,t,s):r(e,t))||s);return o>3&&s&&Object.defineProperty(e,t,s),s},OM=function(n,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,e)};let ms=class extends fo{constructor(n,e){super(n,e);const t=n.nativeCanvas.getContext("2d");if(!t)throw new Error("发生错误，获取2d上下文失败");this.nativeContext=t,this.canvas=n,this.matrix=new Ht(1,0,0,1,0,0),this.stack=[],this.dpr=e??1}release(...n){}};ms.env="node",ms=IM([se(),OM("design:paramtypes",[Object,Number])],ms);var DM=function(n,e,t,i){var r,o=arguments.length,s=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,e,t,i);else for(var l=n.length-1;l>=0;l--)(r=n[l])&&(s=(o<3?r(s):o>3?r(e,t,s):r(e,t))||s);return o>3&&s&&Object.defineProperty(e,t,s),s},WM=function(n,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,e)};let po=class extends Gf{constructor(n){super(n)}init(){this._context=new ms(this,this._dpr),this.nativeCanvas.width=this._pixelWidth,this.nativeCanvas.height=this._pixelHeight}release(...n){this._nativeCanvas.release&&Ae(this._nativeCanvas.release)&&this._nativeCanvas.release()}};po.env="node",po=DM([se(),WM("design:paramtypes",[Object])],po);const NM=X0(po,ms);var VM=function(n,e,t,i){var r,o=arguments.length,s=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,e,t,i);else for(var l=n.length-1;l>=0;l--)(r=n[l])&&(s=(o<3?r(s):o>3?r(e,t,s):r(e,t))||s);return o>3&&s&&Object.defineProperty(e,t,s),s},GM=function(n,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,e)},jM=function(n,e){return function(t,i){e(t,i,n)}};let mo=class extends Da{get container(){return null}constructor(n){super(),this.global=n,this.type="node"}getTitle(){return""}getWH(){return{width:this.canvas.displayWidth,height:this.canvas.displayHeight}}getXY(){return{x:0,y:0}}createWindow(n){n.canvas?this.createWindowByCanvas(n):this.createWindowByConfig(n)}createWindowByConfig(n){const e=this.global.createCanvas({width:n.width,height:n.height}),t={width:n.width,height:n.height,dpr:n.dpr,nativeCanvas:e,id:pt.GenAutoIncrementId().toString(),canvasControled:!0};this.canvas=new po(t)}createWindowByCanvas(n){const e=n.canvas;let t=n.width,i=n.height;t!=null&&i!=null&&n.canvasControled||(t=e.width,i=e.height),this.canvas=new po({width:t,height:i,dpr:1,nativeCanvas:e,canvasControled:n.canvasControled})}releaseWindow(){this.canvas.release()}resizeWindow(n,e){this.canvas.resize(n,e)}setDpr(n){this.canvas.dpr=n}getContext(){return this.canvas.getContext()}getNativeHandler(){return this.canvas}getDpr(){return this.canvas.dpr}getImageBuffer(n="image/png"){return this.canvas.nativeCanvas.toBuffer(n)}addEventListener(n,e,t){}dispatchEvent(n){return!0}removeEventListener(n,e,t){}getStyle(){}setStyle(n){}getBoundingClientRect(){return null}clearViewBox(n){}};mo.env="node",mo=VM([se(),jM(0,Be(yf)),GM("design:paramtypes",[Object])],mo);const UM=new we(n=>{n(mo).toSelf(),n(Rf).toDynamicValue(e=>e.container.get(mo)).whenTargetNamed(mo.env)});var $M=function(n,e,t,i){var r,o=arguments.length,s=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,e,t,i);else for(var l=n.length-1;l>=0;l--)(r=n[l])&&(s=(o<3?r(s):o>3?r(e,t,s):r(e,t))||s);return o>3&&s&&Object.defineProperty(e,t,s),s};let Ua=class extends Oa{constructor(){super(...arguments),this.type="node",this._lastTime=0,this.supportEvent=!1}configure(n,e){n.env===this.type&&(n.setActiveEnvContribution(this),this.pkg=e)}getDynamicCanvasCount(){return 0}getStaticCanvasCount(){return 999}loadJson(n){const e=fetch(n).then(t=>t.json());return e.then(t=>({data:t,state:"success"})).catch(()=>({data:null,state:"fail"})),e}loadArrayBuffer(n){return fetch(n).then(e=>e.arrayBuffer()).then(e=>({data:e,loadState:"success"})).catch(()=>({data:null,loadState:"fail"}))}loadImage(n){const{loadImage:e}=this.pkg;return e?e(n).then(t=>({loadState:t?"success":"fail",data:t})).catch(()=>({loadState:"fail",data:null})):Promise.reject(new Error("node-canvas loadImage could not be found!"))}loadSvg(n){const e=this.pkg.Resvg;if(!e)return Promise.reject(new Error("@resvg/resvg-js svgParser could not be found!"));const t=new e(n).render().asPng();return this.loadImage(t)}createCanvas(n){return this.pkg.createCanvas(n.width,n.height)}releaseCanvas(n){}getDevicePixelRatio(){return 1}getRequestAnimationFrame(){return function(n){return Vg.call(n)}}getCancelAnimationFrame(){return n=>{Vg.clear(n)}}addEventListener(n,e,t){}removeEventListener(n,e,t){}getElementById(n){return null}getRootElement(){return null}dispatchEvent(n){}release(...n){}createOffscreenCanvas(n){}};Ua=$M([se()],Ua);const $a=new we(n=>{$a.isNodeBound||($a.isNodeBound=!0,n(Ua).toSelf().inSingletonScope(),n(Xd).toService(Ua))});$a.isNodeBound=!1;function Ka(n,e=!0){Ka.__loaded||(Ka.__loaded=!0,n.load($a),n.load(NM),n.load(UM))}Ka.__loaded=!1;var KM=function(n,e,t,i){var r,o=arguments.length,s=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,e,t,i);else for(var l=n.length-1;l>=0;l--)(r=n[l])&&(s=(o<3?r(s):o>3?r(e,t,s):r(e,t))||s);return o>3&&s&&Object.defineProperty(e,t,s),s},YM=function(n,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,e)},XM=function(n,e){return function(t,i){e(t,i,n)}};let vc=class extends Mi{constructor(n){super(),this.canvasRenderer=n,this.type="arc",this.numberType=Jd}};vc=KM([se(),XM(0,Be(xa)),YM("design:paramtypes",[Object])],vc);let jm=!1;const qM=new we((n,e,t,i)=>{jm||(jm=!0,n(ym).to(vc).inSingletonScope(),n(fn).toService(ym))});var ZM=function(n,e,t,i){var r,o=arguments.length,s=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,e,t,i);else for(var l=n.length-1;l>=0;l--)(r=n[l])&&(s=(o<3?r(s):o>3?r(e,t,s):r(e,t))||s);return o>3&&s&&Object.defineProperty(e,t,s),s},JM=function(n,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,e)},QM=function(n,e){return function(t,i){e(t,i,n)}};let Sc=class extends q0{constructor(n){super(),this.canvasRenderer=n}};Sc=ZM([se(),QM(0,Be(Ta)),JM("design:paramtypes",[Object])],Sc);let Um=!1;const eT=new we((n,e,t,i)=>{Um||(Um=!0,n(Am).to(Sc).inSingletonScope(),n(fn).toService(Am))});class Z0 extends tn{contains(e,t,i){if(!e.AABBBounds.containsPoint(t))return!1;if(e.attribute.pickMode==="imprecise")return!0;const{pickContext:r}=i??{};if(!r)return!1;r.highPerformanceSave();const o=e.getGraphicTheme(),s=this.transform(e,o,r),{x:l,y:a,z:d,lastModelMatrix:u}=s;let h=t;if(r.camera){h=t.clone();const g=e.parent.globalTransMatrix;h.x=g.a*t.x+g.c*t.y+g.e,h.y=g.b*t.x+g.d*t.y+g.f}this.canvasRenderer.z=d;let c=!1;return this.canvasRenderer.drawShape(e,r,l,a,{},null,g=>!!c||(c=g.isPointInPath(h.x,h.y),c),(g,f,p)=>{if(c)return!0;const m=f.lineWidth||p.lineWidth,b=f.pickStrokeBuffer||p.pickStrokeBuffer,C=f.keepStrokeScale||p.keepStrokeScale;return r.lineWidth=C?m+b:Bi(r,m+b,r.dpr),c=g.isPointInStroke(h.x,h.y),c}),this.canvasRenderer.z=0,r.modelMatrix!==u&&ft.free(r.modelMatrix),r.modelMatrix=u,r.highPerformanceRestore(),c}}var tT=function(n,e,t,i){var r,o=arguments.length,s=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,e,t,i);else for(var l=n.length-1;l>=0;l--)(r=n[l])&&(s=(o<3?r(s):o>3?r(e,t,s):r(e,t))||s);return o>3&&s&&Object.defineProperty(e,t,s),s},nT=function(n,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,e)},iT=function(n,e){return function(t,i){e(t,i,n)}};let xc=class extends Z0{constructor(n){super(),this.canvasRenderer=n,this.type="line",this.numberType=il}};xc=tT([se(),iT(0,Be(Aa)),nT("design:paramtypes",[Object])],xc);let $m=!1;const rT=new we((n,e,t,i)=>{$m||($m=!0,n(xm).to(xc).inSingletonScope(),n(fn).toService(xm))});class J0 extends tn{contains(e,t,i){const{pickContext:r}=i??{};if(!r)return!1;const o=e.getGraphicTheme();r.highPerformanceSave();const s=this.transform(e,o,r),{x:l,y:a,z:d,lastModelMatrix:u}=s;let h=t;if(r.camera){h=t.clone();const g=e.parent.globalTransMatrix;h.x=g.a*t.x+g.c*t.y+g.e,h.y=g.b*t.x+g.d*t.y+g.f}this.canvasRenderer.z=d;let c=!1;return this.canvasRenderer.drawShape(e,r,l,a,i,null,(g,f,p)=>!!c||(c=g.isPointInPath(h.x,h.y),c)),this.canvasRenderer.z=0,r.modelMatrix!==u&&ft.free(r.modelMatrix),r.modelMatrix=u,r.highPerformanceRestore(),c}}var oT=function(n,e,t,i){var r,o=arguments.length,s=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,e,t,i);else for(var l=n.length-1;l>=0;l--)(r=n[l])&&(s=(o<3?r(s):o>3?r(e,t,s):r(e,t))||s);return o>3&&s&&Object.defineProperty(e,t,s),s},sT=function(n,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,e)},lT=function(n,e){return function(t,i){e(t,i,n)}};let Rc=class extends J0{constructor(n){super(),this.canvasRenderer=n,this.type="symbol",this.numberType=iu}contains(n,e,t){const{pickContext:i}=t??{};if(!i)return!1;const r=n.getParsedPath();if(!i.camera){if(!n.AABBBounds.containsPoint(e))return!1;if(r.isSvg||n.attribute.pickMode==="imprecise")return!0}i.highPerformanceSave();const o=n.getGraphicTheme(),s=this.transform(n,o,i),{x:l,y:a,z:d,lastModelMatrix:u}=s;let h=e;if(i.camera){h=e.clone();const g=n.parent.globalTransMatrix;h.x=g.a*e.x+g.c*e.y+g.e,h.y=g.b*e.x+g.d*e.y+g.f}this.canvasRenderer.z=d;let c=!1;return this.canvasRenderer.drawShape(n,i,l,a,{},null,(g,f,p)=>!!c||(c=g.isPointInPath(h.x,h.y),c),(g,f,p)=>{if(c)return!0;const m=f.lineWidth||p.lineWidth,b=f.pickStrokeBuffer||p.pickStrokeBuffer,C=f.keepStrokeScale||p.keepStrokeScale;return i.lineWidth=C?m+b:Bi(i,m+b,i.dpr),c=g.isPointInStroke(h.x,h.y),c}),this.canvasRenderer.z=0,i.modelMatrix!==u&&ft.free(i.modelMatrix),i.modelMatrix=u,i.highPerformanceRestore(),c}};Rc=oT([se(),lT(0,Be(Pa)),sT("design:paramtypes",[Object])],Rc);let Km=!1;const aT=new we((n,e,t,i)=>{Km||(Km=!0,n(Bm).to(Rc).inSingletonScope(),n(fn).toService(Bm))});var dT=function(n,e,t,i){var r,o=arguments.length,s=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,e,t,i);else for(var l=n.length-1;l>=0;l--)(r=n[l])&&(s=(o<3?r(s):o>3?r(e,t,s):r(e,t))||s);return o>3&&s&&Object.defineProperty(e,t,s),s},uT=function(n,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,e)},hT=function(n,e){return function(t,i){e(t,i,n)}};let Ac=class extends Mi{constructor(n){super(),this.canvasRenderer=n,this.type="circle",this.numberType=Qd}};Ac=dT([se(),hT(0,Be(Ra)),uT("design:paramtypes",[Object])],Ac);let Ym=!1;const cT=new we((n,e,t,i)=>{Ym||(Ym=!0,n(vm).to(Ac).inSingletonScope(),n(fn).toService(vm))});var fT=function(n,e,t,i){var r,o=arguments.length,s=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,e,t,i);else for(var l=n.length-1;l>=0;l--)(r=n[l])&&(s=(o<3?r(s):o>3?r(e,t,s):r(e,t))||s);return o>3&&s&&Object.defineProperty(e,t,s),s},gT=function(n,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,e)},pT=function(n,e){return function(t,i){e(t,i,n)}};let Bc=class extends J0{constructor(n){super(),this.canvasRenderer=n,this.type="text",this.numberType=ru}contains(n,e,t){const{pickContext:i}=t??{};if(!i)return!1;const r=n.AABBBounds;if(!i.camera)return!!r.containsPoint(e);i.highPerformanceSave();const o=n.getGraphicTheme(),{keepDirIn3d:s=o.keepDirIn3d}=n.attribute,l=!s,a=this.transform(n,o,i,l),{x:d,y:u,z:h,lastModelMatrix:c}=a;this.canvasRenderer.z=h;let g=e;if(i.camera){g=e.clone();const p=n.parent.globalTransMatrix;g.x=p.a*e.x+p.c*e.y+p.e,g.y=p.b*e.x+p.d*e.y+p.f}let f=!1;return this.canvasRenderer.drawShape(n,i,d,u,{},null,(p,m,b)=>{if(f)return!0;const{fontSize:C=o.fontSize,textBaseline:_=o.textBaseline,textAlign:w=o.textAlign}=n.attribute,y=n.AABBBounds,v=y.height(),x=y.width(),S=Es(_,v,C),R=So(w,x);return p.rect(R+d,S+u,x,v,h),f=p.isPointInPath(g.x,g.y),f},(p,m,b)=>f),this.canvasRenderer.z=0,i.modelMatrix!==c&&ft.free(i.modelMatrix),i.modelMatrix=c,i.highPerformanceRestore(),f}};Bc=fT([se(),pT(0,Be(Zh)),gT("design:paramtypes",[Object])],Bc);let Xm=!1;const mT=new we((n,e,t,i)=>{Xm||(Xm=!0,n(Mm).to(Bc).inSingletonScope(),n(fn).toService(Mm))});var bT=function(n,e,t,i){var r,o=arguments.length,s=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,e,t,i);else for(var l=n.length-1;l>=0;l--)(r=n[l])&&(s=(o<3?r(s):o>3?r(e,t,s):r(e,t))||s);return o>3&&s&&Object.defineProperty(e,t,s),s},CT=function(n,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,e)},_T=function(n,e){return function(t,i){e(t,i,n)}};let Mc=class extends Z0{constructor(n){super(),this.canvasRenderer=n,this.type="path",this.numberType=tu}};Mc=bT([se(),_T(0,Be(Ba)),CT("design:paramtypes",[Object])],Mc);let qm=!1;const wT=new we((n,e,t,i)=>{qm||(qm=!0,n(Rm).to(Mc).inSingletonScope(),n(fn).toService(Rm))});var yT=function(n,e,t,i){var r,o=arguments.length,s=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,e,t,i);else for(var l=n.length-1;l>=0;l--)(r=n[l])&&(s=(o<3?r(s):o>3?r(e,t,s):r(e,t))||s);return o>3&&s&&Object.defineProperty(e,t,s),s},vT=function(n,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,e)},ST=function(n,e){return function(t,i){e(t,i,n)}};let Tc=class extends Mi{constructor(n){super(),this.canvasRenderer=n,this.type="polygon",this.numberType=nu}};Tc=yT([se(),ST(0,Be(Ma)),vT("design:paramtypes",[Object])],Tc);let Zm=!1;const xT=new we((n,e,t,i)=>{Zm||(Zm=!0,n(Tm).to(Tc).inSingletonScope(),n(fn).toService(Tm))});var RT=function(n,e,t,i){var r,o=arguments.length,s=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,e,t,i);else for(var l=n.length-1;l>=0;l--)(r=n[l])&&(s=(o<3?r(s):o>3?r(e,t,s):r(e,t))||s);return o>3&&s&&Object.defineProperty(e,t,s),s},AT=function(n,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,e)},BT=function(n,e){return function(t,i){e(t,i,n)}};let Pc=class{constructor(n){this.canvasRenderer=n,this.type="richtext",this.numberType=Hf}contains(n,e,t){return!!n.AABBBounds.containsPoint(e)}};Pc=RT([se(),BT(0,Be(Jh)),AT("design:paramtypes",[Object])],Pc);let Jm=!1;const MT=new we((n,e,t,i)=>{Jm||(Jm=!0,n(Pm).to(Pc).inSingletonScope(),n(fn).toService(Pm))});var TT=function(n,e,t,i){var r,o=arguments.length,s=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,e,t,i);else for(var l=n.length-1;l>=0;l--)(r=n[l])&&(s=(o<3?r(s):o>3?r(e,t,s):r(e,t))||s);return o>3&&s&&Object.defineProperty(e,t,s),s};let Hc=class{constructor(){this.type="image",this.numberType=eu}contains(n,e,t){const{pickContext:i}=t??{};return!!i&&!!n.AABBBounds.containsPoint(e)}};Hc=TT([se()],Hc);let Qm=!1;const PT=new we((n,e,t,i)=>{Qm||(Qm=!0,n(Sm).to(Hc).inSingletonScope(),n(fn).toService(Sm))}),ii=Vf();function Ya(){Ya.__loaded||(Ya.__loaded=!0,SB(),Ce.load(hB),Ce.load(ii?qM:lM))}Ya.__loaded=!1;const HT=Ya;function Xa(){Xa.__loaded||(Xa.__loaded=!0,xB(),Ce.load(pB),Ce.load(ii?cT:hM))}Xa.__loaded=!1;const Q0=Xa;function qa(){qa.__loaded||(qa.__loaded=!0,RB())}qa.__loaded=!1;const nn=qa;function Za(){Za.__loaded||(Za.__loaded=!0,AB(),Ce.load(vB),Ce.load(ii?PT:fM))}Za.__loaded=!1;const du=Za;function Ja(){Ja.__loaded||(Ja.__loaded=!0,BB(),Ce.load(fB),Ce.load(ii?rT:bM))}Ja.__loaded=!1;const jf=Ja;function Qa(){Qa.__loaded||(Qa.__loaded=!0,MB(),Ce.load(bB),Ce.load(ii?wT:RM))}Qa.__loaded=!1;const kT=Qa;function ed(){ed.__loaded||(ed.__loaded=!0,TB(),Ce.load(CB),Ce.load(ii?xT:yM))}ed.__loaded=!1;const ET=ed;function td(){td.__loaded||(td.__loaded=!0,PB(),Ce.load(cB),Ce.load(ii?eT:TM))}td.__loaded=!1;const Ti=td;function nd(){nd.__loaded||(nd.__loaded=!0,HB(),Ce.load(yB),Ce.load(ii?MT:PM))}nd.__loaded=!1;const uu=nd;function id(){id.__loaded||(id.__loaded=!0,LB())}id.__loaded=!1;const LT=id;function rd(){rd.__loaded||(rd.__loaded=!0,kB(),Ce.load(gB),Ce.load(ii?aT:LM))}rd.__loaded=!1;const Oo=rd;function od(){od.__loaded||(od.__loaded=!0,EB(),Ce.load(mB),Ce.load(ii?mT:zM))}od.__loaded=!1;const ri=od;function sd(){sd.__loaded||(sd.__loaded=!0,FB())}sd.__loaded=!1;const FT=sd;function ew(){nn(),Ti()}const tw="PingFang SC,Helvetica Neue,Microsoft Yahei,system-ui,-apple-system,segoe ui,Roboto,Helvetica,Arial,sans-serif,apple color emoji,segoe ui emoji,segoe ui symbol",zT=14;var jt;(function(n){n.selected="selected",n.selectedReverse="selected_reverse",n.hover="hover",n.hoverReverse="hover_reverse"})(jt||(jt={}));const Vr={[jt.selectedReverse]:{},[jt.selected]:{},[jt.hover]:{},[jt.hoverReverse]:{}},eb={container:"",width:30,height:30,style:{}},IT="scrollDrag",tb={debounce:Sv,throttle:I_};ew();class kr extends gn{constructor(e,t){super(t!=null&&t.skipDefault?e:re({},kr.defaultAttributes,e)),this.name="scrollbar",this._onRailPointerDown=i=>{const{viewX:r,viewY:o}=i,{direction:s,width:l,height:a,range:d}=this.attribute,u=this._sliderSize,[h,c]=this._getScrollRange();let g;if(s==="vertical"){const f=o-this._viewPosition.y,p=Fn(f-u/2,h,c);g=f/a,this._slider.setAttribute("y",p,!0)}else{const f=r-this._viewPosition.x,p=Fn(f-u/2,h,c);g=f/l,this._slider.setAttribute("x",p,!0)}this.setScrollRange([g-(d[1]-d[0])/2,g+(d[1]-d[0])/2],!1),this.stage&&!this.stage.autoRender&&this.stage.renderNextFrame()},this._onSliderPointerDown=i=>{const{stopSliderDownPropagation:r=!0}=this.attribute;r&&i.stopPropagation();const{direction:o}=this.attribute,{x:s,y:l}=this.stage.eventPointTransform(i);this._prePos=o==="horizontal"?s:l,this._dispatchEvent("scrollDown",{pos:this._prePos,event:i}),et.env==="browser"?(et.addEventListener("pointermove",this._onSliderPointerMoveWithDelay,{capture:!0}),et.addEventListener("pointerup",this._onSliderPointerUp)):(this.stage.addEventListener("pointermove",this._onSliderPointerMoveWithDelay,{capture:!0}),this.stage.addEventListener("pointerup",this._onSliderPointerUp),this.stage.addEventListener("pointerupoutside",this._onSliderPointerUp))},this._computeScrollValue=i=>{const{direction:r}=this.attribute,{x:o,y:s}=this.stage.eventPointTransform(i);let l,a,d=0;const{width:u,height:h}=this.getSliderRenderBounds();return r==="vertical"?(a=s,d=a-this._prePos,l=d/h):(a=o,d=a-this._prePos,l=d/u),[a,l]},this._onSliderPointerMove=i=>{const{stopSliderMovePropagation:r=!0}=this.attribute;r&&i.stopPropagation();const o=this.getScrollRange(),[s,l]=this._computeScrollValue(i);this.setScrollRange([o[0]+l,o[1]+l],!0),this._prePos=s},this._onSliderPointerMoveWithDelay=this.attribute.delayTime===0?this._onSliderPointerMove:tb[this.attribute.delayType](this._onSliderPointerMove,this.attribute.delayTime),this._onSliderPointerUp=i=>{i.preventDefault();const{realTime:r=!0,range:o,limitRange:s=[0,1]}=this.attribute,l=this.getScrollRange(),[a,d]=this._computeScrollValue(i),u=[l[0]+d,l[1]+d];this._dispatchEvent("scrollUp",{pre:o,value:lr(u,s[0],s[1])}),et.env==="browser"?(et.removeEventListener("pointermove",this._onSliderPointerMoveWithDelay,{capture:!0}),et.removeEventListener("pointerup",this._onSliderPointerUp)):(this.stage.removeEventListener("pointermove",this._onSliderPointerMoveWithDelay,{capture:!0}),this.stage.removeEventListener("pointerup",this._onSliderPointerUp),this.stage.removeEventListener("pointerupoutside",this._onSliderPointerUp))}}setScrollRange(e,t=!0){const{direction:i="horizontal",limitRange:r=[0,1],range:o,realTime:s=!0}=this.attribute,l=lr(e,r[0],r[1]);if(t){const a=this._getSliderPos(l);if(this._slider){const d=a[1]-a[0];this._sliderSize=d,i==="horizontal"?this._slider.setAttributes({x:a[0],width:d},!0):this._slider.setAttributes({y:a[0],height:d},!0),this.stage&&!this.stage.autoRender&&this.stage.renderNextFrame()}}this.attribute.range=l,s&&this._dispatchEvent(IT,{pre:o,value:l})}getScrollRange(){return this.attribute.range}bindEvents(){if(this.attribute.disableTriggerEvent)return;const{delayType:e="throttle",delayTime:t=0}=this.attribute;this._rail&&this._rail.addEventListener("pointerdown",tb[e](this._onRailPointerDown,t)),this._slider&&this._slider.addEventListener("pointerdown",this._onSliderPointerDown)}render(){this._reset();const{direction:e="horizontal",width:t,height:i,range:r,limitRange:o=[0,1],railStyle:s,sliderStyle:l,padding:a=2}=this.attribute,d=this.createOrUpdateChild("scrollbar-container",{},"group"),u=d.createOrUpdateChild("scrollbar-rail",Object.assign({x:0,y:0,width:t,height:i},s),"rect");this._rail=u;const h=this.getSliderRenderBounds(),c=this._getSliderPos(lr(r,o[0],o[1])),g=c[1]-c[0];let f;this._sliderSize=g,f=e==="horizontal"?{x:c[0],y:h.y1,width:g,height:h.height}:{x:h.x1,y:c[0],width:h.width,height:g};const p=d.createOrUpdateChild("slider",Object.assign(Object.assign(Object.assign(Object.assign({},f),{cornerRadius:this._getDefaultSliderCornerRadius()}),l),{boundsPadding:ei(a),pickMode:"imprecise"}),"rect");this._slider=p,this._container=d;const m=this._container.AABBBounds;this._viewPosition={x:m.x1,y:m.y1}}getSliderRenderBounds(){if(this._sliderRenderBounds)return this._sliderRenderBounds;const{width:e,height:t,padding:i=2}=this.attribute,[r,o,s,l]=ei(i),a={x1:l,y1:r,x2:e-o,y2:t-s,width:Math.max(0,e-(l+o)),height:Math.max(0,t-(r+s))};return this._sliderRenderBounds=a,a}_getDefaultSliderCornerRadius(){const{direction:e,round:t}=this.attribute;if(t){const{width:i,height:r}=this.getSliderRenderBounds();return e==="horizontal"?r:i}return 0}_getSliderPos(e){const{direction:t}=this.attribute,{width:i,height:r,x1:o,y1:s}=this.getSliderRenderBounds();return t==="horizontal"?[i*e[0]+o,i*e[1]+o]:[r*e[0]+s,r*e[1]+s]}_getScrollRange(){if(this._sliderLimitRange)return this._sliderLimitRange;const{limitRange:e=[0,1],direction:t}=this.attribute,[i,r]=lr(e,0,1),{width:o,height:s,x1:l,y1:a}=this.getSliderRenderBounds(),d=this._sliderSize;return t==="horizontal"?lr([l+i*o,l+r*o],l,o-d):lr([a+i*s,a+r*s],a,s-d)}_reset(){this._sliderRenderBounds=null,this._sliderLimitRange=null}}kr.defaultAttributes={direction:"horizontal",round:!0,sliderSize:20,sliderStyle:{fill:"rgba(0, 0, 0, .5)"},railStyle:{fill:"rgba(0, 0, 0, .0)"},padding:2,scrollRange:[0,1],delayType:"throttle",delayTime:0,realTime:!0};function To(n,e){n.forEachChildren(t=>{const i=e(t);t.isContainer&&!i&&To(t,e)})}function nw(n,e){return[n[0]*e,n[1]*e]}function iw(n){const[e,t]=n;return Math.sqrt(e*e+t*t)}function OT(n){let e=iw(n);return e>0&&(e=1/e),[n[0]*e,n[1]*e]}function DT(n,e){const[t,i]=n,[r,o]=e,s=Math.sqrt((t*t+i*i)*(r*r+o*o)),l=s&&(t*r+i*o)/s;return Math.acos(Math.min(Math.max(l,-1),1))}function WT(n,e,t){const i=DT(n,e),r=xv(n,e)>=0;return t?r?2*Math.PI-i:i:r?i:2*Math.PI-i}const rw=(n,e,t,i)=>new yi(Object.assign({defaultFontParams:Object.assign({fontFamily:tw,fontSize:zT},i),getTextBounds:su,specialCharSet:`-/: .,@%'"~`+yi.ALPHABET_CHAR_SET+yi.ALPHABET_CHAR_SET.toUpperCase()},{}),n);function hu(n,e,t={}){if(!n)return{width:0,height:0};const i=su({text:n,fontFamily:e.fontFamily||t.fontFamily||tw,fontSize:e.fontSize||t.fontSize||12,fontWeight:e.fontWeight||t.fontWeight,textAlign:e.textAlign||"center",textBaseline:e.textBaseline,ellipsis:!!e.ellipsis,maxLineWidth:e.maxLineWidth||1/0,lineHeight:e.fontSize||t.fontSize||12});return{width:i.width(),height:i.height()}}function NT(n,e="type"){return ow(n,e)==="rich"}function ow(n,e="type"){var t,i;return ke(n.text)&&"type"in n.text?(t=n.text.type)!==null&&t!==void 0?t:"text":e in n&&(i=n[e])!==null&&i!==void 0?i:"text"}function sw(n){var e,t;return O(n.maxLineWidth)&&(n.maxWidth=n.maxLineWidth,delete n.maxLineWidth),n.width=(e=n.width)!==null&&e!==void 0?e:0,n.height=(t=n.height)!==null&&t!==void 0?t:0,n.textConfig=n.text.text||n.text,n}function VT(n){const{text:e,_originText:t}=n,{text:i}=e;return n.html=i,n.text=t,n.renderable=!1,n}function GT(n){const{text:e,_originText:t}=n,{text:i}=e;return n.react=i,n.text=t,n.renderable=!1,n}function kc(n,e="type"){const t=ow(n,e);return t==="rich"?ge.richtext(sw(n)):(t==="html"?n=VT(n):t==="react"&&(n=GT(n)),ge.text(n))}function lw(){nn(),Ti(),Oo(),uu(),ri()}var nb=function(n,e){var t={};for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&e.indexOf(i)<0&&(t[i]=n[i]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function"){var r=0;for(i=Object.getOwnPropertySymbols(n);r<i.length;r++)e.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(n,i[r])&&(t[i[r]]=n[i[r]])}return t};lw();let ll=class Ec extends gn{getBgRect(){return this._bgRect}getTextShape(){return this._textShape}constructor(e,t){super(t!=null&&t.skipDefault?e:re({},Ec.defaultAttributes,e)),this.name="tag",this._tagStates=[],this._rectStates=[],this._symbolStates=[],this._textStates=[]}render(){var e,t,i;this.cacheStates();const{text:r="",textStyle:o={},shape:s={},panel:l={},space:a=4,minWidth:d,maxWidth:u,padding:h=4,visible:c,state:g,type:f,textAlwaysCenter:p,containerTextAlign:m}=this.attribute,b=ei(h),C=this.createOrUpdateChild("tag-content",{x:0,y:0,zIndex:1},"group");let _,w=-b[3],y=-b[0],v=b[1]+b[3],x=b[0]+b[2],S=0,R=0;const{visible:B}=s,A=nb(s,["visible"]);if(kt(B)){const T=(A==null?void 0:A.size)||10,P=J(T)?T:Math.max(T[0],T[1]);_=C.createOrUpdateChild("tag-shape",Object.assign(Object.assign({symbolType:"circle",size:T,strokeBoundsBuffer:0},A),{visible:B,x:P/2,y:P/2}),"symbol"),ye(g==null?void 0:g.shape)||(_.states=g.shape),B&&(R=P+a)}let M;if(v+=R,S+=R,NT({text:r})||f==="rich"){const T=Object.assign(Object.assign(Object.assign({},sw(Object.assign({type:f,text:r},o))),o),{visible:O(r)&&c!==!1,x:S,y:0});M=C.createOrUpdateChild("tag-text",T,"richtext"),v+=M.AABBBounds.width(),x+=M.AABBBounds.height(),w+=M.AABBBounds.x1,y+=M.AABBBounds.y1}else{const T=Object.assign(Object.assign({text:ke(r)&&"type"in r&&r.type==="text"?r.text:r,visible:O(r)&&c!==!1,lineHeight:o==null?void 0:o.fontSize},o),{x:S,y:0});Te(T.lineHeight)&&(T.lineHeight=o.fontSize),M=C.createOrUpdateChild("tag-text",T,"text"),ye(g==null?void 0:g.text)||(M.states=g.text);const P=hu(T.text,o,(t=(e=this.stage)===null||e===void 0?void 0:e.getTheme())===null||t===void 0?void 0:t.text),k=P.width,L=P.height;v+=k;const F=(i=s.size)!==null&&i!==void 0?i:10,z=J(F)?F:Math.max(F[0],F[1]);x+=Math.max(L,s.visible?z:0);const{textAlign:I,textBaseline:N}=o;(O(d)||O(u))&&(O(d)&&v<d&&(v=d),O(u)&&v>u&&(v=u,M.setAttribute("maxLineWidth",u-b[1]-b[2]))),w=0,y=0;let W=0;I==="left"||I==="start"?W=1:I==="right"||I==="end"?W=-1:I==="center"&&(W=0),W?W<0?(w-=v,_&&_.setAttribute("x",(_.attribute.x||0)-k),C.setAttribute("x",-b[1]-R)):W>0&&C.setAttribute("x",b[3]):(w-=v/2,_&&_.setAttribute("x",(_.attribute.x||0)-k/2),C.setAttribute("x",-R/2));const D=m==="right"||m==="end",G=m==="left"||m==="start";if((m?m==="center":p)&&W){const V=v-b[1]-b[3],X=k+R,$=W===1?(V-X)/2+R+k/2:b[0]+R-(v/2+X/2-R)+k/2;if(M.setAttributes({x:$,textAlign:"center"}),_){const Q=$-k/2-R+z/2;_.setAttributes({x:Q})}}if(G&&W!==1){const V=v-b[1]-b[3],X=W===0?-V/2+R/2:-v+b[3]+b[1]+R,$=X+R;if(M.setAttributes({x:$,textAlign:"left"}),_){const Q=X+z/2;_.setAttributes({x:Q})}}if(D&&W!==-1){const V=v-b[1]-b[3],X=W===0?V/2+R/2:V;if(M.setAttributes({x:X,textAlign:"right"}),_){const $=X-k-R+z/2;_.setAttributes({x:$})}}N==="middle"?(y-=x/2,_&&_.setAttribute("y",0)):N==="bottom"?(y-=x,_&&_.setAttribute("y",-L/2),C.setAttribute("y",-b[2])):N==="top"&&(C.setAttribute("y",b[0]),_&&_.setAttribute("y",L/2))}const{visible:H}=l,E=nb(l,["visible"]);if(c&&kt(H)){const T=this.createOrUpdateChild("tag-panel",Object.assign(Object.assign({},E),{visible:H&&!!r,width:v,height:x,x:w,y}),"rect");if(ye(g==null?void 0:g.panel)||(T.states=g.panel),E.customShape){const P=E.customShape;T.pathProxy=k=>P(this,k,new Bt)}this._bgRect=T}this._textShape=M,this._symbol=_,this.resetStates()}initAttributes(e,t){e=t!=null&&t.skipDefault?e:re({},Ec.defaultAttributes,e),super.initAttributes(e),this.render()}addState(e,t,i){super.addState(e,t,i),this._textShape&&this._textShape.addState(e,t,i),this._bgRect&&this._bgRect.addState(e,t,i),this._symbol&&this._symbol.addState(e,t,i)}removeState(e,t){super.removeState(e,t),this._textShape&&this._textShape.removeState(e,t),this._bgRect&&this._bgRect.removeState(e,t),this._symbol&&this._symbol.removeState(e,t)}cacheStates(){var e,t,i,r,o,s,l,a,d,u,h,c,g,f;this._tagStates=(t=(e=this.currentStates)===null||e===void 0?void 0:e.slice())!==null&&t!==void 0?t:[],this._rectStates=(o=(r=(i=this._bgRect)===null||i===void 0?void 0:i.currentStates)===null||r===void 0?void 0:r.slice())!==null&&o!==void 0?o:[],this._symbolStates=(a=(l=(s=this._symbol)===null||s===void 0?void 0:s.currentStates)===null||l===void 0?void 0:l.slice())!==null&&a!==void 0?a:[],this._textStates=(h=(u=(d=this._textShape)===null||d===void 0?void 0:d.currentStates)===null||u===void 0?void 0:u.slice())!==null&&h!==void 0?h:[],this.clearStates(),(c=this._bgRect)===null||c===void 0||c.clearStates(),(g=this._symbol)===null||g===void 0||g.clearStates(),(f=this._textShape)===null||f===void 0||f.clearStates()}resetStates(){var e,t,i;this._tagStates.length&&this.useStates(this._tagStates),this._rectStates.length&&((e=this._bgRect)===null||e===void 0||e.useStates(this._rectStates)),this._symbolStates.length&&((t=this._symbol)===null||t===void 0||t.useStates(this._symbolStates)),this._textStates.length&&((i=this._textShape)===null||i===void 0||i.useStates(this._textStates))}};ll.defaultAttributes={visible:!0,textStyle:{fontSize:12,fill:"#000",textAlign:"left",textBaseline:"top"},space:4,padding:4,shape:{fill:"#000"}};const aw={visible:!0,position:"auto",titleStyle:{fontSize:16,fill:"#08979c"},contentStyle:{fontSize:12,fill:"green"},panel:{visible:!0,fill:"#e6fffb",size:12,space:0,stroke:"#87e8de",lineWidth:1,cornerRadius:4}},dw={poptip:re({},aw)};function jT(){nn(),ri(),Oo(),Ti()}function UT(n){re(dw.poptip,aw,n)}var $T=function(n,e){var t={};for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&e.indexOf(i)<0&&(t[i]=n[i]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function"){var r=0;for(i=Object.getOwnPropertySymbols(n);r<i.length;r++)e.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(n,i[r])&&(t[i[r]]=n[i[r]])}return t};const ib=new Ue;jT();class Vs extends gn{constructor(e,t){super(t!=null&&t.skipDefault?e:re({},Vs.defaultAttributes,e)),this.name="poptip",this.positionList=["top","tl","tr","bottom","bl","br","left","lt","lb","right","rt","rb"]}render(){var e,t,i,r,o,s,l,a;const{titleStyle:d={},position:u,contentStyle:h={},panel:c={},space:g=4,minWidth:f=0,maxWidth:p=1/0,padding:m=4,maxWidthPercent:b,visible:C,state:_,dx:w=0,dy:y=0}=this.attribute;let{title:v="",content:x=""}=this.attribute;v=this.attribute.titleFormatMethod?this.attribute.titleFormatMethod(v):v,x=this.attribute.contentFormatMethod?this.attribute.contentFormatMethod(x):x;const S=ei(m),R=this.createOrUpdateChild("poptip-content",{x:0,y:0,zIndex:1},"group"),B=p-S[1]-S[3],A=O(v)&&C!==!1,M=Object.assign(Object.assign({text:ee(v)?v:[v],visible:A,wrap:!0},d),{x:S[3],y:S[0],maxLineWidth:B,textAlign:"left",textBaseline:"top"}),H=R.createOrUpdateChild("poptip-title",M,"text");ye(_==null?void 0:_.title)||(H.states=_.title);const E=H.AABBBounds,T=E.height(),P=E.width();let k=T+g;A||(k=0);const L=O(x)&&C!==!1,F=Object.assign(Object.assign({text:ee(x)?x:[x],visible:L,wrap:!0},h),{x:S[3],y:S[0]+k,maxLineWidth:B,textAlign:"left",textBaseline:"top"}),z=R.createOrUpdateChild("poptip-content",F,"text");ye(_==null?void 0:_.content)||(z.states=_.content);const I=z.AABBBounds,N=I.height(),W=I.width();L&&(k+=N);let D=Ji(P+S[1]+S[3],W+S[1]+S[3]);D>p?D=p:D<f&&(D=f);let G=S[0]+S[2]+k;const{visible:V}=c,X=$T(c,["visible"]),$=(e=X.size)!==null&&e!==void 0?e:12,Q=ee($)?[$[0]+((t=X.space)!==null&&t!==void 0?t:0),$[1]+((i=X.space)!==null&&i!==void 0?i:0)]:$+((r=X.space)!==null&&r!==void 0?r:0),te=(o=X.lineWidth)!==null&&o!==void 0?o:1,le=this.stage?[(s=this.stage.viewWidth)!==null&&s!==void 0?s:this.stage.width,(l=this.stage.viewHeight)!==null&&l!==void 0?l:this.stage.height]:void 0;if(le){const ce=this.AABBBounds,ae=(a=this.attribute.x)!==null&&a!==void 0?a:ce.x1,q=le[0]-ce.x1;let _e=Math.max(ae,q);const oe=(ee($)?$[0]:12)+3;if(_e=Math.min(_e-oe,_e*b),_e<D){D=_e;const Y=S[1]+S[3];H.setAttribute("maxLineWidth",_e-Y),z.setAttribute("maxLineWidth",_e-Y),G=S[0]+S[2],A&&(G+=H.AABBBounds.height()+g),G+=z.AABBBounds.height()}}const fe=u==="auto";let ne,ie=-1/0;for(let ce=0;ce<this.positionList.length+1;ce++){const ae=fe?this.positionList[ce===this.positionList.length?ne:ce]:u,{angle:q,offset:_e,rectOffset:oe}=this.getAngleAndOffset(ae,D,G,ee(Q)?Q:[Q,Q-te]);if(kt(V)){const Y=(ee($)?$[0]:$)/4,de=R.createOrUpdateChild("poptip-symbol-panel",Object.assign(Object.assign({},X),{visible:V&&(L||A),x:Y,y:0,strokeBoundsBuffer:-1,boundsPadding:-2,anchor:[0,0],symbolType:"arrow2Left",angle:q,dx:_e[0],dy:_e[1],size:$,zIndex:-9}),"symbol");ye(_==null?void 0:_.panel)||(de.states=_.panel);const K=R.createOrUpdateChild("poptip-rect-panel",Object.assign(Object.assign({},X),{visible:V&&(L||A),x:0,y:0,width:D,height:G,zIndex:-8}),"rect");ye(_==null?void 0:_.panel)||(K.states=_.panel)}if(R.setAttributes({x:-_e[0]+w,y:-_e[1]+y}),!fe||!le)break;{ib.setValue(0,0,D,G).transformWithMatrix(R.globalTransMatrix);const Y=ib,de=new Ri().setValue(0,0,le[0],le[1]);if(Rv(Y,de,!1))break;{const K=z_(Y,de,!1),ut=(K.x2-K.x1)*(K.y2-K.y1);ut>ie&&(ie=ut,ne=ce)}}}}getAngleAndOffset(e,t,i,r){const o=r[1]/2;switch(e){case"tl":return{angle:qe/2*3,offset:[t/4,i+o],rectOffset:[-t/4,-i-r[1]]};case"top":return{angle:qe/2*3,offset:[t/2,i+o],rectOffset:[0,-i-r[1]]};case"tr":return{angle:qe/2*3,offset:[t/4*3,i+o],rectOffset:[t/4*3,-i-r[1]]};case"rt":return{angle:0,offset:[-o,i/5],rectOffset:[t/4*3,-i-r[1]]};case"right":return{angle:0,offset:[-o,i/2],rectOffset:[t/4*3,-i-r[1]]};case"rb":return{angle:0,offset:[-o,i/5*4],rectOffset:[t/4*3,-i-r[1]]};case"bl":return{angle:qe/2,offset:[t/4,-o],rectOffset:[-t/4,-i-r[1]]};case"bottom":return{angle:qe/2,offset:[t/2,-o],rectOffset:[0,-i-r[1]]};case"br":return{angle:qe/2,offset:[t/4*3,-o],rectOffset:[t/4*3,-i-r[1]]};case"lt":return{angle:qe,offset:[t+o,i/5],rectOffset:[-t/4,-i-r[1]]};case"left":return{angle:qe,offset:[t+o,i/2],rectOffset:[0,-i-r[1]]};case"lb":return{angle:qe,offset:[t+o,i/5*4],rectOffset:[t/4*3,-i-r[1]]}}}}Vs.defaultAttributes={position:"rt",visible:!0,title:null,content:null,titleStyle:{fontSize:12,fill:"#000",textAlign:"left",textBaseline:"top"},contentStyle:{fontSize:12,fill:"#000",textAlign:"left",textBaseline:"top"},maxWidthPercent:.8,space:8,padding:10};var KT=function(n,e,t,i){var r,o=arguments.length,s=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,e,t,i);else for(var l=n.length-1;l>=0;l--)(r=n[l])&&(s=(o<3?r(s):o>3?r(e,t,s):r(e,t))||s);return o>3&&s&&Object.defineProperty(e,t,s),s};function YT(n,e){return re(n,dw.poptip,e),n}let bs=class{render(n,e,t,i,r,o,s,l,a,d,u,h,c){var g,f;if(n._showPoptip===1){const{visible:p,visibleCb:m}=n.attribute.poptip||{};if(p===!1||m&&m(n)===!1)return;const b={};re(b,Vs.defaultAttributes,n.attribute.poptip?n.attribute.poptip:{}),this.poptipComponent?this.poptipComponent.initAttributes(b):this.poptipComponent=new Vs(b);let C=n.attribute.poptip||{};if(n.type==="text"&&C.title==null&&C.content==null){const y={};YT(y,C),C=y,C.content=(g=C.content)!==null&&g!==void 0?g:n.attribute.text}const _=n.globalTransMatrix;this.poptipComponent.setAttributes(Object.assign(Object.assign({visibleAll:!0,pickable:!1,childrenPickable:!1},C),{x:_.e,y:_.f})),d.stage.tryInitInteractiveLayer();const w=d.stage.getLayer("_builtin_interactive");w&&w.add(this.poptipComponent)}else n._showPoptip===2&&(n._showPoptip=0,this.poptipComponent&&(this.poptipComponent.setAttributes({visibleAll:!1}),(f=this.poptipComponent.parent)===null||f===void 0||f.removeChild(this.poptipComponent),this.poptipComponent=null))}};bs=KT([se()],bs);var uw=function(n,e,t,i){var r,o=arguments.length,s=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,e,t,i);else for(var l=n.length-1;l>=0;l--)(r=n[l])&&(s=(o<3?r(s):o>3?r(e,t,s):r(e,t))||s);return o>3&&s&&Object.defineProperty(e,t,s),s};class hw{constructor(){this.activeEvent="onRegister",this._uid=pt.GenAutoIncrementId(),this.poptip=e=>{const t=e.target;this.needHide(t)?this.unpoptip(e):t!==this.activeGraphic&&(this.needShow(t)&&(t.setAttributes({}),t._showPoptip=1),this.activeGraphic&&(this.activeGraphic.setAttributes({}),this.activeGraphic._showPoptip=2),this.setActiveGraphic(t,!0))},this.unpoptip=e=>{this.activeGraphic&&(this.activeGraphic.setAttributes({}),this.activeGraphic._showPoptip=2,this.setActiveGraphic(null,!0))}}activate(e){this.pluginService=e;const{stage:t}=this.pluginService;t.addEventListener("pointerover",this.poptip)}needHide(e){return e.isContainer||!e.attribute}needShow(e){return!!e.attribute.poptip}setActiveGraphic(e,t){this.activeGraphic=e,this.pluginService.stage.renderNextFrame()}deactivate(e){const{stage:t}=this.pluginService;t.removeEventListener("pointerover",this.poptip)}}let Cs=class extends hw{constructor(){super(...arguments),this.name="poptip",this.key=this.name+this._uid}};Cs=uw([se()],Cs);let _s=class extends hw{constructor(){super(...arguments),this.name="poptipForText",this.key=this.name+this._uid,this.pointerlave=n=>{const{stage:e}=this.pluginService;n.target===e&&this.unpoptip(n)}}activate(n){super.activate(n);const{stage:e}=this.pluginService;e.addEventListener("pointerleave",this.pointerlave)}needHide(n){return n.type!=="text"||!n.cliped||n.isContainer||!n.attribute||n.attribute.disableAutoClipedPoptip}needShow(n){return!0}deactivate(n){const{stage:e}=this.pluginService;super.deactivate(n),e.removeEventListener("pointerleave",this.pointerlave)}};_s=uw([se()],_s);const XT=new we((n,e,t,i)=>{t(bs)||(n(bs).toSelf().inSingletonScope(),n(Lf).toService(bs)),t(Cs)||(n(Cs).toSelf(),n(Ws).toService(Cs)),t(_s)||(n(_s).toSelf(),n(Ws).toService(_s))});function qT(){Ce.load(XT)}function ZT(){nn(),jf(),ET(),Oo()}ZT();class cu extends gn{getStartAngle(){return mg(this._startAngle)}getEndAngle(){return mg(this._endAngle)}getMainSegmentPoints(){return this._mainSegmentPoints}constructor(e,t){super(t!=null&&t.skipDefault?e:re({},cu.defaultAttributes,e)),this.name="segment",this.key="segment",this.lines=[]}render(){this.removeAllChild(!0),this._reset();const{startSymbol:e,endSymbol:t,lineStyle:i,state:r,visible:o=!0,multiSegment:s,mainSegmentIndex:l}=this.attribute;if(!o)return;this._computeLineAngle();const a=this._getMainSegmentPoints(),d=this._renderSymbol(e,a,"start"),u=this._renderSymbol(t,a,"end");if(this.startSymbol=d,this.endSymbol=u,s){const h=[...this.attribute.points];if(Xe(l))h[l]=this._clipPoints(h[l]);else{const c=this._clipPoints(bg(h));h[0][0]=c[0],h[h.length-1][h[h.length-1].length-1]=c[c.length-1]}h.forEach((c,g)=>{var f,p;const m=ge.line(Object.assign(Object.assign({points:c},ee(i)?(f=i[g])!==null&&f!==void 0?f:i[i.length-1]:i),{fill:!1}));m.name=`${this.name}-line`,m.id=this._getNodeId("line"+g),ye(r==null?void 0:r.line)||(m.states=ee(r.line)?(p=r.line[g])!==null&&p!==void 0?p:r.line[r.line.length-1]:r.line),this.add(m),this.lines.push(m)})}else{let h=ge.line;xh(i)[0].cornerRadius&&(h=ge.polygon);const c=h(Object.assign(Object.assign({points:this._clipPoints(this.attribute.points)},xh(i)[0]),{fill:!1,closePath:!1}));c.name=`${this.name}-line`,c.id=this._getNodeId("line"),ye(r==null?void 0:r.line)||(c.states=[].concat(r.line)[0]),this.add(c),this.lines.push(c)}}_computeStartRotate(e){return e+Math.PI/2}_computeEndRotate(e){return e+Math.PI/2}_renderSymbol(e,t,i){if(!t.length)return;const{autoRotate:r=!0}=e;let o;if(e&&e.visible){const s=this.getStartAngle(),l=this.getEndAngle(),{state:a}=this.attribute,d=t[0],u=t[t.length-1],{refX:h=0,refY:c=0,refAngle:g=0,style:f,symbolType:p,size:m=12}=e;let b,C;i==="start"?(b={x:d.x+(Xe(s)?h*Math.cos(s)+c*Math.cos(s-Math.PI/2):0),y:d.y+(Xe(s)?h*Math.sin(s)+c*Math.sin(s-Math.PI/2):0)},C=this._computeStartRotate(this._startAngle)):(b={x:u.x+(Xe(l)?h*Math.cos(l)+c*Math.cos(l-Math.PI/2):0),y:u.y+(Xe(l)?h*Math.sin(l)+c*Math.sin(l-Math.PI/2):0)},C=this._computeEndRotate(this._endAngle)),o=ge.symbol(Object.assign(Object.assign(Object.assign({},b),{symbolType:p,size:m,angle:r?C+g:0,strokeBoundsBuffer:0}),f)),o.name=`${this.name}-${i}-symbol`,o.id=this._getNodeId(`${i}-symbol`),ye(a==null?void 0:a.symbol)||(o.states=a.symbol),i==="start"?ye(a==null?void 0:a.startSymbol)||(o.states=a.startSymbol):ye(a==null?void 0:a.endSymbol)||(o.states=a.endSymbol),this.add(o)}return o}_getMainSegmentPoints(){if(this._mainSegmentPoints)return this._mainSegmentPoints;const{points:e,multiSegment:t,mainSegmentIndex:i}=this.attribute;let r;return r=t?Xe(i)?e[i]:bg(e):e,this._mainSegmentPoints=r,r}_clipPoints(e){const{startSymbol:t={},endSymbol:i={}}=this.attribute;let r=e;if(t.visible){const o=t.clip?t.size||10:0;r=[{x:e[0].x-o/2*(Math.cos(this._startAngle)||0),y:e[0].y-o/2*(Math.sin(this._startAngle)||0)},...r.slice(1)]}if(i.visible){const o=i.clip?i.size||10:0,s={x:e[e.length-1].x-o/2*(Math.cos(this._endAngle)||0),y:e[e.length-1].y-o/2*(Math.sin(this._endAngle)||0)};r=[...r.slice(0,r.length-1),s]}return r}_computeLineAngle(){const e=this._getMainSegmentPoints();if(e.length<=1)return;const t=e[0],i=e[1],r=e[e.length-2],o=e[e.length-1],s=[t.x-i.x,t.y-i.y],l=Math.atan2(s[1],s[0]),a=[o.x-r.x,o.y-r.y],d=Math.atan2(a[1],a[0]);this._startAngle=l,this._endAngle=d}_reset(){this.startSymbol=null,this.endSymbol=null,this._startAngle=null,this._endAngle=null,this._mainSegmentPoints=null}}cu.defaultAttributes={visible:!0,lineStyle:{lineWidth:1,stroke:"#000"},startSymbol:{visible:!1,autoRotate:!0,symbolType:"triangle",size:12,refX:0,refY:0,refAngle:0,style:{fill:"#000",zIndex:1}},endSymbol:{visible:!1,autoRotate:!0,symbolType:"triangle",size:12,refX:0,refY:0,refAngle:0,style:{fill:"#000",zIndex:1}}};var Pt;(function(n){n.innerView="inner-view",n.axisContainer="axis-container",n.labelContainer="axis-label-container",n.tickContainer="axis-tick-container",n.tick="axis-tick",n.subTick="axis-sub-tick",n.label="axis-label",n.title="axis-title",n.gridContainer="axis-grid-container",n.grid="axis-grid",n.gridRegion="axis-grid-region",n.line="axis-line",n.background="axis-background",n.axisLabelBackground="axis-label-background",n.axisBreak="axis-break",n.axisBreakSymbol="axis-break-symbol"})(Pt||(Pt={}));var so;(function(n){n.selected="selected",n.selectedReverse="selected_reverse",n.hover="hover",n.hoverReverse="hover_reverse"})(so||(so={}));const Gr={[so.selectedReverse]:{},[so.selected]:{},[so.hover]:{},[so.hoverReverse]:{}},JT=999,Lc={title:{space:4,padding:0,textStyle:{fontSize:12,fill:"#333333",fontWeight:"normal",fillOpacity:1}},label:{visible:!0,inside:!1,space:4,padding:0,style:{fontSize:12,fill:"#333",fontWeight:"normal",fillOpacity:1}},tick:{visible:!0,inside:!1,alignWithLabel:!0,length:4,style:{lineWidth:1,stroke:"#000",strokeOpacity:1}},subTick:{visible:!1,inside:!1,count:4,length:2,style:{lineWidth:1,stroke:"#999",strokeOpacity:1}},line:{visible:!0,style:{lineWidth:1,stroke:"#000",strokeOpacity:1}}},rb={size:8,stroke:"#000",lineWidth:1,zIndex:1};function QT(n){const e=n.AABBBounds;return{x1:e.x1,x2:e.x2,y1:e.y1,y2:e.y2,centerX:n.attribute.x,centerY:n.attribute.y,angle:n.attribute.angle}}function eP(n){n.forEach(e=>{if(e.rotatedBounds||!e.attribute.angle)return;const t=QT(e),i=F_({x:e.attribute.x,y:e.attribute.y},t.angle,{x:t.centerX,y:t.centerY}),r=i.x-t.centerX,o=i.y-t.centerY;t.x1+=r,t.x2+=r,t.y1+=o,t.y2+=o,t.centerX+=r,t.centerY+=o,e.rotatedBounds=t})}function tP(n,e){var t,i;return!((t=n.OBBBounds)===null||t===void 0)&&t.empty()||!((i=e.OBBBounds)===null||i===void 0)&&i.empty()?Sh(n.AABBBounds,e.AABBBounds,!1)&&(!n.rotatedBounds||!e.rotatedBounds||Av(n.rotatedBounds,e.rotatedBounds,!0)):n.OBBBounds.intersects(e.OBBBounds)}const cw=Math.sin(Math.PI/10);function fw(n,e=cw){const t=!Te(n)&&n!==0,i=t?Math.cos(n):1;return t&&Math.abs(i)<=e}function Uf(n,e=cw){const t=!Te(n)&&n!==0,i=t?Math.sin(n):0;return!t||Math.abs(i)<=e}function nP(n,e){return{x:n.x+e[0],y:n.y+e[1]}}function iP(n={}){var e,t;const{style:i={},angle:r=.5*Math.PI}=n,o=re({},rb,i),s=(e=o.size)!==null&&e!==void 0?e:rb.size;return Object.assign(Object.assign({},o),{symbolType:(t=o.symbolType)!==null&&t!==void 0?t:`M ${-s/2} ${s*Math.sin(r)} L ${s/2} ${-s*Math.sin(r)}`,symbolSize:s})}function rP(n){const e={};return To(n,t=>{t.type!=="group"&&t.id&&(e[t.id]=t)}),e}function gw(n,e){return{x:n.x+e[0],y:n.y+e[1]}}function ob(n,e,t,i=!1,r=!1){const o=[e.x-t.x,e.y-t.y];return nw(o,(i?-1:1)*(r?-1:1)*n/iw(o))}function oP(n,e,t,i,r){const o=Bv({x:0,y:0},t,n),s=gw(o,ob(i,o,e,r));return nP(s,ob(i||1,s,e,r))}function On(n,e,t){var i;let r,o;const s=(i=n.attribute)===null||i===void 0?void 0:i.angle,l=(a,d,u)=>(r=a.AABBBounds,o=d.AABBBounds,u>Math.max(o.x1-r.x2,r.x1-o.x2,o.y1-r.y2,r.y1-o.y2));return Uf(s,Number.EPSILON)?l(n,e,t):(r=n.OBBBounds,o=e.OBBBounds,!r||!o||r.empty()||o.empty()?l(n,e,t):r.intersects(o))}function Fc(n,e){for(let t,i=1,r=n.length,o=n[0];i<r;o=t,++i)if(t=n[i],On(o,t,e))return!0;return!1}const sP=(n,e,t)=>{const i=n.target;return i!==t&&i.name&&!ye(i.states)?(i.addState(jt.hover,!0),To(e,r=>{r!==i&&r.name&&!ye(r.states)&&r.addState(jt.hoverReverse,!0)}),i):t},lP=(n,e,t)=>t&&(To(e,i=>{i.name&&!ye(i.states)&&(i.removeState(jt.hoverReverse),i.removeState(jt.hover))}),null),aP=(n,e,t)=>{const i=n.target;return t===i&&i.hasState(jt.selected)?(To(e,r=>{r.name&&!ye(r.states)&&(r.removeState(jt.selectedReverse),r.removeState(jt.selected))}),null):i.name&&!ye(i.states)?(i.addState(jt.selected,!0),To(e,r=>{r!==i&&r.name&&!ye(r.states)&&r.addState(jt.selectedReverse,!0)}),i):t};class dP extends gn{constructor(){super(...arguments),this.name="axis",this.data=[],this.tickLineItems=[],this.subTickLineItems=[],this.axisLabelLayerSize={},this.axisLabelsContainer=null,this._onHover=e=>{this._lastHover=sP(e,this.axisContainer,this._lastHover)},this._onUnHover=e=>{this._lastHover=lP(e,this.axisContainer,this._lastHover)},this._onClick=e=>{this._lastSelect=aP(e,this.axisContainer,this._lastSelect)}}getInnerView(){return this._innerView}getPrevInnerView(){return this._prevInnerView}getBoundsWithoutRender(e){const t=Or(this.attribute);re(this.attribute,e);const i=ge.group({x:this.attribute.x,y:this.attribute.y});return this.add(i),this._renderInner(i),this.removeChild(i),this.attribute=t,i.AABBBounds}render(){this._prevInnerView=this._innerView&&rP(this._innerView),this.removeAllChild(!0),this._innerView=ge.group({x:0,y:0,pickable:!1}),this.add(this._innerView),this._renderInner(this._innerView),this._bindEvent()}_bindEvent(){if(this.attribute.disableTriggerEvent)return;const{hover:e,select:t}=this.attribute;e&&(this._innerView.addEventListener("pointermove",this._onHover),this._innerView.addEventListener("pointerout",this._onUnHover)),t&&this._innerView.addEventListener("pointerdown",this._onClick)}_renderInner(e){const{title:t,label:i,tick:r,line:o,items:s}=this.attribute,l=ge.group({x:0,y:0,zIndex:1,pickable:!1});if(l.name=Pt.axisContainer,l.id=this._getNodeId("container"),l.setMode(this.mode),this.axisContainer=l,e.add(l),o&&o.visible&&this.renderLine(l),s&&s.length&&(this.data=this._transformItems(s[0]),r&&r.visible&&this.renderTicks(l),i&&i.visible)){const a=ge.group({x:0,y:0,pickable:!1});a.name=Pt.labelContainer,a.id=this._getNodeId("label-container"),this.axisLabelsContainer=a,l.add(a),s.forEach((d,u)=>{const h=this.renderLabels(a,d,u),c=h.getChildren();this.beforeLabelsOverlap(c,d,h,u,s.length),this.handleLabelsOverlap(c,d,h,u,s.length),this.afterLabelsOverlap(c,d,h,u,s.length);let g=0,f=0,p="center",m="middle",b=0;c.forEach((C,_)=>{var w;const y=C.attribute,v=(w=y.angle)!==null&&w!==void 0?w:0,x=C.AABBBounds;let S=x.width(),R=x.height();v&&(S=Math.abs(S*Math.cos(v)),R=Math.abs(R*Math.sin(v))),g=Math.max(g,S),f=Math.max(f,R),p=y.textAlign,m=y.textBaseline,_===0&&(b=y.x)}),this.axisLabelLayerSize[u]={width:g,height:f,labelPos:b,textAlign:p,textBaseline:m}})}t&&t.visible&&this.renderTitle(l)}renderTicks(e){const t=this.getTickLineItems(),i=ge.group({x:0,y:0,pickable:!1});i.name=Pt.tickContainer,i.id=this._getNodeId("tick-container"),e.add(i),t.forEach((o,s)=>{var l;const a=ge.line(Object.assign({},this._getTickLineAttribute("tick",o,s,t)));if(a.name=Pt.tick,a.id=this._getNodeId(o.id),ye((l=this.attribute.tick)===null||l===void 0?void 0:l.state))a.states=Vr;else{const d=this.data[s],u=re({},Vr,this.attribute.tick.state);Object.keys(u).forEach(h=>{Ae(u[h])&&(u[h]=u[h](d.rawValue,s,d,this.data))}),a.states=u}i.add(a)}),this.tickLineItems=t;const{subTick:r}=this.attribute;if(r&&r.visible){const o=this.getSubTickLineItems();o.length&&o.forEach((s,l)=>{const a=ge.line(Object.assign({},this._getTickLineAttribute("subTick",s,l,t)));if(a.name=Pt.subTick,a.id=this._getNodeId(`${l}`),ye(r.state))a.states=Vr;else{const d=re({},Vr,r.state);Object.keys(d).forEach(u=>{Ae(d[u])&&(d[u]=d[u](s.value,l,s,t))}),a.states=d}i.add(a)}),this.subTickLineItems=o}}renderLabels(e,t,i){const{dataFilter:r}=this.attribute.label;r&&Ae(r)&&(t=r(t,i));const o=this._transformItems(t),s=ge.group({x:0,y:0,pickable:!1});return s.name=`${Pt.labelContainer}-layer-${i}`,s.id=this._getNodeId(`label-container-layer-${i}`),e.add(s),o.forEach((l,a)=>{var d;const u=this._getLabelAttribute(l,a,o,i),h=kc(u);if(h.name=Pt.label,h.id=this._getNodeId(`layer${i}-label-${l.id}`),ye((d=this.attribute.label)===null||d===void 0?void 0:d.state))h.states=Vr;else{const c=re({},Vr,this.attribute.label.state);Object.keys(c).forEach(g=>{Ae(c[g])&&(c[g]=c[g](l,a,o,i))}),h.states=c}h.data=Object.assign(Object.assign({},l),{index:a,layer:i}),s.add(h)}),s}renderTitle(e){const t=this.getTitleAttribute(),i=new ll(Object.assign({},t));i.name=Pt.title,i.id=this._getNodeId("title"),e.add(i)}getVerticalCoord(e,t,i){return gw(e,this.getVerticalVector(t,i,e))}getTickLineItems(){const{tick:e}=this.attribute,t=this.data,i=[],{alignWithLabel:r,inside:o=!1,length:s,dataFilter:l}=e;let a=1;return t.length>=2&&(a=t[1].value-t[0].value),(l&&Ae(l)?l(t):t).forEach(d=>{let u=d.point,h=d.value;if(!r){const g=d.value-a/2;if(this.isInValidValue(g))return;u=this.getTickCoord(g),h=g}const c=this.getVerticalCoord(u,s,o);if(this.mode==="3d"){const g=this.getVerticalVector(s,o,u);let f=0,p=0;De(g[0])>De(g[1])?f=qe/2*(c.x>u.x?1:-1):p=qe/2*(c.y>u.y?-1:1),i.push({start:u,end:c,value:h,id:`tick-${d.id}`,anchor:[u.x,u.y],alpha:f,beta:p})}else i.push({start:u,end:c,value:h,id:`tick-${d.id}`})}),i}getSubTickLineItems(){const{subTick:e}=this.attribute,t=[],{count:i=4,inside:r=!1,length:o=2}=e,s=this.tickLineItems,l=s.length;if(l>=2)for(let a=0;a<l-1;a++){const d=s[a],u=s[a+1];for(let h=0;h<i;h++){const c=(h+1)/(i+1),g=(1-c)*d.value+c*u.value,f=this.getTickCoord(g),p=this.getVerticalCoord(f,o,r);t.push({start:f,end:p,value:g,id:`sub-tick-${g}`})}}return t}_getTickLineAttribute(e,t,i,r){let o=vt(this.attribute,`${e}.style`);const s=this.data[i];o=Ae(o)?re({},vt(Lc,`${e}.style`),e==="tick"?o(s.rawValue,i,s,this.data):o(t.value,i,t,r)):o;const{start:l,end:a,anchor:d,alpha:u,beta:h}=t;return Object.assign({points:[l,a],anchor:d,alpha:u,beta:h},o)}_getLabelAttribute(e,t,i,r){var o,s;const{space:l=4,inside:a=!1,formatMethod:d,type:u="text",text:h}=this.attribute.label;let c=l,g=0;!((o=this.attribute.tick)===null||o===void 0)&&o.visible&&this.attribute.tick.inside===a&&(g=this.attribute.tick.length||4),!((s=this.attribute.subTick)===null||s===void 0)&&s.visible&&this.attribute.subTick.inside===a&&(g=Math.max(g,this.attribute.subTick.length||2)),c+=g;const f=this.getRelativeVector(e.point);r>0&&(f[1]===0?c+=(this.axisLabelLayerSize[r-1].height+vt(this.attribute,"label.space",4))*r:c+=(this.axisLabelLayerSize[r-1].width+vt(this.attribute,"label.space",4))*r);const p=this.getVerticalCoord(e.point,c,a),m=this.getVerticalVector(c||1,a,p),b=d?d(`${e.label}`,e,t,i,r):e.label;let{style:C}=this.attribute.label;C=Ae(C)?re({},Lc.label.style,C(e,t,i,r)):C;const _=this.getLabelAlign(m,a,C.angle);return C=re(_,C),Ae(C.text)&&(C.text=C.text({label:e.label,value:e.rawValue,index:e.index,layer:r})),Object.assign(Object.assign(Object.assign({},this.getLabelPosition(p,m,b,C)),{text:h??b,_originText:e.label,lineHeight:C==null?void 0:C.fontSize,type:u}),C)}getLabelPosition(e,t,i,r){return e}_transformItems(e){const t=[];return e.forEach(i=>{var r;t.push(Object.assign(Object.assign({},i),{point:this.getTickCoord(i.value),id:(r=i.id)!==null&&r!==void 0?r:i.label}))}),t}release(){super.release(),this._prevInnerView=null,this._innerView=null}}const sb={parity:function(n){return n.filter((e,t)=>t%2?e.setAttribute("opacity",0):1)},greedy:function(n,e){let t;return n.filter((i,r)=>r&&On(t,i,e)?i.setAttribute("opacity",0):(t=i,1))}};function uP(n){let e;return e=n.OBBBounds.empty()?n.AABBBounds:n.OBBBounds,e.width()>1&&e.height()>1}function hP(n){return n.forEach(e=>e.setAttribute("opacity",1)),n}function lb(n,e,t,i,r=!1){if(t&&!n.attribute.opacity){const o=e.length;if(o>1){n.setAttribute("opacity",1);for(let s=0;s<o;s++){const l=r?e[o-1-s]:e[s];if(!i(l))break;l.setAttribute("opacity",0)}}}}function cP(n,e){if(ye(n))return;const t=n.filter(uP);if(ye(t))return;let i;i=hP(t);const{method:r="parity",separation:o=0}=e,s=Ae(r)?r:sb[r]||sb.parity;if(i.length>=3&&Fc(i,o)){do i=s(i,o);while(i.length>=3&&Fc(i,o));const l=(c,g,f=!0)=>f&&c<3||g,a=l(i.length,e.firstVisible,!1);let d=l(i.length,e.lastVisible);const u=t[0],h=Cr(t);On(u,h,o)&&a&&d&&(h.setAttribute("opacity",0),d=!1),lb(u,i,a,c=>On(c,u,o)),lb(h,i,d,c=>On(c,h,o)||!(!a||c===u)&&On(c,u,o),!0)}t.forEach(l=>{l.setAttribute("visible",!!l.attribute.opacity)})}function fP(n,e){if(ye(n))return;const{orient:t,labelRotateAngle:i=[0,45,90]}=e;if(i.length===0||n.some(s=>!!s.attribute.angle))return;let r=0,o=0;for(i&&i.length>0&&(o=i.length);r<o;){const s=i[r++];if(n.forEach(l=>{l.attribute.angle=Mr(s)}),pP(t,n),!gP(n))break}}function gP(n){for(let e=1;e<n.length;e++)if(tP(n[e-1],n[e]))return!0;return!1}function pP(n,e){n!=="bottom"&&n!=="top"||bP(n,e),n!=="left"&&n!=="right"||mP(n,e),eP(e)}function fu(n=0){if(n<0)for(;n<0;)n+=2*Math.PI;if(n>0)for(;n>=2*Math.PI;)n-=2*Math.PI;return n}function mP(n,e){e.forEach((t,i)=>{t.attribute.angle&&t.setAttributes(Object.assign(Object.assign({},mw(n,t.attribute.angle)),{angle:fu(t.attribute.angle)}))})}function bP(n,e){e.forEach(t=>{t.attribute.angle&&t.setAttributes(Object.assign(Object.assign({},pw(n,t.attribute.angle)),{angle:fu(t.attribute.angle)}))})}function pw(n,e=0){let t=["center","left","left","left","center","right","right","right","left"],i=["top","top","middle","bottom","bottom","bottom","middle","top","top"];n==="top"&&(t=["center","right","right","right","center","left","left","left","right"],i=["bottom","bottom","middle","top","top","top","middle","bottom","bottom"]);const r=(e=fu(e))/(.5*Math.PI);let o;return o=r===Math.floor(r)?2*Math.floor(r):2*Math.floor(r)+1,{textAlign:t[o],textBaseline:i[o]}}function mw(n,e=0){let t=["right","right","center","left","left","left","center","right","right"],i=["middle","middle","top","top","middle","middle","bottom","bottom","middle"];n==="right"&&(t=["left","left","center","right","right","right","center","left","left"],i=["middle","middle","bottom","bottom","middle","middle","top","middle","middle"]);const r=(e=fu(e))/(.5*Math.PI);let o;return o=r===Math.floor(r)?2*Math.floor(r):2*Math.floor(r)+1,{textAlign:t[o],textBaseline:i[o]}}function CP(n){return Xe(n)?{left:n,right:n}:ke(n)?{left:n.left||0,right:n.right||0}:{left:0,right:0}}function _P(n,e){const{limitLength:t,verticalLimitLength:i,ellipsis:r="...",orient:o,axisLength:s}=e;if(ye(n)||!Xe(t))return;const l=CP(e.overflowLimitLength),a=n[0],d=a.attribute.angle,u=!Te(d),h=u?Math.cos(d):1,c=u?Math.sin(d):0,g=Uf(d),f=fw(d),p=o==="top"||o==="bottom",m=a.attribute.direction,b=!g&&!f&&p&&(n.length<2||n.some(C=>Math.abs(C.AABBBounds.width()-a.AABBBounds.width())>=2))&&a.AABBBounds.width()>Math.abs(t/c);n.forEach(C=>{var _;if(p&&(f&&Math.floor(C.AABBBounds.height())<=t||g&&Math.floor(C.AABBBounds.width())<=i)||!p&&(m==="vertical"&&Math.floor(C.AABBBounds.height())<=i||m!=="vertical"&&(g&&Math.floor(C.AABBBounds.width())<=t||f&&Math.floor(C.AABBBounds.height())<=i)))return;let w=null;if(g||f)w=p?g?i:t:m==="vertical"||f?i:t;else if(p){const{x1:y,x2:v}=C.AABBBounds,x=c/h,S=Math.abs(t/c);if(b&&x>0&&y<=s+l.right&&t/x+y>s+l.right){const R=(s-y+l.right)/Math.abs(h);w=Math.min(R,S)}else if(b&&x<0&&v>=-l.left&&t/x+v<-l.left){const R=(v+l.left)/Math.abs(h);w=Math.min(R,S)}else w=S}else w=Math.abs(t/h);Xe(C.attribute.maxLineWidth)&&(w=Xe(w)?Math.min(C.attribute.maxLineWidth,w):C.attribute.maxLineWidth),C.setAttributes({maxLineWidth:w,ellipsis:(_=C.attribute.ellipsis)!==null&&_!==void 0?_:r})})}function wP(n,e){const{limitLength:t,axisLength:i,ellipsis:r="...",orient:o}=e;if(ye(n)||!Xe(t))return;const s=n[0].attribute.angle,l=Uf(s),a=fw(s),d=o==="top"||o==="bottom";let u=i/n.length;n.forEach((h,c)=>{var g,f,p,m,b;if(d){if(a&&Math.floor(h.AABBBounds.height())<=t)return;if(l){const w=ab(h.attribute.x,(g=n[c+1])===null||g===void 0?void 0:g.attribute.x,(f=n[c-1])===null||f===void 0?void 0:f.attribute.x);Xe(w)&&(u=Ot(u,w))}}else{if(a){const w=ab(h.attribute.y,(p=n[c+1])===null||p===void 0?void 0:p.attribute.y,(m=n[c-1])===null||m===void 0?void 0:m.attribute.y);Xe(w)&&(u=Ot(u,w))}if(l&&Math.floor(h.AABBBounds.width())<=t)return}let C=null,_=null;d?a?(C=t,_=u):(C=u,_=t):a?(C=u,_=t):(C=t,_=u),h.setAttributes({maxLineWidth:C,ellipsis:(b=h.attribute.ellipsis)!==null&&b!==void 0?b:r,whiteSpace:"normal",heightLimit:_})})}function ab(n,e,t){let i;return Xe(e)&&(i=Math.abs(e-n)),Xe(t)&&(i=Xe(i)?Math.min(Math.abs(n-t),i):Math.abs(n-t)),i}function yP(n,e,t,i,r){i==="left"||i==="right"?r==="left"?n.forEach(o=>{var s;o.setAttributes({dx:((s=o.attribute.dx)!==null&&s!==void 0?s:0)+e-o.AABBBounds.x1})}):r==="right"?n.forEach(o=>{var s;o.setAttributes({dx:((s=o.attribute.dx)!==null&&s!==void 0?s:0)+e+t-o.AABBBounds.x2})}):r==="center"&&n.forEach(o=>{var s;o.setAttributes({dx:((s=o.attribute.dx)!==null&&s!==void 0?s:0)+e+t/2-(o.AABBBounds.x1+o.AABBBounds.x2)/2})}):i!=="bottom"&&i!=="top"||(r==="top"?n.forEach(o=>{var s;o.setAttributes({dy:((s=o.attribute.dy)!==null&&s!==void 0?s:0)+e-o.AABBBounds.y1})}):r==="bottom"?n.forEach(o=>{var s;o.setAttributes({dy:((s=o.attribute.dy)!==null&&s!==void 0?s:0)+e+t-o.AABBBounds.y2})}):r==="middle"&&n.forEach(o=>{var s;o.setAttributes({dy:((s=o.attribute.dy)!==null&&s!==void 0?s:0)+e+t/2-(o.AABBBounds.y1+o.AABBBounds.y2)/2})}))}class vP{isInValidValue(e){return e<0||e>1}getTickCoord(e){const{start:t}=this.attribute,i=this.getRelativeVector();return{x:t.x+i[0]*e,y:t.y+i[1]*e}}getRelativeVector(e){const{start:t,end:i}=this.attribute;return[i.x-t.x,i.y-t.y]}getVerticalVector(e,t=!1,i){const{verticalFactor:r=1}=this.attribute,o=this.getRelativeVector(),s=OT(o),l=[s[1],-1*s[0]];return nw(l,e*(t?1:-1)*r)}}function SP(){nn(),jf(),uu(),ri()}function xP(){SP(),Ti()}var db=function(n,e){var t={};for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&e.indexOf(i)<0&&(t[i]=n[i]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function"){var r=0;for(i=Object.getOwnPropertySymbols(n);r<i.length;r++)e.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(n,i[r])&&(t[i[r]]=n[i[r]])}return t};xP();class Gs extends dP{constructor(e,t){super(t!=null&&t.skipDefault?e:re({},Gs.defaultAttributes,e),t)}_renderInner(e){var t;if(this._breaks=null,this.attribute.breaks&&this.attribute.breaks.length){const r=[];for(let o=0;o<this.attribute.breaks.length;o++){const s=this.attribute.breaks[o],{range:l,breakSymbol:a,rawRange:d}=s;r.push({startPoint:this.getTickCoord(l[0]),endPoint:this.getTickCoord(l[1]),range:l,breakSymbol:a,rawRange:d})}this._breaks=r}super._renderInner(e),this._breaks&&this._breaks.length&&this._breaks.forEach((r,o)=>{const{startPoint:s,endPoint:l,breakSymbol:a,rawRange:d}=r;if((a==null?void 0:a.visible)!==!1){const u=ge.group({zIndex:JT});u.name=Pt.axisBreak,u.id=this._getNodeId(`${Pt.axisBreak}-${o}`),u.data=d;const h=iP(a),c=ge.symbol(Object.assign({x:s.x,y:s.y},h));c.name=Pt.axisBreakSymbol;const g=ge.symbol(Object.assign({x:l.x,y:l.y},h));g.name=Pt.axisBreakSymbol,u.add(c),u.add(g),e.add(u)}});const{panel:i}=this.attribute;if(i&&i.visible){const r=this.axisContainer,o=r.AABBBounds,s=ge.rect(Object.assign({x:o.x1,y:o.y1,width:o.width(),height:o.height()},i.style));s.name=Pt.background,s.id=this._getNodeId("background"),s.states=re({},Gr,(t=i.state)!==null&&t!==void 0?t:{}),r.insertBefore(s,r.firstChild)}}renderLine(e){const{start:t,end:i,line:r}=this.attribute,o=r,{startSymbol:s,endSymbol:l,style:a,state:d}=o,u=db(o,["startSymbol","endSymbol","style","state"]),h=Object.assign({startSymbol:s,endSymbol:l,lineStyle:a},u);if(this._breaks&&this._breaks.length){const g=[];let f=t;this._breaks.forEach(p=>{const{startPoint:m,endPoint:b}=p;g.push([f,m]),f=b}),g.push([f,i]),h.points=g,h.multiSegment=!0}else h.points=[t,i];ye(d)||(h.state={line:re({},Gr,d),symbol:re({},Gr,d)});const c=new cu(h);c.name=Pt.line,c.id=this._getNodeId("line"),e.add(c)}getTextAlign(e){let t="center";return _i(e[0],0)?_i(e[1],0)?Object.is(e[1],-0)?t="start":Object.is(e[0],-0)&&(t="end"):t="center":e[0]>0?t="start":e[0]<0&&(t="end"),t}getTitleAttribute(){var e,t,i;const r=this.attribute.title,{position:o="middle",space:s=4,textStyle:l={},autoRotate:a=!0,shape:d,background:u,state:h={},maxWidth:c}=r,g=db(r,["position","space","textStyle","autoRotate","shape","background","state","maxWidth"]);let f=.5;o==="start"?f=0:o==="end"&&(f=1);const{verticalFactor:p=1}=this.attribute,m=-1*p,b=this.getTickCoord(f),C=this.getRelativeVector();let _=0;if(!((e=this.attribute.label)===null||e===void 0)&&e.visible&&this.attribute.label.inside===!1){const H=+vt(this.attribute,"label.space",4);_+=H;const E=Object.keys(this.axisLabelLayerSize).length;if(C[1]===0){const T=this.axisLabelsContainer?this.axisLabelsContainer.AABBBounds.height():0;isFinite(T)?_+=T+(E-1)*H:_=0}else if(C[0]===0)if(this.axisLabelsContainer&&this.axisLabelsContainer.AABBBounds&&!this.axisLabelsContainer.AABBBounds.empty()){const T=this.axisLabelLayerSize[0].labelPos,P=this.axisLabelsContainer.AABBBounds;_+=(m===1?P.x2>T?Math.min(P.x2-T,P.width()):0:P.x1<T?Math.min(T-P.x1,P.width()):0)+(E-1)*H}else _=0;else Object.keys(this.axisLabelLayerSize).forEach((T,P)=>{_+=this.axisLabelLayerSize[T].width+(P>0?H:0)})}let w=0;!((t=this.attribute.tick)===null||t===void 0)&&t.visible&&this.attribute.tick.inside===!1&&(w=this.attribute.tick.length||4),!((i=this.attribute.subTick)===null||i===void 0)&&i.visible&&this.attribute.subTick.inside===!1&&(w=Math.max(w,this.attribute.subTick.length||2));const y=w+_+s,v=this.getVerticalCoord(b,y,!1),x=this.getVerticalVector(y,!1,{x:0,y:0});let S,R,{angle:B}=g;if(S=o==="start"?"start":o==="end"?"end":"center",Te(B)&&a){B=WT(C,[1,0],!0);const{verticalFactor:H=1}=this.attribute;R=-1*H===1?"bottom":"top"}else S=this.getTextAlign(x),R=this.getTextBaseline(x,!1);let A=c;if(Te(A)){const{verticalLimitSize:H,verticalMinSize:E,orient:T}=this.attribute,P=Math.min(H||1/0,E||1/0);if(Xe(P))if(T==="bottom"||T==="top")if(B!==Math.PI/2){const k=Math.abs(Math.cos(B??0));A=k<1e-6?1/0:this.attribute.end.x/k}else A=P-y;else if(B&&B!==0){const k=Math.abs(Math.sin(B));A=k<1e-6?1/0:this.attribute.end.y/k}else A=P-y}const M=Object.assign(Object.assign(Object.assign({},v),g),{maxWidth:A,textStyle:Object.assign({textAlign:S,textBaseline:R},l),state:{text:re({},Gr,h.text),shape:re({},Gr,h.shape),panel:re({},Gr,h.background)}});return M.angle=B,d&&d.visible&&(M.shape=Object.assign({visible:!0},d.style),d.space&&(M.space=d.space)),u&&u.visible&&(M.panel=Object.assign({visible:!0},u.style)),M}getTextBaseline(e,t){let i="middle";const{verticalFactor:r=1}=this.attribute,o=(t?1:-1)*r;return _i(e[1],0)?i=!_i(e[0],0)||Object.is(e[0],-0)||Object.is(e[1],-0)?"middle":o===1?"bottom":"top":e[1]>0?i="top":e[1]<0&&(i="bottom"),i}getLabelAlign(e,t,i){const r=this.attribute.orient;if(["top","bottom","right","left"].includes(r)||e[0]===0&&e[1]===0){if(r==="top"||r==="bottom")return pw(t?r==="bottom"?"top":"bottom":r,i);if(r==="left"||r==="right")return mw(t?r==="left"?"right":"left":r,i)}return{textAlign:this.getTextAlign(e),textBaseline:this.getTextBaseline(e,t)}}beforeLabelsOverlap(e,t,i,r,o){var s,l,a,d;const{flush:u=!1}=this.attribute.label||{};if(u&&e.length){const{orient:h,start:c,end:g}=this.attribute,f=h==="bottom"||h==="top",p=e[0],m=Cr(e),b=f?p.attribute.x>m.attribute.x:p.attribute.y<m.attribute.y;if(f){const C=b?m:p,_=b?p:m,w=c.x,y=g.x,v=C.AABBBounds.x1,x=_.AABBBounds.x2;v<w&&(C.attribute.angle?C.setAttributes({dx:((s=C.attribute.dx)!==null&&s!==void 0?s:0)+w-v}):C.setAttributes({x:w,textAlign:"left"})),x>y&&(_.attribute.angle?_.setAttributes({dx:((l=_.attribute.dx)!==null&&l!==void 0?l:0)+y-x}):_.setAttributes({x:y,textAlign:"right"}))}else{const C=b?m:p,_=b?p:m,w=C.AABBBounds.y2,y=_.AABBBounds.y1,v=c.y,x=g.y;y<v&&(_.attribute.angle?_.setAttributes({dy:((a=_.attribute.dy)!==null&&a!==void 0?a:0)+v-y}):_.setAttributes({y:v,textBaseline:"top"})),w>x&&(C.attribute.angle?C.setAttributes({dy:((d=C.attribute.dy)!==null&&d!==void 0?d:0)+x-w}):C.setAttributes({y:x,textBaseline:"bottom"}))}}}handleLabelsOverlap(e,t,i,r,o){if(ye(e))return;const{verticalLimitSize:s,label:l,orient:a}=this.attribute,d=this._getAxisLabelLimitLength(s,o),{layoutFunc:u,autoRotate:h,autoRotateAngle:c,autoLimit:g,limitEllipsis:f,autoHide:p,autoHideMethod:m,autoHideSeparation:b,lastVisible:C,firstVisible:_,autoWrap:w,overflowLimitLength:y}=l;if(Ae(u))u(e,t,r,this);else{if(h)fP(e,{labelRotateAngle:c,orient:a});else if(w){const v=Math.abs(a==="left"||a==="right"?this.attribute.start.y-this.attribute.end.y:this.attribute.start.x-this.attribute.end.x);wP(e,{orient:a,limitLength:d,axisLength:v,ellipsis:f})}if(!w&&g&&Xe(d)&&d>0){const v=a==="left"||a==="right",x=Math.abs(v?this.attribute.start.y-this.attribute.end.y:this.attribute.start.x-this.attribute.end.x),S=v?x/e.length:p||h?1/0:x/e.length;_P(e,{limitLength:d,verticalLimitLength:S,ellipsis:f,orient:a,axisLength:x,overflowLimitLength:y})}p&&cP(e,{method:m,separation:b,lastVisible:C,firstVisible:_})}}afterLabelsOverlap(e,t,i,r,o){const{verticalLimitSize:s,orient:l}=this.attribute,a=l==="bottom"||l==="top",d=i.AABBBounds;let u=a?d.height():d.width();const{verticalMinSize:h}=this.attribute;if(Xe(h)&&(!Xe(s)||h<=s)){const c=this._getAxisLabelLimitLength(h,o);let g,f;u=Math.max(u,c),l==="left"?(g=d.x2-u,f=d.y1):l==="right"?(g=d.x1,f=d.y1):l==="top"?(g=d.x1,f=d.y2-u):l==="bottom"&&(g=d.x1,f=d.y1);const p=ge.rect({x:g,y:f,width:a?d.width():u,height:a?u:d.height(),pickable:!1});p.name=Pt.axisLabelBackground,p.id=this._getNodeId("axis-label-background"),i.insertBefore(p,i.firstChild)}if(O(this.attribute.label.containerAlign)){let c;l==="left"?c=d.x2-u:l==="right"?c=d.x1:l==="top"?c=d.y2-u:l==="bottom"&&(c=d.y1),yP(e,c,u,l,this.attribute.label.containerAlign)}}_getAxisLabelLimitLength(e,t){var i,r,o,s,l;const{label:a,title:d,line:u,tick:h}=this.attribute,c=(i=a.space)!==null&&i!==void 0?i:4;let g=e,f=0,p=0;const m=u&&u.visible?(r=u.style.lineWidth)!==null&&r!==void 0?r:1:0,b=h&&h.visible?(o=h.length)!==null&&o!==void 0?o:4:0;if(d&&d.visible&&typeof d.text=="string"){f=hu(d.text,d.textStyle,(l=(s=this.stage)===null||s===void 0?void 0:s.getTheme())===null||l===void 0?void 0:l.text).height;const C=ei(d.padding);p=d.space+C[0]+C[2]}return g&&(g=(g-c-p-f-m-b)/t),g}release(){super.release(),this._breaks=null}}Gs.defaultAttributes=Lc,Mv(Gs,vP);const xi=n=>n.map((e,t)=>({index:t,value:e})),ub=(n,e,t=0)=>{const i=new Ue(n).expand(t/2),r=new Ue(e).expand(t/2);return i.intersects(r)},hb=12,El=(n,e,t,i)=>t<n?Math.max(n-e/2,t):t>n?Math.min(n-e/2,t-e):t<i?t:t-e,zc=(n,e,t)=>{var i;const{labelStyle:r,axisOrientType:o,labelFlush:s,labelFormatter:l,startAngle:a=0}=t;let d=(i=r.angle)!==null&&i!==void 0?i:0;r.direction==="vertical"&&(d+=Mr(90));const u=["bottom","top"].includes(o),h=["left","right"].includes(o);let c=1,g=0;u||(h?(c=0,g=1):a&&(c=Math.cos(a),g=-Math.sin(a)));const f=rw(r),p=n.range();return e.map((b,C)=>{var _,w;const y=l?l(b):`${b}`,{width:v,height:x}=f.quickMeasure(y),S=Math.max(v,12),R=Math.max(x,12),B=n.scale(b),A=c*B,M=g*B;let H,E,T=A,P=M;s&&u&&C===0?T=El(A,S,p[0],p[p.length-1]):s&&u&&C===e.length-1?T=El(A,S,p[p.length-1],p[0]):H=(_=r.textAlign)!==null&&_!==void 0?_:"center",H==="right"?T-=S:H==="center"&&(T-=S/2),s&&h&&C===0?P=El(M,R,p[0],p[p.length-1]):s&&h&&C===e.length-1?P=El(M,R,p[p.length-1],p[0]):E=(w=r.textBaseline)!==null&&w!==void 0?w:"middle",E==="bottom"?P-=R:E==="middle"&&(P-=R/2);const k=new Ue().set(T,P,T+S,P+R);return d&&k.rotate(d,A,M),k})},RP=n=>["bottom","top","z"].includes(n);function Uu(n,e,t,i){let r;const{breakData:o}=n;if(o&&o()){const{breakDomains:s}=o(),l=e.domain();r=[];for(let a=0;a<l.length-1;a++)i(t,[l[a],l[a+1]]).forEach(d=>{s.some(u=>d>=u[0]&&d<=u[1])||r.push(d)});e.domain(l)}else r=i(t);return r}function cb(n,e,t,i,r=!1){if(t&&!e.includes(n)){let o=e.length;if(o>1){r?e.push(n):e.unshift(n);for(let s=0;s<o;s++){const l=r?o-1-s:s;if(!i(e[l]))break;e.splice(l,1),s--,o--}}}}const AP=(n,e)=>{var t,i;if(!O_(n.type))return xi(n.domain());const r=n.range(),o=Math.abs(r[r.length-1]-r[0]);if(o<2)return xi([n.domain()[0]]);const{tickCount:s,forceTickCount:l,tickStep:a,noDecimals:d=!1,labelStyle:u,breakData:h}=e;let c;if(O(a))g=n.stepTicks(a),f=h&&h()?h().breakDomains:null,c=f&&f.length?g.filter(m=>f.every(b=>m<b[0]||m>b[1])):g;else if(O(l))c=Uu(e,n,l,(m,b)=>b&&b.length?n.domain(b,!0).forceTicks(m):n.forceTicks(m));else if(e.tickMode==="d3"){const m=(t=Ae(s)?s({axisLength:o,labelStyle:u}):s)!==null&&t!==void 0?t:5;c=Uu(e,n,m,(b,C)=>C&&C.length?n.domain(C,!0).d3Ticks(b,{noDecimals:d}):n.d3Ticks(b,{noDecimals:d}))}else{const m=(i=Ae(s)?s({axisLength:o,labelStyle:u}):s)!==null&&i!==void 0?i:5,b=Ae(e.tickMode)?e.tickMode:void 0;c=Uu(e,n,m,(C,_)=>_&&_.length?n.domain(_,!0).ticks(C,{noDecimals:d,customTicks:b}):n.ticks(C,{noDecimals:d,customTicks:b}))}var g,f;const p=n.domain();if(e.labelFirstVisible&&p[0]!==c[0]&&!c.includes(p[0])&&c.unshift(p[0]),e.labelLastVisible&&p[p.length-1]!==c[c.length-1]&&!c.includes(p[p.length-1])&&c.push(p[p.length-1]),e.sampling&&c.length>1&&(e.coordinateType==="cartesian"||e.coordinateType==="polar"&&e.axisOrientType==="radius")){const{labelGap:m=4,labelFlush:b}=e,C=6;let _;if(c.length*C>o){const B=[],A=Math.floor(c.length*C/o);c.forEach((M,H)=>{H%A!=0&&H!==c.length-1||B.push(M)}),_=zc(n,B,e).map((M,H)=>({AABBBounds:M,value:B[H]}))}else _=zc(n,c,e).map((B,A)=>({AABBBounds:B,value:c[A]}));const w=_[0],y=Cr(_),v=h&&h()?fb.greedy:fb.parity;for(;_.length>=3&&Fc(_,m);)_=v(_,m);const x=e.labelFirstVisible;let S=e.labelLastVisible;On(w,y,m)&&_.includes(y)&&_.length>1&&x&&S&&(_.splice(_.indexOf(y),1),S=!1),cb(w,_,x,B=>On(B,w,m)),cb(y,_,S,B=>On(B,y,m)||!(!x||B===w)&&On(B,w,m),!0);const R=_.map(B=>B.value);R.length<3&&b&&(R.length>1&&R.pop(),Cr(R)!==Cr(c)&&R.push(Cr(c))),c=R}return xi(c)},fb={parity:function(n){return n.filter((e,t)=>t%2==0)},greedy:function(n,e){let t;return n.filter((i,r)=>(!r||!On(t,i,e))&&(t=i,!0))}},gb=(n,e,t,i)=>zc(n,e,t).map(r=>i?[r.x1,r.x2,r.width()]:[r.y1,r.y2,r.height()]),pb=(n,e,t=0)=>Math.max(n[0],e[0])-t/2<=Math.min(n[1],e[1])+t/2,mb=(n,e)=>n[1]<e[0]?e[0]-n[1]:e[1]<n[0]?n[0]-e[1]:0,BP=(n,e)=>{var t;const i=n.domain();if(!i.length)return[];const{tickCount:r,forceTickCount:o,tickStep:s,labelGap:l=4,axisOrientType:a,labelStyle:d}=e,u=RP(a),h=n.range(),c=n.calculateWholeRangeSize();if(c<2)return e.labelLastVisible?xi([i[i.length-1]]):xi([i[0]]);let g;if(O(s))g=n.stepTicks(s);else if(O(o))g=n.forceTicks(o);else if(O(r)){const f=Ae(r)?r({axisLength:c,labelStyle:d}):r;g=n.ticks(f)}else if(e.sampling){const f=((t=e.labelStyle.fontSize)!==null&&t!==void 0?t:12)+2,p=Kd(h),m=bf(h);if(i.length<=c/f){const b=(m-p)/i.length,C=gb(n,i,e,u),_=Math.min(...C.map(y=>y[2])),w=MP(i,C,l,e.labelLastVisible,Math.floor(_/b));g=n.stepTicks(w.step),e.labelLastVisible&&(w.delCount&&(g=g.slice(0,g.length-w.delCount)),g.push(i[i.length-1]))}else{const b=[i[0],i[Math.floor(i.length/2)],i[i.length-1]],C=gb(n,b,e,u);let _=null;C.forEach(y=>{_?_[2]<y[2]&&(_=y):_=y});const w=m-p-l>0?Math.ceil(i.length*(l+_[2])/(m-p-l)):i.length-1;g=n.stepTicks(w),!e.labelLastVisible||g.length&&g[g.length-1]===i[i.length-1]||(g.length&&Math.abs(n.scale(g[g.length-1])-n.scale(i[i.length-1]))<_[2]&&(g=g.slice(0,-1)),g.push(i[i.length-1]))}}else g=n.domain();return xi(g)},MP=(n,e,t,i,r,o)=>{let s=0,l=0,a=-1,d=Number.MAX_VALUE;const u=g=>{let f=!0,p=0;do p+g<n.length&&pb(e[p],e[p+g],t)&&(f=!1),p+=g;while(f&&p<n.length);return f},h=Tv(r,n.length,g=>u(g)?1:-1);let c=h;do if(c>h&&!u(c))c++;else{if(!i){l=c;break}{const g=n.length-1;let f,p=0;f=n.length%c>0?n.length-n.length%c+c:n.length;do{if(f-=c,f!==g&&!pb(e[f],e[g],t))break;p++}while(f>0);if(f===g){l=c,s=p;break}{const m=Math.floor(n.length/c)-p+1;if(m<a)break;{a=m;const b=mb(e[f],e[g]),C=f-c>=0?mb(e[f-c],e[f]):b,_=Math.abs(b-C);if(_<d&&(d=_,l=c,s=p),b<=C)break}}}c++}while(c<=n.length);return{step:l,delCount:s}},TP=(n,e,t)=>{var i;const{labelStyle:r,getRadius:o,labelOffset:s,labelFormatter:l,inside:a}=t,d=o==null?void 0:o(),u=(i=r.angle)!==null&&i!==void 0?i:0,h=rw(r);return e.map(c=>{const g=l?l(c):`${c}`,{width:f,height:p}=h.quickMeasure(g),m=Math.max(f,hb),b=Math.max(p,hb),C=n.scale(c),_={x:0,y:0};let w=0,y=0;const v={align:r.textAlign,baseline:r.textBaseline},{x,y:S}=oP(C,_,d,s,a);return v.align||(_i(x,_.x)?v.baseline||(v.baseline=S>_.y?"top":"bottom"):x>_.x?v.align="left":x<_.x&&(v.align="right")),w=x+(v.align==="right"?-m:v.align==="left"?0:-m/2),y=S+(v.baseline==="bottom"?-b:v.baseline==="top"?0:-b/2),new Ue().set(w,y,w+m,y+b).rotate(u,w+m/2,y+b/2)})},PP=(n,e)=>{const{tickCount:t,forceTickCount:i,tickStep:r,getRadius:o,labelOffset:s,labelGap:l=0,labelStyle:a}=e,d=o==null?void 0:o();if(!d)return xi(n.domain());let u;if(O(r))u=n.stepTicks(r);else if(O(i))u=n.forceTicks(i);else if(O(t)){const h=n.range(),c=Math.abs(h[h.length-1]-h[0]),g=Ae(t)?t({axisLength:c,labelStyle:a}):t;u=n.ticks(g)}else if(e.sampling){const h=n.domain(),c=n.range(),g=TP(n,h,e),f=Kd(c),p=bf(c),m=Math.abs(p-f)*(d+s)/h.length,{step:b,delCount:C}=HP(h,g,l,Math.floor(g.reduce((_,w)=>Math.min(_,w.width(),w.height()),Number.MAX_VALUE)/m));u=n.stepTicks(b),u=u.slice(0,u.length-C)}else u=n.domain();return xi(u)},HP=(n,e,t,i)=>{let r=i;do{let s=!0;r++;let l=0;do l+r<n.length&&ub(e[l],e[l+r],t)&&(s=!1),l+=r;while(s&&l<n.length);if(s)break}while(r<=n.length);let o=0;if(n.length>2){let s=n.length-n.length%r;for(s>=n.length&&(s-=r);s>0&&ub(e[0],e[s]);)o++,s-=r}return{step:r,delCount:o}},kP=(n,e)=>{if(O_(n.type))return AP(n,e);if(Pv(n.type)){if(e.coordinateType==="cartesian")return BP(n,e);if(e.coordinateType==="polar"&&e.axisOrientType==="angle")return PP(n,e)}return xi(n.domain())};function bw(){nn(),Oo(),ri()}const Cw={space:8,style:{fill:"rgb(47, 69, 84)",cursor:"pointer",size:15},state:{disable:{fill:"rgb(170, 170, 170)",cursor:"not-allowed"},hover:{}}};bw();class js extends gn{getCurrent(){return this._current}constructor(e,t){super(t!=null&&t.skipDefault?e:re({},js.defaultAttributes,e)),this.name="pager",this._current=1,this._onHover=i=>{const r=i.target;r.hasState("disable")||r.addState("hover")},this._onUnHover=i=>{i.target.removeState("hover")},this._onClick=i=>{const r=i.target;if(r.name==="preHandler"){if(this._current===1)return;this._current-=1,this._current===1?r.addState("disable"):r.removeState("disable"),this._dispatchEvent("toPrev",{current:this._current,total:this._total,direction:"pre",event:i})}if(r.name==="nextHandler"){if(this._current===this._total)return;this._current+=1,this._current===this._total?r.addState("disable"):r.removeState("disable"),this._dispatchEvent("toNext",{current:this._current,total:this._total,direction:"next",event:i})}this._current>1&&this.preHandler.removeState("disable"),this._current<this._total&&this.nextHandler.removeState("disable"),this.text.setAttribute("text",this._getPageText(this._current))}}render(){var e,t,i;this._reset();const{layout:r="horizontal",handler:o=Cw,total:s,defaultCurrent:l=1,textStyle:a,padding:d=0}=this.attribute;this._current=l;const u=ei(d),h=r==="horizontal",c=ge.group({x:0,y:0}),g=o.style||{},f=g.size||15,p=(e=o.space)!==null&&e!==void 0?e:8,m=o.state||{};let{preShape:b,nextShape:C}=o;b||(b=h?"triangleLeft":"triangleUp"),C||(C=h?"triangleRight":"triangleDown");const _=ge.symbol(Object.assign(Object.assign({strokeBoundsBuffer:0,pickMode:"imprecise"},g),{x:0,y:0,symbolType:b,size:f}));_.states=m,_.name="preHandler",this.preHandler=_,c.add(_);const{width:w,height:y}=hu(this._getPageText(s),Object.assign({textAlign:"center",textBaseline:"middle"},a),(i=(t=this.stage)===null||t===void 0?void 0:t.getTheme())===null||i===void 0?void 0:i.text),v=J(f)?f:f[0],x=J(f)?f:f[1],S=ge.text(Object.assign({x:h?v/2+p+w/2:0,y:h?0:x/2+p+y/2,text:this._getPageText(l),textAlign:"center",textBaseline:"middle",lineHeight:a==null?void 0:a.fontSize},a));this.text=S,c.add(S);const R=ge.symbol(Object.assign(Object.assign({strokeBoundsBuffer:0,pickMode:"imprecise"},g),{x:h?v+2*p+w:0,y:h?0:x+2*p+y,symbolType:C,size:f}));R.name="nextHandler",R.states=m,this.nextHandler=R,c.add(R),this._total===1?(_.addState("disable"),R.addState("disable")):this._current===1?_.addState("disable"):this._current===s&&R.addState("disable");const B=c.AABBBounds,A=B.width(),M=B.height();c.translateTo(0-B.x1+u[3],0-B.y1+u[0]),this.add(c),this.attribute.width=A+u[1]+u[3],this.attribute.height=M+u[0]+u[2],this._bindEvents()}_bindEvents(){this.attribute.disableTriggerEvent||(this.preHandler&&(this.preHandler.addEventListener("pointerenter",this._onHover),this.preHandler.addEventListener("pointerleave",this._onUnHover),this.preHandler.addEventListener("pointerdown",this._onClick)),this.nextHandler&&(this.nextHandler.addEventListener("pointerenter",this._onHover),this.nextHandler.addEventListener("pointerleave",this._onUnHover),this.nextHandler.addEventListener("pointerdown",this._onClick)))}_reset(){this.removeAllChild(!0),this._current=1,this._total=this.attribute.total,this.preHandler=this.nextHandler=this.text=null}_getPageText(e){const{pageFormatter:t}=this.attribute;return t?Ae(t)?t(e,this._total):`${t}`.replace("{current}",`${e}`).replace("{total}",`${this._total}`):`${e}/${this._total}`}setTotal(e){e!==this.attribute.total&&(this._total=e,this._current!==1&&this._current<=e?this.setAttributes({total:e,defaultCurrent:this._current}):this.setAttribute("total",e))}}js.defaultAttributes={handler:Cw,textStyle:{fill:"rgb(51, 51, 51)",fontSize:12}};const ld=10,_w=8,ww=8,EP=8,Jl=16,Ql=8,al=12,Ic=12;var pe;(function(n){n.selected="selected",n.unSelected="unSelected",n.selectedHover="selectedHover",n.unSelectedHover="unSelectedHover",n.focus="focus"})(pe||(pe={}));var vn;(function(n){n.legendItemHover="legendItemHover",n.legendItemUnHover="legendItemUnHover",n.legendItemClick="legendItemClick",n.legendItemAttributeUpdate="legendItemAttributeUpdate"})(vn||(vn={}));var Tt;(function(n){n.innerView="innerView",n.title="legendTitle",n.item="legendItem",n.itemShape="legendItemShape",n.itemLabel="legendItemLabel",n.itemValue="legendItemValue",n.focus="legendItemFocus"})(Tt||(Tt={}));class $f extends gn{constructor(){super(...arguments),this.name="legend",this._title=null}render(){this.removeAllChild(!0);const{interactive:e=!0,title:t,padding:i=0}=this.attribute;this._parsedPadding=ei(i);const r=ge.group({x:this._parsedPadding[3],y:this._parsedPadding[0],pickable:e,childrenPickable:e});r.name=Tt.innerView,this.add(r),this._innerView=r,t!=null&&t.visible&&this._renderTitle(t),this._renderContent(),this._adjustLayout(),e&&this._bindEvents();const o=this._innerView.AABBBounds;this.attribute.width=o.width()+this._parsedPadding[1]+this._parsedPadding[3],this.attribute.height=o.height()+this._parsedPadding[0]+this._parsedPadding[2]}_renderTitle(e){const{text:t="",textStyle:i,padding:r=0,background:o,minWidth:s,maxWidth:l,shape:a}=e,d={x:0,y:0,text:t,textStyle:i,padding:ei(r),minWidth:s,maxWidth:l};a&&a.visible&&(d.shape=Object.assign({visible:!0},a.style),O(a.space)&&(d.space=a.space)),o&&o.visible&&(d.panel=Object.assign({visible:!0},o.style));const u=new ll(d);u.name=Tt.title,this._title=u,this._innerView.add(u)}_adjustLayout(){var e;if(this._title){const t=this._innerView.AABBBounds.width(),i=this._title.AABBBounds.width(),r=(e=this.attribute.title)===null||e===void 0?void 0:e.align;r==="center"?this._title.setAttribute("x",(t-i)/2):r==="end"&&this._title.setAttribute("x",t-i)}}}function Kf(){nn(),ri(),Ti(),Oo()}function Yf(){nn(),lw()}function LP(){Yf(),bw(),ew()}function FP(){Yf(),Kf()}function zP(){Yf(),Kf(),kT()}var bb=function(n,e){var t={};for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&e.indexOf(i)<0&&(t[i]=n[i]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function"){var r=0;for(i=Object.getOwnPropertySymbols(n);r<i.length;r++)e.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(n,i[r])&&(t[i[r]]=n[i[r]])}return t};const IP={[pe.focus]:{},[pe.selected]:{},[pe.selectedHover]:{},[pe.unSelected]:{},[pe.unSelectedHover]:{}};LP();class gu extends $f{constructor(e,t){super(t!=null&&t.skipDefault?e:re({},gu.defaultAttributes,e)),this.name="discreteLegend",this._itemsContainer=null,this._itemHeightByUser=void 0,this._itemHeight=0,this._itemMaxWidth=0,this._contentMaxHeight=0,this._onHover=i=>{const r=i.target;if(r&&r.name&&r.name.startsWith(Tt.item)){const o=r.delegate;if(this._lastActiveItem){if(this._lastActiveItem.id===o.id)return;this._unHover(this._lastActiveItem,i)}this._hover(o,i)}else this._lastActiveItem&&(this._unHover(this._lastActiveItem,i),this._lastActiveItem=null)},this._onUnHover=i=>{this._lastActiveItem&&(this._unHover(this._lastActiveItem,i),this._lastActiveItem=null)},this._onClick=i=>{var r,o,s,l;const a=i.target;if(a&&a.name&&a.name.startsWith(Tt.item)){const d=a.delegate,{selectMode:u="multiple"}=this.attribute;if(a.name===Tt.focus||u==="focus"){const h=d.hasState(pe.focus);d.toggleState(pe.focus),h?(r=this._itemsContainer)===null||r===void 0||r.getChildren().forEach(c=>{this._removeLegendItemState(c,[pe.unSelected,pe.unSelectedHover,pe.focus],i),this._setLegendItemState(c,pe.selected,i)}):(this._setLegendItemState(d,pe.selected,i),this._removeLegendItemState(d,[pe.unSelected,pe.unSelectedHover],i),(o=this._itemsContainer)===null||o===void 0||o.getChildren().forEach(c=>{d!==c&&(this._removeLegendItemState(c,[pe.selected,pe.selectedHover,pe.focus],i),this._setLegendItemState(c,pe.unSelected,i))}))}else{(s=this._itemsContainer)===null||s===void 0||s.getChildren().forEach(f=>{f.removeState(pe.focus)});const{allowAllCanceled:h=!0}=this.attribute,c=d.hasState(pe.selected),g=this._getSelectedLegends();if(u==="multiple"){if(h===!1&&c&&g.length===1)return void this._dispatchLegendEvent(vn.legendItemClick,d,i);c?(this._removeLegendItemState(d,[pe.selected,pe.selectedHover],i),this._setLegendItemState(d,pe.unSelected,i)):(this._setLegendItemState(d,pe.selected,i),this._removeLegendItemState(d,[pe.unSelected,pe.unSelectedHover],i))}else this._setLegendItemState(d,pe.selected,i),this._removeLegendItemState(d,[pe.unSelected,pe.unSelectedHover],i),(l=this._itemsContainer)===null||l===void 0||l.getChildren().forEach(f=>{d!==f&&(this._removeLegendItemState(f,[pe.selected,pe.selectedHover],i),this._setLegendItemState(f,pe.unSelected,i))})}this._dispatchLegendEvent(vn.legendItemClick,d,i)}}}render(){super.render(),this._lastActiveItem=null}setSelected(e){var t;((t=this._itemsContainer)===null||t===void 0?void 0:t.getChildren()).forEach(i=>{const r=i.data;e.includes(r.label)?(this._setLegendItemState(i,pe.selected),this._removeLegendItemState(i,[pe.unSelected,pe.unSelectedHover])):(this._removeLegendItemState(i,[pe.selected,pe.selectedHover]),this._setLegendItemState(i,pe.unSelected))})}_renderItems(){const{item:e={},maxCol:t=1,maxRow:i=2,maxWidth:r,defaultSelected:o,lazyload:s,autoPage:l}=this.attribute,{spaceCol:a=Jl,spaceRow:d=Ql,verticalAlign:u="middle"}=e,h=this._itemsContainer,{items:c,isHorizontal:g,startIndex:f,isScrollbar:p}=this._itemContext,m=p?1:g?i:t,b=this._contentMaxHeight;let C,{doWrap:_,maxWidthInCol:w,startX:y,startY:v,pages:x}=this._itemContext,S=0,R=0;const B=[];for(let A=f,M=c.length;A<M&&!(s&&x>this._itemContext.currentPage*m);A++){s&&(this._itemContext.startIndex=A+1),C=c[A],C.id||(C.id=C.label),C.index=A;let H=!0;ee(o)&&(H=o.includes(C.label));const E=this._renderEachItem(C,H,A,c),T=E.attribute.width,P=E.attribute.height;this._itemHeight=Math.max(this._itemHeight,P),w=Math.max(T,w),this._itemMaxWidth=Math.max(T,this._itemMaxWidth),g?(O(r)&&(p&&l?(x=Math.ceil((y+T)/r),_=x>1):y+T>r&&(_=!0,y>0&&(u!=="middle"&&u!=="bottom"||B.forEach(k=>{k.setAttributes({y:k.attribute.y+(R-k.attribute.height)/(u==="middle"?2:1)})}),x+=1,y=0,v+=R+d,R=0,B.length=0))),y===0&&v===0||E.setAttributes({x:y,y:v}),y+=a+T,R=Math.max(R,P),B.push(E)):(O(b)&&(p&&l?(x=Math.ceil((v+P)/b),_=x>1):b<=P?(x+=1,_=!0,v=0,A>0&&(y+=S+a)):b<v+P&&(x+=1,_=!0,v=0,y+=w+a,w=0)),y===0&&v===0||E.setAttributes({x:y,y:v}),v+=d+P),h.add(E),S=T}return!g||u!=="middle"&&u!=="bottom"||B.forEach(A=>{A.setAttributes({y:A.attribute.y+(R-A.attribute.height)/(u==="middle"?2:1)})}),this._itemContext.doWrap=_,this._itemContext.startX=y,this._itemContext.startY=v,this._itemContext.maxWidthInCol=w,this._itemContext.pages=x,this._itemContext.maxPages=m,p&&(this._itemContext.totalPage=x),s||(this._itemContext.startIndex=c.length),this._itemContext}_renderContent(){const{item:e={},items:t,reversed:i,maxWidth:r,maxHeight:o}=this.attribute;if(e.visible===!1||ye(t))return;let s=t;i&&(s=t==null?void 0:t.reverse()),this._contentMaxHeight=Math.max(0,o-this._parsedPadding[0]-this._parsedPadding[2]);const l=ge.group({x:0,y:0});this._itemsContainer=l;const{layout:a,autoPage:d}=this.attribute,u=a==="horizontal",{maxWidth:h,width:c,height:g}=e,f=[];O(h)&&f.push(h),O(c)&&f.push(c),f.length&&(O(r)&&f.push(r),this._itemWidthByUser=Kd(f)),O(g)&&(this._itemHeightByUser=g);const p=this.attribute.pager;this._itemContext={currentPage:p&&p.defaultCurrent||1,doWrap:!1,maxWidthInCol:0,maxPages:1,pages:1,startX:0,startY:0,startIndex:0,items:s,isHorizontal:u,totalPage:1/0,isScrollbar:p&&p.type==="scrollbar",clipContainer:void 0},this._itemContext=this._renderItems();let m=!1;this._itemContext.doWrap&&d&&this._itemContext.pages>this._itemContext.maxPages&&(m=this._renderPagerComponent()),m||(l.setAttribute("y",this._title?this._title.AABBBounds.height()+vt(this.attribute,"title.space",8):0),this._innerView.add(l))}_bindEvents(){if(this.attribute.disableTriggerEvent||!this._itemsContainer)return;const{hover:e=!0,select:t=!0}=this.attribute;if(e){let i="pointermove",r="pointerleave";ke(e)&&(e.trigger&&(i=e.trigger),e.triggerOff&&(r=e.triggerOff)),this._itemsContainer.addEventListener(i,this._onHover),this._itemsContainer.addEventListener(r,this._onUnHover)}if(t){let i="pointerdown";ke(t)&&t.trigger&&(i=t.trigger),this._itemsContainer.addEventListener(i,this._onClick)}}_autoEllipsis(e,t,i,r){var o,s;const{label:l,value:a}=this.attribute.item,d=r.AABBBounds,u=i.AABBBounds,h=d.width(),c=u.width();let g=!1;e==="labelFirst"?c>t?g=!0:r.setAttribute("maxLineWidth",t-c):e==="valueFirst"?h>t?g=!0:i.setAttribute("maxLineWidth",t-h):h+c>t&&(g=!0),g&&(r.setAttribute("maxLineWidth",Math.max(t*((o=l.widthRatio)!==null&&o!==void 0?o:.5),t-c)),i.setAttribute("maxLineWidth",Math.max(t*((s=a.widthRatio)!==null&&s!==void 0?s:.5),t-h)))}_renderEachItem(e,t,i,r){var o,s;const{id:l,label:a,value:d,shape:u}=e,{padding:h=0,focus:c,focusIconStyle:g,align:f,autoEllipsisStrategy:p}=this.attribute.item,{shape:m,label:b,value:C,background:_}=this.attribute.item,w=this._handleStyle(m,e,t,i,r),y=this._handleStyle(b,e,t,i,r),v=this._handleStyle(C,e,t,i,r),x=this._handleStyle(_,e,t,i,r),S=ei(h);let R;_.visible===!1?(R=ge.group({x:0,y:0,cursor:(o=x.style)===null||o===void 0?void 0:o.cursor}),this._appendDataToShape(R,Tt.item,e,R)):(R=ge.group(Object.assign({x:0,y:0},x.style)),this._appendDataToShape(R,Tt.item,e,R,x.state)),R.id=`${l??a}-${i}`,R.addState(t?pe.selected:pe.unSelected);const B=ge.group({x:0,y:0,pickable:!1});R.add(B);let A,M=0,H=0,E=0;if(m&&m.visible!==!1){const G=vt(w,"style.size",ld);H=ee(G)?G[0]||0:G,E=vt(m,"space",_w);const V=ge.symbol(Object.assign(Object.assign({x:0,y:0,symbolType:"circle",strokeBoundsBuffer:0},u),w.style));Object.keys(w.state||{}).forEach(X=>{const $=w.state[X].fill||w.state[X].stroke;u.fill&&Te(w.state[X].fill)&&$&&(w.state[X].fill=$),u.stroke&&Te(w.state[X].stroke)&&$&&(w.state[X].stroke=$)}),this._appendDataToShape(V,Tt.itemShape,e,R,w.state),V.addState(t?pe.selected:pe.unSelected),B.add(V)}let T=0;if(c){const G=vt(g,"size",ld);A=ge.symbol(Object.assign(Object.assign({x:0,y:-G/2-1,strokeBoundsBuffer:0,boundsPadding:S},g),{visible:!0,pickMode:"imprecise"})),this._appendDataToShape(A,Tt.focus,e,R),T=G}const P=b.formatMethod?b.formatMethod(a,e,i):a,k=Object.assign(Object.assign({x:H/2+E,y:0,textAlign:"start",textBaseline:"middle",lineHeight:(s=y.style)===null||s===void 0?void 0:s.fontSize},y.style),{text:P,_originText:b.formatMethod?a:void 0}),L=kc(k);this._appendDataToShape(L,Tt.itemLabel,e,R,y.state),L.addState(t?pe.selected:pe.unSelected),B.add(L);const F=vt(b,"space",ww);if(O(d)){const G=vt(C,"space",c?EP:0),V=C.formatMethod?C.formatMethod(d,e,i):d,X=Object.assign(Object.assign({x:0,y:0,textAlign:"start",textBaseline:"middle",lineHeight:v.style.fontSize},v.style),{text:V,_originText:C.formatMethod?d:void 0}),$=kc(X);if(this._appendDataToShape($,Tt.itemValue,e,R,v.state),$.addState(t?pe.selected:pe.unSelected),this._itemWidthByUser){const Q=this._itemWidthByUser-S[1]-S[3]-H-E-F-T-G;this._autoEllipsis(p,Q,L,$),C.alignRight?$.setAttributes({textAlign:"right",x:this._itemWidthByUser-H/2-S[1]-S[3]-T-G}):$.setAttribute("x",F+(L.AABBBounds.empty()?0:L.AABBBounds.x2))}else $.setAttribute("x",F+(L.AABBBounds.empty()?0:L.AABBBounds.x2));M=G+($.AABBBounds.empty()?0:$.AABBBounds.x2),B.add($)}else this._itemWidthByUser&&L.setAttribute("maxLineWidth",this._itemWidthByUser-S[1]-S[3]-H-E-T),M=F+(L.AABBBounds.empty()?0:L.AABBBounds.x2);A&&(A.setAttribute("x",M),B.add(A));const z=B.AABBBounds,I=z.width();if(f==="right"){const G=z.x2,V=z.x1;B.forEachChildren((X,$)=>{X.type!=="symbol"&&X.attribute.textAlign!=="right"||X===A?X.setAttribute("x",V+G-X.attribute.x-X.AABBBounds.width()):X.type!=="symbol"?X.setAttributes({x:V+G-X.attribute.x,textAlign:"left"}):X.setAttribute("x",V+G-X.attribute.x)})}const N=z.height(),W=O(this.attribute.item.width)?this.attribute.item.width:I+S[1]+S[3],D=this._itemHeightByUser||N+S[0]+S[2];return R.attribute.width=W,R.attribute.height=D,A&&A.setAttribute("visible",!1),B.translateTo(-z.x1+S[3],-z.y1+S[0]),R}_createPager(e){var t,i;const{disableTriggerEvent:r,maxRow:o}=this.attribute,s=l=>l<=99?99:l<=999?999:9999;return this._itemContext.isHorizontal?new js(Object.assign(Object.assign({layout:o===1?"horizontal":"vertical",total:s(this._itemContext.pages)},re({handler:{preShape:"triangleUp",nextShape:"triangleDown"}},e)),{defaultCurrent:(t=this.attribute.pager)===null||t===void 0?void 0:t.defaultCurrent,disableTriggerEvent:r})):new js(Object.assign({layout:"horizontal",total:s(this._itemContext.pages),disableTriggerEvent:r,defaultCurrent:(i=this.attribute.pager)===null||i===void 0?void 0:i.defaultCurrent},e))}_createScrollbar(e,t){const{disableTriggerEvent:i}=this.attribute;return this._itemContext.isHorizontal?new kr(Object.assign(Object.assign({direction:"horizontal",disableTriggerEvent:i,range:[0,.5],height:e.visible===!1?0:12},e),{width:t})):new kr(Object.assign(Object.assign({direction:"vertical",width:e.visible===!1?0:12,range:[0,.5]},e),{height:t,disableTriggerEvent:i}))}_updatePositionOfPager(e,t,i){const{pager:r}=this.attribute,{totalPage:o,isHorizontal:s}=this._itemContext,l=r&&r.position||"middle";if(this._pagerComponent.setTotal(o),s){let a;a=l==="start"?e:l==="end"?e+i-this._pagerComponent.AABBBounds.height()/2:e+i/2-this._pagerComponent.AABBBounds.height()/2,this._pagerComponent.setAttributes({x:t-this._pagerComponent.AABBBounds.width(),y:a})}else{let a;a=l==="start"?0:l==="end"?t-this._pagerComponent.AABBBounds.width():(t-this._pagerComponent.AABBBounds.width())/2,this._pagerComponent.setAttributes({x:a,y:i-this._pagerComponent.AABBBounds.height()})}}_computeScrollbarDelta(){const{isHorizontal:e,clipContainer:t}=this._itemContext,i=this._itemsContainer.AABBBounds,r=t.AABBBounds;let o,s;return e?(s=r.width(),o=s/i.width()):(s=r.height(),o=s/i.height()),o}_updatePositionOfScrollbar(e,t,i){const{isHorizontal:r,currentPage:o,totalPage:s}=this._itemContext,l=(o-1)/s;this._pagerComponent.setScrollRange([l,l+this._computeScrollbarDelta()]),r?this._pagerComponent.setAttributes({x:0,y:i+t}):this._pagerComponent.setAttributes({x:e,y:i})}_bindEventsOfPager(e,t){const i=this.attribute.pager||{},{animation:r=!0,animationDuration:o=450,animationEasing:s="quadIn"}=i,l=this._itemContext.isScrollbar?u=>{const{value:h}=u.detail;let c;return c=h[0]===0?1:h[1]===1?this._itemContext.totalPage:h[0]*this._itemContext.totalPage+1,c}:u=>u.detail.current,a=u=>{const h=this._pagerComponent,c=h.getScrollRange(),{direction:g}=h.attribute,{width:f,height:p}=h.getSliderRenderBounds(),m=g==="vertical"?u.deltaY/p:u.deltaX/f;h.setScrollRange([c[0]+m,c[1]+m],!0),this.updateScrollMask()},d=u=>{const h=l(u);if(h!==this._itemContext.currentPage){if(this._itemContext.currentPage=h,this._itemContext&&this._itemContext.startIndex<this._itemContext.items.length){this._renderItems();const c=Math.ceil(this._itemContext.pages/this._itemContext.maxPages);if(this._itemContext.totalPage=c,this._itemContext.isScrollbar&&this._pagerComponent){const g=this._computeScrollbarDelta(),[f]=this._pagerComponent.getScrollRange();this._pagerComponent.setScrollRange([f,f+g])}}if(this._itemContext.isScrollbar){const[c]=this._pagerComponent.getScrollRange();let g;g=this._itemContext.isHorizontal?this._itemsContainer.AABBBounds.width():this._itemsContainer.AABBBounds.height();const f=g*c;this.updateScrollMask(),r?this._itemsContainer.animate().to({[t]:-f},o,s):this._itemsContainer.setAttribute(t,-f)}else r?this._itemsContainer.animate().to({[t]:-(h-1)*e},o,s):this._itemsContainer.setAttribute(t,-(h-1)*e)}};this._itemContext.isScrollbar?(this._pagerComponent.addEventListener("scrollDrag",d),this._pagerComponent.addEventListener("scrollUp",d),this.attribute.pager.roamScroll&&(this.addEventListener("wheel",h=>h.nativeEvent.preventDefault()),this.addEventListener("wheel",I_(a,50)))):(this._pagerComponent.addEventListener("toPrev",d),this._pagerComponent.addEventListener("toNext",d))}_renderPager(){const e=this._title?this._title.AABBBounds.height()+vt(this.attribute,"title.space",8):0,{maxWidth:t,maxCol:i=1,maxRow:r=2,item:o={},pager:s={}}=this.attribute,{spaceCol:l=Jl,spaceRow:a=Ql}=o,d=this._itemsContainer,{space:u=Ic,defaultCurrent:h=1}=s,c=bb(s,["space","defaultCurrent"]),{isHorizontal:g}=this._itemContext,f=this._contentMaxHeight;let p,m=0,b=0,C=0,_=0,w=0,y=0,v=1;if(g){if(b=(r-1)*a+this._itemHeight*r,m=t,p=this._createPager(c),this._pagerComponent=p,this._innerView.add(p),C=t-p.AABBBounds.width()-u,C<=0)return this._innerView.removeChild(p),!1;d.getChildren().forEach((R,B)=>{const{width:A,height:M}=R.attribute;C<w+A&&(w=0,y+=M+a,v+=1),B>0&&R.setAttributes({x:w,y}),w+=l+A}),this._itemContext.startX=w,this._itemContext.startY=y,this._itemContext.pages=v;const S=Math.ceil(v/r);this._itemContext.totalPage=S,this._updatePositionOfPager(e,m,b)}else{if(m=this._itemMaxWidth*i+(i-1)*l,b=f,C=m,p=this._createPager(c),this._pagerComponent=p,this._innerView.add(p),_=f-p.AABBBounds.height()-u-e,_<=0)return this._innerView.removeChild(p),!1;d.getChildren().forEach((R,B)=>{const{height:A}=R.attribute;_<y+A&&(y=0,w+=this._itemMaxWidth+l,v+=1),B>0&&R.setAttributes({x:w,y}),y+=a+A});const S=Math.ceil(v/i);this._itemContext.totalPage=S,this._updatePositionOfPager(e,m,b)}h>1&&(g?d.setAttribute("y",-(h-1)*(b+a)):d.setAttribute("x",-(h-1)*(m+l)));const x=ge.group({x:0,y:e,width:g?C:m,height:g?b:_,clip:!0,pickable:!1});return x.add(d),this._innerView.add(x),this._itemContext.clipContainer=x,this._bindEventsOfPager(g?b+a:m+l,g?"y":"x"),!0}_renderScrollbar(){var e;const t=this._title?this._title.AABBBounds.height()+vt(this.attribute,"title.space",8):0,{maxWidth:i,item:r={},pager:o={}}=this.attribute,{spaceCol:s=Jl,spaceRow:l=Ql}=r,a=this._itemsContainer,{space:d=Ic,defaultCurrent:u=1}=o,h=bb(o,["space","defaultCurrent"]),{isHorizontal:c}=this._itemContext,g=this._contentMaxHeight;let f,p=0,m=0,b=0,C=1;if(c)p=i,m=this._itemHeight,f=this._createScrollbar(h,p),this._pagerComponent=f,this._innerView.add(f);else{if(m=g-t,p=this._itemMaxWidth,f=this._createScrollbar(h,m),this._pagerComponent=f,this._innerView.add(f),m<=0)return this._innerView.removeChild(f),!1;const w=a.getChildren(),y=w.map(v=>v.attribute.height);if(y.length===1||y.every(v=>v===y[0])){const v=y[0],x=m,S=Math.floor(x/(l+v));m=S*(l+v),C=Math.ceil(w.length/S)}else w.forEach((v,x)=>{const{height:S}=v.attribute,R=C,B=b;C=Math.floor((b+S)/m)+1,b+=l+S,R!==C&&x===a.getChildren().length-1&&b-m>=1/3*S&&(m=B+S,C-=1)});this._itemContext.totalPage=C,this._itemContext.pages=C}if(u>1)if(c){const w=this._itemsContainer.AABBBounds.width()-p;a.setAttribute("x",-Math.min((u-1)*(p+s),w))}else{const w=this._itemsContainer.AABBBounds.height()-m;a.setAttribute("y",-Math.min((u-1)*(m+l),w))}const _=ge.group({x:0,y:t,width:p,height:m,clip:!0,pickable:!1});return _.add(a),this._innerView.add(_),this._itemContext.clipContainer=_,this._updatePositionOfScrollbar(p,m,t),!((e=o.scrollMask)===null||e===void 0)&&e.visible&&this.renderScrollMask(_),this._bindEventsOfPager(c?p:m,c?"x":"y"),!0}renderScrollMask(e){const{scrollMask:t={}}=this.attribute.pager,{visible:i=!0,gradientLength:r=16,gradientStops:o}=t;if(!i||!o)return;const s=e.AABBBounds.width(),l=e.AABBBounds.height(),a=this._itemContext.isHorizontal?s:l,d=o.map(c=>({offset:r*c.offset/a,color:c.color})),u=o.map(c=>({offset:(a-r*c.offset)/a,color:c.color})),h=ge.rect({x:0,y:0,width:s,height:l});this._scrollMask=h,this._scrollMaskContext={startStops:d,endStops:u},this.updateScrollMask(),e.add(h)}updateScrollMask(){if(!this._scrollMask||!this._pagerComponent||!this._itemContext.isScrollbar)return;const[e,t]=this._pagerComponent.getScrollRange(),i=[];_i(Fn(t,0,1),1)||i.push(...this._scrollMaskContext.endStops),_i(Fn(e,0,1),0)||i.push(...this._scrollMaskContext.startStops),i.length&&(this._itemContext.isHorizontal?this._scrollMask.setAttributes({fill:{gradient:"linear",x0:0,y0:0,x1:1,y1:0,stops:i}}):this._scrollMask.setAttributes({fill:{gradient:"linear",x0:0,y0:0,x1:0,y1:1,stops:i}}))}_renderPagerComponent(){return this._itemContext.isScrollbar?this._renderScrollbar():this._renderPager(),!0}_hover(e,t){this._lastActiveItem=e,e.hasState(pe.selected)?this._setLegendItemState(e,pe.selectedHover,t):this._setLegendItemState(e,pe.unSelectedHover,t);const i=e.getChildren()[0].find(r=>r.name===Tt.focus,!1);i&&i.setAttribute("visible",!0),this._dispatchLegendEvent(vn.legendItemHover,e,t)}_unHover(e,t){let i=!1;(e.hasState(pe.unSelectedHover)||e.hasState(pe.selectedHover))&&(i=!0),e.removeState(pe.unSelectedHover),e.removeState(pe.selectedHover),e.getChildren()[0].getChildren().forEach(o=>{i||!o.hasState(pe.unSelectedHover)&&!o.hasState(pe.selectedHover)||(i=!0),o.removeState(pe.unSelectedHover),o.removeState(pe.selectedHover)});const r=e.getChildren()[0].find(o=>o.name===Tt.focus,!1);r&&r.setAttribute("visible",!1),i&&this._dispatchLegendEvent(vn.legendItemAttributeUpdate,e,t),this._dispatchLegendEvent(vn.legendItemUnHover,e,t)}_setLegendItemState(e,t,i){let r=!1;e.hasState(t)||(r=!0),e.addState(t,!0),e.getChildren()[0].getChildren().forEach(o=>{o.name!==Tt.focus&&(r||o.hasState(t)||(r=!0),o.addState(t,!0))}),r&&this._dispatchLegendEvent(vn.legendItemAttributeUpdate,e,i)}_removeLegendItemState(e,t,i){let r=!1;t.forEach(o=>{!r&&e.hasState(o)&&(r=!0),e.removeState(o)}),e.getChildren()[0].getChildren().forEach(o=>{o.name!==Tt.focus&&t.forEach(s=>{!r&&o.hasState(s)&&(r=!0),o.removeState(s)})}),r&&this._dispatchLegendEvent(vn.legendItemAttributeUpdate,e,i)}_getSelectedLegends(){var e;const t=[];return(e=this._itemsContainer)===null||e===void 0||e.getChildren().forEach(i=>{i.hasState(pe.selected)&&t.push(i.data)}),t}_appendDataToShape(e,t,i,r,o={}){e.name=t,e.data=i,e.delegate=r,e.states=re({},IP,o)}_dispatchLegendEvent(e,t,i){const r=this._getSelectedLegends();r.sort((s,l)=>s.index-l.index);const o=r.map(s=>s.label);this._dispatchEvent(e,{item:t,data:t.data,selected:t.hasState(pe.selected),currentSelectedItems:r,currentSelected:o,event:i})}_handleStyle(e,t,i,r,o){const s={};return e.style&&(Ae(e.style)?s.style=e.style(t,i,r,o):s.style=e.style),e.state&&(s.state={},Object.keys(e.state).forEach(l=>{e.state[l]&&(Ae(e.state[l])?s.state[l]=e.state[l](t,i,r,o):s.state[l]=e.state[l])})),s}release(){super.release(),this.removeAllEventListeners()}}gu.defaultAttributes={layout:"horizontal",title:{align:"start",space:al,textStyle:{fontSize:12,fontWeight:"bold",fill:"#2C3542"}},item:{spaceCol:Jl,spaceRow:Ql,shape:{space:_w,style:{size:ld,cursor:"pointer"},state:{selectedHover:{opacity:.85},unSelected:{opacity:.5}}},label:{space:ww,style:{fontSize:12,fill:"#2C3542",cursor:"pointer"},state:{selectedHover:{opacity:.85},unSelected:{fill:"#D8D8D8"}}},value:{alignRight:!1,style:{fontSize:12,fill:"#ccc",cursor:"pointer"},state:{selectedHover:{opacity:.85},unSelected:{fill:"#D8D8D8"}}},background:{style:{cursor:"pointer"}},focus:!1,focusIconStyle:{size:ld,symbolType:"M8 1C11.866 1 15 4.13401 15 8C15 11.866 11.866 15 8 15C4.13401 15 1 11.866 1 8C1 4.13401 4.13401 1 8 1ZM8.75044 2.55077L8.75 3.75H7.25L7.25006 2.5507C4.81247 2.88304 2.88304 4.81247 2.5507 7.25006L3.75 7.25V8.75L2.55077 8.75044C2.8833 11.1878 4.81264 13.117 7.25006 13.4493L7.25 12.25H8.75L8.75044 13.4492C11.1876 13.1167 13.1167 11.1876 13.4492 8.75044L12.25 8.75V7.25L13.4493 7.25006C13.117 4.81264 11.1878 2.8833 8.75044 2.55077ZM8 5.5C9.38071 5.5 10.5 6.61929 10.5 8C10.5 9.38071 9.38071 10.5 8 10.5C6.61929 10.5 5.5 9.38071 5.5 8C5.5 6.61929 6.61929 5.5 8 5.5ZM8 7C7.44772 7 7 7.44772 7 8C7 8.55228 7.44772 9 8 9C8.55228 9 9 8.55228 9 8C9 7.44772 8.55228 7 8 7Z",fill:"#333",cursor:"pointer"}},autoPage:!0,pager:{space:Ic,handler:{style:{size:10},space:4}},hover:!0,select:!0,selectMode:"multiple",allowAllCanceled:!0};var Mt;(function(n){n.innerView="innerView",n.railContainer="sliderRailContainer",n.rail="sliderRail",n.startText="sliderStartText",n.endText="sliderEndText",n.startHandler="sliderStartHandler",n.startHandlerText="startHandlerText",n.endHandler="sliderEndHandler",n.endHandlerText="sliderEndHandlerText",n.track="sliderTrack",n.trackContainer="sliderTrackContainer"})(Mt||(Mt={}));function $u(n){return ee(n)?n:[n,n]}function Ll(n){return n?"ew-resize":"ns-resize"}Kf();class dl extends gn{get track(){return this._track}get currentValue(){return this._currentValue}get startHandler(){return this._startHandler}get endHandler(){return this._endHandler}get tooltipShape(){return this._tooltipShape}constructor(e,t){super(t!=null&&t.skipDefault?e:re({},dl.defaultAttributes,e)),this.name="slider",this._isHorizontal=!0,this._startHandler=null,this._endHandler=null,this._startHandlerText=null,this._endHandlerText=null,this._currentHandler=null,this._currentValue={},this._onTooltipShow=i=>{this._isChanging||this._tooltipState&&this._tooltipState.isActive||(this._tooltipState?this._tooltipState.isActive=!0:this._tooltipState={isActive:!0},this._onTooltipUpdate(i),this._dispatchTooltipEvent("sliderTooltipShow"))},this._onTooltipUpdate=i=>{if(this._isChanging||!this._tooltipState||!this._tooltipState.isActive)return;const r=this._isHorizontal?this._rail.globalAABBBounds.width():this._rail.globalAABBBounds.height(),o=Fn(this._isHorizontal?(i.viewX-this._rail.globalAABBBounds.x1)/r:(i.viewY-this._rail.globalAABBBounds.y1)/r,0,1);o!==this._tooltipState.pos&&(this._tooltipState.pos=o,this._tooltipState.value=this.calculateValueByPos(o*r),this._updateTooltip(),this._dispatchTooltipEvent("sliderTooltipUpdate"))},this._onTooltipHide=()=>{const{tooltip:i}=this.attribute;i&&i.alwaysShow||(this._tooltipState=null,this._tooltipShape&&this._tooltipShape.setAttribute("visible",!1),this._tooltipText&&this._tooltipText.setAttribute("visible",!1),this._dispatchTooltipEvent("sliderTooltipHide"))},this._onHandlerPointerdown=i=>{i.stopPropagation(),this._isChanging=!0;const{x:r,y:o}=this.stage.eventPointTransform(i);this._currentHandler=i.target,this._prePos=this._isHorizontal?r:o,et.env==="browser"?(et.addEventListener("pointermove",this._onHandlerPointerMove,{capture:!0}),et.addEventListener("pointerup",this._onHandlerPointerUp)):(this.stage.addEventListener("pointermove",this._onHandlerPointerMove,{capture:!0}),this.stage.addEventListener("pointerup",this._onHandlerPointerUp),this.stage.addEventListener("pointerupoutside",this._onHandlerPointerUp))},this._onHandlerPointerMove=i=>{var r,o;i.stopPropagation(),this._isChanging=!0;const{railWidth:s,railHeight:l,min:a,max:d}=this.attribute;if(d===a)return;const{x:u,y:h}=this.stage.eventPointTransform(i);let c,g,f,p=0;this._isHorizontal?(c=u,p=c-this._prePos,g=(o=this._currentHandler)===null||o===void 0?void 0:o.attribute.x,f=s):(c=h,p=c-this._prePos,g=(r=this._currentHandler)===null||r===void 0?void 0:r.attribute.y,f=l);const m=Fn(g+p,0,f),b=this.calculateValueByPos(m);this._currentHandler.type==="text"?this._updateHandlerText(this._currentHandler,m,b):this._updateHandler(this._currentHandler,m,b),this._updateTrack(),this._prePos=c,this._dispatchChangeEvent()},this._onHandlerPointerUp=i=>{i.preventDefault(),this._isChanging=!1,this._currentHandler=null,et.env==="browser"?(et.removeEventListener("pointermove",this._onHandlerPointerMove,{capture:!0}),et.removeEventListener("pointerup",this._onHandlerPointerUp)):(this.stage.removeEventListener("pointermove",this._onHandlerPointerMove,{capture:!0}),this.stage.removeEventListener("pointerup",this._onHandlerPointerUp),this.stage.removeEventListener("pointerupoutside",this._onHandlerPointerUp))},this._onTrackPointerdown=i=>{i.stopPropagation(),this._isChanging=!0;const{x:r,y:o}=this.stage.eventPointTransform(i);this._prePos=this._isHorizontal?r:o,et.env==="browser"?(et.addEventListener("pointermove",this._onTrackPointerMove,{capture:!0}),et.addEventListener("pointerup",this._onTrackPointerUp)):(this.stage.addEventListener("pointermove",this._onTrackPointerMove,{capture:!0}),this.stage.addEventListener("pointerup",this._onTrackPointerUp),this.stage.addEventListener("pointerupoutside",this._onTrackPointerUp))},this._onTrackPointerMove=i=>{i.stopPropagation(),this._isChanging=!0;const{railWidth:r,railHeight:o,min:s,max:l,inverse:a}=this.attribute;if(l===s)return;const{startHandler:d,endHandler:u}=this._getHandlers();let h,c,g;const{x:f,y:p}=this.stage.eventPointTransform(i);this._isHorizontal?(h=f,c=this._track.attribute.width,g=r):(h=p,c=this._track.attribute.height,g=o);const m=h-this._prePos;if(d){const b=this._isHorizontal?d.attribute.x:d.attribute.y,C=a?Fn(b+m,c,g):Fn(b+m,0,g-c),_=this.calculateValueByPos(C);this._updateHandler(d,C,_)}if(u){const b=this._isHorizontal?u.attribute.x:u.attribute.y,C=a?Fn(b+m,0,g-c):Fn(b+m,c,g),_=this.calculateValueByPos(C),w=d==null?void 0:d.attribute;this._updateHandler(u,C,_),this._track.setAttributes(this._isHorizontal?{x:Math.min(w.x,u.attribute.x),width:Math.abs(w.x-u.attribute.x)}:{y:Math.min(w.y,u.attribute.y),height:Math.abs(w.y-u.attribute.y)})}this._prePos=h,this._dispatchChangeEvent()},this._onTrackPointerUp=i=>{i.preventDefault(),this._isChanging=!1,et.env==="browser"?(et.removeEventListener("pointermove",this._onTrackPointerMove,{capture:!0}),et.removeEventListener("pointerup",this._onTrackPointerUp)):(this.stage.removeEventListener("pointermove",this._onTrackPointerMove,{capture:!0}),this.stage.removeEventListener("pointerup",this._onTrackPointerUp),this.stage.removeEventListener("pointerupoutside",this._onTrackPointerUp))},this._onRailPointerDown=i=>{i.stopPropagation(),this._isChanging=!0;const{railWidth:r,railHeight:o,min:s,max:l}=this.attribute;if(l===s)return;const a=this._startHandler,d=this._endHandler;let u,h,c;this._isHorizontal?(u=i.viewX-this._rail.globalAABBBounds.x1,h=a==null?void 0:a.attribute.x,c=d==null?void 0:d.attribute.x):(u=i.viewY-this._rail.globalAABBBounds.y1,h=a==null?void 0:a.attribute.y,c=d==null?void 0:d.attribute.y);const g=this.calculateValueByPos(u);if(O(c)){const f=Math.abs(u-h)>Math.abs(u-c)?d:a;this._updateHandler(f,u,g)}else this._updateHandler(a,u,g);this._updateTrack(),this._dispatchChangeEvent()}}calculatePosByValue(e,t){const{layout:i,railWidth:r,railHeight:o,min:s,max:l,inverse:a}=this.attribute;let d=0;return d=s===l?t==="start"?0:t==="end"?1:0:(e-s)/(l-s),(a?1-d:d)*(i==="vertical"?o:r)}calculateValueByPos(e){const{layout:t,railWidth:i,railHeight:r,min:o,max:s,inverse:l}=this.attribute,a=t==="vertical"?r:i;return o+(s-o)*(l?1-e/a:e/a)}setValue(e){const{min:t,max:i}=this.attribute;if(i===t)return;const[r,o]=xh(e),{startHandler:s,endHandler:l}=this._getHandlers();s&&this._updateHandler(s,this.calculatePosByValue(r),r),l&&this._updateHandler(l,this.calculatePosByValue(o),o),this._updateTrack()}render(){var e,t;this.removeAllChild(!0);const{layout:i="horizontal",railWidth:r,railHeight:o,startText:s,endText:l,min:a,max:d,showHandler:u=!0,showTooltip:h}=this.attribute;let{value:c}=this.attribute;Te(c)&&(c=[a,d]),this._currentValue={startValue:$u(c)[0],endValue:$u(c)[1]};const g=i==="horizontal";this._isHorizontal=g;const f=ge.group({x:0,y:0});f.name=Mt.innerView,this.add(f),this._innerView=f;let p,m=0;if(s&&s.visible){p=ge.text(Object.assign({x:g?0:r/2,y:g?o/2:0,textAlign:g?"start":"center",textBaseline:g?"middle":"top",text:s.text,lineHeight:(e=s.style)===null||e===void 0?void 0:e.fontSize},s.style)),p.name=Mt.startText,f.add(p);const w=O(s.space)?s.space:0;m+=(g?p.AABBBounds.width():p.AABBBounds.height())+w}const b=ge.group({x:g?m:0,y:g?0:m});f.add(b);const C=ge.group({x:0,y:0});let _;if(C.name=Mt.railContainer,this._railContainer=C,b.add(C),this._mainContainer=b,this._renderRail(C),m+=g?r:o,l&&l.visible){const w=O(l.space)?l.space:0;_=ge.text(Object.assign({x:g?m+w:r/2,y:g?o/2:m+w,textAlign:g?"start":"center",textBaseline:g?"middle":"top",text:l.text,lineHeight:(t=l.style)===null||t===void 0?void 0:t.fontSize},l.style)),_.name=Mt.endText,f.add(_)}this._renderTrack(C),u&&(this._renderHandlers(b),this._bindEvents()),h&&(this._renderTooltip(),this._bindTooltipEvents())}_renderRail(e){const{railWidth:t,railHeight:i,railStyle:r,slidable:o}=this.attribute;let s="default";o!==!1&&(s="pointer");const l=ge.rect(Object.assign({x:0,y:0,width:t,height:i,cursor:s},r));return l.name=Mt.rail,e.add(l),this._rail=l,l}_renderHandlers(e){const{range:t,min:i,max:r,handlerSize:o=14,handlerStyle:s,handlerText:l,railHeight:a,railWidth:d,slidable:u}=this.attribute;let{value:h}=this.attribute;Te(h)&&(h=[i,r]);const c=l&&l.visible,g=this._isHorizontal,[f,p]=$u(h),m=this.calculatePosByValue(f,t?"start":"end"),b=this._renderHandler(Object.assign({x:g?m:d/2,y:g?a/2:m,size:o,strokeBoundsBuffer:0,cursor:u===!1?"default":Ll(g)},s));if(b.name=Mt.startHandler,this._startHandler=b,e.add(b),this._currentValue.startPos=m,c){const C=this._renderHandlerText(f,t?"start":"end");C.name=Mt.startHandlerText,e.add(C),this._startHandlerText=C}if(t){const C=this.calculatePosByValue(p,"end"),_=this._renderHandler(Object.assign({x:g?C:d/2,y:g?a/2:C,size:o,strokeBoundsBuffer:0,cursor:u===!1?"default":Ll(g)},s));if(_.name=Mt.endHandler,this._endHandler=_,e.add(_),this._currentValue.endPos=C,c){const w=this._renderHandlerText(p,"end");w.name=Mt.endHandlerText,e.add(w),this._endHandlerText=w}}}_renderTrack(e){const{range:t,min:i,max:r,railHeight:o,railWidth:s,trackStyle:l,railStyle:a,slidable:d,value:u}=this.attribute;let h,c;if(Te(u))t?(h=i,c=r):h=c=i;else if(t){const w=lr(u,i,r);h=w[0],c=w[1]}else h=i,c=Fn(u,i,r);const g=this._isHorizontal;t||(h=i);const f=ge.group({x:0,y:0,width:s,height:o,cornerRadius:a==null?void 0:a.cornerRadius,clip:!0,pickable:!1});f.name=Mt.trackContainer;const p=ke(t)&&t.draggableTrack===!0;let m;m=d===!1?"default":t===!1||p===!1?"pointer":Ll(g);const b=this.calculatePosByValue(h,"start"),C=this.calculatePosByValue(c,t?"end":"start"),_=ge.rect(Object.assign({x:g?Math.min(b,C):0,y:g?0:Math.min(b,C),width:g?Math.abs(C-b):s,height:g?o:Math.abs(C-b),cursor:m},l));_.name=Mt.track,this._track=_,f.add(_),e.add(f)}_renderHandler(e){return ge.symbol(e)}_renderHandlerText(e,t){var i,r,o;const{align:s,handlerSize:l=14,handlerText:a={},railHeight:d,railWidth:u,slidable:h}=this.attribute,c=this._isHorizontal,g=this.calculatePosByValue(e,t),f=(i=a.space)!==null&&i!==void 0?i:4,p={text:a.formatter?a.formatter(e):e.toFixed((r=a.precision)!==null&&r!==void 0?r:0),lineHeight:(o=a.style)===null||o===void 0?void 0:o.lineHeight,cursor:h===!1?"default":Ll(c)};return c?s==="top"?(p.textBaseline="bottom",p.textAlign="center",p.x=g,p.y=(d-l)/2-f):(p.textBaseline="top",p.textAlign="center",p.x=g,p.y=(d+l)/2+f):s==="left"?(p.textBaseline="middle",p.textAlign="end",p.x=(u-l)/2-f,p.y=g):(p.textBaseline="middle",p.textAlign="start",p.x=(u+l)/2+f,p.y=g),ge.text(Object.assign(Object.assign({},p),a.style))}_renderTooltip(){var e;const{tooltip:t,railHeight:i,railWidth:r,align:o}=this.attribute;t&&t.alwaysShow?this._tooltipState={value:this._currentValue.startValue,pos:this._currentValue.startPos}:this._tooltipState=null;const s=this._isHorizontal?0:r/2,l=this._isHorizontal?i/2:0;if(t&&t.shape){const c=ge.symbol(Object.assign({pickable:!1,visible:!!this._tooltipState,x:s,y:l,symbolType:"circle"},t.shapeStyle));this._tooltipShape=c,this._mainContainer.add(c)}const a=t&&t.text||{},d=(e=a.space)!==null&&e!==void 0?e:6,u={pickable:!1,visible:!!this._tooltipState,text:""};this._isHorizontal?(u.x=s,u.y=o==="top"?l-i/2-d:l+i/2+d,u.textAlign="center",u.textBaseline=o==="top"?"bottom":"top"):(u.y=l,u.x=o==="left"?s-r/2-d:l+r/2+d,u.textAlign=o==="left"?"end":"start",u.textBaseline="middle");const h=ge.text(Object.assign(Object.assign({},u),a.style));this._mainContainer.add(h),this._tooltipText=h,this._tooltipState&&this._updateTooltip()}_updateTooltip(){var e,t;if(!this._tooltipShape&&!this._tooltipText||!this._tooltipState)return;const{railWidth:i,railHeight:r}=this.attribute,o=this._isHorizontal?i:r,s=this._tooltipState.pos*o,l=this._isHorizontal?"x":"y";this._tooltipShape&&this._tooltipShape.setAttributes({visible:!0,[l]:s});const{align:a}=this.attribute;if(this._tooltipText){const d=this.attribute.tooltip&&this.attribute.tooltip.text||{};this._tooltipText.setAttributes({visible:!0,[l]:s,text:d.formatter?d.formatter(this._tooltipState.value):this._isHorizontal||a!=="left"?`≈ ${this._tooltipState.value.toFixed((t=d.precision)!==null&&t!==void 0?t:0)}`:`${this._tooltipState.value.toFixed((e=d.precision)!==null&&e!==void 0?e:0)} ≈`})}}_bindEvents(){if(this.attribute.disableTriggerEvent)return;const{slidable:e,range:t}=this.attribute;e&&(this._startHandler&&this._startHandler.addEventListener("pointerdown",this._onHandlerPointerdown),this._startHandlerText&&this._startHandlerText.addEventListener("pointerdown",this._onHandlerPointerdown),this._endHandler&&this._endHandler.addEventListener("pointerdown",this._onHandlerPointerdown),this._endHandlerText&&this._endHandlerText.addEventListener("pointerdown",this._onHandlerPointerdown),ke(t)&&t.draggableTrack&&this._track.addEventListener("pointerdown",this._onTrackPointerdown),this._railContainer.addEventListener("pointerdown",this._onRailPointerDown))}_bindTooltipEvents(){this.attribute.disableTriggerEvent||(this._mainContainer.addEventListener("pointerenter",this._onTooltipShow),this._mainContainer.addEventListener("pointermove",this._onTooltipUpdate),this._mainContainer.addEventListener("pointerleave",this._onTooltipHide))}_updateTrack(){const{inverse:e,railWidth:t,railHeight:i}=this.attribute,r=this._startHandler,o=this._endHandler;if(this._isHorizontal){const s=r==null?void 0:r.attribute.x;if(o){const l=o==null?void 0:o.attribute.x;this._track.setAttributes({x:Math.min(s,l),width:Math.abs(s-l)})}else e?this._track.setAttributes({x:s,width:t-s}):this._track.setAttributes({width:s})}else{const s=r==null?void 0:r.attribute.y;if(o){const l=o==null?void 0:o.attribute.y;this._track.setAttributes({y:Math.min(s,l),height:Math.abs(s-l)})}else e?this._track.setAttributes({y:s,height:i-s}):this._track.setAttributes({height:s})}}_updateHandler(e,t,i){var r;const o=this._isHorizontal;e.setAttribute(o?"x":"y",t);const s=e.name===Mt.startHandler?this._startHandlerText:this._endHandlerText;if(s){const{handlerText:l={}}=this.attribute;s.setAttributes({text:l.formatter?l.formatter(i):i.toFixed((r=l.precision)!==null&&r!==void 0?r:0),[o?"x":"y"]:t})}e.name===Mt.startHandler?(this._currentValue.startValue=i,this._currentValue.startPos=t):(this._currentValue.endValue=i,this._currentValue.endPos=t)}_updateHandlerText(e,t,i){var r;const o=this._isHorizontal,{handlerText:s={}}=this.attribute;e.setAttributes({[o?"x":"y"]:t,text:s.formatter?s.formatter(i):i.toFixed((r=s.precision)!==null&&r!==void 0?r:0)});const l=e.name===Mt.startHandlerText?this._startHandler:this._endHandler;l&&l.setAttributes({[o?"x":"y"]:t}),e.name===Mt.startHandlerText?(this._currentValue.startValue=i,this._currentValue.startPos=t):(this._currentValue.endValue=i,this._currentValue.endPos=t)}_dispatchChangeEvent(){const e=!!this.attribute.range,t=this._currentValue;this._dispatchEvent("change",{value:e?[Math.min(t.endValue,t.startValue),Math.max(t.endValue,t.startValue)]:t.startValue,position:e?[Math.min(t.endPos,t.startPos),Math.max(t.endPos,t.startPos)]:t.startPos})}_dispatchTooltipEvent(e){this._dispatchEvent("sliderTooltip",{type:e,position:this._tooltipState&&this._tooltipState.pos,value:this._tooltipState&&this._tooltipState.value})}_getHandlers(){const{inverse:e}=this.attribute;let t=this._startHandler,i=this._endHandler;return i?(this._isHorizontal?(!e&&i.attribute.x<(t==null?void 0:t.attribute.x)||e&&i.attribute.x>(t==null?void 0:t.attribute.x))&&([t,i]=[i,t]):(!e&&i.attribute.y<(t==null?void 0:t.attribute.y)||e&&i.attribute.y>(t==null?void 0:t.attribute.y))&&([t,i]=[i,t]),{startHandler:t,endHandler:i}):{startHandler:t,endHandler:i}}}dl.defaultAttributes={slidable:!0,layout:"horizontal",align:"bottom",height:8,showHandler:!0,handlerSize:14,handlerStyle:{symbolType:"circle",fill:"#fff",stroke:"#91caff",lineWidth:2},tooltip:{shapeStyle:{symbolType:"circle",fill:"#fff",stroke:"#91caff",lineWidth:2},text:{style:{fill:"#2C3542",fontSize:12}}},railStyle:{fill:"rgba(0,0,0,.04)"},trackStyle:{fill:"#91caff"},showValue:!0,valueStyle:{fill:"#2C3542",fontSize:12},startText:{style:{fill:"#2C3542",fontSize:12}},endText:{style:{fill:"#2C3542",fontSize:12}},handlerText:{visible:!0,space:4,precision:0,style:{fill:"#2C3542",fontSize:12}}};FP();class pu extends $f{constructor(e,t){super(t!=null&&t.skipDefault?e:re({},pu.defaultAttributes,e)),this.name="colorLegend",this._onSliderToolipChange=i=>{const r=this._slider.tooltipShape;if(r&&i.detail&&!Te(i.detail.value)){const o=this._colorScale.scale(i.detail.value);r.setAttribute("fill",o)}this.dispatchEvent(i)},this._onSliderChange=i=>{this._updateColor(),this.dispatchEvent(i)}}setSelected(e){this._slider&&(this._slider.setValue(e),this._updateColor())}_renderContent(){const{colors:e,slidable:t,layout:i,align:r,min:o,max:s,value:l,railWidth:a,railHeight:d,showHandler:u=!0,handlerSize:h,handlerStyle:c,railStyle:g,trackStyle:f,startText:p,endText:m,handlerText:b,showTooltip:C,tooltip:_,inverse:w,disableTriggerEvent:y}=this.attribute,v=[],x=(s-o)/(e.length-1);for(let R=0;R<e.length;R++)v.push(o+x*R);this._colorScale=new Hv().domain(v,!0).range(e),this._color=this._getTrackColor();const S=new dl({x:0,y:0,range:{draggableTrack:!0},slidable:t,layout:i,align:r,min:o,max:s,value:l,railWidth:a,railHeight:d,showHandler:u,handlerSize:h,handlerStyle:c,railStyle:g,trackStyle:Object.assign({fill:this._color},f),startText:p,endText:m,handlerText:b,showTooltip:C,tooltip:_,disableTriggerEvent:y,inverse:w});this._innerView.add(S),this._slider=S,S.translateTo(0-S.AABBBounds.x1,(this._title?this._title.AABBBounds.height()+vt(this.attribute,"title.space",al):0)-S.AABBBounds.y1),this._updateColor()}_bindEvents(){this.attribute.disableTriggerEvent||this._slider&&(this._slider.addEventListener("change",this._onSliderChange),this._slider.addEventListener("sliderTooltip",this._onSliderToolipChange))}_getTrackColor(){const{colors:e,layout:t,inverse:i}=this.attribute;if(ye(e))return;const r=e.length;if(r===1)return e[0];const o=[];for(let a=0;a<r;a++){const d=a/(r-1);o.push({offset:d,color:e[a]})}const s=t==="horizontal",l={gradient:"linear",stops:o,x0:0,y0:0,x1:s?1:0,y1:s?0:1};return i&&(s?(l.x0=1,l.x1=0):(l.y0=1,l.y1=0)),l}_updateColor(){var e;const{layout:t="horizontal",colors:i,railWidth:r,railHeight:o}=this.attribute,{startHandler:s,endHandler:l,track:a,attribute:d}=this._slider,{startValue:u,endValue:h,startPos:c,endPos:g}=this._slider.currentValue,f=(e=d.handlerStyle)===null||e===void 0?void 0:e.fill;if(s&&!f){const m=this._colorScale.scale(u);s.setAttribute("fill",m)}if(l&&!f){const m=this._colorScale.scale(h);l.setAttribute("fill",m)}const p=t==="horizontal"?r:o;if(Math.abs(c-g)!==p&&i&&i.length>1){const m=this._color.stops,b=Math.min(c,g),C=Math.max(c,g),_=b/p,w=C/p,y=w-_,v=m.filter(M=>M.offset>_&&M.offset<w),x=Math.min(u,h),S=Math.max(u,h),R=this._colorScale.scale(x),B=this._colorScale.scale(S),A=[{offset:0,color:R}];v.forEach(M=>{A.push({offset:(M.offset-_)/y,color:M.color})}),A.push({offset:1,color:B}),a.setAttribute("fill",Object.assign(Object.assign({},this._color),{stops:A}))}}}pu.defaultAttributes={layout:"horizontal",title:{align:"start",space:al,textStyle:{fontSize:12,fontWeight:"bold",fill:"rgba(46, 47, 50, 1)"}},handlerSize:10,handlerStyle:{fill:null,lineWidth:4,stroke:"#fff",outerBorder:{distance:2,lineWidth:1,stroke:"#ccc"}},tooltip:{shapeStyle:{lineWidth:4,stroke:"#fff"}}};function OP(n="bottom"){let e=0;return n==="top"?`
    M${e},-6L${e-3.5},-2.5
    v5
    h7
    v-5
    Z
`:n==="left"?(e=1,`
    M${e-6},0L${e-6+2.5},-3.5
    h5
    v7
    h-5
    Z
`):n==="right"?(e=-1,`
    M${e+6},0L${e+6-2.5},-3.5
    h-5
    v7
    h5
    Z
  `):`
    M${e},6L${e-3.5},2.5
    v-5
    h7
    v5
    Z
`}zP();class mu extends $f{constructor(e,t){super(t!=null&&t.skipDefault?e:re({},mu.defaultAttributes,e)),this.name="sizeLegend",this._onSliderChange=i=>{this.dispatchEvent(i)},this._onSliderToolipChange=i=>{this.dispatchEvent(i)}}setSelected(e){this._slider&&this._slider.setValue(e)}_renderContent(){const{slidable:e,layout:t,align:i,min:r,max:o,value:s,railWidth:l,railHeight:a,showHandler:d=!0,handlerSize:u,handlerStyle:h,railStyle:c,trackStyle:g,startText:f,endText:p,handlerText:m,showTooltip:b,tooltip:C,sizeBackground:_,disableTriggerEvent:w,inverse:y}=this.attribute,v=ge.group({x:0,y:0});this._innerView.add(v);const x=new dl({x:0,y:0,zIndex:1,range:{draggableTrack:!0},slidable:e,layout:t,align:i,min:r,max:o,value:s,railWidth:l,railHeight:a,showHandler:d,handlerSize:u,handlerStyle:Object.assign({symbolType:OP(i)},h),railStyle:c,trackStyle:g,startText:f,endText:p,handlerText:m,showTooltip:b,tooltip:C,disableTriggerEvent:w,inverse:y});v.add(x);let S,R=0;t==="horizontal"?i==="top"?(S=`M0,0L${l},0L${y?0:l},12Z`,R=a):(S=`M0,12L${l},12L${y?0:l},0Z`,x.setAttribute("y",12)):i==="left"?S=`M${l},0L${l+12},${y?0:a}L${l},${a}Z`:(S=`M0,${y?0:a}L12,${a}L12,0Z`,x.setAttribute("x",12));const B=ge.path(Object.assign(Object.assign({x:0,y:R,path:S},_),{zIndex:0}));v.add(B);const A=this._title?this._title.AABBBounds.height()+vt(this.attribute,"title.space",al):0;v.translate(0-v.AABBBounds.x1,A-v.AABBBounds.y1),this._slider=x}_bindEvents(){this.attribute.disableTriggerEvent||this._slider&&(this._slider.addEventListener("change",this._onSliderChange),this._slider.addEventListener("sliderTooltip",this._onSliderToolipChange))}}mu.defaultAttributes={layout:"horizontal",title:{align:"start",space:al,textStyle:{fontSize:12,fontWeight:"bold",fill:"rgba(46, 47, 50, 1)"}},handlerSize:10,handlerStyle:{lineWidth:1,stroke:"#ccc",fill:"#fff"},sizeBackground:{fill:"rgba(20,20,20,0.1)"}};function DP(){nn(),ri(),uu()}DP();let yw=class vw extends gn{constructor(e,t){super(t!=null&&t.skipDefault?e:re({},vw.defaultAttributes,e)),this.name="title"}render(){var e,t,i,r,o,s,l,a,d,u,h,c,g,f,p,m,b,C,_;const{textType:w,text:y,subtextType:v,textStyle:x={},subtext:S,subtextStyle:R={},width:B,height:A,minWidth:M,maxWidth:H,minHeight:E,maxHeight:T,align:P,verticalAlign:k,padding:L=0}=this.attribute,F=ei(L),z=this.createOrUpdateChild("title-container",{x:F[3],y:F[0],zIndex:1},"group"),I=(e=x.height)!==null&&e!==void 0?e:A;if(this.attribute.visible!==!1&&x.visible!==!1){const{width:$,maxHeight:Q,maxWidth:te,x:le=0,y:fe=0,ellipsis:ne=!0,wordBreak:ie="break-word",maxWidth:ce,lineClamp:ae}=x;if(w==="rich"||O(x.character)){const q=Object.assign({x:le,y:fe,width:(t=$??B)!==null&&t!==void 0?t:0,height:I??0,ellipsis:ne==null||ne,wordBreak:ie??"break-word",maxHeight:Q??T,maxWidth:te??ce,textConfig:(i=x.character)!==null&&i!==void 0?i:y},x);this._mainTitle=z.createOrUpdateChild("mainTitle",q,"richtext")}else if(w==="html"){const q=Object.assign({html:Object.assign(Object.assign({dom:y},eb),x),x:le,y:fe,width:(r=$??B)!==null&&r!==void 0?r:0,height:I??0,ellipsis:ne,wordBreak:ie,maxHeight:Q??T,maxWidth:te??ce,textConfig:[]},x);this._mainTitle=z.createOrUpdateChild("mainTitle",q,"richtext")}else O(y)&&(this._mainTitle=z.createOrUpdateChild("mainTitle",Object.assign(Object.assign({text:ee(y)?y:[y],whiteSpace:"normal"},x),{maxLineWidth:(s=(o=x.maxLineWidth)!==null&&o!==void 0?o:$)!==null&&s!==void 0?s:B,heightLimit:(l=x.height)!==null&&l!==void 0?l:T,lineClamp:ae,ellipsis:ne,x:le,y:fe}),"text"))}const N=this._mainTitle?this._mainTitle.AABBBounds.height():0,W=this._mainTitle?this._mainTitle.AABBBounds.width():0;if(this.attribute.visible!==!1&&R.visible!==!1){const{width:$,height:Q,maxWidth:te,maxHeight:le,x:fe=0,y:ne=0,ellipsis:ie=!0,wordBreak:ce="break-word",lineClamp:ae}=R,q=Math.max(Number.MIN_VALUE,T-N);if(v==="rich"||O(R.character)){const _e=Object.assign({x:fe,y:ne,width:(a=$??B)!==null&&a!==void 0?a:0,height:(d=Q??A)!==null&&d!==void 0?d:0,ellipsis:ie,wordBreak:ce,maxHeight:le??q,maxWidth:te??H,textConfig:(u=R.character)!==null&&u!==void 0?u:S},R);this._subTitle=z.createOrUpdateChild("subTitle",_e,"richtext")}else if(v==="html"){const _e=Object.assign({html:Object.assign(Object.assign({dom:S},eb),R),x:fe,y:ne,width:(h=$??B)!==null&&h!==void 0?h:0,height:(c=Q??A)!==null&&c!==void 0?c:0,ellipsis:ie,wordBreak:ce,maxHeight:le??q,maxWidth:te??H,textConfig:[]},R);this._subTitle=z.createOrUpdateChild("subTitle",_e,"richtext")}else O(S)&&(this._subTitle=z.createOrUpdateChild("subTitle",Object.assign(Object.assign({text:ee(S)?S:[S],whiteSpace:"normal"},R),{maxLineWidth:(g=R.maxLineWidth)!==null&&g!==void 0?g:B,heightLimit:(f=R.heightLimit)!==null&&f!==void 0?f:q,lineClamp:ae,ellipsis:ie,x:0,y:N}),"text"))}const D=this._subTitle?this._subTitle.AABBBounds.height():0,G=this._subTitle?this._subTitle.AABBBounds.width():0;let V=Math.max(W,G),X=N+((p=R.height)!==null&&p!==void 0?p:D);if(O(B)&&(V=B),O(A)&&(X=A),O(M)&&V<M&&(V=M),O(H)&&V>H&&(V=H),O(E)&&X<E&&(X=E),O(T)&&X>T&&(X=T),z.attribute.width=V,z.attribute.height=X,z.attribute.boundsPadding=F,this._mainTitle){if(O(P)||O(x.align)){const $=x.align?x.align:P,Q=(m=x.width)!==null&&m!==void 0?m:V;$==="center"?(this._mainTitle.setAttribute("x",Q/2),this._mainTitle.setAttribute("textAlign","center")):$==="right"?(this._mainTitle.setAttribute("x",Q),this._mainTitle.setAttribute("textAlign","right")):(this._mainTitle.setAttribute("x",0),this._mainTitle.setAttribute("textAlign","left"))}if(O(k)||O(x.verticalAlign)){const $=x.verticalAlign?x.verticalAlign:k;$==="middle"&&O(I)?(this._mainTitle.setAttribute("y",I/2),this._mainTitle.setAttribute("textBaseline","middle")):$==="bottom"&&O(I)?(this._mainTitle.setAttribute("y",I),this._mainTitle.setAttribute("textBaseline","bottom")):(this._mainTitle.setAttribute("y",0),this._mainTitle.setAttribute("textBaseline","top"))}}if(this._subTitle){if(O(P)||O(R.align)){const $=R.align?R.align:P,Q=(C=(b=R.width)!==null&&b!==void 0?b:x.width)!==null&&C!==void 0?C:V;$==="center"?(this._subTitle.setAttribute("x",Q/2),this._subTitle.setAttribute("textAlign","center")):$==="right"?(this._subTitle.setAttribute("x",Q),this._subTitle.setAttribute("textAlign","right")):(this._subTitle.setAttribute("x",0),this._subTitle.setAttribute("textAlign","left"))}if(O(k)||O(x.verticalAlign)){const $=R.verticalAlign?R.verticalAlign:k,Q=this._mainTitle?O(I)?this._mainTitle.AABBBounds.y1+Math.max(this._mainTitle.AABBBounds.height(),I):this._mainTitle.AABBBounds.y2:0,te=(_=R.height)!==null&&_!==void 0?_:A;$==="middle"&&O(te)?(this._subTitle.setAttribute("y",Q+te/2),this._subTitle.setAttribute("textBaseline","middle")):$==="bottom"&&O(te)?(this._subTitle.setAttribute("y",Q+te),this._subTitle.setAttribute("textBaseline","bottom")):(this._subTitle.setAttribute("y",Q),this._subTitle.setAttribute("textBaseline","top"))}}}};yw.defaultAttributes={textStyle:{ellipsis:"...",fill:"#333",fontSize:20,fontWeight:"bold",textAlign:"left",textBaseline:"top"},subtextStyle:{ellipsis:"...",fill:"#6F6F6F",fontSize:16,fontWeight:"normal",textAlign:"left",textBaseline:"top"}};function WP(){nn(),Ti(),ri(),du()}const NP='<svg width="200" height="200" viewBox="0 0 1024 1024" fill="#fff" xmlns="http://www.w3.org/2000/svg"><path d="M877.44815445 206.10060629a64.72691371 64.72691371 0 0 0-95.14856334 4.01306852L380.73381888 685.46812814 235.22771741 533.48933518a64.72691371 64.72691371 0 0 0-92.43003222-1.03563036l-45.82665557 45.82665443a64.72691371 64.72691371 0 0 0-0.90617629 90.61767965l239.61903446 250.10479331a64.72691371 64.72691371 0 0 0 71.19960405 15.14609778 64.33855261 64.33855261 0 0 0 35.08198741-21.23042702l36.24707186-42.71976334 40.5190474-40.77795556-3.36579926-3.49525333 411.40426297-486.74638962a64.72691371 64.72691371 0 0 0-3.88361443-87.64024149l-45.3088404-45.43829334z"></path></svg>',VP='<svg width="200" height="200" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" fill="none"><path stroke="#fff" stroke-linecap="round" stroke-linejoin="round" stroke-width="5" d="M5 12h14"/></svg>';WP();class Po extends gn{constructor(e,t){super(t!=null&&t.skipDefault?e:re({},Po.defaultAttributes,e)),this._handlePointerUp=()=>{this.attribute.disabled||(this.attribute.checked?(this.setAttribute("checked",!1),this.setAttribute("indeterminate",!1)):(this.setAttribute("checked",!0),this.setAttribute("indeterminate",!1)),this._dispatchEvent("checkbox_state_change",{eventType:"checkbox_state_change",checked:this.attribute.checked}),this.stage.renderNextFrame())},this.renderGroup(),this.onBeforeAttributeUpdate=(i,r,o)=>{"interactive"in i&&this.setAttribute("pickable",i.interactive),"disabled"in i&&this.setAttribute("cursor",i.disable?this.attribute.disableCursor:this.attribute.cursor)},this.addEventListener("pointerup",this._handlePointerUp)}render(){this.removeAllChild(!0),this.renderBox(),this.renderIcon(),this.renderText(),this.layout()}renderBox(){this._box=new lu(re({},this.attribute.box));const e=this.attribute.checked||this.attribute.indeterminate;e&&this.attribute.disabled?this._box.setAttributes({fill:this.attribute.box.disableCheckedFill,stroke:this.attribute.box.disableCheckedStroke}):e?this._box.setAttributes({fill:this.attribute.box.checkedFill,stroke:this.attribute.box.checkedStroke}):this.attribute.disabled&&this._box.setAttributes({fill:this.attribute.box.disableFill}),this.appendChild(this._box)}renderIcon(){this._checkIcon=new Hr(re({image:this.attribute.icon.checkIconImage},this.attribute.icon)),this.appendChild(this._checkIcon),this._indeterminateIcon=new Hr(re({image:this.attribute.icon.indeterminateIconImage},this.attribute.icon)),this.appendChild(this._indeterminateIcon),this.attribute.checked?(this._checkIcon.setAttribute("visible",!0),this._indeterminateIcon.setAttribute("visible",!1)):this.attribute.indeterminate?(this._checkIcon.setAttribute("visible",!1),this._indeterminateIcon.setAttribute("visible",!0)):(this._checkIcon.setAttribute("visible",!1),this._indeterminateIcon.setAttribute("visible",!1))}renderText(){this._text=new Rt(re({wrap:!0},this.attribute.text)),this.attribute.disabled&&this._text.setAttribute("fill",this.attribute.text.disableFill),this.appendChild(this._text)}renderGroup(){this.attribute.interactive||this.setAttribute("pickable",!1),this.attribute.disabled&&this.setAttribute("cursor",this.attribute.disableCursor)}layout(){const e=this.attribute.box.height,t=this.attribute.icon.height,i=this._text.AABBBounds.height(),r=Math.max(e,t,i),o=r/2-e/2,s=r/2-t/2,l=r/2-i/2,a=this.attribute.box.width,d=this.attribute.icon.width,u=Math.max(a,d),h=u/2-a/2,c=u/2-d/2,g=u+this.attribute.spaceBetweenTextAndIcon;this._box.setAttributes({x:h,y:o}),this._checkIcon.setAttributes({x:c,y:s}),this._indeterminateIcon.setAttributes({x:c,y:s}),this._text.setAttributes({x:g,y:l})}initAttributes(e,t){e=t!=null&&t.skipDefault?e:re({},Po.defaultAttributes,e),super.initAttributes(e),this.renderGroup(),this.render()}}Po.defaultAttributes={interactive:!0,disabled:!1,checked:!1,indeterminate:!1,cursor:"pointer",disableCursor:"not-allowed",spaceBetweenTextAndIcon:8,text:{text:"text",fontSize:14,fill:"#000",disableFill:"rgb(201,205,212)",textBaseline:"top",pickable:!1},icon:{checkIconImage:NP,indeterminateIconImage:VP,width:10,height:10,pickable:!1},box:{width:14,height:14,cornerRadius:2,fill:"#fff",stroke:"rgb(229,230,235)",disableFill:"rgb(242,243,245)",checkedFill:"rgb(22, 93, 255)",checkedStroke:"rgb(22, 93, 255)",disableCheckedFill:"rgb(148, 191, 255)",disableCheckedStroke:"rgb(148, 191, 255)",pickable:!1}};function GP(){nn(),Ti(),FT(),du()}GP();class Ho extends gn{constructor(e,t){super(t!=null&&t.skipDefault?e:re({},Ho.defaultAttributes,e)),this._handlePointerUp=()=>{this.attribute.disabled||this.attribute.checked||(this.setAttribute("checked",!0),this._dispatchEvent("radio_checked",{eventType:"radio_checked",target:this}),this.stage.renderNextFrame())},this.renderGroup(),this.onBeforeAttributeUpdate=(i,r,o)=>{"interactive"in i&&this.setAttribute("pickable",i.interactive),"disabled"in i&&this.setAttribute("cursor",i.disable?this.attribute.disableCursor:this.attribute.cursor)},this.addEventListener("pointerup",this._handlePointerUp)}render(){this.removeAllChild(!0),this.renderCircle(),this.renderText(),this.layout()}renderCircle(){this._circle=new Bo(re({},this.attribute.circle));const e=this.attribute.checked;e&&this.attribute.disabled?this._circle.setAttributes({fill:this.attribute.circle.disableCheckedFill,stroke:this.attribute.circle.disableCheckedStroke}):e?this._circle.setAttributes({fill:this.attribute.circle.checkedFill,stroke:this.attribute.circle.checkedStroke}):this.attribute.disabled&&this._circle.setAttributes({fill:this.attribute.circle.disableFill}),this.appendChild(this._circle)}renderText(){this._text=new Rt(re({},this.attribute.text)),this.attribute.disabled&&this._text.setAttribute("fill",this.attribute.text.disableFill),this.appendChild(this._text)}renderGroup(){this.attribute.interactive||this.setAttribute("pickable",!1),this.attribute.disabled&&this.setAttribute("cursor",this.attribute.disableCursor)}layout(){const e=2*(this.attribute.circle.outerRadius+this.attribute.circle.lineWidth),t=this._text.AABBBounds.height(),i=Math.max(e,t),r=i/2-e/2+this.attribute.circle.outerRadius+this.attribute.circle.lineWidth,o=i/2-t/2,s=2*(this.attribute.circle.outerRadius+this.attribute.circle.lineWidth),l=this.attribute.circle.outerRadius+this.attribute.circle.lineWidth,a=s+this.attribute.spaceBetweenTextAndIcon;this._circle.setAttributes({x:l,y:r}),this._text.setAttributes({x:a,y:o})}initAttributes(e,t){e=t!=null&&t.skipDefault?e:re({},Ho.defaultAttributes,e),super.initAttributes(e),this.renderGroup(),this.render()}}Ho.defaultAttributes={interactive:!0,disabled:!1,checked:!1,cursor:"pointer",disableCursor:"not-allowed",spaceBetweenTextAndIcon:8,text:{text:"text",fontSize:14,fill:"#000",disableFill:"rgb(201,205,212)",textBaseline:"top",pickable:!1},circle:{outerRadius:7,innerRadius:3,startAngle:0,endAngle:2*Math.PI,lineWidth:1,fill:"#fff",stroke:"rgb(229,230,235)",disableFill:"rgb(242,243,245)",checkedFill:"rgb(22, 93, 255)",checkedStroke:"rgb(22, 93, 255)",disableCheckedFill:"rgb(148, 191, 255)",disableCheckedStroke:"rgb(148, 191, 255)",pickable:!1}};function jP(){nn(),ri(),du()}const UP='<svg t="1716726614852" class="icon" viewBox="0 0 1194 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="2621" width="200" height="200"><path d="M1038.694079 367.237067c13.265507 23.342857-16.633865-40.004445-63.05621-40.004446H219.018794c-26.558738 0-46.46393 13.334815-63.05621 40.004446S0.006238 607.277601 0.006238 650.608819V940.647979a82.351494 82.351494 0 0 0 82.961402 83.349526H1111.702885a82.337632 82.337632 0 0 0 82.975264-83.349526V650.608819c0-43.331218-155.970208-283.371753-155.970208-283.371752zM730.066575 667.284269a136.328386 136.328386 0 0 1-132.738243 133.33429 133.417459 133.417459 0 0 1-132.738243-133.33429v-6.681269a40.6698 40.6698 0 0 0-36.497473-26.66963H73.015044l119.458874-220.02445s23.231965-40.004445 53.103614-40.004446h713.481918c26.544876 0 29.871649 10.008042 46.436207 40.004446L1128.33675 633.947231H769.904682c-26.184476 0-39.838107 7.623855-39.838107 33.337038zM338.505391 210.559919l-89.601086-86.69016a22.178487 22.178487 0 0 1 0-33.26773 21.984425 21.984425 0 0 1 33.170699 0l89.601087 86.676299a22.317102 22.317102 0 0 1 0 33.26773 24.950798 24.950798 0 0 1-33.1707 0z m252.197118-40.059891a25.532983 25.532983 0 0 1-6.639685-16.633865l-3.326773-126.694606A28.263709 28.263709 0 0 1 603.995739 0.515788c13.251646-3.326773 23.204242 10.021904 26.544877 23.342858V153.866163a28.249847 28.249847 0 0 1-23.259688 26.66963c-6.611961-3.312911-13.279369-3.312911-16.578419-10.035765z m235.646421 33.337038a22.372548 22.372548 0 0 1 0-33.337038l86.288175-90.030795a22.039871 22.039871 0 0 1 33.170699 0 22.289379 22.289379 0 0 1 0 33.364761l-82.961401 90.003072a25.962691 25.962691 0 0 1-36.483611 0z" fill="#8a8a8a" p-id="2622"></path></svg>';jP();let Sw=class xw extends gn{constructor(e,t){super(t!=null&&t.skipDefault?e:re({},xw.defaultAttributes,e))}render(){this.removeAllChild(!0),this.renderIcon(),this.renderText(),this.layout()}renderIcon(){this._emptyTipIcon=new Hr(re({image:this.attribute.icon.image},this.attribute.icon)),this.appendChild(this._emptyTipIcon)}renderText(){this._text=new Rt(re({wrap:!0},this.attribute.text)),this.appendChild(this._text)}layout(){const e=this.attribute.icon.height,t=this._text.AABBBounds.height(),i=this.attribute.icon.width,{width:r,height:o,spaceBetweenTextAndIcon:s}=this.attribute;this._emptyTipIcon.setAttribute("x",r/2-i/2),this._emptyTipIcon.setAttribute("y",o/2-e/2-t/2-s/2),this._text.setAttribute("x",r/2),this._text.setAttribute("textAlign","center"),this._text.setAttribute("y",o/2+e/2+s/2),this._text.setAttribute("textBaseline","middle")}};Sw.defaultAttributes={spaceBetweenTextAndIcon:20,text:{text:"no data",fontSize:14,fill:"#000",disableFill:"rgb(201,205,212)",pickable:!1},icon:{image:UP,width:100,height:100,pickable:!1}};function $P(){nn(),Ti(),ri(),Q0()}$P();class Us extends gn{constructor(e,t){super(t!=null&&t.skipDefault?e:re({},Us.defaultAttributes,e)),this._handlePointerUp=()=>{this.attribute.disabled||(this.attribute.checked?this.setAttribute("checked",!1):this.setAttribute("checked",!0),this._dispatchEvent("switch_state_change",{eventType:"switch_state_change",checked:this.attribute.checked}),this.stage.renderNextFrame())},this.renderGroup(),this.onBeforeAttributeUpdate=(i,r,o)=>{"interactive"in i&&this.setAttribute("pickable",i.interactive),"disabled"in i&&this.setAttribute("cursor",i.disable?this.attribute.disableCursor:this.attribute.cursor)},this.addEventListener("pointerup",this._handlePointerUp)}render(){this.removeAllChild(!0),this.renderBox(),this.renderCircle(),this.renderText(),this.layout()}renderBox(){this._box=new lu(re({},this.attribute.box)),this.attribute.disabled&&this.attribute.checked?this._box.setAttributes({fill:this.attribute.box.disableCheckedFill}):this.attribute.disabled&&!this.attribute.checked?this._box.setAttributes({fill:this.attribute.box.disableUncheckedFill}):this.attribute.checked?this._box.setAttributes({fill:this.attribute.box.checkedFill}):this._box.setAttributes({fill:this.attribute.box.uncheckedFill}),this.appendChild(this._box)}renderCircle(){this._circle=new Ao(re({},this.attribute.circle)),this.appendChild(this._circle)}renderText(){var e,t,i;this._text=new Rt(re({},(e=this.attribute.text)!==null&&e!==void 0?e:{})),this.attribute.checked&&(!((t=this.attribute.text)===null||t===void 0)&&t.checkedText)?this._text.setAttributes({text:this.attribute.text.checkedText}):!((i=this.attribute.text)===null||i===void 0)&&i.uncheckedText&&this._text.setAttributes({text:this.attribute.text.uncheckedText}),this.appendChild(this._text)}renderGroup(){this.attribute.interactive||this.setAttribute("pickable",!1),this.attribute.disabled&&this.setAttribute("cursor",this.attribute.disableCursor)}layout(){var e,t,i,r,o,s,l,a,d,u;const h=this.attribute.spaceBetweenTextAndCircle,c=this.attribute.circle.radius,g=this.attribute.box.height,f=2*c,p=this._text.AABBBounds.height(),m=Math.max(g,f,p),b=m/2-f/2+c,C=m/2-p/2,_=this.attribute.box.width,w=2*c,y=hu(((i=(t=(e=this.attribute.text)===null||e===void 0?void 0:e.checkedText)===null||t===void 0?void 0:t.length)!==null&&i!==void 0?i:0)>((s=(o=(r=this.attribute.text)===null||r===void 0?void 0:r.uncheckedText)===null||o===void 0?void 0:o.length)!==null&&s!==void 0?s:0)?(a=(l=this.attribute.text)===null||l===void 0?void 0:l.checkedText)!==null&&a!==void 0?a:"":(u=(d=this.attribute.text)===null||d===void 0?void 0:d.uncheckedText)!==null&&u!==void 0?u:"",this._text.attribute).width,v=Math.max(_,w+y+3*h),x=g/2-w/2+c,S=x+c+h;this._box.setAttributes({width:v,height:m}),this._circle.setAttributes({y:b,x:this.attribute.checked?x:v-x}),this._text.setAttributes({x:this.attribute.checked?S:v-S-y,y:C})}initAttributes(e,t){e=t!=null&&t.skipDefault?e:re({},Us.defaultAttributes,e),super.initAttributes(e),this.renderGroup(),this.render()}}Us.defaultAttributes={interactive:!0,disabled:!1,checked:!1,cursor:"pointer",disableCursor:"not-allowed",circle:{radius:8,fill:"#FFF",pickable:!1},box:{width:40,height:24,cornerRadius:12,uncheckedFill:"rgb(201,205,212)",checkedFill:"#165DFF",disableUncheckedFill:"rgb(242,243,245)",disableCheckedFill:"rgb(148,191,255)",pickable:!1},text:{textAlign:"left",textBaseline:"top",pickable:!1},spaceBetweenTextAndCircle:6};let Cb=!1;function Rw(){Cb||(Cb=!0,Ns(),Vf()?ja(Ce):nB()&&Ka(Ce),HT(),Q0(),nn(),du(),jf(),Ti(),uu(),LT(),Oo(),ri(),hm(),qT(),hm())}var me;(function(n){n.default="default",n.grabing="grabing",n.scrolling="scrolling"})(me||(me={}));var He;(function(n){n.single="single",n.column="column",n.row="row",n.cross="cross",n.none="none"})(He||(He={}));const KP=["bgColor","color","strokeColor","borderColor","linkColor"];var Je;(function(n){n.RECORD="RECORD",n.NONE="NONE",n.SUM="SUM",n.MIN="MIN",n.MAX="MAX",n.AVG="AVG",n.COUNT="COUNT",n.CUSTOM="CUSTOM",n.RECALCULATE="RECALCULATE"})(Je||(Je={}));var Jt;(function(n){n.ASC="ASC",n.DESC="DESC",n.NORMAL="NORMAL",n.desc="desc",n.asc="asc",n.normal="normal"})(Jt||(Jt={}));var sn;(function(n){n.top="top",n.bottom="bottom",n.left="left",n.right="right"})(sn||(sn={}));var be;(function(n){n.expand="expand",n.collapse="collapse",n.none="none",n.loading="loading"})(be||(be={}));var Ie;(function(n){n.inlineFront="inlineFront",n.inlineEnd="inlineEnd",n.left="left",n.right="right",n.absoluteRight="absoluteRight",n.contentLeft="contentLeft",n.contentRight="contentRight",n.absolute="absolute"})(Ie||(Ie={}));var Oe;(function(n){n.frozen="frozen",n.sort="sort",n.dropDown="dropDown",n.dropDownState="dropDownState",n.play="play",n.damagePic="damagePic",n.expand="expand",n.collapse="collapse",n.drillDown="drillDown",n.drillUp="drillUp",n.dragReorder="dragReorder"})(Oe||(Oe={}));var Vt;(function(n){n.upwardIconName="sort_upward",n.downwardIconName="sort_downward",n.normalIconName="sort_normal",n.freezeIconName="freeze",n.frozenIconName="frozen",n.frozenCurrentIconName="frozenCurrent",n.dropdownIconName="dropdownIcon",n.expandIconName="expand",n.collapseIconName="collapse",n.dragReorderIconName="dragReorder",n.loadingIconName="loading"})(Vt||(Vt={}));const pO={};class Pi{constructor(e){var t;this.isAggregator=!0,this.isRecord=!0,this.records=[],this.key=e.key,this.field=e.field,this.formatFun=e.formatFun,this.isRecord=(t=e.isRecord)!==null&&t!==void 0?t:this.isRecord}clearCacheValue(){this._formatedValue=void 0}formatValue(e,t,i){return this._formatedValue||(this.formatFun?this._formatedValue=this.formatFun(this.value(),e,t,i):this._formatedValue=this.value()),this._formatedValue}reset(){this.records=[],this.clearCacheValue()}}class YP extends Pi{constructor(){super(...arguments),this.type=Je.RECORD,this.isRecord=!0}push(e){e&&this.isRecord&&this.records&&(e.isAggregator?this.records.push(...e.records):this.records.push(e)),this.clearCacheValue()}deleteRecord(e){e&&this.isRecord&&this.records&&(this.records=this.records.filter(t=>t!==e)),this.clearCacheValue()}updateRecord(e,t){e&&t&&(this.isRecord&&this.records&&(this.records=this.records.map(i=>i===e?t:i)),this.clearCacheValue())}value(){return this.records}reset(){this.records=[]}recalculate(){}}class XP extends Pi{constructor(){super(...arguments),this.type=Je.NONE,this.isRecord=!0}push(e){e&&(this.isRecord&&(this.records=[e]),this.field&&(this.fieldValue=e[this.field])),this.clearCacheValue()}deleteRecord(e){e&&(this.isRecord&&this.records&&(this.records=this.records.filter(t=>t!==e)),this.field&&this.records.length&&(this.fieldValue=this.records[this.records.length-1][this.field])),this.clearCacheValue()}updateRecord(e,t){e&&t&&(this.isRecord&&this.records&&(this.records=this.records.map(i=>i===e?t:i)),this.field&&this.records.length&&(this.fieldValue=this.records[this.records.length-1][this.field]),this.clearCacheValue())}value(){return this.fieldValue}reset(){this.records=[],this.fieldValue=void 0}recalculate(){}}class qP extends Pi{constructor(e){super(e),this.type=Je.CUSTOM,this.isRecord=!0,this.values=[],this.aggregationFun=e.aggregationFun}push(e){e&&(this.isRecord&&this.records&&(e.isAggregator?this.records.push(...e.records):this.records.push(e)),this.field&&this.values.push(e[this.field])),this.clearCacheValue()}updateRecord(e,t){e&&t&&(this.isRecord&&this.records&&(this.records=this.records.map(i=>i===e?t:i)),this.field&&this.records.length&&(this.values=this.records.map(i=>i[this.field])),this.clearCacheValue())}deleteRecord(e){e&&(this.isRecord&&this.records&&(this.records=this.records.filter(t=>t!==e)),this.field&&this.records.length&&(this.values=this.records.map(t=>t[this.field]))),this.clearCacheValue()}value(){var e;return this.fieldValue||(this.fieldValue=(e=this.aggregationFun)===null||e===void 0?void 0:e.call(this,this.values,this.records,this.field)),this.fieldValue}reset(){this.records=[],this.fieldValue=void 0}recalculate(){this.fieldValue=void 0,this._formatedValue=void 0}}class mO extends Pi{constructor(e){super(e),this.type=Je.RECALCULATE,this.isRecord=!0,this.calculateFun=e.calculateFun,this.dependAggregators=e.dependAggregators,this.dependIndicatorKeys=e.dependIndicatorKeys}push(e){e&&this.isRecord&&this.records&&(e.isAggregator?this.records.push(...e.records):this.records.push(e)),this.clearCacheValue()}deleteRecord(e){e&&this.isRecord&&this.records&&(this.records=this.records.filter(t=>t!==e)),this.clearCacheValue()}updateRecord(e,t){e&&t&&(this.isRecord&&this.records&&(this.records=this.records.map(i=>i===e?t:i)),this.clearCacheValue())}value(){var e;if(!this.fieldValue){const t=i2(this.dependAggregators,this.dependIndicatorKeys);this.fieldValue=(e=this.calculateFun)===null||e===void 0?void 0:e.call(this,t,this.records,this.field)}return this.fieldValue}reset(){this.records=[],this.fieldValue=void 0}recalculate(){}}class ZP extends Pi{constructor(e){var t;super(e),this.type=Je.SUM,this.sum=0,this.positiveSum=0,this.nagetiveSum=0,this.needSplitPositiveAndNegativeForSum=!1,this.needSplitPositiveAndNegativeForSum=(t=e.needSplitPositiveAndNegative)!==null&&t!==void 0&&t}push(e){if(e){if(this.isRecord&&this.records&&(e.isAggregator?this.records.push(...e.records):this.records.push(e)),e.isAggregator){const t=e.value();this.sum+=t??0,this.needSplitPositiveAndNegativeForSum&&(t>0?this.positiveSum+=t:t<0&&(this.nagetiveSum+=t))}else if(this.field&&!isNaN(parseFloat(e[this.field]))){const t=parseFloat(e[this.field]);this.sum+=t,this.needSplitPositiveAndNegativeForSum&&(t>0?this.positiveSum+=t:t<0&&(this.nagetiveSum+=t))}}this.clearCacheValue()}deleteRecord(e){if(e){if(this.isRecord&&this.records&&(this.records=this.records.filter(t=>t!==e)),e.isAggregator){const t=e.value();this.sum-=t??0,this.needSplitPositiveAndNegativeForSum&&(t>0?this.positiveSum-=t:t<0&&(this.nagetiveSum-=t))}else if(this.field&&!isNaN(parseFloat(e[this.field]))){const t=parseFloat(e[this.field]);this.sum-=t,this.needSplitPositiveAndNegativeForSum&&(t>0?this.positiveSum-=t:t<0&&(this.nagetiveSum-=t))}}this.clearCacheValue()}updateRecord(e,t){if(e&&t){if(this.isRecord&&this.records&&(this.records=this.records.map(i=>i===e?t:i)),e.isAggregator){const i=e.value(),r=t.value();this.sum+=r-i,this.needSplitPositiveAndNegativeForSum&&(i>0?this.positiveSum-=i:i<0&&(this.nagetiveSum-=i),r>0?this.positiveSum+=r:r<0&&(this.nagetiveSum+=r))}else if(this.field&&!isNaN(parseFloat(e[this.field]))){const i=parseFloat(e[this.field]),r=parseFloat(t[this.field]);this.sum+=r-i,this.needSplitPositiveAndNegativeForSum&&(i>0?this.positiveSum-=i:i<0&&(this.nagetiveSum-=i),r>0?this.positiveSum+=r:r<0&&(this.nagetiveSum+=r))}this.clearCacheValue()}}value(){var e;return((e=this.records)===null||e===void 0?void 0:e.length)>=1?this.sum:void 0}positiveValue(){return this.positiveSum}negativeValue(){return this.nagetiveSum}reset(){super.reset(),this.records=[],this.sum=0}recalculate(){if(this.sum=0,this._formatedValue=void 0,this.records)for(let e=0;e<this.records.length;e++){const t=this.records[e];if(t.isAggregator){const i=t.value();this.sum+=i??0,this.needSplitPositiveAndNegativeForSum&&(i>0?this.positiveSum+=i:i<0&&(this.nagetiveSum+=i))}else if(this.field&&!isNaN(parseFloat(t[this.field]))){const i=parseFloat(t[this.field]);this.sum+=i,this.needSplitPositiveAndNegativeForSum&&(i>0?this.positiveSum+=i:i<0&&(this.nagetiveSum+=i))}}}}class JP extends Pi{constructor(){super(...arguments),this.type=Je.COUNT,this.count=0}push(e){e&&(this.isRecord&&this.records&&(e.isAggregator?this.records.push(...e.records):this.records.push(e)),e.isAggregator?this.count+=e.value():this.count++),this.clearCacheValue()}deleteRecord(e){e&&(this.isRecord&&this.records&&(this.records=this.records.filter(t=>t!==e)),e.isAggregator?this.count-=e.value():this.count--),this.clearCacheValue()}updateRecord(e,t){e&&t&&(this.isRecord&&this.records&&(this.records=this.records.map(i=>i===e?t:i)),e.isAggregator&&(this.count+=t.value()-e.value()))}value(){return this.count}reset(){this.records=[],this.count=0}recalculate(){if(this.count=0,this._formatedValue=void 0,this.records)for(let e=0;e<this.records.length;e++){const t=this.records[e];t.isAggregator?this.count+=t.value():this.count++}}}class QP extends Pi{constructor(){super(...arguments),this.type=Je.AVG,this.sum=0,this.count=0}push(e){e&&(this.isRecord&&this.records&&(e.isAggregator?this.records.push(...e.records):this.records.push(e)),e.isAggregator&&e.type===Je.AVG?(this.sum+=e.sum,this.count+=e.count):this.field&&!isNaN(parseFloat(e[this.field]))&&(this.sum+=parseFloat(e[this.field]),this.count++)),this.clearCacheValue()}deleteRecord(e){e&&(this.isRecord&&this.records&&(this.records=this.records.filter(t=>t!==e)),e.isAggregator&&e.type===Je.AVG?(this.sum-=e.sum,this.count-=e.count):this.field&&!isNaN(parseFloat(e[this.field]))&&(this.sum-=parseFloat(e[this.field]),this.count--)),this.clearCacheValue()}updateRecord(e,t){e&&t&&(this.isRecord&&this.records&&(this.records=this.records.map(i=>i===e?t:i)),e.isAggregator&&e.type===Je.AVG?(this.sum+=t.sum-e.sum,this.count+=t.count-e.count):this.field&&!isNaN(parseFloat(e[this.field]))&&(this.sum+=parseFloat(t[this.field])-parseFloat(e[this.field])),this.clearCacheValue())}value(){var e;return((e=this.records)===null||e===void 0?void 0:e.length)>=1?this.sum/this.count:void 0}reset(){this.records=[],this.sum=0,this.count=0}recalculate(){if(this.sum=0,this.count=0,this._formatedValue=void 0,this.records)for(let e=0;e<this.records.length;e++){const t=this.records[e];t.isAggregator&&t.type===Je.AVG?(this.sum+=t.sum,this.count+=t.count):this.field&&!isNaN(parseFloat(t[this.field]))&&(this.sum+=parseFloat(t[this.field]),this.count++)}}}class e2 extends Pi{constructor(){super(...arguments),this.type=Je.MAX,this.max=Number.MIN_SAFE_INTEGER}push(e){e&&(this.isRecord&&this.records&&(e.isAggregator?this.records.push(...e.records):this.records.push(e)),e.isAggregator?this.max=e.max>this.max?e.max:this.max:typeof e=="number"?this.max=e>this.max?e:this.max:this.field&&typeof e[this.field]=="number"?this.max=e[this.field]>this.max?e[this.field]:this.max:this.field&&!isNaN(e[this.field])&&(this.max=parseFloat(e[this.field])>this.max?parseFloat(e[this.field]):this.max)),this.clearCacheValue()}deleteRecord(e){e&&(this.isRecord&&this.records&&(this.records=this.records.filter(t=>t!==e)),this.recalculate())}updateRecord(e,t){e&&t&&(this.isRecord&&this.records&&(this.records=this.records.map(i=>i===e?t:i)),this.recalculate())}value(){var e;return((e=this.records)===null||e===void 0?void 0:e.length)>=1?this.max:void 0}reset(){this.records=[],this.max=Number.MIN_SAFE_INTEGER}recalculate(){if(this.max=Number.MIN_SAFE_INTEGER,this._formatedValue=void 0,this.records)for(let e=0;e<this.records.length;e++){const t=this.records[e];t.isAggregator?this.max=t.max>this.max?t.max:this.max:typeof t=="number"?this.max=t>this.max?t:this.max:this.field&&typeof t[this.field]=="number"?this.max=t[this.field]>this.max?t[this.field]:this.max:this.field&&!isNaN(t[this.field])&&(this.max=parseFloat(t[this.field])>this.max?parseFloat(t[this.field]):this.max)}}}class t2 extends Pi{constructor(){super(...arguments),this.type=Je.MIN,this.min=Number.MAX_SAFE_INTEGER}push(e){e&&(this.isRecord&&this.records&&(e.isAggregator?this.records.push(...e.records):this.records.push(e)),e.isAggregator?this.min=e.min<this.min?e.min:this.min:typeof e=="number"?this.min=e<this.min?e:this.min:this.field&&typeof e[this.field]=="number"?this.min=e[this.field]<this.min?e[this.field]:this.min:this.field&&!isNaN(e[this.field])&&(this.min=parseFloat(e[this.field])<this.min?parseFloat(e[this.field]):this.min)),this.clearCacheValue()}deleteRecord(e){e&&(this.isRecord&&this.records&&(this.records=this.records.filter(t=>t!==e)),this.recalculate())}updateRecord(e,t){e&&t&&(this.isRecord&&this.records&&(this.records=this.records.map(i=>i===e?t:i)),this.recalculate())}value(){var e;return((e=this.records)===null||e===void 0?void 0:e.length)>=1?this.min:void 0}reset(){this.records=[],this.min=Number.MAX_SAFE_INTEGER}recalculate(){if(this.min=Number.MAX_SAFE_INTEGER,this._formatedValue=void 0,this.records)for(let e=0;e<this.records.length;e++){const t=this.records[e];t.isAggregator?this.min=t.min<this.min?t.min:this.min:typeof t=="number"?this.min=t<this.min?t:this.min:this.field&&typeof t[this.field]=="number"?this.min=t[this.field]<this.min?t[this.field]:this.min:this.field&&!isNaN(t[this.field])&&(this.min=parseFloat(t[this.field])<this.min?parseFloat(t[this.field]):this.min)}}}function bO(n,e,t){if(t===Jt.NORMAL||t===Jt.normal)return 0;const i=t===Jt.DESC||t===Jt.desc?-1:1;return n&&e?n.toString().localeCompare(e.toString(),"zh")*i:n?1*i:-1*i}function n2(n,e,t){if(t===Jt.NORMAL||t===Jt.normal)return 0;const i=/(\d+)|(\D+)/g,r=/\d/,o=/^0/;let s,l,a,d,u=0,h=0;const c=t===Jt.DESC||t===Jt.desc?-1:1;if(e!==null&&n===null)return-1*c;if(n!==null&&e===null)return 1*c;if(typeof n=="number"&&isNaN(n))return-1*c;if(typeof e=="number"&&isNaN(e))return 1*c;if(u=+n,h=+e,u<h)return-1*c;if(u>h)return 1*c;if(typeof n=="number"&&typeof e!="number")return-1*c;if(typeof e=="number"&&typeof n!="number")return 1*c;if(typeof n=="number"&&typeof e=="number")return 0;if(isNaN(h)&&!isNaN(u))return-1*c;if(isNaN(u)&&!isNaN(h))return 1*c;if(s=String(n),a=String(e),s===a)return 0;if(!r.test(s)||!r.test(a))return(s>a?1:-1)*c;for(s=s.match(i),a=a.match(i);s.length&&a.length;)if(l=s.shift(),d=a.shift(),l!==d)return r.test(l)&&r.test(d)?(l.replace(o,".0")-d.replace(o,".0"))*c:(l>d?1:-1)*c;return(s.length-a.length)*c}function CO(n){let e;const t={},i={};for(let r=0;r<n.length;r++)e=n[r],t[e]=r,typeof e=="string"&&(i[e.toLowerCase()]=r);return function(r,o,s){if(s===Jt.NORMAL||s===Jt.normal)return 0;const l=s===Jt.DESC||s===Jt.desc?-1:1;let a;return t[r]!==null&&t[r]!==void 0&&t[o]!==null&&t[o]!==void 0?a=t[r]-t[o]:t[r]!==null&&t[r]!==void 0?a=-1:t[o]!==null&&t[o]!==void 0?a=1:i[r]!==null&&t[r]!==void 0&&i[o]!==null&&t[o]!==void 0?a=i[r]-i[o]:i[r]===null||t[r]===void 0||i[o]===null||t[o]===void 0?a=0:i[r]!==null&&t[r]!==void 0?a=-1:i[o]!==null&&t[o]!==void 0&&(a=1),O(a)?a*l:n2(r,o,s)}}function i2(n,e){const t={};for(let i=0;i<(e==null?void 0:e.length);i++){const r=n.find(o=>(o==null?void 0:o.key)===e[i]);r&&(t[r.key]=r==null?void 0:r.value())}return t}let r2=1,bu=class{constructor(){this.listenersData={listeners:{},listenerData:{}}}on(e,t){const i=this.listenersData.listeners[e]||(this.listenersData.listeners[e]=[]);i.push(t);const r=r2++;return this.listenersData.listenerData[r]={type:e,listener:t,remove:()=>{delete this.listenersData.listenerData[r];const o=i.indexOf(t);i.splice(o,1),this.listenersData.listeners[e].length||delete this.listenersData.listeners[e]}},r}off(e,t){var i;if(t){const r=e;this.removeEventListener(r,t)}else{const r=e;if(!this.listenersData)return;(i=this.listenersData.listenerData[r])===null||i===void 0||i.remove()}}addEventListener(e,t,i){this.on(e,t)}removeEventListener(e,t){if(this.listenersData)for(const i in this.listenersData.listenerData){const r=this.listenersData.listenerData[i];r.type===e&&r.listener===t&&this.off(i)}}hasListeners(e){return!!this.listenersData&&!!this.listenersData.listeners[e]}fireListeners(e,t){if(!this.listenersData)return[];const i=this.listenersData.listeners[e];return i?i.map(r=>r.call(this,t)).filter(r=>O(r)):[]}release(){delete this.listenersData}},_b;const o2={CHANGE_STYLE:"change_style"};let Nn=class Oc extends bu{static get EVENT_TYPE(){return o2}static get DEFAULT(){return _b||(_b=new Oc)}constructor(e={},t={}){var i,r,o,s,l,a,d,u,h,c,g,f,p,m,b,C,_,w,y,v,x,S,R,B,A,M,H,E,T,P,k;super(),this._defaultPadding=[10,16,10,16],this._textAlign=(i=e==null?void 0:e.textAlign)!==null&&i!==void 0?i:t==null?void 0:t.textAlign,this._textBaseline=(r=e==null?void 0:e.textBaseline)!==null&&r!==void 0?r:t==null?void 0:t.textBaseline,this._color=(o=e==null?void 0:e.color)!==null&&o!==void 0?o:t==null?void 0:t.color,this._strokeColor=(s=e==null?void 0:e.strokeColor)!==null&&s!==void 0?s:t==null?void 0:t.strokeColor,this._fontSize=(l=e.fontSize)!==null&&l!==void 0?l:t==null?void 0:t.fontSize,this._fontFamily=(a=e.fontFamily)!==null&&a!==void 0?a:t==null?void 0:t.fontFamily,this._fontWeight=(d=e.fontWeight)!==null&&d!==void 0?d:t==null?void 0:t.fontWeight,this._fontVariant=(u=e.fontVariant)!==null&&u!==void 0?u:t==null?void 0:t.fontVariant,this._fontStyle=(h=e.fontStyle)!==null&&h!==void 0?h:t==null?void 0:t.fontStyle,this._padding=(g=(c=e==null?void 0:e.padding)!==null&&c!==void 0?c:t==null?void 0:t.padding)!==null&&g!==void 0?g:this._defaultPadding,this._borderColor=(f=e==null?void 0:e.borderColor)!==null&&f!==void 0?f:t==null?void 0:t.borderColor,this._textOverflow=(p=e==null?void 0:e.textOverflow)!==null&&p!==void 0?p:t==null?void 0:t.textOverflow,this._textStick=(b=(m=e.textStick)!==null&&m!==void 0?m:t==null?void 0:t.textStick)!==null&&b!==void 0&&b,this._textStickBaseOnAlign=(_=(C=e.textStickBaseOnAlign)!==null&&C!==void 0?C:t==null?void 0:t.textStickBaseOnAlign)!==null&&_!==void 0&&_,this._bgColor=(w=e==null?void 0:e.bgColor)!==null&&w!==void 0?w:t==null?void 0:t.bgColor,this._lineHeight=(y=e==null?void 0:e.lineHeight)!==null&&y!==void 0?y:t==null?void 0:t.lineHeight,this._underline=(v=e==null?void 0:e.underline)!==null&&v!==void 0?v:t==null?void 0:t.underline,this._underlineColor=(x=e==null?void 0:e.underlineColor)!==null&&x!==void 0?x:t==null?void 0:t.underlineColor,this._underlineDash=(S=e==null?void 0:e.underlineDash)!==null&&S!==void 0?S:t==null?void 0:t.underlineDash,this._underlineOffset=(R=e==null?void 0:e.underlineOffset)!==null&&R!==void 0?R:t==null?void 0:t.underlineOffset,this._lineThrough=(B=e==null?void 0:e.lineThrough)!==null&&B!==void 0?B:t==null?void 0:t.lineThrough,this._lineThroughColor=(A=e==null?void 0:e.lineThroughColor)!==null&&A!==void 0?A:t==null?void 0:t.lineThroughColor,this._lineThroughDash=(M=e==null?void 0:e.lineThroughDash)!==null&&M!==void 0?M:t==null?void 0:t.lineThroughDash,this._linkColor=(H=e==null?void 0:e.linkColor)!==null&&H!==void 0?H:t==null?void 0:t.linkColor,this._cursor=(E=e.cursor)!==null&&E!==void 0?E:t==null?void 0:t.cursor,this._borderLineWidth=(T=e.borderLineWidth)!==null&&T!==void 0?T:t==null?void 0:t.borderLineWidth,this._borderLineDash=(P=e.borderLineDash)!==null&&P!==void 0?P:t==null?void 0:t.borderLineDash,this._marked=(k=e.marked)!==null&&k!==void 0?k:t==null?void 0:t.marked}get color(){return this._color}set color(e){this._color=e}get strokeColor(){return this._strokeColor}set strokeColor(e){this._strokeColor=e}get fontSize(){return this._fontSize}set fontSize(e){this._fontSize=e}get fontFamily(){return this._fontFamily}set fontFamily(e){this._fontFamily=e}get fontWeight(){return this._fontWeight}set fontWeight(e){this._fontWeight=e}get fontVariant(){return this._fontVariant}set fontVariant(e){this._fontVariant=e}get fontStyle(){return this._fontStyle}set fontStyle(e){this._fontStyle=e}get padding(){return this._padding}set padding(e){this._padding=e}get textOverflow(){return this._textOverflow}set textOverflow(e){this._textOverflow=e}get bgColor(){return this._bgColor}set bgColor(e){this._bgColor=e}get borderColor(){return this._borderColor}set borderColor(e){this._borderColor=e}get textStick(){return this._textStick}set textStick(e){this._textStick=e}get textStickBaseOnAlign(){return this._textStickBaseOnAlign}set textStickBaseOnAlign(e){this._textStickBaseOnAlign=e}get textAlign(){return this._textAlign}set textAlign(e){this._textAlign=e}get textBaseline(){return this._textBaseline}set textBaseline(e){this._textBaseline=e}get lineHeight(){return this._lineHeight}set lineHeight(e){this._lineHeight=e}get underline(){return this._underline}set underline(e){this._underline=e}get underlineColor(){return this._underlineColor}set underlineColor(e){this._underlineColor=e}get underlineDash(){return this._underlineDash}set underlineDash(e){this._underlineDash=e}get underlineOffset(){return this._underlineOffset}set underlineOffset(e){this._underlineOffset=e}get lineThrough(){return this._lineThrough}set lineThrough(e){this._lineThrough=e}get lineThroughColor(){return this._lineThroughColor}set lineThroughColor(e){this._lineThroughColor=e}get lineThroughDash(){return this._lineThroughDash}set lineThroughDash(e){this._lineThroughDash=e}get linkColor(){return this._linkColor}set linkColor(e){this._linkColor=e}get cursor(){return this._cursor}set cursor(e){this._cursor=e}get borderLineWidth(){return this._borderLineWidth}set borderLineWidth(e){this._borderLineWidth=e}get borderLineDash(){return this._borderLineDash}set borderLineDash(e){this._borderLineDash=e}get marked(){return this._marked}set marked(e){this._marked=e}clone(){return new Oc(this,null)}},wb,s2=class Dc extends Nn{static get DEFAULT(){return wb||(wb=new Dc)}constructor(e={},t={}){super(e,t)}clone(){return new Dc(this,null)}},yb;class $s extends Nn{static get DEFAULT(){return yb||(yb=new $s)}constructor(e={},t={}){var i,r;super(e,t),this._autoWrapText=(i=e==null?void 0:e.autoWrapText)!==null&&i!==void 0?i:t==null?void 0:t.autoWrapText,this._lineClamp=(r=e==null?void 0:e.lineClamp)!==null&&r!==void 0?r:t==null?void 0:t.lineClamp}clone(){return new $s(this,null)}get lineClamp(){return this._lineClamp}set lineClamp(e){this._lineClamp=e}get autoWrapText(){return this._autoWrapText}set autoWrapText(e){this._autoWrapText=e}}let vb,Wc=class ea extends Nn{static get DEFAULT(){return vb||(vb=new ea)}constructor(e={},t={},i={}){var r,o,s,l,a,d,u,h,c,g,f,p,m,b,C,_,w,y,v,x,S,R;super(e,t),this._size=((o=(r=e==null?void 0:e.size)!==null&&r!==void 0?r:t==null?void 0:t.size)!==null&&o!==void 0?o:i==null?void 0:i.size)||14,this._spaceBetweenTextAndIcon=((l=(s=e==null?void 0:e.spaceBetweenTextAndIcon)!==null&&s!==void 0?s:t==null?void 0:t.spaceBetweenTextAndIcon)!==null&&l!==void 0?l:i==null?void 0:i.spaceBetweenTextAndIcon)||8,this._defaultFill=(d=(a=e==null?void 0:e.checkboxStyle)===null||a===void 0?void 0:a.defaultFill)!==null&&d!==void 0?d:i==null?void 0:i.defaultFill,this._defaultStroke=(h=(u=e==null?void 0:e.checkboxStyle)===null||u===void 0?void 0:u.defaultStroke)!==null&&h!==void 0?h:i==null?void 0:i.defaultStroke,this._disableFill=(g=(c=e==null?void 0:e.checkboxStyle)===null||c===void 0?void 0:c.disableFill)!==null&&g!==void 0?g:i==null?void 0:i.disableFill,this._checkedFill=(p=(f=e==null?void 0:e.checkboxStyle)===null||f===void 0?void 0:f.checkedFill)!==null&&p!==void 0?p:i==null?void 0:i.checkedFill,this._checkedStroke=(b=(m=e==null?void 0:e.checkboxStyle)===null||m===void 0?void 0:m.checkedStroke)!==null&&b!==void 0?b:i==null?void 0:i.checkedStroke,this._disableCheckedFill=(_=(C=e==null?void 0:e.checkboxStyle)===null||C===void 0?void 0:C.disableCheckedFill)!==null&&_!==void 0?_:i==null?void 0:i.disableCheckedFill,this._disableCheckedStroke=(y=(w=e==null?void 0:e.checkboxStyle)===null||w===void 0?void 0:w.disableCheckedStroke)!==null&&y!==void 0?y:i==null?void 0:i.disableCheckedStroke,this._checkIconImage=(x=(v=e==null?void 0:e.checkboxStyle)===null||v===void 0?void 0:v.checkIconImage)!==null&&x!==void 0?x:i==null?void 0:i.checkIconImage,this._indeterminateIconImage=(R=(S=e==null?void 0:e.checkboxStyle)===null||S===void 0?void 0:S.indeterminateIconImage)!==null&&R!==void 0?R:i==null?void 0:i.indeterminateIconImage}get size(){return this._size}set size(e){this._size=e}get spaceBetweenTextAndIcon(){return this._spaceBetweenTextAndIcon}set spaceBetweenTextAndIcon(e){this._spaceBetweenTextAndIcon=e}get defaultFill(){return this._defaultFill}set defaultFill(e){this._defaultFill=e}get defaultStroke(){return this._defaultStroke}set defaultStroke(e){this._defaultStroke=e}get disableFill(){return this._disableFill}set disableFill(e){this._disableFill=e}get checkedFill(){return this._checkedFill}set checkedFill(e){this._checkedFill=e}get checkedStroke(){return this._checkedStroke}set checkedStroke(e){this._checkedStroke=e}get disableCheckedFill(){return this._disableCheckedFill}set disableCheckedFill(e){this._disableCheckedFill=e}get disableCheckedStroke(){return this._disableCheckedStroke}set disableCheckedStroke(e){this._disableCheckedStroke=e}get checkIconImage(){return this._checkIconImage}set checkIconImage(e){this._checkIconImage=e}get indeterminateIconImage(){return this._indeterminateIconImage}set indeterminateIconImage(e){this._indeterminateIconImage=e}getStyle(e){return new ea(e,this)}clone(){return new ea(this)}},Sb;class xr extends Nn{static get DEFAULT(){return Sb||(Sb=new xr)}constructor(e={},t={},i={}){var r,o,s,l,a,d,u,h,c,g,f,p,m,b,C,_,w,y,v,x,S,R,B,A;super(e,t),this._size=((o=(r=e==null?void 0:e.size)!==null&&r!==void 0?r:t==null?void 0:t.size)!==null&&o!==void 0?o:i==null?void 0:i.size)||14,this._spaceBetweenTextAndIcon=((l=(s=e==null?void 0:e.spaceBetweenTextAndIcon)!==null&&s!==void 0?s:t==null?void 0:t.spaceBetweenTextAndIcon)!==null&&l!==void 0?l:i==null?void 0:i.spaceBetweenTextAndIcon)||8,this._spaceBetweenRadio=((d=(a=e==null?void 0:e.spaceBetweenRadio)!==null&&a!==void 0?a:t==null?void 0:t.spaceBetweenRadio)!==null&&d!==void 0?d:i==null?void 0:i.spaceBetweenRadio)||2,this._innerRadius=(h=(u=e==null?void 0:e.radioStyle)===null||u===void 0?void 0:u.innerRadius)!==null&&h!==void 0?h:i==null?void 0:i.innerRadius,this._outerRadius=(g=(c=e==null?void 0:e.radioStyle)===null||c===void 0?void 0:c.outerRadius)!==null&&g!==void 0?g:i==null?void 0:i.outerRadius,this._defaultFill=(p=(f=e==null?void 0:e.radioStyle)===null||f===void 0?void 0:f.defaultFill)!==null&&p!==void 0?p:i==null?void 0:i.defaultFill,this._defaultStroke=(b=(m=e==null?void 0:e.radioStyle)===null||m===void 0?void 0:m.defaultStroke)!==null&&b!==void 0?b:i==null?void 0:i.defaultStroke,this._disableFill=(_=(C=e==null?void 0:e.radioStyle)===null||C===void 0?void 0:C.disableFill)!==null&&_!==void 0?_:i==null?void 0:i.disableFill,this._checkedFill=(y=(w=e==null?void 0:e.radioStyle)===null||w===void 0?void 0:w.checkedFill)!==null&&y!==void 0?y:i==null?void 0:i.checkedFill,this._checkedStroke=(x=(v=e==null?void 0:e.radioStyle)===null||v===void 0?void 0:v.checkedStroke)!==null&&x!==void 0?x:i==null?void 0:i.checkedStroke,this._disableCheckedFill=(R=(S=e==null?void 0:e.radioStyle)===null||S===void 0?void 0:S.disableCheckedFill)!==null&&R!==void 0?R:i==null?void 0:i.disableCheckedFill,this._disableCheckedStroke=(A=(B=e==null?void 0:e.radioStyle)===null||B===void 0?void 0:B.disableCheckedStroke)!==null&&A!==void 0?A:i==null?void 0:i.disableCheckedStroke}get size(){return this._size}set size(e){this._size=e}get spaceBetweenTextAndIcon(){return this._spaceBetweenTextAndIcon}set spaceBetweenTextAndIcon(e){this._spaceBetweenTextAndIcon=e}get spaceBetweenRadio(){return this._spaceBetweenRadio}set spaceBetweenRadio(e){this._spaceBetweenRadio=e}get innerRadius(){return this._innerRadius}set innerRadius(e){this._innerRadius=e}get outerRadius(){return this._outerRadius}set outerRadius(e){this._outerRadius=e}get defaultFill(){return this._defaultFill}set defaultFill(e){this._defaultFill=e}get defaultStroke(){return this._defaultStroke}set defaultStroke(e){this._defaultStroke=e}get disableFill(){return this._disableFill}set disableFill(e){this._disableFill=e}get checkedFill(){return this._checkedFill}set checkedFill(e){this._checkedFill=e}get checkedStroke(){return this._checkedStroke}set checkedStroke(e){this._checkedStroke=e}get disableCheckedFill(){return this._disableCheckedFill}set disableCheckedFill(e){this._disableCheckedFill=e}get disableCheckedStroke(){return this._disableCheckedStroke}set disableCheckedStroke(e){this._disableCheckedStroke=e}getStyle(e){return new xr(e,this)}clone(){return new xr(this)}}let xb;class Rr extends Nn{static get DEFAULT(){return xb||(xb=new Rr)}constructor(e={},t={},i={}){var r,o,s,l,a,d,u,h,c,g,f,p,m,b,C,_,w,y;super(e,t),this._spaceBetweenTextAndCircle=((o=(r=e==null?void 0:e.spaceBetweenTextAndCircle)!==null&&r!==void 0?r:t==null?void 0:t.spaceBetweenTextAndCircle)!==null&&o!==void 0?o:i==null?void 0:i.spaceBetweenTextAndCircle)||6,this._circleRadius=((l=(s=e==null?void 0:e.switchStyle)===null||s===void 0?void 0:s.circleRadius)!==null&&l!==void 0?l:i==null?void 0:i.circleRadius)||8,this._boxWidth=((d=(a=e==null?void 0:e.switchStyle)===null||a===void 0?void 0:a.boxWidth)!==null&&d!==void 0?d:i==null?void 0:i.boxWidth)||40,this._boxHeight=((h=(u=e==null?void 0:e.switchStyle)===null||u===void 0?void 0:u.boxHeight)!==null&&h!==void 0?h:i==null?void 0:i.boxHeight)||24,this._checkedFill=((g=(c=e==null?void 0:e.switchStyle)===null||c===void 0?void 0:c.checkedFill)!==null&&g!==void 0?g:i==null?void 0:i.checkedFill)||"#165DFF",this._uncheckedFill=((p=(f=e==null?void 0:e.switchStyle)===null||f===void 0?void 0:f.uncheckedFill)!==null&&p!==void 0?p:i==null?void 0:i.uncheckedFill)||"#c9cdd4",this._disableCheckedFill=((b=(m=e==null?void 0:e.switchStyle)===null||m===void 0?void 0:m.disableCheckedFill)!==null&&b!==void 0?b:i==null?void 0:i.disableCheckedFill)||"#94bfff",this._disableUncheckedFill=((_=(C=e==null?void 0:e.switchStyle)===null||C===void 0?void 0:C.disableUncheckedFill)!==null&&_!==void 0?_:i==null?void 0:i.disableUncheckedFill)||"#f2f3f5",this._circleFill=((y=(w=e==null?void 0:e.switchStyle)===null||w===void 0?void 0:w.circleFill)!==null&&y!==void 0?y:i==null?void 0:i.circleFill)||"#FFF"}get spaceBetweenTextAndCircle(){return this._spaceBetweenTextAndCircle}set spaceBetweenTextAndCircle(e){this._spaceBetweenTextAndCircle=e}get circleRadius(){return this._circleRadius}set circleRadius(e){this._circleRadius=e}get boxWidth(){return this._boxWidth}set boxWidth(e){this._boxWidth=e}get boxHeight(){return this._boxHeight}set boxHeight(e){this._boxHeight=e}get checkedFill(){return this._checkedFill}set checkedFill(e){this._checkedFill=e}get uncheckedFill(){return this._uncheckedFill}set uncheckedFill(e){this._uncheckedFill=e}get disableCheckedFill(){return this._disableCheckedFill}set disableCheckedFill(e){this._disableCheckedFill=e}get disableUncheckedFill(){return this._disableUncheckedFill}set disableUncheckedFill(e){this._disableUncheckedFill=e}get circleFill(){return this._circleFill}set circleFill(e){this._circleFill=e}getStyle(e){return new Rr(e,this)}clone(){return new Rr(this)}}let Rb;class Ar extends Nn{static get DEFAULT(){return Rb||(Rb=new Ar)}constructor(e={},t={},i={}){var r,o,s,l,a,d,u,h,c,g,f,p,m,b,C,_,w,y,v,x,S,R;super(e,t),this._buttonColor=((o=(r=e==null?void 0:e.buttonStyle)===null||r===void 0?void 0:r.buttonColor)!==null&&o!==void 0?o:i==null?void 0:i.buttonColor)||"#165DFF",this._buttonBorderColor=((l=(s=e==null?void 0:e.buttonStyle)===null||s===void 0?void 0:s.buttonBorderColor)!==null&&l!==void 0?l:i==null?void 0:i.buttonBorderColor)||"#165DFF",this._buttonLineWidth=((d=(a=e==null?void 0:e.buttonStyle)===null||a===void 0?void 0:a.buttonLineWidth)!==null&&d!==void 0?d:i==null?void 0:i.buttonLineWidth)||1,this._buttonBorderRadius=((h=(u=e==null?void 0:e.buttonStyle)===null||u===void 0?void 0:u.buttonBorderRadius)!==null&&h!==void 0?h:i==null?void 0:i.buttonBorderRadius)||2,this._buttonHoverColor=((g=(c=e==null?void 0:e.buttonStyle)===null||c===void 0?void 0:c.buttonHoverColor)!==null&&g!==void 0?g:i==null?void 0:i.buttonHoverColor)||"#4080FF",this._buttonHoverBorderColor=((p=(f=e==null?void 0:e.buttonStyle)===null||f===void 0?void 0:f.buttonHoverBorderColor)!==null&&p!==void 0?p:i==null?void 0:i.buttonHoverBorderColor)||"#4080FF",this._buttonTextHoverColor=(b=(m=e==null?void 0:e.buttonStyle)===null||m===void 0?void 0:m.buttonTextHoverColor)!==null&&b!==void 0?b:i==null?void 0:i.buttonTextHoverColor,this._buttonDisableColor=((_=(C=e==null?void 0:e.buttonStyle)===null||C===void 0?void 0:C.buttonDisableColor)!==null&&_!==void 0?_:i==null?void 0:i.buttonDisableColor)||"#94bfff",this._buttonDisableBorderColor=((y=(w=e==null?void 0:e.buttonStyle)===null||w===void 0?void 0:w.buttonDisableBorderColor)!==null&&y!==void 0?y:i==null?void 0:i.buttonDisableBorderColor)||"#94bfff",this._buttonTextDisableColor=(x=(v=e==null?void 0:e.buttonStyle)===null||v===void 0?void 0:v.buttonTextDisableColor)!==null&&x!==void 0?x:i==null?void 0:i.buttonTextDisableColor,this._buttonPadding=((R=(S=e==null?void 0:e.buttonStyle)===null||S===void 0?void 0:S.buttonPadding)!==null&&R!==void 0?R:i==null?void 0:i.buttonPadding)||10}get buttonColor(){return this._buttonColor}set buttonColor(e){this._buttonColor=e}get buttonBorderColor(){return this._buttonBorderColor}set buttonBorderColor(e){this._buttonBorderColor=e}get buttonLineWidth(){return this._buttonLineWidth}set buttonLineWidth(e){this._buttonLineWidth=e}get buttonBorderRadius(){return this._buttonBorderRadius}set buttonBorderRadius(e){this._buttonBorderRadius=e}get buttonHoverColor(){return this._buttonHoverColor}set buttonHoverColor(e){this._buttonHoverColor=e}get buttonHoverBorderColor(){return this._buttonHoverBorderColor}set buttonHoverBorderColor(e){this._buttonHoverBorderColor=e}get buttonTextHoverColor(){return this._buttonTextHoverColor}set buttonTextHoverColor(e){this._buttonTextHoverColor=e}get buttonDisableColor(){return this._buttonDisableColor}set buttonDisableColor(e){this._buttonDisableColor=e}get buttonDisableBorderColor(){return this._buttonDisableBorderColor}set buttonDisableBorderColor(e){this._buttonDisableBorderColor=e}get buttonTextDisableColor(){return this._buttonTextDisableColor}set buttonTextDisableColor(e){this._buttonTextDisableColor=e}get buttonTextHoverBorderColor(){return this._buttonTextHoverBorderColor}set buttonTextHoverBorderColor(e){this._buttonTextHoverBorderColor=e}get buttonPadding(){return this._buttonPadding}set buttonPadding(e){this._buttonPadding=e}getStyle(e){return new Ar(e,this)}clone(){return new Ar(this)}}const{EVENT_TYPE:wO}=Nn;function Xf(n,e,t,i=Nn,r,o){var s,l,a,d;return n||e?n instanceof Nn?n:typeof n=="function"?Xf(n(t),e,t,i,r,o):(n||(n={}),r&&!O(n.autoWrapText)&&(n.autoWrapText=!0),i===Wc?new Wc(n??{},e??{},(s=o.checkboxStyle)!==null&&s!==void 0?s:{}):i===xr?new xr(n??{},e??{},(l=o.radioStyle)!==null&&l!==void 0?l:{}):i===Rr?new Rr(n??{},e??{},(a=o.switchStyle)!==null&&a!==void 0?a:{}):i===Ar?new Ar(n??{},e??{},(d=o.buttonStyle)!==null&&d!==void 0?d:{}):new i(n??{},e??{})):i.DEFAULT}class Me{static get mode(){return Me._mode||(Me._mode=l2()),Me._mode}static set mode(e){Me._mode=e}static RegisterCreateCanvas(e){Me.CreateCanvas=e}static RegisterLoadImage(e){Me.LoadImage=e}static GetCreateCanvasFunc(){return Me.CreateCanvas?Me.CreateCanvas:Me.mode==="worker"?(e=200,t=200)=>new OffscreenCanvas(e,t):void 0}static RegisterRequestAnimationFrame(e){Me.RequestAnimationFrame=e()}static GetRequestAnimationFrame(){if(Me.RequestAnimationFrame)return Me.RequestAnimationFrame}static RegisterCancelAnimationFrame(e){Me.CancelAnimationFrame=e()}static GetCancelAnimationFrame(){if(Me.CancelAnimationFrame)return Me.CancelAnimationFrame}}function l2(){let n="browser";try{window.type==="node"?n="node":typeof window>"u"||window.performance?typeof window>"u"&&(n="node"):n="miniApp"}catch{n="node"}return n}Me.dpr=0;function a2(){if(Me.mode==="node")return;const n=document.createElement("style");n.id="vtable-style-styleSheet",n.textContent=`
.vtable .input-container {
	position: absolute;
	top:0px;
}
.vtable .table-scrollable {
	position: absolute;
	overflow: scroll;
}
.vtable .table-scrollable::-webkit-scrollbar-button{
	background-color: transparent;
}
.vtable .table-scrollable::-webkit-scrollbar-track-piece{
	background-color: transparent;
}
.vtable .table-scrollable::-webkit-scrollbar-corner {
	background-color: transparent;
}
.vtable .table-scrollable::-webkit-scrollbar-thumb {
	border-radius      : 4px;
	background-color   : rgba(100, 100, 100, .5);
}

.vtable .table-scroll-end-point {
	opacity: 0;
	position: relative;
}
.vtable {
	/* 设置overflow: auto 应该是为了滚动条的某个问题 但设置了auto之后 dom的下拉菜单只能显示在vtable节点中 超出会截断;现在去掉auto 暂时滚动条的问题没有发现 */
	/* overflow: auto; */
	position: relative;
	width: 100%;
	height: 100%;
	text-align: left;
  -webkit-font-smoothing:auto;

  overflow: hidden; // for react-vtable dom custom element
}

.vtable-gantt {
	/* 设置overflow: auto 应该是为了滚动条的某个问题 但设置了auto之后 dom的下拉菜单只能显示在vtable节点中 超出会截断;现在去掉auto 暂时滚动条的问题没有发现 */
	/* overflow: auto; */
	position: absolute;
	width: 100%;
	height: 100%;
	text-align: left;
  -webkit-font-smoothing:auto;

  overflow: hidden; // for react-vtable dom custom element
}
.vtable .table-component-container {
  pointer-events: none;
  overflow: hidden;
  position: absolute;
  top: 0px;
  left: 0px;
}
.vtable > canvas {
	position: absolute;
	width: 0;
	height: 0;
}
.vtable .table-focus-control {
	position: relative !important;
	width: 1px;
	height: 1px;
	opacity: 0;
	padding: 0;
	margin: 0;
	box-sizing: border-box;
	pointer-events: none;
	max-width: 500px;
	max-height: 500px;
	float: none !important;
}
.vtable input.table-focus-control::-ms-clear {
	visibility: hidden;
}
.vtable input.table-focus-control.composition {
	opacity: 1;
	max-width: none;
	max-height: none;
}
`,document.head.appendChild(n)}function d2(n){var e;return n!=null&&n.hoverOn||n!=null&&n.horizontalVisible&&(n==null?void 0:n.horizontalVisible)==="none"||!(n!=null&&n.horizontalVisible)&&(n==null?void 0:n.visible)==="none"?0:(e=n==null?void 0:n.width)!==null&&e!==void 0?e:7}function u2(n){var e;return n!=null&&n.hoverOn||n!=null&&n.verticalVisible&&(n==null?void 0:n.verticalVisible)==="none"||!(n!=null&&n.verticalVisible)&&(n==null?void 0:n.visible)==="none"?0:(e=n==null?void 0:n.width)!==null&&e!==void 0?e:7}function h2(n){return!!O(n)&&(!ee(n)||n.some(e=>O(e)))}function c2(n){return n===0||ee(n)&&n.every(e=>e===0)}const f2=n=>{switch(Object.prototype.toString.call(n)){case"[object Object]":return"object";case"[object Function]":return"function";case"[object Array]":return"array";case"[object String]":return"string";case"[object Number]":return"number";case"[object RegExp]":return"regExp";case"[object Boolean]":return"boolean";case"[object Symbol]":return"symbol";case"[object Date]":return"date";case"[object Undefined]":return"undefined";case"[object Null]":return"null";case"[object Error]":return"error";case"[object HTMLDocument]":return"document";case"[object global]":return"global";default:return null}},Cu=(n,e)=>f2(n)===e,Fl=n=>Cu(n,"object"),g2=n=>Cu(n,"string"),p2=n=>Cu(n,"number"),m2=n=>Cu(n,"boolean");function Ke(n,...e){if(!e.length)return n||{};const t=e.shift();if(Fl(n)&&Fl(t))for(const i in t)Fl(t[i])?(n[i]||Object.assign(n,{[i]:{}}),Fl(n[i])||Object.assign(n,{[i]:t[i]}),Ke(n[i],t[i])):t[i]!==null&&t[i]!==void 0&&Object.assign(n,{[i]:t[i]});return Ke(n,...e)}function Ab(n){return typeof n=="function"&&(n=n()),O(n)?`${n}`:""}function yO(n){if((n==null?void 0:n.length)<=0)return n;const e=n.length,t=n[0].length,i=new Array(t);for(let r=0;r<e;r++)for(let o=0;o<t;o++)i[o]||(i[o]=new Array(e)),i[o][r]=n[r][o];return i}function Bb(n,e){let t=null;return function(...i){t||(n.apply(this,i),t=setTimeout(()=>{t=null},e))}}function b2(n,e){let t=null;return function(...i){t||(t=setTimeout(()=>{n.apply(this,i),t=null},e))}}function Ku(n,e){for(n=`${n}`;n.length<e;)n="0"+n;return n}function Li(n,e,t){n=(n=n.replace(/^\s*|\s*$/,"")).replace(/^#?([a-f0-9])([a-f0-9])([a-f0-9])$/i,"#$1$1$2$2$3$3");const i=Math.round(256*e)*1,r=n.match(new RegExp("^rgba?\\(\\s*(\\d|[1-9]\\d|1\\d{2}|2[0-4][0-9]|25[0-5])\\s*,\\s*(\\d|[1-9]\\d|1\\d{2}|2[0-4][0-9]|25[0-5])\\s*,\\s*(\\d|[1-9]\\d|1\\d{2}|2[0-4][0-9]|25[0-5])(?:\\s*,\\s*(0|1|0?\\.\\d+))?\\s*\\)$","i")),o=r&&O(r[4])?r[4]:null,s=r?[r[1],r[2],r[3]]:n.replace(/^#?([a-f0-9][a-f0-9])([a-f0-9][a-f0-9])([a-f0-9][a-f0-9])/i,function(){return`${parseInt(arguments[1],16)},${parseInt(arguments[2],16)},${parseInt(arguments[3],16)}`}).split(/,/);return r?`rgb${o!==null?"a":""}(${Math.min(parseInt(s[0],10)+i,255)}, ${Math.min(parseInt(s[1],10)+i,255)}, ${Math.min(parseInt(s[2],10)+i,255)}${o!==null?`, ${o}`:""})`:["#",Ku(Math.min(parseInt(s[0],10)+i,255).toString(16),2),Ku(Math.min(parseInt(s[1],10)+i,255).toString(16),2),Ku(Math.min(parseInt(s[2],10)+i,255).toString(16),2)].join("")}function _u(n){return g2(n)||p2(n)||m2(n)?n.toString():""}function Nc(){return navigator.userAgent.match(/(phone|pad|pod|iPhone|iPod|ios|iPad|Android|Mobile|BlackBerry|IEMobile|MQQBrowser|JUC|Fennec|wOSBrowser|BrowserNG|WebOS|Symbian|Windows Phone)/i)}function ad(n,e,t){return t!=="desc"?n===e?0:n>e?1:-1:n===e?0:n<e?1:-1}function C2(n,e){let t,i=n;for(;(t=e.shift())&&(i=i[t],i););return i}function _2(n){return/^-?\d+(\.\d+)?$/.test(n)}function ws(n){const e=[];for(let t=0;t<n.length;t++)e.indexOf(n[t])===-1&&e.push(n[t]);return e}function w2(n){const e=window.getSelection();if(e.rangeCount){const t=e.getRangeAt(0);return t.endOffset>t.startOffset&&n.contains(t.commonAncestorContainer)}return!1}function qf(n,e,t){t(n),n!=null&&n[e]&&Array.isArray(n==null?void 0:n[e])&&n[e].forEach(i=>qf(i,e,t))}const Aw=typeof window>"u"||window.window===void 0;let Yu,Xu;const Bw={get find(){return Yu||(Yu=Array.prototype.find?(n,e)=>Array.prototype.find.call(n,e):(n,e)=>{const t=Bw.findIndex(n,e);return t>=0?n[t]:void 0},Yu)},get findIndex(){return Xu||(Xu=Array.prototype.findIndex?(n,e)=>Array.prototype.findIndex.call(n,e):(n,e)=>{const{length:t}=n;for(let i=0;i<t;i++)if(e(n[i],i,n))return i;return-1},Xu)}};function y2(){if(Aw)return{IE:!1,Edge:!1,Chrome:!1,Firefox:!1,Safari:!1};const n=window.navigator.userAgent.toLowerCase();return{IE:!!/(msie|trident)/.exec(n),Edge:n.indexOf("edge")>-1,Chrome:n.indexOf("chrome")>-1&&n.indexOf("edge")===-1,Firefox:n.indexOf("firefox")>-1,Safari:n.indexOf("safari")>-1&&n.indexOf("edge")===-1}}const{IE:v2,Chrome:vO,Firefox:SO,Edge:xO,Safari:RO}=y2();function S2(n){return n===Object(n)}function ul(...n){const e={};return n.forEach(t=>{for(const i in t)Object.defineProperty(e,i,{get:()=>t[i],set(r){t[i]=r},configurable:!0,enumerable:!0})}),e}function Mw(n,e,...t){let i=n;for(let r=0;r<t.length&&i!=null;r++)i=e(i,t[r]);return i}function zl(n,...e){return Mw(n,(t,i)=>t[i],...e)}function ze(n,...e){return typeof n=="function"?n(...e):n}function x2(n,e,t){const i=_u(n);(typeof t!="number"||!isFinite(t)||Math.floor(t)!==t||t>i.length)&&(t=i.length),t-=e.length;const r=i.lastIndexOf(e,t);return r!==-1&&r===t}function Un(n){return!!(n&&typeof n.then=="function")}function Il(n,e){Un(n)?n.then(t=>{e(t)}).catch(t=>{}):e(n)}function R2(n){return!!n.changedTouches}function A2(n,e){if(n[e])return n[e];const t=e.toLowerCase();if(n[t])return n[t];const i=e.toLowerCase();if(n[i])return n[i];for(const r in n)if(r.toLowerCase()===t)return n[r]}function Tw(n){return Array.isArray(n)?n.length===3?[n[0],n[1],n[2],n[1]]:n.length===2?[n[0],n[1],n[0],n[1]]:n.length===1?[n[0],n[0],n[0],n[0]]:[n[0],n[1],n[2],n[3]]:[n,n,n,n]}function Mn(n,e,t){return n.start.col<=e&&e<=n.end.col&&n.start.row<=t&&t<=n.end.row||n.end.col<=e&&e<=n.start.col&&n.end.row<=t&&t<=n.start.row||n.end.col<=e&&e<=n.start.col&&n.start.row<=t&&t<=n.end.row||n.start.col<=e&&e<=n.end.col&&n.end.row<=t&&t<=n.start.row}function B2(n,e,t){for(let i=0;i<n.length;i++){const r=n[i],o=Math.min(r.start.col,r.end.col),s=Math.max(r.start.col,r.end.col),l=Math.min(r.start.row,r.end.row),a=Math.max(r.start.row,r.end.row);if(o<=e&&e<=s&&l<=t&&t<=a||s<=e&&e<=o&&a<=t&&t<=l)return!0}return!1}function Mb(n){return{start:{col:Math.min(n.start.col,n.end.col),row:Math.min(n.start.row,n.end.row)},end:{col:Math.max(n.start.col,n.end.col),row:Math.max(n.start.row,n.end.row)}}}function M2(n,e){const t=Mb(n),i=Mb(e);return Math.max(t.start.col,i.start.col)<=Math.min(t.end.col,i.end.col)&&Math.max(t.start.row,i.start.row)<=Math.min(t.end.row,i.end.row)}const T2={IE:v2},Pw={isObject:S2},Ol={endsWith:x2},P2={isTouchEvent:R2},H2={toBoxArray:Tw},k2=Function.prototype,j={CLICK_CELL:"click_cell",DBLCLICK_CELL:"dblclick_cell",MOUSEDOWN_CELL:"mousedown_cell",MOUSEUP_CELL:"mouseup_cell",SELECTED_CELL:"selected_cell",SELECTED_CLEAR:"selected_clear",KEYDOWN:"keydown",MOUSEENTER_TABLE:"mouseenter_table",MOUSELEAVE_TABLE:"mouseleave_table",MOUSEDOWN_TABLE:"mousedown_table",MOUSEMOVE_TABLE:"mousemove_table",MOUSEMOVE_CELL:"mousemove_cell",MOUSEENTER_CELL:"mouseenter_cell",MOUSELEAVE_CELL:"mouseleave_cell",CONTEXTMENU_CELL:"contextmenu_cell",RESIZE_COLUMN:"resize_column",RESIZE_COLUMN_END:"resize_column_end",RESIZE_ROW:"resize_row",RESIZE_ROW_END:"resize_row_end",CHANGE_HEADER_POSITION_START:"change_header_position_start",CHANGE_HEADER_POSITION:"change_header_position",CHANGING_HEADER_POSITION:"changing_header_position",CHANGE_HEADER_POSITION_FAIL:"change_header_position_fail",SORT_CLICK:"sort_click",AFTER_SORT:"after_sort",FREEZE_CLICK:"freeze_click",SCROLL:"scroll",SCROLL_HORIZONTAL_END:"scroll_horizontal_end",SCROLL_VERTICAL_END:"scroll_vertical_end",DROPDOWN_MENU_CLICK:"dropdown_menu_click",MOUSEOVER_CHART_SYMBOL:"mouseover_chart_symbol",DRAG_SELECT_END:"drag_select_end",COPY_DATA:"copy_data",DROPDOWN_ICON_CLICK:"dropdown_icon_click",DROPDOWN_MENU_CLEAR:"dropdown_menu_clear",TREE_HIERARCHY_STATE_CHANGE:"tree_hierarchy_state_change",SHOW_MENU:"show_menu",HIDE_MENU:"hide_menu",ICON_CLICK:"icon_click",LEGEND_ITEM_CLICK:"legend_item_click",LEGEND_ITEM_HOVER:"legend_item_hover",LEGEND_ITEM_UNHOVER:"legend_item_unHover",LEGEND_CHANGE:"legend_change",MOUSEENTER_AXIS:"mouseenter_axis",MOUSELEAVE_AXIS:"mouseleave_axis",CHECKBOX_STATE_CHANGE:"checkbox_state_change",RADIO_STATE_CHANGE:"radio_state_change",SWITCH_STATE_CHANGE:"switch_state_change",AFTER_RENDER:"after_render",INITIALIZED:"initialized",CHANGE_CELL_VALUE:"change_cell_value",DRAG_FILL_HANDLE_END:"drag_fill_handle_end",MOUSEDOWN_FILL_HANDLE:"mousedown_fill_handle",DBLCLICK_FILL_HANDLE:"dblclick_fill_handle",EMPTY_TIP_CLICK:"empty_tip_click",EMPTY_TIP_DBLCLICK:"empty_tip_dblclick",BUTTON_CLICK:"button_click"},E2=n=>{switch(Object.prototype.toString.call(n)){case"[object Object]":return"object";case"[object Function]":return"function";case"[object Array]":return"array";case"[object String]":return"string";case"[object Number]":return"number";case"[object RegExp]":return"regExp";case"[object Boolean]":return"boolean";case"[object Symbol]":return"symbol";case"[object Date]":return"date";case"[object Undefined]":return"undefined";case"[object Null]":return"null";case"[object Error]":return"error";case"[object HTMLDocument]":return"document";case"[object global]":return"global";default:return null}},L2=(n,e)=>E2(n)===e,F2=n=>L2(n,"object");function Hw(n,e,t){let i,r,o,s,l,a,d=0,u=!1,h=!1,c=!0;const g=!e&&e!==0&&typeof requestAnimationFrame=="function";if(typeof n!="function")throw new TypeError("Expected a function");function f(C){const _=i,w=r;return r=void 0,i=void 0,d=C,s=n.apply(w,_),s}function p(C,_){return g?requestAnimationFrame(C):setTimeout(C,_)}function m(C){const _=C-a;return a===void 0||_>=e||_<0||u&&C-d>=o}function b(){const C=Date.now();if(m(C))return function(_){return l=void 0,c&&i?f(_):(r=void 0,i=void 0,s)}(C);l=p(b,function(_){const w=_-d,y=e&&-(_-a);return u?Math.min(y,o-w):y}(C))}return e=+e||0,F2(t)&&(h=!!t.leading,u="maxWait"in t,u&&(o=Math.max(+t.maxWait||0,e)),c="trailing"in t?!!t.trailing:c),function(...C){const _=Date.now(),w=m(_);if(i=C,r=this,a=_,w){if(l===void 0)return function(y){return d=y,l=p(b,e),h?f(y):s}(a);if(u)return l=p(b,e),f(a)}return l===void 0&&(l=p(b,e)),s}}let z2=1;class I2{constructor(e,t,i){var r;if(this.resizeTime=100,this.lastSize={width:0,height:0},this.mutationResize=()=>{this.onResize()},this.callBack=()=>{const o=this.getSize();let s=!1;o.width===this.lastSize.width&&o.height===this.lastSize.height&&(s=!0),this.lastSize=o,this.cb&&this.cb(Object.assign(Object.assign({},this.lastSize),{windowSizeNotChange:s}))},this.onResize=()=>{this.callBackDebounce()},this.element=e,this.cb=t,this.lastSize=this.getSize(),i&&(this.resizeTime=Math.max(i,16)),this.callBackDebounce=Hw(this.callBack,this.resizeTime),window==null||window.addEventListener("resize",this.onResize),"ResizeObserver"in window){const o=window.ResizeObserver;this.observer=new o(this.mutationResize),(r=this.observer)===null||r===void 0||r.observe(this.element)}else"MutationObserver"in window&&(this.observer=new MutationObserver(this.mutationResize),this.observer.observe(this.element,{attributes:!0,attributeFilter:["style"]}))}disConnect(){window.removeEventListener("resize",this.onResize),this.observer&&(this.observer.disconnect(),this.observer=void 0)}setSize(e){this.lastSize=e}checkSize(){const e=this.getSize();return e.width!==this.lastSize.width||e.height!==this.lastSize.height}getSize(){return this.element?{width:Math.floor(this.element.clientWidth),height:Math.floor(this.element.clientHeight)}:Object.assign({},this.lastSize)}}class wu{constructor(){this.listeners={},this.reseizeListeners={}}on(e,t,i,...r){if(Me.mode==="node")return-1;const o=z2++;if(e!=null&&e.addEventListener)if(t!=="resize"||e===window)e==null||e.addEventListener(t,i,...r);else{const l=new I2(e,i,this.resizeTime);this.reseizeListeners[o]=l}const s={target:e,type:t,listener:i,options:r};return this.listeners[o]=s,o}once(e,t,i,...r){if(Me.mode==="node")return-1;const o=this.on(e,t,(...s)=>{this.off(o),i(...s)},...r);return o}off(e){var t;if(Me.mode==="node"||e===null)return;const i=(t=this.listeners)===null||t===void 0?void 0:t[e];i&&(delete this.listeners[e],i.target.removeEventListener&&i.target.removeEventListener(i.type,i.listener,...i.options))}fire(e,t,...i){if(Me.mode!=="node")for(const r in this.listeners){const o=this.listeners[r];o.target===e&&o.type===t&&o.listener.call(o.target,...i)}}hasListener(e,t){if(Me.mode==="node")return!1;let i=!1;for(const r in this.listeners){const o=this.listeners[r];o.target===e&&o.type===t&&(i=!0)}return i}clear(){if(Me.mode!=="node"){for(const e in this.listeners){const t=this.listeners[e];t.target.removeEventListener&&t.target.removeEventListener(t.type,t.listener,...t.options)}for(const e in this.reseizeListeners){const t=this.reseizeListeners[e];t==null||t.disConnect()}this.listeners={}}}release(){Me.mode!=="node"&&(this.clear(),this.listeners={})}}const or=(n,e)=>{let t=0,i=n.length-1;for(;t<=i;){const r=Math.floor((t+i)/2);if(n[r]===e)return r;n[r]>e?i=r-1:t=r+1}return i<0?0:i};class Ki{constructor(){this._keys=[],this._vals={},this._sorted=!1}count(){return this._keys.length}values(){return this._vals}valueArr(){return Object.values(this._vals)}adjustOrder(e,t,i){const{_keys:r}=this;if(this._sorted||(r.sort((s,l)=>s<l?-1:s>l?1:0),this._sorted=!0),e>t){const s=[];for(let l=or(r,e+i-1);l>=0;l--){const a=r[l];if(a>=e)s.push(this.get(a));else if(t<=a&&a<e)this.put(a+i,this.get(a));else if(a<t)break}for(let l=0;l<i;l++)this.put(t+l,s[i-1-l])}const{length:o}=r;if(e<t){const s=[];for(let l=or(r,e);l<o;l++){const a=r[l];if(a>=e&&a<e+i)s.push(this.get(a));else if(e+i<=a&&a<=t)this.put(a-i,this.get(a));else if(a>t)break}for(let l=0;l<i;l++)this.put(t+l,s[l])}}exchangeOrder(e,t,i,r,o){const{_keys:s}=this;if(this._sorted||(s.sort((l,a)=>l<a?-1:l>a?1:0),this._sorted=!0),e>i){const l=[],a=[];for(let d=or(s,i);d<or(s,e)+t;d++){const u=s[d];u>=e&&u<e+t?a.push(this.get(u)):l.push(this.get(u))}for(let d=0;d<t;d++)this.put(o+d,a[d]);for(let d=0;d<l.length;d++)this.put(o+t+d,l[d])}else{const l=[],a=[];for(let d=or(s,e);d<or(s,i)+r;d++){const u=s[d];u>=e&&u<e+t?a.push(this.get(u)):l.push(this.get(u))}for(let d=0;d<t;d++)this.put(o+d,a[d]);for(let d=0;d<l.length;d++)this.put(e+d,l[d])}}del(e){delete this._vals[e];const t=this._keys.indexOf(e);t!==-1&&this._keys.splice(t,1)}put(e,t){e in this._vals||(this._keys.push(e),this._sorted=!1),this._vals[e]=t}get(e){return this._vals[e]}has(e){return O(this._vals[e])}contain(e){return Object.values(this._vals).indexOf(e)>=0}each(e,t,i){const{_keys:r}=this,{length:o}=r;this._sorted||(r.sort((s,l)=>s<l?-1:s>l?1:0),this._sorted=!0);for(let s=or(r,e);s<o;s++){const l=r[s];if(e<=l&&l<=t){if(i(this.get(l),l)===!1)break}else if(t<l)return}}clear(){this._keys.length=0,this._vals={},this._sorted=!1}getLastIndex(){return this._keys[this._keys.length-1]}delLast(){const e=this.getLastIndex();this.del(e)}delAndReorder(e){if(!this.has(e))return;const t=this.getLastIndex();this.adjustOrder(e+1,e,t-e),this.delLast()}addAndReorder(e,t){if(O(t)){const i=this.getLastIndex();this.adjustOrder(e,e+1,i-e),this.put(e,t)}}}class Zn{constructor(e,t,i,r){this.bounds=new Ri,this.bounds.set(e,t,e+i,t+r)}static bounds(e,t,i,r){return new Zn(e,t,Math.round(i-e),Math.round(r-t))}get left(){return this.bounds.x1}set left(e){this.bounds.x1=e}get top(){return this.bounds.y1}set top(e){this.bounds.y1=e}get right(){return this.bounds.x2}set right(e){this.bounds.x2=e}get bottom(){return this.bounds.y2}set bottom(e){this.bounds.y2=e}get width(){return this.bounds.width()}set width(e){this.bounds.x2=this.bounds.x1+e}get height(){return this.bounds.height()}set height(e){this.bounds.y2=this.bounds.y1+e}offsetLeft(e){this.bounds.translate(e,0)}offsetTop(e){this.bounds.translate(0,e)}copy(){return new Zn(this.left,this.top,this.width,this.height)}contains(e){return this.bounds.encloses(e.bounds)}inPoint(e,t){return this.bounds.contains(e,t)}}function O2(n){const{row:e,table:t}=n;return 1&e-t.frozenRowCount?"#282a2e":"#2d3137"}const Tb={name:"DARK",underlayBackgroundColor:"transparent",defaultStyle:{color:"#D3D5DA",bgColor:"#373b45",fontSize:12,fontFamily:"PingFang SC",fontWeight:500,lineHeight:12,borderColor:"#444A54",padding:[8,12,8,12],hover:{cellBgColor:"#2F4774"}},headerStyle:{color:"#D3D5DA",bgColor:"#373b45",fontSize:12,fontFamily:"PingFang SC",fontWeight:500,lineHeight:12,borderColor:"#444A54",padding:[8,12,8,12],hover:{cellBgColor:"#2F4774"}},rowHeaderStyle:{},cornerHeaderStyle:{},bodyStyle:{color:"#e5e7ea",bgColor:O2,fontSize:12,fontFamily:"PingFang SC",fontWeight:500,lineHeight:12,borderColor:"#444A54",padding:[8,12,8,12],hover:{cellBgColor:"#29364D"}},frameStyle:{borderColor:"#d1d5da",borderLineWidth:1,borderLineDash:[],cornerRadius:10,shadowBlur:6,shadowOffsetX:0,shadowOffsetY:0,shadowColor:"rgba(00, 24, 47, 0.06)"},columnResize:{lineWidth:1,lineColor:"#416EFF",bgColor:"#D9E2FF",width:3},frozenColumnLine:{shadow:{width:4,startColor:"rgba(00, 24, 47, 0.05)",endColor:"rgba(00, 24, 47, 0)"}},selectionStyle:{cellBgColor:"rgba(255, 255, 255, 0.1)",cellBorderColor:"#4284FF",cellBorderLineWidth:2},tooltipStyle:{bgColor:"#FFF",color:"#000",fontSize:12,fontFamily:"Arial,sans-serif"},functionalIconsStyle:{sort_color:"#FFFFFF",sort_color_opacity:"0.75",sort_color_2:"#416EFF",sort_color_opacity_2:"1",frozen_color:"#FFFFFF",frozen_color_opacity:"0.75",collapse_color:"#FFF",collapse_color_opacity:"0.75",expand_color:"#FFF",expand_color_opacity:"0.75",dragReorder_color:"#FFF",dragReorder_color_opacity:"0.75"}};function D2(n){const{row:e,table:t}=n;return 1&e-t.frozenRowCount?"#FFF":"#F4F8FF"}const Pb={name:"BRIGHT",underlayBackgroundColor:"#FFF",defaultStyle:{color:"#FFF",bgColor:"#5389FF",borderColor:"#5286FA",hover:{cellBgColor:"#2E67E3"}},headerStyle:{color:"#FFF",bgColor:"#5389FF",borderColor:"#A1C1FF",hover:{cellBgColor:"#2E67E3"}},bodyStyle:{color:"#000",bgColor:D2,borderColor:"#E0EAFE",hover:{cellBgColor:"#E9EFFD"}},frameStyle:{borderColor:"#E1E4E8",borderLineWidth:1,borderLineDash:[],cornerRadius:0,shadowBlur:0,shadowOffsetX:0,shadowOffsetY:0,shadowColor:"black"},columnResize:{lineWidth:1,lineColor:"#416EFF",bgColor:"#D9E2FF",width:3},frozenColumnLine:{shadow:{width:3,startColor:"#CBDCFE",endColor:"#CBDCFE"}},selectionStyle:{cellBgColor:"rgba(0, 0, 255,0.1)"},tooltipStyle:{bgColor:"#FFF",color:"#000",fontSize:12,fontFamily:"Arial,sans-serif"}};function W2(n){const{row:e,table:t}=n;return 1&e-t.frozenRowCount?"#fbfbfc":"#FFF"}const Hb={name:"ARCO",underlayBackgroundColor:"#FFF",defaultStyle:{color:"#1B1F23",bgColor:"#EEF1F5",fontSize:14,fontFamily:"Arial,sans-serif",fontWeight:600,lineHeight:14,borderColor:"#e1e4e8",padding:[8,12,8,12]},headerStyle:{color:"#1B1F23",bgColor:"#EEF1F5",fontSize:14,fontFamily:"Arial,sans-serif",fontWeight:600,lineHeight:14,borderColor:"#e1e4e8",padding:[8,12,8,12],hover:{cellBgColor:"#c8daf6"}},rowHeaderStyle:{color:"#1B1F23",bgColor:"#EEF1F5",fontSize:12,fontFamily:"PingFang SC",fontWeight:500,lineHeight:12,borderColor:"#e1e4e8",padding:[8,12,8,12],hover:{cellBgColor:"#c8daf6"}},cornerHeaderStyle:{color:"#1B1F23",bgColor:"#EEF1F5",fontSize:12,fontFamily:"PingFang SC",fontWeight:500,lineHeight:12,borderColor:"#e1e4e8",padding:[8,12,8,12],hover:{cellBgColor:"#c8daf6"}},bodyStyle:{padding:[8,12,8,12],color:"#141414",fontSize:14,fontFamily:"Arial,sans-serif",fontWeight:400,textAlign:"left",bgColor:W2,borderColor:"#e1e4e8",lineHeight:14,hover:{cellBgColor:"#F7F8FA",inlineRowBgColor:"#F3F8FF",inlineColumnBgColor:"#F3F8FF"}},frameStyle:{borderColor:"#d1d5da",borderLineWidth:1,borderLineDash:[],cornerRadius:4,shadowBlur:6,shadowOffsetX:0,shadowOffsetY:0,shadowColor:"rgba(00, 24, 47, 0.06)"},columnResize:{lineWidth:1,lineColor:"#416EFF",bgColor:"#D9E2FF",width:3},frozenColumnLine:{shadow:{width:4,startColor:"rgba(00, 24, 47, 0.05)",endColor:"rgba(00, 24, 47, 0)"}},selectionStyle:{cellBgColor:"rgba(0, 0, 255,0.1)",cellBorderLineWidth:2,cellBorderColor:"#3073f2"},tooltipStyle:{bgColor:"#FFF",color:"#000",fontSize:12,fontFamily:"Arial,sans-serif"}};function N2(n){const{row:e,table:t}=n;return 1&e-t.frozenRowCount?"#FDFDFD":"#FAF9FB"}const kb={name:"DEFAULT",underlayBackgroundColor:"#FFF",defaultStyle:{borderColor:"#E1E4E8",color:"#000",bgColor:"#ECF1F5"},headerStyle:{fontSize:16,fontWeight:"bold",bgColor:"#ECF1F5",hover:{cellBgColor:"#CCE0FF",inlineRowBgColor:"#F3F8FF",inlineColumnBgColor:"#F3F8FF"}},rowHeaderStyle:{fontSize:16,fontWeight:"bold",bgColor:"#ECF1F5",hover:{cellBgColor:"#CCE0FF",inlineRowBgColor:"#F3F8FF",inlineColumnBgColor:"#F3F8FF"}},cornerHeaderStyle:{fontSize:16,fontWeight:"bold"},bodyStyle:{fontSize:14,bgColor:N2,hover:{cellBgColor:"#CCE0FF",inlineRowBgColor:"#F3F8FF",inlineColumnBgColor:"#F3F8FF"}},frameStyle:{borderColor:"#E1E4E8",borderLineWidth:1,borderLineDash:[],cornerRadius:0,shadowBlur:0,shadowOffsetX:0,shadowOffsetY:0,shadowColor:"black"},columnResize:{lineWidth:1,lineColor:"#416EFF",bgColor:"#D9E2FF",width:3},frozenColumnLine:{shadow:{width:3,startColor:"rgba(225, 228, 232, 0.6)",endColor:"rgba(225, 228, 232, 0.6)"}},selectionStyle:{cellBgColor:"rgba(0, 0, 255,0.1)",cellBorderLineWidth:2,cellBorderColor:"#0000ff"},tooltipStyle:{bgColor:"#FFF",color:"#000",fontSize:12,fontFamily:"Arial,sans-serif"}};function V2(n){const{row:e,table:{frozenRowCount:t}}=n;return t-1===e?["#f2f2f2","#f2f2f2","#ccc7c7","#f2f2f2"]:["#f2f2f2"]}function G2(n){const{col:e,table:t}=n,{colCount:i,frozenColCount:r}=t,o="#ccc7c7";return r-1===e||i-1===e?[o,"#f2f2f2","#ccc7c7",null]:[o,null,"#ccc7c7",null]}const Eb={name:"SIMPLIFY",underlayBackgroundColor:"#FFF",defaultStyle:{borderColor:G2,hover:{cellBorderColor:"#0000FF",cellBgColor:"#D0E0E3"},bgColor:"#FFF"},headerStyle:{color:"rgba(0, 0, 0, 0.87)",borderColor:V2},bodyStyle:{color:"rgba(0, 0, 0, 0.87)"},frameStyle:{borderColor:"#f2f2f2",borderLineWidth:1},columnResize:{lineWidth:1,lineColor:"#416EFF",bgColor:"#D9E2FF"},selectionStyle:{cellBorderColor:"#FD5",cellBgColor:"rgba(111, 168, 220, 0.1)"},tooltipStyle:{bgColor:"#FFF",color:"#000",fontSize:12,fontFamily:"Arial,sans-serif"}},j2={},Lb=16,Fb="Arial,sans-serif",U2="#FFF",$2="#000",K2=1,Y2=[],X2="#000",Zf=/^(https?|ftp|file):\/\/[-A-Za-z0-9+&@#/%?=~_|!:,.;]+[-A-Za-z0-9+&@#/%=~_|]/,Dl="$$indicator$$",q2='<svg class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="200" height="200"><rect x="0" y="0" width="1024" height="1024" rx="20%" ry="20%" fill="#ffffff" /><path  d="M810.666667 85.333333c70.688 0 128 57.312 128 128v597.333334c0 70.688-57.312 128-128 128H213.333333c-70.688 0-128-57.312-128-128V213.333333c0-70.688 57.312-128 128-128h597.333334z m0 85.333334H213.333333a42.666667 42.666667 0 0 0-42.613333 40.533333L170.666667 213.333333v597.333334a42.666667 42.666667 0 0 0 40.533333 42.613333L213.333333 853.333333h597.333334a42.666667 42.666667 0 0 0 42.613333-40.533333L853.333333 810.666667V213.333333a42.666667 42.666667 0 0 0-40.533333-42.613333L810.666667 170.666667zM549.333333 288a5.333333 5.333333 0 0 1 5.333334 5.333333V469.333333h176a5.333333 5.333333 0 0 1 5.333333 5.333334v74.666666a5.333333 5.333333 0 0 1-5.333333 5.333334H554.666667v176a5.333333 5.333333 0 0 1-5.333334 5.333333h-74.666666a5.333333 5.333333 0 0 1-5.333334-5.333333V554.666667H293.333333a5.333333 5.333333 0 0 1-5.333333-5.333334v-74.666666a5.333333 5.333333 0 0 1 5.333333-5.333334H469.333333V293.333333a5.333333 5.333333 0 0 1 5.333334-5.333333h74.666666z"></path></svg>',Z2='<svg class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="200" height="200"><rect x="0" y="0" width="1024" height="1024" rx="20%" ry="20%" fill="#ffffff" /><path d="M810.666667 85.333333c70.688 0 128 57.312 128 128v597.333334c0 70.688-57.312 128-128 128H213.333333c-70.688 0-128-57.312-128-128V213.333333c0-70.688 57.312-128 128-128h597.333334z m0 85.333334H213.333333a42.666667 42.666667 0 0 0-42.613333 40.533333L170.666667 213.333333v597.333334a42.666667 42.666667 0 0 0 40.533333 42.613333L213.333333 853.333333h597.333334a42.666667 42.666667 0 0 0 42.613333-40.533333L853.333333 810.666667V213.333333a42.666667 42.666667 0 0 0-40.533333-42.613333L810.666667 170.666667zM693.333333 469.333333a42.666667 42.666667 0 1 1 0 85.333334H330.666667a42.666667 42.666667 0 1 1 0-85.333334h362.666666z"></path></svg>',J2={type:"line"};function Q2(n){return{defaultAxisStyle:es(n.defaultAxisStyle),leftAxisStyle:es(n.leftAxisStyle),rightAxisStyle:es(n.rightAxisStyle),topAxisStyle:es(n.topAxisStyle),bottomAxisStyle:es(n.bottomAxisStyle)}}function es(n){return n||{}}const eH={visible:!0,position:"auto",padding:8,titleStyle:{fontSize:12,fontWeight:"bold",fill:"#4E5969"},contentStyle:{fontSize:12,fill:"#4E5969"},panel:{visible:!0,fill:"#fff",stroke:"#ffffff",lineWidth:0,cornerRadius:3,shadowBlur:12,shadowOffsetX:0,shadowOffsetY:4,shadowColor:"rgba(0, 0, 0, 0.1)",size:0,space:12}};function jr(n,e,t,i){var r,o,s;return(s=(o=(r=zl(n,...t))!==null&&r!==void 0?r:zl(e,...t))!==null&&o!==void 0?o:i&&zl(n,...i))!==null&&s!==void 0?s:i&&zl(e,...i)}class hn{constructor(e,t){this._defaultStyle=null,this._header=null,this._cornerHeader=null,this._cornerRightTopCell=null,this._cornerLeftBottomCell=null,this._cornerRightBottomCell=null,this._rightFrozen=null,this._bottomFrozen=null,this._rowHeader=null,this._body=null,this._groupTitle=null,this._scroll=null,this._tooltip=null,this._frameStyle=null,this._columnResize=null,this._dragHeaderSplitLine=null,this._frozenColumnLine=null,this._selectionStyle=null,this._axisStyle=null,this._checkboxStyle=null,this._radioStyle=null,this._switchStyle=null,this._buttonStyle=null,this._textPopTipStyle=null,this._internalIconsStyle=null,this.isPivot=!1,this.name="",this.internalTheme={obj:e,superTheme:t},this.name=jr(e,t,["name"])}getExtendTheme(){return this.internalTheme.obj}clearBodyStyleCache(){this._body=null}get font(){const{obj:e,superTheme:t}=this.internalTheme;return jr(e,t,["font"],["bodyStyle","font"])}get underlayBackgroundColor(){const{obj:e,superTheme:t}=this.internalTheme;return jr(e,t,["underlayBackgroundColor"])}get cellInnerBorder(){var e;const{obj:t,superTheme:i}=this.internalTheme;return(e=jr(t,i,["cellInnerBorder"]))===null||e===void 0||e}get cellBorderClipDirection(){var e;const{obj:t,superTheme:i}=this.internalTheme;return(e=jr(t,i,["cellBorderClipDirection"]))!==null&&e!==void 0?e:"top-left"}get _contentOffset(){var e;const{obj:t,superTheme:i}=this.internalTheme;return(e=jr(t,i,["_contentOffset"]))!==null&&e!==void 0?e:0}get defaultStyle(){const e=this;if(!this._defaultStyle){const{obj:t,superTheme:i}=this.internalTheme,r=Ke({},i.defaultStyle,t.defaultStyle);this._defaultStyle={get fontSize(){var o;return(o=r.fontSize)!==null&&o!==void 0?o:Lb},get fontFamily(){var o;return(o=r.fontFamily)!==null&&o!==void 0?o:Fb},get fontWeight(){return r.fontWeight},get fontVariant(){return r.fontVariant},get fontStyle(){return r.fontStyle},get bgColor(){var o;return(o=r.bgColor)!==null&&o!==void 0?o:U2},get color(){var o;return(o=r.color)!==null&&o!==void 0?o:X2},get borderColor(){var o;return(o=r.borderColor)!==null&&o!==void 0?o:$2},get borderLineWidth(){var o;return(o=r.borderLineWidth)!==null&&o!==void 0?o:K2},get borderLineDash(){var o;return(o=r.borderLineDash)!==null&&o!==void 0?o:Y2},get hover(){if(r.hover)return{get cellBgColor(){var o,s;return(s=(o=r.hover)===null||o===void 0?void 0:o.cellBgColor)!==null&&s!==void 0?s:void 0},get inlineColumnBgColor(){var o,s,l,a,d,u;return(u=(s=(o=r.hover)===null||o===void 0?void 0:o.inlineColumnBgColor)!==null&&s!==void 0?s:!((l=r.hover)===null||l===void 0)&&l.cellBgColor&&typeof((a=r.hover)===null||a===void 0?void 0:a.cellBgColor)=="string"?Li((d=r.hover)===null||d===void 0?void 0:d.cellBgColor,.1):void 0)!==null&&u!==void 0?u:void 0},get inlineRowBgColor(){var o,s,l,a,d,u;return(u=(s=(o=r.hover)===null||o===void 0?void 0:o.inlineRowBgColor)!==null&&s!==void 0?s:!((l=r.hover)===null||l===void 0)&&l.cellBgColor&&typeof((a=r.hover)===null||a===void 0?void 0:a.cellBgColor)=="string"?Li((d=r.hover)===null||d===void 0?void 0:d.cellBgColor,.1):void 0)!==null&&u!==void 0?u:void 0}}},get select(){if(r.select)return{get inlineColumnBgColor(){var o,s,l,a,d,u;return(u=(a=(s=(o=r.select)===null||o===void 0?void 0:o.inlineColumnBgColor)!==null&&s!==void 0?s:(l=e.selectionStyle)===null||l===void 0?void 0:l.inlineColumnBgColor)!==null&&a!==void 0?a:!((d=e.selectionStyle)===null||d===void 0)&&d.cellBgColor&&typeof e.selectionStyle.cellBgColor=="string"?Li(e.selectionStyle.cellBgColor,.1):void 0)!==null&&u!==void 0?u:void 0},get inlineRowBgColor(){var o,s,l,a,d;return(d=(l=(s=(o=r.select)===null||o===void 0?void 0:o.inlineRowBgColor)!==null&&s!==void 0?s:e.selectionStyle.inlineRowBgColor)!==null&&l!==void 0?l:!((a=e.selectionStyle)===null||a===void 0)&&a.cellBgColor&&typeof e.selectionStyle.cellBgColor=="string"?Li(e.selectionStyle.cellBgColor,.1):void 0)!==null&&d!==void 0?d:void 0}}},get padding(){var o;return(o=r.padding)!==null&&o!==void 0?o:[10,16,10,16]},get textAlign(){var o;return(o=r.textAlign)!==null&&o!==void 0?o:"left"},get textBaseline(){var o;return(o=r.textBaseline)!==null&&o!==void 0?o:"middle"},get textOverflow(){var o;return(o=r.textOverflow)!==null&&o!==void 0?o:"ellipsis"},get lineHeight(){return r.lineHeight},get autoWrapText(){var o;return(o=r.autoWrapText)!==null&&o!==void 0&&o},get lineClamp(){var o;return(o=r.lineClamp)!==null&&o!==void 0?o:"auto"},get linkColor(){var o;return(o=r.linkColor)!==null&&o!==void 0?o:"#3772ff"},get cursor(){var o;return(o=r.cursor)!==null&&o!==void 0?o:"auto"},get marked(){var o;return(o=r.marked)!==null&&o!==void 0&&o},get underline(){var o;return(o=r.underline)!==null&&o!==void 0&&o},get underlineColor(){return r.underlineColor},get underlineDash(){return r.underlineDash},get underlineOffset(){return r.underlineOffset},get lineThrough(){var o;return(o=r.lineThrough)!==null&&o!==void 0&&o},get lineThroughColor(){return r.lineThroughColor},get lineThroughDash(){return r.lineThroughDash}}}return this._defaultStyle}get cornerHeaderStyle(){if(!this._cornerHeader){const{obj:e,superTheme:t}=this.internalTheme,i=Ke({},this.defaultStyle,t.cornerHeaderStyle,e.cornerHeaderStyle);this._cornerHeader=this.getStyle(i)}return this._cornerHeader}get cornerRightTopCellStyle(){if(!this._cornerRightTopCell){const{obj:e,superTheme:t}=this.internalTheme;if(!t.cornerRightTopCellStyle&&!e.cornerRightTopCellStyle)return this._cornerRightTopCell;const i=Ke({},this.defaultStyle,t.cornerRightTopCellStyle,e.cornerRightTopCellStyle);this._cornerRightTopCell=this.getStyle(i)}return this._cornerRightTopCell}get cornerLeftBottomCellStyle(){if(!this._cornerLeftBottomCell){const{obj:e,superTheme:t}=this.internalTheme;if(!t.cornerLeftBottomCellStyle&&!e.cornerLeftBottomCellStyle)return this._cornerLeftBottomCell;const i=Ke({},this.defaultStyle,t.cornerLeftBottomCellStyle,e.cornerLeftBottomCellStyle);this._cornerLeftBottomCell=this.getStyle(i)}return this._cornerLeftBottomCell}get cornerRightBottomCellStyle(){if(!this._cornerRightBottomCell){const{obj:e,superTheme:t}=this.internalTheme;if(!t.cornerRightBottomCellStyle&&!e.cornerRightBottomCellStyle)return this._cornerRightBottomCell;const i=Ke({},this.defaultStyle,t.cornerRightBottomCellStyle,e.cornerRightBottomCellStyle);this._cornerRightBottomCell=this.getStyle(i)}return this._cornerRightBottomCell}get rightFrozenStyle(){if(!this._rightFrozen){const{obj:e,superTheme:t}=this.internalTheme;if(!t.rightFrozenStyle&&!e.rightFrozenStyle)return this._rightFrozen;const i=Ke({},this.defaultStyle,this.rowHeaderStyle,t.rightFrozenStyle,e.rightFrozenStyle);this._rightFrozen=this.getStyle(i)}return this._rightFrozen}get bottomFrozenStyle(){if(!this._bottomFrozen){const{obj:e,superTheme:t}=this.internalTheme;if(!t.bottomFrozenStyle&&!e.bottomFrozenStyle)return this._bottomFrozen;const i=Ke({},this.defaultStyle,this.headerStyle,t.bottomFrozenStyle,e.bottomFrozenStyle);this._bottomFrozen=this.getStyle(i)}return this._bottomFrozen}get rowHeaderStyle(){var e;if(!this._rowHeader){const{obj:t,superTheme:i}=this.internalTheme,r=Ke({},this.defaultStyle,i.rowHeaderStyle,(e=t.rowHeaderStyle)!==null&&e!==void 0?e:this.isPivot?null:t.headerStyle);this._rowHeader=this.getStyle(r)}return this._rowHeader}get headerStyle(){if(!this._header){const{obj:e,superTheme:t}=this.internalTheme,i=Ke({},this.defaultStyle,t.headerStyle,e.headerStyle);this._header=this.getStyle(i)}return this._header}get bodyStyle(){if(!this._body){const{obj:e,superTheme:t}=this.internalTheme,i=Ke({},this.defaultStyle,t.bodyStyle,e.bodyStyle);this._body=this.getStyle(i)}return this._body}get groupTitleStyle(){if(!this._groupTitle){const{obj:e,superTheme:t}=this.internalTheme;if(!t.groupTitleStyle&&!e.groupTitleStyle)return this._groupTitle;const i=Ke({},this.defaultStyle,t.groupTitleStyle,e.groupTitleStyle);this._groupTitle=this.getStyle(i)}return this._groupTitle}get frameStyle(){if(!this._frameStyle){const{obj:e,superTheme:t}=this.internalTheme,i=Ke({},t.frameStyle,e.frameStyle);this._frameStyle={get borderColor(){return i.borderColor},get borderLineWidth(){return i.borderLineWidth},get borderLineDash(){return i.borderLineDash},get innerBorder(){return i.innerBorder},get shadowBlur(){return i.shadowBlur},get shadowColor(){return i.shadowColor},get shadowOffsetX(){return i.shadowOffsetX},get shadowOffsetY(){return i.shadowOffsetY},get cornerRadius(){return i.cornerRadius}}}return this._frameStyle}get scrollStyle(){if(!this._scroll){const{obj:e,superTheme:t}=this.internalTheme,i=Ke({},t.scrollStyle,e.scrollStyle);this._scroll={get scrollSliderColor(){var r;return(r=i.scrollSliderColor)!==null&&r!==void 0?r:"#C0C0C0"},get scrollSliderCornerRadius(){return i.scrollSliderCornerRadius},get scrollRailColor(){return i.scrollRailColor},get visible(){var r;return(r=i.visible)!==null&&r!==void 0?r:"scrolling"},get verticalVisible(){return i.verticalVisible},get horizontalVisible(){return i.horizontalVisible},get width(){var r;return(r=i.width)!==null&&r!==void 0?r:7},get hoverOn(){var r;return(r=i.hoverOn)===null||r===void 0||r},get barToSide(){var r;return(r=i.barToSide)!==null&&r!==void 0&&r},get horizontalPadding(){var r;return(r=i.horizontalPadding)!==null&&r!==void 0?r:0},get verticalPadding(){var r;return(r=i.verticalPadding)!==null&&r!==void 0?r:0}}}return this._scroll}get tooltipStyle(){if(!this._tooltip){const{obj:e,superTheme:t}=this.internalTheme,i=Ke({},t.tooltipStyle,e.tooltipStyle);this._tooltip={get fontFamily(){var r;return(r=i.fontFamily)!==null&&r!==void 0?r:Fb},get fontSize(){var r;return(r=i.fontSize)!==null&&r!==void 0?r:Lb},get bgColor(){var r;return(r=i.bgColor)!==null&&r!==void 0?r:"#000"},get padding(){var r;return(r=i.padding)!==null&&r!==void 0?r:[6,8]},get color(){var r;return(r=i.color)!==null&&r!==void 0?r:"#FFF"},get maxWidth(){return i.maxWidth},get maxHeight(){return i.maxHeight}}}return this._tooltip}get columnResize(){if(!this._columnResize){const{obj:e,superTheme:t}=this.internalTheme,i=Ke({},t.columnResize,e.columnResize);this._columnResize={get lineColor(){var r;return(r=i.lineColor)!==null&&r!==void 0?r:"#416EFF"},get bgColor(){var r;return(r=i.bgColor)!==null&&r!==void 0?r:"#D9E2FF"},get lineWidth(){var r;return(r=i.lineWidth)!==null&&r!==void 0?r:1},get width(){var r;return(r=i.width)!==null&&r!==void 0?r:i.lineWidth+2},get resizeHotSpotSize(){var r;return(r=i.resizeHotSpotSize)!==null&&r!==void 0?r:16},get labelColor(){var r;return(r=i.labelColor)!==null&&r!==void 0?r:"#FFF"},get labelFontSize(){var r;return(r=i.labelFontSize)!==null&&r!==void 0?r:10},get labelFontFamily(){var r;return(r=i.labelFontFamily)!==null&&r!==void 0?r:"sans-serif"},get labelBackgroundFill(){var r;return(r=i.labelBackgroundFill)!==null&&r!==void 0?r:"#3073F2"},get labelBackgroundCornerRadius(){var r;return(r=i.labelBackgroundCornerRadius)!==null&&r!==void 0?r:5},get labelVisible(){var r;return(r=i.labelVisible)===null||r===void 0||r},get visibleOnHover(){var r;return(r=i.visibleOnHover)!==null&&r!==void 0&&r}}}return this._columnResize}get dragHeaderSplitLine(){if(!this._dragHeaderSplitLine){const{obj:e,superTheme:t}=this.internalTheme,i=Ke({},t.dragHeaderSplitLine,e.dragHeaderSplitLine);this._dragHeaderSplitLine={get lineColor(){var r;return(r=i.lineColor)!==null&&r!==void 0?r:"blue"},get lineWidth(){var r;return(r=i.lineWidth)!==null&&r!==void 0?r:2},get shadowBlockColor(){var r;return(r=i.shadowBlockColor)!==null&&r!==void 0?r:"rgba(204,204,204,0.3)"}}}return this._dragHeaderSplitLine}get frozenColumnLine(){if(!this._frozenColumnLine){const{obj:e,superTheme:t}=this.internalTheme,i=Ke({},t.frozenColumnLine,e.frozenColumnLine);this._frozenColumnLine={get shadow(){if(i.shadow)return{get width(){var r,o;return(o=(r=i.shadow)===null||r===void 0?void 0:r.width)!==null&&o!==void 0?o:24},get startColor(){var r,o;return(o=(r=i.shadow)===null||r===void 0?void 0:r.startColor)!==null&&o!==void 0?o:"rgba(00, 24, 47, 0.06)"},get endColor(){var r,o;return(o=(r=i.shadow)===null||r===void 0?void 0:r.endColor)!==null&&o!==void 0?o:"rgba(00, 24, 47, 0)"}}},get border(){if(i.border)return{get lineColor(){var r,o;return(o=(r=i.border)===null||r===void 0?void 0:r.lineColor)!==null&&o!==void 0?o:"rgba(00, 24, 47, 0.06)"},get bgColor(){var r,o,s,l;return(l=(o=(r=i.border)===null||r===void 0?void 0:r.bgColor)!==null&&o!==void 0?o:(s=i.border)===null||s===void 0?void 0:s.lineColor)!==null&&l!==void 0?l:"rgba(00, 24, 47, 0.06)"},get lineWidth(){var r,o;return(o=(r=i.border)===null||r===void 0?void 0:r.lineWidth)!==null&&o!==void 0?o:4},get width(){var r,o,s,l;return(l=(o=(r=i.border)===null||r===void 0?void 0:r.width)!==null&&o!==void 0?o:(s=i.border)===null||s===void 0?void 0:s.lineWidth)!==null&&l!==void 0?l:4}}}}}return this._frozenColumnLine}get selectionStyle(){if(!this._selectionStyle){const{obj:e,superTheme:t}=this.internalTheme,i=Ke({},t.selectionStyle,e.selectionStyle);this._selectionStyle={get cellBgColor(){var r;return(r=i==null?void 0:i.cellBgColor)!==null&&r!==void 0?r:"rgba(0, 0, 255,0.1)"},get cellBorderColor(){var r;return(r=i==null?void 0:i.cellBorderColor)!==null&&r!==void 0?r:"#3073f2"},get cellBorderLineWidth(){var r;return(r=i==null?void 0:i.cellBorderLineWidth)!==null&&r!==void 0?r:2},get inlineColumnBgColor(){return i==null?void 0:i.inlineColumnBgColor},get inlineRowBgColor(){return i==null?void 0:i.inlineRowBgColor},get selectionFillMode(){var r;return(r=i==null?void 0:i.selectionFillMode)!==null&&r!==void 0?r:"overlay"}}}return this._selectionStyle}get axisStyle(){if(!this._axisStyle){const{obj:e,superTheme:t}=this.internalTheme,i=Ke({},t.axisStyle,e.axisStyle);this._axisStyle=Q2(i)}return this._axisStyle}get checkboxStyle(){if(!this._checkboxStyle){const{obj:e,superTheme:t}=this.internalTheme,i=Ke({},t.checkboxStyle,e.checkboxStyle);this._checkboxStyle=i}return this._checkboxStyle}get radioStyle(){if(!this._radioStyle){const{obj:e,superTheme:t}=this.internalTheme,i=Ke({},t.radioStyle,e.radioStyle);this._radioStyle=i}return this._radioStyle}get switchStyle(){if(!this._switchStyle){const{obj:e,superTheme:t}=this.internalTheme,i=Ke({},t.switchStyle,e.switchStyle);this._switchStyle=i}return this._switchStyle}get buttonStyle(){if(!this._buttonStyle){const{obj:e,superTheme:t}=this.internalTheme,i=Ke({},t.buttonStyle,e.buttonStyle);this._buttonStyle=i}return this._buttonStyle}get textPopTipStyle(){if(!this._textPopTipStyle){const{obj:e,superTheme:t}=this.internalTheme,i=Ke({},eH,t.textPopTipStyle,e.textPopTipStyle);this._textPopTipStyle=i}return this._textPopTipStyle}get functionalIconsStyle(){if(!this._internalIconsStyle){const{obj:e,superTheme:t}=this.internalTheme,i=Ke({},t.functionalIconsStyle,e.functionalIconsStyle);this._internalIconsStyle=i}return this._internalIconsStyle}hasProperty(e){const{obj:t,superTheme:i}=this.internalTheme;return zb(t,e)||zb(i,e)}extends(e){return new hn(Ke({},e),Ke(this.internalTheme.superTheme,this.internalTheme.obj))}getStyle(e){const t=this;return{get fontSize(){return e.fontSize},get fontFamily(){return e.fontFamily},get fontWeight(){return e.fontWeight},get fontVariant(){return e.fontVariant},get fontStyle(){return e.fontStyle},get bgColor(){return e.bgColor},get color(){return e.color},get strokeColor(){return e.strokeColor},get borderColor(){return e.borderColor},get borderLineWidth(){return e.borderLineWidth},get borderLineDash(){return e.borderLineDash},get hover(){if(e.hover)return{get cellBgColor(){var i,r;return(r=(i=e.hover)===null||i===void 0?void 0:i.cellBgColor)!==null&&r!==void 0?r:void 0},get inlineColumnBgColor(){var i,r,o,s,l,a;return(a=(r=(i=e.hover)===null||i===void 0?void 0:i.inlineColumnBgColor)!==null&&r!==void 0?r:!((o=e.hover)===null||o===void 0)&&o.cellBgColor&&typeof((s=e.hover)===null||s===void 0?void 0:s.cellBgColor)=="string"?Li((l=e.hover)===null||l===void 0?void 0:l.cellBgColor,.1):void 0)!==null&&a!==void 0?a:void 0},get inlineRowBgColor(){var i,r,o,s,l,a;return(a=(r=(i=e.hover)===null||i===void 0?void 0:i.inlineRowBgColor)!==null&&r!==void 0?r:!((o=e.hover)===null||o===void 0)&&o.cellBgColor&&typeof((s=e.hover)===null||s===void 0?void 0:s.cellBgColor)=="string"?Li((l=e.hover)===null||l===void 0?void 0:l.cellBgColor,.1):void 0)!==null&&a!==void 0?a:void 0}}},get select(){return{get inlineColumnBgColor(){var i,r,o,s,l,a;return(a=(s=(r=(i=e.select)===null||i===void 0?void 0:i.inlineColumnBgColor)!==null&&r!==void 0?r:(o=t.selectionStyle)===null||o===void 0?void 0:o.inlineColumnBgColor)!==null&&s!==void 0?s:!((l=t.selectionStyle)===null||l===void 0)&&l.cellBgColor&&typeof t.selectionStyle.cellBgColor=="string"?Li(t.selectionStyle.cellBgColor,.1):void 0)!==null&&a!==void 0?a:void 0},get inlineRowBgColor(){var i,r,o,s,l;return(l=(o=(r=(i=e.select)===null||i===void 0?void 0:i.inlineRowBgColor)!==null&&r!==void 0?r:t.selectionStyle.inlineRowBgColor)!==null&&o!==void 0?o:!((s=t.selectionStyle)===null||s===void 0)&&s.cellBgColor&&typeof t.selectionStyle.cellBgColor=="string"?Li(t.selectionStyle.cellBgColor,.1):void 0)!==null&&l!==void 0?l:void 0},get cellBgColor(){var i,r,o;if(t.selectionStyle.selectionFillMode==="replace")return(o=(r=(i=e.select)===null||i===void 0?void 0:i.cellBgColor)!==null&&r!==void 0?r:t.selectionStyle.cellBgColor)!==null&&o!==void 0?o:void 0}}},get frameStyle(){if(e.frameStyle)return{get borderColor(){var i,r;return(r=(i=e.frameStyle)===null||i===void 0?void 0:i.borderColor)!==null&&r!==void 0?r:void 0},get borderLineWidth(){var i,r;return(r=(i=e.frameStyle)===null||i===void 0?void 0:i.borderLineWidth)!==null&&r!==void 0?r:void 0},get borderLineDash(){var i,r;return(r=(i=e.frameStyle)===null||i===void 0?void 0:i.borderLineDash)!==null&&r!==void 0?r:void 0}}},get padding(){return e.padding},get textAlign(){return e.textAlign},get textBaseline(){return e.textBaseline},get textOverflow(){return e.textOverflow},get lineHeight(){return e.lineHeight},get autoWrapText(){return e.autoWrapText},get lineClamp(){return e.lineClamp},get linkColor(){return e.linkColor},get cursor(){return e.cursor},get textStick(){return e.textStick},get marked(){return e.marked},get underline(){var i;return(i=e.underline)!==null&&i!==void 0&&i},get underlineColor(){return e.underlineColor},get underlineDash(){return e.underlineDash},get underlineOffset(){return e.underlineOffset},get lineThrough(){var i;return(i=e.lineThrough)!==null&&i!==void 0&&i},get lineThroughColor(){return e.lineThroughColor},get lineThroughDash(){return e.lineThroughDash}}}}function zb(n,e){if(n instanceof hn)return n.hasProperty(e);let t=n;if(!t)return!1;for(let i=0;i<e.length;i++)if(t=t[e[i]],!t)return!1;return!!t}const kw=new hn(Tb,Tb),Ew=new hn(Pb,Pb),Lw=new hn(Hb,Hb),Fw=new hn(kb,kb),zw=new hn(Eb,Eb),tH={DEFAULT:Fw,SIMPLIFY:zw,ARCO:Lw,DARK:kw,BRIGHT:Ew},nH={TableTheme:hn};function iH(n){if(!n)return null;if(typeof n=="string"){const e=A2(Iw(),n);return e?e instanceof hn?e:new hn(e,e):null}return n instanceof hn?n:new hn(n,n)}function Iw(){return ul(tH,j2)}const Fi={DARK:kw,BRIGHT:Ew,ARCO:Lw,DEFAULT:Fw,SIMPLIFY:zw,theme:nH,of:iH,get:Iw};function at(n,e,t){var i;if(n.internalProps.customMergeCell){const o=n.getCustomMerge(e,t);if(o)return o.range}if(!n.internalProps.enableTreeNodeMerge&&!n.isHeader(e,t)&&!(!((i=n.getBodyColumnDefine(e,t))===null||i===void 0)&&i.mergeCell))return!1;const r=n.getCellRange(e,t);return!(r.start.col===r.end.col&&r.start.row===r.end.row)&&r}class ue{static registerComponent(e,t){ue._components[e]=t}static getComponent(e){return ue._components[e]}static registerFunction(e,t){ue._functions[e]=t}static getFunction(e){return ue._functions[e]}static registerCellType(e,t){ue._cellTypes[e]=t}static getCellType(e){return ue._cellTypes[e]}}ue._components={},ue._functions={},ue._cellTypes={};function rH(n,e){const t=new Array(e);for(let i=0;i<e;i++)t[i]=n(i);return t}function oH(n,e,t,i,r,o){const s=rH(n,t);s.sort((l,a)=>i(o(l),o(a),r));for(let l=0;l<t;l++)e(l,s[l])}function sH(n){if(Pw.isObject(n)){const e=n;if(O(e.get)&&O(e.set))return!0}return!1}const Wl={SOURCE_LENGTH_UPDATE:"source_length_update",CHANGE_ORDER:"change_order"};function ji(n,e){const t=ze(n);if(Un(t)){const i=t.then(r=>(e(r),r));return e(i),i}return t}function dd(n,e,t,i,r,o){if(n==null)return;if(Un(n))return n.then(a=>dd(a,e,t,i,r,o));const s=sH(e)?e.get:e;if(ke(n)&&s in n)return ji(n[s],o);if(typeof s=="function")return ji(s(n,t,i,r),o);if(Array.isArray(s))return ji(C2(n,[...s]),o);const l=`${s}`.split(".");return l.length<=1?ji(n[s],o):ji(Mw(n,(a,d)=>dd(a,d,t,i,r,k2),...l),o)}function Ur(n,e){if(!n)return e;const t=n[e];return O(t)?t:e}class Er extends bu{static get EVENT_TYPE(){return Wl}constructor(e,t,i,r,o,s){var l;super(),this.currentIndexedData=[],this.hierarchyExpandLevel=0,this.hasHierarchyStateExpand=!1,this.beforeChangedRecordsMap=new Map,this.registedAggregators={},this.rowHierarchyType="grid",this.fieldAggregators=[],this.registerAggregators(),this.dataSourceObj=e,this.dataConfig=t,this._get=e==null?void 0:e.get,this.columns=r,this._source=e!=null&&e.records?this.processRecords(e==null?void 0:e.records):e,this._sourceLength=((l=this._source)===null||l===void 0?void 0:l.length)||0,this.sortedIndexMap=new Map,this._currentPagerIndexedData=[],this.userPagination=i,this.pagination=i||{totalCount:this._sourceLength,perPageCount:this._sourceLength,currentPage:0},s>=1&&(this.hierarchyExpandLevel=s),this.currentIndexedData=Array.from({length:this._sourceLength},(a,d)=>d),o==="tree"&&this.initTreeHierarchyState(),this.rowHierarchyType=o,this.updatePagerData()}initTreeHierarchyState(){var e;this.currentIndexedData=Array.from({length:this._sourceLength},(i,r)=>r);let t=this._sourceLength;for(let i=0;i<t;i++){const r=this.currentIndexedData[i],o=this.getOriginalRecord(r),s=(e=o.filteredChildren)!==null&&e!==void 0?e:o.children;if((s==null?void 0:s.length)>0){if(this.hierarchyExpandLevel>1?!o.hierarchyState&&(o.hierarchyState=be.expand):!o.hierarchyState&&(o.hierarchyState=be.collapse),this.hasHierarchyStateExpand=!0,o.hierarchyState===be.collapse)continue;const l=this.initChildrenNodeHierarchy(r,this.hierarchyExpandLevel,2,o);i+=l,t+=l}else o.children===!0&&!o.hierarchyState&&(o.hierarchyState=be.collapse)}}supplementConfig(e,t,i,r){var o;this.columns=t,this._sourceLength=((o=this._source)===null||o===void 0?void 0:o.length)||0,this.sortedIndexMap=new Map,this._currentPagerIndexedData=[],this.userPagination=e,this.pagination=e||{totalCount:this._sourceLength,perPageCount:this._sourceLength,currentPage:0},r>=1&&(this.hierarchyExpandLevel=r),this.currentIndexedData=Array.from({length:this._sourceLength},(s,l)=>l),i==="tree"&&this.initTreeHierarchyState(),this.rowHierarchyType=i,this.updatePagerData()}registerAggregator(e,t){this.registedAggregators[e]=t}registerAggregators(){this.registerAggregator(Je.RECORD,YP),this.registerAggregator(Je.SUM,ZP),this.registerAggregator(Je.COUNT,JP),this.registerAggregator(Je.MAX,e2),this.registerAggregator(Je.MIN,t2),this.registerAggregator(Je.AVG,QP),this.registerAggregator(Je.NONE,XP),this.registerAggregator(Je.CUSTOM,qP)}updateColumns(e){this.columns=e}_generateFieldAggragations(){const e=this.columns;this.fieldAggregators=[];const t=r=>{delete r.vtable_aggregator;const o=r.field,s=r.aggregation;if(s)if(Array.isArray(s))for(const l of s){const a=new this.registedAggregators[l.aggregationType]({field:o,formatFun:l.formatFun,isRecord:!0,aggregationFun:l.aggregationFun});this.fieldAggregators.push(a),r.vtable_aggregator||(r.vtable_aggregator=[]),r.vtable_aggregator.push(a)}else{const l=new this.registedAggregators[s.aggregationType]({field:o,formatFun:s.formatFun,isRecord:!0,aggregationFun:s.aggregationFun});this.fieldAggregators.push(l),r.vtable_aggregator=l}},i=r=>{if(r&&r.length!==0)for(const o of r)t(o),o.columns&&i(o.columns)};i(e)}processRecords(e){var t,i,r,o,s,l,a,d;this._generateFieldAggragations();const u=[],h=this.fieldAggregators.length>=1;if(((i=(t=this.dataConfig)===null||t===void 0?void 0:t.filterRules)===null||i===void 0?void 0:i.length)>=1||((r=this.lastFilterRules)===null||r===void 0?void 0:r.length)>=1||h){for(let c=0,g=e.length;c<g;c++){const f=e[c];((s=(o=this.dataConfig)===null||o===void 0?void 0:o.filterRules)===null||s===void 0?void 0:s.length)>=1?this.filterRecord(f)&&(u.push(f),this.rowHierarchyType==="tree"&&f.children&&(f.filteredChildren=this.filteredChildren(f.children)),h&&this.processRecord(f)):((l=this.lastFilterRules)===null||l===void 0?void 0:l.length)>=1?(this.clearFilteredChildren(f),h&&this.processRecord(f)):h&&this.processRecord(f)}if(((d=(a=this.dataConfig)===null||a===void 0?void 0:a.filterRules)===null||d===void 0?void 0:d.length)>=1)return u}return e}filteredChildren(e){const t=[];for(let i=0,r=e.length;i<r;i++){const o=e[i];this.filterRecord(o)&&(t.push(o),o.children&&(o.filteredChildren=this.filteredChildren(o.children)))}return t}processRecord(e){for(let t=0;t<this.fieldAggregators.length;t++)this.fieldAggregators[t].push(e)}initChildrenNodeHierarchy(e,t,i,r){var o,s,l;let a=0;const d=r.filteredChildren?r.filteredChildren.length:(s=(o=r.children)===null||o===void 0?void 0:o.length)!==null&&s!==void 0?s:0;for(let u=0;u<d;u++){(i<=t||r.hierarchyState===be.expand)&&(a+=1);const h=r.filteredChildren?r.filteredChildren[u]:r.children[u],c=Array.isArray(e)?e.concat(u):[e,u];(i<=t||r.hierarchyState===be.expand)&&this.currentIndexedData.splice(this.currentIndexedData.indexOf(e)+a,0,c),(h.filteredChildren?h.filteredChildren.length>0:((l=h.children)===null||l===void 0?void 0:l.length)>0)&&(i<t||h.hierarchyState===be.expand?(!h.hierarchyState&&(h.hierarchyState=be.expand),this.hasHierarchyStateExpand=!0):!h.hierarchyState&&(h.hierarchyState=be.collapse)),h.hierarchyState===be.expand&&(a+=this.initChildrenNodeHierarchy(c,t,i+1,h)),h.children===!0&&!h.hierarchyState&&(h.hierarchyState=be.collapse)}return a}updatePagination(e){this.pagination=e||{totalCount:this._sourceLength,perPageCount:this._sourceLength,currentPage:0},this.updatePagerData()}updatePagerData(){const{currentIndexedData:e}=this,{perPageCount:t,currentPage:i}=this.pagination,r=t*(i||0),o=r+t;if(this._currentPagerIndexedData.length=0,e&&e.length>0){let s=-1;for(let l=0;l<e.length;l++)if((Array.isArray(e[l])&&e[l].length===1||!Array.isArray(e[l]))&&s++,s>=r&&s<o)this._currentPagerIndexedData.push(e[l]);else if(s>=o)break}else if(this._sourceLength>0)throw new Error("currentIndexedData should has values!")}getRecordIndexPaths(e){return this._currentPagerIndexedData[e]}get records(){return Array.isArray(this._source)?this._source:[]}get source(){return this._source}get(e){return this.getOriginalRecord(Ur(this.currentPagerIndexedData,e))}getRaw(e){return this.getRawRecord(Ur(this.currentPagerIndexedData,e))}getIndexKey(e){return Ur(this.currentPagerIndexedData,e)}getTableIndex(e){return Array.isArray(e)?this.rowHierarchyType==="tree"?this.currentPagerIndexedData.findIndex(t=>os(t,e)):this.currentPagerIndexedData.findIndex(t=>t===e[0]):this.currentPagerIndexedData.findIndex(t=>t===e)}getField(e,t,i,r,o){return this.getOriginalField(Ur(this.currentPagerIndexedData,e),t,i,r,o)}getRawField(e,t,i,r,o){return this.getRawFieldData(Ur(this.currentPagerIndexedData,e),t,i,r,o)}hasField(e,t){return this.hasOriginalField(Ur(this.currentPagerIndexedData,e),t)}getHierarchyState(e){var t;const i=this.getOriginalRecord(this.currentPagerIndexedData[e]);if(i!=null&&i.hierarchyState){const r=i.hierarchyState;if(((t=i.children)===null||t===void 0?void 0:t.length)>0||i.children===!0)return r}return null}toggleHierarchyState(e,t,i){const r=this.currentIndexedData.slice(0),o=this.getIndexKey(e),s=this.getHierarchyState(e),l=this.getOriginalRecord(o);if(this.clearSortedIndexMap(),s===be.collapse)l.hierarchyState=be.expand,this.pushChildrenNode(o,be.expand,l),this.hasHierarchyStateExpand=!0;else if(s===be.expand){let u=0;const h=(c,g,f)=>{if(!g||g===be.collapse||g===be.none)return;const p=f.filteredChildren?f.filteredChildren:f.children;if(p)for(let m=0;m<p.length;m++){u+=1;const b=Array.isArray(c)?c.concat([m]):[c,m];h(b,p[m].hierarchyState,p[m])}};h(o,s,l),this.currentIndexedData.splice(this.currentIndexedData.indexOf(o)+1,u),l.hierarchyState=be.collapse}this.updatePagerData();const a=[],d=[];if(s===be.collapse){const u=this.currentIndexedData.length-r.length;for(let h=0;h<u;h++)a.push(e+h+1)}else if(s===be.expand){const u=r.length-this.currentIndexedData.length;for(let h=0;h<u;h++)d.push(e+h+1)}return{add:a,remove:d}}pushChildrenNode(e,t,i){var r,o;if(!t||t===be.collapse||t===be.none)return 0;let s=0;const l=i.filteredChildren?i.filteredChildren:i.children;if(l){const a=Array.from({length:l.length},(d,u)=>u);(r=this.lastSortStates)===null||r===void 0||r.forEach(d=>{d.order!=="normal"&&oH(u=>O(a[u])?a[u]:a[u]=u,(u,h)=>{a[u]=h},l.length,d.orderFn,d.order,u=>this.getOriginalField(Array.isArray(e)?e.concat([u]):[e,u],d.field))});for(let d=0;d<a.length;d++){s+=1;const u=Array.isArray(e)?e.concat([a[d]]):[e,a[d]];this.currentIndexedData.splice(this.currentIndexedData.indexOf(e)+s,0,u);const h=this.getOriginalRecord(u);!h.hierarchyState&&((o=h.filteredChildren)!==null&&o!==void 0?o:h.children)&&(h.hierarchyState=be.collapse),s+=this.pushChildrenNode(u,h.hierarchyState,l[a[d]])}}return s}changeFieldValue(e,t,i,r,o,s){var l;if(i!==null&&t>=0){const a=this.getIndexKey(t);if(this.cacheBeforeChangedRecord(a,s),typeof i=="string"||typeof i=="number"){const d=(l=this.beforeChangedRecordsMap.get(a.toString()))===null||l===void 0?void 0:l[i],u=this.getOriginalRecord(a);let h=e;typeof d=="number"&&_2(e)&&(h=parseFloat(e)),Un(u)?u.then(c=>{c[i]=h}).catch(c=>{}):u?u[i]=h:(this.records[a]={},this.records[a][i]=h)}}}cacheBeforeChangedRecord(e,t){var i;if(!this.beforeChangedRecordsMap.has(e.toString())){const r=this.getOriginalRecord(e);this.beforeChangedRecordsMap.set(e.toString(),(i=Or(r,void 0,["vtable_gantt_linkedFrom","vtable_gantt_linkedTo"]))!==null&&i!==void 0?i:{})}}setRecord(e,t){var i,r;let o=!0;if(((r=(i=this.dataConfig)===null||i===void 0?void 0:i.filterRules)===null||r===void 0?void 0:r.length)>=1&&(this.filterRecord(e)?this.rowHierarchyType==="tree"&&e.children&&(e.filteredChildren=this.filteredChildren(e.children)):o=!1),o&&Array.isArray(this.records)){const s=this.getIndexKey(t);Array.isArray(s)||this.records.splice(s,1,e)}}addRecord(e,t){var i;if(Array.isArray(this.records)){this.records.splice(t,0,e),this.adjustBeforeChangedRecordsMap(t,1),this.currentIndexedData.push(this.currentIndexedData.length),this._sourceLength+=1;for(let r=0;r<this.fieldAggregators.length;r++)this.fieldAggregators[r].push(e);if(this.rowHierarchyType==="tree"&&this.initTreeHierarchyState(),this.userPagination){this.pagination.totalCount=this._sourceLength;const{perPageCount:r,currentPage:o}=this.pagination;t<r*(o||0)+r&&this.updatePagerData()}else this.pagination.perPageCount=this._sourceLength,this.pagination.totalCount=this._sourceLength,this.updatePagerData();!((i=this.dataSourceObj)===null||i===void 0)&&i.added&&this.dataSourceObj.added(t,1)}}addRecords(e,t){var i;if(Array.isArray(this.records)){if(Array.isArray(e)){this.records.splice(t,0,...e),this.adjustBeforeChangedRecordsMap(t,e.length);for(let r=0;r<e.length;r++)this.currentIndexedData.push(this.currentIndexedData.length);this._sourceLength+=e.length;for(let r=0;r<this.fieldAggregators.length;r++)for(let o=0;o<e.length;o++)this.fieldAggregators[r].push(e[o])}if(this.userPagination){this.pagination.totalCount=this._sourceLength;const{perPageCount:r,currentPage:o}=this.pagination;t<r*(o||0)+r&&this.updatePagerData()}else this.pagination.perPageCount=this._sourceLength,this.pagination.totalCount=this._sourceLength,this.updatePagerData();!((i=this.dataSourceObj)===null||i===void 0)&&i.added&&this.dataSourceObj.added(t,e.length)}}addRecordForSorted(e){Array.isArray(this.records)&&(this.beforeChangedRecordsMap.clear(),this.records.push(e),this.currentIndexedData.push(this.currentIndexedData.length),this._sourceLength+=1,this.sortedIndexMap.clear(),this.userPagination||(this.pagination.perPageCount=this._sourceLength,this.pagination.totalCount=this._sourceLength))}addRecordsForSorted(e){if(Array.isArray(this.records)){if(this.beforeChangedRecordsMap.clear(),Array.isArray(e)){this.records.push(...e);for(let t=0;t<e.length;t++)this.currentIndexedData.push(this.currentIndexedData.length);this._sourceLength+=e.length,this.sortedIndexMap.clear()}this.userPagination||(this.pagination.perPageCount=this._sourceLength,this.pagination.totalCount=this._sourceLength)}}adjustBeforeChangedRecordsMap(e,t,i="add"){for(let r=this.beforeChangedRecordsMap.size-1;r>=e;r--){const o=this.beforeChangedRecordsMap.get(r.toString());this.beforeChangedRecordsMap.delete(r.toString()),this.beforeChangedRecordsMap.set((r+(i==="add"?t:-t)).toString(),o)}}deleteRecords(e){var t;if(Array.isArray(this.records)){const i=[],r=e.sort((o,s)=>s-o);for(let o=0;o<r.length;o++){const s=r[o];if(s>=this._sourceLength||s<0)continue;this.adjustBeforeChangedRecordsMap(s,1,"delete"),i.push(s);const l=this.records[s];for(let a=0;a<this.fieldAggregators.length;a++)this.fieldAggregators[a].deleteRecord(l);this.records.splice(s,1),this.currentIndexedData.pop(),this._sourceLength-=1}return this.userPagination||(this.pagination.perPageCount=this._sourceLength,this.pagination.totalCount=this._sourceLength),this.updatePagerData(),!((t=this.dataSourceObj)===null||t===void 0)&&t.deleted&&this.dataSourceObj.deleted(i),i}return[]}deleteRecordsForSorted(e){if(Array.isArray(this.records)){const t=e.sort((i,r)=>r-i);for(let i=0;i<t.length;i++){const r=t[i];if(r>=this._sourceLength||r<0)continue;const o=this.currentIndexedData[r];this.records.splice(o,1),this._sourceLength-=1}this.sortedIndexMap.clear(),this.userPagination||(this.pagination.perPageCount=this._sourceLength,this.pagination.totalCount=this._sourceLength),this.beforeChangedRecordsMap.clear()}}updateRecords(e,t){const i=[];for(let r=0;r<t.length;r++){const o=t[r];if(Array.isArray(o))this.beforeChangedRecordsMap.delete(o.toString()),i.push(o),o.slice(0,-1).reduce((s,l)=>(s[l]===void 0&&(s[l]={}),s[l].children),this.records)[o[o.length-1]]=e[r];else{if(o>=this._sourceLength||o<0)continue;this.beforeChangedRecordsMap.delete(o.toString()),i.push(o);for(let s=0;s<this.fieldAggregators.length;s++)this.fieldAggregators[s].updateRecord(this.records[o],e[r]);this.records[o]=e[r]}}return this.userPagination&&this.updatePagerData(),i}updateRecordsForSorted(e,t){for(let i=0;i<t.length;i++){const r=t[i];if(r>=this._sourceLength||r<0)continue;const o=this.currentIndexedData[r];if(typeof o!="number")return;this.beforeChangedRecordsMap.delete(o.toString()),this.records[o]=e[i]}this.sortedIndexMap.clear()}sort(e){e=(Array.isArray(e)?e:[e]).filter(o=>{const s=this.columns.find(l=>l.field===o.field);return(s==null?void 0:s.sort)!==!1&&o.order!=="normal"}),this.lastSortStates=e;let t=e.map(o=>this.sortedIndexMap.get(o==null?void 0:o.field)||{asc:[],desc:[],normal:[]}),i=null;if(t.length>0&&(i=e.reduce((o,s,l)=>{var a;const d=(a=t[l])===null||a===void 0?void 0:a[s.order];return d&&d.length>0?d:o},null),i&&i.length>0))return this.currentIndexedData=i,this.updatePagerData(),void this.fireListeners(Wl.CHANGE_ORDER,null);const r=Array.from({length:this._sourceLength},(o,s)=>s);if(r.sort((o,s)=>e.reduce((l,a)=>l!==0?l:(a.orderFn||(a.order!=="desc"?(d,u)=>d===u?0:d>u?1:-1:(d,u)=>d===u?0:d<u?1:-1))(this.getOriginalField(o,a.field),this.getOriginalField(s,a.field),a.order),0)),this.currentIndexedData=r,this.hierarchyExpandLevel){let o=r.length;for(let s=0;s<o;s++){const l=this.getOriginalRecord(r[s]),a=this.pushChildrenNode(r[s],l.hierarchyState,this.getOriginalRecord(r[s]));o+=a,s+=a}}if(!t.length){t=e.map(()=>({asc:[],desc:[],normal:[]}));for(let o=0;o<e.length;o++)this.sortedIndexMap.set(e[o].field,t[o])}e.forEach((o,s)=>{t[s][o.order]=r.slice()}),this.updatePagerData(),this.fireListeners(Wl.CHANGE_ORDER,null)}setSortedIndexMap(e,t){this.sortedIndexMap.set(e,t)}clearFilteredChildren(e){var t,i;e.filteredChildren=void 0;for(let r=0;r<((i=(t=e.children)===null||t===void 0?void 0:t.length)!==null&&i!==void 0?i:0);r++)this.clearFilteredChildren(e.children[r])}filterRecord(e){var t,i,r;let o=!0;for(let s=0;s<((t=this.dataConfig.filterRules)===null||t===void 0?void 0:t.length);s++){const l=(i=this.dataConfig)===null||i===void 0?void 0:i.filterRules[s];if(l.filterKey){const a=e[l.filterKey];if(l.filteredValues.indexOf(a)===-1){o=!1;break}}else if(!(!((r=l.filterFunc)===null||r===void 0)&&r.call(l,e))){o=!1;break}}return o}updateFilterRulesForSorted(e){var t,i,r;this.lastFilterRules=this.dataConfig.filterRules,this.dataConfig.filterRules=e,this._source=this.processRecords((i=(t=this.dataSourceObj)===null||t===void 0?void 0:t.records)!==null&&i!==void 0?i:this.dataSourceObj),this._sourceLength=((r=this._source)===null||r===void 0?void 0:r.length)||0,this.sortedIndexMap.clear(),this.currentIndexedData=Array.from({length:this._sourceLength},(o,s)=>s),this.userPagination||(this.pagination.perPageCount=this._sourceLength,this.pagination.totalCount=this._sourceLength)}updateFilterRules(e){var t,i,r;this.lastFilterRules=this.dataConfig.filterRules,this.dataConfig.filterRules=e,this._source=this.processRecords((i=(t=this.dataSourceObj)===null||t===void 0?void 0:t.records)!==null&&i!==void 0?i:this.dataSourceObj),this._sourceLength=((r=this._source)===null||r===void 0?void 0:r.length)||0,this.currentIndexedData=Array.from({length:this._sourceLength},(o,s)=>s),this.userPagination||(this.pagination.perPageCount=this._sourceLength,this.pagination.totalCount=this._sourceLength,this.rowHierarchyType==="tree"&&this.initTreeHierarchyState()),this.updatePagerData()}clearSortedIndexMap(){this.lastSortStates&&this.lastSortStates.length>0&&this.sortedIndexMap.forEach((e,t)=>{this.lastSortStates.some(i=>i.field===t)?this.lastSortStates.forEach(i=>{i.order==="asc"?(e.desc=[],e.normal=[]):i.order==="desc"?(e.asc=[],e.normal=[]):(e.asc=[],e.desc=[])}):this.sortedIndexMap.delete(t)})}get sourceLength(){return this._sourceLength}set sourceLength(e){this._sourceLength!==e&&(this._sourceLength=e,this.fireListeners(Wl.SOURCE_LENGTH_UPDATE,this._sourceLength))}get length(){return this.currentPagerIndexedData.length}get dataSource(){return this}get currentPagerIndexedData(){return this._currentPagerIndexedData.length>0?this._currentPagerIndexedData:[]}release(){var e;(e=super.release)===null||e===void 0||e.call(this),this.lastFilterRules=null}clearSortedMap(){this.currentIndexedData&&(this.currentIndexedData.length=0),this.currentIndexedData=null,this.sortedIndexMap.forEach(e=>{e.asc&&(e.asc.length=0),e.desc&&(e.desc.length=0)}),this.sortedIndexMap.clear()}clearCurrentIndexedData(){this.currentIndexedData=null,this.currentPagerIndexedData.length=0}getOriginalRecord(e){let t;return t=this.dataSourceObj.records?Array.isArray(e)?Vc(this.records,e):this.records[e]:this._get(e),ji(t,i=>{this.recordPromiseCallBack(e,i)})}getRawRecord(e){var t,i;if(!((t=this.beforeChangedRecordsMap)===null||t===void 0)&&t.has(e.toString()))return(i=this.beforeChangedRecordsMap)===null||i===void 0?void 0:i.get(e.toString());let r;return r=this.dataSourceObj.records?Array.isArray(e)?Vc(this.records,e):this.records[e]:this._get(e),ji(r,o=>{this.recordPromiseCallBack(e,o)})}getOriginalField(e,t,i,r,o){if(t!==null)return dd(this.getOriginalRecord(e),t,i,r,o,s=>{this.fieldPromiseCallBack(e,t,s)})}getRawFieldData(e,t,i,r,o){if(t!==null)return dd(this.getRawRecord(e),t,i,r,o,s=>{this.fieldPromiseCallBack(e,t,s)})}hasOriginalField(e,t){if(t===null)return!1;if(typeof t=="function")return!0;const i=this.getOriginalRecord(e);return!!(i&&t in i)}fieldPromiseCallBack(e,t,i){}recordPromiseCallBack(e,t){}canChangeOrder(e,t){var i;if(!((i=this.dataSourceObj)===null||i===void 0)&&i.canChangeOrder)return this.dataSourceObj.canChangeOrder(e,t);if(this.hasHierarchyStateExpand){let r=this.currentPagerIndexedData[e],o=this.currentPagerIndexedData[t];if(r=Array.isArray(r)?[...r]:[r],o=Array.isArray(o)?[...o]:[o],t>e&&o.length>r.length){let s=this.currentPagerIndexedData[t+1];s=Array.isArray(s)?[...s]:[s],s.length<o.length&&o.splice(o.length-1,1)}if(r.length===o.length){for(let s=0;s<=r.length-2;s++)if(r[s]!==o[s])return!1;return!0}return!1}return!0}changeOrder(e,t){var i,r,o;if(!((i=this.dataSourceObj)===null||i===void 0)&&i.changeOrder)this.dataSourceObj.changeOrder(e,t);else if(!(!((r=this.lastSortStates)===null||r===void 0)&&r.some(s=>s.order==="asc"||s.order==="desc"))&&this.canChangeOrder(e,t))if(this.hasHierarchyStateExpand){let s,l,a=this.currentPagerIndexedData[e],d=this.currentPagerIndexedData[t];if(a=Array.isArray(a)?[...a]:[a],d=Array.isArray(d)?[...d]:[d],a.length>1||d.length>1){if(t>e&&d.length>a.length){let u=this.currentPagerIndexedData[t+1];u=Array.isArray(u)?[...u]:[u],u.length<d.length&&d.splice(d.length-1,1)}if(s=a.splice(a.length-1,1)[0],l=d.splice(d.length-1,1)[0],a.length>=1){const u=this.getOriginalRecord(a),h=u.filteredChildren?u.filteredChildren.splice(s,1):u.children.splice(s,1);h.unshift(l,0),Array.prototype.splice.apply((o=u.filteredChildren)!==null&&o!==void 0?o:u.children,h)}else{const u=this.records.splice(s,1);u.unshift(l,0),Array.prototype.splice.apply(this.records,u)}}else{s=this.currentPagerIndexedData[e],l=this.currentPagerIndexedData[t];const u=this.records.splice(s,1);u.unshift(l,0),Array.prototype.splice.apply(this.records,u)}this.restoreTreeHierarchyState(),this.updatePagerData()}else{const s=this.records.splice(e,1);s.unshift(t,0),Array.prototype.splice.apply(this.records,s)}}restoreTreeHierarchyState(){var e,t;if(this.hierarchyExpandLevel){for(let r=0;r<this._sourceLength;r++){const o=this.getOriginalRecord(r);((e=o.filteredChildren)!==null&&e!==void 0?e:o.children)&&!o.hierarchyState&&(o.hierarchyState=be.collapse)}this.currentIndexedData=Array.from({length:this._sourceLength},(r,o)=>o);let i=this._sourceLength;for(let r=0;r<i;r++){const o=this.currentIndexedData[r],s=this.getOriginalRecord(o),l=(t=s.filteredChildren)!==null&&t!==void 0?t:s.children;if((l==null?void 0:l.length)>0&&s.hierarchyState===be.expand){this.hasHierarchyStateExpand=!0;const a=this.restoreChildrenNodeHierarchy(o,s);r+=a,i+=a}else s.children===!0&&!s.hierarchyState&&(s.hierarchyState=be.collapse)}}}restoreChildrenNodeHierarchy(e,t){var i,r;let o=0;const s=(i=t.filteredChildren)!==null&&i!==void 0?i:t.children,l=(r=s==null?void 0:s.length)!==null&&r!==void 0?r:0;for(let a=0;a<l;a++){t.hierarchyState===be.expand&&(o+=1);const d=s[a],u=Array.isArray(e)?e.concat(a):[e,a];t.hierarchyState===be.expand&&this.currentIndexedData.splice(this.currentIndexedData.indexOf(e)+o,0,u),o+=this.restoreChildrenNodeHierarchy(u,d)}return o}}Er.EMPTY=new Er({get(){},length:0});function Vc(n,e){var t;let i=n;for(let r=0;r<e.length;r++){const o=e[r];if(!i[o])return;i=i[o];const s=(t=i.filteredChildren)!==null&&t!==void 0?t:i==null?void 0:i.children;s&&r+1<e.length&&(i=s)}return i}function Ib(n,e){return n.sort((t,i)=>{var r,o;J(t)&&(t=[t]),J(i)&&(i=[i]);const s=Math.max(t.length,i.length);for(let l=0;l<s;l++){const a=(r=t[l])!==null&&r!==void 0?r:-1,d=(o=i[l])!==null&&o!==void 0?o:-1;if(a!==d)return d-a}return 0})}var lH=Ev();const aH=D_(lH);function dH(n,e,t,i){(n[e]||(n[e]=new Map)).set(t,i)}class yu extends Er{static get EVENT_TYPE(){return Er.EVENT_TYPE}static ofArray(e,t,i,r,o,s){return new yu({get:l=>e[l],length:e.length,records:e},t,i,r,o,s)}constructor(e,t,i,r,o,s){let l;ee(t==null?void 0:t.groupByRules)&&(o="tree",l=!0),super(e,t,i,r,o,s),this._isGrouped=l,this._recordCache=[],this._fieldCache={}}getOriginalRecord(e){return J(e)&&this._recordCache&&this._recordCache[e]?this._recordCache[e]:super.getOriginalRecord(e)}getRawRecord(e){var t,i,r,o;let s,l;if(this._isGrouped){if(s=this.getOriginRecordIndexForGroup(e),O(s)&&((t=this.beforeChangedRecordsMap)===null||t===void 0?void 0:t.has(s.toString())))return(i=this.beforeChangedRecordsMap)===null||i===void 0?void 0:i.get(s.toString())}else if(!((r=this.beforeChangedRecordsMap)===null||r===void 0)&&r.has(e.toString()))return(o=this.beforeChangedRecordsMap)===null||o===void 0?void 0:o.get(e.toString());return J(e)&&this._recordCache&&this._recordCache[e]?this._recordCache[e]:(l=this.dataSourceObj.records?Array.isArray(e)?Vc(this.records,e):this.records[e]:this._get(e),ji(l,a=>{this.recordPromiseCallBack(e,a)}))}getOriginalField(e,t,i,r,o){const s=this._fieldCache&&this._fieldCache[e];if(s){const l=s.get(t);if(l)return l}return super.getOriginalField(e,t,i,r,o)}clearCache(){this._recordCache&&(this._recordCache=[]),this._fieldCache&&(this._fieldCache={})}fieldPromiseCallBack(e,t,i){dH(this._fieldCache,e,t,i)}recordPromiseCallBack(e,t){this._recordCache&&(this._recordCache[e]=t)}get records(){return Array.isArray(this._recordCache)&&this._recordCache.length>0?this._recordCache:super.records}release(){var e;(e=super.release)===null||e===void 0||e.call(this),this._recordCache=null,this._fieldCache=null}_generateFieldAggragations(){var e;if(super._generateFieldAggragations(),ee((e=this.dataConfig)===null||e===void 0?void 0:e.groupByRules)){const t=this.dataConfig.groupByRules;this.groupAggregator=new this.registedAggregators[Je.CUSTOM]({field:"",aggregationFun:(i,r,o)=>{const s=new Map,l=[];for(let a=0;a<r.length;a++)Gc(r[a],l,s,t,0);return l}}),this.fieldAggregators.push(this.groupAggregator)}}processRecords(e){var t;const i=super.processRecords(e);return((t=this.groupAggregator)===null||t===void 0?void 0:t.value())||i}getGroupLength(){var e,t,i;return(i=(t=(e=this.dataConfig)===null||e===void 0?void 0:e.groupByRules)===null||t===void 0?void 0:t.length)!==null&&i!==void 0?i:0}updateGroup(){var e,t,i;this.clearCache();const r=this.source;this._source=this.processRecords((t=(e=this.dataSourceObj)===null||e===void 0?void 0:e.records)!==null&&t!==void 0?t:this.dataSourceObj),r&&Ow(r,this.source),this.sourceLength=((i=this.source)===null||i===void 0?void 0:i.length)||0,this.sortedIndexMap.clear(),this.currentIndexedData=Array.from({length:this.sourceLength},(o,s)=>s),this.userPagination||(this.pagination.perPageCount=this.sourceLength,this.pagination.totalCount=this.sourceLength),this.initTreeHierarchyState(),this.updatePagerData()}getOriginRecordIndexForGroup(e){const t=this.getOriginalRecord(e);if(O(t)&&!(t.children&&t.children.length>0)){for(let i=0;i<this.dataSourceObj.records.length;i++)if(this.dataSourceObj.records[i]===t)return i}}addRecordsForGroup(e,t){if(!ee(e)||e.length===0)return;let i=this.getOriginRecordIndexForGroup(t);(i===void 0||i>this.dataSourceObj.records)&&(i=this.dataSourceObj.records.length),this.dataSourceObj.records.splice(i,0,...e),this.adjustBeforeChangedRecordsMap(i,e.length),this.updateGroup()}deleteRecordsForGroup(e){if(!ee(e)||e.length===0)return;const t=Ib(e);for(let i=0;i<t.length;i++){const r=t[i];if(J(r)&&(r>=this.sourceLength||r<0))continue;const o=this.getOriginRecordIndexForGroup(r);this.beforeChangedRecordsMap.delete(o.toString()),this.dataSourceObj.records.splice(o,1),this.sourceLength-=1,this.adjustBeforeChangedRecordsMap(o,1,"delete")}this.updateGroup()}updateRecordsForGroup(e,t){for(let i=0;i<t.length;i++){const r=t[i];if(J(r)&&(r>=this.sourceLength||r<0))continue;const o=this.getOriginRecordIndexForGroup(r);this.beforeChangedRecordsMap.delete(o.toString()),this.dataSourceObj.records[o]=e[i]}this.updateGroup()}addRecordsForTree(e,t){if(ee(e)&&e.length!==0){if(this.adjustBeforeChangedRecordsMap(t,e.length),J(t))this.dataSourceObj.records.splice(t,0,...e);else{const i=t.pop(),r=this.getOriginalRecord(t);r.children?r.children.splice(i,0,...e):r.children=e}this.initTreeHierarchyState(),this.updatePagerData()}}deleteRecordsForTree(e){if(!ee(e)||e.length===0)return;const t=Ib(e);for(let i=0;i<t.length;i++){const r=t[i];if(!J(r)||!(r>=this.sourceLength||r<0)){if(this.beforeChangedRecordsMap.delete(r.toString()),J(r))this.dataSourceObj.records.splice(r,1);else{const o=r.pop();this.getOriginalRecord(r).children.splice(o,1)}this.adjustBeforeChangedRecordsMap(r,1,"delete")}}this.initTreeHierarchyState(),this.updatePagerData()}updateRecordsForTree(e,t){for(let i=0;i<t.length;i++){const r=t[i],o=e[i];if(!J(r)||!(r>=this.sourceLength||r<0))if(this.beforeChangedRecordsMap.delete(r.toString()),J(r))this.dataSourceObj.records.splice(r,1,o);else{const s=r.pop();this.getOriginalRecord(r).children.splice(s,1,o)}}this.initTreeHierarchyState(),this.updatePagerData()}adjustBeforeChangedRecordsMap(e,t,i="add"){if(this.rowHierarchyType==="tree"){let r;r=J(e)?[e]:e;const o=[];this.beforeChangedRecordsMap.forEach((s,l)=>{var a,d;const u=l.split(","),h=Math.max(u.length,r.length);for(let c=0;c<h;c++){const g=(a=r[c])!==null&&a!==void 0?a:-1,f=(d=Number(u[c]))!==null&&d!==void 0?d:-1;if(g<f||g===f&&c===u.length-1&&c===r.length-1)return u[c]=(f+(i==="add"?t:-t)).toString(),void o.push({originKey:l,targetKey:u.toString(),value:s})}}),o.forEach(({originKey:s,targetKey:l,value:a})=>{this.beforeChangedRecordsMap.delete(s),this.beforeChangedRecordsMap.set(l,a)})}else super.adjustBeforeChangedRecordsMap(e,t,i)}cacheBeforeChangedRecord(e,t){var i;const r=this.getOriginalRecord(e);t.options.groupBy&&(e=this.getOriginRecordIndexForGroup(e)),this.beforeChangedRecordsMap.has(e.toString())||this.beforeChangedRecordsMap.set(e.toString(),(i=Or(r,void 0,["vtable_gantt_linkedFrom","vtable_gantt_linkedTo"]))!==null&&i!==void 0?i:{})}getGroupSeriesNumber(e){const t=this.dataSource.currentIndexedData[e],i=t.length-1;let r=t.length,o=1;for(;r>i;o++){const s=this.dataSource.currentIndexedData[e-o];r=J(s)?1:s.length}return o-1}}function Gc(n,e,t,i,r){const o=i[r];if(!O(o))return void e.push(n);const s=aH(n,o);if(s!==void 0){if(t.has(s)){const l=t.get(s);return Gc(n,e[l].children,e[l].map,i,r+1)}return t.set(s,e.length),e.push({vtableMerge:!0,vtableMergeName:s,children:[],map:new Map}),Gc(n,e[e.length-1].children,e[e.length-1].map,i,r+1)}}function Ow(n,e,t,i){if(!t){t=new Map;for(let r=0;r<n.length;r++){const o=n[r];o.vtableMerge&&t.set(o.vtableMergeName,r)}}if(!i){i=new Map;for(let r=0;r<e.length;r++){const o=e[r];o.vtableMerge&&i.set(o.vtableMergeName,r)}}for(let r=0;r<n.length;r++){const o=n[r],s=e[i.get(o.vtableMergeName)];O(s)&&(s.hierarchyState=n[r].hierarchyState),ee(o.children)&&ee(s.children)&&o.map.size!==0&&s.map.size!==0&&Ow(o.children,s.children,o.map,s.map)}}var Nl={exports:{}},Ob;function uH(){if(Ob)return Nl.exports;Ob=1;var n={},e=new RegExp(["^\\s*(?=(?:(?:[-a-z]+\\s*){0,2}(italic|oblique))?)","(?=(?:(?:[-a-z]+\\s*){0,2}(small-caps))?)","(?=(?:(?:[-a-z]+\\s*){0,2}(bold(?:er)?|lighter|[1-9]00 ))?)","(?:(?:normal|\\1|\\2|\\3)\\s*){0,3}((?:xx?-)?","(?:small|large)|medium|smaller|larger|[\\.\\d]+(?:\\%|in|[cem]m|ex|p[ctx]))","(?:\\s*\\/\\s*(normal|[\\.\\d]+(?:\\%|in|[cem]m|ex|p[ctx])?))",`?\\s*([-,\\"\\'\\sa-z]+?)\\s*$`].join(""),"i"),t=["style","variant","weight","size","lineHeight","family"],i=/([\.0-9]+)(.*)/,r=function(a,d,u){var h=a.match(i);if(h){a=parseFloat(h[1]);var c=h[2].toLowerCase().trim(),g=Math.round(a);switch(g===a&&(a=g),c){case"em":return d===null?void 0:a*d;case"px":return a;case"pt":return a/(72/u);case"pc":return a/(6/u);case"mm":return a*(u/25.4);case"cm":return a*(u/2.54);case"in":return a*u;case"%":return d===null?void 0:d*(a/100)}}},o={size:r,lineHeight:r},s={serif:1,"sans-serif":1,cursive:1,fantasy:1,monospace:1},l=Nl.exports=function(a,d,u){var h=a+"-"+(d||"null")+"@"+u;if(u=u||96,typeof n[h]<"u")return n[h];if(d&&(d=l(d,null,u)),a==="inherit")return d;var c=e.exec(a);if(!c){n[h]=null;return}c.shift();for(var g={},f=0;f<c.length;f++){var p=t[f],m=c[f];if(o[p]&&m){var b=d&&d[p]||null,C=o[p](m,b,u);typeof C>"u"&&p==="lineHeight"&&m?m=g.size*parseFloat(m):m=C}if(!(!m||m==="normal")){if(m==="inherit"){if(!d)return;m=d[p]}m.trim&&(m=m.trim()),g[p]=m}}Object.keys(g).length||(g=null),n[h]=g;var _=[];g.style&&_.push(g.style),g.variant&&_.push(g.variant),g.weight&&g.weight!=="400"&&g.weight!=="normal"&&_.push(g.weight),_.push(g.size+"px"),g.lineHeight&&(_[_.length-1]+="/"+g.lineHeight+"px");var w=g.family.split(",");return g.family=w.map(function(y){return y=y.trim(),s[y.toLowerCase()]&&(y=y.toLowerCase()),y}),_.push(g.family),Object.defineProperty(g,"toString",{value:function(){return _.map(function(y){return Array.isArray(y)?y.map(function(v){return v.indexOf(" ")>-1?'"'+v.replace(/["']/g,"")+'"':v}).join(", "):y}).join(" ")}}),g};return Nl.exports.generics=s,Nl.exports}var hH=uH();const cH=D_(hH);function fH(n){return cH(n)}function xe(n){var e,t,i,r;if(J(n)||je(n)||ee(n)){let o=fa(n);return typeof o=="number"||typeof o=="string"?o=[o,o,o,o]:Array.isArray(o)&&(o=o.slice(0)),o}return n&&(isFinite(n.bottom)||isFinite(n.left)||isFinite(n.right)||isFinite(n.top))?[(e=n.top)!==null&&e!==void 0?e:0,(t=n.right)!==null&&t!==void 0?t:0,(i=n.bottom)!==null&&i!==void 0?i:0,(r=n.left)!==null&&r!==void 0?r:0]:[0,0,0,0]}const ta=0,Dw=1,ud=2,Ww=3,Nw=10,Vw=11,Gw=12,gH=9,pH=13,mH=10,bH=12,CH=32,_H=37,wH=46,yH=48,vH=57,SH=65,xH=90,RH=97,AH=122;function BH(n){return n>=SH&&n<=xH}function MH(n){return n>=RH&&n<=AH}function TH(n){return MH(n)||BH(n)}function PH(n){return n===gH||n===mH||n===bH||n===pH||n===CH}function qu(n){return n>=yH&&n<=vH}function Db(n){return n===wH}function Wb(n){return TH(n)||n===_H}function ys(n){return new Error(`calc parse error: ${n}`)}function HH(n){const e=n.replace(/calc\(/g,"(").trim(),t=[],i=e.length;for(let l=0;l<i;l++){const a=e[l],d=a.charCodeAt(0);if(a==="("||a===")")t.push({value:a,type:ta});else if(a==="*"||a==="/")t.push({value:a,type:ud});else if(a==="+"||a==="-")l=r(a,l+1)-1;else if(qu(d)||Db(d))l=o(a,l+1)-1;else if(!PH(d))throw ys(n)}function r(l,a){if(a<i){const d=e[a],u=d.charCodeAt(0);if(qu(u)||Db(u))return o(l+d,a+1)}return t.push({value:l,type:ud}),a}function o(l,a){let d=a;for(;d<i;d++){const u=e[d],h=u.charCodeAt(0);if(qu(h))l+=u;else{if(u!=="."){if(Wb(h))return s(l,u,d+1);break}if(l.indexOf(".")>=0)throw ys(n);l+=u}}if(l===".")throw ys(n);return t.push({value:parseFloat(l),type:Ww}),d}function s(l,a,d){let u=d;for(;u<i;u++){const h=e[u];if(!Wb(h.charCodeAt(0)))break;a+=h}return t.push({value:parseFloat(l),unit:a,type:Dw}),u}return t}const Nb={"*":3,"/":3,"+":2,"-":2};function jw(n,e){function t(r){const o=r.pop(),s=r.pop(),l=r.pop();if(!(l&&l.nodeType&&s&&s.type===ud&&o&&o.nodeType))throw ys(e);return{nodeType:Vw,left:l,op:s,right:o}}const i=[];for(;n.length;){const r=n.shift();if(r.type===ta&&r.value==="("){let o=0;const s=Bw.findIndex(n,l=>{if(l.type===ta&&l.value==="(")o++;else if(l.type===ta&&l.value===")"){if(!o)return!0;o--}return!1});if(s===-1)throw ys(e);i.push(jw(n.splice(0,s),e)),n.shift()}else if(r.type===ud){if(i.length>=3){const o=i[i.length-2].value;Nb[r.value]<=Nb[o]&&i.push(t(i))}i.push(r)}else if(r.type===Dw){const{value:o,unit:s}=r;i.push({nodeType:Nw,value:o,unit:s})}else r.type===Ww&&i.push({nodeType:Gw,value:r.value})}for(;i.length>1;)i.push(t(i));return i[0]}function kH(n){return jw(HH(n),n)}function jc(n,e){if(n.nodeType===Vw){const t=jc(n.left,e),i=jc(n.right,e);switch(n.op.value){case"+":return t+i;case"-":return t-i;case"*":return t*i;case"/":return t/i;default:throw new Error(`calc error. unknown operator: ${n.op.value}`)}}else if(n.nodeType===Nw)switch(n.unit){case"%":return n.value*e.full/100;case"px":return n.value;default:throw new Error(`calc error. unknown unit: ${n.unit}`)}else if(n.nodeType===Gw)return n.value;throw new Error("calc error.")}function EH(n,e){return jc(kH(n),e)}function LH(n,e){return typeof n=="string"?EH(n.trim(),e):n-0}function FH(n){return!Te(n)&&(!!J(n)||+n==+n)}function Zu(n){return!!je(n)&&!!n.endsWith("%")&&FH(n.substring(0,n.length-1))}function zH(n,e="vtable"){var t,i;const r=document.createElement("div");r.setAttribute("tabindex","0"),r.classList.add(e),r.style.outline="none",r.style.margin=`${n.top}px ${n.right}px ${n.bottom}px ${n.left}px`;const o=(r.offsetWidth||((t=r.parentElement)===null||t===void 0?void 0:t.offsetWidth)||1)-1,s=(r.offsetHeight||((i=r.parentElement)===null||i===void 0?void 0:i.offsetHeight)||1)-1;return r.style.width=o&&o-n.left-n.right+"px"||"0px",r.style.height=s&&s-n.top-n.bottom+"px"||"0px",r}function IH(n,e){var t,i;n.style.margin=`${e.top}px ${e.right}px ${e.bottom}px ${e.left}px`;const r=(n.offsetWidth||((t=n.parentElement)===null||t===void 0?void 0:t.offsetWidth)||1)-1,o=(n.offsetHeight||((i=n.parentElement)===null||i===void 0?void 0:i.offsetHeight)||1)-1;n.style.width=r&&r-e.left-e.right+"px"||"0px",n.style.height=o&&o-e.top-e.bottom+"px"||"0px"}function Uw(n,e){const{dataSourceEventIds:t}=n.internalProps;t&&t.forEach(i=>n.internalProps.handler.off(i)),e(n),n.internalProps.dataSourceEventIds=[n.internalProps.handler.on(n.internalProps.dataSource,Er.EVENT_TYPE.CHANGE_ORDER,()=>{n.dataSource.hierarchyExpandLevel&&n.refreshRowColCount(),n.render()})]}function Vb(n,e=[]){Uw(n,()=>{n.internalProps.records=e;const t=n.internalProps.dataSource=yu.ofArray(e,n.internalProps.dataConfig,n.pagination,n.internalProps.columns,n.internalProps.layoutMap.rowHierarchyType,$w(n));n.addReleaseObj(t)})}function $w(n){var e;return n.options.hierarchyExpandLevel?n.options.hierarchyExpandLevel:n.options.groupBy?1/0:!((e=n._hasHierarchyTreeHeader)===null||e===void 0)&&e.call(n)?1:void 0}function OH(n,e){Uw(n,()=>{var t,i;n.internalProps.dataSource&&((i=(t=n.internalProps.dataSource).release)===null||i===void 0||i.call(t)),e?e instanceof Er?(n.internalProps.dataSource=e,n.internalProps.dataSource.supplementConfig(n.pagination,n.options.columns,n.internalProps.layoutMap.rowHierarchyType,$w(n))):n.internalProps.dataSource=new yu(e):n.internalProps.dataSource=Er.EMPTY,n.addReleaseObj(n.internalProps.dataSource),n.internalProps.records=null})}function DH(n,e){if(!n.internalProps.frozenRowCount)return null;let{scrollTop:t}=n;const i=n.internalProps.frozenRowCount;for(let r=0;r<i;r++){const o=n.getRowHeight(r),s=t+o;if(s>e)return{top:t,row:r,bottom:s,height:o};t=s}return null}function WH(n,e){if(!n.internalProps.frozenColCount)return null;let{scrollLeft:t}=n;const i=n.internalProps.frozenColCount;for(let r=0;r<i;r++){const o=n.getColWidth(r),s=t+o;if(s>e)return{left:t,col:r,right:s,width:o};t=s}return null}function $r(n,e){return Math.round(LH(e,n.internalProps.calcWidthContext))}function NH(n,e){return n?n.min&&n.min>e?n.min:n.max&&n.max<e?n.max:e:e}function VH(n){let e=0,t=0;n.frozenColCount>0&&(e=n.getFrozenColsWidth()),n.rightFrozenColCount>0&&(t=n.getRightFrozenColsWidth());let i=0,r=0;return n.frozenRowCount>0&&(i=n.getFrozenRowsHeight()),n.bottomFrozenRowCount>0&&(r=n.getBottomFrozenRowsHeight()),new Zn(n.scrollLeft+e,n.scrollTop+i,n.tableNoFrameWidth-e-t,n.tableNoFrameHeight-i-r)}function ir(n,e,t,i,r,o=!0){const s=xe(r("padding",n,t,i,e)),l=r("bgColor",n,t,i,e),a=r("font",n,t,i,e);let d,u,h,c,g;if(a){const{family:P,size:k,weight:L,style:F,variant:z}=fH(a);d=P.join(" "),u=k,h=L,c=F,c=z}else d=r("fontFamily",n,t,i,e),u=r("fontSize",n,t,i,e),h=r("fontWeight",n,t,i,e),c=r("fontStyle",n,t,i,e),g=r("fontVariant",n,t,i,e);const f=r("textAlign",n,t,i,e),p=r("textBaseline",n,t,i,e),m=r("color",n,t,i,e),b=r("strokeColor",n,t,i,e),C=r("lineHeight",n,t,i,e),_=r("underline",n,t,i,e),w=r("underlineDash",n,t,i,e),y=r("underlineOffset",n,t,i,e),v=r("lineThrough",n,t,i,e),x=Math.max(1,Math.floor(u/10)),S=r("textOverflow",n,t,i,e),R=r("borderColor",n,t,i,e),B=r("borderLineWidth",n,t,i,e),A=r("borderLineDash",n,t,i,e),M=r("marked",n,t,i,e),H=r("cursor",n,t,i,e),E=!(s&&l&&a&&f&&p&&m&&S&&R&&B&&A&&typeof _=="boolean"&&typeof v=="boolean"&&typeof M=="boolean");if(!o)return{hasFunctionPros:E};const T={text:{fontFamily:d,fontSize:u,fontWeight:h,fontStyle:c,fontVariant:g,fill:m,stroke:b!=null&&b,textAlign:f,textBaseline:p,lineHeight:C??u,underline:_?x:void 0,underlineDash:w,underlineOffset:y,lineThrough:v?x:void 0,ellipsis:S==="clip"?"":S==="ellipsis"?"...":O(S)?S:void 0},group:{fill:l,lineDash:A,lineWidth:B,stroke:R,cursor:H==="auto"||H==="default"?void 0:H},_vtable:{padding:s,marked:M}};if(Array.isArray(B)&&(T.group.strokeArrayWidth=xe(B)),Array.isArray(R)){const P=xe(R);T.group.stroke=!P.every(k=>!k)&&P,T.group.strokeArrayColor=xe(R)}return{theme:T,hasFunctionPros:E}}function vu(n,e,t){const i=t.theme.frameStyle.cornerRadius;if(Array.isArray(i)){if(n===0&&e===0)return[i[0],0,0,0];if(n===t.colCount-1&&e===0)return[0,i[1],0,0];if(n===0&&e===t.rowCount-1)return[0,0,0,i[3]];if(n===t.colCount-1&&e===t.rowCount-1)return[0,0,i[2],0]}else if(i){if(n===0&&e===0)return[i,0,0,0];if(n===t.colCount-1&&e===0)return[0,i,0,0];if(n===0&&e===t.rowCount-1)return[0,0,0,i];if(n===t.colCount-1&&e===t.rowCount-1)return[0,0,i,0]}return 0}function AO(n){var e,t,i,r;if(n){if(Array.isArray(n)){let o;for(let s=0;s<n.length;s++)if(n[s].autoRange){if(n[s].y==="sum"||n[s].x==="sum"||n[s].y1==="sum"||n[s].x1==="sum")return"sum";n[s].y!=="max"&&n[s].x!=="max"&&n[s].y1!=="max"&&n[s].x1!=="max"||(o="max"),typeof n[s].y=="number"&&typeof(o??0)=="number"&&(o=Math.max((e=o)!==null&&e!==void 0?e:0,n[s].y)),typeof n[s].x=="number"&&typeof(o??0)=="number"&&(o=Math.max((t=o)!==null&&t!==void 0?t:0,n[s].x)),typeof n[s].y1=="number"&&typeof(o??0)=="number"&&(o=Math.max((i=o)!==null&&i!==void 0?i:0,n[s].y1)),typeof n[s].x1=="number"&&typeof(o??0)=="number"&&(o=Math.max((r=o)!==null&&r!==void 0?r:0,n[s].x1))}return o}if(n.autoRange){if(n.y==="sum"||n.x==="sum"||n.y1==="sum"||n.x1==="sum")return"sum";if(n.y==="max"||n.x==="max"||n.y1==="max"||n.x1==="max")return"max";if(typeof n.y=="number")return n.y;if(typeof n.x=="number")return n.x;if(typeof n.y1=="number")return n.y1;if(typeof n.x1=="number")return n.x1}}}function Vl(n){for(let e=0;e<n.internalProps.columns.length;e++){const t=n.internalProps.columns[e];if(!t.aggregation){if(n.options.aggregation){let i;if(i=typeof n.options.aggregation=="function"?n.options.aggregation({col:e,field:t.field}):n.options.aggregation,i)if(Array.isArray(i)){const r=[];i.forEach(o=>{r.push(Object.assign({showOnTop:!1},o))}),t.aggregation=r}else t.aggregation=Object.assign({showOnTop:!1},i)}}}}function GH(n){for(let e=0;e<n.length;e++)if(n[e].aggregation)return!0;return!1}function jH(n){if(n.options.widthMode==="autoWidth"||n.options.defaultHeaderColWidth==="auto"||Array.isArray(n.options.defaultHeaderColWidth)&&n.options.defaultHeaderColWidth.includes("auto"))return!0;const e=n.internalProps.layoutMap.columnObjects;for(let t=0;t<e.length;t++)if(e[t].width==="auto")return!0;return!1}class Lr extends Hr{constructor(e){super(e),this.attribute.visibleTime!=="mouseenter_cell"&&this.attribute.visibleTime!=="click_cell"||(this.attribute.opacity=0),this.attribute.hoverImage&&(this.attribute.originImage=this.attribute.image),this.attribute.isGif&&this.attribute.gif&&this.loadGif()}loadGif(){this.playing=!1,Ne.GetFile(this.attribute.gif+`?role=gif&radom=${Math.random()}`,"arrayBuffer").then(e=>{const t=xg.parseGIF(e),i=xg.decompressFrames(t,!0);this.renderGIF(i),this.resources.set(this.attribute.image,{state:"success",data:this.gifCanvas})}).catch(e=>{})}get backgroundWidth(){var e,t;return(t=(e=this.attribute.backgroundWidth)!==null&&e!==void 0?e:this.attribute.width)!==null&&t!==void 0?t:0}get backgroundHeight(){var e,t;return(t=(e=this.attribute.backgroundHeight)!==null&&e!==void 0?e:this.attribute.height)!==null&&t!==void 0?t:0}renderGIF(e){this.loadedFrames=e,this.frameIndex=0,this.tempCanvas||(this.tempCanvas=document.createElement("canvas"),this.tempCtx=this.tempCanvas.getContext("2d")),this.gifCanvas||(this.gifCanvas=document.createElement("canvas"),this.gifCtx=this.gifCanvas.getContext("2d")),this.gifCanvas.width=e[0].dims.width,this.gifCanvas.height=e[0].dims.height,this.playing=!0,this.lastTime=new Date().getTime(),this.animate().to({},1e3,"linear").loop(1/0)}renderFrame(e,t,i){const r=this.loadedFrames[this.frameIndex||0];r.disposalType===2&&this.gifCtx.clearRect(0,0,this.gifCanvas.width,this.gifCanvas.height),this.drawPatch(r),this.manipulate(e,t,i);const o=new Date().getTime()-this.lastTime;r.delay<o&&(this.frameIndex++,this.lastTime=new Date().getTime()),this.frameIndex>=this.loadedFrames.length&&(this.frameIndex=0)}drawPatch(e){const t=e.dims;this.frameImageData&&t.width===this.frameImageData.width&&t.height===this.frameImageData.height||(this.tempCanvas.width=t.width,this.tempCanvas.height=t.height,this.frameImageData=this.tempCtx.createImageData(t.width,t.height)),this.frameImageData.data.set(e.patch),this.tempCtx.putImageData(this.frameImageData,0,0),this.gifCtx.drawImage(this.tempCanvas,t.left,t.top)}manipulate(e,t,i){e.drawImage(this.gifCanvas,0,0,this.gifCanvas.width,this.gifCanvas.height,t,i,this.attribute.width,this.attribute.height)}setAttribute(e,t,i,r){super.setAttribute(e,t,i,r),e==="gif"&&this.loadGif()}setAttributes(e,t,i){super.setAttributes(e,t,i),e.gif&&this.loadGif()}}class Kw extends Rt{constructor(e){var t,i,r,o,s;e.fill=(t=e.fill)!==null&&t!==void 0?t:"#00F",e.fontSize=(i=e.fontSize)!==null&&i!==void 0?i:12,e.underline=(r=e.underline)!==null&&r!==void 0?r:1,e.textBaseline=(o=e.textBaseline)!==null&&o!==void 0?o:"top",e.cursor=(s=e.cursor)!==null&&s!==void 0?s:"pointer",super(e)}}function Ks(n){return{rootContainer:new jn({}),renderDefault:!0}}class UH{constructor(e){this.table=e,this.customLayoutFuncCache=new Map,this.reactRemoveGraphicCache=new Map,this.reactRemoveAllGraphicCache=new Map,this.headerCustomLayoutFuncCache=new Map,this.headerReactRemoveGraphicCache=new Map,this.headerReactRemoveAllGraphicCache=new Map}hasReactCreateGraphic(e,t){return t?this.headerCustomLayoutFuncCache.has(e):this.customLayoutFuncCache.has(e)}setReactCreateGraphic(e,t,i){i?this.headerCustomLayoutFuncCache.set(e,t):this.customLayoutFuncCache.set(e,t)}setReactRemoveGraphic(e,t,i){i?this.headerReactRemoveGraphicCache.set(e,t):this.reactRemoveGraphicCache.set(e,t)}setReactRemoveAllGraphic(e,t,i){i?this.headerReactRemoveAllGraphicCache.set(e,t):this.reactRemoveAllGraphicCache.set(e,t)}updateCustomCell(e,t){const i=this.table;if(i.isPivotTable()){const r=KH(e,i,t);for(let o=0;o<r.length;o++){const s=r[o];for(let l=s.start.col;l<=s.end.col;l++)for(let a=s.start.row;a<=s.end.row;a++)i.scenegraph.updateCellContent(l,a)}}else{const r=$H(e,i,t);for(let o=r.start.col;o<=r.end.col;o++)for(let s=r.start.row;s<=r.end.row;s++)i.scenegraph.updateCellContent(o,s)}i.widthMode==="autoWidth"&&i.scenegraph.recalculateColWidths(),i.isAutoRowHeight()&&i.scenegraph.recalculateRowHeights(),i.scenegraph.renderSceneGraph()}getCustomLayoutFunc(e,t){var i;if(this.table.isHeader(e,t)){const{componentId:o}=this.table.getHeaderDefine(e,t);return(i=this.headerCustomLayoutFuncCache.get(o))!==null&&i!==void 0?i:Ks}const{componentId:r}=this.table.getBodyColumnDefine(e,t);return this.customLayoutFuncCache.get(r)||Ks}removeCustomCell(e,t){let i;if(this.table.isHeader(e,t)){const r=this.table.getHeaderDefine(e,t),{componentId:o}=r;i=this.headerReactRemoveGraphicCache.get(o)}else{const r=this.table.getBodyColumnDefine(e,t),{componentId:o}=r;i=this.reactRemoveGraphicCache.get(o)}i&&i(e,t)}clearCache(){this.reactRemoveAllGraphicCache.forEach(e=>{e()}),this.headerReactRemoveAllGraphicCache.forEach(e=>{e()})}updateAllCustomCell(){this.customLayoutFuncCache.forEach((e,t)=>{this.updateCustomCell(t)}),this.headerCustomLayoutFuncCache.forEach((e,t)=>{this.updateCustomCell(t,!0)})}}function $H(n,e,t){const i=e.internalProps.rowSeriesNumber?1:0;if(t){const o=e.internalProps.layoutMap,{headerObjects:s}=e.internalProps.layoutMap;let l;for(let d=0;d<s.length;d++){const u=s[d];if(u.define.componentId===n){l=u.id;break}}const a=o.getHeaderCellAdressById(l);return o.getCellRange(a.col,a.row)}const{columnObjects:r}=e.internalProps.layoutMap;for(let o=0;o<r.length;o++)if(r[o].define.componentId===n)return{start:{col:i+o,row:e.columnHeaderLevelCount},end:{col:i+o,row:e.rowCount-1}};return{start:{col:0,row:0},end:{col:e.colCount-1,row:e.rowCount-1}}}function KH(n,e,t){const i=e.internalProps.rowSeriesNumber?1:0,r=[],o=e.internalProps.layoutMap;if(t){const{headerObjects:s}=o,l=[];for(let a=0;a<s.length;a++){const d=s[a];d&&d.define.componentId===n&&l.push(d.id)}for(let a=0;a<l.length;a++){const d=l[a],u=o.getHeaderCellAdressById(d),h=o.getCellRange(u.col,u.row);r.push(h)}}else{let s;const{columnObjects:l,indicatorsAsCol:a}=o;for(let d=0;d<l.length;d++)if(l[d].define.componentId===n){s=d;break}if(a)for(let d=o.rowHeaderLevelCount+s;d<o.colCount;d+=l.length){const u={start:{col:d+i,row:o.columnHeaderLevelCount},end:{col:d+i,row:o.rowCount-1}};r.push(u)}else for(let d=o.columnHeaderLevelCount+s;d<o.rowCount;d+=l.length){const u={start:{col:o.rowHeaderLevelCount+i,row:d},end:{col:o.colCount-1,row:d}};r.push(u)}}return r}function Ct(n){const e={abstractPos:{x:n.viewport.x,y:n.viewport.y}},t=Fr(n.target);return t&&(e.eventArgs={col:t.col,row:t.row,event:n,targetCell:t,mergeInfo:YH(t),target:n.target}),e}function Fr(n){for(;n&&n.parent;){if(n.role==="cell")return n;n=n.parent}return null}function YH(n){if(O(n.mergeStartCol)&&O(n.mergeStartRow)&&O(n.mergeEndCol)&&O(n.mergeEndRow))return{colStart:n.mergeStartCol,colEnd:n.mergeEndCol,rowStart:n.mergeStartRow,rowEnd:n.mergeEndRow}}const XH=/radio-\d+-\d+-(\d+)/,Yw="_custom_",ti="custom-container",hd=Yw+"_0";function er(n,e,t,i,r,o,s,l,a,d,u){var h,c,g;let f,p,m,b=!0,C=!1;if(n==="react-custom-layout"&&(n=((h=u.reactCustomLayout)===null||h===void 0?void 0:h.getCustomLayoutFunc(t,i))||Ks),typeof n=="function"){const _=n({col:(c=d==null?void 0:d.start.col)!==null&&c!==void 0?c:t,row:(g=d==null?void 0:d.start.row)!==null&&g!==void 0?g:i,dataValue:u.getCellOriginValue(t,i),value:u.getCellValue(t,i)||"",rect:{left:0,top:0,right:r,bottom:o,width:r,height:o},table:u,originCol:t,originRow:i});if(!_)return{renderDefault:!0};_.rootContainer&&(_.rootContainer=Ys(_.rootContainer,u.animationManager.timeline)),_.rootContainer instanceof jn&&(m=_.rootContainer,m.name=ti,m.col=t,m.row=i),b=_.renderDefault,C=_.enableCellPadding}else if(typeof e=="function"){const _=e({col:t,row:i,dataValue:u.getCellOriginValue(t,i),value:u.getCellValue(t,i)||"",rect:{left:0,top:0,right:r,bottom:o,width:r,height:o},table:u});_&&(p=_.elements,b=_.renderDefault,_.expectedWidth,f=_.expectedHeight)}else e&&(e.expectedWidth,f=e.expectedHeight,p=e.elements,b=e.renderDefault);return p&&(m=qH(p,r,l?f:o,u.getCellValue(t,i))),C&&m.setAttributes({x:a[3],y:a[0],width:r-a[1]-a[3],height:o-a[0]-a[2]}),Su(m,r,o),!d||d.start.col===d.end.col&&d.start.row===d.end.row||Xw(m,t,i,0),{elementsGroup:m,renderDefault:b}}function qH(n,e,t,i){const r=new jn({x:0,y:0,width:e,height:t,fill:!1,stroke:!1,pickable:!1});return r.name=ti,ZH(n,e,t,i).forEach(o=>{var s,l,a,d,u,h,c,g,f,p,m,b,C,_,w,y,v,x,S,R,B,A,M,H,E,T,P,k;switch(o.clickable&&(o.pickable=o.clickable),o.type){case"arc":const L=Df({x:o.x,y:o.y,dx:(s=o.dx)!==null&&s!==void 0?s:0,dy:(l=o.dy)!==null&&l!==void 0?l:0,fill:o.fill,stroke:o.stroke,outerRadius:o.radius,startAngle:o.startAngle,endAngle:o.endAngle,pickable:!!o.pickable,cursor:o.cursor});L.name=o.name,r.appendChild(L);break;case"text":if(o.background){const G=(d=(a=o.background)===null||a===void 0?void 0:a.expandX)!==null&&d!==void 0?d:0,V=(h=(u=o.background)===null||u===void 0?void 0:u.expandY)!==null&&h!==void 0?h:0,X=Ze({x:o.x-G,y:o.y-V,dx:(c=o.dx)!==null&&c!==void 0?c:0,dy:(g=o.dy)!==null&&g!==void 0?g:0,width:o.width+2*G,height:o.height+2*V,cornerRadius:(p=(f=o.background)===null||f===void 0?void 0:f.cornerRadius)!==null&&p!==void 0?p:0,fill:(b=(m=o.background)===null||m===void 0?void 0:m.fill)!==null&&b!==void 0?b:"#888"});r.appendChild(X)}const F=new Rt(Object.assign({pickable:!!o.pickable,fill:(C=o.color)!==null&&C!==void 0?C:o.fill},o));F.name=o.name,r.appendChild(F);break;case"rect":const z=Ze({x:o.x,y:o.y,dx:(_=o.dx)!==null&&_!==void 0?_:0,dy:(w=o.dy)!==null&&w!==void 0?w:0,width:o.width,height:o.height,cornerRadius:o.radius,fill:o.fill,stroke:o.stroke,pickable:!!o.pickable,cursor:o.cursor});z.name=o.name,r.appendChild(z);break;case"circle":const I=W0({x:o.x,y:o.y,dx:(y=o.dx)!==null&&y!==void 0?y:0,dy:(v=o.dy)!==null&&v!==void 0?v:0,radius:o.radius,fill:o.fill,stroke:o.stroke,pickable:!!o.pickable,cursor:o.cursor});I.name=o.name,r.appendChild(I);break;case"icon":const N=new Lr({x:o.x,y:o.y,dx:(x=o.dx)!==null&&x!==void 0?x:0,dy:(S=o.dy)!==null&&S!==void 0?S:0,width:o.width,height:o.height,image:o.svg,backgroundWidth:o.hover?(R=o.hover.width)!==null&&R!==void 0?R:o.width:void 0,backgroundHeight:o.hover?(B=o.hover.width)!==null&&B!==void 0?B:o.width:void 0,backgroundColor:o.hover?(A=o.hover.bgColor)!==null&&A!==void 0?A:"rgba(22,44,66,0.2)":void 0,pickable:!!o.pickable,cursor:o.cursor});N.name=o.name,N.role="icon-custom",r.appendChild(N);break;case"image":const W=new Lr({x:o.x,y:o.y,dx:(M=o.dx)!==null&&M!==void 0?M:0,dy:(H=o.dy)!==null&&H!==void 0?H:0,width:o.width,height:o.height,image:o.src,backgroundWidth:o.hover?(E=o.hover.width)!==null&&E!==void 0?E:o.width:void 0,backgroundHeight:o.hover?(T=o.hover.width)!==null&&T!==void 0?T:o.width:void 0,backgroundColor:o.hover?(P=o.hover.bgColor)!==null&&P!==void 0?P:"rgba(22,44,66,0.2)":void 0,pickable:!!o.pickable,cursor:o.cursor,shape:o.shape});W.name=o.name,W.role="image-custom",r.appendChild(W);break;case"line":const D=un({points:o.points,lineWidth:(k=o.lineWidth)!==null&&k!==void 0?k:1,stroke:o.stroke,pickable:!!o.pickable,cursor:o.cursor});D.name=o.name,r.appendChild(D)}}),r}function ZH(n,e,t,i){const r=[],o=[0,0,0,0];for(let s=0;s<n.length;s++){const l=n[s],a=Object.assign({},l);for(const u in a)a.hasOwnProperty(u)&&Ae(a[u])&&(a[u]=a[u](i));const d=a;O(d.x)&&(d.x=je(d.x)?hi(d.x,e-o[1]):Number(d.x)),O(d.y)&&(d.y=je(d.y)?hi(d.y,t-o[2]):Number(d.y)),"width"in a&&(a.width=je(a.width)?hi(a.width,e-o[1]):Number(a.width)),"height"in a&&(a.height=je(a.height)?hi(a.height,t-o[2]):Number(a.height)),"radius"in a&&(a.radius=je(a.radius)?hi(a.radius,Math.min(e-o[1],t-o[2])):Number(a.radius)),"hover"in a&&(a.hover.x=je(a.hover.x)?hi(a.hover.x,e-o[1]):Number(a.hover.x),a.hover.y=je(a.hover.y)?hi(a.hover.y,t-o[2]):Number(a.hover.y),a.hover.width=je(a.hover.width)?hi(a.hover.width,e-o[1]):Number(a.hover.width),a.hover.height=je(a.hover.height)?hi(a.hover.height,t-o[2]):Number(a.hover.height),a.hover.x+=0,a.hover.y+=0),d.x=d.x+0,d.y=d.y+0,r.push(a)}return r}function hi(n,e){return n.endsWith("px")?parseInt(n,10):n.endsWith("%")&&e?parseInt(n,10)/100*e:parseInt(n,10)}function Su(n,e,t){n&&n.forEachChildren(i=>{var r,o;i&&(ke(i.attribute.width)&&i.attribute.width.percent&&i.setAttribute("width",Math.max(0,i.attribute.width.percent/100*e+((r=i.attribute.width.delta)!==null&&r!==void 0?r:0))),i.attribute.width<0&&i.setAttribute("width",0),ke(i.attribute.height)&&i.attribute.height.percent&&i.setAttribute("height",Math.max(0,i.attribute.height.percent/100*t+((o=i.attribute.height.delta)!==null&&o!==void 0?o:0))),i.attribute.height<0&&i.setAttribute("height",0),i.type==="group"&&Su(i,i.attribute.width,i.attribute.height))})}function Ys(n,e){if(!n||!O(n.$$typeof)&&!O(n.vtype))return n;const t=n.type,{attribute:i,children:r,stateProxy:o,animation:s}=n.props,l=t({attribute:i});if(JH(l,n.props),o&&(l.stateProxy=o),l.id=i.id,l.name=i.name,ee(r)?r.forEach(a=>{const d=Ys(a,e);d&&d.type&&l.add(d)}):r&&l.add(Ys(r,e)),ee(s)&&e){const a=l.animate();a.setTimeline(e),s.forEach(d=>{a[d[0]](...d.slice(1))})}return l}function JH(n,e){let t=!1;switch(n.type){case"richtext":case"rich/image":break;default:t=!0}t&&Object.keys(e).forEach(i=>{const r=IB[i];r&&n.on(r,e[i])})}function Xw(n,e,t,i,r){n&&(n.name=`${Yw}${r??""}_${i}`,n.onBeforeAttributeUpdate=QH,n.type==="group"&&n.childrenCount&&n.forEachChildren((o,s)=>{Xw(o,e,t,s,(r??"")+"_"+i)}))}function QH(n,e){const t=this;if(t.skipMergeUpdate)return;const i=Fr(t);if(!i||!i.stage)return;const r=i.stage.table;t.skipAttributeUpdate=!0;const{mergeStartCol:o,mergeEndCol:s,mergeStartRow:l,mergeEndRow:a}=i;if(O(o)&&O(s)&&O(l)&&O(a)&&(o!==s||l!==a)){for(let d=o;d<=s;d++)for(let u=l;u<=a;u++){if(d===i.col&&u===i.row)continue;const h=r.scenegraph.highPerformanceGetCell(d,u);if(h.role==="cell"){const c=h.getChildByName(t.name,!0);if(!c||c.skipAttributeUpdate)continue;for(const g in n)n[g]!==c.attribute[g]&&g!=="dx"&&g!=="dy"&&c.setAttribute(g,n[g])}}t.skipAttributeUpdate=void 0}}const ek={};class qw{static setIcon(e,t){this.cache.set(e,t)}static getIcon(e){return this.cache.has(e)?this.cache.get(e):null}static hasIcon(e){return this.cache.has(e)}static clear(e){return this.cache.delete(e)}static clearAll(){this.cache=new Map}}qw.cache=new Map;let ds,us,Uc,$c,ar,dr,Kc,Zw,Jw,Qw,ey,ur,hr,ty,ny,Yc,Xc,iy,ry,qc,Zc,cr,fr,Jc;function Gl(n){var e,t,i,r,o,s,l,a,d,u,h,c,g,f,p,m,b,C,_,w,y,v,x,S;ds=(e=n==null?void 0:n.sort_color)!==null&&e!==void 0?e:"#282F38",us=(t=n==null?void 0:n.sort_color_opacity)!==null&&t!==void 0?t:"0.35",Uc=(i=n==null?void 0:n.sort_color_2)!==null&&i!==void 0?i:"#416EFF",$c=(r=n==null?void 0:n.sort_color_opacity_2)!==null&&r!==void 0?r:"1",ar=(o=n==null?void 0:n.sort_size)!==null&&o!==void 0?o:16,dr=(s=n==null?void 0:n.sort_size_2)!==null&&s!==void 0?s:22,Kc=(l=n==null?void 0:n.frozen_color)!==null&&l!==void 0?l:"#282F38",Zw=(a=n==null?void 0:n.frozen_color_opacity)!==null&&a!==void 0?a:"0.35",Jw=(d=n==null?void 0:n.frozen_color_opacity)!==null&&d!==void 0?d:"0.2",Qw=(u=n==null?void 0:n.frozen_color_2)!==null&&u!==void 0?u:"#416EFF",ey=(h=n==null?void 0:n.frozen_color_opacity_2)!==null&&h!==void 0?h:"1",ur=(c=n==null?void 0:n.frozen_size)!==null&&c!==void 0?c:22,hr=(g=n==null?void 0:n.frozen_size_2)!==null&&g!==void 0?g:22,ty=(f=n==null?void 0:n.collapse_color)!==null&&f!==void 0?f:"#141414",ny=(p=n==null?void 0:n.collapse_color_opacity)!==null&&p!==void 0?p:"0.65",Yc=(m=n==null?void 0:n.collapse_size)!==null&&m!==void 0?m:16,Xc=(b=n==null?void 0:n.frozen_size_2)!==null&&b!==void 0?b:22,iy=(C=n==null?void 0:n.expand_color)!==null&&C!==void 0?C:"#141414",ry=(_=n==null?void 0:n.expand_color_opacity)!==null&&_!==void 0?_:"0.65",qc=(w=n==null?void 0:n.expand_size)!==null&&w!==void 0?w:16,Zc=(y=n==null?void 0:n.expand_size_2)!==null&&y!==void 0?y:22,cr=(v=n==null?void 0:n.dragReorder_color)!==null&&v!==void 0?v:"#666666",fr=(x=n==null?void 0:n.dragReorder_color_opacity)!==null&&x!==void 0?x:"1",Jc=(S=n==null?void 0:n.dragReorder_size)!==null&&S!==void 0?S:20}const tk={get sort_downward(){return{type:"svg",svg:`<svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"> <path d="M4.6665 9H11.3332L7.99984 13.1667L4.6665 9Z" fill="${Uc}"  fill-opacity="${$c}"/><path d="M11.3335 7L4.66683 7L8.00016 2.83333L11.3335 7Z" fill="${ds}" fill-opacity="${us}"/></svg> `,width:ar,height:ar,funcType:Oe.sort,name:"sort_downward",positionType:Ie.contentRight,marginLeft:3,hover:{width:dr,height:dr,bgColor:"rgba(101, 117, 168, 0.1)"},cursor:"pointer"}},get sort_upward(){return{type:"svg",svg:`<svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M4.6665 9H11.3332L7.99984 13.1667L4.6665 9Z" fill="${ds}"  fill-opacity="${us}"/><path d="M11.3335 7L4.66683 7L8.00016 2.83333L11.3335 7Z" fill="${Uc}"  fill-opacity="${$c}"/> </svg>`,width:ar,height:ar,funcType:Oe.sort,positionType:Ie.contentRight,name:"sort_upward",marginLeft:3,hover:{width:dr,height:dr,bgColor:"rgba(101, 117, 168, 0.1)"},cursor:"pointer"}},get sort_normal(){return{type:"svg",svg:`<svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M4.6665 9H11.3332L7.99984 13.1667L4.6665 9Z" fill="${ds}" fill-opacity="${us}"/><path d="M11.3335 7L4.66683 7L8.00016 2.83333L11.3335 7Z" fill="${ds}" fill-opacity="${us}"/></svg> `,width:ar,height:ar,funcType:Oe.sort,positionType:Ie.contentRight,name:"sort_normal",marginLeft:3,hover:{width:dr,height:dr,bgColor:"rgba(101, 117, 168, 0.1)"},cursor:"pointer"}},get freeze(){return{type:"svg",svg:`<svg width="22" height="22" viewBox="0 0 22 22" fill="none" xmlns="http://www.w3.org/2000/svg"><g clip-path="url(#clip0)"><path d="M17.1313 8.42047C17.1932 8.48238 17.2423 8.55587 17.2759 8.63676C17.3094 8.71764 17.3266 8.80434 17.3266 8.89189C17.3266 8.97944 17.3094 9.06613 17.2759 9.14702C17.2423 9.2279 17.1932 9.3014 17.1313 9.3633L13.3843 13.1103C13.7007 14.3048 13.5305 15.4443 12.8388 16.2395C12.8104 16.2781 12.7778 16.3136 12.7417 16.3451L12.712 16.3755C12.6501 16.4374 12.5766 16.4865 12.4957 16.52C12.4148 16.5535 12.3281 16.5707 12.2406 16.5707C12.153 16.5707 12.0663 16.5535 11.9854 16.52C11.9046 16.4865 11.8311 16.4374 11.7692 16.3755L9.17633 13.7826L6.05316 16.9058L5.11983 17.0925C5.09291 17.0979 5.06508 17.0965 5.03881 17.0886C5.01254 17.0806 4.98863 17.0663 4.96923 17.0469C4.94982 17.0275 4.9355 17.0036 4.92755 16.9773C4.9196 16.951 4.91827 16.9232 4.92366 16.8963L5.11033 15.963L8.23333 12.8396L5.64066 10.2471C5.57875 10.1852 5.52964 10.1117 5.49614 10.0309C5.46263 9.94997 5.44539 9.86327 5.44539 9.77572C5.44539 9.68817 5.46263 9.60148 5.49614 9.52059C5.52964 9.43971 5.57875 9.36621 5.64066 9.3043C5.65066 9.2943 5.66066 9.2843 5.67099 9.27464C5.70266 9.2383 5.73833 9.20547 5.77766 9.17664C6.57283 8.48564 7.71199 8.31564 8.90599 8.63197L12.6528 4.88497C12.7147 4.82306 12.7882 4.77395 12.8691 4.74045C12.95 4.70694 13.0367 4.6897 13.1242 4.6897C13.2118 4.6897 13.2985 4.70694 13.3794 4.74045C13.4603 4.77395 13.5338 4.82306 13.5957 4.88497L17.1312 8.42047H17.1313ZM15.7172 8.8918L13.1243 6.29914L9.56483 9.8588C9.47574 9.94788 9.36323 10.0099 9.24034 10.0376C9.11746 10.0654 8.98922 10.0578 8.87049 10.0156C8.22783 9.78764 7.63899 9.7553 7.17749 9.89814L12.1182 14.8388C12.261 14.3771 12.2287 13.7885 12.0007 13.146C11.9585 13.0272 11.9509 12.899 11.9787 12.7761C12.0064 12.6532 12.0684 12.5407 12.1575 12.4516L15.7172 8.89164V8.8918Z" fill="${Kc}" fill-opacity="${Jw}"/></g><defs><clipPath id="clip0"><rect width="22" height="22" fill="white"/></clipPath></defs></svg>`,width:ur,height:ur,name:"freeze",funcType:Oe.frozen,positionType:Ie.right,marginRight:0,hover:{width:hr,height:hr,bgColor:"rgba(101, 117, 168, 0.1)"},cursor:"pointer"}},get frozen(){return{type:"svg",svg:`<svg width="22" height="22" viewBox="0 0 22 22" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M8.49975 3.66663C8.32294 3.66663 8.15337 3.73686 8.02835 3.86189C7.90332 3.98691 7.83309 4.15648 7.83309 4.33329V9.63246C6.76475 10.2533 6.07942 11.1795 6.00625 12.2308C5.99892 12.2786 5.99692 12.3268 6.00009 12.3741L5.99975 12.4166C5.99975 12.5934 6.06999 12.763 6.19501 12.888C6.32004 13.0131 6.48961 13.0833 6.66642 13.0833H10.3333L10.3331 17.5L10.8611 18.292C10.8763 18.3148 10.8969 18.3335 10.9211 18.3464C10.9453 18.3594 10.9723 18.3662 10.9998 18.3662C11.0272 18.3662 11.0542 18.3594 11.0784 18.3464C11.1026 18.3335 11.1232 18.3148 11.1384 18.292L11.6664 17.5L11.6666 13.0833H15.3331C15.5099 13.0833 15.6795 13.0131 15.8045 12.888C15.9295 12.763 15.9998 12.5934 15.9998 12.4166C15.9998 12.4025 15.9998 12.3883 15.9994 12.3741C16.0028 12.3263 16.0008 12.2776 15.9933 12.2295C15.9196 11.1786 15.2343 10.2528 14.1664 9.63229V4.33329C14.1664 4.15648 14.0962 3.98691 13.9712 3.86189C13.8461 3.73686 13.6766 3.66663 13.4998 3.66663H8.49975Z" fill="${Kc}" fill-opacity="${Zw}"/></svg>`,width:ur,height:ur,name:"frozen",funcType:Oe.frozen,positionType:Ie.right,marginRight:0,hover:{width:hr,height:hr,bgColor:"rgba(101, 117, 168, 0.1)"},cursor:"pointer"}},get frozenCurrent(){return{type:"svg",svg:`<svg width="22" height="22" viewBox="0 0 22 22" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M8.49975 3.66663C8.32294 3.66663 8.15337 3.73686 8.02835 3.86189C7.90332 3.98691 7.83309 4.15648 7.83309 4.33329V9.63246C6.76475 10.2533 6.07942 11.1795 6.00625 12.2308C5.99892 12.2786 5.99692 12.3268 6.00009 12.3741L5.99975 12.4166C5.99975 12.5934 6.06999 12.763 6.19501 12.888C6.32004 13.0131 6.48961 13.0833 6.66642 13.0833H10.3333L10.3331 17.5L10.8611 18.292C10.8763 18.3148 10.8969 18.3335 10.9211 18.3464C10.9453 18.3594 10.9723 18.3662 10.9998 18.3662C11.0272 18.3662 11.0542 18.3594 11.0784 18.3464C11.1026 18.3335 11.1232 18.3148 11.1384 18.292L11.6664 17.5L11.6666 13.0833H15.3331C15.5099 13.0833 15.6795 13.0131 15.8045 12.888C15.9295 12.763 15.9998 12.5934 15.9998 12.4166C15.9998 12.4025 15.9998 12.3883 15.9994 12.3741C16.0028 12.3263 16.0008 12.2776 15.9933 12.2295C15.9196 11.1786 15.2343 10.2528 14.1664 9.63229V4.33329C14.1664 4.15648 14.0962 3.98691 13.9712 3.86189C13.8461 3.73686 13.6766 3.66663 13.4998 3.66663H8.49975Z"  fill="${Qw}" fill-opacity="${ey}"/></svg>`,width:ur,height:ur,funcType:Oe.frozen,positionType:Ie.right,name:"frozenCurrent",marginRight:0,hover:{width:hr,height:hr,bgColor:"rgba(101, 117, 168, 0.1)"},cursor:"pointer"}},get dropdownIcon(){return{type:"svg",svg:'<svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><g><rect x="2" y="1" width="20" height="20" rx="10" fill="white"/><rect x="2.5" y="1.5" width="19" height="19" rx="9.5" stroke="#959DA5"/></g><path d="M14.9492 9.39531C15.0086 9.31911 15.0165 9.21887 14.9698 9.1356C14.923 9.05234 14.8294 9 14.7273 9L9.27273 9C9.17057 9 9.07697 9.05234 9.03023 9.1356C8.98348 9.21887 8.99142 9.31911 9.0508 9.39531L11.7781 12.8953C11.8293 12.961 11.9119 13 12 13C12.0881 13 12.1707 12.961 12.2219 12.8953L14.9492 9.39531Z" fill="#4F5965"/></svg>',width:24,height:24,funcType:Oe.dropDown,positionType:Ie.absoluteRight,name:"dropdownIcon",marginRight:0,hover:{width:24,height:24,bgColor:"rgba(101, 117, 168, 0.1)",image:'<svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><g><rect x="2" y="1" width="20" height="20" rx="10" fill="#1E54C9"/><rect x="2.5" y="1.5" width="19" height="19" rx="9.5" stroke="#141414" stroke-opacity="0.2"/></g><path d="M14.9492 9.39531C15.0086 9.31911 15.0165 9.21887 14.9698 9.1356C14.923 9.05234 14.8294 9 14.7273 9L9.27273 9C9.17057 9 9.07697 9.05234 9.03023 9.1356C8.98348 9.21887 8.99142 9.31911 9.0508 9.39531L11.7781 12.8953C11.8293 12.961 11.9119 13 12 13C12.0881 13 12.1707 12.961 12.2219 12.8953L14.9492 9.39531Z" fill="white"/></svg>'},cursor:"pointer",visibleTime:"mouseenter_cell"}},get play(){return{type:"svg",svg:'<svg width="24" height="24" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg"><rect width="48" height="48" fill="white" fill-opacity="0.01" /><path d="M24 44C35.0457 44 44 35.0457 44 24C44 12.9543 35.0457 4 24 4C12.9543 4 4 12.9543 4 24C4 35.0457 12.9543 44 24 44Z" fill="none" stroke="#686a6e" stroke-width="4" stroke-linejoin="round" stroke-opacity="0.7" /><path d="M20 24V17.0718L26 20.5359L32 24L26 27.4641L20 30.9282V24Z" fill="none" stroke="#686a6e" stroke-width="4" stroke-linejoin="round" stroke-opacity="0.7" /></svg>',width:24,height:24,funcType:Oe.play,positionType:Ie.right,name:"play",marginRight:0,hover:{width:24,height:24,bgColor:"rgba(101, 117, 168, 0.1)"},cursor:"pointer"}},get damage_pic(){return{type:"svg",svg:'<svg width="24" height="24" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M5 10V38C5 39.1046 5.89543 40 7 40H14H18L15 29L22 27L21 20L29 16L27 13L30 8H7C5.89543 8 5 8.89543 5 10Z" fill="none" stroke="#333" stroke-width="4" stroke-linecap="round" stroke-linejoin="round"/><path d="M43 38V10C43 8.89543 42.1046 8 41 8H38L34 14L37 19L28 23L29 31L22 33L24 40H41C42.1046 40 43 39.1046 43 38Z" fill="none" stroke="#333" stroke-width="4" stroke-linecap="round" stroke-linejoin="round"/><path fill-rule="evenodd" clip-rule="evenodd" d="M14.5 18C15.3284 18 16 17.3284 16 16.5C16 15.6716 15.3284 15 14.5 15C13.6716 15 13 15.6716 13 16.5C13 17.3284 13.6716 18 14.5 18Z" fill="none" stroke="#333" stroke-width="4" stroke-linecap="round" stroke-linejoin="round"/></svg>',width:24,height:24,funcType:Oe.damagePic,positionType:Ie.left,name:"damage_pic",marginRight:0,hover:{width:24,height:24,bgColor:"rgba(101, 117, 168, 0.1)"},cursor:"pointer"}},get loading_pic(){return{type:"svg",svg:'<svg viewBox="0 0 400 300" fill="none" xmlns="http://www.w3.org/2000/svg"><mask id="a" style="mask-type:alpha" maskUnits="userSpaceOnUse" x="50" y="65" width="301" height="170"><path d="M350.3 65H50v169.8h300.3V65Z" fill="#fff"/></mask><g mask="url(#a)"><path fill-rule="evenodd" clip-rule="evenodd" d="M58.3 233.2h32.8v-36.8H58.3v36.8Z" fill="#C7DEFF"/><path d="M91.1 224.5v8.8H58.3M82.4 196.2H58.3" stroke="#071F4D"/><path fill-rule="evenodd" clip-rule="evenodd" d="M305.4 182.5s-2.7 12.6 0 17.4c2.7 4.8 8.3 6.7 12.4 4.4 4.2-2.4 5.3-8.1 2.6-12.9-2.7-4.8-15-8.9-15-8.9ZM336 204.7c4.3 2 9.7-.4 12-5.4 2.3-5-1.5-17.3-1.5-17.3s-11.8 5.1-14.1 10.1c-2.3 5-.7 10.6 3.6 12.6Z" fill="#00E4E5"/><path fill-rule="evenodd" clip-rule="evenodd" d="M326.7 174s-10 11.8-10 18.6c0 6.7 4.5 12.2 10 12.2s10-5.5 10-12.3c0-6.8-10-18.5-10-18.5Z" fill="#00E4E5"/><path d="M332.3 181.5c2.3 3.6 4.4 7.8 4.4 10.9M316.7 192.5c0-3.1 2.1-7.2 4.3-10.8" stroke="#071F4D"/><path fill-rule="evenodd" clip-rule="evenodd" d="M343.1 227.3v-9.7h-34v9.7c0 3.7 3 6.6 6.6 6.6h20.9c3.6 0 6.5-2.9 6.5-6.6Z" fill="#071F4D"/><path fill-rule="evenodd" clip-rule="evenodd" d="M350.4 220.8V198H302v22.8c0 5.9 4.8 10.7 10.7 10.7h26.9c5.9 0 10.7-4.8 10.8-10.7Z" fill="#C7DEFF"/><path fill-rule="evenodd" clip-rule="evenodd" d="M331.7 74.2H117.8L87.4 203h213.8l30.5-128.8Z" fill="#fff"/><path fill-rule="evenodd" clip-rule="evenodd" d="M337 74.2h-6.2l-30.6 129.2h6.2L337 74.2Z" fill="#fff"/><path fill-rule="evenodd" clip-rule="evenodd" d="M303.8 203.5h2.4l30.7-129.3h-1.8l-31.3 129.3Z" fill="#C7DEFF"/><path d="m337 74.2-30.6 129.2h-5.9" stroke="#071F4D"/><path fill-rule="evenodd" clip-rule="evenodd" d="M229.9 202.1h-47.6l2 9.6h47.3l-1.7-9.6Z" fill="#C7DEFF"/><path fill-rule="evenodd" clip-rule="evenodd" d="M94.7 172.6 87.4 203h213.1l7.8-30.4H94.7Z" fill="#006EFF"/><path fill-rule="evenodd" clip-rule="evenodd" d="M94.7 172.6 87.4 203h213.1l7.8-30.4H94.7Z" fill="#006EFF"/><path d="M138.5 74.2h193.2l-23.4 98.6M94.5 172.7l11-46.3M104.8 155.4l-2.3 11.5h6.7M316 112.1l1.1-4.5" stroke="#071F4D"/><path fill-rule="evenodd" clip-rule="evenodd" d="M148.3 138.1h97V119h-97v19.1Z" fill="#00E4E5"/><path d="M303.1 80.6h20.3l-4.6 19.6M228.3 234.3c3.6 0 6.3-3.2 5.7-6.8l-4.1-24.1" stroke="#071F4D"/><path fill-rule="evenodd" clip-rule="evenodd" d="M226.2 229.5h-68.9v1.2c0 2 1.6 3.7 3.7 3.7h60.1c2.8 0 5-2.2 5.1-4.9Z" fill="#C7DEFF"/><path d="M180.699 226.8h-19.9c-2.8 0-4.6 3-3.3 5.5m0 0c.6 1.2 1.9 2 3.3 2h57.8M175.9 203.4l3.6 17.6M241.2 234.3h65.1M104.6 234.3h41.3" stroke="#071F4D"/><path d="M206.2 234.3h14.9c3.1 0 5.5-2.8 5-5.9l-4.3-24.9M160.7 226.8h46M62.2 226.1h-9.5c-1.2 0-2.2-1-2.2-2.2v-18.3c0-1.2 1-2.2 2.2-2.2h9.5" stroke="#071F4D"/><path d="M53.4 171.7H68c2.1 0 3.7 1.7 3.7 3.7v16.1M79.1 192v-21.8c0-2.5 2-4.6 4.6-4.6h2.2c2.5 0 4.5-2 4.5-4.5m0 0c0-2.5-2-4.5-4.5-4.5H56.1c-2.4 0-4.3-1.9-4.3-4.3V148M71.2 165.2h-18M64 181.7v10.1" stroke="#C7DEFF"/><path fill-rule="evenodd" clip-rule="evenodd" d="M85.7 120H124c4.3 0 7.7-3.5 7.7-7.7V65.5H94.2c-4.7 0-8.5 4.9-8.5 11V120Z" fill="#C7DEFF"/><path d="M85.7 110.7V73c0-4.1 3.4-7.5 7.5-7.5h38.5M146.2 73.8v-2.5c0-3.2-2-5.8-5.8-5.8-2.8 0-6 1.1-6 5.8v42.4c0 4.7-3.8 8.5-8.5 8.5h-15.6" stroke="#071F4D"/><path d="M119.7 122.3H87c-6.1 0-11.1-5-11.1-11.1m0 0h39M126.1 122.3c-6.1 0-11.1-5-11.1-11.1" stroke="#071F4D"/><path fill-rule="evenodd" clip-rule="evenodd" d="M85.4 122.1h37.2c-6.5-1.8-8-10.5-8-10.5H76.2c.6 8.8 9.2 10.5 9.2 10.5Z" fill="#071F4D"/><path fill-rule="evenodd" clip-rule="evenodd" d="M95.8 102.9h4.8V83.6h-4.8v19.3ZM106.6 102.9h4.8V77.6h-4.8v25.3ZM117.3 102.9h4.8V89.1h-4.8v13.8Z" fill="#fff"/><path d="M273.2 195.9h16.9M261.2 195.9h5" stroke="#fff"/><path d="M62.4 201.9v2.9M62.4 224.5v2.9" stroke="#071F4D"/><path d="m153.6 138.1 9.7-19.1M168.8 138.1l9.7-19.1M184.1 138.1l9.7-19.1M199.4 138.1l9.7-19.1M214.6 138.1l9.8-19.1M229.9 138.1l9.7-19.1" stroke="#fff"/><path d="M148.3 138.1h121.6V119H148.3v19.1Z" stroke="#071F4D"/></g></svg>',width:400,height:300,name:"loading_pic",positionType:Ie.left}},get expand(){return{type:"svg",svg:`<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16" fill="none">
      <path d="M4.64988 6.81235C4.38797 6.48497 4.62106 6 5.04031 6L10.9597 6C11.3789 6 11.612 6.48497 11.3501 6.81235L8.39043 10.512C8.19027 10.7622 7.80973 10.7622 7.60957 10.512L4.64988 6.81235Z" fill="${iy}" fill-opacity="${ry}"/>
      </svg>`,width:qc,height:qc,funcType:Oe.expand,name:"expand",positionType:Ie.contentLeft,marginLeft:0,marginRight:4,hover:{width:Zc,height:Zc,bgColor:"rgba(101, 117, 168, 0.1)"},cursor:"pointer"}},get collapse(){return{type:"svg",svg:`<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16" fill="none">
      <path d="M5.81235 11.3501C5.48497 11.612 5 11.3789 5 10.9597L5 5.04031C5 4.62106 5.48497 4.38797 5.81235 4.64988L9.51196 7.60957C9.76216 7.80973 9.76216 8.19027 9.51196 8.39044L5.81235 11.3501Z"  fill="${ty}" fill-opacity="${ny}"/>
      </svg>`,width:Yc,height:Yc,funcType:Oe.collapse,name:"collapse",positionType:Ie.contentLeft,marginLeft:0,marginRight:4,hover:{width:Xc,height:Xc,bgColor:"rgba(101, 117, 168, 0.1)"},cursor:"pointer"}},get drillDown(){return{name:"drillDown",type:"svg",positionType:Ie.absolute,funcType:Oe.drillDown,svg:q2,width:13,height:13,cursor:"pointer"}},get drillUp(){return{name:"drillUp",type:"svg",positionType:Ie.absolute,funcType:Oe.drillUp,svg:Z2,width:13,height:13,cursor:"pointer"}},get dragReorder(){return{type:"svg",svg:`<svg t="1710129136961" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="5166" width="200" height="200"><path d="M362.666667 192m-64 0a64 64 0 1 0 128 0 64 64 0 1 0-128 0Z" fill="${cr}"  fill-opacity="${fr}" p-id="5167"></path><path d="M661.333333 192m-64 0a64 64 0 1 0 128 0 64 64 0 1 0-128 0Z" fill="${cr}"  fill-opacity="${fr}" p-id="5168"></path><path d="M362.666667 512m-64 0a64 64 0 1 0 128 0 64 64 0 1 0-128 0Z" fill="${cr}"  fill-opacity="${fr}" p-id="5169"></path><path d="M661.333333 512m-64 0a64 64 0 1 0 128 0 64 64 0 1 0-128 0Z" fill="${cr}"  fill-opacity="${fr}" p-id="5170"></path><path d="M362.666667 832m-64 0a64 64 0 1 0 128 0 64 64 0 1 0-128 0Z" fill="${cr}"  fill-opacity="${fr}" p-id="5171"></path><path d="M661.333333 832m-64 0a64 64 0 1 0 128 0 64 64 0 1 0-128 0Z" fill="${cr}"  fill-opacity="${fr}" p-id="5172"></path></svg>`,width:Jc,height:Jc,funcType:Oe.dragReorder,positionType:Ie.left,name:"dragReorder",marginLeft:-10,marginRight:10,cursor:"grab"}}};function Vn(){return ul(tk,ek)}class Pe extends jn{clear(){this.removeAllChild()}getChildByName(e,t){let i=null;return this.forEachChildren(r=>r.name===e&&(i=r,!0)),t&&this.forEachChildren(r=>{if(r.getChildByName){const o=r.getChildByName(e,!0);if(o)return i=o,!0}return!1}),i}get width(){var e;let t=this.AABBBounds.width();return t!==1/0&&t!==-1/0||(t=0),Math.max(t,(e=this.attribute.width)!==null&&e!==void 0?e:0)}get height(){var e;let t=this.AABBBounds.height();return t!==1/0&&t!==-1/0||(t=0),Math.max(t,(e=this.attribute.height)!==null&&e!==void 0?e:0)}setDeltaWidth(e){var t;e!==0&&(this.setAttribute("width",((t=this.attribute.width)!==null&&t!==void 0?t:0)+e),this.border&&(this.border.setAttribute("width",this.border.attribute.width+e),this.border.type==="group"&&this.border.firstChild.setAttribute("width",this.border.firstChild.attribute.width+e)))}setDeltaHeight(e){var t;e!==0&&(this.setAttribute("height",((t=this.attribute.height)!==null&&t!==void 0?t:0)+e),this.border&&(this.border.setAttribute("height",this.border.attribute.height+e),this.border.type==="group"&&this.border.firstChild.setAttribute("width",this.border.firstChild.attribute.height+e)))}setDeltaX(e){e!==0&&this.setAttribute("x",this.attribute.x+e)}setDeltaY(e){e!==0&&this.setAttribute("y",this.attribute.y+e)}forEachChildrenSkipChild(e,t="border-rect",i=!1){if(i){let r=this._lastChild,o=0;for(;r;){if(r.name!==t&&e(r,o++))return;r=r._prev}}else{let r=this._firstChild,o=0;for(;r;){if(r.name!==t&&e(r,o++))return;r=r._next}}}getColGroup(e){let t=this._firstChild;if(!t)return null;for(let i=0;i<this.childrenCount;i++){if(t.col===e)return t;t=t._next}return null}getRowGroup(e){let t=this._firstChild;if(!t)return null;for(let i=0;i<this.childrenCount;i++){if(t.row===e)return t;t=t._next}return null}addCellGroup(e){if(this.childrenCount===0||this.lastChild.row===e.row-1)this.addChild(e);else{let t=this._firstChild;for(let i=0;i<this.childrenCount;i++){if(t.row===e.row-1)return void this.insertAfter(e,t);t=t._next}this.addChild(e)}}getChildAt(e){const t=super.getChildAt(e);return t&&t.name==="border-rect"?t._next:t}tryUpdateAABBBounds(){if(this.role==="cell"){if(!this.shouldUpdateAABBBounds())return this._AABBBounds;const e=this.shouldSelfChangeUpdateAABBBounds(),t=this.doUpdateAABBBounds();return this.addUpdateLayoutTag(),nk(this,e),t}return super.tryUpdateAABBBounds()}doUpdateAABBBounds(){if(this.role==="cell"){const e=this.attribute,{x:t,y:i,width:r,height:o}=e;return this._AABBBounds.setValue(t,i,t+r,i+o),this.parent&&this.parent.addChildUpdateBoundTag(),this.clearUpdateBoundTag(),this.shadowRoot&&this.shadowRoot.tryUpdateAABBBounds(),this._AABBBounds}return this.role==="body"||this.role==="row-header"||this.role==="col-header"||this.role==="right-frozen"||this.role==="bottom-frozen"||this.role==="corner-header"||this.role==="corner-right-top-header"||this.role==="corner-right-bottom-header"||this.role==="corner-left-bottom-header"?(this._AABBBounds.setValue(-1/0,-1/0,1/0,1/0),this.parent&&this.parent.addChildUpdateBoundTag(),this.clearUpdateBoundTag(),this.shadowRoot&&this.shadowRoot.tryUpdateAABBBounds(),this._AABBBounds):super.doUpdateAABBBounds()}updateColumnRowNumber(e){this.rowNumber?this.rowNumber=Math.max(this.rowNumber,e):this.rowNumber=e}updateColumnHeight(e){this.colHeight?this.colHeight+=e:this.colHeight=e}}function nk(n,e){n.stage&&n.stage.dirtyBounds&&n.stage.renderCount&&(n.isContainer&&!e||n.stage.dirty(n.globalAABBBounds))}function xu(n,e,t,i){const r=n/e;let o,s;return r>t/i?(o=t,s=o/r,(i-s)/2):(s=i,o=s*r,(t-o)/2),{width:o,height:s}}function Jf(n,e,t,i,r,o,s="left",l="middle",a=[0,0,0,0],d=0,u=0,h=0,c=0){const g=n+t,f=e+i;let p=n+a[3]+d;s==="right"||s==="end"?p=g-r-a[1]-u:s==="center"&&(p=n+(t-r+d-u)/2);let m=e+a[0]+h;return l==="bottom"||l==="alphabetic"||l==="ideographic"?m=f-o-a[2]-c:l==="middle"&&(m=e+(i-o+h-c)/2),{x:p,y:m}}function Z(n,e,t,i,r){const o=e&&O(e[n])?e[n]:void 0;return typeof o=="function"?o({col:t,row:i,table:r,value:r.getCellValue(t,i),dataValue:r.getCellOriginValue(t,i),cellHeaderPaths:r.getCellHeaderPaths(t,i)}):o}function Ru(n,e,t,i,r){const o=e&&O(e[n])?e[n]:void 0;if(typeof o=="function")return o({col:t,row:i,table:r,value:r.getCellValue(t,i),dataValue:r.getCellOriginValue(t,i),cellHeaderPaths:r.getCellHeaderPaths(t,i)})}function oi(n,e,t,i){var r,o,s,l,a,d,u,h,c,g,f,p,m,b,C,_,w,y;let v=(o=(r=t==null?void 0:t.group)===null||r===void 0?void 0:r.strokeArrayWidth)!==null&&o!==void 0?o:void 0;return i.theme.cellInnerBorder||!h2(i.theme.frameStyle.borderLineWidth)||c2(i.theme.frameStyle.borderLineWidth)||(n===0&&(v=v??[(s=t==null?void 0:t.group)===null||s===void 0?void 0:s.lineWidth,(l=t==null?void 0:t.group)===null||l===void 0?void 0:l.lineWidth,(a=t==null?void 0:t.group)===null||a===void 0?void 0:a.lineWidth,(d=t==null?void 0:t.group)===null||d===void 0?void 0:d.lineWidth],v[3]=0),n===i.colCount-1&&(v=v??[(u=t==null?void 0:t.group)===null||u===void 0?void 0:u.lineWidth,(h=t==null?void 0:t.group)===null||h===void 0?void 0:h.lineWidth,(c=t==null?void 0:t.group)===null||c===void 0?void 0:c.lineWidth,(g=t==null?void 0:t.group)===null||g===void 0?void 0:g.lineWidth],v[1]=0),e===0&&(v=v??[(f=t==null?void 0:t.group)===null||f===void 0?void 0:f.lineWidth,(p=t==null?void 0:t.group)===null||p===void 0?void 0:p.lineWidth,(m=t==null?void 0:t.group)===null||m===void 0?void 0:m.lineWidth,(b=t==null?void 0:t.group)===null||b===void 0?void 0:b.lineWidth],v[0]=0),e===i.rowCount-1&&(v=v??[(C=t==null?void 0:t.group)===null||C===void 0?void 0:C.lineWidth,(_=t==null?void 0:t.group)===null||_===void 0?void 0:_.lineWidth,(w=t==null?void 0:t.group)===null||w===void 0?void 0:w.lineWidth,(y=t==null?void 0:t.group)===null||y===void 0?void 0:y.lineWidth],v[2]=0)),v}class ik extends Pe{constructor(e){super(e),this._autoWidth=!1,this._autoHeight=!1,this._leftGroup=new Pe({pickable:!1,fill:!1,stroke:!1}),this._leftGroup.role="content-left",this._rightGroup=new Pe({pickable:!1,fill:!1,stroke:!1}),this._rightGroup.role="content-right",this._centerGroup=new Pe({pickable:!1,fill:!1,stroke:!1}),this._centerGroup.role="content-center",this.appendChild(this._leftGroup),this.appendChild(this._rightGroup),this.appendChild(this._centerGroup)}setCellContentOption(e){this._autoWidth=e.autoWidth,this._autoHeight=e.autoHeight,this._cellWidth=e.cellWidth,this._originCellWidth=e.cellWidth,this._cellHeight=e.cellHeight,this._align=e.align,this._baseline=e.baseline}addLeftOccupyingIcon(e){var t,i,r;e.setAttribute("x",this._leftGroup.width+((t=e.attribute.marginLeft)!==null&&t!==void 0?t:0)),this._leftGroup.appendChild(e),this._leftGroup.setDeltaWidth(((i=e.attribute.marginLeft)!==null&&i!==void 0?i:0)+((r=e.attribute.marginRight)!==null&&r!==void 0?r:0)+e.attribute.width)}addRightOccupyingIcon(e){var t,i,r;e.setAttribute("x",this._rightGroup.width+((t=e.attribute.marginLeft)!==null&&t!==void 0?t:0)),this._rightGroup.appendChild(e),this._rightGroup.setDeltaWidth(((i=e.attribute.marginLeft)!==null&&i!==void 0?i:0)+((r=e.attribute.marginRight)!==null&&r!==void 0?r:0)+e.attribute.width)}addContent(e){const t=this._centerGroup.lastChild;t&&e.setAttributes({x:t.attribute.x+t.AABBBounds.width()}),this._centerGroup.appendChild(e),e instanceof Rt&&(this._centerGroup.setAttribute("pickable",!1),e.setAttribute("textAlign","left"))}layout(){let e=this._leftGroup.width;e===1/0&&(e=0);let t=this._rightGroup.width;if(t===-1/0&&(t=0),this._autoWidth){const s=this._centerGroup.width;this._cellWidth=e+t+s,this.setAttribute("width",this._cellWidth)}else{const s=this._cellWidth-e-t;this.updateCenterLayout(s);const l=this._centerGroup.width;this._cellWidth=e+t+l,this.setAttribute("width",this._cellWidth)}this.updateHorizontalPos();const i=this._leftGroup.height,r=this._rightGroup.height,o=this._centerGroup.height;this._cellHeight=Math.max(i,r,o),this.setAttribute("height",this._cellHeight),this.updateVerticalPos()}updateCenterLayout(e){let t=e;this._centerGroup.forEachChildren(o=>{(o instanceof Lr||o instanceof Kw)&&(t-=o.AABBBounds.width())});const i=this._centerGroup.getChildByName("text");i instanceof Wn?i.setAttribute("width",t):i instanceof Rt&&i.setAttribute("maxLineWidth",t);let r=0;this._centerGroup.forEachChildren(o=>{o.setAttribute("x",r),r+=o.AABBBounds.width()})}updateHorizontalPos(){this._leftGroup.setAttribute("x",0),this._rightGroup.setAttribute("x",this._cellWidth-this._rightGroup.width),this._centerGroup.setAttribute("x",this._leftGroup.width),this._align==="left"||this._align==="start"?this.setAttribute("dx",0):this._align==="center"?this.setAttribute("dx",-this.attribute.width/2):this._align!=="right"&&this._align!=="end"||this.setAttribute("dx",-this.attribute.width)}updateVerticalPos(){this._baseline==="top"?(this._leftGroup.setAttribute("y",0),this._rightGroup.setAttribute("y",0),this._centerGroup.setAttribute("y",0)):this._baseline==="middle"?(this._leftGroup.forEachChildren(e=>{e.setAttribute("y",(this._leftGroup.height-e.AABBBounds.height())/2)}),this._rightGroup.forEachChildren(e=>{e.setAttribute("y",(this._rightGroup.height-e.AABBBounds.height())/2)}),this._leftGroup.setAttribute("y",this._cellHeight/2-this._leftGroup.height/2),this._rightGroup.setAttribute("y",this._cellHeight/2-this._rightGroup.height/2),this._centerGroup.setAttribute("y",this._cellHeight/2-this._centerGroup.height/2)):this._baseline==="bottom"&&(this._leftGroup.forEachChildren(e=>{e.setAttribute("y",this._leftGroup.height-e.AABBBounds.height())}),this._rightGroup.forEachChildren(e=>{e.setAttribute("y",this._rightGroup.height-e.AABBBounds.height())}),this._leftGroup.setAttribute("y",this._cellHeight-this._leftGroup.height),this._rightGroup.setAttribute("y",this._cellHeight-this._rightGroup.height),this._centerGroup.setAttribute("y",this._cellHeight-this._centerGroup.height))}updateWidth(e){this._cellWidth=e,this._originCellWidth=e,this.layout()}updateHeight(e){this._cellHeight=e,this._cellWidth=this._originCellWidth;const t=this.getChildByName("text",!0);t&&t.setAttribute("heightLimit",e),this.layout()}}function cn(n,e,t){var i,r,o,s,l;let a=0;const d=t.internalProps.layoutMap;if(d.isHeader(n,e)){const u=d.getHeader(n,e);O(u==null?void 0:u.hierarchyLevel)&&(a=((i=u.hierarchyLevel)!==null&&i!==void 0?i:0)*(d.rowHierarchyType==="tree"&&(r=d.rowHierarchyIndent)!==null&&r!==void 0?r:0),d.rowHierarchyTextStartAlignment&&!t.internalProps.headerHelper.getHierarchyIcon(n,e)&&(a+=t.internalProps.headerHelper.getHierarchyIconWidth()))}else if(t.options.groupBy||!((o=t.getBodyColumnDefine(n,e))===null||o===void 0)&&o.tree){const u=t.dataSource.getIndexKey(t.getRecordShowIndexByCell(n,e)),h=(s=t.dataSource.getGroupLength())!==null&&s!==void 0?s:0;let c=ee(u)?u.length-1:0;h>0&&c===h&&(c=0),a=Array.isArray(u)&&t.getHierarchyState(n,e)!==be.none?c*((l=d.hierarchyIndent)!==null&&l!==void 0?l:0):0,d.hierarchyTextStartAlignment&&!t.internalProps.bodyHelper.getHierarchyIcon(n,e)&&(a+=t.internalProps.bodyHelper.getHierarchyIconWidth())}return a}function Xs(n,e){var t,i;let r,o=!1;for(je(n)&&n.length>(e.options.maxCharactersNumber||200)&&(n=n.slice(0,e.options.maxCharactersNumber||200),n+="…",o=!0),r=e.internalProps.enableLineBreak||!((t=e.options.customConfig)===null||t===void 0)&&t.multilinesForXTable?Ab(n).replace(/\r?\n/g,`
`).replace(/\r/g,`
`).split(`
`)||[]:[Ab(n)];r.length&&r.length>1&&!r[r.length-1];)r.pop();if(!((i=e.options.customConfig)===null||i===void 0)&&i.multilinesForXTable&&!e.internalProps.autoWrapText)for(;r.length&&r.length>1&&!r[0];)r.shift();return{text:r,moreThanMaxCharacters:o}}function rk(n,e,t,i,r,o,s,l,a,d,u,h,c,g,f){var p,m,b,C,_,w,y,v,x;let S,R=0,B=0,A=0;if(Array.isArray(e)&&e.length!==0){const{inlineFrontIcons:E,inlineEndIcons:T,contentLeftIcons:P,contentRightIcons:k,leftIconWidth:L,rightIconWidth:F,absoluteRightIconWidth:z}=Do(e,n,f,c);let I;if(R=L,B=F,A=z,E.length===0&&T.length===0){let N=0;J(c.theme._contentOffset)&&(u==="left"?N=c.theme._contentOffset:u==="right"&&(N=-c.theme._contentOffset));const W=f?cn(f.start.col,f.start.row,c):cn(n.col,n.row,c),{text:D,moreThanMaxCharacters:G}=Xs(t,c),V={text:D.length===1?D[0]:D,moreThanMaxCharacters:G,maxLineWidth:r?1/0:a-(i[1]+i[3])-R-B-W,textBaseline:"top",heightLimit:((C=c.options.customConfig)===null||C===void 0?void 0:C.limitContentHeight)===!1||o&&!(!((_=c.options.customConfig)===null||_===void 0)&&_.multilinesForXTable)?-1:d-Math.floor(i[0]+i[2]),pickable:!1,autoWrapText:s,lineClamp:l,wordBreak:"break-word",whiteSpace:((w=c.options.customConfig)===null||w===void 0?void 0:w.limitContentHeight)===!1||D.length!==1||s?"normal":"no-wrap",dx:(u==="left"?P.length?0:W:0)+N,keepCenterInLine:!0},X=new Rt(g.text?Object.assign({},g.text,V):V);X.name="text",I=X}else{const N=Object.assign({text:t==null?void 0:t.toString()},((x=(v=(y=n.parent)===null||y===void 0?void 0:y.theme)===null||v===void 0?void 0:v.userTheme)===null||x===void 0?void 0:x.text)||{});g.text&&Object.assign(N,g.text),N.textBaseline="middle";const W=[...E.map(G=>cd(G)),N,...T.map(G=>cd(G))];W[0].textAlign=u;const D=new Wn({width:r?0:a-(i[1]+i[3])-R-B,height:o&&s?0:Math.ceil(d-(i[0]+i[2])),textConfig:W,verticalDirection:o&&s?"top":h,ellipsis:N.ellipsis});D.name="text",I=D,D.bindIconEvent(),!f||f.start.col===f.end.col&&f.start.row===f.end.row||(D.onBeforeAttributeUpdate=sk)}if(P.length!==0||k.length!==0){const N=new ik({x:0,y:0,fill:!1,stroke:!1,pickable:!1});N.name="content",N.setCellContentOption({autoWidth:r,autoHeight:o,cellWidth:a-(i[1]+i[3])-R-B,cellHeight:d-(i[0]+i[2]),align:u,baseline:h});const W={addedHierarchyOffset:0};P.forEach(D=>{const G=xn(D,void 0,n.col,n.row,f,c,W);G.role="icon-content-left",G.name=D.name,N.addLeftOccupyingIcon(G)}),k.forEach(D=>{const G=xn(D,void 0,n.col,n.row,f,c,W);G.role="icon-content-right",G.name=D.name,N.addRightOccupyingIcon(G)}),N.addContent(I),n.appendChild(N),N.layout(),S=N.AABBBounds.width(),N.AABBBounds.height()}else n.firstChild?n.insertBefore(I,n.firstChild):n.appendChild(I),S=I.AABBBounds.width(),I.AABBBounds.height()}else if(O(t)){const{text:E,moreThanMaxCharacters:T}=Xs(t,c),P=f?cn(f.start.col,f.start.row,c):cn(n.col,n.row,c);let k=0;J(c.theme._contentOffset)&&(u==="left"?k=c.theme._contentOffset:u==="right"&&(k=-c.theme._contentOffset));const L={text:E.length===1?E[0]:E,moreThanMaxCharacters:T,maxLineWidth:r?1/0:a-(i[1]+i[3]+P),textBaseline:"top",autoWrapText:s,lineClamp:l,wordBreak:"break-word",heightLimit:((p=c.options.customConfig)===null||p===void 0?void 0:p.limitContentHeight)===!1||o&&!(!((m=c.options.customConfig)===null||m===void 0)&&m.multilinesForXTable)?-1:d-Math.floor(i[0]+i[2]),pickable:!1,dx:(u==="left"?P:0)+k,whiteSpace:((b=c.options.customConfig)===null||b===void 0?void 0:b.limitContentHeight)===!1||E.length!==1||s?"normal":"no-wrap",keepCenterInLine:!0},F=new Rt(g.text?Object.assign({},g.text,L):L);F.name="text",F.textBaseline=h,n.appendChild(F),S=F.AABBBounds.width(),F.AABBBounds.height()}const M=r?R+S+B:a-(i[1]+i[3]),H=d-(i[0]+i[2]);n.forEachChildren(E=>{E.role==="icon-left"?E.setAttribute("x",E.attribute.x+i[3]):E.role==="icon-right"?E.setAttribute("x",E.attribute.x+M-B+i[3]):E.role==="icon-absolute-right"?E.setAttribute("x",E.attribute.x+M-A+i[3]+i[1]):E.name!=="content"&&E.name!=="text"||(u==="center"&&E.type!=="richtext"?E.setAttribute("x",i[3]+R+(M-R-B)/2):u==="right"&&E.type!=="richtext"?E.setAttribute("x",i[3]+M-B):E.setAttribute("x",i[3]+R))}),n.forEachChildren(E=>{E.name!==ti&&(h==="middle"?E.setAttribute("y",i[0]+(H-E.AABBBounds.height())/2):h==="bottom"?E.setAttribute("y",i[0]+H-E.AABBBounds.height()):E.setAttribute("y",i[0]))}),n.setAttributes({width:M+i[1]+i[3],height:H+i[0]+i[2]})}function xn(n,e,t,i,r,o,s){var l,a,d,u,h,c;const g={};n.type==="image"?(n.isGif&&(g.gif=n.src),g.image=n.src):(n.type==="svg"||"svg"in n)&&(g.image=n.svg),g.width=n.width,g.height=n.height,g.visibleTime=(l=n.visibleTime)!==null&&l!==void 0?l:"always",g.funcType=n.funcType,g.interactive=n.interactive,g.isGif=n.isGif;let f,p=0;return s&&(s==null?void 0:s.addedHierarchyOffset)!==0||!J(t)||!J(i)||!o||n.funcType!==Oe.collapse&&n.funcType!==Oe.expand&&n.positionType!==Ie.contentLeft&&n.positionType!==Ie.contentRight||(p=r?cn(r.start.col,r.start.row,o):cn(t,i,o),s&&(s.addedHierarchyOffset=1)),g.marginLeft=((a=n.marginLeft)!==null&&a!==void 0?a:0)+p,g.marginRight=(d=n.marginRight)!==null&&d!==void 0?d:0,n.interactive===!1&&(g.pickable=!1),n.hover&&(g.backgroundWidth=(u=n.hover.width)!==null&&u!==void 0?u:n.width,g.backgroundHeight=(h=n.hover.width)!==null&&h!==void 0?h:n.width,g.backgroundColor=(c=n.hover.bgColor)!==null&&c!==void 0?c:"rgba(22,44,66,0.2)",g.hoverImage=n.hover.image),n.cursor&&(g.cursor=n.cursor),"shape"in n&&n.shape==="circle"&&(g.shape=n.shape),e?(e.setAttributes(g),e.loadImage(g.image),e.tooltip=n.tooltip,e.name=n.name,e):(n.type==="text"?(g.text=n.content,re(g,n.style),f=new Kw(g),f.tooltip=n.tooltip,f.name=n.name):(f=new Lr(g),f.tooltip=n.tooltip,f.name=n.name),f)}function cd(n){var e,t,i,r,o,s;const l={};return n.type==="image"?l.image=n.src:(n.type==="svg"||"svg"in n)&&(l.image=n.svg),l.visibleTime=(e=n.visibleTime)!==null&&e!==void 0?e:"always",l.funcType=n.funcType,l.id=n.name,l.width=n.width,l.height=n.height,(n.marginRight||n.marginLeft)&&(l.margin=[0,(t=n.marginRight)!==null&&t!==void 0?t:0,0,(i=n.marginLeft)!==null&&i!==void 0?i:0]),n.hover&&(l.backgroundWidth=(r=n.hover.width)!==null&&r!==void 0?r:n.width,l.backgroundHeight=(o=n.hover.height)!==null&&o!==void 0?o:n.height,l.backgroundShowMode="hover",l.hoverImage=n.hover.image,l.backgroundStroke=!1,l.backgroundFill=(s=n.hover.bgColor)!==null&&s!==void 0?s:"rgba(22,44,66,0.2)"),n.cursor&&(l.cursor=n.cursor),l.tooltip=n.tooltip,l}function fd(n,e,t,i,r,o,s,l,a){var d,u,h,c;Xe(n.contentWidth)&&(i=e-((d=n.contentWidth)!==null&&d!==void 0?d:n.attribute.width));let g,f=0,p=0,m=0,b=0;n.forEachChildren(v=>{var x,S,R,B;v.role==="icon-left"?(f+=v.AABBBounds.width()+((x=v.attribute.marginLeft)!==null&&x!==void 0?x:0)+((S=v.attribute.marginRight)!==null&&S!==void 0?S:0),p=Math.max(p,v.AABBBounds.height())):v.role==="icon-right"&&(m+=v.AABBBounds.width()+((R=v.attribute.marginLeft)!==null&&R!==void 0?R:0)+((B=v.attribute.marginRight)!==null&&B!==void 0?B:0),b=Math.max(b,v.AABBBounds.height()))});const C=n.getChildByName("text"),_=n.getChildByName("content");let w;C instanceof Rt?(g=C.AABBBounds.height(),C.setAttribute("maxLineWidth",e-f-m-(o[1]+o[3])-((u=C.attribute.dx)!==null&&u!==void 0?u:0)-((h=a.table.theme._contentOffset)!==null&&h!==void 0?h:0)),w=C.AABBBounds.height()):C instanceof Wn?(g=C.AABBBounds.height(),C.setAttribute("width",e-f-m-(o[1]+o[3])),w=C.AABBBounds.height()):_&&(g=_.AABBBounds.height(),_.updateWidth(e-f-m-(o[1]+o[3])),w=_.AABBBounds.height());const y=Math.round(Math.max(p,b,g)+o[0]+o[2]);if(n.forEachChildren(v=>{var x;if(v.role!=="icon-left")if(v.role==="icon-right")v.setAttribute("x",v.attribute.x+i);else if(v.role==="icon-absolute-right")v.setAttribute("x",v.attribute.x+i);else if(v.name==="content"||v.name==="text"&&v.type!=="richtext"){const S=(x=v.attribute.textAlign)!==null&&x!==void 0?x:s;S==="center"?v.setAttribute("x",o[3]+f+(e-(o[1]+o[3])-f-m)/2):S==="right"&&v.setAttribute("x",o[3]+e-(o[1]+o[3])-m)}else v.name==="mark"&&v.setAttribute("x",n.attribute.width)}),r){let v=Math.max(p,w,b);if(ok(a,n,Math.round(v+o[0]+o[2]),y))return!0;v=((c=n.contentHeight)!==null&&c!==void 0?c:t)-(o[0]+o[2]),n.forEachChildren(x=>{x.type!=="rect"&&x.type!=="chart"&&x.name!==ti&&(x.name==="mark"?x.setAttribute("y",0):l==="middle"?x.setAttribute("y",o[0]+(v-x.AABBBounds.height())/2):l==="bottom"?x.setAttribute("y",o[0]+v-x.AABBBounds.height()):x.setAttribute("y",o[0]))})}else l!=="middle"&&l!=="bottom"||n.forEachChildren(v=>{v.type!=="rect"&&v.type!=="chart"&&v.name!==ti&&(v.name==="mark"?v.setAttribute("y",0):l==="middle"?v.setAttribute("y",(t-o[2]+o[0]-v.AABBBounds.height())/2):l==="bottom"?v.setAttribute("y",t-v.AABBBounds.height()-o[2]):v.setAttribute("y",o[0]))});return!1}function gd(n,e,t,i,r,o,s,l){var a;const d=e-Math.floor(r[0]+r[2]),u=n.getChildByName("text");u instanceof Rt&&!i?u.setAttributes({heightLimit:((a=l.options.customConfig)===null||a===void 0?void 0:a.limitContentHeight)===!1?-1:d}):u instanceof Wn&&!i?u.setAttributes({height:d}):n.getChildByName("content")&&n.getChildByName("content").updateHeight(d),n.forEachChildren(h=>{h.setAttribute("dy",0),h.type==="rect"||h.type==="chart"||h.name===ti||(h.name==="mark"?h.setAttribute("y",0):s==="middle"?h.setAttribute("y",r[0]+(d-h.AABBBounds.height())/2):s==="bottom"?h.setAttribute("y",r[0]+d-h.AABBBounds.height()):h.setAttribute("y",r[0]))})}function ok(n,e,t,i){const r=n.table,o=at(r,e.col,e.row);if(o&&o.end.row-o.start.row){i/=o.end.row-o.start.row+1,t/=o.end.row-o.start.row+1;for(let s=o.start.row;s<=o.end.row;s++){const l=r.getRowHeight(s);if(l===i&&t!==l||t>l)return!0}}else{const s=r.getRowHeight(e.row);if(s===i&&t!==s||t>s)return!0}return!1}function Do(n,e,t,i){const r=[],o=[],s=[],l=[],a=[],d=[],u=[],h=[];let c=0,g=0,f=0,p=0,m=0,b=0;return n.forEach(C=>{switch(C.positionType){case Ie.left:r.push(C);break;case Ie.right:o.push(C);break;case Ie.contentLeft:s.push(C);break;case Ie.contentRight:l.push(C);break;case Ie.absoluteRight:h.push(C);break;case Ie.inlineFront:a.push(C);break;case Ie.inlineEnd:d.push(C)}}),r.forEach(C=>{var _,w,y;const v=xn(C,void 0,e.col,e.row,t,i);v.role="icon-left",v.name=C.name,v.setAttribute("x",c+((_=v.attribute.marginLeft)!==null&&_!==void 0?_:0)),c+=v.AABBBounds.width()+((w=v.attribute.marginLeft)!==null&&w!==void 0?w:0)+((y=v.attribute.marginRight)!==null&&y!==void 0?y:0),g=Math.max(g,v.AABBBounds.height()),e.appendChild(v)}),o.forEach(C=>{var _,w,y;const v=xn(C,void 0,e.col,e.row,t,i);v.role="icon-right",v.name=C.name,v.setAttribute("x",f+((_=v.attribute.marginLeft)!==null&&_!==void 0?_:0)),f+=v.AABBBounds.width()+((w=v.attribute.marginLeft)!==null&&w!==void 0?w:0)+((y=v.attribute.marginRight)!==null&&y!==void 0?y:0),p=Math.max(p,v.AABBBounds.height()),e.appendChild(v)}),u.forEach(C=>{var _,w,y;const v=xn(C,void 0,e.col,e.row,t,i);v.role="icon-absolute-left",v.name=C.name,v.setAttribute("x",m+((_=v.attribute.marginLeft)!==null&&_!==void 0?_:0)),m+=v.AABBBounds.width()+((w=v.attribute.marginLeft)!==null&&w!==void 0?w:0)+((y=v.attribute.marginRight)!==null&&y!==void 0?y:0),e.appendChild(v)}),h.forEach(C=>{var _,w,y;const v=xn(C,void 0,e.col,e.row,t,i);v.role="icon-absolute-right",v.name=C.name,v.setAttribute("x",b+((_=v.attribute.marginLeft)!==null&&_!==void 0?_:0)),b+=v.AABBBounds.width()+((w=v.attribute.marginLeft)!==null&&w!==void 0?w:0)+((y=v.attribute.marginRight)!==null&&y!==void 0?y:0),e.appendChild(v)}),{leftIcons:r,rightIcons:o,contentLeftIcons:s,contentRightIcons:l,inlineFrontIcons:a,inlineEndIcons:d,absoluteLeftIcons:u,absoluteRightIcons:h,leftIconWidth:c,leftIconHeight:g,rightIconWidth:f,rightIconHeight:p,absoluteLeftIconWidth:m,absoluteRightIconWidth:b}}function sk(n,e){if(n.hasOwnProperty("hoverIconId")){const t=this;if(t.skipMergeUpdate)return;const i=Fr(t);if(!i||!i.stage)return;const r=i.stage.table;t.skipAttributeUpdate=!0;const{mergeStartCol:o,mergeEndCol:s,mergeStartRow:l,mergeEndRow:a}=i;if(O(o)&&O(s)&&O(l)&&O(a)&&(o!==s||l!==a)){for(let d=o;d<=s;d++)for(let u=l;u<=a;u++){if(d===i.col&&u===i.row){if(n.hoverIconId!==t.attribute.hoverIconId){const c=t._frameCache.icons.get(n.hoverIconId);t.updateHoverIconState(c)}continue}const h=r.scenegraph.highPerformanceGetCell(d,u);if(h.role==="cell"){const c=h.getChildByName(t.name,!0);if(!c||c.skipAttributeUpdate)continue;n.hoverIconId!==c.attribute.hoverIconId&&(c.setAttribute("hoverIconId",n.hoverIconId),h.addUpdateBoundTag())}}t.skipAttributeUpdate=void 0}}}function lk(n,e,t,i,r,o,s,l,a,d,u,h,c,g,f,p,m){var b,C,_,w,y,v,x,S,R,B,A,M,H,E,T,P,k,L,F,z,I,N,W,D,G,V,X,$,Q,te;const le=g._getCellStyle(i,r),fe=Ru("padding",le,i,r,g);!((b=g.options.customConfig)===null||b===void 0)&&b.imageMargin?d=xe((C=g.options.customConfig)===null||C===void 0?void 0:C.imageMargin):O(fe)&&(d=fe),!((_=f==null?void 0:f.text)===null||_===void 0)&&_.textAlign&&(u=(w=f==null?void 0:f.text)===null||w===void 0?void 0:w.textAlign),!((y=f==null?void 0:f.text)===null||y===void 0)&&y.textBaseline&&(h=(v=f==null?void 0:f.text)===null||v===void 0?void 0:v.textBaseline);const ne=oi(i,r,f,g);let ie,ce;if(m&&(ie=g.scenegraph.highPerformanceGetCell(i,r,!0),ie&&ie.role==="cell"&&ie.setAttributes({x:e,y:t,width:o,height:s,lineWidth:(S=(x=f==null?void 0:f.group)===null||x===void 0?void 0:x.lineWidth)!==null&&S!==void 0?S:void 0,fill:(B=(R=f==null?void 0:f.group)===null||R===void 0?void 0:R.fill)!==null&&B!==void 0?B:void 0,stroke:(M=(A=f==null?void 0:f.group)===null||A===void 0?void 0:A.stroke)!==null&&M!==void 0?M:void 0,strokeArrayWidth:ne??void 0,strokeArrayColor:(E=(H=f==null?void 0:f.group)===null||H===void 0?void 0:H.strokeArrayColor)!==null&&E!==void 0?E:void 0,cursor:(P=(T=f==null?void 0:f.group)===null||T===void 0?void 0:T.cursor)!==null&&P!==void 0?P:void 0,lineDash:(L=(k=f==null?void 0:f.group)===null||k===void 0?void 0:k.lineDash)!==null&&L!==void 0?L:void 0,lineCap:"butt",clip:!0,cornerRadius:f.group.cornerRadius})),ie&&ie.role==="cell"||(ie=new Pe({x:e,y:t,width:o,height:s,lineWidth:(z=(F=f==null?void 0:f.group)===null||F===void 0?void 0:F.lineWidth)!==null&&z!==void 0?z:void 0,fill:(N=(I=f==null?void 0:f.group)===null||I===void 0?void 0:I.fill)!==null&&N!==void 0?N:void 0,stroke:(D=(W=f==null?void 0:f.group)===null||W===void 0?void 0:W.stroke)!==null&&D!==void 0?D:void 0,strokeArrayWidth:ne??void 0,strokeArrayColor:(V=(G=f==null?void 0:f.group)===null||G===void 0?void 0:G.strokeArrayColor)!==null&&V!==void 0?V:void 0,cursor:($=(X=f==null?void 0:f.group)===null||X===void 0?void 0:X.cursor)!==null&&$!==void 0?$:void 0,lineDash:(te=(Q=f==null?void 0:f.group)===null||Q===void 0?void 0:Q.lineDash)!==null&&te!==void 0?te:void 0,lineCap:"butt",clip:!0,cornerRadius:f.group.cornerRadius}),ie.role="cell",ie.col=i,ie.row=r,n==null||n.addCellGroup(ie)),c){let de=i,K=r;p&&(de=p.start.col,K=p.start.row),ce=g.getCellIcons(de,K)}let ae=0,q=0,_e=0;if(Array.isArray(ce)&&ce.length!==0){const{leftIconWidth:de,rightIconWidth:K,absoluteRightIconWidth:ut}=Do(ce,ie,p,g);ae=de+K,q=de,_e=K,ie.forEachChildren(he=>{he.role==="icon-left"?he.setAttribute("x",he.attribute.x+d[3]):he.role==="icon-right"?he.setAttribute("x",he.attribute.x+o-K-d[1]):he.role==="icon-absolute-right"&&he.setAttribute("x",he.attribute.x+o-ut-d[1])}),ie.forEachChildren(he=>{h==="middle"?he.setAttribute("y",(s-he.AABBBounds.height())/2):h==="bottom"?he.setAttribute("y",s-he.AABBBounds.height()-d[2]):he.setAttribute("y",d[0])}),ie._cellLeftIconWidth=q,ie._cellRightIconWidth=_e}const oe=g.getCellValue(i,r),Y=au({x:d[3],y:d[0],width:o-d[1]-d[3]-ae,height:s-d[0]-d[2],image:oe,cursor:"pointer"});return Y.name="image",Y.keepAspectRatio=l,Y.textAlign=u,Y.textBaseline=h,l||a?Y.resources&&Y.resources.has(Y.attribute.image)&&Y.resources.get(Y.attribute.image).state==="success"?setTimeout(()=>{Gb(a,l,d,u,h,Y,ie,g)},0):Y.successCallback=()=>{Gb(a,l,d,u,h,Y,ie,g),g.scenegraph.updateNextFrame()}:Y.resources&&Y.resources.has(Y.attribute.image)&&Y.resources.get(Y.attribute.image).state==="success"?qs(ie,i,r,0,0,g):Y.successCallback=()=>{qs(ie,i,r,0,0,g)},Y.failCallback=()=>{const de=Vn();Y.image=de.damage_pic.svg},ie.appendChild(Y),ie}function oy(n,e,t,i,r,o,s){let l=!1,a=null,d=null;const{width:u,height:h,isMerge:c}=ko(s,r.table);if(u<t+o[1]+o[3]&&(a=t+o[1]+o[3],l=!0),h<i+o[2]+o[0]&&(d=i+o[2]+o[0],l=!0),l){if(typeof a=="number")if(c)for(let g=s.mergeStartCol;g<=s.mergeEndCol;g++)r.setColWidth(g,a/(s.mergeEndCol-s.mergeStartCol+1));else r.setColWidth(n,a);if(typeof d=="number")if(c)for(let g=s.mergeStartRow;g<=s.mergeEndRow;g++)r.setRowHeight(g,d/(s.mergeEndRow-s.mergeStartRow+1));else r.setRowHeight(e,d);return r.component.updateScrollBar(),!0}return!1}function qs(n,e,t,i,r,o){var s,l,a,d,u,h,c,g,f,p,m,b;const C=n.getChildByName("image");if(!C)return;const _=typeof C.attribute.image!="string"&&C.attribute.image||((s=C.resources)===null||s===void 0?void 0:s.get(C.attribute.image).data);if(!_)return;const w=o._getCellStyle(e,t),y=(l=Z("textAlign",w,e,t,o))!==null&&l!==void 0?l:"left",v=(a=Z("textBaseline",w,e,t,o))!==null&&a!==void 0?a:"middle";let x;x=!((d=o.options.customConfig)===null||d===void 0)&&d.imageMargin?xe((u=o.options.customConfig)===null||u===void 0?void 0:u.imageMargin):(h=xe(Z("padding",w,e,t,o)))!==null&&h!==void 0?h:[0,0,0,0];const{width:S,height:R,isMerge:B}=ko(n,o),A=(c=n.mergeStartCol)!==null&&c!==void 0?c:n.col,M=(g=n.mergeStartRow)!==null&&g!==void 0?g:n.row,H=(f=n.mergeEndCol)!==null&&f!==void 0?f:n.col,E=(p=n.mergeEndCol)!==null&&p!==void 0?p:n.row,T=(m=n._cellLeftIconWidth)!==null&&m!==void 0?m:0,P=(b=n._cellRightIconWidth)!==null&&b!==void 0?b:0;if(C.keepAspectRatio){const{width:k,height:L}=xu(_.width||_.videoWidth,_.height||_.videoHeight,S-(x[1]+x[3]),R-(x[0]+x[2])),F=Jf(0,0,S,R,k,L,y,v,x);for(let z=A;z<=H;z++)for(let I=M;I<=E;I++){const N=o.scenegraph.getCell(z,I).getChildByName("image");N==null||N.setAttributes({x:F.x,y:F.y,width:k,height:L})}}else for(let k=A;k<=H;k++)for(let L=M;L<=E;L++){const F=o.scenegraph.getCell(k,L).getChildByName("image");F==null||F.setAttributes({x:T+x[3],y:x[0],width:S-x[1]-x[3]-P-T,height:R-x[0]-x[2]})}if(n.getChildByName("play-icon")){const{width:F,height:z}=ko(n,o),I=Math.floor(Math.min(F-x[1]-x[3],z-x[2]-x[0])/2),N=0+(F>C.attribute.width?C.attribute.x-0+C.attribute.width/2:F/2),W=0+(z>C.attribute.height?C.attribute.y-0+C.attribute.height/2:z/2);for(let D=A;D<=H;D++)for(let G=M;G<=E;G++)o.scenegraph.getCell(D,G).getChildByName("play-icon").setAttributes({x:N-I/2,y:W-I/2,width:I,height:I})}n.forEachChildren(k=>{k.role==="icon-left"||(k.role==="icon-right"||k.role==="icon-absolute-right")&&k.setAttribute("x",k.attribute.x+i)}),n.forEachChildren(k=>{(k.type==="rect"||k.role&&k.role.startsWith("icon"))&&(v==="middle"?k.setAttribute("y",x[0]+(R-x[0]-x[2]-k.AABBBounds.height())/2):v==="bottom"?k.setAttribute("y",x[0]+R-x[0]-x[2]-k.AABBBounds.height()):k.setAttribute("y",x[0]))}),B&&Qf(n.mergeStartCol,n.mergeEndCol,n.mergeStartRow,n.mergeEndRow,o)}function ko(n,e){return n.role==="cell"&&O(n.mergeStartCol)&&O(n.mergeEndCol)&&O(n.mergeStartRow)&&O(n.mergeEndRow)?{width:e.getColsWidth(n.mergeStartCol,n.mergeEndCol),height:e.getRowsHeight(n.mergeStartRow,n.mergeEndRow),isMerge:!0}:{width:n.attribute.width,height:n.attribute.height,isMerge:!1}}function Qf(n,e,t,i,r){for(let o=n;o<=e;o++)for(let s=t;s<=i;s++){const l=r.scenegraph.getCell(o,s);if(l){const a=l.getChildByName("image");a&&a.setAttributes({dx:-r.getColsWidth(l.mergeStartCol,o-1),dy:-r.getRowsHeight(l.mergeStartRow,s-1)});const d=l.getChildByName("play-icon");d&&d.setAttributes({dx:-r.getColsWidth(l.mergeStartCol,o-1),dy:-r.getRowsHeight(l.mergeStartRow,s-1)})}}}function Gb(n,e,t,i,r,o,s,l){const a=o.resources.get(o.attribute.image).data,{col:d,row:u}=s;if(n&&!jb(o)&&oy(d,u,a.width,a.height,l.scenegraph,t,s),e||jb(o)){const{width:h,height:c,isMerge:g}=ko(s,l),{width:f,height:p}=xu(a.width,a.height,h-t[1]-t[3],c-t[0]-t[2]),m=Jf(0,0,h,c,f,p,i,r,t);o.setAttributes({x:m.x,y:m.y,width:f,height:p}),g&&Qf(s.mergeStartCol,s.mergeEndCol,s.mergeStartRow,s.mergeEndRow,l)}}function jb(n){const e=Vn();return n.attribute.image===e.damage_pic.svg}function sy(n,e,t){n.then(()=>{t(),e.scenegraph.updateNextFrame()}).catch(i=>{})}function ak(n,e){var t,i;const r=this;if(r.shadowRoot&&r.shadowRoot.childrenCount&&(O(n.width)||O(n.height))){const o=r.shadowRoot.findChildrenByName("shadow-rect")[0];o&&o.setAttributes({width:(t=n.width)!==null&&t!==void 0?t:o.attribute.width,height:(i=n.height)!==null&&i!==void 0?i:o.attribute.height})}}function eg(n,e,t,i,r,o,s,l,a,d,u,h,c,g,f,p,m,b){var C,_;let w,y=!1;if(Un(e)){if(i.scenegraph.highPerformanceGetCell(r,o).role!=="cell")return w;e=i.getCellValue(r,o),y=!0}if(n==="text"||n==="link"||b){if(n==="link"){const R=e,B=i.getCellOriginValue(r,o),A=i._getCellStyle(r,o);n==="link"&&("templateLink"in t&&t.templateLink||!("linkDetect"in t)||!ze(t.linkDetect,{col:r,row:o,table:i,value:R,dataValue:B,cellHeaderPaths:void 0})||Zf.test(R))&&(p?(p.text.fill=Z("linkColor",A,r,o,i),p.group.cursor="pointer"):p={text:{fill:Z("linkColor",A,r,o,i)},group:{cursor:"pointer"}})}const{customElementsGroup:v,renderDefault:x}=Ub(i,t,r,o,l,a,h,m,b);w=ue.getFunction("createTextCellGroup")(i,e,d,0,u,r,o,s,l,a,h,c,g,f,v,x,p,m,y);const S=i.internalProps.layoutMap.getAxisConfigInPivotChart(r,o);if(S){const R=new(ue.getComponent("axis"))(S,w.attribute.width,w.attribute.height,(C=S.__vtablePadding)!==null&&C!==void 0?C:h,i);w.clear(),w.appendChild(R.component),R.overlap()}else i.internalProps.layoutMap.isEmpty(r,o)?(w.setAttributes({fill:!1,stroke:!1}),w.clear()):i.internalProps.layoutMap.isAxisCell(r,o)&&w.clear()}else if(n==="image")w=ue.getFunction("createImageCellGroup")(d,0,u,r,o,l,a,t.keepAspectRatio,t.imageAutoSizing,h,c,g,f,i,p,m,y);else if(n==="video")w=ue.getFunction("createVideoCellGroup")(d,0,u,r,o,l,a,t.keepAspectRatio,t.imageAutoSizing,h,c,g,f,i,p,m,y);else if(n==="chart"){const v=i.internalProps.layoutMap.getChartInstance(r,o);w=ue.getFunction("createChartCellGroup")(null,d,0,u,r,o,l,a,h,e,t.chartModule,i.internalProps.layoutMap.getChartSpec(r,o),v,(_=i.internalProps.layoutMap.getChartDataId(r,o))!==null&&_!==void 0?_:"data",i,p,i.internalProps.layoutMap.isShareChartSpec(r,o),y,i.internalProps.layoutMap.isNoChartDataRenderNothing(r,o))}else if(n==="progressbar"){const{customElementsGroup:v,renderDefault:x}=Ub(i,t,r,o,l,a,h,m,b),S=i._getCellStyle(r,o),R=i.getCellOriginValue(r,o);w=ue.getFunction("createTextCellGroup")(i,e,d,0,u,r,o,s,l,a,h,c,g,!1,v,x,p,m,y);const B=ue.getFunction("createProgressBarCell")(t,S,s,e,R,r,o,h,i,m);w.firstChild?w.insertBefore(B,w.firstChild):w.appendChild(B)}else n==="sparkline"?w=ue.getFunction("createSparkLineCellGroup")(null,d,0,u,r,o,l,a,h,i,p,y):n==="checkbox"?w=ue.getFunction("createCheckboxCellGroup")(null,d,0,u,r,o,s,l,a,h,c,g,f,i,p,t,m,y):n==="radio"?w=ue.getFunction("createRadioCellGroup")(null,d,0,u,r,o,s,l,a,h,c,g,i,p,t,m):n==="switch"?w=ue.getFunction("createSwitchCellGroup")(null,d,0,u,r,o,s,l,a,h,c,g,f,i,p,t,m,y):n==="button"&&(w=ue.getFunction("createButtonCellGroup")(null,d,0,u,r,o,s,l,a,h,c,g,f,i,p,t,m,y));return w.onBeforeAttributeUpdate=ak,w}function Ub(n,e,t,i,r,o,s,l,a){let d,u=!0;if(a)d=a.elementsGroup,u=a.renderDefault;else{let h,c;if(n.getCellLocation(t,i)!=="body"?(h=e==null?void 0:e.headerCustomRender,c=e==null?void 0:e.headerCustomLayout):(h=(e==null?void 0:e.customRender)||n.customRender,c=e==null?void 0:e.customLayout),c||h){const g=er(c,h,t,i,r,o,!1,n.isAutoRowHeight(i),s,l,n);d=g.elementsGroup,u=g.renderDefault}}return{customElementsGroup:d,renderDefault:u}}function Rn(n,e,t,i,r,o){var s,l,a,d,u,h,c,g,f,p,m,b,C,_,w,y,v,x;const S=t.scenegraph.highPerformanceGetCell(n,e,!0),R=t.getCellLocation(n,e);let B,A,M,H,E=t.getCellValue(n,e),T=!1;if(t.internalProps.customMergeCell){const le=t.getCustomMerge(n,e);if(le){const{range:fe,text:ne,style:ie,customLayout:ce,customRender:ae}=le;A=fe,B=A.start.col!==A.end.col||A.start.row!==A.end.row,E=ne,M=ie,(ce||ae)&&(H=er(ce,ae,fe.start.col,fe.start.row,t.getColsWidth(fe.start.col,fe.end.col),t.getRowsHeight(fe.start.row,fe.end.row),!1,t.isAutoRowHeight(e),[0,0,0,0],A,t)),T=!0}}let P=n,k=e;A&&(P=A.start.col,k=A.start.row);const L=R!=="body"?t.getHeaderDefine(P,k):t.getBodyColumnDefine(P,k);let F=R!=="body"||(L==null?void 0:L.dragOrder)||!!(L!=null&&L.icon)||!!(L!=null&&L.tree);A||!t.internalProps.enableTreeNodeMerge&&R==="body"&&!(L!=null&&L.mergeCell)||(A=t.getCellRange(n,e),B=A.start.col!==A.end.col||A.start.row!==A.end.row);let z=!1;if(t.internalProps.enableTreeNodeMerge&&B){const le=t.getCellRawRecord(A.start.col,A.start.row),{vtableMergeName:fe,vtableMerge:ne}=le??{};z=ne,ne&&(F=!0,t.options.groupTitleCustomLayout&&(H=er(t.options.groupTitleCustomLayout,void 0,A.start.col,A.start.row,t.getColsWidth(A.start.col,A.end.col),t.getRowsHeight(A.start.row,A.end.row),!1,t.isAutoRowHeight(e),[0,0,0,0],A,t)),t.options.groupTitleFieldFormat?E=t.options.groupTitleFieldFormat(le,n,e,t):fe&&(E=fe))}const I=M||t._getCellStyle(A?A.start.col:n,A?A.start.row:e),N=(s=I.autoWrapText)!==null&&s!==void 0?s:t.internalProps.autoWrapText,W=ir(I,t,B?A.start.col:n,B?A.start.row:e,Z).theme;if(W.group.cornerRadius=vu(n,e,t),!i&&!B&&!(L!=null&&L.customLayout||L!=null&&L.customRender||L!=null&&L.headerCustomLayout||L!=null&&L.headerCustomRender)&&(o||dk(n,e,S,N,F,t))){const le=t.getColWidth(n),fe=t.getRowHeight(e),ne=oi(n,e,W,t);S.setAttributes({width:le,height:fe,lineWidth:(a=(l=W==null?void 0:W.group)===null||l===void 0?void 0:l.lineWidth)!==null&&a!==void 0?a:void 0,fill:(u=(d=W==null?void 0:W.group)===null||d===void 0?void 0:d.fill)!==null&&u!==void 0?u:void 0,stroke:(c=(h=W==null?void 0:W.group)===null||h===void 0?void 0:h.stroke)!==null&&c!==void 0?c:void 0,strokeArrayWidth:ne??void 0,strokeArrayColor:(f=(g=W==null?void 0:W.group)===null||g===void 0?void 0:g.strokeArrayColor)!==null&&f!==void 0?f:void 0,cursor:(m=(p=W==null?void 0:W.group)===null||p===void 0?void 0:p.cursor)!==null&&m!==void 0?m:void 0,cornerRadius:(C=(b=W==null?void 0:W.group)===null||b===void 0?void 0:b.cornerRadius)!==null&&C!==void 0?C:0,lineDash:(w=(_=W==null?void 0:W.group)===null||_===void 0?void 0:_.lineDash)!==null&&w!==void 0?w:void 0,y:t.scenegraph.getCellGroupY(e)}),S.forEachChildren(ce=>{ce.setAttributes({dx:0,dy:0})});const ie=S.getChildByName("text");if(o&&ie){const ce={textBaseline:"top"};ie.setAttributes(W.text?Object.assign({},W.text,ce):ce)}else if(ie){const ce=t.getCellValue(n,e),{text:ae,moreThanMaxCharacters:q}=Xs(ce,t),_e=cn(n,e,t),oe=I.lineClamp,Y=(y=xe(Z("padding",I,n,e,t)))!==null&&y!==void 0?y:[0,0,0,0],de=W.text.textAlign;let K=0;K=de==="center"?Y[3]+(le-(Y[1]+Y[3]))/2:de==="right"?Y[3]+le-(Y[1]+Y[3]):Y[3];const ut={text:ae.length!==1||N?ae:ae[0],moreThanMaxCharacters:q,maxLineWidth:le-(Y[1]+Y[3]+_e),textBaseline:"top",autoWrapText:N,lineClamp:oe,wordBreak:"break-word",heightLimit:fe-Math.floor(Y[0]+Y[2]),pickable:!1,dx:de==="left"?_e:0,x:K};if(ie.setAttributes(W.text?Object.assign({},W.text,ut):ut),ie.attribute.text){const he=W.text.textBaseline,We=fe-(Y[0]+Y[2]);let bt=0;bt=he==="middle"?Y[0]+(We-ie.AABBBounds.height())/2:he==="bottom"?Y[0]+We-ie.AABBBounds.height():Y[0],ie.setAttributes({y:bt})}}return S}if(!i&&S.role==="empty")return;const D=z||T?"text":t.isHeader(n,e)?(v=t._getHeaderLayoutMap(n,e).headerType)!==null&&v!==void 0?v:"text":(x=t.getBodyColumnType(n,e))!==null&&x!==void 0?x:"text",G=W._vtable.padding,V=W.text.textAlign,X=W.text.textBaseline;let $,Q,te;if(A?(Q=t.getColsWidth(A.start.col,A.end.col),te=t.getRowsHeight(A.start.row,A.end.row)):(Q=t.getColWidth(n),te=t.getRowHeight(e)),Un(E)?(S.removeAllChild(),sy(E,t,uk.bind(null,{type:D,value:E,define:L,table:t,col:n,row:e,cellWidth:Q,cellHeight:te,oldCellGroup:S,padding:G,textAlign:V,textBaseline:X,mayHaveIcon:F,addNew:i,range:A,customResult:H,customStyle:M}))):$=ly(D,E,L,t,n,e,Q,te,S,G,V,X,F,i,W,A,H),B){const{width:le}=$.attribute,{height:fe}=$.attribute;$.contentWidth=le,$.contentHeight=fe,r?hk(A,Q,te,G,V,X,t,$):ay(A,Q,te,G,V,X,t)}return $}function ly(n,e,t,i,r,o,s,l,a,d,u,h,c,g,f,p,m){var b,C;if(Un(e)&&(e=i.getCellValue(r,o)),!g&&(a.row!==o||a.col!==r))return null;if(!g&&a.parent&&i.reactCustomLayout){const w=a.getChildByName("custom-container");if(w){const{col:y,row:v}=w;J(y)&&J(v)&&i.reactCustomLayout.removeCustomCell(y,v)}}const _=eg(n,e,t,i,r,o,i.getColWidth(r),s,l,g?i.scenegraph.getColGroup(r):a.parent,g?0:i.scenegraph.getCellGroupY(o),d,u,h,c,f,p,m);return!g&&a.parent&&(a.parent.insertAfter(_,a),a.parent.removeChild(a),!((b=i.scenegraph)===null||b===void 0)&&b.proxy.cellCache.get(r)&&((C=i.scenegraph)===null||C===void 0||C.proxy.cellCache.set(r,_))),_}function dk(n,e,t,i,r,o){var s;const l=o.getBodyColumnType(n,e),a=o.isAutoRowHeight(e),d=o.getCellValue(n,e);return!(o.isHeader(n,e)||t.role!=="cell"||l!=="text"||i||a||r||((s=t.firstChild)===null||s===void 0?void 0:s.type)!=="text"||Un(d))}function uk(n){const{type:e,value:t,define:i,table:r,col:o,row:s,cellWidth:l,cellHeight:a,oldCellGroup:d,padding:u,textAlign:h,textBaseline:c,mayHaveIcon:g,addNew:f,range:p,customResult:m,customStyle:b}=n,C=b||r._getCellStyle(p?p.start.col:o,p?p.start.row:s),_=ir(C,r,p?p.start.col:o,p?p.start.row:s,Z).theme;_.group.cornerRadius=vu(o,s,r),ly(e,t,i,r,o,s,l,a,d,u,h,c,g,f,_,p,m)}function ay(n,e,t,i,r,o,s){for(let l=n.start.col;l<=n.end.col;l++)for(let a=n.start.row;a<=n.end.row;a++){const d=s.scenegraph.highPerformanceGetCell(l,a,!0);if(d.role!=="cell")continue;n.start.row!==n.end.row&&d.contentHeight!==t&&gd(d,t,t,s.isAutoRowHeight(a),i,r,o,s),n.start.col!==n.end.col&&d.contentWidth!==e&&fd(d,e,t,0,s.isAutoRowHeight(a),i,r,o,s.scenegraph),d.contentWidth=e,d.contentHeight=t;const u=s.getRowHeight(a);hl(d,s.getColWidth(l),u,n,s)}}function hk(n,e,t,i,r,o,s,l){const{col:a,row:d}=l;n.start.row!==n.end.row&&l.contentHeight!==t&&gd(l,t,t,s.isAutoRowHeight(d),i,r,o,s),n.start.col!==n.end.col&&l.contentWidth!==e&&fd(l,e,t,0,s.isAutoRowHeight(d),i,r,o,s.scenegraph),l.contentWidth=e,l.contentHeight=t;const u=s.getRowHeight(d);hl(l,s.getColWidth(a),u,n,s)}function hl(n,e,t,i,r){var o,s;const{col:l,row:a}=n,d=-r.getColsWidth(i.start.col,l-1);let u=0;if(!((o=r.options.customConfig)===null||o===void 0)&&o._disableColumnAndRowSizeRound)for(let m=i.start.row;m<=a-1;m++)u-=r.getRowHeight(m);else u=-r.getRowsHeight(i.start.row,a-1);n.forEachChildren(m=>{var b,C,_,w,y,v;typeof m._dx=="number"?(m.skipMergeUpdate=!0,m.setAttributes({dx:((b=m._dx)!==null&&b!==void 0?b:0)+d}),m.skipMergeUpdate=!1):(m.skipMergeUpdate=!0,m._dx=(C=m.attribute.dx)!==null&&C!==void 0?C:0,m.setAttributes({dx:((_=m.attribute.dx)!==null&&_!==void 0?_:0)+d}),m.skipMergeUpdate=!1),typeof m._dy=="number"?(m.skipMergeUpdate=!0,m.setAttributes({dy:((w=m._dy)!==null&&w!==void 0?w:0)+u}),m.skipMergeUpdate=!1):(m._dy=(y=m.attribute.dy)!==null&&y!==void 0?y:0,m.skipMergeUpdate=!0,m.setAttributes({dy:((v=m.attribute.dy)!==null&&v!==void 0?v:0)+u}),m.skipMergeUpdate=!1)});const h=(s=n.attribute.strokeArrayWidth)!==null&&s!==void 0?s:n.attribute.lineWidth,c=ee(h),g=[0,0,0,0];l===i.start.col&&(g[3]=c?h[3]:h),a===i.start.row&&(g[0]=c?h[0]:h),l===i.end.col&&(g[1]=c?h[1]:h),a===i.end.row&&(g[2]=c?h[2]:h);const f=e!==n.attribute.width,p=t!==n.attribute.height;return n.skipMergeUpdate=!0,n.setAttributes({width:e,height:t,strokeArrayWidth:g}),n.skipMergeUpdate=!1,n.mergeStartCol=i.start.col,n.mergeStartRow=i.start.row,n.mergeEndCol=i.end.col,n.mergeEndRow=i.end.row,{widthChange:f,heightChange:p}}function pd(n,e,t,i){if(i.internalProps.customMergeCell){const r=i.getCustomMerge(n,e);if(r){const{range:o,text:s,style:l,customLayout:a,customRender:d}=r;if(a||d){const u=er(a,d,o.start.col,o.start.row,i.getColsWidth(o.start.col,o.end.col),i.getRowsHeight(o.start.row,o.end.row),!1,i.isAutoRowHeight(e),[0,0,0,0],o,i).elementsGroup;t.childrenCount>0&&u?t.insertBefore(u,t.firstChild):u&&t.appendChild(u);const h=i.getRowHeight(e),c=i.getColWidth(n),{width:g}=t.attribute,{height:f}=t.attribute;return t.contentWidth=g,t.contentHeight=f,hl(t,c,h,o,i),o}}}}function Zi(n){return!!(n.role==="cell"&&J(n.mergeStartCol)&&J(n.mergeStartRow)&&J(n.mergeEndCol)&&J(n.mergeEndRow))}const Ju=new Po({}),vs=new Ho({}),ck=new ll({});function fk(n,e,t,i,r,o,s,l,a,d,u,h,c,g,f){const p=ke(n)?n.text:n,m=_u(p).split(`
`)||[],b=f.getColsWidth(e,i),C=Z("size",r,e,t,f);let _=0;if(o){const w=Z("spaceBetweenTextAndIcon",r,e,t,f),y=b-(g[1]+g[3])-s-C-w;Ju.setAttributes({text:{maxLineWidth:y,text:m,fontSize:l,fontStyle:a,fontWeight:d,fontFamily:u,lineHeight:h,wordBreak:"break-word",lineClamp:c},icon:{width:Math.floor(C/1.4),height:Math.floor(C/1.4)},box:{width:C,height:C},spaceBetweenTextAndIcon:w}),Ju.render(),_=Ju.AABBBounds.height()}else _=Math.max(C,m.length*h);return _}function gk(n,e,t,i,r,o,s,l,a,d,u,h,c,g,f){var p;if(ee(n)){let m=0;const b=f.getBodyColumnDefine(e,t),C=Z("spaceBetweenRadio",r,e,t,f),_=(p=b==null?void 0:b.radioDirectionInCell)!==null&&p!==void 0?p:"vertical";return _==="vertical"?n.forEach((w,y)=>{const v=Qu(w,e,t,i,r,o,s,l,a,d,u,h,c,g,f);m+=v,y!==n.length-1&&(m+=C)}):_==="horizontal"&&n.forEach(w=>{const y=Qu(w,e,t,i,r,o,s,l,a,d,u,h,c,g,f);m=Math.max(y,m)}),m}return Qu(n,e,t,i,r,o,s,l,a,d,u,h,c,g,f)}function Qu(n,e,t,i,r,o,s,l,a,d,u,h,c,g,f){const p=ke(n)?n.text:n,m=_u(p).split(`
`)||[],b=f.getColsWidth(e,i),C=Z("size",r,e,t,f);let _=Z("outerRadius",r,e,t,f);const w=J(_)?2*_:C;let y=0;if(o){const v=Z("spaceBetweenTextAndIcon",r,e,t,f),x=b-(g[1]+g[3])-s-w-v;J(_)||(_=Math.round(C/2)),vs.setAttributes({text:{maxLineWidth:x,text:m,fontSize:l,fontStyle:a,fontWeight:d,fontFamily:u,lineHeight:h,wordBreak:"break-word",lineClamp:c},circle:{outerRadius:_},spaceBetweenTextAndIcon:v}),vs.render(),y=vs.AABBBounds.height()}else y=Math.max(C,m.length*h);return y}function pk(n,e,t,i,r,o,s,l,a,d,u,h,c,g,f){return Z("boxWidth",r,e,t,f)}function mk(n,e,t,i,r,o,s,l,a,d,u,h,c,g,f){const p=ke(n)?n.text:n,m=_u(p).split(`
`)||[],b=f.getColsWidth(e,i),C=Z("buttonPadding",r,e,t,f),_=Z("buttonLineWidth",r,e,t,f);let w=0;if(o){const y=b-(g[1]+g[3]);ck.setAttributes({text:m,textStyle:{maxLineWidth:y,fontSize:l,fontStyle:a,fontWeight:d,fontFamily:u,lineHeight:h,wordBreak:"break-word",lineClamp:c},padding:C,panel:{visible:!0,fill:"red",stroke:"red",lineWidth:_}}),vs.render(),w=vs.AABBBounds.height()}else w=m.length*h+2*C;return w}let bk="",Qc="quick";const Ck=new we((n,e,t,i)=>{t(vi)?i(vi).to(Kb).inSingletonScope():n(vi).to(Kb).inSingletonScope()});new we((n,e,t,i)=>{t(vi)?i(vi).to(yo).inSingletonScope():n(vi).to(yo).inSingletonScope()});const $b=new Map;function ef(n,e,t,i="normal"){const r=`${n}-${e}-${t}-${i}`,o=$b.get(r);if(o)return o;const s=(l={fontSize:n,fontFamily:t,fontWeight:e,fontStyle:i},new yi(Object.assign({defaultFontParams:{fontFamily:qt.fontFamily,fontSize:qt.fontSize},getTextBounds:su,specialCharSet:`{}()//&-/: .,@%'"~…=——${yi.ALPHABET_CHAR_SET}${yi.ALPHABET_CHAR_SET.toUpperCase()}0123456789${bk}`},{}),l));var l;return $b.set(r,s),s}class Kb extends yo{_fastMeasure(e,t){const{fontSize:i,fontFamily:r="Arial,sans-serif",fontWeight:o="normal",fontStyle:s="normal"}=t,l=ef(i,o,r,s).measure(e,Qc);if(!O(l.fontBoundingBoxAscent)&&!O(l.fontBoundingBoxDescent)){const{ascent:a,descent:d}=this.measureTextBoundADscentEstimate(t);l.fontBoundingBoxAscent=a,l.fontBoundingBoxDescent=d}return l}measureTextWidth(e,t){return this._fastMeasure(e,t).width}measureText(e,t){return this._fastMeasure(e,t)}_measureTextWithoutAlignBaseline(e,t,i){return this._fastMeasure(e,t)}_measureTextWithAlignBaseline(e,t,i){return this._fastMeasure(e,t)}}class _k{measureText(e,t){const{fontSize:i,fontFamily:r="Arial,sans-serif",fontWeight:o="normal",fontStyle:s="normal"}=t;return ef(i,o,r,s).measure(e,Qc)}measureTextWidth(e,t){const{fontSize:i,fontFamily:r="Arial,sans-serif",fontWeight:o="normal",fontStyle:s="normal"}=t;return ef(i,o,r,s).measure(e,Qc).width}clipText(e,t,i){if(e.length===0)return{str:"",width:0};let r=this.measureTextWidth(e,t);return r<=i?{str:e,width:r}:(r=this.measureTextWidth(e[0],t),r>i?{str:"",width:0}:this._clipText(e,t,i,0,e.length-1))}_clipText(e,t,i,r,o){const s=Math.floor((r+o)/2),l=e.substring(0,s+1),a=this.measureTextWidth(l,t);let d;if(a>i){if(l.length<=1)return{str:"",width:0};const u=e.substring(0,s);return d=this.measureTextWidth(u,t),d<=i?{str:u,width:d}:this._clipText(e,t,i,r,s)}if(a<i){if(s>=e.length-1)return{str:e,width:this.measureTextWidth(e,t)};const u=e.substring(0,s+2);return d=this.measureTextWidth(u,t),d>=i?{str:l,width:a}:this._clipText(e,t,i,s,o)}return{str:l,width:a}}clipTextWithSuffix(e,t,i,r){if(r==="")return this.clipText(e,t,i);if(e.length===0)return{str:"",width:0};const o=this.measureTextWidth(e,t);if(o<=i)return{str:e,width:o};const s=this.measureTextWidth(r,t);if(s>i)return{str:"",width:0};i-=s;const l=this._clipText(e,t,i,0,e.length-1);return l.str+=r,l.width+=s,l}}const dy=new _k,Yb=new Rt({ignoreBuf:!0});function uy(n){return Yb.initAttributes(Object.assign(Object.assign({},n),{ignoreBuf:!0})),Yb.AABBBounds}const Xb=new Wn({width:0,height:0,textConfig:[]});function An(n,e,t,i=!0,r){var o,s,l,a,d,u,h,c,g,f,p;typeof window<"u"&&window.performance.now();const m=[],b=[];if(r)for(let v=e;v<=t;v++)m[v]=n.getRowHeight(v);const C=n.internalProps.layoutMap;n.isPivotTable()&&(C.enableUseGetBodyCache(),C.enableUseHeaderPathCache()),n.defaultHeaderRowHeight,n.defaultHeaderColWidth;const _=n.defaultHeaderRowHeight==="auto"||ee(n.defaultHeaderRowHeight)&&n.defaultHeaderRowHeight.some(v=>v==="auto"),w=n.isAutoRowHeight()||n.heightMode==="adaptive"&&n.options.autoHeightInAdaptiveMode!==!1,y=n.options.defaultRowHeight==="auto";if(w||_||y){e=e??0,t=t??n.rowCount-1,(e===0&&t===n.rowCount-1||i)&&n._clearRowRangeHeightsMap();for(let v=e;v<n.columnHeaderLevelCount;v++){let x=0,S=n.colCount-1;if((n.isPivotTable()&&!n.isPivotChart()||n.isPivotChart()&&!n.internalProps.layoutMap.indicatorsAsCol)&&vk(n,v)&&!at(n,n.rowHeaderLevelCount,v)&&(x=0,S=n.rowHeaderLevelCount),w||n.getDefaultRowHeight(v)==="auto"){const R=Sn(v,x,S,n);b[v]=Math.round(R),n.heightAdaptiveMode!=="only-body"&&r||n._setRowHeight(v,R)}}for(let v=n.rowCount-n.bottomFrozenRowCount;v<=t;v++)if(w||n.getDefaultRowHeight(v)==="auto"){const x=Sn(v,0,n.colCount-1,n);r?b[v]=Math.round(x):n._setRowHeight(v,x)}if(!(t<n.columnHeaderLevelCount||!w&&!y))if(n.internalProps.transpose||n.isPivotTable()&&!n.internalProps.layoutMap.indicatorsAsCol||n.options.customComputeRowHeight||!wk(n))if(n.internalProps.transpose||n.isPivotTable()&&!n.internalProps.layoutMap.indicatorsAsCol)for(let v=Math.max(e,n.columnHeaderLevelCount);v<=t;v++){let x;x=yk(n,v)?Sn(v,0,n.rowHeaderLevelCount,n):Sn(v,0,n.colCount-1,n),r?b[v]=Math.round(x):n._setRowHeight(v,x)}else for(let v=Math.max(e,n.columnHeaderLevelCount);v<=t;v++){const x=Sn(v,0,n.colCount-1,n);r?b[v]=Math.round(x):n._setRowHeight(v,x)}else{Sk(Sn(n.columnHeaderLevelCount,0,n.colCount-1,n),n.columnHeaderLevelCount,n.rowCount-1-n.bottomFrozenRowCount,n,r?b:void 0);for(let v=n.rowCount-n.bottomFrozenRowCount;v<=t;v++){const x=Sn(v,0,n.colCount-1,n);r?b[v]=Math.round(x):n._setRowHeight(v,x)}}}else if((n.heightMode==="adaptive"||n.autoFillHeight)&&n.clearRowHeightCache(),r)for(let v=e;v<=t;v++)b[v]=n.getRowHeight(v);if((e===0&&t===n.rowCount-1||i)&&n._clearRowRangeHeightsMap(),n.heightMode==="adaptive"){n._clearRowRangeHeightsMap();let v=n.tableNoFrameHeight,x=0,S=n.rowCount;if(n.heightAdaptiveMode==="only-body"){const A=n.getRowsHeight(0,n.columnHeaderLevelCount-1),M=n.isPivotChart()?n.getBottomFrozenRowsHeight():0;v=n.tableNoFrameHeight-A-M,x=n.columnHeaderLevelCount,S=n.isPivotChart()?n.rowCount-n.bottomFrozenRowCount:n.rowCount}let R=0;for(let A=x;A<S;A++)R+=r&&(o=b[A])!==null&&o!==void 0?o:n.getRowHeight(A);const B=v/R;for(let A=x;A<S;A++){let M;M=A===S-1?v-(r?b.reduce((H,E,T)=>T>=x&&T<=S-2?H+E:H,0):n.getRowsHeight(x,S-2)):Math.round((r&&(s=b[A])!==null&&s!==void 0?s:n.getRowHeight(A))*B),r?b[A]=M:n._setRowHeight(A,M,!1)}}else if(n.autoFillHeight){n._clearRowRangeHeightsMap();const v=n.tableNoFrameHeight;let x=0,S=0;for(let R=0;R<n.rowCount;R++){const B=r&&(l=b[R])!==null&&l!==void 0?l:n.getRowHeight(R);(R<n.columnHeaderLevelCount||n.isPivotChart()&&R>=n.rowCount-n.bottomFrozenRowCount)&&(S+=B),x+=B}if(n.scenegraph._dealAutoFillHeightOriginRowsHeight=x,x<v&&x-S>0){const R=n.columnHeaderLevelCount,B=n.isPivotChart()?n.rowCount-n.bottomFrozenRowCount:n.rowCount,A=(v-S)/(x-S);for(let M=R;M<B;M++){let H;H=M===B-1?v-S-(r?b.reduce((E,T,P)=>P>=R&&P<=B-2?E+T:E,0):n.getRowsHeight(R,B-2)):Math.round((r&&(a=b[M])!==null&&a!==void 0?a:n.getRowHeight(M))*A),r?b[M]=H:n._setRowHeight(M,H,!1)}}}if(r){for(let v=e;v<=t;v++){const x=(d=b[v])!==null&&d!==void 0?d:n.getRowHeight(v);O(x)&&n._setRowHeight(v,x)}for(let v=0;v<=n.frozenRowCount-1;v++){const x=n.getRowHeight(v);x!==((u=m[v])!==null&&u!==void 0?u:n.getRowHeight(v))&&n.scenegraph.updateRowHeight(v,x-((h=m[v])!==null&&h!==void 0?h:n.getRowHeight(v)),!0)}for(let v=n.rowCount-n.bottomFrozenRowCount;v<=n.rowCount-1;v++){const x=n.getRowHeight(v);x!==((c=m[v])!==null&&c!==void 0?c:n.getRowHeight(v))&&n.scenegraph.updateRowHeight(v,x-((g=m[v])!==null&&g!==void 0?g:n.getRowHeight(v)),!0)}for(let v=n.scenegraph.proxy.rowStart;v<=n.scenegraph.proxy.rowEnd;v++){const x=n.getRowHeight(v);x!==((f=m[v])!==null&&f!==void 0?f:n.getRowHeight(v))&&n.scenegraph.updateRowHeight(v,x-((p=m[v])!==null&&p!==void 0?p:n.getRowHeight(v)),!0)}}n.isPivotTable()&&(C.disableUseGetBodyCache(),C.disableUseHeaderPathCache())}function Sn(n,e,t,i){var r;if(!(i.isAutoRowHeight()||i.heightMode==="adaptive"&&i.options.autoHeightInAdaptiveMode!==!1)&&i.getDefaultRowHeight(n)!=="auto")return i.getDefaultRowHeight(n);let o;if(i.options.customComputeRowHeight){const l=i.options.customComputeRowHeight({row:n,table:i});if(typeof l=="number")return l;if(l!=="auto")return i.getDefaultRowHeight(n)}if(i.isPivotChart()&&n>=i.columnHeaderLevelCount&&n<i.rowCount-i.bottomFrozenRowCount)if(i.internalProps.layoutMap.indicatorsAsCol){const l=i.internalProps.layoutMap.getOptimunHeightForChart(n);if(l>0)return l}else{const l=i.getDefaultRowHeight(n);if(J(l))return l}for(let l=e;l<=t;l++){const a=xk(l,n,i);if(a&&(o=O(o)?Math.max(a.height,o):a.height,!a.renderDefault))continue;if(i.isPivotChart()){const u=i.internalProps.layoutMap.getAxisConfigInPivotChart(l,n);if(u){const h=ue.getFunction("computeAxisComponentHeight")(u,i);if(typeof h=="number"){o=O(o)?Math.max(h,o):h;continue}}}if(i.isPivotChart()&&(i.isLeftFrozenColumn(l)&&i.isBottomFrozenRow(n)||i.isRightFrozenColumn(l)&&i.isBottomFrozenRow(n)))continue;const d=Rk(l,n,i.isHeader(l,n)?(r=i._getHeaderLayoutMap(l,n))===null||r===void 0?void 0:r.headerType:i.getBodyColumnType(l,n),i);o=O(o)?Math.max(d,o):d}if(O(o))return o;const s=i.getDefaultRowHeight(n);return J(s)?s:i.defaultRowHeight}function wk(n){var e,t,i;const{layoutMap:r}=n.internalProps,o=n.columnHeaderLevelCount;if((n.internalProps.autoWrapText||n.internalProps.enableLineBreak||n.isPivotChart())&&(n.isAutoRowHeight()||n.options.heightMode==="adaptive"))return!1;for(let s=0;s<n.colCount;s++){const l=r.getBody(s,o);if(l.cellType==="radio"||typeof l.style=="function"||typeof l.icon=="function"||!((e=l.define)===null||e===void 0)&&e.customRender||!((t=l.define)===null||t===void 0)&&t.customLayout||typeof((i=l.define)===null||i===void 0?void 0:i.icon)=="function")return!1;const a=n._getCellStyle(s,o);if(typeof a.padding=="function"||typeof a.fontSize=="function"||typeof a.lineHeight=="function"||a.autoWrapText===!0)return!1}return!0}function yk(n,e){var t,i,r;const{layoutMap:o}=n.internalProps;if((n.internalProps.autoWrapText||n.internalProps.enableLineBreak)&&(n.isAutoRowHeight()||n.options.heightMode==="adaptive"))return!1;const s=o.getBody(n.rowHeaderLevelCount,e);if(typeof s.style=="function"||typeof s.icon=="function"||!((t=s.define)===null||t===void 0)&&t.customRender||!((i=s.define)===null||i===void 0)&&i.customLayout||typeof((r=s.define)===null||r===void 0?void 0:r.icon)=="function")return!1;const l=n._getCellStyle(n.rowHeaderLevelCount,e);return typeof l.padding!="function"&&typeof l.fontSize!="function"&&typeof l.lineHeight!="function"&&l.autoWrapText!==!0}function vk(n,e){var t,i,r;const{layoutMap:o}=n.internalProps;if(n.internalProps.autoWrapText&&(n.isAutoRowHeight()||n.options.heightMode==="adaptive"))return!1;const s=o.getHeader(n.rowHeaderLevelCount,e);if(typeof s.style=="function"||typeof s.icons=="function"||!((t=s.define)===null||t===void 0)&&t.headerCustomRender||!((i=s.define)===null||i===void 0)&&i.headerCustomLayout||typeof((r=s.define)===null||r===void 0?void 0:r.icon)=="function")return!1;const l=n._getCellStyle(n.rowHeaderLevelCount,e);return typeof l.padding!="function"&&typeof l.fontSize!="function"&&typeof l.lineHeight!="function"&&l.autoWrapText!==!0}function Sk(n,e,t,i,r){if(!i.internalProps.useOneRowHeightFillAll){for(let o=e;o<=t;o++)r?r[o]=n:i._setRowHeight(o,n);i.internalProps.useOneRowHeightFillAll=!0}}function xk(n,e,t){var i,r,o,s,l,a,d;const u=t.getCustomRender(n,e);let h=t.getCustomLayout(n,e);if(u||h){let c,g=1,f=0,p=!1,m=!1;(t.isHeader(n,e)||!((i=t.getBodyColumnDefine(n,e))===null||i===void 0)&&i.mergeCell||t.hasCustomMerge())&&(c=t.getCellRange(n,e),g=c.end.row-c.start.row+1);const b={col:(r=c==null?void 0:c.start.col)!==null&&r!==void 0?r:n,row:(o=c==null?void 0:c.start.row)!==null&&o!==void 0?o:e,dataValue:t.getCellOriginValue(n,e),value:t.getCellValue(n,e)||"",rect:Ak(n,e,t),table:t,originCol:n,originRow:e};if(h==="react-custom-layout"&&(h=((s=t.reactCustomLayout)===null||s===void 0?void 0:s.getCustomLayoutFunc(n,e))||Ks),Ae(h)){const C=h(b);C.rootContainer?(C.rootContainer=Ys(C.rootContainer),Su(C.rootContainer,t.getColWidth(n),0),C.rootContainer.setStage(t.scenegraph.stage),f=(l=C.rootContainer.AABBBounds.height())!==null&&l!==void 0?l:0,p=C.renderDefault,m=C.enableCellPadding):(f=0,p=C.renderDefault,m=C.enableCellPadding)}else if(typeof u=="function"){const C=u(b);f=(a=C==null?void 0:C.expectedHeight)!==null&&a!==void 0?a:0,p=C==null?void 0:C.renderDefault}else f=(d=u==null?void 0:u.expectedHeight)!==null&&d!==void 0?d:0,p=u==null?void 0:u.renderDefault;if(m){const C=t._getCellStyle(n,e),_=xe(Z("padding",C,n,e,t));f+=_[0]+_[2]}return{height:f/g,renderDefault:p}}}function Rk(n,e,t,i){var r,o,s,l;let a=0;const d=i.getCellValue(n,e),u=i._getCellStyle(n,e);let h=0,c=0;const g=[];let f=0;const p=[];let m=0,b=!1;if(i.getCellLocation(n,e)!=="body")b=!0;else{const T=i.getBodyColumnDefine(n,e);b=!!(T!=null&&T.icon)||!!(T!=null&&T.tree)||(T==null?void 0:T.dragOrder)}if(b){const T=i.getCellIcons(n,e);T==null||T.forEach(P=>{var k,L,F,z,I,N,W,D,G,V;P.positionType!==Ie.absoluteRight&&P.positionType!==Ie.inlineFront&&P.positionType!==Ie.inlineEnd?(c+=((k=P.width)!==null&&k!==void 0?k:0)+((L=P.marginLeft)!==null&&L!==void 0?L:0)+((F=P.marginRight)!==null&&F!==void 0?F:0),h=Math.max(h,(z=P.height)!==null&&z!==void 0?z:0)):P.positionType===Ie.inlineFront?(g.push(P),f=Math.max(f,((I=P.height)!==null&&I!==void 0?I:0)+((N=P.marginLeft)!==null&&N!==void 0?N:0)+((W=P.marginRight)!==null&&W!==void 0?W:0))):P.positionType===Ie.inlineEnd&&(p.push(P),m=Math.max(m,((D=P.height)!==null&&D!==void 0?D:0)+((G=P.marginLeft)!==null&&G!==void 0?G:0)+((V=P.marginRight)!==null&&V!==void 0?V:0)))})}let C=1,_=n;if(i.isHeader(n,e)||!((r=i.getBodyColumnDefine(n,e))===null||r===void 0)&&r.mergeCell||i.hasCustomMerge()){const T=i.getCellRange(n,e);C=T.end.row-T.start.row+1,n=T.start.col,_=T.end.col}const w=xe(Z("padding",u,n,e,i)),y=Z("fontSize",u,n,e,i),v=Z("fontStyle",u,n,e,i),x=Z("fontWeight",u,n,e,i),S=(o=Z("lineHeight",u,n,e,i))!==null&&o!==void 0?o:y,R=Z("fontFamily",u,n,e,i),B=Z("autoWrapText",u,n,e,i),A=Z("lineClamp",u,n,e,i),M=Z("underline",u,n,e,i),H=(s=Z("underlineOffset",u,n,e,i))!==null&&s!==void 0?s:0;let E;if(t!=="text"&&t!=="link"&&t!=="progressbar"&&t!=="checkbox"&&t!=="radio"&&t!=="switch"&&t!=="button")a=S;else if(t==="checkbox")a=fk(d,n,e,_,u,B,c,y,v,x,R,S,A,w,i);else if(t==="radio")a=gk(d,n,e,_,u,B,c,y,v,x,R,S,A,w,i);else if(t==="switch")a=pk(d,n,e,_,u,B,c,y,v,x,R,S,A,w,i);else if(t==="button")a=mk(d,n,e,_,u,B,c,y,v,x,R,S,A,w,i);else{E=d;const T=Xs(E,i).text,P=i.getColsWidth(n,_);if(g.length||p.length)if(B){const k=Object.assign({text:d==null?void 0:d.toString(),fontFamily:R,fontSize:y,fontStyle:v,fontWeight:x,lineHeight:S});k.textBaseline="middle";const L=[...g.map(F=>cd(F)),k,...p.map(F=>cd(F))];Xb.setAttributes({width:P-(w[1]+w[3])-c,height:0,textConfig:L}),a=Xb.AABBBounds.height()}else a=0,T.forEach((k,L)=>{var F;!((F=i.options.customConfig)===null||F===void 0)&&F.multilinesForXTable&&L!==0||(L===0&&g.length?a+=Math.max(S,f):L===T.length-1&&p.length?a+=Math.max(S,m):a+=S)});else if(B){const k=cn(n,e,i),L=P-(w[1]+w[3])-c-k;a=(uy({maxLineWidth:L,text:T,fontSize:y,fontStyle:v,fontWeight:x,fontFamily:R,lineHeight:S,wordBreak:"break-word",whiteSpace:T.length!==1||B?"normal":"no-wrap",lineClamp:A}).height()||(typeof S=="number"?S:y))+(M?H:0)}else a=!((l=i.options.customConfig)===null||l===void 0)&&l.multilinesForXTable?S:T.length*S}return(Math.max(a,h)+w[0]+w[2])/C}function Ak(n,e,t){return{left:0,top:0,right:t.getColWidth(n),bottom:t.getRowHeight(e),width:t.getColWidth(n),height:0}}function rr(n,e){if(!e||!e.proxy)return{colStart:0,colEnd:0,rowStart:0,rowEnd:0};const{mergeStartCol:t,mergeEndCol:i,mergeStartRow:r,mergeEndRow:o,col:s,row:l}=n;return{colStart:t,colEnd:i,rowStart:r,rowEnd:o}}function Bk(n,e){const t=n.start.col,i=n.end.col,r=n.start.row,o=n.end.row;let s=t,l=i,a=r,d=o;for(let u=t;u<=i;u++)for(let h=r;h<=o;h++){const c=e.getCellRange(u,h);c&&(s=Math.min(s,c.start.col),l=Math.max(l,c.end.col),a=Math.min(a,c.start.row),d=Math.max(d,c.end.row))}return n.start.col=s,n.end.col=l,n.start.row=a,n.end.row=d,n}function qb(n,e,t,i){i||n.table._setRowHeight(e,n.table.getRowHeight(e)+t,!0);for(let s=0;s<n.table.colCount;s++){const l=n.getCell(s,e);if(l.role==="empty")continue;const a=at(n.table,s,e);a&&a.start.col!==s||(hy(n,l,s,e,l.attribute.height+t,t,n.table.isHeader(s,e)),n.updateCellContentWhileResize(s,e))}let r=0,o=0;e<n.table.frozenRowCount?(r=e+1,o=n.table.frozenRowCount-1):e>=n.table.rowCount-n.table.bottomFrozenRowCount?(r=e+1,o=n.table.rowCount-1):(r=e+1,o=Math.min(n.proxy.rowEnd,n.table.rowCount-n.table.bottomFrozenRowCount-1));for(let s=0;s<n.table.colCount;s++)for(let l=r;l<=o;l++){const a=n.highPerformanceGetCell(s,l);a.role==="cell"&&a.setAttribute("y",a.attribute.y+t)}}function hy(n,e,t,i,r,o,s){e&&Mk(n,e,t,i,r,o)}function Mk(n,e,t,i,r,o,s){var l,a,d,u,h;if(e.attribute.height===r&&!e.needUpdateHeight)return;e.needUpdateHeight=!1,e.setAttribute("height",r);const c=(l=n.table.getCellRawRecord(t,i))===null||l===void 0?void 0:l.vtableMerge,g=!!n.table.getCustomMerge(t,i),f=c||g?"text":n.table.isHeader(t,i)?(a=n.table._getHeaderLayoutMap(t,i).headerType)!==null&&a!==void 0?a:"text":(d=n.table.getBodyColumnType(t,i))!==null&&d!==void 0?d:"text";if(f==="progressbar"){const p=n.table.getBodyColumnDefine(t,i),m=n.table._getCellStyle(t,i),b=n.table.getCellValue(t,i),C=n.table.getCellOriginValue(t,i),_=xe(Z("padding",m,t,i,n.table));let w;p!=null&&p.mergeCell&&(w=n.table.getCellRange(t,i));const y=ue.getFunction("createProgressBarCell")(p,m,e.attribute.width,b,C,t,i,_,n.table,w),v=e.getChildByName("progress-bar");e.insertBefore(y,v),e.removeChild(v),v.removeAllChild(),v.release(),Zb(e,r,o,n.table.isAutoRowHeight(i),!0,n.table)}else if(f==="sparkline"){e.removeAllChild();const p=n.table._getCellStyle(t,i),m=xe(Z("padding",p,t,i,n.table));ue.getFunction("createSparkLineCellGroup")(e,e.parent,e.attribute.x,e.attribute.y,t,i,e.attribute.width,e.attribute.height,m,n.table,ir(p,n.table,t,i,Z).theme,!1)}else if(f==="image"||f==="video")qs(e,t,i,0,o,n.table);else if(((u=e.firstChild)===null||u===void 0?void 0:u.name)==="axis")(h=e.firstChild)===null||h===void 0||h.originAxis.resize(e.attribute.width,e.attribute.height);else{let p=!0;const m=e.getChildByName(ti)||e.getChildByName(hd);if(m){let b;e.removeChild(m);const C=pd(t,i,e,n.table);if(C)for(let _=C.start.row;_<=C.end.row;_++){if(_===i)continue;const w=n.getCell(t,_),y=w.getChildByName(ti)||w.getChildByName(hd);y.removeAllChild(),w.removeChild(y),pd(t,_,w,n.table)}else{let _,w;const y=n.table.getCellLocation(t,i),{vtableMerge:v}=n.table.getCellRawRecord(t,i)||{};if(v&&n.table.options.groupTitleCustomLayout)w=n.table.options.groupTitleCustomLayout;else if(y!=="body"){const x=n.table.getHeaderDefine(t,i);_=x==null?void 0:x.headerCustomRender,w=x==null?void 0:x.headerCustomLayout}else{const x=n.table.getBodyColumnDefine(t,i);_=(x==null?void 0:x.customRender)||n.table.customRender,w=x==null?void 0:x.customLayout}if((_||w)&&Zi(e))for(let x=e.mergeStartCol;x<=e.mergeEndCol;x++)for(let S=e.mergeStartRow;S<=e.mergeEndRow;S++)S!==i&&n.updateCellContent(x,S);if(w||_){const x=n.table._getCellStyle(t,i),S=xe(Z("padding",x,t,i,n.table));let R=e.attribute.width,B=e.attribute.height;Zi(e)&&(R=n.table.getColsWidth(e.mergeStartCol,e.mergeEndCol),B=n.table.getRowsHeight(e.mergeStartRow,e.mergeEndRow));const A=er(w,_,t,i,R,B,!1,n.table.isAutoRowHeight(i),S,Zi(e)?{start:{col:e.mergeStartCol,row:e.mergeStartRow},end:{col:e.mergeEndCol,row:e.mergeEndRow}}:void 0,n.table);b=A.elementsGroup,p=A.renderDefault}e.childrenCount>0&&b?e.insertBefore(b,e.firstChild):b&&e.appendChild(b)}}Zb(e,r,o,n.table.isAutoRowHeight(i),p,n.table)}}function Zb(n,e,t,i,r,o){if(Zi(n)){e=0;for(let u=n.mergeStartRow;u<=n.mergeEndRow;u++)e+=o.getRowHeight(u);const{colStart:s,colEnd:l,rowStart:a,rowEnd:d}=rr(n,o.scenegraph);for(let u=s;u<=l;u++)for(let h=a;h<=d;h++){const c=o.scenegraph.getCell(u,h);if(c.role!=="cell")continue;if(c.forEachChildren(m=>{m.setAttributes({dx:0,dy:0})}),r){const m=o._getCellStyle(s,a),b=xe(Z("padding",m,u,h,o));gd(c,e,t,i,b,m.textAlign,m.textBaseline,o)}const g=o.getRowHeight(h),f=o.getColWidth(u);c.contentHeight=e;const{widthChange:p}=hl(c,f,g,{start:{col:n.mergeStartCol,row:n.mergeStartRow},end:{col:n.mergeEndCol,row:n.mergeEndRow}},o);p&&(c.needUpdateWidth=!0)}}else{const s=o._getCellStyle(n.col,n.row),l=xe(Z("padding",s,n.col,n.row,o));gd(n,e,t,i,l,s.textAlign,s.textBaseline,o)}}function Tk(n,e,t,i){i||n.table._setColWidth(e,n.table.getColWidth(e)+t,!0);const r=n.getColGroup(e,!0),o=n.getColGroupInRightTopCorner(e);r&&!o&&Kr(r,t,"col-corner",n),o&&Kr(o,t,"right-top",n);const s=n.getColGroup(e);s&&Kr(s,t,"row-body",n);const l=n.getColGroupInLeftBottomCorner(e);l&&Kr(l,t,"left-bottom",n);const a=n.getColGroupInBottom(e);a&&Kr(a,t,"bottom",n);const d=n.getColGroupInRightBottomCorner(e);d&&Kr(d,t,"right-bottom",n),e<n.frozenColCount?(n.cornerHeaderGroup.forEachChildrenSkipChild((u,h)=>{u.col>e&&u.setAttribute("x",u.attribute.x+t)}),n.rowHeaderGroup.forEachChildrenSkipChild((u,h)=>{u.col>e&&u.setAttribute("x",u.attribute.x+t)})):(n.colHeaderGroup.forEachChildrenSkipChild((u,h)=>{u.col>e&&u.setAttribute("x",u.attribute.x+t)}),n.bodyGroup.forEachChildrenSkipChild((u,h)=>{u.col>e&&u.setAttribute("x",u.attribute.x+t)})),l&&n.leftBottomCornerGroup.forEachChildrenSkipChild((u,h)=>{u.col>e&&u.setAttribute("x",u.attribute.x+t)}),a&&n.bottomFrozenGroup.forEachChildrenSkipChild((u,h)=>{u.col>e&&u.setAttribute("x",u.attribute.x+t)}),d&&n.rightBottomCornerGroup.forEachChildrenSkipChild((u,h)=>{u.col>e&&u.setAttribute("x",u.attribute.x+t)})}function Kr(n,e,t,i){var r,o,s,l,a,d,u;let h=!1;const c=(r=n==null?void 0:n.attribute.width)!==null&&r!==void 0?r:0;if(n==null||n.setAttribute("width",c+e),n==null||n.forEachChildren((g,f)=>{if(Pk(i,g,g.col,g.row,c,c+e,e,t!=="row-body"||g.col<i.table.rowHeaderLevelCount,i.table.internalProps.autoWrapText)){const p=at(i.table,g.col,g.row);if(p&&p.end.row-p.start.row)for(let m=p.start.row;m<=p.end.row;m++)Qb(i,m);else Qb(i,g.row);h=!0}}),h){let g,f,p,m=0;for(let b=0;b<i.table.colCount;b++){if(t==="col-corner"?(p=0,g=i.getColGroup(b,!0),f=(o=i.colHeaderGroup.attribute.height)!==null&&o!==void 0?o:0):t==="row-body"?(p=i.table.frozenRowCount,g=i.getColGroup(b,!1),f=(s=i.bodyGroup.attribute.height)!==null&&s!==void 0?s:0):t==="bottom"?(p=i.table.rowCount-i.table.bottomFrozenRowCount,g=i.getColGroupInBottom(b),f=(l=i.bottomFrozenGroup.attribute.height)!==null&&l!==void 0?l:0):t==="left-bottom"?(p=i.table.rowCount-i.table.bottomFrozenRowCount,g=i.getColGroupInLeftBottomCorner(b),f=(a=i.leftBottomCornerGroup.attribute.height)!==null&&a!==void 0?a:0):t==="right-top"?(p=0,g=i.getColGroupInRightTopCorner(b),f=(d=i.rightTopCornerGroup.attribute.height)!==null&&d!==void 0?d:0):t==="right-bottom"&&(p=i.table.rowCount-i.table.bottomFrozenRowCount,g=i.getColGroupInRightBottomCorner(b),f=(u=i.rightBottomCornerGroup.attribute.height)!==null&&u!==void 0?u:0),!g)continue;let C=0;g.forEachChildren(_=>{var w;_.setAttribute("y",C),C+=(w=i.table.getRowHeight(_.row))!==null&&w!==void 0?w:0}),m=C}i.updateContainerHeight(p,m-f);for(let b=0;b<i.table.frozenColCount;b++){const C=i.getColGroupInLeftBottomCorner(b);let _=0;C==null||C.forEachChildren(w=>{w.setAttribute("y",_),_+=i.table.getRowHeight(w.row)})}for(let b=i.table.colCount-i.table.rightFrozenColCount;b<i.table.colCount;b++){const C=i.getColGroupInRightBottomCorner(b);let _=0;C==null||C.forEachChildren(w=>{w.setAttribute("y",_),_+=i.table.getRowHeight(w.row)})}for(let b=i.table.frozenColCount;b<i.table.colCount-i.table.rightFrozenColCount;b++){const C=i.getColGroupInBottom(b);let _=0;C==null||C.forEachChildren(w=>{w.setAttribute("y",_),_+=i.table.getRowHeight(w.row)})}}}function Pk(n,e,t,i,r,o,s,l,a){var d,u,h,c,g,f,p;if(e.attribute.width===o&&!e.needUpdateWidth)return!1;e.needUpdateWidth=!1,e.setAttribute("width",o);const m=e;if(!m)return!1;const b=n.table.isAutoRowHeight(i),C=(d=n.table.getCellRawRecord(t,i))===null||d===void 0?void 0:d.vtableMerge,_=!!n.table.getCustomMerge(t,i),w=C||_?"text":n.table.isHeader(t,i)?(u=n.table._getHeaderLayoutMap(t,i).headerType)!==null&&u!==void 0?u:"text":(h=n.table.getBodyColumnType(t,i))!==null&&h!==void 0?h:"text";let y=!1;if(w==="progressbar"){const v=n.table.getBodyColumnDefine(t,i),x=n.table._getCellStyle(t,i),S=n.table.getCellValue(t,i),R=n.table.getCellOriginValue(t,i),B=xe(Z("padding",x,t,i,n.table));let A;v!=null&&v.mergeCell&&(A=n.table.getCellRange(t,i));const M=ue.getFunction("createProgressBarCell")(v,x,m.attribute.width,S,R,t,i,B,n.table,A),H=m.getChildByName("progress-bar");m.insertBefore(M,H),m.removeChild(H),H.removeAllChild(),H.release();const E=Jb(m,o,s,b,!0,n.table);y=y||E}else if(w==="sparkline"){m.removeAllChild();const v=n.table._getCellStyle(t,i),x=xe(Z("padding",v,t,i,n.table));ue.getFunction("createSparkLineCellGroup")(m,m.parent,m.attribute.x,m.attribute.y,t,i,m.attribute.width,m.attribute.height,x,n.table,ir(v,n.table,t,i,Z).theme,!1)}else if(w==="image"||w==="video")qs(m,t,i,s,0,n.table);else if(((c=m.firstChild)===null||c===void 0?void 0:c.name)==="axis"){const v=n.table.internalProps.layoutMap.getAxisConfigInPivotChart(t,i),x=n.table._getCellStyle(t,i),S=xe(Z("padding",x,t,i,n.table));if(v){const R=new(ue.getComponent("axis"))(v,m.attribute.width,m.attribute.height,(g=v.__vtablePadding)!==null&&g!==void 0?g:S,n.table);m.clear(),m.appendChild(R.component),R.overlap()}}else if(((f=e.firstChild)===null||f===void 0?void 0:f.name)==="axis")(p=e.firstChild)===null||p===void 0||p.originAxis.resize(e.attribute.width,e.attribute.height);else{let v=!0;const x=e.getChildByName(ti)||e.getChildByName(hd);if(x){let R;e.removeChild(x);const B=pd(t,i,e,n.table);if(B)for(let A=B.start.col;A<=B.end.col;A++){if(A===t)continue;const M=n.getCell(A,i),H=M.getChildByName(ti)||M.getChildByName(hd);H.removeAllChild(),M.removeChild(H),pd(A,i,M,n.table)}else{let A,M;const H=n.table.getCellLocation(t,i),{vtableMerge:E}=n.table.getCellRawRecord(t,i)||{};if(E&&n.table.options.groupTitleCustomLayout)M=n.table.options.groupTitleCustomLayout;else if(H!=="body"){const T=n.table.getHeaderDefine(t,i);A=T==null?void 0:T.headerCustomRender,M=T==null?void 0:T.headerCustomLayout}else{const T=n.table.getBodyColumnDefine(t,i);A=(T==null?void 0:T.customRender)||n.table.customRender,M=T==null?void 0:T.customLayout}if((A||M)&&Zi(m)){for(let T=m.mergeStartCol;T<=m.mergeEndCol;T++)if(T!==t)for(let P=m.mergeStartRow;P<=m.mergeEndRow;P++)n.updateCellContent(T,P)}if(M||A){const T=n.table._getCellStyle(t,i),P=xe(Z("padding",T,t,i,n.table));let k=m.attribute.width,L=m.attribute.height;Zi(m)&&(k=n.table.getColsWidth(m.mergeStartCol,m.mergeEndCol),L=n.table.getRowsHeight(m.mergeStartRow,m.mergeEndRow));const F=er(M,A,t,i,k,L,!1,n.table.isAutoRowHeight(i),P,Zi(m)?{start:{col:m.mergeStartCol,row:m.mergeStartRow},end:{col:m.mergeEndCol,row:m.mergeEndRow}}:void 0,n.table);R=F.elementsGroup,v=F.renderDefault,y=!0}e.childrenCount>0&&R?e.insertBefore(R,e.firstChild):R&&e.appendChild(R)}}const S=Jb(m,o,s,b,v,n.table);y=y||S}return a||(a=n.table._getCellStyle(t,i).autoWrapText),!(!b||!a)&&y}function Jb(n,e,t,i,r,o){if(Zi(n)){e=0;let u=!1;for(let m=n.mergeStartCol;m<=n.mergeEndCol;m++)e+=o.getColWidth(m);let h=0;for(let m=n.mergeStartRow;m<=n.mergeEndRow;m++)h+=o.getRowHeight(m);const{colStart:c,colEnd:g,rowStart:f,rowEnd:p}=rr(n,o.scenegraph);for(let m=c;m<=g;m++)for(let b=f;b<=p;b++){if(m===n.col&&b!==n.row)continue;const C=o.scenegraph.getCell(m,b);if(C.role!=="cell")continue;C.forEachChildren(x=>{x.setAttributes({dx:0,dy:0})});let _=!1;if(r){const x=o._getCellStyle(c,f),S=xe(Z("padding",x,m,b,o)),R=x.textAlign,B=x.textBaseline;_=fd(C,e,h,t,i,S,R,B,o.scenegraph);const A=cn(C.col,C.row,o);if(A){const M=C.getChildByName("text"),H=C.getChildByName("expand")||C.getChildByName("collapse");(H==null?void 0:H.role)!=="icon-left"&&M&&M.setAttribute("dx",A)}}const w=o.getRowHeight(b),y=o.getColWidth(m);C.contentWidth=e;const{heightChange:v}=hl(C,y,w,{start:{col:n.mergeStartCol,row:n.mergeStartRow},end:{col:n.mergeEndCol,row:n.mergeEndRow}},o);v&&(C.needUpdateHeight=!0),u=u||_}return u}const s=o._getCellStyle(n.col,n.row),l=xe(Z("padding",s,n.col,n.row,o)),a=s.textAlign,d=s.textBaseline;return fd(n,e,o.getRowHeight(n.row),t,i,l,a,d,o.scenegraph)}function Qb(n,e){const t=Math.round(Sn(e,0,n.table.colCount-1,n.table));n.table._setRowHeight(e,t,!0);for(let i=0;i<n.table.colCount;i++){const r=t,o=n.highPerformanceGetCell(i,e);o.role!=="empty"&&hy(n,o,i,e,r,r-o.attribute.height,n.table.isHeader(i,e))}}var ln;(function(n){n.dropDown="dropDown",n.contextmenu="contextmenu",n.custom="custom"})(ln||(ln={}));const Qe={fontSize:12,fontFamily:"Arial,sans-serif",color:"#000",highlightColor:"#2E68CF",hoverBgColor:"#EEE",lineHeight:30,bgColor:"#FFF",cornerRadius:4,borderWidth:.5,borderColor:"#CCC",menuPadding:6,menuItemPadding:9,maxLineWidth:200};let Hk=class{constructor(e){this._table=e,this._menuInstance=new Pe({x:0,y:0,fill:Qe.bgColor,stroke:Qe.borderColor,cornerRadius:Qe.cornerRadius,lineWidth:Qe.borderWidth}),this._menuInfo={x:-1,y:-1,col:-1,row:-1,type:ln.dropDown,menuInfo:[],highlightIndex:-1}}bindTableComponent(e){e.appendChild(this._menuInstance),this.bindEvent()}release(){}attach(e,t,i,r,o,s){if(o===ln.dropDown&&this.checkDropDownMenuChange(i,r)){const l=this.getMenuInfo(i,r,o);if(!l)return;const{menuInfo:a,highlightIndex:d}=l;this.updateMenuInfo(i,r,o,a,d),this.updateMenuInstance(a,d)}else if(o===ln.contextmenu&&this.checkContextMenuChange(e,t)){const l=this.getMenuInfo(i,r,o);if(!l)return;const{menuInfo:a,highlightIndex:d}=l;this.updateMenuInfo(i,r,o,a,d),this.updateMenuInstance(a,d)}this.updatePosition(e-this._table.scenegraph.x,t-this._table.scenegraph.y),this.addToScene()}updateMenuInfo(e,t,i,r,o){this._menuInfo.col=e,this._menuInfo.row=t,this._menuInfo.type=i,this._menuInfo.menuInfo=r,this._menuInfo.highlightIndex=o}checkDropDownMenuChange(e,t){const{type:i,col:r,row:o}=this._menuInfo;return i!==ln.dropDown||e!==r||t!==o}checkContextMenuChange(e,t){var i;const{type:r,menuInfo:o}=this._menuInfo;return r!==ln.contextmenu||o!==((i=this._table.internalProps.menu)===null||i===void 0?void 0:i.contextMenuItems)}updateMenuInstance(e,t){this._menuInstance.removeAllChild();let i=Qe.menuPadding;const r=Qe.menuPadding;let o=0;e.forEach((s,l)=>{var a,d;const u=t===l;let h,c;typeof s=="string"?c=s:typeof s=="object"&&(c=s.text,h=u?s.selectedIcon:s.icon);const g=new Pe({y:i,x:r,height:Qe.lineHeight,fill:Qe.bgColor});g.role="menu-item",this._menuInstance.appendChild(g),g.stateProxy=p=>p==="hover"?{fill:Qe.hoverBgColor}:{fill:Qe.bgColor},g.addEventListener("pointerenter",p=>{g.addState("hover",!0,!1),this._table.scenegraph.updateNextFrame()}),g.addEventListener("pointerleave",p=>{g.removeState("hover",!1),this._table.scenegraph.updateNextFrame()});const f=new Rt({x:Qe.menuItemPadding,y:Qe.menuItemPadding,fill:u?Qe.highlightColor:Qe.color,text:c,textBaseline:"top",fontSize:Qe.fontSize,fontFamily:Qe.fontFamily,pickable:!1,maxLineWidth:Qe.maxLineWidth,ellipsis:"…"});if(g.addChild(f),h){f.AABBBounds.height();const p=(a=h.width)!==null&&a!==void 0?a:16,m=(d=h.height)!==null&&d!==void 0?d:16,b=new Lr({x:Qe.menuItemPadding,y:(Qe.lineHeight-m)/2,width:p,height:m,image:h.svg,pickable:!1});b.role="menu-icon",g.insertBefore(b,f),f.setAttribute("x",p+Qe.menuItemPadding)}o=Math.max(g.AABBBounds.width(),o),i+=Qe.lineHeight}),this._menuInstance.setAttributes({width:o+2*Qe.menuItemPadding+2*Qe.menuPadding,height:i+Qe.menuPadding}),this._menuInstance.forEachChildren(s=>{s.setAttribute("width",o+2*Qe.menuItemPadding)})}updatePosition(e,t){this._menuInstance.setAttributes({x:this._menuInfo.type===ln.dropDown?e-this._menuInstance.attribute.width:e,y:t}),this._menuInfo.x=ln.dropDown?e-this._menuInstance.attribute.width:e,this._menuInfo.y=t}addToScene(){this._table.scenegraph.updateNextFrame()}detach(){this._menuInstance.setAttributes({x:-1e3,y:-1e3}),this._table.scenegraph.updateNextFrame()}getMenuInfo(e,t,i){var r;if(i===ln.dropDown){let o=this._table.globalDropDownMenu;o=this._table._getHeaderLayoutMap(e,t).dropDownMenu,typeof o=="function"&&(o=o({row:t,col:e,table:this._table}));let s=-1;if(Array.isArray(o)){for(let l=0;l<o.length;l++)if(this._table._dropDownMenuIsHighlight(e,t,l)){s=l;break}}return{menuInfo:o,highlightIndex:s}}if(i===ln.contextmenu){const o=(r=this._table.internalProps.menu)===null||r===void 0?void 0:r.contextMenuItems;let s;if(Array.isArray(o))s=o;else if(typeof o=="function"){const{field:l}=this._table.isHeader(e,t)?this._table.getHeaderDefine(e,t):this._table.getBodyColumnDefine(e,t);s=o(l,t,e)}return{menuInfo:s,highlightIndex:-1}}}bindEvent(){this._menuInstance.addEventListener("click",e=>{const{target:t}=e;if(t&&t.role==="menu-item"){const i=this.getEventInfo(t),r=this._table.getMenuInfo(this._menuInfo.col,this._menuInfo.row,this._menuInfo.type),o=Object.assign(i,r);o.event=e.nativeEvent,this._table.fireListeners(j.DROPDOWN_MENU_CLICK,o)}})}getEventInfo(e){const t=e.parent;let i=0;t.forEachChildren((s,l)=>s===e&&(i=l-1,!0));const r=typeof this._menuInfo.menuInfo[i]=="string"?this._menuInfo.menuInfo[i]:this._menuInfo.menuInfo[i].text,o=typeof this._menuInfo.menuInfo[i]=="string"?r:this._menuInfo.menuInfo[i].menuKey||r;return{col:this._menuInfo.col,row:this._menuInfo.row,dropDownIndex:i,highlight:i===this._menuInfo.highlightIndex,text:r,menuKey:o}}get bounds(){return this._menuInstance.globalAABBBounds}};const eh=Vn();class kk{constructor(){const e=eh.drillDown;this.icon=new Lr({x:-1e3,y:-1e3,image:e.svg,width:e.width,height:e.height,dx:-e.width/2,dy:-e.height/2,visible:!1,funcType:e.funcType,cursor:e.cursor}),this.icon.role="icon-drill"}appand(e){e.appendChild(this.icon)}update(e,t,i,r,o,s){if(!e||r&&o)return this.icon.setAttributes({x:-1e3,y:-1e3,visible:!1}),void s.updateNextFrame();const l=eh.drillDown,a=eh.drillUp;this.icon.setAttributes({x:t,y:i,image:r?l.svg:a.svg,visible:!0}),this.icon.loadImage(this.icon.attribute.image),s.updateNextFrame()}}class Ek{constructor(e){const t=e.theme.dragHeaderSplitLine.lineWidth,i=e.theme.dragHeaderSplitLine.lineColor,r=e.theme.dragHeaderSplitLine.shadowBlockColor;this.columnMoverLabel=zs({visible:!1,pickable:!1,x:0,y:0,symbolType:"triangle",fill:i}),this.columnMoverLine=un({visible:!1,pickable:!1,stroke:i,lineWidth:t,x:0,y:0,points:[{x:0,y:0},{x:0,y:0}]}),this.columnMoverBack=Ze({visible:!1,pickable:!1,fill:r,x:0,y:0,width:0,height:0}),this.table=e}appand(e){e.appendChild(this.columnMoverLabel),e.appendChild(this.columnMoverLine),e.appendChild(this.columnMoverBack)}show(e,t,i){const r=this.table.getCellLocation(e,t),o=at(this.table,e,t);o&&(e=o.start.col,t=o.start.row);let s=0,l=0,a=0,d=0,u=0,h=0,c=0,g=0,f=Math.PI;const p=[];return r==="columnHeader"?(s=this.table.getColsWidth(0,e-1)-this.table.stateManager.scroll.horizontalBarPos,l=this.table.getRowsHeight(0,this.table.frozenRowCount-1),d=this.table.tableNoFrameHeight,a=o?this.table.getColsWidth(o.start.col,o.end.col):this.table.getColWidth(e),u=s-i,c=s+a,g=2,p.push({x:0,y:0}),p.push({x:0,y:this.table.tableNoFrameHeight})):(r==="rowHeader"||this.table.internalProps.layoutMap.isSeriesNumberInBody(e,t))&&(l=this.table.getRowsHeight(0,t-1)-this.table.stateManager.scroll.verticalBarPos,s=this.table.getColsWidth(0,this.table.frozenColCount-1),a=this.table.tableNoFrameWidth,d=o?this.table.getRowsHeight(o.start.row,o.end.row):this.table.getRowHeight(t),h=l-i,c=2,g=l+d,f=Math.PI/2,p.push({x:0,y:0}),p.push({x:this.table.tableNoFrameWidth,y:0})),this.columnMoverBack.setAttributes({visible:!0,x:s-u,y:l-h,width:a,height:d,dx:u,dy:h}),this.columnMoverLine.setAttributes({x:c,y:g,visible:!0,points:p}),this.columnMoverLabel.setAttributes({visible:!0,x:c,y:g,angle:f}),{backX:s-u,lineX:c,backY:l-h,lineY:g}}hide(){this.columnMoverLabel.setAttribute("visible",!1),this.columnMoverLine.setAttribute("visible",!1),this.columnMoverBack.setAttribute("visible",!1)}update(e,t,i,r){typeof e=="number"&&typeof t=="number"?(this.columnMoverLabel.setAttribute("x",t),this.columnMoverLine.setAttribute("x",t),this.columnMoverBack.setAttribute("x",e)):typeof i=="number"&&typeof r=="number"&&(this.columnMoverLabel.setAttribute("y",r),this.columnMoverLine.setAttribute("y",r),this.columnMoverBack.setAttribute("y",i))}updateStyle(){const e=this.table.theme.dragHeaderSplitLine.lineWidth,t=this.table.theme.dragHeaderSplitLine.lineColor,i=this.table.theme.dragHeaderSplitLine.shadowBlockColor;this.columnMoverLabel.setAttributes({fill:t}),this.columnMoverLine.setAttributes({stroke:t,lineWidth:e}),this.columnMoverBack.setAttributes({fill:i})}}function jl(n,e,t){if(t)return Math.min(e.tableNoFrameWidth,e.getAllColsWidth())-e.getColsWidth(n,e.colCount-1);let i=e.getColsWidth(0,n);return n>=e.frozenColCount&&(i-=e.scrollLeft),i}function eC(n,e,t){if(t)return Math.min(e.tableNoFrameWidth,e.getAllRowsHeight())-e.getRowsHeight(n,e.rowCount-1);let i=e.getRowsHeight(0,n);return n>=e.frozenRowCount&&(i-=e.scrollTop),i}class Lk{constructor(e){var t,i,r,o,s,l,a,d,u,h,c,g,f,p,m,b,C;this.table=e;const _=this.table.theme;this.createScrollBar();const w=(t=_.columnResize)===null||t===void 0?void 0:t.lineColor,y=(i=_.columnResize)===null||i===void 0?void 0:i.lineWidth,v=(r=_.columnResize)===null||r===void 0?void 0:r.bgColor,x=(o=_.columnResize)===null||o===void 0?void 0:o.width,S=(l=(s=_.columnResize)===null||s===void 0?void 0:s.labelVisible)===null||l===void 0||l,R=(a=_.columnResize)===null||a===void 0?void 0:a.labelColor,B=(d=_.columnResize)===null||d===void 0?void 0:d.labelFontSize,A=(u=_.columnResize)===null||u===void 0?void 0:u.labelFontFamily,M=(h=_.columnResize)===null||h===void 0?void 0:h.labelBackgroundFill,H=(c=_.columnResize)===null||c===void 0?void 0:c.labelBackgroundCornerRadius;this.labelVisible=S,this.columnResizeLine=un({visible:!1,pickable:!1,stroke:w,lineWidth:y,x:0,y:0,points:[{x:0,y:0},{x:0,y:0}]}),this.columnResizeBgLine=un({visible:!1,pickable:!1,stroke:v,lineWidth:x,x:0,y:0,points:[{x:0,y:0},{x:0,y:0}]});const E=tc({visible:!1,pickable:!1,x:0,y:0,fontSize:B,fill:R,fontFamily:A,text:"",textBaseline:"top",dx:16,dy:-B/2}),T=Ze({visible:!1,pickable:!1,fill:M,x:0,y:0,width:5*B*.8,height:B+8,cornerRadius:H,dx:12,dy:-B/2-4});this.columnResizeLabel=pa({visible:!1,pickable:!1,x:0,y:0}),this.columnResizeLabel.appendChild(T),this.columnResizeLabel.appendChild(E),this.rowResizeLine=un({visible:!1,pickable:!1,stroke:w,lineWidth:y,x:0,y:0,points:[{x:0,y:0},{x:0,y:0}]}),this.rowResizeBgLine=un({visible:!1,pickable:!1,stroke:v,lineWidth:x,x:0,y:0,points:[{x:0,y:0},{x:0,y:0}]});const P=tc({visible:!1,pickable:!1,x:0,y:0,fontSize:B,fill:R,fontFamily:A,text:"",textBaseline:"top",dx:16,dy:-B/2}),k=Ze({visible:!1,pickable:!1,fill:M,x:0,y:0,width:5*B*.8,height:B+8,cornerRadius:H,dx:12,dy:-B/2-4});this.rowResizeLabel=pa({visible:!1,pickable:!1,x:0,y:0}),this.rowResizeLabel.appendChild(k),this.rowResizeLabel.appendChild(P),this.cellMover=new Ek(this.table);const L=(f=(g=_.frozenColumnLine)===null||g===void 0?void 0:g.shadow)===null||f===void 0?void 0:f.width,F=(m=(p=_.frozenColumnLine)===null||p===void 0?void 0:p.shadow)===null||m===void 0?void 0:m.startColor,z=(C=(b=_.frozenColumnLine)===null||b===void 0?void 0:b.shadow)===null||C===void 0?void 0:C.endColor;this.frozenShadowLine=Ze({visible:!0,pickable:!1,x:0,y:0,width:L,height:0,fill:{gradient:"linear",x0:0,y0:0,x1:1,y1:0,stops:[{color:F,offset:0},{color:z,offset:1}]}}),this.rightFrozenShadowLine=Ze({visible:!0,pickable:!1,x:0,y:0,width:L,height:0,fill:{gradient:"linear",x0:0,y0:0,x1:1,y1:0,stops:[{color:z,offset:0},{color:F,offset:1}]}}),this.menu=new Hk(this.table),this.drillIcon=new kk}addToGroup(e){e.addChild(this.frozenShadowLine),e.addChild(this.rightFrozenShadowLine),e.addChild(this.columnResizeBgLine),e.addChild(this.columnResizeLine),e.addChild(this.columnResizeLabel),e.addChild(this.rowResizeBgLine),e.addChild(this.rowResizeLine),e.addChild(this.rowResizeLabel),this.table.theme.scrollStyle.hoverOn&&!this.table.theme.scrollStyle.barToSide?(e.addChild(this.hScrollBar),e.addChild(this.vScrollBar)):(e.stage.defaultLayer.addChild(this.hScrollBar),e.stage.defaultLayer.addChild(this.vScrollBar)),this.menu.bindTableComponent(e),this.drillIcon.appand(e),this.cellMover.appand(e)}createScrollBar(){var e,t,i,r,o,s;const l=this.table.theme,a=(e=l.scrollStyle)===null||e===void 0?void 0:e.scrollRailColor,d=(t=l.scrollStyle)===null||t===void 0?void 0:t.scrollSliderColor,u=(i=l.scrollStyle)===null||i===void 0?void 0:i.scrollSliderCornerRadius,h=(r=l.scrollStyle)===null||r===void 0?void 0:r.width,c=(o=l.scrollStyle)===null||o===void 0?void 0:o.horizontalPadding,g=(s=l.scrollStyle)===null||s===void 0?void 0:s.verticalPadding;let f;f=O(u)?{cornerRadius:u,fill:d}:{fill:d},this.hScrollBar=new kr({direction:"horizontal",x:2*-this.table.tableNoFrameWidth,y:2*-this.table.tableNoFrameHeight,width:this.table.tableNoFrameWidth,height:h,padding:c,railStyle:{fill:a},sliderStyle:f,range:[0,.1],visible:!1}),this.hScrollBar.render(),this.hScrollBar.hideAll(),this.vScrollBar=new kr({direction:"vertical",x:2*-this.table.tableNoFrameWidth,y:2*-this.table.tableNoFrameHeight,width:h,height:this.table.tableNoFrameHeight-this.table.getFrozenRowsHeight(),padding:g,railStyle:{fill:a},sliderStyle:f,range:[0,.1],visible:!1}),this.vScrollBar.render(),this.vScrollBar.hideAll()}updateScrollBar(){var e,t,i,r,o,s,l;const a=this.table.stateManager.scroll.horizontalBarPos,d=this.table.stateManager.scroll.verticalBarPos,u=this.table.theme,h=(e=u.scrollStyle)===null||e===void 0?void 0:e.width,c=(t=u.scrollStyle)===null||t===void 0?void 0:t.visible,g=(r=(i=u.scrollStyle)===null||i===void 0?void 0:i.horizontalVisible)!==null&&r!==void 0?r:c,f=(s=(o=u.scrollStyle)===null||o===void 0?void 0:o.verticalVisible)!==null&&s!==void 0?s:c,p=Math.ceil(this.table.scenegraph.tableGroup.attribute.width),m=Math.ceil(this.table.scenegraph.tableGroup.attribute.height),b=this.table.getAllRowsHeight(),C=this.table.getAllColsWidth(),_=this.table.getFrozenRowsHeight(),w=this.table.getFrozenColsWidth(),y=this.table.getBottomFrozenRowsHeight(),v=this.table.getRightFrozenColsWidth(),x=!((l=this.table.options.customConfig)===null||l===void 0)&&l._disableColumnAndRowSizeRound?1:0;if(C>p+x){const S=Math.min(m,b),R=Math.max(.05,(p-w)/(C-w)),B=this.table.theme.scrollStyle.hoverOn;let A=0;A=this.table.theme.scrollStyle.barToSide?this.table.tableNoFrameHeight-(B?h:-this.table.scenegraph.tableGroup.attribute.y)+this.table.tableY:S-(B?h:-this.table.scenegraph.tableGroup.attribute.y),this.hScrollBar.setAttributes({x:w+(B?0:this.table.scenegraph.tableGroup.attribute.x),y:A,width:p-w-v,range:[0,R],visible:g==="always"});const M=this.hScrollBar.AABBBounds&&this.hScrollBar.globalAABBBounds;this.hScrollBar._viewPosition={x:M.x1,y:M.y1},g==="always"&&this.hScrollBar.showAll()}else this.hScrollBar.setAttributes({x:2*-this.table.tableNoFrameWidth,y:2*-this.table.tableNoFrameHeight,width:0,visible:!1});if(b>m+x){const S=Math.min(p,C),R=Math.max(.05,(m-_)/(b-_));let B=0;const A=this.table.theme.scrollStyle.hoverOn;B=this.table.theme.scrollStyle.barToSide?this.table.tableNoFrameWidth-(A?h:-this.table.scenegraph.tableGroup.attribute.x)+this.table.tableX:S-(A?h:-this.table.scenegraph.tableGroup.attribute.x),this.vScrollBar.setAttributes({x:B,y:_+(A?0:this.table.scenegraph.tableGroup.attribute.y),height:m-_-y,range:[0,R],visible:f==="always"});const M=this.vScrollBar.AABBBounds&&this.vScrollBar.globalAABBBounds;this.vScrollBar._viewPosition={x:M.x1,y:M.y1},f==="always"&&this.vScrollBar.showAll()}else this.vScrollBar.setAttributes({x:2*-this.table.tableNoFrameWidth,y:2*-this.table.tableNoFrameHeight,height:0,visible:!1});this.table.stateManager.setScrollLeft(a),this.table.stateManager.setScrollTop(d)}hideResizeCol(){this.columnResizeLine.setAttribute("visible",!1),this.columnResizeBgLine.setAttribute("visible",!1),this.columnResizeLabel.setAttribute("visible",!1),this.columnResizeLabel.hideAll()}showResizeCol(e,t,i){const r=jl(e,this.table,i);this.columnResizeLine.setAttributes({visible:!0,x:r,points:[{x:0,y:0},{x:0,y:this.table.getRowsHeight(0,this.table.rowCount-1)}]}),this.columnResizeBgLine.setAttributes({visible:!0,x:r,points:[{x:0,y:0},{x:0,y:this.table.getRowsHeight(0,this.table.rowCount-1)}]}),this.labelVisible&&(this.columnResizeLabel.showAll(),this.columnResizeLabel.setAttributes({visible:!0,x:r,y:t}),this.columnResizeLabel.lastChild.setAttribute("text",`${this.table.getColWidth(e)}px`))}updateResizeCol(e,t,i){const r=jl(e,this.table,i);this.columnResizeLine.setAttributes({x:r,points:[{x:0,y:0},{x:0,y:this.table.getRowsHeight(0,this.table.rowCount-1)}]}),this.columnResizeBgLine.setAttributes({x:r,points:[{x:0,y:0},{x:0,y:this.table.getRowsHeight(0,this.table.rowCount-1)}]}),this.labelVisible&&(this.columnResizeLabel.setAttributes({x:r,y:t}),this.columnResizeLabel.lastChild.setAttribute("text",`${Math.floor(this.table.getColWidth(e))}px`))}hideResizeRow(){this.rowResizeLine.setAttribute("visible",!1),this.rowResizeBgLine.setAttribute("visible",!1),this.rowResizeLabel.setAttribute("visible",!1),this.rowResizeLabel.hideAll()}showResizeRow(e,t,i){const r=eC(e,this.table,i);this.rowResizeLine.setAttributes({visible:!0,y:r,points:[{y:0,x:0},{y:0,x:this.table.getColsWidth(0,this.table.colCount-1)}]}),this.rowResizeBgLine.setAttributes({visible:!0,y:r,points:[{y:0,x:0},{y:0,x:this.table.getColsWidth(0,this.table.colCount-1)}]}),this.labelVisible&&(this.rowResizeLabel.showAll(),this.rowResizeLabel.setAttributes({visible:!0,y:r,x:t}),this.rowResizeLabel.lastChild.setAttribute("text",`${this.table.getRowHeight(e)}px`))}updateResizeRow(e,t,i){const r=eC(e,this.table,i);this.rowResizeLine.setAttributes({y:r,points:[{y:0,x:0},{y:0,x:this.table.getColsWidth(0,this.table.colCount-1)}]}),this.rowResizeBgLine.setAttributes({y:r,points:[{y:0,x:0},{y:0,x:this.table.getColsWidth(0,this.table.colCount-1)}]}),this.labelVisible&&(this.rowResizeLabel.setAttributes({y:r,x:t}),this.rowResizeLabel.lastChild.setAttribute("text",`${Math.floor(this.table.getRowHeight(e))}px`))}hideMoveCol(){this.cellMover.hide()}showMoveCol(e,t,i){return this.cellMover.show(e,t,i)}updateMoveCol(e,t,i,r){this.cellMover.update(e,t,i,r)}setFrozenColumnShadow(e,t){if(e<0)this.frozenShadowLine.setAttributes({visible:!1});else{const i=jl(e,this.table,t);this.frozenShadowLine.setAttributes({visible:!0,x:i,height:this.table.getDrawRange().height})}}setRightFrozenColumnShadow(e){if(e>=this.table.colCount)this.rightFrozenShadowLine.setAttributes({visible:!1});else{const t=jl(e,this.table,!0);this.rightFrozenShadowLine.setAttributes({visible:!0,x:t-this.rightFrozenShadowLine.attribute.width,height:this.table.getDrawRange().height})}}hideVerticalScrollBar(){var e;const t=this.table.theme.scrollStyle.visible,i=(e=this.table.theme.scrollStyle.verticalVisible)!==null&&e!==void 0?e:t;i!=="focus"&&i!=="scrolling"||(this.vScrollBar.setAttribute("visible",!1),this.vScrollBar.hideAll(),this.table.scenegraph.updateNextFrame())}showVerticalScrollBar(){var e;const t=this.table.theme.scrollStyle.visible,i=(e=this.table.theme.scrollStyle.verticalVisible)!==null&&e!==void 0?e:t;i!=="focus"&&i!=="scrolling"||(this.vScrollBar.setAttribute("visible",!0),this.vScrollBar.showAll(),this.table.scenegraph.updateNextFrame())}hideHorizontalScrollBar(){var e;const t=this.table.theme.scrollStyle.visible,i=(e=this.table.theme.scrollStyle.horizontalVisible)!==null&&e!==void 0?e:t;i!=="focus"&&i!=="scrolling"||(this.hScrollBar.setAttribute("visible",!1),this.hScrollBar.hideAll(),this.table.scenegraph.updateNextFrame())}showHorizontalScrollBar(){var e;const t=this.table.theme.scrollStyle.visible,i=(e=this.table.theme.scrollStyle.horizontalVisible)!==null&&e!==void 0?e:t;i!=="focus"&&i!=="scrolling"||(this.hScrollBar.setAttribute("visible",!0),this.hScrollBar.showAll(),this.table.scenegraph.updateNextFrame())}updateVerticalScrollBarPos(e){const t=this.vScrollBar.attribute.range,i=t[1]-t[0],r=e*(1-i);this.vScrollBar.setAttribute("range",[r,r+i]);const o=this.vScrollBar.AABBBounds&&this.vScrollBar.globalAABBBounds;this.vScrollBar._viewPosition={x:o.x1,y:o.y1}}updateHorizontalScrollBarPos(e){const t=this.hScrollBar.attribute.range,i=t[1]-t[0],r=e*(1-i);this.hScrollBar.setAttribute("range",[r,r+i]);const o=this.hScrollBar.AABBBounds&&this.hScrollBar.globalAABBBounds;this.hScrollBar._viewPosition={x:o.x1,y:o.y1}}updateStyle(){var e,t,i,r,o,s,l,a,d,u,h,c,g,f,p,m,b,C,_,w,y,v,x;const S=this.table.theme,R=(e=S.scrollStyle)===null||e===void 0?void 0:e.scrollRailColor,B=(t=S.scrollStyle)===null||t===void 0?void 0:t.scrollSliderColor,A=(i=S.scrollStyle)===null||i===void 0?void 0:i.scrollSliderCornerRadius,M=(r=S.scrollStyle)===null||r===void 0?void 0:r.width,H=(o=S.scrollStyle)===null||o===void 0?void 0:o.horizontalPadding,E=(s=S.scrollStyle)===null||s===void 0?void 0:s.verticalPadding;let T;T=O(A)?{cornerRadius:A,fill:B}:{fill:B},this.hScrollBar.setAttributes({height:M,padding:H,railStyle:{fill:R},sliderStyle:T}),this.vScrollBar.setAttributes({width:M,padding:E,railStyle:{fill:R},sliderStyle:T});const P=(l=S.columnResize)===null||l===void 0?void 0:l.lineColor,k=(a=S.columnResize)===null||a===void 0?void 0:a.lineWidth,L=(d=S.columnResize)===null||d===void 0?void 0:d.bgColor,F=(u=S.columnResize)===null||u===void 0?void 0:u.width;this.columnResizeLine.setAttributes({stroke:P,lineWidth:k}),this.columnResizeBgLine=un({stroke:L,lineWidth:F});const z=(h=S.columnResize)===null||h===void 0?void 0:h.labelColor,I=(c=S.columnResize)===null||c===void 0?void 0:c.labelFontSize,N=(g=S.columnResize)===null||g===void 0?void 0:g.labelFontFamily,W=(f=S.columnResize)===null||f===void 0?void 0:f.labelBackgroundFill,D=(p=S.columnResize)===null||p===void 0?void 0:p.labelBackgroundCornerRadius,G=(b=(m=S.columnResize)===null||m===void 0?void 0:m.labelVisible)===null||b===void 0||b;this.labelVisible=G,this.columnResizeLabel.lastChild.setAttributes({fontSize:I,fill:z,fontFamily:N,dy:-I/2}),this.columnResizeLabel.firstChild.setAttributes({fill:W,width:5*I*.8,height:I+8,cornerRadius:D,dy:-I/2-4}),this.rowResizeLabel.lastChild.setAttributes({fontSize:I,fill:z,fontFamily:N,dy:-I/2}),this.rowResizeLabel.firstChild.setAttributes({fill:W,width:5*I*.8,height:I+8,cornerRadius:D,dy:-I/2-4});const V=(_=(C=S.frozenColumnLine)===null||C===void 0?void 0:C.shadow)===null||_===void 0?void 0:_.width,X=(y=(w=S.frozenColumnLine)===null||w===void 0?void 0:w.shadow)===null||y===void 0?void 0:y.startColor,$=(x=(v=S.frozenColumnLine)===null||v===void 0?void 0:v.shadow)===null||x===void 0?void 0:x.endColor;this.frozenShadowLine.setAttributes({width:V,fill:{gradient:"linear",x0:0,y0:0,x1:1,y1:0,stops:[{color:X,offset:0},{color:$,offset:1}]}}),this.rightFrozenShadowLine.setAttributes({width:V,fill:{gradient:"linear",x0:0,y0:0,x1:1,y1:0,stops:[{color:$,offset:0},{color:X,offset:1}]}}),this.cellMover.updateStyle()}}function kn(n,e,t,i,r){var o,s,l,a,d,u;if(!e)return;const h=t==="table",{shadowBlur:c,shadowOffsetX:g,shadowOffsetY:f,shadowColor:p,cornerRadius:m,borderColor:b,borderLineWidth:C,borderLineDash:_}=e;let w=!1;const y={},v={pickable:!1};c&&h&&(v.shadowBlur=c,v.shadowOffsetX=g,v.shadowOffsetY=f,v.shadowColor=p,v.stroke=!0,v.stroke=p,v.lineWidth=1,w=!0),C&&(v.stroke=!0,v.fill=!1,v.stroke=tg(b??"#E1E4E8",i,C),v.lineWidth=C,_&&(v.lineDash=_),v.lineCap="butt"),Array.isArray(b)&&(v.strokeArrayColor=xe(b)),Array.isArray(C)&&(v.strokeArrayWidth=xe(C),v.lineWidth=1),m&&(v.cornerRadius=m,y.cornerRadius=m);const x=v.strokeArrayWidth?v.strokeArrayWidth[0]:(o=v.lineWidth)!==null&&o!==void 0?o:0,S=v.strokeArrayWidth?v.strokeArrayWidth[1]:(s=v.lineWidth)!==null&&s!==void 0?s:0,R=v.strokeArrayWidth?v.strokeArrayWidth[2]:(l=v.lineWidth)!==null&&l!==void 0?l:0,B=v.strokeArrayWidth?v.strokeArrayWidth[3]:(a=v.lineWidth)!==null&&a!==void 0?a:0;if(n.setAttributes(y),!r)if(v.stroke)if(v.x=B/2,v.y=x/2,v.pickable=!1,h){if(m)if(Array.isArray(m)){const H=xe(m);v.cornerRadius=H,y.cornerRadius=H,H[0]&&(H[0]=H[0]+Math.min(B,x)/2),H[1]&&(H[1]=H[1]+Math.min(x,S)/2),H[2]&&(H[2]=H[2]+Math.min(S,R)/2),H[3]&&(H[3]=H[3]+Math.min(R,B)/2)}else if(ee(C)){const H=[];v.cornerRadius=H,y.cornerRadius=H,H[0]=m+Math.min(B,x)/2,H[1]=m+Math.min(x,S)/2,H[2]=m+Math.min(S,R)/2,H[3]=m+Math.min(R,B)/2}else v.cornerRadius=m+((d=v.lineWidth)!==null&&d!==void 0?d:0)/2,y.cornerRadius=m+((u=v.lineWidth)!==null&&u!==void 0?u:0)/2;let A,M;if(e.innerBorder?(v.x=n.attribute.x+B/2,v.y=n.attribute.y+x/2,v.width=n.attribute.width-B/2-S/2,v.height=n.attribute.height-x/2-R/2):(v.x=n.attribute.x-B/2,v.y=n.attribute.y-x/2,v.width=n.attribute.width+B/2+S/2,v.height=n.attribute.height+x/2+R/2),w){v.fill="white",v.notAdjustPos=!0,M=pa(v),M.name="table-border-rect",A=Ze({x:B/2,y:x/2,width:n.attribute.width,height:n.attribute.height,fill:"red",cornerRadius:n.attribute.cornerRadius,globalCompositeOperation:"destination-out"}),M.addChild(A);const H=Ze({x:B/2,y:x/2,width:n.attribute.width,height:n.attribute.height,fill:"transparent",pickable:!1,globalCompositeOperation:"source-over"});M.addChild(H)}else M=Ze(v),M.name="table-border-rect";e.innerBorder&&!w?n.parent.insertAfter(M,n):n.parent.insertBefore(M,n),n.border=M}else{v.width=n.attribute.width-B/2-S/2,v.height=n.attribute.height-x/2-R/2;const A=Ze(v);A.name="border-rect",n.addChild(A),n.border=A}else{const A=Ze({fill:!1,stroke:!1,pickable:!1,lineWidth:0});A.name="border-rect",n.addChild(A),n.border=A}}function tC(n,e,t){var i;if(!e)return;const{borderColor:r}=e;(i=n.border)===null||i===void 0||i.setAttribute("stroke",tg(r,t))}function tg(n,e,t){let i=!0;return!e&&!ee(t)||ee(n)?e?i=e:e||ee(n)?ee(n)&&(i=!0):i=n:i=(e??t).map(r=>!!r&&n),i}function ci(n){var e,t,i,r;if(!n.border)return;const o=n.border.attribute.strokeArrayWidth?n.border.attribute.strokeArrayWidth[0]:(e=n.border.attribute.lineWidth)!==null&&e!==void 0?e:0,s=n.border.attribute.strokeArrayWidth?n.border.attribute.strokeArrayWidth[1]:(t=n.border.attribute.lineWidth)!==null&&t!==void 0?t:0,l=n.border.attribute.strokeArrayWidth?n.border.attribute.strokeArrayWidth[2]:(i=n.border.attribute.lineWidth)!==null&&i!==void 0?i:0,a=n.border.attribute.strokeArrayWidth?n.border.attribute.strokeArrayWidth[3]:(r=n.border.attribute.lineWidth)!==null&&r!==void 0?r:0;n.border.setAttributes({borderLeft:a,borderTop:o,borderRight:s,borderBottom:l,width:n.attribute.width-a/2-s/2,height:n.attribute.height-o/2-l/2}),n.border.type==="group"&&n.border.firstChild.setAttributes({width:n.attribute.width,height:n.attribute.height})}function Fk(n){if(!n.theme.frameStyle.cornerRadius)return;const e=n.theme.frameStyle.cornerRadius,{cornerHeaderGroup:t,colHeaderGroup:i,rowHeaderGroup:r,bodyGroup:o,rightTopCornerGroup:s,leftBottomCornerGroup:l,rightBottomCornerGroup:a,rightFrozenGroup:d,bottomFrozenGroup:u}=n.scenegraph;t.setAttribute("cornerRadius",0),i.setAttribute("cornerRadius",0),r.setAttribute("cornerRadius",0),o.setAttribute("cornerRadius",0),s.setAttribute("cornerRadius",0),l.setAttribute("cornerRadius",0),a.setAttribute("cornerRadius",0),d.setAttribute("cornerRadius",0),u.setAttribute("cornerRadius",0);const h=Tw(e);t.attribute.width>0&&t.attribute.height>0?Lt(t,[h[0],0,0,0]):i.attribute.height>0?Lt(i,[h[0],0,0,0]):r.attribute.width>0?Lt(r,[h[0],0,0,0]):Lt(o,[h[0],0,0,0]),l.attribute.width>0&&l.attribute.height>0?Lt(l,[0,0,0,h[3]]):u.attribute.height>0?Lt(u,[0,0,0,h[3]]):r.attribute.width>0?Lt(r,[0,0,0,h[3]]):Lt(o,[0,0,0,h[3]]),s.attribute.width>0&&s.attribute.height>0?Lt(s,[0,h[1],0,0]):i.attribute.height>0?Lt(i,[0,h[1],0,0]):d.attribute.width>0?Lt(d,[0,h[1],0,0]):Lt(o,[0,h[1],0,0]),a.attribute.width>0&&a.attribute.height>0?Lt(a,[0,0,h[2],0]):d.attribute.width>0?Lt(d,[0,0,h[2],0]):u.attribute.height>0?Lt(u,[0,0,h[2],0]):Lt(o,[0,0,h[2],0])}function Lt(n,e){n.setAttribute("cornerRadius",e),n.border&&n.border.setAttribute("cornerRadius",e)}const cy=Et();class bo extends jn{constructor(e,t){if(super(t),this.type="chart",this.numberType=cy,this.isShareChartSpec=e,t.chartInstance)this.chartInstance=t.chartInstance;else{const i=this.chartInstance=new t.ClassType(t.spec,re({},this.attribute.tableChartOption,{renderCanvas:t.canvas,mode:this.attribute.mode==="node"?"node":"desktop-browser",modeParams:this.attribute.modeParams,canvasControled:!1,viewBox:{x1:0,x2:0,y1:0,y2:0},dpr:t.dpr,interactive:!1,animation:!1,autoFit:!1}));i.renderSync(),i.getStage().enableDirtyBounds(),t.chartInstance=this.chartInstance=i}}activate(e){var t,i,r,o,s;this.active=!0;const{col:l,row:a}=this.parent,{x1:d,y1:u,x2:h,y2:c}=this.getViewBox(),g=zk(l,a,e).intersect({x1:d-e.scrollLeft,x2:h-e.scrollLeft,y1:u-e.scrollTop,y2:c-e.scrollTop});(t=this.activeChartInstance)===null||t===void 0||t.release(),this.activeChartInstance=new this.attribute.ClassType(this.attribute.spec,re({},this.attribute.tableChartOption,{renderCanvas:this.attribute.canvas,mode:"desktop-browser",canvasControled:!1,viewBox:{x1:0,x2:h-d,y1:0,y2:c-u},dpr:e.internalProps.pixelRatio,animation:!1,interactive:!0,autoFit:!1,beforeRender:b=>{const C=this.stage,_=b.window.getContext(),w=C.window.getViewBoxTransform(),y=C.window.getViewBox();_.inuse=!0,_.clearMatrix(),_.setTransform(w.a,w.b,w.c,w.d,w.e,w.f,!0),_.translate(y.x1,y.y1),_.setTransformForCurrent(!0),_.beginPath(),_.rect(g.x1,g.y1,g.x2-g.x1,g.y2-g.y1),_.clip(),_.clearMatrix(),e.options.canvas&&!b.needRender&&(b.pauseRender(),e.scenegraph.stage.dirtyBounds.union(this.globalAABBBounds),e.scenegraph.updateNextFrame())},afterRender(b){b.window.getContext().inuse=!1,b.needRender=!1,f.resumeRender()}}));const f=this.activeChartInstance.getStage(),p=this.globalTransMatrix.clone(),m=this.stage.window.getViewBoxTransform();p.multiply(m.a,m.b,m.c,m.d,m.e,m.f),f.window.setViewBoxTransform&&f.window.setViewBoxTransform(p.a,p.b,p.c,p.d,p.e,p.f),this.activeChartInstance.renderSync(),(r=(i=e.internalProps.layoutMap)===null||i===void 0?void 0:i.updateDataStateToActiveChartInstance)===null||r===void 0||r.call(i,this.activeChartInstance),this.activeChartInstance.on("click",b=>{var C;((C=this.attribute.spec.select)===null||C===void 0?void 0:C.enable)===!1?e.scenegraph.updateChartState(null):bo.temp&&e.scenegraph.updateChartState(b==null?void 0:b.datum)}),this.activeChartInstance.on("brushEnd",b=>{var C;e.scenegraph.updateChartState((C=b==null?void 0:b.value)===null||C===void 0?void 0:C.inBrushData),bo.temp=0,setTimeout(()=>{bo.temp=1},0)}),(s=(o=e)._bindChartEvent)===null||s===void 0||s.call(o,this.activeChartInstance)}deactivate(){var e,t;this.active=!1,(e=this.activeChartInstance)===null||e===void 0||e.updateViewBox({x1:-1e3,x2:-800,y1:-1e3,y2:-800},!1,!1),(t=this.activeChartInstance)===null||t===void 0||t.release(),this.activeChartInstance=null}updateData(e){this.attribute.data=e}getViewBox(){var e,t,i,r,o,s,l,a;const d=this.parent,u=this.attribute.cellPadding,h=this.stage.table,{x1:c,y1:g,x2:f,y2:p}=d.globalAABBBounds;return{x1:Math.ceil(c+u[3]+h.scrollLeft+((t=(e=h.options.viewBox)===null||e===void 0?void 0:e.x1)!==null&&t!==void 0?t:0)),x2:Math.ceil(c+d.attribute.width-u[1]+h.scrollLeft+((r=(i=h.options.viewBox)===null||i===void 0?void 0:i.x1)!==null&&r!==void 0?r:0)),y1:Math.ceil(g+u[0]+h.scrollTop+((s=(o=h.options.viewBox)===null||o===void 0?void 0:o.y1)!==null&&s!==void 0?s:0)),y2:Math.ceil(g+d.attribute.height-u[2]+h.scrollTop+((a=(l=h.options.viewBox)===null||l===void 0?void 0:l.y1)!==null&&a!==void 0?a:0))}}}function zk(n,e,t){var i,r,o,s,l,a,d,u;const{layoutMap:h}=t.internalProps,c=new Ri,g=t.scenegraph.tableGroup.globalAABBBounds;return c.x1=g.x1,c.x2=g.x2,c.y1=g.y1,c.y2=g.y2,h.isLeftBottomCorner(n,e)||h.isRightTopCorner(n,e)||h.isLeftTopCorner(n,e)||h.isRightBottomCorner(n,e)||(h.isFrozenColumn(n,e)?(c.y1=g.y1+t.getFrozenRowsHeight(),c.y2=g.y2-t.getBottomFrozenRowsHeight()):h.isFrozenRow(n,e)?(c.x1=g.x1+t.getFrozenColsWidth(),c.x2=g.x2-t.getRightFrozenColsWidth()):h.isRightFrozenColumn(n,e)?(c.y1=g.y1+t.getFrozenRowsHeight(),c.y2=g.y2-t.getBottomFrozenRowsHeight()):h.isBottomFrozenRow(n,e)?(c.x1=g.x1+t.getFrozenColsWidth(),c.x2=g.x2-t.getRightFrozenColsWidth()):h.isFrozenColumn(n,e)||h.isRightFrozenColumn(n,e)||(c.x1=g.x1+t.getFrozenColsWidth(),c.x2=g.x2-t.getRightFrozenColsWidth(),c.y1=g.y1+t.getFrozenRowsHeight(),c.y2=g.y2-t.getBottomFrozenRowsHeight())),c.x1=c.x1+((r=(i=t.options.viewBox)===null||i===void 0?void 0:i.x1)!==null&&r!==void 0?r:0),c.x2=c.x2+((s=(o=t.options.viewBox)===null||o===void 0?void 0:o.x1)!==null&&s!==void 0?s:0),c.y1=c.y1+((a=(l=t.options.viewBox)===null||l===void 0?void 0:l.y1)!==null&&a!==void 0?a:0),c.y2=c.y2+((u=(d=t.options.viewBox)===null||d===void 0?void 0:d.y1)!==null&&u!==void 0?u:0),c}bo.temp=1;const tf=[],nf=[];let rf=5,of=!1;function nC(n){O(n)&&(rf=n)}function Ik(){return of}function fy(n){var e,t,i,r,o,s,l;const{axes:a,dataId:d,data:u,spec:h,ClassType:c,canvas:g,mode:f,modeParams:p,dpr:m}=n.attribute;let{chartInstance:b}=n;b||(b=new c(h,{renderCanvas:g,mode:f==="node"?"node":"desktop-browser",modeParams:p,canvasControled:!1,viewBox:{x1:0,x2:0,y1:0,y2:0},dpr:m,interactive:!1,animation:!1,autoFit:!1}),b.renderSync(),n.chartInstance=b);const C=n.getViewBox();C.x2<=C.x1&&(C.x2=C.x1+1),C.y2<=C.y1&&(C.y2=C.y1+1),b.updateViewBox({x1:0,x2:C.x2-C.x1,y1:0,y2:C.y2-C.y1},!1,!1);const _=b.getStage(),w=n.globalTransMatrix.clone(),y=n.stage.window.getViewBoxTransform();w.multiply(y.a,y.b,y.c,y.d,y.e,y.f),_.window.setViewBoxTransform&&_.window.setViewBoxTransform(w.a,w.b,w.c,w.d,w.e,w.f);const{table:v}=n.getRootNode();let x=!1;if(v.options.specFormat){const S=v.options.specFormat(n.attribute.spec,b,n);if(S.needFormatSpec&&S.spec){const R=S.spec;b.updateSpecSync(R),x=(e=S.updateSpec)===null||e===void 0||e}}if(!x)if(a==null||a.forEach((S,R)=>{var B,A,M,H,E;S.type==="band"?b.updateModelSpec({type:"axes",index:R},{domain:S.domain.slice(0)},!0):b.updateModelSpecSync({type:"axes",index:R},{min:(A=(B=S.range)===null||B===void 0?void 0:B.min)!==null&&A!==void 0?A:0,max:(H=(M=S.range)===null||M===void 0?void 0:M.max)!==null&&H!==void 0?H:0,tick:{tickMode:(E=S.tick)===null||E===void 0?void 0:E.tickMode}},!0)}),(i=(t=v.internalProps.layoutMap)===null||t===void 0?void 0:t.updateDataStateToActiveChartInstance)===null||i===void 0||i.call(t,b),typeof d=="string")b.updateDataSync(d,u??[]);else{const S=[];for(const R in d){const B=d[R],A=h.series.find(M=>{var H;return((H=M==null?void 0:M.data)===null||H===void 0?void 0:H.id)===R});S.push({id:R,values:B?(r=u==null?void 0:u.filter(M=>M.hasOwnProperty(B)))!==null&&r!==void 0?r:[]:u??[],fields:(o=A==null?void 0:A.data)===null||o===void 0?void 0:o.fields}),b.updateFullDataSync||b.updateDataSync(R,B?(s=u==null?void 0:u.filter(M=>M.hasOwnProperty(B)))!==null&&s!==void 0?s:[]:u??[])}(l=b.updateFullDataSync)===null||l===void 0||l.call(b,S)}Ok(b.getStage(),n)}function gy(n){of=!0,nf.length>0?requestAnimationFrame(()=>{const e=nf.splice(0,rf);tf.splice(0,rf),e.forEach(t=>{fy(t),t.addUpdateBoundTag()}),n.render(),gy(n)}):of=!1}const Xn=2e3;function Ok(n,e){var t;const{viewWidth:i,viewHeight:r}=n;if(i<Xn&&r<Xn)return e.cacheCanvas=iC(n),void(e.isShareChartSpec||((t=e.chartInstance)===null||t===void 0||t.release(),e.chartInstance=null,e.setAttribute("chartInstance",null)));const o=Math.ceil(r/Xn),s=Math.ceil(i/Xn),l=[];for(let a=0;a<o;a++)for(let d=0;d<s;d++){const u=d*Xn,h=a*Xn,c=u+Xn>i?i:u+Xn,g=h+Xn>r?r:h+Xn,f=c-u,p=g-h,m=new Ri;m.setValue(u,h,c,g);const b=iC(n,!1,m);l.push({canvas:b,x:u,y:h,width:f,height:p})}e.cacheCanvas=l}function iC(n,e=!0,t){if(n.releaseStatus==="released")return null;const i=n.window.getViewBoxTransform(),r=Dk(n,e,t);r.setViewBoxTransform(i.a,i.b,i.c,i.d,0,0),n.renderTo(r);const o=r.getNativeHandler();return o.nativeCanvas?o.nativeCanvas:null}function Dk(n,e=!0,t){const i=n.window.getViewBoxTransform(),r=Ce.get(Hs),o=t?-t.x1:0,s=t?-t.y1:0,l=t?t.x2:n.viewWidth,a=t?t.y2:n.viewHeight,d=t?t.width():n.viewWidth,u=t?t.height():n.viewHeight;return r.create({viewBox:{x1:o,y1:s,x2:l,y2:a},width:d*i.a,height:u*i.d,dpr:n.window.dpr,canvasControled:!0,offscreen:!0,title:""}),n.renderTo(r),r}var Wk=function(n,e,t,i){var r,o=arguments.length,s=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,e,t,i);else for(var l=n.length-1;l>=0;l--)(r=n[l])&&(s=(o<3?r(s):o>3?r(e,t,s):r(e,t))||s);return o>3&&s&&Object.defineProperty(e,t,s),s};const Nk=Symbol.for("ChartRender");let Ss=class extends tn{constructor(){super(...arguments),this.numberType=cy}drawShape(n,e,t,i,r,o,s,l){var a,d,u,h;const c=ve(n,o==null?void 0:o.theme).group,{dataId:g,data:f,spec:p}=n.attribute,{width:m=c.width,height:b=c.height}=(n.getViewBox(),n.attribute),{table:C}=n.getRootNode(),{active:_,cacheCanvas:w,activeChartInstance:y}=n;if(!_&&w)ee(w)?w.forEach(v=>{const{x,y:S,width:R,height:B,canvas:A}=v;e.drawImage(A,x,S,R,B)}):e.drawImage(w,t,i,m,b);else if(y){if(C.options.specFormat){const B=C.options.specFormat(n.attribute.spec,y,n);if(B.needFormatSpec&&B.spec){const A=B.spec;y.updateSpecSync(A)}}const v=n.getViewBox();y.updateViewBox({x1:0,x2:v.x2-v.x1,y1:0,y2:v.y2-v.y1},!1,!1);const x=y.getStage();x.needRender=!0;const S=n.globalTransMatrix.clone(),R=n.stage.window.getViewBoxTransform().clone();if(R.multiply(S.a,S.b,S.c,S.d,S.e,S.f),x.window.setViewBoxTransform(R.a,R.b,R.c,R.d,R.e,R.f),typeof g=="string")y.updateDataSync(g,f??[]);else{const B=[];for(const A in g){const M=g[A],H=p.series.find(E=>{var T;return((T=E==null?void 0:E.data)===null||T===void 0?void 0:T.id)===A});B.push({id:A,values:M?(a=f==null?void 0:f.filter(E=>E.hasOwnProperty(M)))!==null&&a!==void 0?a:[]:f??[],fields:(d=H==null?void 0:H.data)===null||d===void 0?void 0:d.fields}),y.updateFullDataSync||y.updateDataSync(A,M?(u=f==null?void 0:f.filter(E=>E.hasOwnProperty(M)))!==null&&u!==void 0?u:[]:f??[])}(h=y.updateFullDataSync)===null||h===void 0||h.call(y,B)}}else C.internalProps.renderChartAsync?(tf.indexOf(`${n.parent.col}+${n.parent.row}`)===-1&&(tf.push(`${n.parent.col}+${n.parent.row}`),nf.push(n)),Ik()||gy(C)):fy(n)}draw(n,e,t,i){this._draw(n,{},!1,t,i)}};Ss=Wk([se()],Ss);var Au=function(n,e,t,i){var r,o=arguments.length,s=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,e,t,i);else for(var l=n.length-1;l>=0;l--)(r=n[l])&&(s=(o<3?r(s):o>3?r(e,t,s):r(e,t))||s);return o>3&&s&&Object.defineProperty(e,t,s),s};let md=class{constructor(){this.time=Ee.beforeFillStroke,this.useStyle=!0,this.order=0}drawShape(n,e,t,i,r,o,s,l,a,d,u,h,c){const{shape:g}=n.attribute;if(g==="circle"){const{width:f=a.width,height:p=a.height}=n.attribute;e.beginPath(),e.arc(t+f/2,i+p/2,Math.min(f,p)/2,0,2*Math.PI),e.closePath(),e.save(),e.clip()}}};md=Au([se()],md);let bd=class{constructor(){this.time=Ee.afterFillStroke,this.useStyle=!0,this.order=0}drawShape(n,e,t,i,r,o,s,l,a,d,u,h,c){const{shape:g}=n.attribute;g==="circle"&&e.restore()}};bd=Au([se()],bd);let Cd=class{constructor(){this.time=Ee.beforeFillStroke,this.useStyle=!0,this.order=0}drawShape(n,e,t,i,r,o,s,l,a,d,u,h,c){const{isGif:g}=n.attribute;g&&n.playing&&(n.attribute.opacity=0)}};Cd=Au([se()],Cd);let _d=class{constructor(){this.time=Ee.afterFillStroke,this.useStyle=!0,this.order=0}drawShape(n,e,t,i,r,o,s,l,a,d,u,h,c){const{isGif:g}=n.attribute;g&&n.playing&&(n.attribute.opacity=1,e.globalAlpha=n.attribute.opacity,n.renderFrame(e,t,i))}};_d=Au([se()],_d);function Vk(n,e){var t,i,r,o,s,l,a,d,u,h,c;let g,f;if(n.role==="cell"&&O(n.mergeStartCol)&&O(n.mergeStartRow)&&O(n.mergeEndCol)&&O(n.mergeEndRow)){const{colStart:m,colEnd:b,rowStart:C,rowEnd:_}=rr(n,e.scenegraph);for(let w=m;w<=b;w++)for(let y=C;y<=_;y++){const v=rC(e.stateManager,w,y,n);!v||g&&v!=="cellBgColor"||(g=v)}}else n.role==="cell"&&(g=rC(e.stateManager,n.col,n.row,n));if(!g)return;const p=e.internalProps.layoutMap;return p.isCornerHeader(n.col,n.row)?f=((t=e.theme.cornerHeaderStyle)===null||t===void 0?void 0:t.hover)||((i=e.theme.headerStyle)===null||i===void 0?void 0:i.hover):p.isColumnHeader(n.col,n.row)?f=(r=e.theme.headerStyle)===null||r===void 0?void 0:r.hover:p.isRowHeader(n.col,n.row)?f=(o=e.theme.rowHeaderStyle)===null||o===void 0?void 0:o.hover:p.isBottomFrozenRow(n.col,n.row)?f=((s=e.theme.bottomFrozenStyle)===null||s===void 0?void 0:s.hover)||(e.isListTable()?(l=e.theme.bodyStyle)===null||l===void 0?void 0:l.hover:(a=e.theme.headerStyle)===null||a===void 0?void 0:a.hover):p.isRightFrozenColumn(n.col,n.row)?f=((d=e.theme.rightFrozenStyle)===null||d===void 0?void 0:d.hover)||(e.isListTable()?(u=e.theme.bodyStyle)===null||u===void 0?void 0:u.hover:(h=e.theme.rowHeaderStyle)===null||h===void 0?void 0:h.hover):e.isHeader(n.col,n.row)||(f=(c=e.theme.bodyStyle)===null||c===void 0?void 0:c.hover),Z(g,f,n.col,n.row,e)}function rC(n,e,t,i){var r;const{highlightScope:o,disableHeader:s,cellPos:l}=n.hover,a=n.table,d=a.isHeader(e,t);if(d&&s)return;let u;if(o===He.single&&l.col===e&&l.row===t?u="cellBgColor":o===He.column&&l.col===e?u=l.col===e&&l.row===t?"cellBgColor":"inlineColumnBgColor":o===He.row&&l.row===t?u=l.col===e&&l.row===t?"cellBgColor":"inlineRowBgColor":o===He.cross&&(l.col===e&&l.row===t?u="cellBgColor":l.col===e?u="inlineColumnBgColor":l.row===t&&(u="inlineRowBgColor")),u){let h;if(d){const c=a.getHeaderDefine(e,t);h=c==null?void 0:c.disableHeaderHover,i.firstChild&&i.firstChild.name==="axis"&&(!((r=a.options.hover)===null||r===void 0)&&r.disableAxisHover)&&(h=!0)}else{const c=a.getBodyColumnDefine(e,t);h=c==null?void 0:c.disableHover}h&&(u=void 0)}return u}function Gk(n,e){var t,i,r,o,s,l,a,d,u,h,c;let g,f;if(n.role==="cell"&&O(n.mergeStartCol)&&O(n.mergeStartRow)&&O(n.mergeEndCol)&&O(n.mergeEndRow)){const{colStart:m,colEnd:b,rowStart:C,rowEnd:_}=rr(n,e.scenegraph);for(let w=m;w<=b;w++)for(let y=C;y<=_;y++){const v=oC(e.stateManager,w,y);!v||g&&v!=="cellBgColor"||(g=v)}}else n.role==="cell"&&(g=oC(e.stateManager,n.col,n.row));if(!g)return;const p=e.internalProps.layoutMap;return p.isCornerHeader(n.col,n.row)?f=((t=e.theme.cornerHeaderStyle)===null||t===void 0?void 0:t.select)||((i=e.theme.headerStyle)===null||i===void 0?void 0:i.select):p.isColumnHeader(n.col,n.row)?f=(r=e.theme.headerStyle)===null||r===void 0?void 0:r.select:p.isRowHeader(n.col,n.row)?f=(o=e.theme.rowHeaderStyle)===null||o===void 0?void 0:o.select:p.isBottomFrozenRow(n.col,n.row)?f=((s=e.theme.bottomFrozenStyle)===null||s===void 0?void 0:s.select)||(e.isListTable()?(l=e.theme.bodyStyle)===null||l===void 0?void 0:l.select:(a=e.theme.headerStyle)===null||a===void 0?void 0:a.select):p.isRightFrozenColumn(n.col,n.row)?f=((d=e.theme.rightFrozenStyle)===null||d===void 0?void 0:d.select)||(e.isListTable()?(u=e.theme.bodyStyle)===null||u===void 0?void 0:u.select:(h=e.theme.rowHeaderStyle)===null||h===void 0?void 0:h.select):e.isHeader(n.col,n.row)||(f=(c=e.theme.bodyStyle)===null||c===void 0?void 0:c.select),Z(g,f,n.col,n.row,e)}function jk(n){return n.start.col!==n.end.col||n.start.row!==n.end.row}function Uk(n,e,t){let i;const{highlightScope:r,cellPos:o,ranges:s}=n.select,l=s[0],a=Math.min(l.start.col,l.end.col),d=Math.max(l.start.col,l.end.col),u=Math.min(l.start.row,l.end.row),h=Math.max(l.start.row,l.end.row);return r===He.single&&o.col===e&&o.row===t?i="cellBgColor":r===He.column&&e>=a&&e<=d?i=Mn(s[0],e,t)?"cellBgColor":"inlineColumnBgColor":r===He.row&&t>=u&&t<=h?i=Mn(s[0],e,t)?"cellBgColor":"inlineRowBgColor":r===He.cross&&(Mn(s[0],e,t)?i="cellBgColor":e>=a&&e<=d?i="inlineColumnBgColor":t>=u&&t<=h&&(i="inlineRowBgColor")),i}function $k(n,e,t){let i;const{highlightScope:r,cellPos:o}=n.select;return r===He.single&&o.col===e&&o.row===t?i="cellBgColor":r===He.column&&o.col===e?i=o.col===e&&o.row===t?"cellBgColor":"inlineColumnBgColor":r===He.row&&o.row===t?i=o.col===e&&o.row===t?"cellBgColor":"inlineRowBgColor":r===He.cross&&(o.col===e&&o.row===t?i="cellBgColor":o.col===e?i="inlineColumnBgColor":o.row===t&&(i="inlineRowBgColor")),i}function oC(n,e,t,i){const{highlightInRange:r,disableHeader:o,ranges:s}=n.select;let l;const a=s.length===1&&jk(s==null?void 0:s[0])&&r;if(a?(s==null?void 0:s.length)===1&&s[0].start&&s[0].end:(s==null?void 0:s.length)===1&&s[0].end.col===s[0].start.col&&s[0].end.row===s[0].start.row){if(n.table.isHeader(e,t)&&o)return;l=a?Uk(n,e,t):$k(n,e,t),l&&Yi(n.table,e,t)&&(l=void 0)}else if(n.table.theme.selectionStyle.selectionFillMode==="replace")for(let d=0;d<s.length;d++){const u=s[d],h=Math.min(u.start.col,u.end.col),c=Math.max(u.start.col,u.end.col),g=Math.min(u.start.row,u.end.row),f=Math.max(u.start.row,u.end.row);if(h<=e&&g<=t&&c>=e&&f>=t){l="cellBgColor";break}}return l}function Yi(n,e,t){var i,r;const o=(i=n.options.select)===null||i===void 0?void 0:i.disableSelect;if(typeof o=="function"?o(e,t,n):o)return!0;if(n.isHeader(e,t)){let s=(r=n.options.select)===null||r===void 0?void 0:r.disableHeaderSelect;if(s)return!0;const l=n.getHeaderDefine(e,t);if(s=l==null?void 0:l.disableHeaderSelect,s)return!0}else{const s=n.getBodyColumnDefine(e,t),l=s==null?void 0:s.disableSelect;if(typeof l=="function"?l(e,t,n):l)return!0}return!1}var Hi=function(n,e,t,i){var r,o=arguments.length,s=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,e,t,i);else for(var l=n.length-1;l>=0;l--)(r=n[l])&&(s=(o<3?r(s):o>3?r(e,t,s):r(e,t))||s);return o>3&&s&&Object.defineProperty(e,t,s),s};let wd=class{constructor(){this.time=Ee.beforeFillStroke,this.useStyle=!0,this.order=0}drawShape(n,e,t,i,r,o,s,l,a,d,u,h,c){const{stroke:g=a.stroke,strokeArrayWidth:f=a.strokeArrayWidth,strokeArrayColor:p=a.strokeArrayColor}=n.attribute;g&&(Array.isArray(f)||Array.isArray(p))&&(c.doStroke=!1)}};wd=Hi([se()],wd);let yd=class{constructor(){this.time=Ee.afterFillStroke,this.useStyle=!0,this.order=0}drawShape(n,e,t,i,r,o,s,l,a,d,u,h){var c,g;const{stroke:f=a.stroke,strokeArrayColor:p=a.strokeArrayColor,strokeArrayWidth:m=a.strokeArrayWidth,lineWidth:b=a.lineWidth,strokeColor:C=a.stroke,cornerRadius:_=a.cornerRadius}=n.attribute;let w,y,{width:v=a.width,height:x=a.height}=n.attribute;if(f&&(Array.isArray(m)||b!==0)&&(Array.isArray(p)||Array.isArray(m))){if(typeof b=="number"&&1&b||Array.isArray(m)&&m.some(S=>1&S)){const S=n.stage.table;if(!S)return;const R=((c=S==null?void 0:S.theme)===null||c===void 0?void 0:c.cellBorderClipDirection)==="bottom-right";if(R){if(t=Math.floor(t)-.5,i=Math.floor(i)-.5,n.role==="cell"){const M=n.col,H=n.row;M===0&&(t+=1),H===0&&(i+=1)}}else t=Math.floor(t)+.5,i=Math.floor(i)+.5;!((g=S.options.customConfig)===null||g===void 0)&&g._disableColumnAndRowSizeRound&&(v=Math.round(v),x=Math.round(x));const{width:B,height:A}=ng(n,Math.ceil(v),Math.ceil(x),R);w=B,y=A}else w=Math.ceil(v),y=Math.ceil(x);_===0||ee(_)&&_.every(S=>S===0)?my(n,e,t,i,a,f,m||b,p||C,w,y):(e.beginPath(),ni(e,t,i,w,y,_,new Array(4).fill(0).map((S,R)=>(B,A,M,H)=>{Cy(R,B,A,M,H,n,e,t,i,a,f,m||b,p||C,w,y)})),e.stroke())}}};yd=Hi([se()],yd);function py(n){if(!Array.isArray(n))return{isSplitDraw:!1,width:n};let e;for(let t=0;t<n.length;t++){const i=n[t];if(i)if(e){if(i!==e)return{isSplitDraw:!0}}else e=i}return{isSplitDraw:!1,width:e}}function my(n,e,t,i,r,o,s,l,a,d,u,h){var c,g,f,p;const m=py(s),b=!Array.isArray(s),C=!Array.isArray(o),_=Array.isArray(h),w=Array.isArray(l)||m.isSplitDraw;e.setStrokeStyle(n,n.attribute,t,i,r);const{lineDash:y=r.lineDash}=n.attribute;let v=!1;y.length&&y.some(A=>Array.isArray(A))&&(v=!0),e.beginPath(),e.moveTo(t,i);const x=(C||o[0])&&(b||s[0]),S=(C||o[1])&&(b||s[1]),R=(C||o[2])&&(b||s[2]),B=(C||o[3])&&(b||s[3]);if(x){const A=(b?m.width:s[0])/2,M=(b?m.width:s[0])/2;_&&Array.isArray(h[0])?(e.moveTo(t-A+(a+A+M)*h[0][0],i),e.lineTo(t-A+(a+A+M)*(h[0][1]-h[0][0]),i),e.moveTo(t+a+M,i)):(e.moveTo(t-A,i),e.lineTo(t+a+M,i)),(w||v)&&(l&&l[0]?e.strokeStyle=l[0]:l&&!l[0]&&(e.strokeStyle="transparent"),b||(e.lineWidth=s[0]),e.lineDashOffset=e.currentMatrix.e/e.currentMatrix.a,v&&e.setLineDash((c=y[0])!==null&&c!==void 0?c:[]),e.stroke(),e.beginPath(),e.moveTo(t+a,i))}else e.moveTo(t+a,i);if(S){const A=(b?m.width:s[1])/2,M=(b?m.width:s[1])/2;_&&Array.isArray(h[1])?(e.moveTo(t+a,i-A+d*h[1][0]),e.lineTo(t+a,i-A+(d+A+M)*(h[1][1]-h[1][0])),e.moveTo(t+a,i+d+M)):(e.moveTo(t+a,i-A),e.lineTo(t+a,i+d+M)),(w||v)&&(l&&l[1]?e.strokeStyle=l[1]:l&&!l[1]&&(e.strokeStyle="transparent"),b||(e.lineWidth=s[1]),e.lineDashOffset=e.currentMatrix.f/e.currentMatrix.d,v&&e.setLineDash((g=y[1])!==null&&g!==void 0?g:[]),e.stroke(),e.beginPath(),e.moveTo(t+a,i+d))}else e.moveTo(t+a,i+d);if(R){const A=(b?m.width:s[2])/2,M=(b?m.width:s[2])/2;_&&Array.isArray(h[2])?(e.moveTo(t-A+(a+A+M)*h[2][0],i+d),e.lineTo(t-A+(a+A+M)*(h[2][1]-h[2][0]),i+d),e.moveTo(t-A,i+d)):(e.moveTo(t-A,i+d),e.lineTo(t+a+M,i+d)),(w||v)&&(l&&l[2]?e.strokeStyle=l[2]:l&&!l[2]&&(e.strokeStyle="transparent"),b||(e.lineWidth=s[2]),e.lineDashOffset=e.currentMatrix.e/e.currentMatrix.a,v&&e.setLineDash((f=y[2])!==null&&f!==void 0?f:[]),e.stroke(),e.beginPath(),e.moveTo(t,i+d))}else e.moveTo(t,i+d);if(B){const A=(b?m.width:s[3])/2,M=(b?m.width:s[3])/2;_&&Array.isArray(h[3])?(e.moveTo(t,i-A+(d+A+M)*h[3][0]),e.lineTo(t,i-A+(d+A+M)*(h[3][1]-h[3][0])),e.moveTo(t,i-A)):(e.moveTo(t,i-A),e.lineTo(t,i+d+M)),(w||v)&&(l&&l[3]?e.strokeStyle=l[3]:l&&!l[3]&&(e.strokeStyle="transparent"),b||(e.lineWidth=s[3]),e.lineDashOffset=e.currentMatrix.f/e.currentMatrix.d,v&&e.setLineDash((p=y[3])!==null&&p!==void 0?p:[]),e.stroke(),e.beginPath(),e.moveTo(t,i))}else e.moveTo(t,i);w||v||(!b&&m.width&&(e.lineWidth=m.width),e.stroke()),e.lineDashOffset=0,e.setLineDash([])}let vd=class{constructor(){this.time=Ee.beforeFillStroke,this.useStyle=!0,this.order=0}drawShape(n,e,t,i,r,o,s,l,a,d,u,h,c){var g;const{lineDash:f=a.lineDash,stroke:p=a.stroke,strokeArrayColor:m=a.strokeArrayColor,strokeArrayWidth:b=a.strokeArrayWidth}=n.attribute;p&&Array.isArray(f)&&f.length&&(!((g=f[0])===null||g===void 0)&&g.length)&&!Array.isArray(m)&&!Array.isArray(b)&&(c.doStroke=!1)}};vd=Hi([se()],vd);let Sd=class{constructor(){this.time=Ee.afterFillStroke,this.useStyle=!0,this.order=0}drawShape(n,e,t,i,r,o,s,l,a,d,u,h){var c,g,f,p,m,b;const{lineDash:C=a.lineDash,stroke:_=a.stroke,strokeArrayColor:w=a.strokeArrayColor,strokeArrayWidth:y=a.strokeArrayWidth,lineWidth:v=a.lineWidth}=n.attribute;if(!_||!(Array.isArray(C)&&C.length&&(!((c=C[0])===null||c===void 0)&&c.length))||Array.isArray(w)||Array.isArray(y))return;const x=n.stage.table;if(!x)return;const S=ee(C[0])?Kk(C):[C,C,C,C];let R,B,{width:A=a.width,height:M=a.height}=n.attribute;if(!((g=x.options.customConfig)===null||g===void 0)&&g._disableColumnAndRowSizeRound?(A=Math.round(A),M=Math.round(M)):(A=Math.ceil(A),M=Math.ceil(M)),1&v){const H=x.theme.cellBorderClipDirection==="bottom-right",E=0,T=0;H?(t=Math.floor(t)-.5,i=Math.floor(i)-.5,n.role==="cell"&&(n.col===0&&(t+=1),n.row===0&&(i+=1))):(t=Math.floor(t)+.5,i=Math.floor(i)+.5);const{width:P,height:k}=ng(n,Math.ceil(A+E),Math.ceil(M+T),H);R=P,B=k}else R=Math.ceil(A),B=Math.ceil(M);e.setStrokeStyle(n,n.attribute,t,i,a),e.beginPath(),e.moveTo(t,i),e.lineTo(t+R,i),e.lineDashOffset=e.currentMatrix.e/e.currentMatrix.a,e.setLineDash((f=S[0])!==null&&f!==void 0?f:[]),e.stroke(),e.beginPath(),e.moveTo(t+R,i),e.lineTo(t+R,i+B),e.lineDashOffset=e.currentMatrix.f/e.currentMatrix.d,e.setLineDash((p=S[1])!==null&&p!==void 0?p:[]),e.stroke(),e.beginPath(),e.moveTo(t,i+B),e.lineTo(t+R,i+B),e.lineDashOffset=e.currentMatrix.e/e.currentMatrix.a,e.setLineDash((m=S[2])!==null&&m!==void 0?m:[]),e.stroke(),e.beginPath(),e.moveTo(t,i),e.lineTo(t,i+B),e.lineDashOffset=e.currentMatrix.f/e.currentMatrix.d,e.setLineDash((b=S[3])!==null&&b!==void 0?b:[]),e.stroke(),e.lineDashOffset=0,e.setLineDash([])}};Sd=Hi([se()],Sd);let xd=class{constructor(){this.time=Ee.beforeFillStroke,this.useStyle=!0,this.order=0}drawShape(n,e,t,i,r,o,s,l,a,d,u,h,c){const{lineWidth:g=a.lineWidth,stroke:f=a.stroke,lineDash:p=a.lineDash,strokeArrayWidth:m=a.strokeArrayWidth,strokeArrayColor:b=a.strokeArrayColor,notAdjustPos:C}=n.attribute;C!==!0&&f&&Array.isArray(p)&&!p.length&&!Array.isArray(b)&&!Array.isArray(m)&&1&g&&(c.doStroke=!1)}};xd=Hi([se()],xd);let Rd=class{constructor(){this.time=Ee.afterFillStroke,this.useStyle=!0,this.order=0}drawShape(n,e,t,i,r,o,s,l,a,d,u,h){var c,g;const{lineWidth:f=a.lineWidth,stroke:p=a.stroke,lineDash:m=a.lineDash,strokeArrayWidth:b=a.strokeArrayWidth,strokeArrayColor:C=a.strokeArrayColor,notAdjustPos:_,cornerRadius:w=a.cornerRadius}=n.attribute;let{width:y=a.width,height:v=a.height}=n.attribute;if(_!==!0&&p&&Array.isArray(m)&&!m.length&&!Array.isArray(C)&&!Array.isArray(b)&&1&f){const x=n.stage.table;if(!x)return;!((c=x.options.customConfig)===null||c===void 0)&&c._disableColumnAndRowSizeRound&&(y=Math.round(y),v=Math.round(v)),e.beginPath();const S=((g=x==null?void 0:x.theme)===null||g===void 0?void 0:g.cellBorderClipDirection)==="bottom-right",R=0,B=0;S?(t=Math.floor(t)-.5,i=Math.floor(i)-.5,n.role==="cell"&&(n.col===0&&(t+=1),n.row===0&&(i+=1))):(t=Math.floor(t)+.5,i=Math.floor(i)+.5);const{width:A,height:M}=ng(n,Math.ceil(y),Math.ceil(v),S);w?ni(e,t,i,A+R,M+B,w):e.rect(t,i,A,M),e.setStrokeStyle(n,n.attribute,t,i,a),e.stroke()}}};Rd=Hi([se()],Rd);let Ad=class{constructor(){this.time=Ee.beforeFillStroke,this.useStyle=!0,this.order=0}drawShape(n,e,t,i,r,o,s,l,a,d,u,h,c){if(n.role==="cell"){const g=n.stage.table;if(g){const f=Gk(n,g);if(f)n.attribute._vtableHightLightFill=f;else if(g.stateManager.interactionState!==me.scrolling){const p=Vk(n,g);p&&(n.attribute._vtableHightLightFill=p)}}}}};Ad=Hi([se()],Ad);let Bd=class{constructor(){this.time=Ee.afterFillStroke,this.useStyle=!0,this.order=0}drawShape(n,e,t,i,r,o,s,l,a,d,u,h){if(n.attribute._vtableHightLightFill&&!u){if(s){const c=n.attribute.fill;n.attribute.fill=n.attribute._vtableHightLightFill,e.setCommonStyle(n,n.attribute,t,i,a),e.fill(),n.attribute.fill=c,n.attribute._vtableHightLightFill=void 0}}}};Bd=Hi([se()],Bd);let Md=class{constructor(){this.time=Ee.beforeFillStroke,this.useStyle=!0,this.order=0}drawShape(n,e,t,i,r,o,s,l,a,d,u,h,c){var g,f,p,m,b,C;const _=n.stage.table;_&&(n.role==="body"?fi(e,-((g=n.attribute.x)!==null&&g!==void 0?g:0)+_.getFrozenColsWidth(),-((f=n.attribute.y)!==null&&f!==void 0?f:0)+_.getFrozenRowsHeight(),n.parent.attribute.width-_.getFrozenColsWidth()-_.getRightFrozenColsWidth(),n.parent.attribute.height-_.getFrozenRowsHeight()-_.getBottomFrozenRowsHeight()):n.role==="row-header"?fi(e,0,-((p=n.attribute.y)!==null&&p!==void 0?p:0)+_.getFrozenRowsHeight(),_.getFrozenColsWidth(),n.parent.attribute.height-_.getFrozenRowsHeight()-_.getBottomFrozenRowsHeight()):n.role==="col-header"?fi(e,-((m=n.attribute.x)!==null&&m!==void 0?m:0)+_.getFrozenColsWidth(),0,n.parent.attribute.width-_.getFrozenColsWidth()-_.getRightFrozenColsWidth(),_.getFrozenRowsHeight()):n.role==="right-frozen"?fi(e,0,-((b=n.attribute.y)!==null&&b!==void 0?b:0)+_.getFrozenRowsHeight(),_.getRightFrozenColsWidth(),n.parent.attribute.height-_.getFrozenRowsHeight()-_.getBottomFrozenRowsHeight()):n.role==="bottom-frozen"?fi(e,-((C=n.attribute.x)!==null&&C!==void 0?C:0)+_.getFrozenColsWidth(),0,n.parent.attribute.width-_.getFrozenColsWidth()-_.getRightFrozenColsWidth(),_.getBottomFrozenRowsHeight()):n.role==="corner-header"?fi(e,0,0,_.getFrozenColsWidth(),_.getFrozenRowsHeight()):n.role==="corner-right-top-header"?fi(e,0,0,_.getRightFrozenColsWidth(),_.getFrozenRowsHeight()):n.role==="corner-right-bottom-header"?fi(e,0,0,_.getRightFrozenColsWidth(),_.getBottomFrozenRowsHeight()):n.role==="corner-left-bottom-header"&&fi(e,0,0,_.getFrozenColsWidth(),_.getBottomFrozenRowsHeight()))}};Md=Hi([se()],Md);const Yr=Math.pow(2,24);function fi(n,e,t,i,r){n.beginPath();const o=n.applyedMatrix;Math.abs(o.f)>Yr||Math.abs(o.g)>Yr?n.rect(e-Yr,t-Yr,i+2*Yr,r+2*Yr):n.rect(e,t,i,r)}function ng(n,e,t,i){const r=n.stage.table;if(!r)return{width:e,height:t};if(n.role==="cell"){let o=n.col,s=n.row;const l=at(r,o,s);l&&(o=l.end.col,s=l.end.row),o!==r.colCount-1||i?(o===r.frozenColCount-1&&r.scrollLeft&&!i||o===0&&i)&&(e-=1):e-=1,s!==r.rowCount-1||i?(s===r.frozenRowCount-1&&r.scrollTop&&!i||s===0&&i)&&(t-=1):t-=1}else n.role==="corner-frozen"&&(r.scrollLeft&&!i&&(e-=1),r.scrollTop&&!i&&(t-=1));return{width:e,height:t}}function Kk(n){return n.length===1?[n[0],n[0],n[0],n[0]]:n.length===2?[n[0],n[1],n[0],n[1]]:n}var by=function(n,e,t,i){var r,o=arguments.length,s=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,e,t,i);else for(var l=n.length-1;l>=0;l--)(r=n[l])&&(s=(o<3?r(s):o>3?r(e,t,s):r(e,t))||s);return o>3&&s&&Object.defineProperty(e,t,s),s};let xs=class{constructor(){this.time=Ee.beforeFillStroke,this.useStyle=!0,this.order=0}drawShape(n,e,t,i,r,o,s,l,a,d,u,h,c){const{stroke:g=a.stroke,strokeArrayWidth:f=a.strokeArrayWidth,strokeArrayColor:p=a.strokeArrayColor}=n.attribute;g&&(Array.isArray(g)||Array.isArray(f)||Array.isArray(p))&&(c.doStroke=!1)}};xs=by([se()],xs);let Rs=class{constructor(){this.time=Ee.afterFillStroke,this.useStyle=!0,this.order=0}drawShape(n,e,t,i,r,o,s,l,a,d,u,h){const{width:c=a.width,height:g=a.height,stroke:f=a.stroke,strokeArrayColor:p=a.strokeArrayColor,strokeArrayWidth:m=a.strokeArrayWidth,lineWidth:b=a.lineWidth,strokeColor:C=a.stroke,cornerRadius:_=a.cornerRadius}=n.attribute;f&&(Array.isArray(m)||b!==0)&&(Array.isArray(f)||Array.isArray(p)||Array.isArray(m))&&(n.name!=="border-rect"&&n.name!=="table-border-rect"&&(typeof b=="number"&&1&b||Array.isArray(m)&&m.some(v=>1&v))&&(t=Math.floor(t)+.5,i=Math.floor(i)+.5),_===0||ee(_)&&_.every(v=>v===0)?my(n,e,t,i,a,f,m||b,p||C,Math.ceil(c+0),Math.ceil(g+0)):(e.beginPath(),ni(e,t,i,c,g,_,new Array(4).fill(0).map((v,x)=>(S,R,B,A)=>{Cy(x,S,R,B,A,n,e,t,i,a,f,m||b,p||C,Math.ceil(c+0),Math.ceil(g+0))})),e.stroke()))}};Rs=by([se()],Rs);function Cy(n,e,t,i,r,o,s,l,a,d,u,h,c,g,f){var p,m,b,C;const _=o,w=d,y=py(h),v=!Array.isArray(h),x=!Array.isArray(u),S=Array.isArray(c)||y.isSplitDraw;s.setStrokeStyle(o,o.attribute,l,a,d);const{lineDash:R=w.lineDash}=_.attribute;let B=!1;R.length&&R.some(T=>Array.isArray(T))&&(B=!0),s.moveTo(l,a);const A=(x||u[0])&&(v||h[0]),M=(x||u[1])&&(v||h[1]),H=(x||u[2])&&(v||h[2]),E=(x||u[3])&&(v||h[3]);A&&n===0?(v?y.width:h[0],v?y.width:h[0],s.moveTo(e,t),s.lineTo(i,r),(S||B)&&(c&&c[0]?s.strokeStyle=c[0]:c&&!c[0]&&(s.strokeStyle="transparent"),v||(s.lineWidth=h[0]),s.lineDashOffset=s.currentMatrix.e/s.currentMatrix.a,B&&s.setLineDash((p=R[0])!==null&&p!==void 0?p:[]),s.stroke(),s.beginPath())):n===0&&s.moveTo(l+g,a),M&&n===1?(v?y.width:h[1],v?y.width:h[1],s.moveTo(e,t),s.lineTo(i,r),(S||B)&&(c&&c[1]?s.strokeStyle=c[1]:c&&!c[1]&&(s.strokeStyle="transparent"),v||(s.lineWidth=h[1]),s.lineDashOffset=s.currentMatrix.f/s.currentMatrix.d,B&&s.setLineDash((m=R[1])!==null&&m!==void 0?m:[]),s.stroke(),s.beginPath(),s.moveTo(l+g,a+f))):n===1&&s.moveTo(l+g,a+f),H&&n===2?(v?y.width:h[2],v?y.width:h[2],s.moveTo(e,t),s.lineTo(i,r),(S||B)&&(c&&c[2]?s.strokeStyle=c[2]:c&&!c[2]&&(s.strokeStyle="transparent"),v||(s.lineWidth=h[2]),s.lineDashOffset=s.currentMatrix.e/s.currentMatrix.a,B&&s.setLineDash((b=R[2])!==null&&b!==void 0?b:[]),s.stroke(),s.beginPath(),s.moveTo(l,a+f))):n===2&&s.moveTo(l,a+f),E&&n===3?(v?y.width:h[3],v?y.width:h[3],s.moveTo(e,t),s.lineTo(i,r),(S||B)&&(c&&c[3]?s.strokeStyle=c[3]:c&&!c[3]&&(s.strokeStyle="transparent"),v||(s.lineWidth=h[3]),s.lineDashOffset=s.currentMatrix.f/s.currentMatrix.d,B&&s.setLineDash((C=R[3])!==null&&C!==void 0?C:[]),s.stroke(),s.beginPath(),s.moveTo(l,a))):n===3&&s.moveTo(l,a),S||B||(!v&&y.width&&(s.lineWidth=y.width),s.stroke()),s.lineDashOffset=0,s.setLineDash([]),s.closePath()}var Yk=function(n,e,t,i){var r,o=arguments.length,s=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,e,t,i);else for(var l=n.length-1;l>=0;l--)(r=n[l])&&(s=(o<3?r(s):o>3?r(e,t,s):r(e,t))||s);return o>3&&s&&Object.defineProperty(e,t,s),s};let ts,Td=class{constructor(){this.order=1,this.interceptors=[new Xk]}afterDrawItem(n,e,t,i,r){for(let o=0;o<this.interceptors.length;o++)if(this.interceptors[o].afterDrawItem&&this.interceptors[o].afterDrawItem(n,e,t,i,r))return!0;return!1}beforeDrawItem(n,e,t,i,r){if((!n.in3dMode||t.in3dInterceptor)&&!n.shadowRoot&&!(n.baseGraphic||n.attribute.globalZIndex||n.interactiveGraphic))return!1;for(let o=0;o<this.interceptors.length;o++)if(this.interceptors[o].beforeDrawItem&&this.interceptors[o].beforeDrawItem(n,e,t,i,r))return!0;return!1}};Td=Yk([se()],Td);class Xk{constructor(){this.order=1}afterDrawItem(e,t,i,r,o){return e.type==="image"&&this.drawItem(e,t,i,r,o),!1}drawItem(e,t,i,r,o){const{image:s,gif:l}=e.attribute;if(l&&e.playing||!s||!e.resources)return!1;const a=e.resources.get(s);if(!a||a.state!=="loading")return!1;if(!ts){const p=Vn(),m=p.loading_pic.svg,b=p.loading_pic.width,C=p.loading_pic.height;ts=au({width:b,height:C,image:m})}const{image:d}=ts.attribute;if(!s||!ts.resources)return!1;const u=ts.resources.get(d);if(u.state!=="success")return!1;const{context:h}=i;h.highPerformanceSave(),e.parent&&h.setTransformFromMatrix(e.parent.globalTransMatrix,!0),e.glyphHost&&e.glyphHost.parent&&h.setTransformFromMatrix(e.glyphHost.parent.globalTransMatrix,!0);const c=e.AABBBounds,{width:g,height:f}=xu(u.data.width,u.data.height,c.width(),c.height());return h.drawImage(u.data,c.x1+(c.width()-g)/2,c.y1+(c.height()-f)/2,g,f),h.highPerformanceRestore(),!0}}var qk=function(n,e,t,i){var r,o=arguments.length,s=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,e,t,i);else for(var l=n.length-1;l>=0;l--)(r=n[l])&&(s=(o<3?r(s):o>3?r(e,t,s):r(e,t))||s);return o>3&&s&&Object.defineProperty(e,t,s),s};let Pd=class{constructor(){this.time=Ee.afterFillStroke,this.useStyle=!0,this.order=0}drawShape(n,e,t,i,r,o,s,l,a,d,u,h,c){var g,f;const{text:p,underline:m=a.underline,lineThrough:b=a.lineThrough,direction:C=a.direction,whiteSpace:_=a.whiteSpace,fontSize:w=a.fontSize,verticalMode:y=a.verticalMode,ellipsis:v=a.ellipsis,textAlign:x=a.textAlign,textBaseline:S=a.textBaseline,x:R=a.x,y:B=a.y}=n.attribute;let A=!1;if(Array.isArray(n)){const T=(g=n.cache)===null||g===void 0?void 0:g.layoutData;v&&T&&T.lines.every(P=>P.str==="")&&(A=!0)}else{const{cache:T}=n;v&&T&&T.clipedText===""&&T.clipedWidth===0&&(A=!0)}if(!A)return;const M=je(v)?v:"...",H=(f=nl(n.attribute.lineHeight,w))!==null&&f!==void 0?f:w;let E=0;H!==w&&(S==="top"?E=(H-w)/2:S==="middle"||S==="bottom"&&(E=-(H-w)/2)),o&&(h?h(e,n.attribute,a):l&&(e.setStrokeStyle(n,n.attribute,R-t,B-i,a),e.strokeText(M,R,B+E))),r&&(u?u(e,n.attribute,a):s&&(e.setCommonStyle(n,n.attribute,R-t,B-i,a),e.fillText(M,R,B+E),this.drawUnderLine(m,b,n,R,B+E,0,a,e,M)))}drawUnderLine(n,e,t,i,r,o,s,l,a){if(e+n<=0)return;const{textAlign:d=s.textAlign,textBaseline:u=s.textBaseline,fontSize:h=s.fontSize,fontFamily:c=s.fontFamily,fontWeight:g=s.fontWeight,fontStyle:f=s.fontStyle,fill:p=s.fill,opacity:m=s.opacity,underlineOffset:b=s.underlineOffset,underlineDash:C=s.underlineDash,fillOpacity:_=s.fillOpacity}=t.attribute;if(!n&&!e)return;const w=dy.measureTextWidth(a,{fontSize:h,fontFamily:c,fontWeight:g,fontStyle:f}),y=So(d,w),v=Es(u,h,h),x={lineWidth:0,stroke:p,opacity:m,strokeOpacity:_};if(n){x.lineWidth=n,l.setStrokeStyle(t,x,i,r,s),l.setLineDash(C),l.beginPath();const S=r+v+h+b;l.moveTo(i+y,S,o),l.lineTo(i+y+w,S,o),l.stroke()}if(e){x.lineWidth=e,l.setStrokeStyle(t,x,i,r,s),l.beginPath();const S=r+v+h/2;l.moveTo(i+y,S,o),l.lineTo(i+y+w,S,o),l.stroke()}}};Pd=qk([se()],Pd);const Zk=new we((n,e,t,i)=>{t(xo)?i(xo).to(xs).inSingletonScope():(n(xs).toSelf().inSingletonScope(),n(vr).toService(xs)),t(Ro)?i(Ro).to(Rs).inSingletonScope():(n(Rs).toSelf().inSingletonScope(),n(vr).toService(Rs)),n(Ss).toSelf().inSingletonScope(),n(Nk).to(Ss),n($t).to(Ss),n(md).toSelf().inSingletonScope(),n(yr).toService(md),n(bd).toSelf().inSingletonScope(),n(yr).toService(bd),n(Cd).toSelf().inSingletonScope(),n(yr).toService(Cd),n(_d).toSelf().inSingletonScope(),n(yr).toService(_d),n(Ad).toSelf().inSingletonScope(),n(En).toService(Ad),n(Bd).toSelf().inSingletonScope(),n(En).toService(Bd),n(yd).toSelf().inSingletonScope(),n(En).toService(yd),n(wd).toSelf().inSingletonScope(),n(En).toService(wd),n(vd).toSelf().inSingletonScope(),n(En).toService(vd),n(Sd).toSelf().inSingletonScope(),n(En).toService(Sd),n(xd).toSelf().inSingletonScope(),n(En).toService(xd),n(Rd).toSelf().inSingletonScope(),n(En).toService(Rd),n(Md).toSelf().inSingletonScope(),n(En).toService(Md),n(Td).toSelf().inSingletonScope(),n(Fs).toService(Td),n(Pd).toSelf().inSingletonScope(),n(ma).toService(Pd)});function Bn(n,e,t,i){var r,o,s,l,a,d,u,h;n.internalProps.columnWidthConfig&&n._parseColumnWidthConfig(n.internalProps.columnWidthConfig),n.isPivotTable()&&n.internalProps.columnWidthConfigForRowHeader&&n._parseColumnWidthConfigForRowHeader(n.internalProps.columnWidthConfigForRowHeader),e=e??0,t=t??n.colCount-1,e===0&&t===n.colCount-1&&n._clearColRangeWidthsMap();const c=n.internalProps.layoutMap;n.isPivotTable()&&(c.enableUseGetBodyCache(),c.enableUseHeaderPathCache());const g=[],f=[];if(i)for(let p=0;p<n.colCount;p++)g[p]=n.getColWidth(p);for(let p=e;p<=t;p++){let m;if(n.internalProps.transpose||((o=(r=n.internalProps.layoutMap.columnObjects)===null||r===void 0?void 0:r[p])===null||o===void 0?void 0:o.columnWidthComputeMode)!=="only-header"&&n.columnWidthComputeMode!=="only-header"||!("showHeader"in n.internalProps.layoutMap))m=n.internalProps.transpose||((l=(s=n.internalProps.layoutMap.columnObjects)===null||s===void 0?void 0:s[p])===null||l===void 0?void 0:l.columnWidthComputeMode)!=="only-body"&&n.columnWidthComputeMode!=="only-body"?Co(p,0,n.rowCount-1,n):Co(p,n.internalProps.layoutMap.getBodyRange().start.row,n.internalProps.layoutMap.getBodyRange().end.row,n);else{const b=n.internalProps.layoutMap.showHeader;n.internalProps.layoutMap.showHeader=!0,m=Co(p,0,n.internalProps.layoutMap.headerLevelCount-1,n),n.internalProps.layoutMap.showHeader=b}n._setColContentWidth(p,m),n.getColWidth(p)!==m&&n._clearColRangeWidthsMap(p),i?f[p]=Math.round(n._adjustColWidth(p,m)):n._setColWidth(p,n._adjustColWidth(p,m),!1,!0)}if(n.widthMode==="adaptive"){n._clearColRangeWidthsMap();const p=n.tableNoFrameWidth;let m=0,b=0,C=n.colCount;if(n.widthAdaptiveMode==="only-body"){for(let _=0;_<n.colCount;_++){const w=i&&(a=f[_])!==null&&a!==void 0?a:n.getColWidth(_);(_<n.rowHeaderLevelCount||n.isPivotChart()&&_>=n.colCount-n.rightFrozenColCount)&&(m+=w)}b=n.rowHeaderLevelCount,C=n.isPivotChart()?n.colCount-n.rightFrozenColCount:n.colCount}Hd(p-m,b,C,i,f,n)}else if(n.autoFillWidth){n._clearColRangeWidthsMap();const p=n.tableNoFrameWidth;let m=0,b=0;for(let C=0;C<n.colCount;C++){const _=i&&(d=f[C])!==null&&d!==void 0?d:n.getColWidth(C);(C<n.rowHeaderLevelCount+n.leftRowSeriesNumberCount||n.isPivotChart()&&C>=n.colCount-n.rightFrozenColCount)&&(m+=_),b+=_}b<p&&b>m&&Hd(p-m,n.rowHeaderLevelCount+n.leftRowSeriesNumberCount,n.isPivotChart()?n.colCount-n.rightFrozenColCount:n.colCount,i,f,n)}if(i){for(let p=0;p<n.colCount;p++){const m=(h=(u=f[p])!==null&&u!==void 0?u:n.getColWidth(p))!==null&&h!==void 0?h:n.getColWidth(p);m!==g[p]&&n._setColWidth(p,m,!1,!0)}n.stateManager.checkFrozen();for(let p=0;p<n.colCount;p++){const m=n.getColWidth(p);m!==g[p]&&n.scenegraph.updateColWidth(p,m-g[p],!0,!0)}n.scenegraph.updateContainer(!0)}n.isPivotTable()&&(c.disableUseGetBodyCache(),c.disableUseHeaderPathCache())}function Co(n,e,t,i,r=!1){let o=tE(n,i);return i.internalProps.transpose&&o==="auto"&&(i.columnWidthComputeMode==="only-header"&&n>=i.rowHeaderLevelCount||i.columnWidthComputeMode==="only-body"&&n<i.rowHeaderLevelCount)&&(o=i.getDefaultColumnWidth(n)),r&&!i.internalProps.transpose?sC(o,n,e,t,r,i):typeof o=="number"?o:o!=="auto"&&typeof o=="string"?i._adjustColWidth(n,i._colWidthDefineToPxWidth(o)):sC(o,n,e,t,r,i)}function sC(n,e,t,i,r,o){var s,l,a,d,u;let h=0,c=1,g=1;if(i-t>5e3&&(g=Math.ceil((i-t)/5e3)),o.isPivotChart()&&e>=o.rowHeaderLevelCount&&e<o.colCount-o.rightFrozenColCount){if(o.internalProps.layoutMap.indicatorsAsCol)return o.defaultColWidth;{const m=o.internalProps.layoutMap.getOptimunWidthForChart(e);if(m>0)return m}}for(let m=t;m<=i;m+=c){if(o.isPivotChart()){const x=o.internalProps.layoutMap,S=x.getAxisConfigInPivotChart(e,m);if(S){const R=ue.getFunction("computeAxisComponentWidth")(S,o);if(typeof R=="number"){h=Math.max(R,h);continue}}else if(x.isLeftBottomCorner(e,m)||x.isRightTopCorner(e,m)||x.isRightBottomCorner(e,m))continue}const b=Jk(e,m,o);if(b&&(h=Math.max(b.width,h),!b.renderDefault))continue;const C=n;if(typeof C=="number"&&o.widthMode==="standard"&&!r){h=Math.max(C,h);continue}const _=o.isHeader(e,m)?(s=o._getHeaderLayoutMap(e,m))===null||s===void 0?void 0:s.headerType:o.getBodyColumnType(e,m);if(O(_)&&_!=="text"&&_!=="link"&&_!=="progressbar"&&_!=="checkbox"&&_!=="radio"&&_!=="switch"&&_!=="button"){h=Math.max(h,o.getColWidthDefinedNumber(e)||0);continue}let w=0;const y=o.internalProps.layoutMap;if(y.isHeader(e,m)){const x=y.getHeader(e,m);if(((l=x==null?void 0:x.define)===null||l===void 0?void 0:l.columnWidthComputeMode)==="only-body")continue;O(x==null?void 0:x.hierarchyLevel)&&(w=((a=x.hierarchyLevel)!==null&&a!==void 0?a:0)*(y.rowHierarchyType==="tree"&&(d=y.rowHierarchyIndent)!==null&&d!==void 0?d:0),y.rowHierarchyTextStartAlignment&&!o.internalProps.headerHelper.getHierarchyIcon(e,m)&&(w+=o.internalProps.headerHelper.getHierarchyIconWidth()))}else if(o.isListTable()){c=g;const x=o.getBodyColumnDefine(e,m);if(x!=null&&x.tree){const S=o.dataSource.getIndexKey(o.getRecordShowIndexByCell(e,m));w=Array.isArray(S)&&o.getHierarchyState(e,m)!==be.none?(S.length-1)*((u=y.hierarchyIndent)!==null&&u!==void 0?u:0):0,y.hierarchyTextStartAlignment&&!o.internalProps.bodyHelper.getHierarchyIcon(e,m)&&(w+=o.internalProps.headerHelper.getHierarchyIconWidth())}}const v=Qk(e,m,_,o);h=Math.max(v+w,h),c>1&&o.bottomFrozenRowCount>0&&m<o.rowCount-o.bottomFrozenRowCount&&m+c>=o.rowCount-o.bottomFrozenRowCount&&(m=o.rowCount-o.bottomFrozenRowCount-c,c=1,g=1)}const f=o.getMinColWidth(e),p=o.getMaxColWidth(e);return h<f?f:h>p?p:(h<=0&&(h=o.defaultColWidth),h)}function Jk(n,e,t){var i,r,o,s,l,a,d;const u=t.getCustomRender(n,e);let h=t.getCustomLayout(n,e);if(u||h){let c,g=1,f=0,p=!1,m=!1;(t.isHeader(n,e)||!((i=t.getBodyColumnDefine(n,e))===null||i===void 0)&&i.mergeCell||t.hasCustomMerge())&&(c=t.getCellRange(n,e),g=c.end.col-c.start.col+1);const b={col:(r=c==null?void 0:c.start.col)!==null&&r!==void 0?r:n,row:(o=c==null?void 0:c.start.row)!==null&&o!==void 0?o:e,dataValue:t.getCellOriginValue(n,e),value:t.getCellValue(n,e)||"",rect:eE(n,e,t),table:t,originCol:n,originRow:e};if(h==="react-custom-layout"&&(h=((s=t.reactCustomLayout)===null||s===void 0?void 0:s.getCustomLayoutFunc(n,e))||Ks),Ae(h)){const C=h(b);if(C.rootContainer){C.rootContainer=Ys(C.rootContainer),Su(C.rootContainer,0,t.getRowHeight(e));const _=C.rootContainer.attribute.width;C.rootContainer.setStage(t.scenegraph.stage),f=_>0?_:(l=C.rootContainer.AABBBounds.width())!==null&&l!==void 0?l:0,p=C.renderDefault,m=C.enableCellPadding}else f=0,p=C.renderDefault,m=C.enableCellPadding}else if(typeof u=="function"){const C=u(b);f=(a=C==null?void 0:C.expectedWidth)!==null&&a!==void 0?a:0,p=C==null?void 0:C.renderDefault}else f=(d=u==null?void 0:u.expectedWidth)!==null&&d!==void 0?d:0,p=u==null?void 0:u.renderDefault;if(f=Math.ceil(f),m){const C=t._getCellStyle(n,e),_=xe(Z("padding",C,n,e,t));f+=_[1]+_[3]}return{width:f/g,renderDefault:p}}}function Qk(n,e,t,i){var r,o,s,l;let a=0;const d=i.getCellValue(n,e),u=i._getCellStyle(n,e);let h=0,c=!1;if(i.getCellLocation(n,e)!=="body")c=!0;else{const y=i.getBodyColumnDefine(n,e);c=!!(y!=null&&y.icon)||!!(y!=null&&y.tree)||(y==null?void 0:y.dragOrder)}if(c){const y=i.getCellIcons(n,e);y==null||y.forEach(v=>{var x,S,R;v.positionType!==Ie.absoluteRight&&(h+=((x=v.width)!==null&&x!==void 0?x:0)+((S=v.marginLeft)!==null&&S!==void 0?S:0)+((R=v.marginRight)!==null&&R!==void 0?R:0))})}let g=1;if(i.isHeader(n,e)||!((r=i.getBodyColumnDefine(n,e))===null||r===void 0)&&r.mergeCell||i.hasCustomMerge()){const y=i.getCellRange(n,e);g=y.end.col-y.start.col+1}const f=xe(Z("padding",u,n,e,i)),p=f[1]+f[3],m=Z("fontSize",u,n,e,i),b=Z("fontFamily",u,n,e,i),C=Z("fontWeight",u,n,e,i);let _;if(t==="checkbox")_=ke(d)?d.text:d;else if(t==="radio")if(ee(d)){_="";const y=i.getBodyColumnDefine(n,e),v=(o=y==null?void 0:y.radioDirectionInCell)!==null&&o!==void 0?o:"vertical";v==="vertical"?d.forEach(x=>{_+=(ke(x)?x.text:x).toString()+`
`}):v==="horizontal"&&d.forEach(x=>{_+=(ke(x)?x.text:x).toString()})}else _=ke(d)?d.text:d;else if(t==="button"){const y=i.getBodyColumnDefine(n,e),v=ze(y.text,{col:n,row:e,table:i,context:null,value:d,dataValue:i.getCellOriginValue(n,e)});_=(s=v??d)!==null&&s!==void 0?s:""}else _=d;const w=Xs(_,i).text;if(w.length>=1&&(w.length!==1||w[0]!=="")?w.forEach(y=>{const v=i.measureText(y,{fontSize:m,fontFamily:b,fontWeight:C}).width;a=Math.max((v+p+4+h)/g,a)}):a=Math.max((p+4+h)/g,a),i.internalProps.limitMaxAutoWidth!==!1&&(a=Math.min(typeof i.internalProps.limitMaxAutoWidth=="number"?i.internalProps.limitMaxAutoWidth:450,a)),t==="checkbox"){const y=Z("size",u,n,e,i);if(a+=y,_){const v=Z("spaceBetweenTextAndIcon",u,n,e,i);a+=v}}else if(t==="radio"){const y=Z("size",u,n,e,i),v=Z("outerRadius",u,n,e,i),x=J(v)?2*v:y,S=Z("spaceBetweenTextAndIcon",u,n,e,i);if(ee(d)){const R=i.getBodyColumnDefine(n,e),B=Z("spaceBetweenRadio",u,n,e,i),A=(l=R==null?void 0:R.radioDirectionInCell)!==null&&l!==void 0?l:"vertical";A==="vertical"?(a+=x,a+=S):A==="horizontal"&&(a+=(x+S)*d.length,a+=B*(d.length-1))}else a+=x,_&&(a+=S)}else if(t==="switch")a=Z("boxWidth",u,n,e,i);else if(t==="button"){const y=Z("buttonPadding",u,n,e,i);a+=2*y}return a}function eE(n,e,t){return{left:0,top:0,right:t.getColWidth(n),bottom:t.getRowHeight(e),width:null,height:null}}function tE(n,e){const t=e.getColWidthDefined(n);return e.internalProps._widthResizedColMap.has(n)?e.getColWidth(n):t}function Hd(n,e,t,i,r,o,s){var l,a,d,u;let h=0;const c=[],g=[];let f=0;for(let m=e;m<t;m++){const b=i&&(l=r[m])!==null&&l!==void 0?l:o.getColWidth(m),C=o.getMaxColWidth(m),_=o.getMinColWidth(m);b!==C&&b!==_?(h+=b,c.push(m)):n-=b,!((a=o.options.customConfig)===null||a===void 0)&&a.shrinkSparklineFirst&&o.getBodyColumnType(m,0)==="sparkline"&&(g.push({col:m,width:b}),f+=b-o.defaultColWidth)}const p=n/h;if(!((d=o.options.customConfig)===null||d===void 0)&&d.shrinkSparklineFirst&&p<1&&h-n<f)for(let m=0;m<g.length;m++){const{col:b,width:C}=g[m],_=(h-n)/g.length,w=Math.floor(C-_);i?r[b]=o._adjustColWidth(b,w):s?o.scenegraph.setColWidth(b,o._adjustColWidth(b,w)):o._setColWidth(b,o._adjustColWidth(b,w),!1,!0)}else for(let m=0;m<c.length;m++){const b=c[m];let C;C=m===c.length-1?n-c.reduce((_,w,y)=>{var v;return w!==b?_+(i?(v=r[w])!==null&&v!==void 0?v:o.getColWidth(b):o.getColWidth(w)):_},0):Math.round((i&&(u=r[b])!==null&&u!==void 0?u:o.getColWidth(b))*p),i?r[b]=o._adjustColWidth(b,C):s?o.scenegraph.setColWidth(b,o._adjustColWidth(b,C)):o._setColWidth(b,o._adjustColWidth(b,C),!1,!0)}}const kd=new Pe({});kd.role="empty";function na(n,e,t,i,r,o,s,l,a){var d,u;let h,c,g,f=0;n.lastChild&&n.lastChild.row===i-1?f=n.lastChild.attribute.y+n.lastChild.attribute.height:n.colHeight&&(f=n.colHeight);for(let p=i;p<=r;p++){const m=p;let b,C,_,w,y=l.getCellLocation(e,m),v=l.getCellValue(e,m),x=t,S=l.getRowHeight(m),R=!1;if(l.internalProps.customMergeCell){const P=l.getCustomMerge(e,m);if(P){const{range:k,text:L,style:F,customLayout:z,customRender:I}=P;if(b=k,C=b.start.col!==b.end.col||b.start.row!==b.end.row,C){const N=lC(b,o,l,i>b.start.row);x=N.cellWidth,S=N.cellHeight}v=L,_=F,(z||I)&&(w=er(z,I,k.start.col,k.start.row,l.getColsWidth(k.start.col,k.end.col),l.getRowsHeight(k.start.row,k.end.row),!1,l.isAutoRowHeight(m),[0,0,0,0],b,l)),R=!0}}let B,A=e,M=m;b&&(A=b.start.col,M=b.start.row),!l.isPivotTable()&&(y==="columnHeader"||y==="cornerHeader")&&m>=l.columnHeaderLevelCount&&(y="body"),B=!l.isPivotTable()&&l.isSeriesNumberInBody(e,m)?l.getBodyColumnDefine(A,M):y!=="body"?l.getHeaderDefine(A,M):l.getBodyColumnDefine(A,M);let H=y!=="body"||(B==null?void 0:B.dragOrder)||!!(B!=null&&B.icon)||!!(B!=null&&B.tree);if(!b&&(l.internalProps.enableTreeNodeMerge||y!=="body"||B!=null&&B.mergeCell)&&(b=l.getCellRange(e,m),C=b.start.col!==b.end.col||b.start.row!==b.end.row,C)){const P=lC(b,o,l,i>b.start.row);x=P.cellWidth,S=P.cellHeight}let E=!1;if(l.internalProps.enableTreeNodeMerge&&C){const P=l.getCellRawRecord(b.start.col,b.start.row),{vtableMergeName:k,vtableMerge:L}=P??{};E=L,L&&(H=!0,l.options.groupTitleCustomLayout&&(w=er(l.options.groupTitleCustomLayout,void 0,b.start.col,b.start.row,l.getColsWidth(b.start.col,b.end.col),l.getRowsHeight(b.start.row,b.end.row),!1,l.isAutoRowHeight(m),[0,0,0,0],b,l)),l.options.groupTitleFieldFormat?v=l.options.groupTitleFieldFormat(P,e,m,l):k&&(v=k))}const T=E||R?"text":(u=l.isHeader(e,m)?(d=l._getHeaderLayoutMap(e,m).headerType)!==null&&d!==void 0?d:"text":l.getBodyColumnType(e,m))!==null&&u!==void 0?u:"text";if(Un(v)){iE(e,m,0,f,x,S,n),sy(v,l,nE.bind(null,{type:T,value:v,define:B,table:l,col:e,row:m,colWidth:t,cellWidth:x,cellHeight:S,columnGroup:n,y:f,customStyle:_,mayHaveIcon:H,cellLocation:y,range:b,customResult:w,defaultRowHeight:s})),n.updateColumnRowNumber(m);const P=l.getRowHeight(m);n.updateColumnHeight(P),f+=P}else{const P=_||l._getCellStyle(b?b.start.col:e,b?b.start.row:m),k=ir(P,l,b?b.start.col:e,b?b.start.row:m,Z).theme;k.group.cornerRadius=vu(e,m,l),k.group.width=t,k.group.height=Array.isArray(s)?s[m]:s,k._vtable.padding&&(h=k._vtable.padding),k.text.textAlign&&(c=k.text.textAlign),k.text.textBaseline&&(g=k.text.textBaseline),y==="body"||k.group.fill||(k.group.fill="#fff");const L=eg(T,v,B,l,e,m,t,x,S,n,f,h,c,g,H,k,b,w);if(n.updateColumnRowNumber(m),C){const F=l.getRowHeight(m),{width:z}=(l.getColWidth(e),L.attribute),{height:I}=L.attribute;L.contentWidth=z,L.contentHeight=I,ay(b,z,I,h,c,g,l),n.updateColumnHeight(F),f+=F}else n.updateColumnHeight(S),f+=S}}return n.setAttribute("width",t),{width:t,height:f}}function nE(n){let e,t,i;const{type:r,value:o,define:s,table:l,col:a,row:d,colWidth:u,cellWidth:h,cellHeight:c,columnGroup:g,y:f,cellLocation:p,mayHaveIcon:m,customStyle:b,range:C,customResult:_,defaultRowHeight:w}=n,y=b||l._getCellStyle(C?C.start.col:a,C?C.start.row:d),v=ir(y,l,C?C.start.col:a,C?C.start.row:d,Z).theme;v.group.cornerRadius=vu(a,d,l),v.group.width=u,v.group.height=Array.isArray(w)?w[d]:w,v._vtable.padding&&(e=v._vtable.padding),v.text.textAlign&&(t=v.text.textAlign),v.text.textBaseline&&(i=v.text.textBaseline),p==="body"||v.group.fill||(v.group.fill="#fff"),eg(r,o,s,l,a,d,u,h,c,g,f,e,t,i,m,v,C,_)}function lC(n,e,t,i){let r=0,o=0;const s=e.get(`${n.start.col},${n.start.row};${n.end.col},${n.end.row}`);if(!s||i){for(let l=n.start.col;l<=n.end.col;l++)r+=t.getColWidth(l);for(let l=n.start.row;l<=n.end.row;l++)o+=t.getRowHeight(l);e.set(`${n.start.col},${n.start.row};${n.end.col},${n.end.row}`,{cellWidth:r,cellHeight:o})}else r=s.cellWidth,o=s.cellHeight;return{cellWidth:r,cellHeight:o}}function iE(n,e,t,i,r,o,s){const l=new Pe({x:t,y:i,width:r,height:o});l.role="cell",l.col=n,l.row=e,s.addChild(l)}function _t(n,e,t,i,r,o,s,l,a,d){if(i>r||o>s)return;const{layoutMap:u,defaultHeaderRowHeight:h,defaultColWidth:c}=a.internalProps,g=a.defaultRowHeight;let f=0,p=0;for(let m=i;m<=r;m++){const b=m,C=a.getColWidth(b),_=new Pe({x:e+f,y:t,width:C,height:0,clip:!1,pickable:!1});_.role="column",_.col=m,n.addChild(_);const{width:w,height:y}=na(_,b,C,o,s,a.scenegraph.mergeMap,l==="columnHeader"&&J(h)?h:g,a);f+=w,p=Math.max(p,y)}n.setAttribute("width",f),n.setAttribute("height",p)}function rE(n,e,t,i,r,o,s,l,a){var d,u,h,c,g,f,p,m,b,C,_,w;const{table:y}=a,{leftBottomCornerGroup:v,rightTopCornerGroup:x,rightBottomCornerGroup:S}=y.scenegraph;let R,B,A,M;a.setParamsForRow(),a.setParamsForColumn(),(y.widthMode==="adaptive"||y.options.autoWrapText&&(y.heightMode==="adaptive"||y.isAutoRowHeight()))&&(A=y.colCount-1),R=Math.min(a.firstScreenColLimit-1,y.colCount-1),y.heightMode==="adaptive"&&(M=y.rowCount-1),B=Math.min(a.firstScreenRowLimit-1,y.rowCount-1),y.internalProps._widthResizedColMap.size===0&&Bn(y,0,A??R),y.internalProps._heightResizedRowMap.size===0&&An(y,0,y.options.canvasHeight==="auto"?y.rowCount-1:M??B),R<y.colCount-y.rightFrozenColCount&&Bn(y,y.colCount-y.rightFrozenColCount,y.colCount-1),B<y.rowCount-y.bottomFrozenRowCount&&An(y,y.rowCount-y.bottomFrozenRowCount,y.rowCount-1),y.scenegraph.colHeaderGroup.setAttribute("x",y.getFrozenColsWidth()),y.scenegraph.rowHeaderGroup.setAttribute("y",y.getFrozenRowsHeight()),y.scenegraph.bottomFrozenGroup.setAttribute("x",y.getFrozenColsWidth()),y.scenegraph.rightFrozenGroup.setAttribute("y",y.getFrozenRowsHeight()),y.scenegraph.bodyGroup.setAttributes({x:y.getFrozenColsWidth(),y:y.getFrozenRowsHeight()}),_t(n,s,l,0,y.frozenColCount-1,0,y.frozenRowCount-1,y.isListTable()?"columnHeader":"cornerHeader",y),R-y.rightFrozenColCount>=y.frozenColCount&&_t(e,s,l,y.frozenColCount,R-y.rightFrozenColCount,0,y.frozenRowCount-1,"columnHeader",y),y.frozenColCount>0&&(y.leftRowSeriesNumberCount>0&&_t(t,s,l,0,y.leftRowSeriesNumberCount-1,y.frozenRowCount,B-y.bottomFrozenRowCount,"rowHeader",y),y.frozenColCount>y.leftRowSeriesNumberCount&&_t(t,s,l,y.leftRowSeriesNumberCount,Math.min(y.frozenColCount-1,y.rowHeaderLevelCount+y.leftRowSeriesNumberCount-1),y.frozenRowCount,B-y.bottomFrozenRowCount,"rowHeader",y),y.frozenColCount>y.rowHeaderLevelCount+y.leftRowSeriesNumberCount&&_t(t,s,l,y.rowHeaderLevelCount+y.leftRowSeriesNumberCount,y.frozenColCount-1,y.frozenRowCount,B-y.bottomFrozenRowCount,"body",y)),y.bottomFrozenRowCount>0&&(y.frozenColCount>0&&(y.leftRowSeriesNumberCount>0&&_t(v,s,l,0,y.leftRowSeriesNumberCount-1,y.rowCount-1-y.bottomFrozenRowCount+1,y.rowCount-1,"rowHeader",y),y.rowHeaderLevelCount>0&&_t(v,s,l,y.leftRowSeriesNumberCount,y.leftRowSeriesNumberCount+y.rowHeaderLevelCount-1,y.rowCount-1-y.bottomFrozenRowCount+1,y.rowCount-1,"rowHeader",y),y.frozenColCount>y.rowHeaderLevelCount+y.leftRowSeriesNumberCount&&_t(v,s,l,y.rowHeaderLevelCount+y.leftRowSeriesNumberCount,y.frozenColCount-1,y.rowCount-1-y.bottomFrozenRowCount+1,y.rowCount-1,"body",y)),R-y.rightFrozenColCount>=y.frozenColCount&&_t(r,s,l,y.frozenColCount,R-y.rightFrozenColCount,y.rowCount-1-y.bottomFrozenRowCount+1,y.rowCount-1,y.isPivotChart()?"rowHeader":"body",y)),y.rightFrozenColCount>0&&(_t(x,s,l,y.colCount-1-y.rightFrozenColCount+1,y.colCount-1,0,y.frozenRowCount-1,"columnHeader",y),_t(i,s,l,y.colCount-1-y.rightFrozenColCount+1,y.colCount-1,y.frozenRowCount,B-y.bottomFrozenRowCount,y.isPivotChart()?"rowHeader":"body",y)),y.bottomFrozenRowCount>0&&y.rightFrozenColCount>0&&_t(S,s,l,y.colCount-1-y.rightFrozenColCount+1,y.colCount-1,y.rowCount-1-y.bottomFrozenRowCount+1,y.rowCount-1,"body",y),R-y.rightFrozenColCount>=y.frozenColCount&&_t(o,s,l,y.frozenColCount,R-y.rightFrozenColCount,y.frozenRowCount,B-y.bottomFrozenRowCount,"body",y),o.firstChild||e.firstChild||n.firstChild||t.firstChild?(a.currentRow=(c=(u=(d=o.firstChild)===null||d===void 0?void 0:d.rowNumber)!==null&&u!==void 0?u:(h=t.firstChild)===null||h===void 0?void 0:h.rowNumber)!==null&&c!==void 0?c:a.totalRow,a.rowEnd=a.currentRow,a.rowUpdatePos=a.rowEnd+1,a.referenceRow=a.rowStart+Math.floor((a.rowEnd-a.rowStart)/2),a.currentCol=(w=(C=(m=(f=(g=o.lastChild)===null||g===void 0?void 0:g.col)!==null&&f!==void 0?f:(p=e.lastChild)===null||p===void 0?void 0:p.col)!==null&&m!==void 0?m:(b=t.lastChild)===null||b===void 0?void 0:b.col)!==null&&C!==void 0?C:(_=n.lastChild)===null||_===void 0?void 0:_.col)!==null&&w!==void 0?w:a.totalCol,a.colEnd=a.currentCol,a.colUpdatePos=a.colEnd+1,a.referenceCol=a.colStart+Math.floor((a.colEnd-a.colStart)/2),a.progress()):(a.currentRow=a.totalRow,a.rowEnd=a.currentRow,a.rowUpdatePos=a.rowEnd+1,a.referenceRow=a.rowStart+Math.floor((a.rowEnd-a.rowStart)/2),a.currentCol=a.totalCol,a.colEnd=a.currentCol,a.colUpdatePos=a.colEnd+1,a.referenceCol=a.colStart+Math.floor((a.colEnd-a.colStart)/2))}function aC(n){let e=n.firstChild;for(;e&&e.type!=="group";)e=e._next;return e}function Zs(n){let e=n.lastChild;for(;e&&e.type!=="group";)e=e._prev;return e}function oE(n){let e=n._prev;for(;e&&e.type!=="group";)e=e._prev;return e}function sE(n){let e=n._next;for(;e&&e.type!=="group";)e=e._next;return e}function sf(n,e,t,i="left"){for(let l=n;l<=e;l++){const a=t.scenegraph.getColGroup(l);a&&th(a,t,i);const d=t.scenegraph.getColGroup(l,!0);d&&th(d,t,i);const u=t.scenegraph.getColGroupInBottom(l);u&&th(u,t,i)}const r=Math.min(t.scenegraph.proxy.colLimit,t.scenegraph.proxy.bodyRightCol-t.scenegraph.proxy.bodyLeftCol+1),o=t.getColsWidth(t.frozenColCount,t.frozenColCount+r),s=t.getColsWidth(t.frozenColCount,t.colCount-1);t.scenegraph.proxy.xLimitLeft=o/2,t.scenegraph.proxy.xLimitRight=s-o/2}function th(n,e,t="left"){if(t==="left"){let i;const r=oE(n);i=r?r.attribute.x+e.getColWidth(n._prev.col):e.getColsWidth(e.frozenColCount,n.col-1),n.setAttribute("x",i)}else{let i;const r=sE(n);i=r?r.attribute.x-e.getColWidth(n.col):e.getColsWidth(e.frozenColCount,n.col-1),n.setAttribute("x",i)}}var _y=function(n,e,t,i){return new(t||(t=Promise))(function(r,o){function s(d){try{a(i.next(d))}catch(u){o(u)}}function l(d){try{a(i.throw(d))}catch(u){o(u)}}function a(d){var u;d.done?r(d.value):(u=d.value,u instanceof t?u:new t(function(h){h(u)})).then(s,l)}a((i=i.apply(n,e||[])).next())})};function lE(n,e,t,i){return _y(this,void 0,void 0,function*(){if(!e)return;const r=e.col,o=e.left;let s;if(s=t?i.bodyRightCol-i.colEnd:i.screenLeftCol-i.referenceCol,aE(s,r,o,n,i),t){const l=i.table.scenegraph.getColGroup(i.colEnd);if(l){const a=l.attribute.x+l.attribute.width-(i.table.tableNoFrameWidth-i.table.getFrozenColsWidth()-i.table.getRightFrozenColsWidth())-n;i.deltaX=-a,i.table.scenegraph.setBodyAndColHeaderX(-n+i.deltaX)}}i.table.scenegraph.updateNextFrame()})}function aE(n,e,t,i,r){n>0?(dC(n,"left",r.screenLeftCol,t,i,r),r.updateDeltaX(i,t,e),r.table.scenegraph.setBodyAndColHeaderX(-i+r.deltaX)):n<0?(dC(-n,"right",r.screenLeftCol,t,i,r),r.updateDeltaX(i,t,e),r.table.scenegraph.setBodyAndColHeaderX(-i+r.deltaX)):(r.updateDeltaX(i,t,e),r.table.scenegraph.setBodyAndColHeaderX(-i+r.deltaX))}function dC(n,e,t,i,r,o){return _y(this,void 0,void 0,function*(){if(e==="left"&&o.colEnd+n>o.bodyRightCol?n=o.bodyRightCol-o.colEnd:e==="right"&&o.colStart-n<o.bodyLeftCol&&(n=o.colStart-o.bodyLeftCol),n!==0)if(n<0&&(e=e==="left"?"right":"left",n=-n),n<o.colEnd-o.colStart){const s=e==="left"?o.colStart:o.colEnd-n+1,l=e==="left"?o.colStart+n-1:o.colEnd,a=e==="left"?o.colEnd+1:o.colStart-n,d=e==="left"?o.colEnd+n:o.colStart-1;Bn(o.table,a,d),uE(s,l,e,o);const u=a,h=d;o.colStart=e==="left"?o.colStart+n:o.colStart-n,o.colEnd=e==="left"?o.colEnd+n:o.colEnd-n,Js(u,h,o),sf(u,h,o.table,e);const c=o.table.scenegraph.getColGroup(t)||o.table.scenegraph.getColGroup(t,!0),g=i-(c.attribute.x+o.table.getFrozenColsWidth()+o.table.scenegraph.proxy.deltaX);o.table.scenegraph.proxy.deltaX+=g,o.currentCol=e==="left"?o.currentCol+n:o.currentCol-n,o.totalCol=Math.max(0,Math.min(o.table.colCount-1,e==="left"?o.totalCol+n:o.totalCol-n)),o.referenceCol=o.colStart+Math.floor((o.colEnd-o.colStart)/2),o.colUpdatePos=a,o.colUpdateDirection=e,o.table.scenegraph.updateNextFrame()}else{const s=e==="left"?o.colStart+n:o.colStart-n,l=e==="left"?o.colEnd+n:o.colEnd-n;Bn(o.table,s,l),hE(o.table.getColsWidth(o.bodyLeftCol,s-1),n,e,o);const a=s,d=l;o.colStart=s,o.colEnd=l,Js(a,d,o),sf(a,d,o.table,l>o.bodyRightCol-(o.colEnd-o.colStart+1)?"right":"left"),o.currentCol=e==="left"?o.currentCol+n:o.currentCol-n,o.totalCol=Math.max(0,Math.min(o.table.colCount-1,e==="left"?o.totalCol+n:o.totalCol-n)),o.referenceCol=o.colStart+Math.floor((o.colEnd-o.colStart)/2),o.colUpdatePos=o.colStart,o.colUpdateDirection=l>o.bodyRightCol-(o.colEnd-o.colStart+1)?"right":"left",o.table.scenegraph.updateNextFrame()}})}function As(n,e,t){n.col=e,n.forEachChildren(i=>{i.col=e,i.needUpdate=!0}),n.setAttribute("x",t),n.needUpdate=!0}function Ul(n,e){if(!n)return;let t=n.firstChild;for(;t;)t=e.updateCellGroupContent(t)._next;n.needUpdate=!1,n.setAttribute("width",e.table.getColWidth(n.col))}function dE(n,e){if(!n)return;const t=e.screenTopRow,i=Math.max(e.bodyTopRow,t-1*e.screenRowCount),r=Math.min(e.bodyBottomRow,t+2*e.screenRowCount,e.table.rowCount-1);for(let o=i;o<=r;o++){const s=e.highPerformanceGetCell(n.col,o,!0);e.updateCellGroupContent(s)}e.rowUpdatePos=e.rowStart,n.needUpdate=!1,n.setAttribute("width",e.table.getColWidth(n.col))}function uE(n,e,t,i){for(let r=n;r<=e;r++)i.table.scenegraph.bodyGroup.childrenCount>0&&i.table.scenegraph.bodyGroup.firstChild.type==="group"&&nh(i.table.scenegraph.bodyGroup,t,i),i.table.scenegraph.colHeaderGroup.childrenCount>0&&i.table.scenegraph.colHeaderGroup.firstChild.type==="group"&&nh(i.table.scenegraph.colHeaderGroup,t,i),i.table.scenegraph.bottomFrozenGroup.childrenCount>0&&i.table.scenegraph.bottomFrozenGroup.firstChild.type==="group"&&nh(i.table.scenegraph.bottomFrozenGroup,t,i)}function nh(n,e,t){if(e==="left"){const i=aC(n),r=Zs(n);As(i,r.col+1,r.attribute.x+t.table.getColWidth(r.col)),n.appendChild(i),n.border&&n.appendChild(n.border)}else{const i=Zs(n),r=aC(n);As(i,r.col-1,r.attribute.x-t.table.getColWidth(r.col-1)),n.insertBefore(i,n.firstChild)}}function Js(n,e,t){for(let i=n;i<=e;i++){const r=t.table.scenegraph.getColGroup(i,!0);r&&Ul(r,t);const o=t.table.scenegraph.getColGroupInBottom(i);o&&Ul(o,t);const s=t.table.scenegraph.getColGroupInRightTopCorner(i);s&&Ul(s,t);const l=t.table.scenegraph.getColGroupInRightBottomCorner(i);l&&Ul(l,t);const a=t.table.scenegraph.getColGroup(i);a&&dE(a,t)}ih(t.table.scenegraph.colHeaderGroup),ih(t.table.scenegraph.bottomFrozenGroup),ih(t.table.scenegraph.bodyGroup),t.progress()}function hE(n,e,t,i){i.table.scenegraph.colHeaderGroup.forEachChildren((r,o)=>{r.type==="group"&&As(r,t==="left"?r.col+e:r.col-e,o===0?n:r._prev.attribute.x+i.table.getColWidth(r._prev.col))}),i.table.scenegraph.bottomFrozenGroup.forEachChildren((r,o)=>{r.type==="group"&&As(r,t==="left"?r.col+e:r.col-e,o===0?n:r._prev.attribute.x+i.table.getColWidth(r._prev.col))}),i.table.scenegraph.bodyGroup.forEachChildren((r,o)=>{r.type==="group"&&As(r,t==="left"?r.col+e:r.col-e,o===0?n:r._prev.attribute.x+i.table.getColWidth(r._prev.col))})}function ih(n){var e,t;const i=Zs(n);if(i&&(n.setAttribute("width",i.attribute.x+i.attribute.width),n.border)){const r=n.border;r.setAttribute("width",i.attribute.x+i.attribute.width-((e=r.attribute.borderLeft)!==null&&e!==void 0?e:0)/2-((t=r.attribute.borderRight)!==null&&t!==void 0?t:0)/2)}}function an(n,e,t,i,r,o="up",s){var l,a;if(o==="up")for(let c=n;c<=e;c++)for(let g=t;g<=i;g++){const f=r.scenegraph.highPerformanceGetCell(c,g,!0);if(f.role!=="cell"||!f.row)continue;let p;if(f._prev)p=((l=f._prev)===null||l===void 0?void 0:l.attribute.y)+r.getRowHeight(f._prev.row);else if(s){const m=i===r.rowCount-r.bottomFrozenRowCount-1?i:i+1;if(p=r.scenegraph.highPerformanceGetCell(c,m,!0).attribute.y,O(p))for(let b=g;b<m;b++)p-=r.getRowHeight(b)}else p=uC(f.row,r);O(p)&&f.setAttribute("y",p)}else for(let c=n;c<=e;c++)for(let g=i;g>=t;g--){const f=r.scenegraph.highPerformanceGetCell(c,g,!0);if(f.role!=="cell"||!f.row)continue;let p;if(f._next)p=((a=f._next)===null||a===void 0?void 0:a.attribute.y)-r.getRowHeight(f.row);else if(s){const m=t<=r.frozenRowCount?r.frozenRowCount:t-1;t<=r.frozenRowCount?p=0:p=r.scenegraph.highPerformanceGetCell(c,m,!0).attribute.y;for(let b=m;b<g;b++)p+=r.getRowHeight(b)}else p=uC(f.row,r);O(p)&&f.setAttribute("y",p)}const d=Math.min(r.scenegraph.proxy.rowLimit,r.scenegraph.proxy.bodyBottomRow-r.scenegraph.proxy.bodyTopRow+1),u=r.getRowsHeight(r.frozenRowCount,r.frozenRowCount+d),h=r.getRowsHeight(r.frozenRowCount,r.rowCount-1);r.scenegraph.proxy.yLimitTop=u/2,r.scenegraph.proxy.yLimitBottom=h-u/2}function uC(n,e){let t;return t=n<e.frozenRowCount?e.getRowsHeight(0,n-1):n>=e.rowCount-e.bottomFrozenRowCount?e.getRowsHeight(e.rowCount-e.bottomFrozenRowCount,n-1):e.getRowsHeight(e.frozenRowCount,n-1),t}var wy=function(n,e,t,i){return new(t||(t=Promise))(function(r,o){function s(d){try{a(i.next(d))}catch(u){o(u)}}function l(d){try{a(i.throw(d))}catch(u){o(u)}}function a(d){var u;d.done?r(d.value):(u=d.value,u instanceof t?u:new t(function(h){h(u)})).then(s,l)}a((i=i.apply(n,e||[])).next())})};function cE(n,e,t,i){return wy(this,void 0,void 0,function*(){if(!e)return;const r=e.row,o=e.top;let s;if(s=t?i.bodyBottomRow-i.rowEnd:r-i.referenceRow,fE(s,r,o,n,i),t){const l=i.table.scenegraph.highPerformanceGetCell(i.colStart,i.rowEnd,!0);if(l.role==="cell"){const a=l.attribute.y+l.attribute.height-(i.table.tableNoFrameHeight-i.table.getFrozenRowsHeight()-i.table.getBottomFrozenRowsHeight())-n;i.deltaY=-a,i.updateBody(n-i.deltaY)}}})}function fE(n,e,t,i,r){n>0?(hC(n,"up",e,t,i,r),r.updateDeltaY(i,t,e),r.updateBody(i-r.deltaY)):n<0?(hC(-n,"down",e,t,i,r),r.updateDeltaY(i,t,e),r.updateBody(i-r.deltaY)):(r.updateDeltaY(i,t,e),r.updateBody(i-r.deltaY))}function hC(n,e,t,i,r,o){return wy(this,void 0,void 0,function*(){if(e==="up"&&o.rowEnd+n>o.bodyBottomRow?n=o.bodyBottomRow-o.rowEnd:e==="down"&&o.rowStart-n<o.bodyTopRow&&(n=o.rowStart-o.bodyTopRow),n!==0)if(n<0&&(e=e==="up"?"down":"up",n=-n),n<o.rowEnd-o.rowStart){const s=e==="up"?o.rowStart:o.rowEnd-n+1,l=e==="up"?o.rowStart+n-1:o.rowEnd,a=e==="up"?o.rowEnd+1:o.rowStart-n,d=e==="up"?o.rowEnd+n:o.rowStart-1;let u,h;o.table.isAutoRowHeight()?(u=a,h=d):(u=Math.max(o.bodyTopRow,t-1*o.screenRowCount),h=Math.min(o.bodyBottomRow,t+2*o.screenRowCount,o.table.rowCount-1)),An(o.table,u,h,!1),gE(s,l,e,o),o.rowStart=e==="up"?o.rowStart+n:o.rowStart-n,o.rowEnd=e==="up"?o.rowEnd+n:o.rowEnd-n;const c=Qs(u,h,o,!0);o.table.isAutoRowHeight()&&(an(o.bodyLeftCol,o.bodyRightCol,u,h,o.table,d>o.bodyBottomRow-(o.rowEnd-o.rowStart+1)?"down":"up",!0),an(0,o.table.frozenColCount-1,u,h,o.table,d>o.bodyBottomRow-(o.rowEnd-o.rowStart+1)?"down":"up",!0),an(o.table.colCount-o.table.rightFrozenColCount,o.table.colCount-1,u,h,o.table,d>o.bodyBottomRow-(o.rowEnd-o.rowStart+1)?"down":"up",!0)),o.currentRow=e==="up"?o.currentRow+n:o.currentRow-n,o.totalRow=Math.max(0,Math.min(o.bodyBottomRow,e==="up"?o.totalRow+n:o.totalRow-n,o.table.rowCount-1)),o.referenceRow=o.rowStart+Math.floor((o.rowEnd-o.rowStart)/2),o.table.isAutoRowHeight()&&c?o.rowUpdatePos=Math.min(o.rowUpdatePos,o.rowEnd+1):o.rowUpdatePos=Math.min(o.rowUpdatePos,a),o.rowUpdateDirection=e,o.table.scenegraph.updateNextFrame(),yield o.progress()}else{const s=e==="up"?o.rowStart+n:o.rowStart-n,l=Math.min(o.table.rowCount-1,e==="up"?o.rowEnd+n:o.rowEnd-n),a=o.table.getRowsHeight(o.bodyTopRow,s-1);let d,u;o.table.isAutoRowHeight()?(d=s,u=l):(d=Math.max(o.bodyTopRow,t-1*o.screenRowCount),u=Math.min(o.bodyBottomRow,t+2*o.screenRowCount,o.table.rowCount-1)),An(o.table,d,u,!1),pE(a,n,e,o),o.rowStart=s,o.rowEnd=l;const h=Qs(d,u,o,!0);o.table.isAutoRowHeight()&&(an(o.bodyLeftCol,o.bodyRightCol,d,u,o.table,l>o.bodyBottomRow-(o.rowEnd-o.rowStart+1)?"down":"up"),an(0,o.table.frozenColCount-1,d,u,o.table,l>o.bodyBottomRow-(o.rowEnd-o.rowStart+1)?"down":"up"),an(o.table.colCount-o.table.rightFrozenColCount,o.table.colCount-1,d,u,o.table,l>o.bodyBottomRow-(o.rowEnd-o.rowStart+1)?"down":"up")),o.currentRow=e==="up"?o.currentRow+n:o.currentRow-n,o.totalRow=Math.max(0,Math.min(o.bodyBottomRow,e==="up"?o.totalRow+n:o.totalRow-n,o.table.rowCount-1)),o.referenceRow=o.rowStart+Math.floor((o.rowEnd-o.rowStart)/2),o.table.isAutoRowHeight()&&h?o.rowUpdatePos=o.rowEnd+1:o.rowUpdatePos=o.rowStart,o.rowUpdateDirection=l>o.bodyBottomRow-(o.rowEnd-o.rowStart+1)?"down":"up",o.table.scenegraph.updateNextFrame(),yield o.progress()}})}function gE(n,e,t,i){for(let r=0;r<i.table.frozenColCount;r++){const o=i.table.scenegraph.getColGroup(r);if(o)for(let s=n;s<=e;s++)rh(o,t,i)}for(let r=i.table.colCount-i.table.rightFrozenColCount;r<i.table.colCount;r++){const o=i.table.scenegraph.getColGroup(r);if(o)for(let s=n;s<=e;s++)rh(o,t,i)}for(let r=i.bodyLeftCol;r<=i.bodyRightCol;r++){const o=i.table.scenegraph.getColGroup(r);if(o)for(let s=n;s<=e;s++)rh(o,t,i)}}function rh(n,e,t){if(n.childrenCount>=1)if(e==="up"){const i=n.firstChild;t.updateCellGroupPosition(i,n.lastChild.row+1,n.lastChild.attribute.y+t.table.getRowHeight(n.lastChild.row)),n.appendChild(i)}else{const i=n.lastChild;t.updateCellGroupPosition(i,n.firstChild.row-1,n.firstChild.attribute.y-t.table.getRowHeight(i.row)),n.insertBefore(i,n.firstChild)}}function pE(n,e,t,i){for(let r=0;r<i.table.frozenColCount;r++){const o=i.table.scenegraph.getColGroup(r);o==null||o.forEachChildren((s,l)=>{i.updateCellGroupPosition(s,t==="up"?s.row+e:s.row-e,l===0?n:s._prev.attribute.y+i.table.getRowHeight(s._prev.row))})}for(let r=i.table.colCount-i.table.rightFrozenColCount;r<i.table.colCount;r++){const o=i.table.scenegraph.getColGroup(r);o==null||o.forEachChildren((s,l)=>{i.updateCellGroupPosition(s,t==="up"?s.row+e:s.row-e,l===0?n:s._prev.attribute.y+i.table.getRowHeight(s._prev.row))})}for(let r=i.bodyLeftCol;r<=i.bodyRightCol;r++){const o=i.table.scenegraph.getColGroup(r);o==null||o.forEachChildren((s,l)=>{i.updateCellGroupPosition(s,t==="up"?s.row+e:s.row-e,l===0?n:s._prev.attribute.y+i.table.getRowHeight(s._prev.row))})}}function Qs(n,e,t,i=!1){for(let l=0;l<t.table.frozenColCount;l++)for(let a=n;a<=e;a++){const d=t.highPerformanceGetCell(l,a,!0);t.updateCellGroupContent(d)}for(let l=t.table.colCount-t.table.rightFrozenColCount;l<t.table.colCount;l++)for(let a=n;a<=e;a++){const d=t.highPerformanceGetCell(l,a);t.updateCellGroupContent(d)}let r=t.bodyLeftCol,o=t.bodyRightCol,s=!0;if(i){const l=t.screenLeftCol;r=Math.max(t.bodyLeftCol,l-1*t.screenColCount),o=Math.min(t.bodyRightCol,l+2*t.screenColCount),r===t.bodyLeftCol&&o===t.bodyRightCol||(s=!1)}for(let l=r;l<=o;l++)for(let a=n;a<=e;a++){const d=t.highPerformanceGetCell(l,a);t.updateCellGroupContent(d)}return oh(t.table.scenegraph.rowHeaderGroup),oh(t.table.scenegraph.rightFrozenGroup),oh(t.table.scenegraph.bodyGroup),t.table.scenegraph.updateNextFrame(),s}function oh(n){var e,t;const i=Zs(n);if(!i)return;const r=Zs(i);if(r&&(n.setAttribute("height",r.attribute.y+r.attribute.height),n.border)){const o=n.border;o.setAttribute("height",r.attribute.y+r.attribute.height-((e=o.attribute.borderTop)!==null&&e!==void 0?e:0)/2-((t=o.attribute.borderBottom)!==null&&t!==void 0?t:0)/2)}}var mE=function(n,e,t,i){return new(t||(t=Promise))(function(r,o){function s(d){try{a(i.next(d))}catch(u){o(u)}}function l(d){try{a(i.throw(d))}catch(u){o(u)}}function a(d){var u;d.done?r(d.value):(u=d.value,u instanceof t?u:new t(function(h){h(u)})).then(s,l)}a((i=i.apply(n,e||[])).next())})};function bE(n){var e;return mE(this,void 0,void 0,function*(){let t,i;n.table.scenegraph.bodyGroup.forEachChildren((s,l)=>{s.type==="group"&&(s.needUpdate=!0,s==null||s.forEachChildren(a=>{a.needUpdate=!0}))}),n.table.isAutoRowHeight()?(t=n.rowStart,i=n.rowEnd):(t=Math.max(n.bodyTopRow,n.screenTopRow-1*n.screenRowCount),i=Math.min(n.bodyBottomRow,n.screenTopRow+2*n.screenRowCount,n.table.rowCount-1));const r=n.table.getAllRowsHeight();An(n.table,t,i);const o=n.table.getAllRowsHeight();r!==o&&n.table.scenegraph.updateContainerHeight(n.table.frozenRowCount,o-r);for(let s=0;(e=s<n.table.frozenColCount)!==null&&e!==void 0&&e;s++){const l=n.table.scenegraph.getColGroup(s);l==null||l.setAttribute("chartInstance",void 0);for(let a=n.rowStart;a<=n.rowEnd;a++)n.table.scenegraph.updateCellContent(s,a);for(let a=n.table.rowCount-n.table.bottomFrozenRowCount;a<n.table.rowCount;a++)n.table.scenegraph.updateCellContent(s,a)}for(let s=n.colStart;s<=n.colEnd;s++){const l=n.table.scenegraph.getColGroup(s);l==null||l.setAttribute("chartInstance",void 0);for(let a=n.table.rowCount-n.table.bottomFrozenRowCount;a<n.table.rowCount;a++)n.table.scenegraph.updateCellContent(s,a)}for(let s=n.table.colCount-n.table.rightFrozenColCount;s<n.table.colCount;s++){const l=n.table.scenegraph.getColGroup(s);l==null||l.setAttribute("chartInstance",void 0);for(let a=n.rowStart;a<=n.rowEnd;a++)n.table.scenegraph.updateCellContent(s,a);for(let a=n.table.rowCount-n.table.bottomFrozenRowCount;a<n.table.rowCount;a++)n.table.scenegraph.updateCellContent(s,a)}Qs(t,i,n),n.table.isAutoRowHeight()&&an(n.bodyLeftCol,n.bodyRightCol,t,i,n.table,n.rowEnd>n.bodyBottomRow-(n.rowEnd-n.rowStart+1)?"down":"up"),n.rowUpdatePos=n.rowStart,n.rowUpdateDirection=n.rowEnd>n.bodyBottomRow-(n.rowEnd-n.rowStart+1)?"down":"up",n.table.scenegraph.updateNextFrame(),n.table.isAutoRowHeight()||(yield n.progress())})}var CE=function(n,e,t,i){return new(t||(t=Promise))(function(r,o){function s(d){try{a(i.next(d))}catch(u){o(u)}}function l(d){try{a(i.throw(d))}catch(u){o(u)}}function a(d){var u;d.done?r(d.value):(u=d.value,u instanceof t?u:new t(function(h){h(u)})).then(s,l)}a((i=i.apply(n,e||[])).next())})};function _E(n){return CE(this,void 0,void 0,function*(){n.table.scenegraph.bodyGroup.forEachChildren((i,r)=>{i.type==="group"&&(i.needUpdate=!0,i==null||i.forEachChildren(o=>{o.needUpdate=!0}))});const e=Math.max(n.bodyLeftCol,n.screenLeftCol-1*n.screenColCount),t=Math.min(n.bodyRightCol,n.screenLeftCol+2*n.screenColCount);Bn(n.table,e,t);for(let i=n.colStart;i<=n.colEnd;i++){const r=n.table.scenegraph.getColGroup(i);r==null||r.setAttribute("chartInstance",void 0);for(let o=n.table.rowCount-n.table.bottomFrozenRowCount;o<n.table.rowCount;o++)n.table.scenegraph.updateCellContent(i,o)}for(let i=n.table.colCount-n.table.rightFrozenColCount;i<n.table.colCount;i++){const r=n.table.scenegraph.getColGroup(i);r==null||r.setAttribute("chartInstance",void 0);for(let o=n.rowStart;o<=n.rowEnd;o++)n.table.scenegraph.updateCellContent(i,o);for(let o=n.table.rowCount-n.table.bottomFrozenRowCount;o<n.table.rowCount;o++)n.table.scenegraph.updateCellContent(i,o)}Js(e,t,n),n.colUpdatePos=n.colStart,n.colUpdateDirection=n.colEnd>n.bodyRightCol-(n.colEnd-n.colStart+1)?"right":"left",n.table.scenegraph.updateNextFrame(),yield n.progress()})}function Bs(n){const{changedCells:e}=n.internalProps.stick;e.forEach(f=>{n.scenegraph.getCell(f.col,f.row).forEachChildren(p=>{p.setAttributes({dx:f.dx,dy:f.dy})})}),e.clear();const{scrollTop:t,scrollLeft:i,frozenRowCount:r,frozenColCount:o}=n,s=n.getFrozenRowsHeight(),l=n.getFrozenColsWidth(),{row:a}=n.getRowAt(t+s+1),{col:d}=n.getColAt(i+l+1),u=Math.max(a,n.frozenRowCount),h=Math.max(d,n.frozenColCount),c=n.getAllRowsHeight()>n.tableNoFrameHeight?n.getRowAt(t+n.tableNoFrameHeight-n.getBottomFrozenRowsHeight()-1).row:n.rowCount-n.bottomFrozenRowCount-1,g=n.getAllColsWidth()>n.tableNoFrameWidth?n.getColAt(i+n.tableNoFrameWidth-n.getRightFrozenColsWidth()-1).col:n.colCount-n.rightFrozenColCount-1;if(!(g<0||c<0)){for(let f=0;f<r&&!(g<h);f++)[h,g].forEach(p=>{const m=n._getCellStyle(p,f);m!=null&&m.textStick&&(m==null?void 0:m.textStick)!=="vertical"&&gC(n.scenegraph.getCell(p,f),l+n.tableX,n.tableNoFrameWidth-n.getRightFrozenColsWidth()+n.tableX,e,m==null?void 0:m.textStickBaseOnAlign,n)});for(let f=0;f<o&&!(c<u);f++)[u,c].forEach(p=>{const m=n._getCellStyle(f,p);m!=null&&m.textStick&&(m==null?void 0:m.textStick)!=="horizontal"&&cC(n.scenegraph.getCell(f,p),s+n.tableY,n.tableNoFrameHeight-n.getBottomFrozenRowsHeight()+n.tableY,e,m==null?void 0:m.textStickBaseOnAlign,n)});for(let f=h;f<=g&&!(c<u);f++)[u,c].forEach(p=>{const m=n._getCellStyle(f,p);m!=null&&m.textStick&&(m==null?void 0:m.textStick)!=="horizontal"&&cC(n.scenegraph.getCell(f,p),s+n.tableY,n.tableNoFrameHeight-n.getBottomFrozenRowsHeight()+n.tableY,e,m==null?void 0:m.textStickBaseOnAlign,n)});for(let f=u;f<=c&&!(g<h);f++)[h,g].forEach(p=>{const m=n._getCellStyle(p,f);m!=null&&m.textStick&&(m==null?void 0:m.textStick)!=="vertical"&&gC(n.scenegraph.getCell(p,f),l+n.tableX,n.tableNoFrameWidth-n.getRightFrozenColsWidth()+n.tableX,e,m==null?void 0:m.textStickBaseOnAlign,n)})}}function cC(n,e,t,i,r,o){if(J(n.mergeStartCol)&&J(n.mergeStartRow)&&J(n.mergeEndCol)&&J(n.mergeEndRow)){const{colStart:s,colEnd:l,rowStart:a,rowEnd:d}=rr(n,o.scenegraph);for(let u=s;u<=l;u++)for(let h=a;h<=d;h++){const c=o.scenegraph.getCell(u,h);c.role==="cell"&&fC(c,e,t,i,r)}}else fC(n,e,t,i,r)}function fC(n,e,t,i,r){var o,s,l,a,d,u,h,c,g,f,p,m,b,C,_,w,y;const v=n.getChildByName("text",!0)||n.getChildByName("image",!0);if(!v)return;if(v.type==="image"){const{image:B}=v.attribute;if(!B||!v.resources||v.resources.get(B).state!=="success")return}const x=(o=v.textBaseline)!==null&&o!==void 0?o:"top";v.AABBBounds.width();const S=v.globalAABBBounds.y1,R=v.globalAABBBounds.y2;if(x==="middle"&&r){const B=n.globalAABBBounds.y1+((l=(s=n.firstChild)===null||s===void 0?void 0:s.attribute.dy)!==null&&l!==void 0?l:0),A=B+((d=(a=n.contentHeight)!==null&&a!==void 0?a:n.attribute.height)!==null&&d!==void 0?d:0);if(B<e||A>t){const M=Math.max(B,e),H=Math.min(A,t),E=v.globalTransMatrix.f-(H+M)/2+v.AABBBounds.height()/2;!i.has(`${n.col}-${n.row}`)&&i.set(`${n.col}-${n.row}`,{col:n.col,row:n.row,dx:(h=(u=n.firstChild)===null||u===void 0?void 0:u.attribute.dx)!==null&&h!==void 0?h:0,dy:(g=(c=n.firstChild)===null||c===void 0?void 0:c.attribute.dy)!==null&&g!==void 0?g:0}),n.forEachChildren(T=>{var P;T.setAttribute("dy",((P=T.attribute.dy)!==null&&P!==void 0?P:0)-E+2)})}}else if(S<e){const B=S-e;!i.has(`${n.col}-${n.row}`)&&i.set(`${n.col}-${n.row}`,{col:n.col,row:n.row,dx:(p=(f=n.firstChild)===null||f===void 0?void 0:f.attribute.dx)!==null&&p!==void 0?p:0,dy:(b=(m=n.firstChild)===null||m===void 0?void 0:m.attribute.dy)!==null&&b!==void 0?b:0}),n.forEachChildren(A=>{var M;A.setAttribute("dy",((M=A.attribute.dy)!==null&&M!==void 0?M:0)-B+2)})}else if(R>t){const B=R-t;!i.has(`${n.col}-${n.row}`)&&i.set(`${n.col}-${n.row}`,{col:n.col,row:n.row,dx:(_=(C=n.firstChild)===null||C===void 0?void 0:C.attribute.dx)!==null&&_!==void 0?_:0,dy:(y=(w=n.firstChild)===null||w===void 0?void 0:w.attribute.dy)!==null&&y!==void 0?y:0}),n.forEachChildren(A=>{var M;A.setAttribute("dy",((M=A.attribute.dy)!==null&&M!==void 0?M:0)-B)})}}function gC(n,e,t,i,r,o){if(J(n.mergeStartCol)&&J(n.mergeStartRow)&&J(n.mergeEndCol)&&J(n.mergeEndRow)){const{colStart:s,colEnd:l,rowStart:a,rowEnd:d}=rr(n,o.scenegraph);for(let u=s;u<=l;u++)for(let h=a;h<=d;h++){const c=o.scenegraph.getCell(u,h);c.role==="cell"&&pC(c,e,t,i,r)}}else pC(n,e,t,i,r)}function pC(n,e,t,i,r){var o,s,l,a,d,u,h,c,g,f,p,m,b,C,_,w,y,v;const x=n.getChildByName("text",!0)||n.getChildByName("image",!0);if(!x)return;if(x.type==="image"){const{image:A}=x.attribute;if(!A||!x.resources||x.resources.get(A).state!=="success")return}const S=(s=(o=x.attribute.textAlign)!==null&&o!==void 0?o:x.textAlign)!==null&&s!==void 0?s:"left";x.AABBBounds.width();const R=x.globalAABBBounds.x1,B=x.globalAABBBounds.x2;if(S==="center"&&r){const A=n.globalAABBBounds.x1+((a=(l=n.firstChild)===null||l===void 0?void 0:l.attribute.dx)!==null&&a!==void 0?a:0),M=A+((u=(d=n.contentWidth)!==null&&d!==void 0?d:n.attribute.width)!==null&&u!==void 0?u:0);if(A<e||M>t){const H=Math.max(A,e),E=Math.min(M,t),T=x.globalTransMatrix.e-(E+H)/2;!i.has(`${n.col}-${n.row}`)&&i.set(`${n.col}-${n.row}`,{col:n.col,row:n.row,dx:(c=(h=n.firstChild)===null||h===void 0?void 0:h.attribute.dx)!==null&&c!==void 0?c:0,dy:(f=(g=n.firstChild)===null||g===void 0?void 0:g.attribute.dy)!==null&&f!==void 0?f:0}),n.forEachChildren(P=>{var k;P.setAttribute("dx",((k=P.attribute.dx)!==null&&k!==void 0?k:0)-T+2)})}}else if(R<e){const A=R-e;!i.has(`${n.col}-${n.row}`)&&i.set(`${n.col}-${n.row}`,{col:n.col,row:n.row,dx:(m=(p=n.firstChild)===null||p===void 0?void 0:p.attribute.dx)!==null&&m!==void 0?m:0,dy:(C=(b=n.firstChild)===null||b===void 0?void 0:b.attribute.dy)!==null&&C!==void 0?C:0}),n.forEachChildren(M=>{var H;M.setAttribute("dx",((H=M.attribute.dx)!==null&&H!==void 0?H:0)-A+2)})}else if(B>t){const A=B-t;!i.has(`${n.col}-${n.row}`)&&i.set(`${n.col}-${n.row}`,{col:n.col,row:n.row,dx:(w=(_=n.firstChild)===null||_===void 0?void 0:_.attribute.dx)!==null&&w!==void 0?w:0,dy:(v=(y=n.firstChild)===null||y===void 0?void 0:y.attribute.dy)!==null&&v!==void 0?v:0}),n.forEachChildren(M=>{var H;M.setAttribute("dx",((H=M.attribute.dx)!==null&&H!==void 0?H:0)-A)})}}function mC(n){var e,t;const i=n.internalProps.layoutMap.headerObjects,r=n.internalProps.layoutMap.columnObjects;for(let o=0;o<i.length;o++){const s=i[o];if(s&&(!((e=s.style)===null||e===void 0)&&e.textStick))return!0}for(let o=0;o<r.length;o++){const s=r[o];if(s&&(!((t=s.style)===null||t===void 0)&&t.textStick))return!0}return!!(n.theme.headerStyle.textStick||n.theme.rowHeaderStyle.textStick||n.theme.bodyStyle.textStick)}var _n=function(n,e,t,i){return new(t||(t=Promise))(function(r,o){function s(d){try{a(i.next(d))}catch(u){o(u)}}function l(d){try{a(i.throw(d))}catch(u){o(u)}}function a(d){var u;d.done?r(d.value):(u=d.value,u instanceof t?u:new t(function(h){h(u)})).then(s,l)}a((i=i.apply(n,e||[])).next())})};class wE{constructor(e){this.isRelease=!1,this.mode="column",this.rowLimit=200,this.currentRow=0,this.rowStart=0,this.rowEnd=0,this.referenceRow=0,this.screenTopRow=0,this.deltaY=0,this.deltaHeight=0,this.colLimit=100,this.screenLeftCol=0,this.deltaX=0,this.deltaWidth=0,this.cellCache=new Map,this.table=e,this.table.isPivotChart()?(this.rowLimit=Math.max(100,Math.ceil(2*e.tableNoFrameHeight/e.defaultRowHeight)),this.colLimit=Math.max(100,Math.ceil(2*e.tableNoFrameWidth/e.defaultColWidth))):this.table.isAutoRowHeight()?this.rowLimit=Math.max(100,Math.ceil(2*e.tableNoFrameHeight/e.defaultRowHeight)):(this.table.widthMode==="autoWidth"||(this.rowLimit=Math.max(200,Math.ceil(2*e.tableNoFrameHeight/e.defaultRowHeight))),this.colLimit=Math.max(100,Math.ceil(2*e.tableNoFrameWidth/e.defaultColWidth))),this.table.internalProps.transpose?this.mode="row":this.table.isPivotTable()&&(this.mode="pivot"),this.table.options.maintainedDataCount&&(this.rowLimit=this.table.options.maintainedDataCount)}get bodyLeftCol(){return this.table.frozenColCount}get bodyTopRow(){return this.table.frozenRowCount}setParamsForColumn(){this.bodyRightCol=this.table.colCount-1-this.table.rightFrozenColCount;const e=Math.min(this.colLimit,this.bodyRightCol-this.bodyLeftCol+1);this.totalActualBodyColCount=e,this.totalCol=this.bodyLeftCol+e-1,this.colStart=this.bodyLeftCol,this.colEnd=this.totalCol;const t=this.table.defaultColWidth;this.taskColCount=1*Math.ceil(this.table.tableNoFrameWidth/t);const i=t*e,r=t*(this.bodyRightCol-this.bodyLeftCol+1);this.xLimitLeft=i/2,this.xLimitRight=r-i/2;const o=5*this.table.tableNoFrameWidth;this.screenColCount=Math.ceil(this.table.tableNoFrameWidth/t),this.firstScreenColLimit=Math.max(15,this.bodyLeftCol+Math.min(this.colLimit,Math.ceil(o/t))),this.colUpdatePos=this.bodyRightCol}setParamsForRow(){this.bodyBottomRow=this.table.rowCount-1-this.table.bottomFrozenRowCount;const e=Math.min(this.rowLimit,this.bodyBottomRow-this.bodyTopRow+1);this.totalActualBodyRowCount=e,this.totalRow=this.bodyTopRow+e-1,this.rowStart=this.bodyTopRow,this.rowEnd=this.totalRow;const t=this.table.defaultRowHeight;this.taskRowCount=1*Math.ceil(this.table.tableNoFrameHeight/t);const i=t*e,r=t*(this.bodyBottomRow-this.bodyTopRow+1);this.yLimitTop=i/2,this.yLimitBottom=r-i/2;const o=5*this.table.tableNoFrameHeight;this.screenRowCount=Math.ceil(this.table.tableNoFrameHeight/t),this.firstScreenRowLimit=Math.max(30,this.bodyTopRow+Math.min(this.rowLimit,Math.ceil(o/t))),this.rowUpdatePos=this.bodyBottomRow}refreshRowCount(){this.bodyBottomRow=this.table.rowCount-1-this.table.bottomFrozenRowCount;const e=Math.min(this.rowLimit,this.bodyBottomRow-this.bodyTopRow+1);this.totalActualBodyRowCount=e,this.totalRow=this.rowStart+e-1}refreshColCount(){this.bodyRightCol=this.table.colCount-1-this.table.rightFrozenColCount;const e=Math.min(this.colLimit,this.bodyRightCol-this.bodyLeftCol+1);this.totalActualBodyColCount=e,this.totalCol=this.bodyLeftCol+e-1,this.colStart=this.bodyLeftCol,this.colEnd=this.totalCol}resize(){const e=this.table.defaultColWidth;this.taskColCount=1*Math.ceil(this.table.tableNoFrameWidth/e);const t=5*this.table.tableNoFrameWidth;this.screenColCount=Math.ceil(this.table.tableNoFrameWidth/e),this.firstScreenColLimit=this.bodyLeftCol+Math.min(this.colLimit,Math.ceil(t/e));const i=this.table.defaultRowHeight;this.taskRowCount=1*Math.ceil(this.table.tableNoFrameHeight/i);const r=5*this.table.tableNoFrameHeight;this.screenRowCount=Math.ceil(this.table.tableNoFrameHeight/i),this.firstScreenRowLimit=this.bodyTopRow+Math.min(this.rowLimit,Math.ceil(r/i))}createGroupForFirstScreen(e,t,i,r,o,s,l,a){rE(e,t,i,r,o,s,l,a,this)}progress(){return _n(this,void 0,void 0,function*(){if(!this.isProgressing)return this.isProgressing=!0,new Promise((e,t)=>{setTimeout(()=>_n(this,void 0,void 0,function*(){this.isProgressing=!1,this.isRelease||(this.colUpdatePos<=this.colEnd?(yield this.updateColCellGroupsAsync(),yield this.progress()):this.rowUpdatePos<=this.rowEnd?(yield this.updateRowCellGroupsAsync(),yield this.progress()):this.currentCol<this.totalCol?(yield this.createCol(),yield this.progress()):this.currentRow<this.totalRow&&(yield this.createRow(),yield this.progress()),Bs(this.table),this.table.scenegraph.updateNextFrame(),e())}),16)})})}createRow(){return _n(this,void 0,void 0,function*(){this.taskRowCount&&this.createRowCellGroup(this.taskRowCount)})}createCol(){return _n(this,void 0,void 0,function*(){this.taskColCount&&this.createColGroup(this.taskRowCount)})}createRowCellGroup(e){const t=Math.min(this.totalRow,this.currentRow+e);if(An(this.table,this.currentRow+1,t,!1),this.rowEnd=t,this.table.frozenColCount){let r=0;for(let o=0;o<this.table.frozenColCount;o++){const s=this.table.scenegraph.getColGroup(o),{height:l}=(this.table.isListTable(),na(s,o,s.attribute.width,this.currentRow+1,t,this.table.scenegraph.mergeMap,this.table.defaultRowHeight,this.table));r=Math.max(r,l),this.table.scenegraph.rowHeaderGroup.setAttribute("height",r)}}if(this.table.rightFrozenColCount){let r=0;for(let o=this.table.colCount-this.table.rightFrozenColCount;o<this.table.colCount;o++){const s=this.table.scenegraph.getColGroup(o),{height:l}=(this.table.isPivotChart(),na(s,o,s.attribute.width,this.currentRow+1,t,this.table.scenegraph.mergeMap,this.table.defaultRowHeight,this.table));r=Math.max(r,l),this.table.scenegraph.rightFrozenGroup.setAttribute("height",r)}}let i=0;for(let r=this.bodyLeftCol;r<=this.bodyRightCol;r++){const o=this.table.scenegraph.getColGroup(r);if(!o)continue;this.table.rowHeaderLevelCount;const{height:s}=na(o,r,o.attribute.width,this.currentRow+1,t,this.table.scenegraph.mergeMap,this.table.defaultRowHeight,this.table);i=Math.max(i,s)}this.table.scenegraph.bodyGroup.setAttribute("height",i),this.currentRow=t,this.rowUpdatePos=this.rowEnd,this.table.scenegraph.updateContainer(),this.table.scenegraph.updateBorderSizeAndPosition()}createColGroup(e){const t=Math.min(this.totalCol,this.currentCol+e);Bn(this.table,this.currentCol+1,t),this.colEnd=t;for(let s=0;s<this.table.rowCount;s++){const l=this.highPerformanceGetCell(this.currentCol,s);l.role==="cell"&&J(l.mergeStartCol)&&l.mergeStartCol>this.currentCol&&this.table.scenegraph.updateCellContent(l.col,l.row)}if(this.table.frozenRowCount){const s=this.table.scenegraph.colHeaderGroup.lastChild instanceof Pe?this.table.scenegraph.colHeaderGroup.lastChild:this.table.scenegraph.colHeaderGroup.lastChild._prev,l=s.attribute.x+s.attribute.width,a=s.attribute.y;_t(this.table.scenegraph.colHeaderGroup,l,a,this.currentCol+1,t,0,this.table.frozenRowCount-1,"columnHeader",this.table)}if(this.table.bottomFrozenRowCount){const s=this.table.scenegraph.bottomFrozenGroup.lastChild instanceof Pe?this.table.scenegraph.bottomFrozenGroup.lastChild:this.table.scenegraph.bottomFrozenGroup.lastChild._prev,l=s.attribute.x+s.attribute.width,a=s.attribute.y;_t(this.table.scenegraph.bottomFrozenGroup,l,a,this.currentCol+1,t,this.table.rowCount-this.table.bottomFrozenRowCount,this.table.rowCount-1,"columnHeader",this.table)}let i=this.table.scenegraph.bodyGroup.lastChild&&(this.table.scenegraph.bodyGroup.lastChild instanceof Pe?this.table.scenegraph.bodyGroup.lastChild:this.table.scenegraph.bodyGroup.lastChild._prev);i||(i=this.table.scenegraph.colHeaderGroup.lastChild&&(this.table.scenegraph.colHeaderGroup.lastChild instanceof Pe?this.table.scenegraph.colHeaderGroup.lastChild:this.table.scenegraph.colHeaderGroup.lastChild._prev));const r=i.attribute.x+i.attribute.width,o=i.attribute.y;_t(this.table.scenegraph.bodyGroup,r,o,this.currentCol+1,t,this.rowStart,this.rowEnd,"body",this.table),this.currentCol=t,this.colUpdatePos=this.colEnd,this.table.scenegraph.updateContainer(),this.table.scenegraph.updateBorderSizeAndPosition()}setY(e,t=!1){return _n(this,void 0,void 0,function*(){const i=this.table.getRowsHeight(this.bodyTopRow,this.bodyTopRow+(this.rowEnd-this.rowStart+1))/2,r=this.table.getAllRowsHeight()-i,o=this.table.getTargetRowAt(e+this.table.scenegraph.colHeaderGroup.attribute.height);o&&(this.screenTopRow=o.row),e<i&&this.rowStart===this.bodyTopRow||e>r&&this.rowEnd===this.bodyBottomRow?(this.updateDeltaY(e),this.updateBody(e-this.deltaY)):this.table.scenegraph.bodyGroup.firstChild&&this.table.scenegraph.bodyGroup.firstChild.type==="group"&&this.table.scenegraph.bodyGroup.firstChild.childrenCount!==0||this.table.scenegraph.rowHeaderGroup.firstChild&&this.table.scenegraph.rowHeaderGroup.firstChild.type==="group"&&this.table.scenegraph.rowHeaderGroup.firstChild.childrenCount!==0?this.dynamicSetY(e,o,t):(this.updateDeltaY(e),this.updateBody(e-this.deltaY))})}setX(e,t=!1){return _n(this,void 0,void 0,function*(){const i=this.table.getColsWidth(this.bodyLeftCol,this.bodyLeftCol+(this.colEnd-this.colStart+1))/2,r=this.table.getAllColsWidth()-i,o=this.table.getTargetColAt(e+this.table.scenegraph.rowHeaderGroup.attribute.width);o&&(this.screenLeftCol=o.col),e<i&&this.colStart===this.bodyLeftCol||e>r&&this.colEnd===this.bodyRightCol||this.table.scenegraph.bodyGroup.firstChild&&this.table.scenegraph.bodyGroup.firstChild.type==="group"&&this.table.scenegraph.bodyGroup.firstChild.childrenCount===0?(this.updateDeltaX(e),this.table.scenegraph.setBodyAndColHeaderX(-e+this.deltaX)):this.dynamicSetX(e,o,t)})}dynamicSetY(e,t,i=!1){return _n(this,void 0,void 0,function*(){cE(e,t,i,this)})}dynamicSetX(e,t,i=!1){return _n(this,void 0,void 0,function*(){lE(e,t,i,this)})}updateBody(e){this.table.scenegraph.setBodyAndRowHeaderY(-e)}updateRowCellGroupsAsync(){return _n(this,void 0,void 0,function*(){this.updateCellGroups(this.taskRowCount)})}updateCellGroups(e){const t=Math.min(this.bodyBottomRow,this.rowUpdatePos+e);this.table.isAutoRowHeight()&&An(this.table,this.rowUpdatePos,t,!1),Qs(this.rowUpdatePos,t,this),this.table.isAutoRowHeight()&&(an(this.bodyLeftCol,this.bodyRightCol,this.rowUpdatePos,t,this.table,this.rowUpdateDirection,!0),an(0,this.table.frozenColCount-1,this.rowUpdatePos,t,this.table,this.rowUpdateDirection,!0),an(this.table.colCount-this.table.rightFrozenColCount,this.table.colCount-1,this.rowUpdatePos,t,this.table,this.rowUpdateDirection,!0)),this.rowUpdatePos=t+1}updateBottomFrozenCellGroups(){const e=this.table.rowCount-this.table.bottomFrozenRowCount,t=this.table.rowCount-1;this.table.isAutoRowHeight()&&An(this.table,e,t,!1),Qs(e,t,this),this.table.isAutoRowHeight()&&(an(this.bodyLeftCol,this.bodyRightCol,e,t,this.table,this.rowUpdateDirection),an(0,this.table.frozenColCount-1,e,t,this.table,this.rowUpdateDirection),an(this.table.colCount-this.table.rightFrozenColCount,this.table.colCount-1,e,t,this.table,this.rowUpdateDirection))}updateRightFrozenCellGroups(){const e=this.table.colCount-this.table.rightFrozenColCount,t=this.table.colCount-1;this.table.widthMode==="autoWidth"&&Bn(this.table,e,t,!1),Js(e,t,this),this.table.isAutoRowHeight()&&sf(e,t,this.table,this.colUpdateDirection)}updateColCellGroupsAsync(){return _n(this,void 0,void 0,function*(){this.updateColGroups(this.taskRowCount)})}updateColGroups(e){const t=Math.min(this.bodyRightCol,this.colUpdatePos+e);Bn(this.table,this.colUpdatePos,t),Js(this.colUpdatePos,t,this),this.colUpdatePos=t+1}updateCellGroupPosition(e,t,i){e.row=t,e.mergeStartCol=void 0,e.mergeStartRow=void 0,e.mergeEndCol=void 0,e.mergeEndRow=void 0,e.setAttribute("y",i),e.needUpdate=!0,e.needUpdateForAutoRowHeight=!0}updateCellGroupContent(e){if(!e.needUpdate||e.role!=="cell")return e;const t=this.table.scenegraph.updateCellContent(e.col,e.row);return e.needUpdate=!1,t||e}sortCellVertical(){return _n(this,void 0,void 0,function*(){yield bE(this)})}sortCellHorizontal(){return _n(this,void 0,void 0,function*(){yield _E(this)})}highPerformanceGetCell(e,t,i){if(t>=this.table.frozenRowCount&&t<this.table.rowCount-this.table.bottomFrozenRowCount&&(t<this.rowStart||t>this.rowEnd)||e>=this.table.frozenColCount&&e<this.table.colCount-this.table.rightFrozenColCount&&(e<this.colStart||e>this.colEnd))return kd;if(this.cellCache.get(e)){const o=this.cellCache.get(e);if((o._next||o._prev)&&Math.abs(o.row-t)<t){let l=lf(o,t);return l&&(i||l.role!=="shadow-cell")||(l=this.table.scenegraph.getCell(e,t,i)),l.row&&this.cellCache.set(e,l),l}const s=this.table.scenegraph.getCell(e,t,i);return s.col===e&&s.row&&this.cellCache.set(e,s),s}const r=this.table.scenegraph.getCell(e,t,i);return r.col===e&&r.row&&this.cellCache.set(e,r),r}updateDeltaY(e,t,i){if(this.rowStart===this.bodyTopRow){const r=this.table.scenegraph.highPerformanceGetCell(this.colStart,this.rowStart,!0);if(r.role==="cell"){const o=r.attribute.y;this.deltaY=-o}}else if(this.rowEnd===this.bodyBottomRow){const r=this.table.scenegraph.highPerformanceGetCell(this.colStart,this.rowEnd,!0);if(r.role==="cell"){const o=r.attribute.y+r.attribute.height-(this.table.getAllRowsHeight()-this.table.getFrozenRowsHeight()-this.table.getBottomFrozenRowsHeight());this.deltaY=-o}}else if(O(t)&&O(i)){let r=this.table.scenegraph.highPerformanceGetCell(this.colStart,i,!0);r.role!=="cell"&&(r=this.table.scenegraph.highPerformanceGetCell(0,i,!0));const o=e-this.deltaY,s=t-o,l=r.attribute.y-o+this.table.getFrozenRowsHeight();this.deltaY=s-l}}updateDeltaX(e,t,i){if(this.colStart===this.bodyLeftCol){const r=this.table.scenegraph.getColGroup(this.colStart);if(r){const o=r.attribute.x;this.deltaX=-o}}else if(this.colEnd===this.bodyRightCol){const r=this.table.scenegraph.getColGroup(this.colEnd);if(r){const o=r.attribute.x+r.attribute.width-(this.table.getAllColsWidth()-this.table.getFrozenColsWidth()-this.table.getRightFrozenColsWidth());this.deltaX=-o}}else if(O(t)&&O(i)){const r=this.table.scenegraph.getColGroup(i)||this.table.scenegraph.getColGroup(i,!0),o=e-this.deltaX,s=t-o,l=r.attribute.x-o+this.table.getFrozenColsWidth();this.deltaX=s-l}}release(){this.isRelease=!0}}function lf(n,e){if(!n)return null;if(n.row===e)return n;const t=n._prev,i=n._next;return n.row>e&&t&&t.row===n.row-1?lf(t,e):n.row<e&&i&&i.row===n.row+1?lf(i,e):null}function yE(n,e,t,i,r,o){const s=o.scenegraph;for(let l=n;l<=e;l++){const a=o.getColWidth(l),d=o.scenegraph.getColGroup(l,!0),u=o.scenegraph.getColGroup(l),h=o.scenegraph.getColGroupInBottom(l),c=o.scenegraph.getColGroupInLeftBottomCorner(l),g=o.scenegraph.getColGroupInRightBottomCorner(l);d&&(d.setAttribute("width",a),d.forEachChildren(f=>{f.setAttribute("width",a)})),u&&(u.setAttribute("width",a),u.forEachChildren(f=>{f.setAttribute("width",a)})),h&&(h.setAttribute("width",a),h.forEachChildren(f=>{f.setAttribute("width",a)})),g&&(g.setAttribute("width",a),g.forEachChildren(f=>{f.setAttribute("width",a)})),c&&(c.setAttribute("width",a),c.forEachChildren(f=>{f.setAttribute("width",a)}))}if(s.updateContainer(),r==="column")for(let l=n;l<=e;l++){const a=o.scenegraph.getColGroup(l);a==null||a.setAttribute("chartInstance",void 0);for(let d=0;d<=o.frozenRowCount-1;d++)s.updateCellContent(l,d);for(let d=s.bodyRowStart;d<=s.bodyRowEnd;d++)s.updateCellContent(l,d);for(let d=o.rowCount-o.bottomFrozenRowCount;d<=o.rowCount-1;d++)s.updateCellContent(l,d)}else{for(let l=0;l<=o.frozenColCount-1;l++){const a=o.scenegraph.getColGroup(l);a==null||a.setAttribute("chartInstance",void 0);for(let d=t;d<=i;d++)s.updateCellContent(l,d)}for(let l=s.bodyColStart;l<=s.bodyColEnd;l++){const a=o.scenegraph.getColGroup(l);a==null||a.setAttribute("chartInstance",void 0);for(let d=t;d<=i;d++)s.updateCellContent(l,d)}for(let l=o.colCount-o.rightFrozenColCount;l<=o.colCount-1;l++){const a=o.scenegraph.getColGroup(l);a==null||a.setAttribute("chartInstance",void 0);for(let d=t;d<=i;d++)s.updateCellContent(l,d)}}}function yy(n){n.customSelectedRangeComponents.forEach((e,t)=>{sh(e,t,n)}),n.selectingRangeComponents.forEach((e,t)=>{sh(e,t,n)}),n.selectedRangeComponents.forEach((e,t)=>{sh(e,t,n)})}function sh(n,e,t){var i,r,o,s,l,a,d,u,h;const c=t.table,[g,f,p,m]=e.split("-"),b=parseInt(g,10),C=parseInt(f,10),_=parseInt(p,10),w=parseInt(m,10);let y,v=b,x=C,S=_,R=w;switch(n.role){case"rowHeader":y=c.getBodyVisibleRowRange(),y&&(x=Math.max(C,y.rowStart-1),R=Math.min(w,y.rowEnd+1));break;case"columnHeader":case"bottomFrozen":y=c.getBodyVisibleCellRange(),y&&(v=Math.max(b,y.colStart-1),S=Math.min(_,y.colEnd+1));break;case"cornerHeader":case"rightTopCorner":case"leftBottomCorner":case"rightBottomCorner":break;case"rightFrozen":y=c.getBodyVisibleCellRange(),y&&(x=Math.max(C,y.rowStart-1),R=Math.min(w,y.rowEnd+1));break;default:y=c.getBodyVisibleCellRange(),y&&(x=Math.max(C,y.rowStart-1),R=Math.min(w,y.rowEnd+1),v=Math.max(b,y.colStart-1),S=Math.min(_,y.colEnd+1))}const B=c.getColsWidth(v,S),A=c.getRowsHeight(x,R),M=t.highPerformanceGetCell(v,x).globalAABBBounds,H=t.highPerformanceGetCell(S,R).globalAABBBounds;n.rect.setAttributes({x:M.x1-t.tableGroup.attribute.x,y:M.y1-t.tableGroup.attribute.y,width:B,height:A,visible:!0}),n.fillhandle&&((i=n.fillhandle)===null||i===void 0||i.setAttributes({x:H.x2-t.tableGroup.attribute.x-3,y:H.y2-t.tableGroup.attribute.y-3,width:6,height:6,visible:!0}));let E=!!c.frozenColCount&&b===c.frozenColCount;!E&&c.frozenColCount&&c.scrollLeft>0&&b>=c.frozenColCount&&c.getColsWidth(0,b-1)-c.scrollLeft<c.getFrozenColsWidth()&&(E=!0);let T=!!c.rightFrozenColCount&&c.rightFrozenColCount>0&&_===c.colCount-c.rightFrozenColCount-1;!T&&c.rightFrozenColCount&&_<c.colCount-c.rightFrozenColCount&&c.getColsWidth(0,_)-c.scrollLeft>c.tableNoFrameWidth-c.getRightFrozenColsWidth()&&(T=!0);let P=!c.frozenRowCount||C===c.frozenRowCount;!P&&c.frozenRowCount&&c.scrollTop>0&&C>=c.frozenRowCount&&c.getRowsHeight(0,C-1)-c.scrollTop<c.getFrozenRowsHeight()&&(P=!0);let k=!!c.bottomFrozenRowCount&&w===c.rowCount-c.bottomFrozenRowCount-1;if(!k&&c.bottomFrozenRowCount&&w<c.rowCount-c.bottomFrozenRowCount&&c.getRowsHeight(0,w)-c.scrollTop>c.tableNoFrameHeight-c.getBottomFrozenRowsHeight()&&(k=!0),E&&n.rect.attribute.stroke[3]||T&&n.rect.attribute.stroke[1]||P&&n.rect.attribute.stroke[0]||k&&n.rect.attribute.stroke[2]){if(E&&n.rect.attribute.stroke[3]&&t.tableGroup.insertAfter(n.rect,n.role==="columnHeader"?t.cornerHeaderGroup:n.role==="bottomFrozen"?t.leftBottomCornerGroup:t.rowHeaderGroup),k&&n.rect.attribute.stroke[2]&&t.tableGroup.insertAfter(n.rect,n.role==="rowHeader"?t.leftBottomCornerGroup:n.role==="rightFrozen"?t.rightBottomCornerGroup:t.bottomFrozenGroup),P&&n.rect.attribute.stroke[0]&&t.tableGroup.insertAfter(n.rect,n.role==="rowHeader"?t.cornerHeaderGroup:n.role==="rightFrozen"?t.rightTopCornerGroup:t.colHeaderGroup),T&&n.rect.attribute.stroke[1]&&t.tableGroup.insertAfter(n.rect,n.role==="columnHeader"?t.rightTopCornerGroup:n.role==="bottomFrozen"?t.rightBottomCornerGroup:t.rightFrozenGroup),n.rect.attribute.x<c.getFrozenColsWidth()&&c.scrollLeft>0&&(n.role==="body"||n.role==="columnHeader"||n.role==="bottomFrozen")){const F=n.rect.attribute.width-(c.getFrozenColsWidth()-n.rect.attribute.x);n.rect.setAttributes({x:n.rect.attribute.x+(c.getFrozenColsWidth()-n.rect.attribute.x),width:F>0?F:0}),(r=n.fillhandle)===null||r===void 0||r.setAttributes({visible:F>0})}if(c.getRightFrozenColsWidth()>0&&t.rightFrozenGroup.attribute.height>0&&n.rect.attribute.x+n.rect.attribute.width>t.rightFrozenGroup.attribute.x&&(n.role==="body"||n.role==="columnHeader"||n.role==="bottomFrozen")){const F=t.rightFrozenGroup.attribute.x-n.rect.attribute.x;n.rect.setAttributes({x:n.rect.attribute.x,width:F>0?F:0}),(o=n.fillhandle)===null||o===void 0||o.setAttributes({visible:F-B>0})}if(n.rect.attribute.y<t.colHeaderGroup.attribute.height&&c.scrollTop>0&&(n.role==="body"||n.role==="rowHeader"||n.role==="rightFrozen")){const F=n.rect.attribute.height-(t.colHeaderGroup.attribute.height-n.rect.attribute.y);n.rect.setAttributes({y:n.rect.attribute.y+(t.colHeaderGroup.attribute.height-n.rect.attribute.y),height:F>0?F:0}),(s=n.fillhandle)===null||s===void 0||s.setAttributes({visible:F>0})}if(t.bottomFrozenGroup.attribute.width>0&&t.bottomFrozenGroup.attribute.height>0&&n.rect.attribute.y+n.rect.attribute.height>t.bottomFrozenGroup.attribute.y&&(n.role==="body"||n.role==="rowHeader"||n.role==="rightFrozen")){const F=t.bottomFrozenGroup.attribute.y-n.rect.attribute.y;n.rect.setAttributes({y:n.rect.attribute.y,height:F>0?F:0}),(l=n.fillhandle)===null||l===void 0||l.setAttributes({visible:F-A>0})}}else t.tableGroup.insertAfter(n.rect,n.role==="body"?t.bodyGroup:n.role==="columnHeader"?t.colHeaderGroup:n.role==="rowHeader"?t.rowHeaderGroup:n.role==="cornerHeader"?t.cornerHeaderGroup:n.role==="rightTopCorner"?t.rightTopCornerGroup:n.role==="rightFrozen"?t.rightFrozenGroup:n.role==="leftBottomCorner"?t.leftBottomCornerGroup:n.role==="bottomFrozen"?t.bottomFrozenGroup:t.rightBottomCornerGroup);let L=0;typeof n.rect.attribute.lineWidth=="number"&&(L=Math.ceil(n.rect.attribute.lineWidth/2)),_===c.colCount-1&&(Array.isArray(n.rect.attribute.lineWidth)&&(L=Math.ceil(((a=n.rect.attribute.lineWidth[1])!==null&&a!==void 0?a:0)/2)),n.rect.setAttributes({width:n.rect.attribute.width-L})),b===0&&(Array.isArray(n.rect.attribute.lineWidth)&&(L=Math.ceil(((d=n.rect.attribute.lineWidth[3])!==null&&d!==void 0?d:0)/2)),n.rect.setAttributes({x:n.rect.attribute.x+L,width:n.rect.attribute.width-L})),w===c.rowCount-1&&(Array.isArray(n.rect.attribute.lineWidth)&&(L=Math.ceil(((u=n.rect.attribute.lineWidth[2])!==null&&u!==void 0?u:0)/2)),n.rect.setAttributes({height:n.rect.attribute.height-L})),C===0&&(Array.isArray(n.rect.attribute.lineWidth)&&(L=Math.ceil(((h=n.rect.attribute.lineWidth[0])!==null&&h!==void 0?h:0)/2)),n.rect.setAttributes({y:n.rect.attribute.y+L,height:n.rect.attribute.height-L}))}function bC(n,e,t=!0){const i=n.table,r=e.start.col,o=e.start.row,s=e.end.col,l=e.end.row,a=e.skipBodyMerge;let d=Math.max(Math.min(s,r),0),u=Math.max(Math.min(l,o),0),h=Math.min(Math.max(s,r),i.colCount-1),c=Math.min(Math.max(l,o),i.rowCount-1);const g=()=>{let x=!1;for(let S=d;S<=h;S++){if(S===d)for(let R=u;R<=c;R++){if(!i.isHeader(S,R)&&a)continue;const B=at(i,S,R);if(B&&B.start.col<d){d=B.start.col,x=!0;break}}if(!x&&S===h)for(let R=u;R<=c;R++){if(!i.isHeader(S,R)&&a)continue;const B=at(i,S,R);if(B&&Math.min(B.end.col,i.colCount-1)>h){h=B.end.col,x=!0;break}}if(x)break}if(!x)for(let S=u;S<=c;S++){if(S===u)for(let R=d;R<=h;R++){if(!i.isHeader(R,S)&&a)continue;const B=at(i,R,S);if(B&&B.start.row<u){u=B.start.row,x=!0;break}}if(!x&&S===c)for(let R=d;R<=h;R++){if(!i.isHeader(R,S)&&a)continue;const B=at(i,R,S);if(B&&Math.min(B.end.row,i.rowCount-1)>c){c=B.end.row,x=!0;break}}if(x)break}x&&g()};t&&g(),n.selectingRangeComponents.forEach((x,S)=>{var R;x.rect.delete(),(R=x.fillhandle)===null||R===void 0||R.delete()}),n.selectingRangeComponents=new Map;let f=!1,p=!1,m=!1,b=!1,C=!1,_=!1,w=!1,y=!1,v=!1;if(d<=i.frozenColCount-1&&u<=i.frozenRowCount-1&&(_=!0),h>=i.colCount-i.rightFrozenColCount&&u<=i.frozenRowCount-1&&(w=!0),d<=i.frozenColCount-1&&c>=i.rowCount-i.bottomFrozenRowCount&&(v=!0),h>=i.colCount-i.rightFrozenColCount&&c>=i.rowCount-i.bottomFrozenRowCount&&(y=!0),d<=i.frozenColCount-1&&c>=i.frozenRowCount&&u<=i.rowCount-i.bottomFrozenRowCount-1&&(f=!0),h>=i.colCount-i.rightFrozenColCount&&c>=i.frozenRowCount&&u<=i.rowCount-i.bottomFrozenRowCount-1&&(p=!0),u<=i.frozenRowCount-1&&h>=i.frozenColCount&&d<=i.colCount-i.rightFrozenColCount-1&&(m=!0),c>=i.rowCount-i.bottomFrozenRowCount&&h>=i.frozenColCount&&d<=i.colCount-i.rightFrozenColCount-1&&(b=!0),d<=i.colCount-i.rightFrozenColCount-1&&h>=i.frozenColCount&&u<=i.rowCount-i.bottomFrozenRowCount-1&&c>=i.frozenRowCount&&(C=!0),_){const x=Math.min(h,i.frozenColCount-1),S=Math.min(c,i.frozenRowCount-1),R=[!0,!m,!f,!0];n.createCellSelectBorder(d,u,x,S,"cornerHeader",`${d}${u}${h}${c}`,R)}if(w){const x=Math.max(d,i.colCount-i.rightFrozenColCount),S=Math.min(c,i.frozenRowCount-1),R=[!0,!0,!p,!m];n.createCellSelectBorder(x,u,h,S,"rightTopCorner",`${d}${u}${h}${c}`,R)}if(v){const x=Math.min(h,i.frozenColCount-1),S=Math.max(u,i.rowCount-i.bottomFrozenRowCount),R=[!f,!b,!0,!0];n.createCellSelectBorder(d,S,x,c,"leftBottomCorner",`${d}${u}${h}${c}`,R)}if(y){const x=Math.max(d,i.colCount-i.rightFrozenColCount),S=Math.max(u,i.rowCount-i.bottomFrozenRowCount),R=[!p,!0,!0,!b];n.createCellSelectBorder(x,S,h,c,"rightBottomCorner",`${d}${u}${h}${c}`,R)}if(m){const x=Math.max(d,i.frozenColCount),S=Math.min(h,i.colCount-i.rightFrozenColCount-1),R=Math.min(c,i.frozenRowCount-1),B=[!0,!w,!C,!_];n.createCellSelectBorder(x,u,S,R,"columnHeader",`${d}${u}${h}${c}`,B)}if(b){const x=Math.max(d,i.frozenColCount),S=Math.min(h,i.colCount-i.rightFrozenColCount-1),R=Math.max(u,i.rowCount-i.bottomFrozenRowCount),B=[!C,!y,!0,!v];n.createCellSelectBorder(x,R,S,c,"bottomFrozen",`${d}${u}${h}${c}`,B)}if(f){const x=Math.max(u,i.frozenRowCount),S=Math.min(c,i.rowCount-i.bottomFrozenRowCount-1),R=Math.min(h,i.frozenColCount-1),B=[!_,!C,!v,!0];n.createCellSelectBorder(d,x,R,S,"rowHeader",`${d}${u}${h}${c}`,B)}if(p){const x=Math.max(u,i.frozenRowCount),S=Math.min(c,i.rowCount-i.bottomFrozenRowCount-1),R=Math.max(d,i.colCount-i.rightFrozenColCount),B=[!w,!0,!y,!C];n.createCellSelectBorder(R,x,h,S,"rightFrozen",`${d}${u}${h}${c}`,B)}if(C){const x=Math.max(d,i.frozenColCount),S=Math.max(u,i.frozenRowCount),R=Math.min(h,i.colCount-i.rightFrozenColCount-1),B=Math.min(c,i.rowCount-i.bottomFrozenRowCount-1),A=[!m,!p,!b,!f];n.createCellSelectBorder(x,S,R,B,"body",`${d}${u}${h}${c}`,A)}}function CC(n){n.selectingRangeComponents.forEach((e,t)=>{e.rect.setAttribute("opacity",0)}),n.selectedRangeComponents.forEach((e,t)=>{e.rect.setAttribute("opacity",0)})}function _C(n){n.selectingRangeComponents.forEach((e,t)=>{e.rect.setAttribute("opacity",1)}),n.selectedRangeComponents.forEach((e,t)=>{e.rect.setAttribute("opacity",1)})}function vE(n,e,t,i,r,o,s,l){var a,d,u,h,c,g,f,p;let m=!!(!((a=n.table.options.excelOptions)===null||a===void 0)&&a.fillHandle);if(((d=n.table.stateManager.select.ranges)===null||d===void 0?void 0:d.length)>1)m=!1,n.removeFillHandleFromSelectComponents();else if(((u=n.table.stateManager.select.ranges)===null||u===void 0?void 0:u.length)===1){const M=Math.max(n.table.stateManager.select.ranges[0].start.row,n.table.stateManager.select.ranges[0].end.row),H=Math.max(n.table.stateManager.select.ranges[0].start.col,n.table.stateManager.select.ranges[0].end.col);n.table.isHeader(H,M)&&(m=!1)}!Array.isArray(l)||l[1]!==!1&&l[2]!==!1||(m=!1);const b=Math.min(e,i),C=Math.min(t,r),_=Math.max(e,i),w=Math.max(t,r),y=n.highPerformanceGetCell(b,C).globalAABBBounds,v=n.highPerformanceGetCell(_,w).globalAABBBounds,x=n.table.theme,S=(h=x.selectionStyle)===null||h===void 0?void 0:h.cellBorderColor,R=(c=x.selectionStyle)===null||c===void 0?void 0:c.cellBorderLineWidth,B=Ze({pickable:!1,fill:((g=x.selectionStyle)===null||g===void 0?void 0:g.selectionFillMode)!=="replace"&&((p=(f=x.selectionStyle)===null||f===void 0?void 0:f.cellBgColor)!==null&&p!==void 0?p:"rgba(0, 0, 255,0.1)"),lineWidth:R,stroke:l.map(M=>!!M&&S),x:y.x1-n.tableGroup.attribute.x,y:y.y1-n.tableGroup.attribute.y,width:0,height:0,visible:!0});let A;m&&(A=Ze({pickable:!1,fill:S,stroke:S,x:v.x2-3,y:v.y2-3,width:6,height:6,visible:!0})),n.lastSelectId=s,n.selectingRangeComponents.set(`${b}-${C}-${_}-${w}-${s}`,{rect:B,fillhandle:A,role:o}),n.tableGroup.insertAfter(B,o==="body"?n.bodyGroup:o==="columnHeader"?n.colHeaderGroup:o==="rowHeader"?n.rowHeaderGroup:o==="cornerHeader"?n.cornerHeaderGroup:o==="rightTopCorner"?n.rightTopCornerGroup:o==="rightFrozen"?n.rightFrozenGroup:o==="leftBottomCorner"?n.leftBottomCornerGroup:o==="bottomFrozen"?n.bottomFrozenGroup:n.rightBottomCornerGroup),m&&n.tableGroup.insertAfter(A,o==="body"?n.bodyGroup:o==="columnHeader"?n.colHeaderGroup:o==="rowHeader"?n.rowHeaderGroup:o==="cornerHeader"?n.cornerHeaderGroup:o==="rightTopCorner"?n.rightTopCornerGroup:o==="rightFrozen"?n.rightFrozenGroup:o==="leftBottomCorner"?n.leftBottomCornerGroup:o==="bottomFrozen"?n.bottomFrozenGroup:n.rightBottomCornerGroup)}function wC(n){n.selectingRangeComponents.forEach((e,t)=>{var i;n.selectedRangeComponents.get(t)&&(n.selectingRangeComponents.get(t).rect.delete(),(i=n.selectingRangeComponents.get(t).fillhandle)===null||i===void 0||i.delete()),n.selectedRangeComponents.set(t,e)}),n.selectingRangeComponents=new Map,n.updateNextFrame()}function SE(n){n.selectedRangeComponents.forEach((e,t)=>{var i;t.split("-")[4]===n.lastSelectId&&(e.rect.delete(),(i=e.fillhandle)===null||i===void 0||i.delete(),n.selectedRangeComponents.delete(t))})}function yC(n){n.selectedRangeComponents.forEach((e,t)=>{var i;e.rect.delete(),(i=e.fillhandle)===null||i===void 0||i.delete()}),n.selectedRangeComponents=new Map}function vy(n){n.selectingRangeComponents.forEach((e,t)=>{var i;e.rect.delete(),(i=e.fillhandle)===null||i===void 0||i.delete()}),n.selectingRangeComponents=new Map}function xE(n){n.selectedRangeComponents.forEach((e,t)=>{var i;(i=e.fillhandle)===null||i===void 0||i.delete(),e.fillhandle=void 0})}function RE(n,e,t,i,r){var o,s;const l=i.scenegraph,a=ws(n.map(m=>m.row)).sort((m,b)=>b-m),d=ws(e.map(m=>m.row)).sort((m,b)=>m-b),u=ws(t.map(m=>m.row)).sort((m,b)=>m-b);let h;if(u.length&&(h=ah(u[0]-1,u[u.length-1]+1,l)),d.length){const m=ah(d[0]-1,d[d.length-1]+1,l);h=O(h)?O(m)?Math.min(h,m):h:m}if(a.length){const m=ah(a[0]-1,a[a.length-1]+1,l);h=O(h)?O(m)?Math.min(h,m):h:m}a.forEach(m=>{AE(m,l,r)});const c=i.rowHeightsMap;if(a.forEach(m=>{c.delete(m)}),a.length){ME(l);const m=lh(a[a.length-1]-1,a[0]-a.length+1,l);h=O(h)?O(m)?Math.min(h,m):h:m}let g;if(l.table._clearRowRangeHeightsMap(),d.forEach(m=>{const b=BE(m,l,r);g=g??b,c.insert(m)}),TE(l),d.length){const m=lh(d[0]-1,d[d.length-1]+1,l);h=O(h)?O(m)?Math.min(h,m):h:m}for(let m=0;m<i.colCount;m++)u.forEach(b=>{if(b<i.frozenRowCount){const C=at(l.table,m,b);if(C)for(let _=C.start.col;_<=C.end.col;_++)for(let w=C.start.row;w<=C.end.row;w++)Rn(_,w,l.table,!1);else Rn(m,b,l.table,!1)}else if(b>i.rowCount-1||b<l.table.rowCount-l.table.bottomFrozenRowCount&&(b<l.proxy.rowStart||b>l.proxy.rowEnd))Sy(b,l);else{const C=at(l.table,m,b);if(C)for(let _=C.start.col;_<=C.end.col;_++)for(let w=C.start.row;w<=C.end.row;w++)Rn(_,w,l.table,!1);else Rn(m,b,l.table,!1)}});if(u.length){const m=lh(u[0]-1,u[u.length-1]+1,l);h=O(h)?O(m)?Math.min(h,m):h:m}if(J(g)){for(let m=0;m<Math.max(i.colCount,(o=i.internalProps._oldColCount)!==null&&o!==void 0?o:i.colCount);m++)for(let b=g;b<Math.max(i.rowCount,(s=i.internalProps._oldRowCount)!==null&&s!==void 0?s:i.rowCount);b++){const C=l.highPerformanceGetCell(m,b,!0);C&&(C.needUpdate=!0)}h=O(h)?O(g)?Math.min(h,g):h:g}if(J(h)&&(l.proxy.rowUpdatePos=Math.min(l.proxy.rowUpdatePos,h)),d.length){if(!J(g)){const m=Math.min(...d);l.proxy.rowUpdatePos=Math.min(m,l.proxy.rowUpdatePos)}l.proxy.rowUpdateDirection="down",l.proxy.updateCellGroups(2*l.proxy.screenRowCount),p()}else a.length&&(PE(a[a.length-1],l),l.proxy.updateCellGroups(2*l.proxy.screenRowCount),p());l.proxy.progress();const f=i.getRowsHeight(i.frozenRowCount,i.rowCount-1-i.bottomFrozenRowCount);function p(){if((d==null?void 0:d[(d==null?void 0:d.length)-1])>=i.rowCount-i.bottomFrozenRowCount||(u==null?void 0:u[(u==null?void 0:u.length)-1])>=i.rowCount-i.bottomFrozenRowCount||(a==null?void 0:a[0])>=i.rowCount-i.bottomFrozenRowCount){for(let m=0;m<i.colCount;m++)for(let b=i.rowCount-i.bottomFrozenRowCount;b<i.rowCount;b++){const C=l.highPerformanceGetCell(m,b,!0);C&&(C.needUpdate=!0)}l.proxy.updateBottomFrozenCellGroups()}}l.updateContainerHeight(l.table.frozenRowCount,f-l.bodyGroup.attribute.height)}function AE(n,e,t){const i=e.proxy;if(n>=i.rowStart&&n<=i.rowEnd&&(Sy(n,e),i.rowEnd--,i.currentRow--),!t){i.bodyBottomRow--;const r=Math.min(i.rowLimit,i.bodyBottomRow-i.bodyTopRow+1);i.totalActualBodyRowCount=r,i.totalRow=Math.min(i.table.rowCount-1,i.rowStart+r-1)}}function BE(n,e,t){const i=e.proxy;if(!t){i.bodyBottomRow++;const r=Math.min(i.rowLimit,i.bodyBottomRow-i.bodyTopRow+1);i.totalActualBodyRowCount=r,i.totalRow=i.rowStart+r-1}if(!(n<i.rowStart))return n>i.rowEnd?i.rowEnd-i.rowStart+1<i.rowLimit?(i.rowEnd++,i.currentRow++,vC(n,e),n):void 0:(i.rowEnd-i.rowStart+1<i.rowLimit&&(i.rowEnd++,i.currentRow++,vC(n,e)),n)}function ME(n){function e(t,i){t.row=i;const r=at(n.table,t.col,t.row);r?(t.mergeStartCol=r.start.col,t.mergeEndCol=r.end.col,t.mergeStartRow=r.start.row,t.mergeEndRow=r.end.row):(t.mergeStartCol=void 0,t.mergeEndCol=void 0,t.mergeStartRow=void 0,t.mergeEndRow=void 0)}n.bodyGroup.forEachChildren(t=>{let i=n.bodyRowStart;t==null||t.forEachChildren(r=>{e(r,i),i++})}),n.rowHeaderGroup.forEachChildren(t=>{let i=n.bodyRowStart;t==null||t.forEachChildren(r=>{e(r,i),i++})}),n.rightFrozenGroup.forEachChildren(t=>{let i=n.bodyRowStart;t==null||t.forEachChildren(r=>{e(r,i),i++})}),n.bottomFrozenGroup.forEachChildren(t=>{let i=n.table.rowCount-n.table.bottomFrozenRowCount;t==null||t.forEachChildren(r=>{e(r,i),i++})}),n.leftBottomCornerGroup.forEachChildren(t=>{let i=n.table.rowCount-n.table.bottomFrozenRowCount;t==null||t.forEachChildren(r=>{e(r,i),i++})}),n.rightBottomCornerGroup.forEachChildren(t=>{let i=n.table.rowCount-n.table.bottomFrozenRowCount;t==null||t.forEachChildren(r=>{e(r,i),i++})})}function TE(n){function e(t,i,r){t.row=i,t.setAttribute("y",r);const o=at(n.table,t.col,t.row);o?(t.mergeStartCol=o.start.col,t.mergeEndCol=o.end.col,t.mergeStartRow=o.start.row,t.mergeEndRow=o.end.row):(t.mergeStartCol=void 0,t.mergeEndCol=void 0,t.mergeStartRow=void 0,t.mergeEndRow=void 0)}n.bodyGroup.forEachChildren(t=>{let i=n.bodyRowStart,r=n.getCellGroupY(i);t==null||t.forEachChildren(o=>{e(o,i,r),i++,r+=o.attribute.height})}),n.rowHeaderGroup.forEachChildren(t=>{let i=n.bodyRowStart,r=n.getCellGroupY(i);t==null||t.forEachChildren(o=>{e(o,i,r),i++,r+=o.attribute.height})}),n.rightFrozenGroup.forEachChildren(t=>{let i=n.bodyRowStart,r=n.getCellGroupY(i);t==null||t.forEachChildren(o=>{e(o,i,r),i++,r+=o.attribute.height})}),n.bottomFrozenGroup.forEachChildren(t=>{let i=n.table.rowCount-n.table.bottomFrozenRowCount,r=0;t==null||t.forEachChildren(o=>{e(o,i,r),i++,r+=o.attribute.height})}),n.leftBottomCornerGroup.forEachChildren(t=>{let i=n.table.rowCount-n.table.bottomFrozenRowCount,r=0;t==null||t.forEachChildren(o=>{e(o,i,r),i++,r+=o.attribute.height})}),n.rightBottomCornerGroup.forEachChildren(t=>{let i=n.table.rowCount-n.table.bottomFrozenRowCount,r=0;t==null||t.forEachChildren(o=>{e(o,i,r),i++,r+=o.attribute.height})})}function vC(n,e){for(let t=0;t<e.table.colCount;t++){const i=new Pe({x:0,y:0,width:e.table.getColWidth(t),height:e.table.getRowHeight(n)});if(i.role="cell",i.col=t,i.row=n,i.needUpdate=!0,!i)continue;const r=e.getColGroup(t);if(r)if(r.firstChild&&n<r.firstChild.row)r.insertBefore(i,r.firstChild),r.firstChild.row=r.firstChild.row+1;else if(r.lastChild&&n>r.lastChild.row)r.appendChild(i);else{const o=e.highPerformanceGetCell(t,n,!0);o!==i&&(r.insertBefore(i,o),o&&(o.row=o.row+1),o!==r.lastChild&&r.lastChild&&(r.lastChild.row=r.lastChild.row+1))}}}function Sy(n,e){for(let t=0;t<e.table.colCount;t++){const i=e.getColGroup(t,!1);if(!i)continue;let r;i.forEachChildren(o=>o.row===n&&(r=o,!0)),r&&(i.updateColumnHeight(-r.attribute.height),i.removeChild(r))}}function lh(n,e,t){let i;for(let r=0;r<t.table.colCount;r++){const o=t.table.getCellRange(r,n);let s;o.start.row<=n+1&&o.end.row>=n+1&&(Ed(o,t),s=o.start.row);const l=t.table.getCellRange(r,e);l.start.row<=e+1&&l.end.row>=e+1&&(Ed(l,t),s=l.start.row),O(s)&&(i=O(i)?Math.min(i,s):s)}return i}function ah(n,e,t){let i;for(let r=0;r<t.table.colCount;r++){let o;const s=t.highPerformanceGetCell(r,n);s.mergeStartRow&&s.mergeEndRow&&s.mergeEndRow>n&&(Ed({start:{row:s.mergeStartRow,col:t.table.isAutoRowHeight()?0:s.mergeStartCol},end:{row:s.mergeEndRow,col:t.table.isAutoRowHeight()?t.table.colCount-1:s.mergeEndCol}},t),o=s.mergeStartRow);const l=t.highPerformanceGetCell(r,e);l.mergeStartRow&&l.mergeEndRow&&l.mergeStartRow<e&&(Ed({start:{row:l.mergeStartRow,col:t.table.isAutoRowHeight()?0:l.mergeStartCol},end:{row:l.mergeEndRow,col:t.table.isAutoRowHeight()?t.table.colCount-1:l.mergeEndCol}},t),o=l.mergeStartRow),O(o)&&(i=O(i)?Math.min(i,o):o)}return i}function Ed(n,e){const{start:t,end:i}=n;for(let r=t.col;r<=i.col;r++)for(let o=t.row;o<=i.row;o++){const s=e.highPerformanceGetCell(r,o,!0);s&&(s.needUpdate=!0)}}function PE(n,e){if(e.table.isHasSeriesNumber())for(let t=n;t<=e.table.rowCount-1;t++)Rn(0,t,e.table,!1)}function HE(n){const{internalProps:e}=n;e.bodyDomContainer=document.createElement("div"),e.bodyDomContainer.id="vtable-body-dom-container",e.bodyDomContainer.classList.add("table-component-container"),e.element.appendChild(e.bodyDomContainer),e.headerDomContainer=document.createElement("div"),e.headerDomContainer.id="vtable-header-dom-container",e.headerDomContainer.classList.add("table-component-container"),e.element.appendChild(e.headerDomContainer),e.frozenBodyDomContainer=document.createElement("div"),e.frozenBodyDomContainer.id="vtable-frozen-body-dom-container",e.frozenBodyDomContainer.classList.add("table-component-container"),e.element.appendChild(e.frozenBodyDomContainer),e.frozenHeaderDomContainer=document.createElement("div"),e.frozenHeaderDomContainer.id="vtable-frozen-header-dom-container",e.frozenHeaderDomContainer.classList.add("table-component-container"),e.element.appendChild(e.frozenHeaderDomContainer),e.rightFrozenBodyDomContainer=document.createElement("div"),e.rightFrozenBodyDomContainer.id="vtable-right-frozen-body-dom-container",e.rightFrozenBodyDomContainer.classList.add("table-component-container"),e.element.appendChild(e.rightFrozenBodyDomContainer),e.rightFrozenHeaderDomContainer=document.createElement("div"),e.rightFrozenHeaderDomContainer.id="vtable-right-frozen-header-dom-container",e.rightFrozenHeaderDomContainer.classList.add("table-component-container"),e.element.appendChild(e.rightFrozenHeaderDomContainer),e.frozenBottomDomContainer=document.createElement("div"),e.frozenBottomDomContainer.id="vtable-frozen-bottom-dom-container",e.frozenBottomDomContainer.classList.add("table-component-container"),e.element.appendChild(e.frozenBottomDomContainer),e.bottomDomContainer=document.createElement("div"),e.bottomDomContainer.id="vtable-bottom-dom-container",e.bottomDomContainer.classList.add("table-component-container"),e.element.appendChild(e.bottomDomContainer),e.rightFrozenBottomDomContainer=document.createElement("div"),e.rightFrozenBottomDomContainer.id="vtable-right-frozen-bottom-dom-container",e.rightFrozenBottomDomContainer.classList.add("table-component-container"),e.element.appendChild(e.rightFrozenBottomDomContainer)}function kE(n){const{headerDomContainer:e,bodyDomContainer:t,frozenBodyDomContainer:i,frozenHeaderDomContainer:r,rightFrozenBodyDomContainer:o,rightFrozenHeaderDomContainer:s,bottomDomContainer:l,frozenBottomDomContainer:a,rightFrozenBottomDomContainer:d}=n.internalProps;if(!(e||t||i||r||o||s||l||a||d))return;const u=n.getAllColsWidth(),h=Math.min(u,n.tableNoFrameWidth),c=n.getFrozenColsWidth(),g=n.getRightFrozenColsWidth(),f=c+g,p=Math.min(u-f,h-f),m=n.getAllRowsHeight(),b=Math.min(m,n.tableNoFrameHeight),C=n.getFrozenRowsHeight(),_=n.getBottomFrozenRowsHeight(),w=C+_,y=Math.min(m-w,b-w);n.frozenColCount>0?(e.style.left=`${n.tableX+c}px`,t.style.left=`${n.tableX+c}px`,l.style.left=`${n.tableX+c}px`):n.frozenColCount===0&&(e.style.left=`${n.tableX}px`,t.style.left=`${n.tableX}px`,l.style.left=`${n.tableX}px`),i.style.left=`${n.tableX}px`,r.style.left=`${n.tableX}px`,e.style.width=`${p}px`,e.style.height=`${C}px`,t.style.top=`${n.tableY}px`,t.style.width=`${p}px`,t.style.height=`${y}px`,t.style.top=`${n.tableY+C}px`,i.style.width=`${c}px`,i.style.height=`${y}px`,i.style.top=`${n.tableY+C}px`,r.style.width=`${c}px`,r.style.height=`${C}px`,r.style.top=`${n.tableY}px`,o.style.width=`${g}px`,o.style.height=`${y}px`,o.style.top=`${n.tableY+C}px`,o.style.left=n.tableX+h-g+"px",s.style.width=`${g}px`,s.style.height=`${C}px`,s.style.top=`${n.tableY}px`,s.style.left=n.tableX+h-g+"px",l.style.width=`${p}px`,l.style.height=`${_}px`,l.style.top=n.tableY+b-_+"px",a.style.width=`${c}px`,a.style.height=`${_}px`,a.style.top=n.tableY+b-_+"px",d.style.width=`${g}px`,d.style.height=`${_}px`,d.style.top=n.tableY+b-_+"px",d.style.left=n.tableX+h-g+"px"}function xy(n){if(!n.table.reactCustomLayout)return;const{table:e,stage:t}=n,i=t.pluginService.findPluginsByName("ReactAttributePlugin")[0],{htmlMap:r,renderId:o}=i;for(const s in r){const l=r[s],{graphic:a,wrapContainer:d,renderId:u}=l;if(u!==o)continue;let h;if(n.frozenColCount>e.frozenColCount){const c=Fr(a);if(!c)continue;const{col:g,row:f}=c;f>=e.rowCount-e.bottomFrozenRowCount&&g<n.frozenColCount&&g>=e.frozenColCount&&a.attribute.react.container===e.frozenBottomDomContainer?h=e.bottomDomContainer:f>=e.frozenRowCount&&g<n.frozenColCount&&g>=e.frozenColCount&&a.attribute.react.container===e.frozenBodyDomContainer?h=e.bodyDomContainer:f<e.frozenRowCount&&g<n.frozenColCount&&g>=e.frozenColCount&&a.attribute.react.container===e.frozenHeaderDomContainer&&(h=e.headerDomContainer)}else if(n.frozenColCount<e.frozenColCount){const c=Fr(a);if(!c)continue;const{col:g,row:f}=c;f>=e.rowCount-e.bottomFrozenRowCount&&g<e.frozenColCount&&g>=n.frozenColCount&&a.attribute.react.container===e.bottomDomContainer?h=e.frozenBottomDomContainer:f>=e.frozenRowCount&&g<e.frozenColCount&&g>=n.frozenColCount&&a.attribute.react.container===e.bodyDomContainer?h=e.frozenBodyDomContainer:f<e.frozenRowCount&&g<e.frozenColCount&&g>=n.frozenColCount&&a.attribute.react.container===e.headerDomContainer&&(h=e.frozenHeaderDomContainer)}h&&(h.appendChild(d),l.nativeContainer=h,l.container=h,a.attribute.react.container=h,i.updateStyleOfWrapContainer(a,t,d,h,a.attribute.react))}}function EE(n){var e,t;if(n.table.frozenColCount>n.table.rowHeaderLevelCount){n.rowHeaderGroup.setAttribute("height",n.bodyGroup.attribute.height),n.rowHeaderGroup.setAttribute("y",n.bodyGroup.attribute.y),n.cornerHeaderGroup.setAttribute("height",n.colHeaderGroup.attribute.height);for(let i=0;i<n.table.frozenColCount-n.table.rowHeaderLevelCount;i++)Ry(n),Ay(n),Ty(n)}else if(n.table.frozenColCount<n.table.rowHeaderLevelCount){n.bodyGroup.setAttribute("height",n.rowHeaderGroup.attribute.height),n.bodyGroup.setAttribute("y",n.rowHeaderGroup.attribute.y),n.colHeaderGroup.setAttribute("height",n.cornerHeaderGroup.attribute.height);for(let i=0;i<n.table.rowHeaderLevelCount-n.table.frozenColCount;i++)By(n),My(n),Py(n)}n.bodyGroup.setAttribute("x",n.rowHeaderGroup.attribute.width),n.colHeaderGroup.setAttribute("x",n.cornerHeaderGroup.attribute.width),n.updateContainer(),n.updateBorderSizeAndPosition(),n.isPivot||n.table.transpose?n.table.options.frozenColCount?n.component.setFrozenColumnShadow(n.table.frozenColCount-1):n.table.options.frozenColCount&&n.component.setRightFrozenColumnShadow(n.table.colCount-n.table.rightFrozenColCount):(n.component.setFrozenColumnShadow(n.table.frozenColCount-1),n.component.setRightFrozenColumnShadow(n.table.colCount-n.table.rightFrozenColCount)),n.hasFrozen=!0,n.frozenColCount=n.table.frozenColCount,n.frozenRowCount=(t=(e=n.colHeaderGroup.firstChild)===null||e===void 0?void 0:e.childrenCount)!==null&&t!==void 0?t:0}function LE(n){var e,t,i,r;if(n.frozenColCount>n.table.frozenColCount){n.bodyGroup.setAttribute("height",n.rowHeaderGroup.attribute.height),n.bodyGroup.setAttribute("y",n.rowHeaderGroup.attribute.y),n.colHeaderGroup.setAttribute("height",n.cornerHeaderGroup.attribute.height);for(let o=0;o<n.frozenColCount-n.table.frozenColCount;o++)By(n),My(n),Py(n)}else if(n.frozenColCount<n.table.frozenColCount){n.rowHeaderGroup.setAttribute("height",n.bodyGroup.attribute.height),n.rowHeaderGroup.setAttribute("y",n.bodyGroup.attribute.y),n.cornerHeaderGroup.setAttribute("height",n.colHeaderGroup.attribute.height);for(let o=0;o<n.table.frozenColCount-n.frozenColCount;o++)Ry(n),Ay(n),Ty(n)}xy(n),n.recreateAllSelectRangeComponents(),n.frozenColCount=n.table.frozenColCount,n.frozenRowCount=(t=(e=n.colHeaderGroup.firstChild)===null||e===void 0?void 0:e.childrenCount)!==null&&t!==void 0?t:0,n.proxy.colStart=(r=(i=n.bodyGroup.firstChild)===null||i===void 0?void 0:i.col)!==null&&r!==void 0?r:n.table.frozenColCount,n.bodyGroup.setAttribute("x",n.rowHeaderGroup.attribute.width),n.colHeaderGroup.setAttribute("x",n.cornerHeaderGroup.attribute.width),n.updateContainer(),n.updateBorderSizeAndPosition(),n.isPivot||n.table.transpose?n.table.options.frozenColCount?n.component.setFrozenColumnShadow(n.table.frozenColCount-1):n.table.options.rightFrozenColCount&&n.component.setRightFrozenColumnShadow(n.table.colCount-n.table.rightFrozenColCount):(n.component.setFrozenColumnShadow(n.table.frozenColCount-1),n.component.setRightFrozenColumnShadow(n.table.colCount-n.table.rightFrozenColCount)),n.hasFrozen=!0}function Ry(n){const e=n.bodyGroup.firstChild instanceof Pe?n.bodyGroup.firstChild:null;e&&(n.rowHeaderGroup.appendChild(e),n.rowHeaderGroup.setAttribute("width",n.rowHeaderGroup.attribute.width+e.attribute.width),n.bodyGroup.setAttribute("width",n.bodyGroup.attribute.width-e.attribute.width))}function Ay(n){const e=n.colHeaderGroup.firstChild instanceof Pe?n.colHeaderGroup.firstChild:null;e&&(n.cornerHeaderGroup.appendChild(e),n.cornerHeaderGroup.setAttribute("width",n.cornerHeaderGroup.attribute.width+e.attribute.width),n.colHeaderGroup.setAttribute("width",n.colHeaderGroup.attribute.width-e.attribute.width))}function By(n){var e;const t=n.rowHeaderGroup.lastChild instanceof Pe?n.rowHeaderGroup.lastChild:(e=n.rowHeaderGroup.lastChild)===null||e===void 0?void 0:e._prev;t&&(Tn(n.bodyGroup,t,n.bodyGroup.firstChild),n.bodyGroup.setAttribute("width",n.bodyGroup.attribute.width+t.attribute.width),n.rowHeaderGroup.setAttribute("width",n.rowHeaderGroup.attribute.width-t.attribute.width))}function My(n){var e;const t=n.cornerHeaderGroup.lastChild instanceof Pe?n.cornerHeaderGroup.lastChild:(e=n.cornerHeaderGroup.lastChild)===null||e===void 0?void 0:e._prev;t&&(Tn(n.colHeaderGroup,t,n.colHeaderGroup.firstChild),n.colHeaderGroup.setAttribute("width",n.colHeaderGroup.attribute.width+t.attribute.width),n.cornerHeaderGroup.setAttribute("width",n.cornerHeaderGroup.attribute.width-t.attribute.width))}function Ty(n){const e=n.bottomFrozenGroup.firstChild instanceof Pe?n.bottomFrozenGroup.firstChild:null;e&&(n.leftBottomCornerGroup.appendChild(e),n.leftBottomCornerGroup.setAttribute("width",n.leftBottomCornerGroup.attribute.width+e.attribute.width),n.bottomFrozenGroup.setAttribute("width",n.bottomFrozenGroup.attribute.width-e.attribute.width),n.table.isPivotChart()&&e.forEachChildren(t=>{t.setAttributes({stroke:!1,fill:!1})}))}function Py(n){var e;const t=n.leftBottomCornerGroup.lastChild instanceof Pe?n.leftBottomCornerGroup.lastChild:(e=n.leftBottomCornerGroup.lastChild)===null||e===void 0?void 0:e._prev;t&&(Tn(n.bottomFrozenGroup,t,n.bottomFrozenGroup.firstChild),n.bottomFrozenGroup.setAttribute("width",n.bottomFrozenGroup.attribute.width+t.attribute.width),n.leftBottomCornerGroup.setAttribute("width",n.leftBottomCornerGroup.attribute.width-t.attribute.width),n.table.isPivotChart()&&t.forEachChildren(i=>{var r,o,s,l;const a=n.table._getCellStyle(i.col,i.row),d=n.table.getCellRange(i.col,i.row),u=ir(a,n.table,d?d.start.col:i.col,d?d.start.row:i.row,Z).theme;i.setAttributes({fill:(o=(r=u==null?void 0:u.group)===null||r===void 0?void 0:r.fill)!==null&&o!==void 0?o:void 0,stroke:(l=(s=u==null?void 0:u.group)===null||s===void 0?void 0:s.stroke)!==null&&l!==void 0?l:void 0})}))}function FE(n,e){const{table:t,proxy:i,rightTopCornerGroup:r,rightFrozenGroup:o,rightBottomCornerGroup:s,bottomFrozenGroup:l,bodyGroup:a,colHeaderGroup:d}=e,u=e.table.rightFrozenColCount;if(n>u){for(let c=t.colCount-u-1;c>=t.colCount-n;c--)Tn(o,e.getColGroup(c),o.firstChild),Tn(r,e.getColGroup(c,!0),r.firstChild),Tn(s,e.getColGroupInBottom(c),s.firstChild);let h=0;o.forEachChildren(c=>{c.setAttribute("x",h),h+=c.attribute.width}),h=0,r.forEachChildren(c=>{c.setAttribute("x",h),h+=c.attribute.width}),h=0,s.forEachChildren(c=>{c.setAttribute("x",h),h+=c.attribute.width})}else if(n<u){for(let c=t.colCount-u;c<t.colCount-n;c++){const g=e.getColGroup(c);g.setAttribute("x",a.lastChild.attribute.x+t.getColWidth(a.lastChild.col)),a.appendChild(g);const f=e.getColGroupInRightTopCorner(c);f.setAttribute("x",d.lastChild.attribute.x+t.getColWidth(d.lastChild.col)),d.appendChild(f);const p=e.getColGroupInRightBottomCorner(c);p.setAttribute("x",l.lastChild.attribute.x+t.getColWidth(l.lastChild.col)),l.appendChild(p)}let h=0;o.forEachChildren(c=>{c.setAttribute("x",h),h+=c.attribute.width}),h=0,r.forEachChildren(c=>{c.setAttribute("x",h),h+=c.attribute.width}),h=0,s.forEachChildren(c=>{c.setAttribute("x",h),h+=c.attribute.width})}o.setAttribute("width",t.getColsWidth(t.colCount-n,t.colCount-1)),r.setAttribute("width",t.getColsWidth(t.colCount-n,t.colCount-1)),s.setAttribute("width",t.getColsWidth(t.colCount-n,t.colCount-1)),t.internalProps.rightFrozenColCount=n,e.updateContainer(),e.component.updateScrollBar(),e.updateNextFrame()}function zE(n,e){const{table:t,proxy:i,bottomFrozenGroup:r,leftBottomCornerGroup:o,rightBottomCornerGroup:s}=e;r.childrenCount||(i.table.isPivotChart()||(_t(o,0,0,0,t.frozenColCount-1,0,-1,"rowHeader",t),_t(s,0,0,t.colCount-t.rightFrozenColCount,t.colCount-1,0,-1,"body",t)),_t(r,0,0,i.colStart,i.colEnd,0,-1,"body",t));const l=e.table.bottomFrozenRowCount;if(n>l){for(let a=0;a<t.frozenColCount;a++){const d=e.getColGroupInLeftBottomCorner(a);for(let h=t.rowCount-l-1;h>=t.rowCount-n;h--)Tn(d,e.getCell(a,h,!0),d.firstChild);let u=0;d.forEachChildren(h=>{h.setAttribute("y",u),u+=t.getRowHeight(h.row)})}for(let a=i.colStart;a<=i.colEnd;a++){const d=e.getColGroupInBottom(a);for(let h=t.rowCount-l-1;h>=t.rowCount-n;h--)Tn(d,e.getCell(a,h,!0),d.firstChild);let u=0;d.forEachChildren(h=>{h.setAttribute("y",u),u+=t.getRowHeight(h.row)})}if(t.rightFrozenColCount>0)for(let a=t.colCount-t.rightFrozenColCount;a<t.colCount;a++){const d=e.getColGroupInRightBottomCorner(a);for(let h=t.rowCount-l-1;h>=t.rowCount-n;h--)Tn(d,e.getCell(a,h,!0),d.firstChild);let u=0;d.forEachChildren(h=>{h.setAttribute("y",u),u+=t.getRowHeight(h.row)})}}else if(n<l){for(let a=0;a<t.rowHeaderLevelCount;a++){const d=e.getColGroup(a);for(let c=t.rowCount-l;c<t.rowCount-n;c++){const g=e.getCell(a,c,!0);g.setAttribute("y",d.lastChild.attribute.y+t.getRowHeight(d.lastChild.row)),d.appendChild(g)}const u=e.getColGroupInLeftBottomCorner(a);let h=0;u.forEachChildren(c=>{c.setAttribute("y",h),h+=t.getRowHeight(c.row)})}for(let a=i.colStart;a<=i.colEnd;a++){const d=e.getColGroup(a);for(let c=t.rowCount-l;c<t.rowCount-n;c++){const g=e.getCell(a,c,!0);g.setAttribute("y",d.lastChild.attribute.y+t.getRowHeight(d.lastChild.row)),d.appendChild(g)}const u=e.getColGroupInBottom(a);let h=0;u.forEachChildren(c=>{c.setAttribute("y",h),h+=t.getRowHeight(c.row)})}if(t.rightFrozenColCount>0)for(let a=t.colCount-t.rightFrozenColCount;a<t.colCount;a++){const d=e.getColGroup(a);for(let c=t.rowCount-l;c<t.rowCount-n;c++){const g=e.getCell(a,c,!0);g.setAttribute("y",d.lastChild.attribute.y+t.getRowHeight(d.lastChild.row)),d.appendChild(g)}const u=e.getColGroupInRightBottomCorner(a);let h=0;u.forEachChildren(c=>{c.setAttribute("y",h),h+=t.getRowHeight(c.row)})}}r.setAttribute("height",t.getRowsHeight(t.rowCount-n,t.rowCount-1)),o.setAttribute("height",t.getRowsHeight(t.rowCount-n,t.rowCount-1)),s.setAttribute("height",t.getRowsHeight(t.rowCount-n,t.rowCount-1)),t.internalProps.bottomFrozenRowCount=n,e.updateContainer(),e.component.updateScrollBar(),e.updateNextFrame()}function Tn(n,e,t){e&&n&&(t?n.insertBefore(e,t):n.appendChild(e))}function IE(n){var e,t,i,r,o;if(n.frozenRowCount>n.table.frozenRowCount){n.bodyGroup.setAttribute("width",n.colHeaderGroup.attribute.width),n.bodyGroup.setAttribute("x",n.colHeaderGroup.attribute.x),n.rowHeaderGroup.setAttribute("width",n.cornerHeaderGroup.attribute.width);for(let s=0;s<n.frozenRowCount-n.table.frozenRowCount;s++)NE(n),VE(n),GE(n)}else if(n.frozenRowCount<n.table.frozenRowCount){n.colHeaderGroup.setAttribute("width",n.bodyGroup.attribute.width),n.colHeaderGroup.setAttribute("x",n.bodyGroup.attribute.x),n.cornerHeaderGroup.setAttribute("width",n.rowHeaderGroup.attribute.width);for(let s=0;s<n.table.frozenRowCount-n.frozenRowCount;s++)OE(n),DE(n),WE(n)}xy(n),n.recreateAllSelectRangeComponents(),n.frozenRowCount=n.table.frozenRowCount,n.frozenColCount=(t=(e=n.rowHeaderGroup)===null||e===void 0?void 0:e.childrenCount)!==null&&t!==void 0?t:0,n.proxy.rowStart=(o=(r=(i=n.bodyGroup.firstChild)===null||i===void 0?void 0:i.firstChild)===null||r===void 0?void 0:r.row)!==null&&o!==void 0?o:n.table.frozenRowCount,n.bodyGroup.setAttribute("y",n.colHeaderGroup.attribute.height),n.rowHeaderGroup.setAttribute("y",n.cornerHeaderGroup.attribute.height),n.updateContainer(),n.updateBorderSizeAndPosition(),n.hasFrozen=!0}function OE(n){var e;let t=!1;for(let i=0;i<n.bodyGroup.childrenCount;i++){const r=n.bodyGroup.children[i].firstChild;(e=n.colHeaderGroup.children[i])===null||e===void 0||e.appendChild(r),t||(n.colHeaderGroup.setAttribute("height",n.colHeaderGroup.attribute.height+r.attribute.height),n.bodyGroup.setAttribute("height",n.bodyGroup.attribute.height-r.attribute.height),t=!0)}}function DE(n){var e;let t=!1;for(let i=0;i<n.rowHeaderGroup.childrenCount;i++){const r=n.rowHeaderGroup.children[i].firstChild;(e=n.cornerHeaderGroup.children[i])===null||e===void 0||e.appendChild(r),t||(n.cornerHeaderGroup.setAttribute("height",n.cornerHeaderGroup.attribute.height+r.attribute.height),n.rowHeaderGroup.setAttribute("height",n.rowHeaderGroup.attribute.height-r.attribute.height),t=!0)}}function WE(n){var e;let t=!1;for(let i=0;i<n.rightFrozenGroup.childrenCount;i++){const r=n.rightFrozenGroup.children[i].firstChild;(e=n.rightTopCornerGroup.children[i])===null||e===void 0||e.appendChild(r),t||(n.rightTopCornerGroup.setAttribute("height",n.rightTopCornerGroup.attribute.height+r.attribute.height),n.rightFrozenGroup.setAttribute("height",n.rightFrozenGroup.attribute.height-r.attribute.height),t=!0)}}function NE(n){let e=!1;for(let t=0;t<n.colHeaderGroup.childrenCount;t++){const i=n.colHeaderGroup.children[t].lastChild;Tn(n.bodyGroup.children[t],i,n.bodyGroup.children[t].firstChild),e||(n.colHeaderGroup.setAttribute("height",n.colHeaderGroup.attribute.height-i.attribute.height),n.bodyGroup.setAttribute("height",n.bodyGroup.attribute.height+i.attribute.height),e=!0)}}function VE(n){let e=!1;for(let t=0;t<n.cornerHeaderGroup.childrenCount;t++){const i=n.cornerHeaderGroup.children[t].lastChild;Tn(n.rowHeaderGroup.children[t],i,n.rowHeaderGroup.children[t].firstChild),e||(n.cornerHeaderGroup.setAttribute("height",n.cornerHeaderGroup.attribute.height-i.attribute.height),n.rowHeaderGroup.setAttribute("height",n.rowHeaderGroup.attribute.height+i.attribute.height),e=!0)}}function GE(n){let e=!1;for(let t=0;t<n.rightTopCornerGroup.childrenCount;t++){const i=n.rightTopCornerGroup.children[t].lastChild;Tn(n.rightFrozenGroup.children[t],i,n.rightFrozenGroup.children[t].firstChild),e||(n.rightTopCornerGroup.setAttribute("height",n.rightTopCornerGroup.attribute.height-i.attribute.height),n.rightFrozenGroup.setAttribute("height",n.rightFrozenGroup.attribute.height+i.attribute.height),e=!0)}}function jE(n,e){const{table:t}=n,i=t.internalProps.layoutMap,r=e===-1?"all":t.internalProps.columnResizeType;if(r==="column"){const o=n.getColGroup(e),s=n.getColGroup(e,!0),l=n.getColGroupInBottom(e,!0);if(o==null||o.forEachChildren(a=>{wn(a,t.getColWidth(a.col),t.getRowHeight(a.row))}),s==null||s.forEachChildren(a=>{wn(a,t.getColWidth(a.col),t.getRowHeight(a.row))}),l==null||l.forEachChildren(a=>{wn(a,t.getColWidth(a.col),t.getRowHeight(a.row))}),t.widthMode==="adaptive"&&e<t.colCount-1){const a=n.getColGroup(e+1),d=n.getColGroup(e+1,!0),u=n.getColGroupInBottom(e+1,!0);a==null||a.forEachChildren(h=>{wn(h,t.getColWidth(h.col),t.getRowHeight(h.row))}),d==null||d.forEachChildren(h=>{wn(h,t.getColWidth(h.col),t.getRowHeight(h.row))}),u==null||u.forEachChildren(h=>{wn(h,t.getColWidth(h.col),t.getRowHeight(h.row))})}}else{let o,s,l,a=t.rowHeaderLevelCount,d=t.colCount-1;if(r==="indicator")if(i.indicatorsAsCol)o=i.getIndicatorKey(e,t.columnHeaderLevelCount);else{const u=i.getCellHeaderPaths(e,t.columnHeaderLevelCount-1),h=u.colHeaderPaths[u.colHeaderPaths.length-1];s=h.dimensionKey,l=h.value}else if(r==="indicatorGroup"){const u=t.internalProps.layoutMap,h=u.getCellHeaderPaths(t.stateManager.columnResize.col,t.columnHeaderLevelCount),c=u.getHeadNodeByRowOrColDimensions(h.colHeaderPaths.slice(0,h.colHeaderPaths.length-1));a=c.startInTotal+t.frozenColCount,d=c.startInTotal+t.frozenColCount+c.size-1}for(let u=a;u<=d;u++){const h=n.getColGroup(u),c=n.getColGroup(u,!0),g=n.getColGroupInBottom(u,!0);if(h){if(r==="indicator"){const f=i.getIndicatorKey(u,t.columnHeaderLevelCount);if(i.indicatorsAsCol&&f!==o)continue;if(!i.indicatorsAsCol){const p=i.getCellHeaderPaths(u,t.columnHeaderLevelCount-1),m=p==null?void 0:p.colHeaderPaths[p.colHeaderPaths.length-1];if(!m||s!==m.dimensionKey||l!==m.value)continue}}h.forEachChildren(f=>{wn(f,t.getColWidth(f.col),t.getRowHeight(f.row))}),c==null||c.forEachChildren(f=>{wn(f,t.getColWidth(f.col),t.getRowHeight(f.row))}),g==null||g.forEachChildren(f=>{wn(f,t.getColWidth(f.col),t.getRowHeight(f.row))})}}}}function UE(n,e){var t;const{table:i}=n,r=i.internalProps.layoutMap,o=i.stateManager,s=e===-1?"all":i.internalProps.rowResizeType;let l,a,d,u=i.columnHeaderLevelCount,h=i.rowCount-1;if(s==="indicator")if(r.indicatorsAsCol){const g=r.getCellHeaderPaths(i.rowHeaderLevelCount-1,e),f=(t=g.rowHeaderPaths)===null||t===void 0?void 0:t[g.rowHeaderPaths.length-1];a=f==null?void 0:f.dimensionKey,d=f==null?void 0:f.value}else l=r.getIndicatorKey(i.rowHeaderLevelCount,e);else if(s==="indicatorGroup"){const g=i.internalProps.layoutMap,f=g.getCellHeaderPaths(i.rowHeaderLevelCount,e),p=g.getHeadNodeByRowOrColDimensions(f.rowHeaderPaths.slice(0,f.rowHeaderPaths.length-1));u=p.startInTotal+i.frozenRowCount,h=p.startInTotal+i.frozenRowCount+p.size-1}const c=[{startCol:n.proxy.colStart,endCol:n.proxy.colEnd}];i.frozenColCount&&c.push({startCol:0,endCol:i.frozenColCount-1}),i.rightFrozenColCount&&c.push({startCol:i.colCount-i.rightFrozenColCount,endCol:i.colCount-1}),c.forEach(({startCol:g,endCol:f})=>{for(let p=g;p<=f;p++)if(s==="row"){const m=n.highPerformanceGetCell(p,e);if(m.role!=="cell")continue;if(wn(m,i.getColWidth(m.col),i.getRowHeight(m.row)),i.heightMode==="adaptive"&&e<i.rowCount-1){const b=n.highPerformanceGetCell(p,e+1);wn(b,i.getColWidth(b.col),i.getRowHeight(b.row))}}else for(let m=u;m<=h;m++){if(s==="indicator"){const C=r.getIndicatorKey(o.table.rowHeaderLevelCount,m);if(!r.indicatorsAsCol&&C!==l)continue;if(r.indicatorsAsCol){const _=r.getCellHeaderPaths(o.table.rowHeaderLevelCount-1,m),w=_==null?void 0:_.rowHeaderPaths[_.rowHeaderPaths.length-1];if(!w||a!==w.dimensionKey||d!==w.value)continue}}const b=n.highPerformanceGetCell(p,m);b.role==="cell"&&wn(b,i.getColWidth(b.col),i.getRowHeight(b.row))}})}function af(n){var e;for(let t=n.proxy.colStart;t<=n.proxy.colEnd;t++){const i=n.getColGroup(t);(e=i==null?void 0:i.getChildren())===null||e===void 0||e.forEach(r=>{r.children.forEach(o=>{o.type==="chart"&&(o.cacheCanvas=null,o.addUpdateBoundTag())})})}}function MO(n,e,t){t.getCell(n,e).children.forEach(i=>{i.type==="chart"&&(i.cacheCanvas=null,i.addUpdateBoundTag())})}function TO(n){var e;const t=n.table;for(let i=n.proxy.colStart;i<=n.proxy.colEnd;i++){const r=n.getColGroup(i);(e=r==null?void 0:r.getChildren())===null||e===void 0||e.forEach(o=>{const s=o.col,l=o.row;o.children.forEach(a=>{if(a.type==="chart"){a.updateData(t.getCellValue(s,l));const d=a.attribute.spec,u=d.type;if(u!=="gauge"&&u!=="rose"&&u!=="radar"){const h=t.internalProps.layoutMap.getChartAxes(s,l);a.setAttribute("axes",h),d.axes=h}a.setAttribute("spec",d)}})})}$l(n.rowHeaderGroup,n.table),$l(n.colHeaderGroup,n.table),$l(n.rightFrozenGroup,n.table),$l(n.bottomFrozenGroup,n.table)}function $E(n,e){const t=n.table;if(t.isPivotChart()){const i=t._selectedDataItemsInChart.length;if((e===null||(e==null?void 0:e.length)===0||Object.keys(e).length===0)&&i===0)return;const r=[];if(Array.isArray(e))e.forEach(o=>{if(o&&o.key!==0&&Object.keys(o).length>0){const s={};for(const l in o)l.startsWith("VGRAMMAR_")||l.startsWith("__VCHART")||(s[l]=o[l]);r.push(s)}});else if(e&&e.key!==0&&Object.keys(e).length>0){const o={};for(const s in e)s.startsWith("VGRAMMAR_")||s.startsWith("__VCHART")||(o[s]=e[s]);r.push(o)}Cf(t._selectedDataItemsInChart,r)||(t._selectedDataItemsInChart=r,t.internalProps.layoutMap.updateDataStateToChartInstance(),af(n),t.scenegraph.updateNextFrame())}}function $l(n,e){n.forEachChildren(t=>{t.role==="column"&&t.forEachChildren(i=>{var r;if(i.role==="cell"){let o=!1;if(i.forEachChildren(s=>s.name==="axis"&&(o=!0,!0)),o){const s=e.internalProps.layoutMap.getAxisConfigInPivotChart(i.col,i.row),l=e._getCellStyle(i.col,i.row),a=xe(Z("padding",l,i.col,i.row,e)),d=new(ue.getComponent("axis"))(s,i.attribute.width,i.attribute.height,(r=s.__vtablePadding)!==null&&r!==void 0?r:a,e);i.clear(),i.appendChild(d.component),d.overlap()}}})})}function wn(n,e,t){n.forEachChildren(i=>{i.type==="chart"&&(i.cacheCanvas=null,i.setAttributes({width:Math.ceil(e-i.attribute.cellPadding[3]-i.attribute.cellPadding[1]),height:Math.ceil(t-i.attribute.cellPadding[0]-i.attribute.cellPadding[2])}))})}function KE(n){const e=n.table.tableNoFrameWidth,t=n.table.tableNoFrameHeight;n.tableGroup=new Pe({x:0,y:0,width:e,height:t,clip:!0,pickable:!1}),n.tableGroup.role="table";const i=qn(0,0,!n.table.options.enableTreeStickCell);i.role="col-header",n.colHeaderGroup=i;const r=qn(0,0,!n.table.options.enableTreeStickCell);r.role="corner-header",n.cornerHeaderGroup=r;const o=qn(0,0,!0);o.role="row-header",n.rowHeaderGroup=o;const s=qn(e,0,!0);s.role="body",n.bodyGroup=s;const l=qn(0,0,!0);l.role="right-frozen",n.rightFrozenGroup=l;const a=qn(0,0,!0);a.role="bottom-frozen",n.bottomFrozenGroup=a;const d=qn(0,0);d.role="component",n.componentGroup=d;const u=qn(0,0,!0);u.role="corner-right-top-header",n.rightTopCornerGroup=u;const h=qn(0,0,!0);h.role="corner-right-bottom-header",n.rightBottomCornerGroup=h;const c=qn(0,0,!0);c.role="corner-left-bottom-header",n.leftBottomCornerGroup=c,n.tableGroup.addChild(s),n.tableGroup.addChild(o),n.tableGroup.addChild(a),n.tableGroup.addChild(i),n.tableGroup.addChild(l),n.tableGroup.addChild(h),n.tableGroup.addChild(u),n.tableGroup.addChild(c),n.tableGroup.addChild(r),n.tableGroup.addChild(d)}function qn(n,e,t){return new Pe({x:0,y:0,width:n,height:e,clip:t!=null&&t,pickable:!1})}function gi(n,e){return n.forEachChildrenSkipChild((t,i)=>{t.setAttribute("x",e),e+=t.attribute.width}),e}function YE(n,e,t){n!==-1&&e!==-1&&($n(n,e,i=>i.attribute.visibleTime==="mouseenter_cell",i=>{i.setAttribute("opacity",0);const r=i.parent.getChildByName("icon-back");r&&r.setAttribute("visible",!1)},t),t.updateNextFrame())}function XE(n,e,t){n!==-1&&e!==-1&&($n(n,e,i=>i.attribute.visibleTime==="mouseenter_cell",i=>{i.setAttribute("opacity",1)},t),t.updateNextFrame())}function qE(n,e,t){n!==-1&&e!==-1&&($n(n,e,i=>i.attribute.visibleTime==="click_cell",i=>{i.setAttribute("opacity",0)},t),t.updateNextFrame())}function ZE(n,e,t){n!==-1&&e!==-1&&($n(n,e,i=>i.attribute.visibleTime==="click_cell",i=>{i.setAttribute("opacity",1)},t),t.updateNextFrame())}function JE(n,e,t,i,r){let o;return r.getCell(n,e).forEachChildren(s=>{s.role&&s.role.startsWith("icon")&&s.containsPoint(t,i,Ts.GLOBAL)&&(o=s)}),o}function QE(n,e,t,i,r){var o,s;if((n.attribute.backgroundColor||n.attribute.hoverImage)&&$n(e,t,l=>l.name===n.name,l=>{var a,d,u,h,c,g,f,p;if(l.attribute.backgroundColor){let m=l.parent.getChildByName("icon-back");m?m.setAttributes({x:((a=l.attribute.x)!==null&&a!==void 0?a:0)+(l.AABBBounds.width()-l.backgroundWidth)/2,y:((d=l.attribute.y)!==null&&d!==void 0?d:0)+(l.AABBBounds.height()-l.backgroundHeight)/2,dx:(u=l.attribute.dx)!==null&&u!==void 0?u:0,dy:(h=l.attribute.dy)!==null&&h!==void 0?h:0,width:l.backgroundWidth,height:l.backgroundHeight,fill:l.attribute.backgroundColor,cornerRadius:5,visible:!0}):(m=Ze({x:((c=l.attribute.x)!==null&&c!==void 0?c:0)+(l.AABBBounds.width()-l.backgroundWidth)/2,y:((g=l.attribute.y)!==null&&g!==void 0?g:0)+(l.AABBBounds.height()-l.backgroundHeight)/2,dx:(f=l.attribute.dx)!==null&&f!==void 0?f:0,dy:(p=l.attribute.dy)!==null&&p!==void 0?p:0,width:l.backgroundWidth,height:l.backgroundHeight,fill:l.attribute.backgroundColor,cornerRadius:5,pickable:!1,visible:!0}),m.name="icon-back"),l.parent.insertBefore(m,l)}l.attribute.hoverImage&&l.attribute.image!==l.attribute.hoverImage&&(l.image=l.attribute.hoverImage)},r),n.tooltip){const{x1:l,x2:a,y1:d,y2:u}=n.globalAABBBounds,h={content:n.tooltip.title,referencePosition:{rect:{left:l,right:a,top:d,bottom:u,width:n.globalAABBBounds.width(),height:n.globalAABBBounds.height()},placement:n.tooltip.placement},disappearDelay:n.tooltip.disappearDelay,style:Object.assign({},(o=r.table.internalProps.theme)===null||o===void 0?void 0:o.tooltipStyle,(s=n.tooltip)===null||s===void 0?void 0:s.style)};r.table.internalProps.tooltipHandler.isBinded(h)||r.table.showTooltip(e,t,h)}}function eL(n,e,t,i){(n.attribute.backgroundColor||n.attribute.hoverImage)&&$n(e,t,r=>r.name===n.name,r=>{const o=r.parent.getChildByName("icon-back");o&&o.setAttribute("visible",!1),r.attribute.hoverImage&&r.attribute.image!==r.attribute.originImage&&(r.image=r.attribute.originImage)},i)}function SC(n,e,t,i,r){const o=n.name;$n(t,i,s=>s.name===o,s=>{xn(e,s),s.name=e.name},r),r.updateNextFrame()}function tL(n,e,t,i){const r=i.getCell(n,e);if(O(r.mergeStartCol)&&O(r.mergeStartRow)&&O(r.mergeEndCol)&&O(r.mergeEndRow))for(let o=r.mergeStartCol;o<=r.mergeEndCol;o++)for(let s=r.mergeStartRow;s<=r.mergeEndRow;s++){let l;i.getCell(o,s).forEachChildren(a=>a.attribute.funcType==="sort"&&(l=a,!0)),l&&(xn(t,l),l.name=t.name)}else{let o;qf(r,"children",s=>s.attribute.funcType==="sort"&&(o=s,!0)),o&&(xn(t,o),o.name=t.name)}}function nL(n,e,t,i,r){const o=r.getCellRange(n,e),s=r.getCellRange(t,i);return o.start.col===s.start.col&&o.start.row===s.start.row&&o.end.col===s.end.col&&o.end.row===s.end.row}function iL(n){const{col:e,row:t,iconMark:i,order:r,oldSortCol:o,oldSortRow:s,oldIconMark:l,scene:a}=n,d=a.table.internalProps.headerHelper.getSortIcon(r,a.table,e,t);if(i&&SC(i,d,e,t,a),!nL(e,t,o,s,a.table)){const u=a.table.internalProps.headerHelper.getSortIcon("normal",a.table,o,s);l?SC(l,u,o,s,a):tL(o,s,u,a)}}function rL(n){for(let e=0;e<n.table.colCount;e++)for(let t=0;t<n.table.columnHeaderLevelCount;t++)$n(e,t,i=>i.attribute.funcType==="frozen",i=>{const r=n.table.internalProps.headerHelper.getFrozenIcon(e,t);xn(r,i),i.name=r.name},n)}function oL(n,e,t){let i;i=t.table.isHeader(n,e)?t.table.internalProps.headerHelper.getHierarchyIcon(n,e):t.table.internalProps.bodyHelper.getHierarchyIcon(n,e),$n(n,e,r=>r.attribute.funcType===Oe.collapse||r.attribute.funcType===Oe.expand,r=>{xn(i,r),r.name=i.name},t)}function df(n,e,t){n&&n.role!=="empty"&&n.forEachChildren(i=>{i.type==="group"?df(i,e,t):e(i)&&t(i)})}function $n(n,e,t,i,r){const o=r.getCell(n,e);if(o.role==="cell"&&O(o.mergeStartCol)&&O(o.mergeStartRow)&&O(o.mergeEndCol)&&O(o.mergeEndRow)){const{colStart:s,colEnd:l,rowStart:a,rowEnd:d}=rr(o,r);for(let u=s;u<=l;u++)for(let h=a;h<=d;h++)df(r.highPerformanceGetCell(u,h),t,i)}else df(o,t,i)}function sL(n,e,t){$n(n,e,i=>i.attribute.funcType===Oe.dropDown,i=>{i.oldVisibleTime=i.attribute.visibleTime,i.setAttribute("visibleTime","always"),i.setAttribute("opacity",1)},t)}function lL(n,e,t){$n(n,e,i=>i.attribute.funcType===Oe.dropDown,i=>{i.oldVisibleTime&&i.setAttribute("visibleTime",i.oldVisibleTime),i.setAttribute("opacity",i.attribute.visibleTime==="always"?1:0)},t)}function dh(n,e){const{bgColor:t,borderColor:i,borderLineWidth:r,borderLineDash:o}=e,s={x:0,y:0,width:0,height:0,visible:!1,pickable:!0,fill:t};return s.stroke=tg(i,void 0),s.lineWidth=r,o&&(s.lineDash=o),s.lineCap="butt",Array.isArray(i)&&(s.strokeArrayColor=xe(i)),Array.isArray(r)&&(s.strokeArrayWidth=xe(r),s.lineWidth=1),n.setAttributes(s),n.role="corner-frozen",n}function aL(n,e,t,i){var r,o;const s=i.scenegraph,l=uh(n.map(f=>f.col)).sort((f,p)=>p-f),a=uh(e.map(f=>f.col)).sort((f,p)=>f-p),d=uh(t.map(f=>f.col)).sort((f,p)=>f-p);l.forEach(f=>{dL(f,s)});const u=i.colWidthsMap;let h;if(l.forEach(f=>{u.delAndReorder(f)}),l.length&&xC(s),s.table._clearColRangeWidthsMap(),a.forEach(f=>{const p=uL(f,s);xC(s),h=h??p,u.addAndReorder(f)}),hL(s),d.forEach(f=>{for(let p=0;p<i.rowCount;p++){const m=at(s.table,f,p);if(m)for(let b=m.start.col;b<=m.end.col;b++)for(let C=m.start.col;C<=m.end.col;C++)Rn(C,p,s.table,!1);else Rn(f,p,s.table,!1)}}),J(h)){for(let f=h;f<Math.max(i.colCount,(r=i.internalProps._oldColCount)!==null&&r!==void 0?r:i.colCount);f++)for(let p=0;p<Math.max(i.rowCount,(o=i.internalProps._oldRowCount)!==null&&o!==void 0?o:i.rowCount);p++){const m=s.highPerformanceGetCell(f,p,!0);m&&(m.needUpdate=!0)}s.proxy.colUpdatePos=h}if(a.length){if(!J(h)){const f=Math.min(...a);s.proxy.colUpdatePos=f}s.proxy.colUpdateDirection="left",s.proxy.updateColGroups(2*s.proxy.screenColCount),g(),s.proxy.progress()}else l.length&&(s.proxy.updateColGroups(2*s.proxy.screenColCount),g(),s.proxy.progress());const c=i.getColsWidth(i.frozenColCount,i.colCount-1);function g(){if((a==null?void 0:a[(a==null?void 0:a.length)-1])>=i.colCount-i.rightFrozenColCount||(d==null?void 0:d[(d==null?void 0:d.length)-1])>=i.colCount-i.rightFrozenColCount||(l==null?void 0:l[0])>=i.colCount-i.rightFrozenColCount){for(let f=i.colCount-i.rightFrozenColCount;f<i.colCount;f++)for(let p=0;p<i.rowCount;p++){const m=s.highPerformanceGetCell(f,p,!0);m&&(m.needUpdate=!0)}s.proxy.updateRightFrozenCellGroups()}}s.updateContainerWidth(s.table.frozenColCount,c-s.bodyGroup.attribute.width)}function dL(n,e){const t=e.proxy;if(n>=e.table.rowHeaderLevelCount&&!(n>=e.table.colCount-e.table.rightFrozenColCount)){const r=e.getColGroup(n,!1);r&&r.parent===e.bodyGroup&&e.bodyGroup.removeChild(r);const o=e.getColGroupInBottom(n);o&&o.parent===e.bottomFrozenGroup&&e.bottomFrozenGroup.removeChild(o);const s=e.getColGroup(n,!0);s&&s.parent===e.colHeaderGroup&&e.colHeaderGroup.removeChild(s)}n>=t.colStart&&n<=t.colEnd&&(t.colEnd--,t.currentCol--),t.bodyRightCol--;const i=Math.min(t.colLimit,t.bodyRightCol-t.bodyLeftCol+1);t.totalActualBodyColCount=i,t.totalCol=t.colStart+i-1}function uL(n,e){const t=e.proxy;t.bodyRightCol++;const i=Math.min(t.colLimit,t.bodyRightCol-t.bodyLeftCol+1);if(t.totalActualBodyColCount=i,t.totalCol=t.colStart+i-1,!(n<t.colStart))return n>t.colEnd?t.colEnd-t.colStart+1<t.colLimit?(t.colEnd++,t.currentCol++,RC(n,e),n):void 0:(t.colEnd-t.colStart+1<t.colLimit&&(t.colEnd++,t.currentCol++,RC(n,e)),n)}function uh(n){const e=[];for(let t=0;t<n.length;t++)e.indexOf(n[t])===-1&&e.push(n[t]);return e}function xC(n){let e=n.bodyColStart;function t(i){i.col=e;const r=at(n.table,i.col,i.row);r&&(i.mergeStartCol=r.start.col,i.mergeStartCol=r.start.col,i.mergeEndCol=r.end.col,i.mergeEndCol=r.end.col),i.role}n.bodyGroup.forEachChildren(i=>{i.col=e,i==null||i.forEachChildren(r=>{t(r)}),e++}),e=n.bodyColStart,n.colHeaderGroup.forEachChildren(i=>{i.col=e,i==null||i.forEachChildren(r=>{t(r)}),e++}),e=n.bodyColStart,n.bottomFrozenGroup.forEachChildren(i=>{i.col=e,i==null||i.forEachChildren(r=>{t(r)}),e++})}function hL(n){let e=n.bodyColStart,t=n.getCellGroupX(e);function i(r){r.col=e;const o=at(n.table,r.col,r.row);o&&(r.mergeStartCol=o.start.col,r.mergeStartCol=o.start.col,r.mergeEndCol=o.end.col,r.mergeEndCol=o.end.col),r.role}n.bodyGroup.forEachChildren(r=>{r.col=e,r==null||r.forEachChildren(o=>{i(o)}),r.setAttribute("x",t),t+=r.attribute.width,e++}),e=n.bodyColStart,t=n.getCellGroupX(e),n.colHeaderGroup.forEachChildren(r=>{r.col=e,r==null||r.forEachChildren(o=>{i(o)}),r.setAttribute("x",t),t+=r.attribute.width,e++}),e=n.bodyColStart,t=n.getCellGroupX(e),n.bottomFrozenGroup.forEachChildren(r=>{r.col=e,r==null||r.forEachChildren(o=>{i(o)}),r.setAttribute("x",t),t+=r.attribute.width,e++}),e=n.table.colCount-n.table.rightFrozenColCount,t=0,n.rightFrozenGroup.forEachChildren(r=>{r.col=e,r==null||r.forEachChildren(o=>{i(o)}),r.setAttribute("x",t),t+=r.attribute.width,e++}),e=n.table.colCount-n.table.rightFrozenColCount,t=0,n.rightTopCornerGroup.forEachChildren(r=>{r.col=e,r==null||r.forEachChildren(o=>{i(o)}),r.setAttribute("x",t),t+=r.attribute.width,e++}),e=n.table.colCount-n.table.rightFrozenColCount,t=0,n.rightBottomCornerGroup.forEachChildren(r=>{r.col=e,r==null||r.forEachChildren(o=>{i(o)}),r.setAttribute("x",t),t+=r.attribute.width,e++})}function RC(n,e){if(e.colHeaderGroup&&e.table.columnHeaderLevelCount>0){const i=new Pe({x:0,y:0,width:e.table.getColWidth(n),height:0,clip:!1,pickable:!1});i.role="column",i.col=n;const r=e.getColGroup(n,!0);r?e.colHeaderGroup.insertBefore(i,r):e.colHeaderGroup.appendChild(i),t(i,n,0,e.table.columnHeaderLevelCount-1)}if(e.bodyGroup){const i=new Pe({x:0,y:0,width:e.table.getColWidth(n),height:0,clip:!1,pickable:!1});i.role="column",i.col=n;const r=e.getColGroup(n,!1);r?e.bodyGroup.insertBefore(i,r):e.bodyGroup.appendChild(i),t(i,n,e.bodyRowStart,e.bodyRowEnd)}if(e.bottomFrozenGroup&&e.table.bottomFrozenRowCount>0){const i=new Pe({x:0,y:0,width:e.table.getColWidth(n),height:0,clip:!1,pickable:!1});i.role="column",i.col=n;const r=e.getColGroupInBottom(n);r?e.bottomFrozenGroup.insertBefore(i,r):e.bottomFrozenGroup.appendChild(i),t(i,n,e.table.rowCount-e.table.bottomFrozenRowCount,e.table.rowCount-1)}function t(i,r,o,s){for(let l=o;l<=s;l++){const a=new Pe({x:0,y:0,width:e.table.getColWidth(r),height:e.table.getRowHeight(l)});a.role="cell",a.col=r,a.row=l,a.needUpdate=!0,i.appendChild(a)}}}function cL(n){var e,t,i,r;if(!n.options.animationAppear)return;let o,s,l,a;n.options.animationAppear===!0?(o=500,s=0,l="one-by-one",a="column"):(o=(e=n.options.animationAppear.duration)!==null&&e!==void 0?e:500,s=(t=n.options.animationAppear.delay)!==null&&t!==void 0?t:0,l=(i=n.options.animationAppear.type)!==null&&i!==void 0?i:"one-by-one",a=(r=n.options.animationAppear.direction)!==null&&r!==void 0?r:"row");const{scenegraph:d,frozenColCount:u,frozenRowCount:h}=n,{colStart:c,colEnd:g,rowStart:f,rowEnd:p}=d.proxy;for(let m=0;m<=g;m++)for(let b=0;b<=p;b++){const C=d.highPerformanceGetCell(m,b);C&&C.role==="cell"&&C.forEachChildren(_=>{_.setAttribute("opacity",0),_.animate().wait(l==="one-by-one"?(a==="row"?b:m)*(o-s):s).to({opacity:1},o,"linear")})}}function fL(n,e){const{selectedRangeComponents:t}=e;t.forEach((i,r)=>{i.rect.setAttributes(n)}),e.updateNextFrame()}Rw(),Ce.load(Zk),Ce.load(Ck);class gL{constructor(e){let t,i;this._needUpdateContainer=!1,this.table=e,this.hasFrozen=!1,this.clear=!0,this.mergeMap=new Map,UT(this.table.theme.textPopTipStyle),Me.mode==="node"?(et.setEnv("node",e.options.modeParams),t=e.canvasWidth,i=e.canvasHeight):e.options.canvas&&e.options.viewBox?(et.setEnv("browser"),t=e.options.viewBox.x2-e.options.viewBox.x1,i=e.options.viewBox.y2-e.options.viewBox.y1):(et.setEnv("browser"),t=e.canvas.width,i=e.canvas.height),this.stage=rB(Object.assign({canvas:e.canvas,width:t,height:i,disableDirtyBounds:!1,background:e.theme.underlayBackgroundColor,dpr:e.internalProps.pixelRatio,enableLayout:!0,beforeRender:r=>{this.table.options.beforeRender&&this.table.options.beforeRender(r),this.table.animationManager.ticker.start()},afterRender:r=>{this.table.options.afterRender&&this.table.options.afterRender(r),this.table.fireListeners("after_render",null)},canvasControled:!e.options.canvas,viewBox:e.options.viewBox},e.options.renderOption)),this.stage.defaultLayer.setTheme({group:{boundsPadding:0,strokeBoundsBuffer:0,lineJoin:"round"},text:{ignoreBuf:!0}}),this.initSceneGraph(),this.stage.defaultLayer.add(this.tableGroup),this.stage.table=this.table,this.createComponent()}get width(){var e,t;return(t=(e=this.tableGroup.attribute)===null||e===void 0?void 0:e.width)!==null&&t!==void 0?t:0}get height(){var e,t;return(t=(e=this.tableGroup.attribute)===null||e===void 0?void 0:e.height)!==null&&t!==void 0?t:0}get x(){var e,t;return(t=(e=this.tableGroup.attribute)===null||e===void 0?void 0:e.x)!==null&&t!==void 0?t:0}get y(){var e,t;return(t=(e=this.tableGroup.attribute)===null||e===void 0?void 0:e.y)!==null&&t!==void 0?t:0}get bodyRowStart(){var e;return(e=this.proxy.rowStart)!==null&&e!==void 0?e:0}get bodyRowEnd(){var e;return(e=this.proxy.rowEnd)!==null&&e!==void 0?e:this.table.rowCount-1}get bodyColStart(){var e;return(e=this.proxy.colStart)!==null&&e!==void 0?e:0}get bodyColEnd(){var e;return(e=this.proxy.colEnd)!==null&&e!==void 0?e:this.table.colCount-1}initSceneGraph(){this.isPivot=this.table.isPivotTable(),KE(this)}clearCells(){var e,t;this.table.animationManager.clear(),(this.table.isPivotChart()||this.table._hasCustomRenderOrLayout())&&this.stage.pluginService.findPluginsByName("poptipForText").forEach(i=>{i.deactivate(this.stage.pluginService)}),this.clear=!0,this.hasFrozen=!1,this.mergeMap.clear(),this.colHeaderGroup.clear(),delete this.colHeaderGroup.border,this.rowHeaderGroup.clear(),delete this.rowHeaderGroup.border,this.cornerHeaderGroup.clear(),delete this.cornerHeaderGroup.border,this.bodyGroup.clear(),delete this.bodyGroup.border,this.bottomFrozenGroup.clear(),delete this.bottomFrozenGroup.border,this.rightFrozenGroup.clear(),delete this.rightFrozenGroup.border,this.rightTopCornerGroup.clear(),delete this.rightTopCornerGroup.border,this.rightBottomCornerGroup.clear(),delete this.rightBottomCornerGroup.border,this.leftBottomCornerGroup.clear(),delete this.leftBottomCornerGroup.border,this.colHeaderGroup.setAttributes({x:0,y:0,width:0,height:0}),this.rowHeaderGroup.setAttributes({x:0,y:0,width:0,height:0}),this.cornerHeaderGroup.setAttributes({x:0,y:0,width:0,height:0}),this.bodyGroup.setAttributes({x:0,y:0,width:0,height:0}),this.rightFrozenGroup.setAttributes({x:0,y:0,width:0,height:0}),this.bottomFrozenGroup.setAttributes({x:0,y:0,width:0,height:0}),this.rightTopCornerGroup.setAttributes({x:0,y:0,width:0,height:0,visible:!1}),this.leftBottomCornerGroup.setAttributes({x:0,y:0,width:0,height:0,visible:!1}),this.rightBottomCornerGroup.setAttributes({x:0,y:0,width:0,height:0,visible:!1}),this.tableGroup.setAttributes({x:this.table.tableX,y:this.table.tableY,width:0,height:0}),this.tableGroup.border&&(this.tableGroup.parent.removeChild(this.tableGroup.border),delete this.tableGroup.border),(e=this.proxy)===null||e===void 0||e.release(),(t=this.table.reactCustomLayout)===null||t===void 0||t.clearCache()}updateStageBackground(){this.stage.background=this.table.theme.underlayBackgroundColor,this.stage.renderNextFrame()}createComponent(){this.component=new Lk(this.table),this.component.addToGroup(this.componentGroup),this.selectedRangeComponents=new Map,this.selectingRangeComponents=new Map,this.customSelectedRangeComponents=new Map}updateComponent(){this.component.updateStyle()}createSceneGraph(e=!1){e||(this.table.rowHeightsMap.clear(),this.table.internalProps.layoutMap.clearCellRangeMap()),(this.table.isPivotChart()||this.table._hasCustomRenderOrLayout())&&this.stage.pluginService.autoEnablePlugins.getContributions().forEach(t=>{t.name==="poptipForText"&&this.stage.pluginService.register(t)}),this.clear=!1,this.frozenColCount=this.table.frozenColCount,this.frozenRowCount=this.table.frozenRowCount,this.proxy=new wE(this.table),kn(this.tableGroup,this.table.theme.frameStyle,this.tableGroup.role,void 0,!0),this.table.isPivotChart()&&(dh(this.rightTopCornerGroup,this.table.theme.cornerRightTopCellStyle||this.table.theme.cornerHeaderStyle||{}),dh(this.leftBottomCornerGroup,this.table.theme.cornerLeftBottomCellStyle||this.table.theme.cornerHeaderStyle||{}),dh(this.rightBottomCornerGroup,this.table.theme.cornerRightBottomCellStyle||this.table.theme.cornerHeaderStyle||{})),this.proxy.createGroupForFirstScreen(this.cornerHeaderGroup,this.colHeaderGroup,this.rowHeaderGroup,this.rightFrozenGroup,this.bottomFrozenGroup,this.bodyGroup,0,0),this.afterScenegraphCreated()}renderSceneGraph(){this.stage.render()}getCell(e,t,i){var r,o,s,l,a,d;let u;if(u=this.table.rightFrozenColCount>0&&e>=this.table.colCount-this.table.rightFrozenColCount&&t<this.table.frozenRowCount?(r=this.rightTopCornerGroup.getColGroup(e))===null||r===void 0?void 0:r.getRowGroup(t):this.table.bottomFrozenRowCount>0&&t>=this.table.rowCount-this.table.bottomFrozenRowCount&&e<this.table.frozenColCount?(o=this.leftBottomCornerGroup.getColGroup(e))===null||o===void 0?void 0:o.getRowGroup(t):this.table.rightFrozenColCount>0&&this.table.bottomFrozenRowCount>0&&e>=this.table.colCount-this.table.rightFrozenColCount&&t>=this.table.rowCount-this.table.bottomFrozenRowCount?(s=this.rightBottomCornerGroup.getColGroup(e))===null||s===void 0?void 0:s.getRowGroup(t):this.table.rightFrozenColCount>0&&e>this.table.colCount-1-this.table.rightFrozenColCount?(l=this.rightFrozenGroup.getColGroup(e))===null||l===void 0?void 0:l.getRowGroup(t):this.table.bottomFrozenRowCount>0&&t>this.table.rowCount-1-this.table.bottomFrozenRowCount?(a=this.bottomFrozenGroup.getColGroup(e))===null||a===void 0?void 0:a.getRowGroup(t):(d=this.getColGroup(e,t<this.frozenRowCount))===null||d===void 0?void 0:d.getRowGroup(t),u&&u.role==="shadow-cell"&&!i){const h=this.table.getCellRange(e,t);h.start.col===e&&h.start.row===t||(u=this.getCell(h.start.col,h.start.row))}return u||kd}highPerformanceGetCell(e,t,i){return this.proxy.highPerformanceGetCell(e,t,i)}getColGroup(e,t=!1){let i;return i=e<this.frozenColCount&&t?this.cornerHeaderGroup.getColGroup(e):e<this.frozenColCount?this.rowHeaderGroup.getColGroup(e):t&&this.table.rightFrozenColCount>0&&e>this.table.colCount-1-this.table.rightFrozenColCount?this.rightTopCornerGroup.getColGroup(e):!t&&this.table.rightFrozenColCount>0&&e>this.table.colCount-1-this.table.rightFrozenColCount?this.rightFrozenGroup.getColGroup(e):t?this.colHeaderGroup.getColGroup(e):this.bodyGroup.getColGroup(e),i||void 0}getColGroupInBottom(e,t=!1){var i;if(t){const r=(i=this.getColGroupInLeftBottomCorner(e))!==null&&i!==void 0?i:this.getColGroupInRightBottomCorner(e);if(r)return r}if(this.table.bottomFrozenRowCount>0)return this.bottomFrozenGroup.getColGroup(e)}getColGroupInLeftBottomCorner(e){if(this.table.bottomFrozenRowCount>0)return this.leftBottomCornerGroup.getColGroup(e)}getColGroupInRightTopCorner(e){if(this.table.rightFrozenColCount>0)return this.rightTopCornerGroup.getColGroup(e)}getColGroupInRightBottomCorner(e){if(this.table.rightFrozenColCount>0&&this.table.bottomFrozenRowCount>0)return this.rightBottomCornerGroup.getColGroup(e)}getCellSize(e,t){const i=this.getCell(e,t),r=at(this.table,e,t);let o=i.attribute.width,s=i.attribute.height;return r&&(o/=r.end.col-r.start.col+1,s/=r.end.row-r.start.row+1),{width:o,height:s}}updateNextFrame(){this.updateContainerSync(),this.resetAllSelectComponent(),this.stage.renderNextFrame()}resetAllSelectComponent(){var e,t,i,r;(((t=(e=this.table.stateManager.select)===null||e===void 0?void 0:e.ranges)===null||t===void 0?void 0:t.length)>0||((r=(i=this.table.stateManager.select)===null||i===void 0?void 0:i.customSelectRanges)===null||r===void 0?void 0:r.length)>0)&&yy(this)}hideHoverIcon(e,t){YE(e,t,this)}showHoverIcon(e,t){XE(e,t,this)}hideClickIcon(e,t){qE(e,t,this)}showClickIcon(e,t){ZE(e,t,this)}getIcon(e,t,i,r){return JE(e,t,i,r,this)}setIconHoverStyle(e,t,i,r){QE(e,t,i,r,this)}updateSortIcon(e){const{col:t,row:i,iconMark:r,order:o,oldSortCol:s,oldSortRow:l,oldIconMark:a}=e;iL({col:t,row:i,iconMark:r,order:o,oldSortCol:s,oldSortRow:l,oldIconMark:a,scene:this})}updateFrozenIcon(e,t){rL(this)}updateHierarchyIcon(e,t){oL(e,t,this)}setIconNormalStyle(e,t,i){eL(e,t,i,this)}residentHoverIcon(e,t){sL(e,t,this)}resetResidentHoverIcon(e,t){lL(e,t,this)}deactivateChart(e,t){var i,r;if(e===-1||t===-1)return;const o=this.getCell(e,t);(r=(i=o==null?void 0:o.firstChild)===null||i===void 0?void 0:i.deactivate)===null||r===void 0||r.call(i)}activateChart(e,t){var i,r,o;if(e===-1||t===-1)return;const s=this.getCell(e,t);return(r=(i=s==null?void 0:s.firstChild)===null||i===void 0?void 0:i.activate)===null||r===void 0||r.call(i,this.table),(o=s==null?void 0:s.firstChild)===null||o===void 0?void 0:o.activeChartInstance}removeInteractionBorder(e,t){const i=this.getCell(e,t);i.setAttribute("highlightStroke",void 0),i.setAttribute("highlightStrokeArrayWidth",void 0),i.setAttribute("highlightStrokeArrayColor",void 0)}createCellSelectBorder(e,t,i,r,o,s,l){vE(this,e,t,i,r,o,s,l)}moveSelectingRangeComponentsToSelectedRangeComponents(){wC(this)}deleteLastSelectedRangeComponents(){SE(this)}deleteAllSelectBorder(){yC(this),vy(this)}updateCellSelectBorder(e,t=!0){bC(this,e,t)}removeFillHandleFromSelectComponents(){xE(this)}recreateAllSelectRangeComponents(){yC(this),this.table.stateManager.select.ranges.forEach(e=>{bC(this,e),wC(this)})}updateColWidth(e,t,i,r){Tk(this,e,Math.round(t),r),i||this.updateContainer(!0)}updateChartSizeForResizeColWidth(e){jE(this,e)}updateChartSizeForResizeRowHeight(e){UE(this,e)}updateChartState(e){this.table.isPivotChart()&&$E(this,e)}updateCheckboxCellState(e,t,i){var r,o;if(this.table.transpose)(r=this.bodyGroup.children)===null||r===void 0||r.forEach(s=>{var l;(l=s.getChildAt(t))===null||l===void 0||l.getChildren().forEach(a=>{a.name==="checkbox"&&(i==="indeterminate"?(a.setAttribute("indeterminate",!0),a.setAttribute("checked",void 0)):(a.setAttribute("indeterminate",void 0),a.setAttribute("checked",i)))})});else{const s=this.getColGroup(e);(o=s==null?void 0:s.children)===null||o===void 0||o.forEach(l=>{l.getChildren().find(a=>{a.name==="checkbox"&&(i==="indeterminate"?(a.setAttribute("indeterminate",!0),a.setAttribute("checked",void 0)):(a.setAttribute("indeterminate",void 0),a.setAttribute("checked",i)))})})}}updateHeaderCheckboxCellState(e,t,i){var r,o;this.table.transpose?(r=this.rowHeaderGroup.children)===null||r===void 0||r.forEach(s=>{s.getChildAt(t).getChildren().forEach(l=>{l.name==="checkbox"&&(i==="indeterminate"?(l.setAttribute("indeterminate",!0),l.setAttribute("checked",void 0)):(l.setAttribute("indeterminate",void 0),l.setAttribute("checked",i)))})}):(o=this.getColGroup(e,!0).children)===null||o===void 0||o.forEach(s=>{s.getChildren().find(l=>{l.name==="checkbox"&&(i==="indeterminate"?(l.setAttribute("indeterminate",!0),l.setAttribute("checked",void 0)):(l.setAttribute("indeterminate",void 0),l.setAttribute("checked",i)))})})}updateAutoColWidth(e){this.table.internalProps._widthResizedColMap.delete(e);const t=this.table.getColWidth(e),i=Co(e,0,this.table.rowCount-1,this.table,!0);i!==t&&this.updateColWidth(e,i-t)}recalculateColWidths(){const e=this.table;e.widthMode==="adaptive"||e.autoFillWidth||e.internalProps.transpose?Bn(this.table,0,this.table.colCount-1,!0):(e._clearColRangeWidthsMap(),e.frozenColCount>0&&Bn(this.table,0,e.frozenColCount-1,!0),e.rightFrozenColCount>0&&Bn(this.table,e.rightFrozenColCount,e.colCount-1,!0),Bn(e,this.proxy.colStart,this.proxy.colEnd,!0))}recalculateRowHeights(){const e=this.table;e.internalProps.useOneRowHeightFillAll=!1,e.heightMode==="adaptive"||e.autoFillHeight?An(this.table,0,this.table.rowCount-1,!0,!0):(e.frozenRowCount>0&&An(this.table,0,e.frozenRowCount-1,!0,!0),e.bottomFrozenRowCount>0&&An(this.table,e.bottomFrozenRowCount,e.rowCount-1,!0,!0),An(e,this.proxy.rowStart,this.proxy.rowEnd,!0,!0))}resize(){this.proxy.resize(),(this.table.widthMode==="adaptive"||this.table.autoFillWidth)&&(this.table.internalProps._widthResizedColMap.size===0?this.recalculateColWidths():this.dealWidthMode()),this.table.heightMode==="adaptive"?this.table.internalProps._heightResizedRowMap.size===0?this.recalculateRowHeights():this.dealHeightMode():this.table.autoFillHeight&&this.dealHeightMode(),this.resetFrozen(),this.updateTableSize(),this.updateBorderSizeAndPosition(),this.component.updateScrollBar(),(this.table.widthMode==="adaptive"||this.table.heightMode==="adaptive"||this.table.autoFillWidth||this.table.autoFillHeight)&&this.updateChartSizeForResizeColWidth(-1),this.proxy.progress(),this.updateNextFrame()}updateTableSize(){var e,t,i,r,o,s,l,a,d,u,h,c,g;if(this.tableGroup.setAttributes({x:this.table.tableX,y:this.table.tableY,width:Math.min(this.table.tableNoFrameWidth,Math.max(this.colHeaderGroup.attribute.width,this.bodyGroup.attribute.width,this.bottomFrozenGroup.attribute.width,0)+Math.max(this.cornerHeaderGroup.attribute.width,this.rowHeaderGroup.attribute.width,this.leftBottomCornerGroup.attribute.width,0)+Math.max(this.rightTopCornerGroup.attribute.width,this.rightFrozenGroup.attribute.width,this.rightBottomCornerGroup.attribute.width,0)),height:Math.min(this.table.tableNoFrameHeight,Math.max(this.colHeaderGroup.attribute.height,this.cornerHeaderGroup.attribute.height,this.rightTopCornerGroup.attribute.height,0)+Math.max(this.rowHeaderGroup.attribute.height,this.bodyGroup.attribute.height,this.rightFrozenGroup.attribute.height,0)+Math.max(this.leftBottomCornerGroup.attribute.height,this.bottomFrozenGroup.attribute.height,this.rightBottomCornerGroup.attribute.height,0))}),this.tableGroup.border){const f=(e=this.tableGroup.border)===null||e===void 0?void 0:e.attribute;let p,m,b,C;f!=null&&f.strokeArrayWidth?(p=f.strokeArrayWidth?f.strokeArrayWidth[0]:(t=f.lineWidth)!==null&&t!==void 0?t:0,m=f.strokeArrayWidth?f.strokeArrayWidth[1]:(i=f.lineWidth)!==null&&i!==void 0?i:0,b=f.strokeArrayWidth?f.strokeArrayWidth[2]:(r=f.lineWidth)!==null&&r!==void 0?r:0,C=f.strokeArrayWidth?f.strokeArrayWidth[3]:(o=f.lineWidth)!==null&&o!==void 0?o:0):(p=(s=f==null?void 0:f.lineWidth)!==null&&s!==void 0?s:0,m=(l=f==null?void 0:f.lineWidth)!==null&&l!==void 0?l:0,b=(a=f==null?void 0:f.lineWidth)!==null&&a!==void 0?a:0,C=(d=f==null?void 0:f.lineWidth)!==null&&d!==void 0?d:0),this.tableGroup.border.type==="rect"?!((u=this.table.theme.frameStyle)===null||u===void 0)&&u.innerBorder?this.tableGroup.border.setAttributes({x:this.table.tableX+C/2,y:this.table.tableY+p/2,width:this.tableGroup.attribute.width-C/2-m/2,height:this.tableGroup.attribute.height-p/2-b/2}):this.tableGroup.border.setAttributes({x:this.table.tableX-C/2,y:this.table.tableY-p/2,width:this.tableGroup.attribute.width+C/2+m/2,height:this.tableGroup.attribute.height+p/2+b/2}):this.tableGroup.border.type==="group"&&(!((h=this.table.theme.frameStyle)===null||h===void 0)&&h.innerBorder?(this.tableGroup.border.setAttributes({x:this.table.tableX+C/2,y:this.table.tableY+p/2,width:this.tableGroup.attribute.width-C/2-m/2,height:this.tableGroup.attribute.height-p/2-b/2}),(c=this.tableGroup.border.firstChild)===null||c===void 0||c.setAttributes({x:0,y:0,width:this.tableGroup.attribute.width-C/2-m/2,height:this.tableGroup.attribute.height-p/2-b/2})):(this.tableGroup.border.setAttributes({x:this.table.tableX-C/2,y:this.table.tableY-p/2,width:this.tableGroup.attribute.width+C/2+m/2,height:this.tableGroup.attribute.height+p/2+b/2}),(g=this.tableGroup.border.firstChild)===null||g===void 0||g.setAttributes({x:C/2,y:p/2,width:this.tableGroup.attribute.width,height:this.tableGroup.attribute.height})))}this.table.bottomFrozenRowCount>0&&(this.bottomFrozenGroup.setAttribute("y",this.tableGroup.attribute.height-this.table.getBottomFrozenRowsHeight()),this.leftBottomCornerGroup.setAttributes({visible:!0,y:this.tableGroup.attribute.height-this.table.getBottomFrozenRowsHeight(),height:this.table.getBottomFrozenRowsHeight(),width:this.table.getFrozenColsWidth()}),this.rightBottomCornerGroup.setAttributes({visible:!0,y:this.tableGroup.attribute.height-this.table.getBottomFrozenRowsHeight(),height:this.table.getBottomFrozenRowsHeight()})),this.table.rightFrozenColCount>0&&(this.rightFrozenGroup.setAttribute("x",this.tableGroup.attribute.width-this.table.getRightFrozenColsWidth()),this.rightTopCornerGroup.setAttributes({visible:!0,x:this.tableGroup.attribute.width-this.table.getRightFrozenColsWidth(),width:this.table.getRightFrozenColsWidth(),height:this.table.getFrozenRowsHeight()}),this.rightBottomCornerGroup.setAttributes({visible:!0,x:this.tableGroup.attribute.width-this.table.getRightFrozenColsWidth(),width:this.table.getRightFrozenColsWidth()})),this.updateDomContainer()}updateRowHeight(e,t,i){t=Math.round(t),qb(this,e,t,i),this.updateContainerHeight(e,t)}updateRowsHeight(e,t,i){for(let r=0;r<e.length;r++){const o=e[r];if(o>=this.proxy.rowStart&&o<=this.proxy.rowEnd){const s=t[r];qb(this,o,Math.round(s),i),this._updateContainerHeight(o,s)}}this.updateTableSize(),this.component.updateScrollBar(),this.updateNextFrame()}updateContainerWidth(e,t){e<this.frozenColCount?(this.rowHeaderGroup.setDeltaWidth(t),this.cornerHeaderGroup.setDeltaWidth(t),this.colHeaderGroup.setDeltaX(t),this.bodyGroup.setDeltaX(t)):(this.colHeaderGroup.setDeltaWidth(t),this.bodyGroup.setDeltaWidth(t)),this.updateTableSize(),this.component.updateScrollBar(),this.updateNextFrame()}_updateContainerHeight(e,t){e<this.table.frozenRowCount?(this.colHeaderGroup.setDeltaHeight(t),this.cornerHeaderGroup.setDeltaHeight(t),this.rowHeaderGroup.setDeltaY(t),this.bodyGroup.setDeltaY(t),this.table.rightFrozenColCount&&this.rightFrozenGroup.setDeltaY(t)):e>=this.table.rowCount-this.table.bottomFrozenRowCount?(this.leftBottomCornerGroup.setDeltaHeight(t),this.bottomFrozenGroup.setDeltaHeight(t),this.table.rightFrozenColCount&&this.rightBottomCornerGroup.setDeltaHeight(t)):(this.rowHeaderGroup.setDeltaHeight(t),this.bodyGroup.setDeltaHeight(t),this.table.rightFrozenColCount&&this.rightFrozenGroup.setDeltaHeight(t))}updateContainerHeight(e,t){this._updateContainerHeight(e,t),this.updateTableSize(),this.component.updateScrollBar(),this.updateNextFrame()}setColWidth(e,t){const i=this.table.getColWidth(e);i!==t&&(this.updateColWidth(e,t-i),this.table._clearColRangeWidthsMap(e))}setRowHeight(e,t){const i=this.table.getRowHeight(e);i!==t&&((e>=this.proxy.rowStart&&e<=this.proxy.rowEnd||e>=this.table.rowCount-this.table.bottomFrozenRowCount&&e<=this.table.rowCount-1||e<this.table.frozenRowCount)&&this.updateRowHeight(e,t-i),this.table._clearRowRangeHeightsMap(e))}setX(e,t=!1){this.table.scenegraph.proxy.setX(-e,t)}setY(e,t=!1){this.table.scenegraph.proxy.setY(-e,t)}setBodyAndRowHeaderY(e){var t,i;const r=(t=this.bodyGroup.firstChild)===null||t===void 0?void 0:t.firstChild,o=(i=this.bodyGroup.firstChild)===null||i===void 0?void 0:i.lastChild;e===0&&r&&r.row===this.table.frozenRowCount&&r.attribute.y+e<0?e=-r.attribute.y:o&&this.table.tableNoFrameHeight<this.table.getAllRowsHeight()&&o.row===this.table.rowCount-this.table.bottomFrozenRowCount-1&&o.attribute.y+o.attribute.height+e<this.table.tableNoFrameHeight-this.table.getFrozenRowsHeight()-this.table.getBottomFrozenRowsHeight()&&(e=this.table.tableNoFrameHeight-this.table.getFrozenRowsHeight()-this.table.getBottomFrozenRowsHeight()-o.attribute.y-o.attribute.height),this.colHeaderGroup.attribute.height+e!==this.bodyGroup.attribute.y&&(this.bodyGroup.setAttribute("y",this.colHeaderGroup.attribute.height+e),this.rowHeaderGroup.setAttribute("y",this.cornerHeaderGroup.attribute.height+e),this.table.rightFrozenColCount>0&&this.rightFrozenGroup.setAttribute("y",this.rightTopCornerGroup.attribute.height+e),this.updateNextFrame())}setBodyAndColHeaderX(e){const t=this.bodyGroup.firstChild,i=this.bodyGroup.lastChild;e===0&&t&&t.col===this.table.frozenColCount&&t.attribute.x+e<0?e=-t.attribute.x:i&&this.table.tableNoFrameWidth<this.table.getAllColsWidth()&&i.col===this.table.colCount-this.table.rightFrozenColCount-1&&i.attribute.x+i.attribute.width+e<this.table.tableNoFrameWidth-this.table.getFrozenColsWidth()-this.table.getRightFrozenColsWidth()&&(e=this.table.tableNoFrameWidth-this.table.getFrozenColsWidth()-this.table.getRightFrozenColsWidth()-i.attribute.x-i.attribute.width),this.table.getFrozenColsWidth()+e!==this.bodyGroup.attribute.x&&(this.bodyGroup.setAttribute("x",this.table.getFrozenColsWidth()+e),this.colHeaderGroup.setAttribute("x",this.table.getFrozenColsWidth()+e),this.table.bottomFrozenRowCount>0&&this.bottomFrozenGroup.setAttribute("x",this.table.getFrozenColsWidth()+e),this.updateNextFrame())}afterScenegraphCreated(){this.isPivot||this.table.transpose?this.table.options.frozenColCount?this.component.setFrozenColumnShadow(this.table.frozenColCount-1):this.table.options.rightFrozenColCount?this.component.setRightFrozenColumnShadow(this.table.colCount-this.table.rightFrozenColCount):this.component.setFrozenColumnShadow(-1):(this.component.setFrozenColumnShadow(this.table.frozenColCount-1),this.component.setRightFrozenColumnShadow(this.table.colCount-this.table.rightFrozenColCount)),this.table.stateManager.checkFrozen(),this.updateContainer(),this.createFrameBorder(),this.updateBorderSizeAndPosition(),this.component.updateScrollBar(),Bs(this.table),this.table.options.animationAppear&&cL(this.table),this.updateNextFrame()}dealWidthMode(){const e=this.table;if(e.widthMode==="adaptive"){e._clearColRangeWidthsMap();const s=e.tableNoFrameWidth;let l=0;for(let u=0;u<e.colCount;u++)(u<e.rowHeaderLevelCount||e.isPivotChart()&&u>=e.colCount-e.rightFrozenColCount)&&(l+=e.getColWidth(u));const a=e.rowHeaderLevelCount,d=e.isPivotChart()?e.colCount-e.rightFrozenColCount:e.colCount;Hd(s-l,a,d,!1,[],e,!0)}else if(e.autoFillWidth){e._clearColRangeWidthsMap();const s=e.tableNoFrameWidth;let l=0,a=0;for(let d=0;d<e.colCount;d++){const u=e.getColWidth(d);(d<e.rowHeaderLevelCount||e.isPivotChart()&&d>=e.colCount-e.rightFrozenColCount)&&(l+=u),a+=u}if(a<s&&a>l){const d=e.rowHeaderLevelCount,u=e.isPivotChart()?e.colCount-e.rightFrozenColCount:e.colCount;Hd(s-l,d,u,!1,[],e,!0)}}let t=0;this.bodyGroup.forEachChildrenSkipChild(s=>{t+=s.attribute.width}),this.bodyGroup.setAttribute("width",t);let i=0;this.colHeaderGroup.forEachChildrenSkipChild(s=>{i+=s.attribute.width}),this.colHeaderGroup.setAttribute("width",i);let r=0;this.rowHeaderGroup.forEachChildrenSkipChild(s=>{r+=s.attribute.width}),this.rowHeaderGroup.setAttribute("width",r);let o=0;this.cornerHeaderGroup.forEachChildrenSkipChild(s=>{o+=s.attribute.width}),this.cornerHeaderGroup.setAttribute("width",o),this.colHeaderGroup.setAttribute("x",this.cornerHeaderGroup.attribute.width),this.rowHeaderGroup.setAttribute("y",this.cornerHeaderGroup.attribute.height),this.bodyGroup.setAttributes({x:this.rowHeaderGroup.attribute.width,y:this.colHeaderGroup.attribute.height})}dealHeightMode(){var e;const t=this.table;if(t.heightMode==="adaptive"){t._clearRowRangeHeightsMap();const i=t.getRowsHeight(0,t.columnHeaderLevelCount-1),r=t.isPivotChart()?t.getBottomFrozenRowsHeight():0,o=t.tableNoFrameHeight-i-r,s=t.columnHeaderLevelCount,l=t.isPivotChart()?t.rowCount-t.bottomFrozenRowCount:t.rowCount;let a=0;for(let u=s;u<l;u++)a+=t.getRowHeight(u);const d=o/a;for(let u=s;u<l;u++){let h;h=u===l-1?o-t.getRowsHeight(s,l-2):Math.round(t.getRowHeight(u)*d),this.setRowHeight(u,h)}}else if(t.autoFillHeight){t._clearRowRangeHeightsMap();const i=t.tableNoFrameHeight;let r=0,o=0;for(let s=0;s<t.rowCount;s++){const l=t.getRowHeight(s);(s<t.columnHeaderLevelCount||t.isPivotChart()&&s>=t.rowCount-t.bottomFrozenRowCount)&&(o+=l),r+=l}if(((e=this._dealAutoFillHeightOriginRowsHeight)!==null&&e!==void 0?e:r)<i&&r-o>0){const s=t.columnHeaderLevelCount,l=t.isPivotChart()?t.rowCount-t.bottomFrozenRowCount:t.rowCount,a=(i-o)/(r-o);for(let d=s;d<l;d++){let u;u=d===l-1?i-o-t.getRowsHeight(s,l-2):Math.round(t.getRowHeight(d)*a),this.setRowHeight(d,u)}}}}dealFrozen(){EE(this)}resetFrozen(){LE(this)}resetRowFrozen(){IE(this)}updateCellLayoutWidthCertainWidth(e,t,i){const r=e.attribute.width;let o=!1;return e.forEachChildren((s,l)=>{l+=t;const a=at(this.table,i,l);a?s=this.getCell(a.start.col,a.start.row):s.setAttribute("width",r);const d=this.table._getCellStyle(i,l),u=xe(Z("padding",d,i,l,this.table)),h=s.getChildByName("text");let c=0,g=0;if(h)c=h.AABBBounds.height()+(u[0]+u[2]),h.setAttribute("maxLineWidth",r-(u[1]+u[3])),g=h.AABBBounds.height()+(u[0]+u[2]);else{const p=s.getChildAt(1);c=p.AABBBounds.height()+(u[0]+u[2]),p._cellWidth=r-(u[1]+u[3]),p.layout(),g=p.AABBBounds.height()+(u[0]+u[2])}const f=this.table.getRowHeight(l);s.attribute.height!==g&&(s.setAttribute("height",g),(f===c||g>f)&&(o=!0))}),o}updateHeaderPosition(e,t,i,r,o){yE(e,t,i,r,o,this.table)}updateContainerAttrWidthAndX(){var e,t,i;const r=gi(this.cornerHeaderGroup,0),o=gi(this.rowHeaderGroup,0),s=this.colHeaderGroup.hasChildNodes()&&this.colHeaderGroup.firstChild?gi(this.colHeaderGroup,this.colHeaderGroup.firstChild.col>0?this.table.getColsWidth((e=this.table.frozenColCount)!==null&&e!==void 0?e:0,this.colHeaderGroup.firstChild.col-1):0):0,l=this.bodyGroup.hasChildNodes()&&this.bodyGroup.firstChild?gi(this.bodyGroup,this.bodyGroup.firstChild.col>0?this.table.getColsWidth((t=this.table.frozenColCount)!==null&&t!==void 0?t:0,this.bodyGroup.firstChild.col-1):0):0,a=gi(this.rightFrozenGroup.childrenCount>0?this.rightFrozenGroup:this.rightTopCornerGroup,0);this.bottomFrozenGroup.hasChildNodes()&&this.bottomFrozenGroup.firstChild&&gi(this.bottomFrozenGroup,this.bottomFrozenGroup.firstChild.col>0?this.table.getColsWidth((i=this.table.frozenColCount)!==null&&i!==void 0?i:0,this.bottomFrozenGroup.firstChild.col-1):0),gi(this.leftBottomCornerGroup,0),gi(this.rightTopCornerGroup,0),gi(this.rightBottomCornerGroup,0),this.cornerHeaderGroup.setDeltaWidth(r-this.cornerHeaderGroup.attribute.width),this.leftBottomCornerGroup.setDeltaWidth(r-this.leftBottomCornerGroup.attribute.width),this.colHeaderGroup.setDeltaWidth(s-this.colHeaderGroup.attribute.width),this.rowHeaderGroup.setDeltaWidth(o-this.rowHeaderGroup.attribute.width),this.bottomFrozenGroup.setDeltaWidth(s-this.bottomFrozenGroup.attribute.width),this.rightFrozenGroup.setDeltaWidth(a-this.rightFrozenGroup.attribute.width),this.rightTopCornerGroup.setDeltaWidth(a-this.rightTopCornerGroup.attribute.width),this.rightBottomCornerGroup.setDeltaWidth(a-this.rightBottomCornerGroup.attribute.width),this.bodyGroup.setDeltaWidth(l-this.bodyGroup.attribute.width),this.colHeaderGroup.setAttribute("x",this.cornerHeaderGroup.attribute.width),this.bottomFrozenGroup.setAttribute("x",this.table.getFrozenColsWidth()),this.bodyGroup.setAttribute("x",this.rowHeaderGroup.attribute.width)}updateContainer(e=!1){e?this._needUpdateContainer||(this._needUpdateContainer=!0,setTimeout(()=>{this.updateContainerSync()},0)):(this._needUpdateContainer=!0,this.updateContainerSync())}updateContainerSync(){this._needUpdateContainer&&(this._needUpdateContainer=!1,this.updateContainerAttrWidthAndX(),this.updateTableSize(),this.component.updateScrollBar(),this.updateNextFrame())}updateCellContentWhileResize(e,t){var i;const r=!((i=this.table.getCellRawRecord(e,t))===null||i===void 0)&&i.vtableMerge?"text":this.table.isHeader(e,t)?this.table._getHeaderLayoutMap(e,t).headerType:this.table.getBodyColumnType(e,t),o=this.getCell(e,t);r!=="image"&&r!=="video"||qs(o,e,t,0,0,this.table)}createFrameBorder(){var e,t,i,r,o;this.updateTableSize();const s=!this.isPivot&&!this.table.internalProps.transpose;kn(this.bodyGroup,this.table.theme.bodyStyle.frameStyle,this.bodyGroup.role,s?[!0,!0,!0,!1]:void 0),kn(this.rowHeaderGroup,this.isPivot||this.table.internalProps.transpose?this.table.theme.rowHeaderStyle.frameStyle:this.table.theme.bodyStyle.frameStyle,this.rowHeaderGroup.role,s?[!0,!1,!0,!0]:void 0),kn(this.colHeaderGroup,this.table.theme.headerStyle.frameStyle,this.colHeaderGroup.role,s?[!0,!0,!0,!1]:void 0),kn(this.cornerHeaderGroup,this.isPivot?this.table.theme.cornerHeaderStyle.frameStyle:this.table.theme.headerStyle.frameStyle,this.cornerHeaderGroup.role,s?[!0,!1,!0,!0]:void 0),!((e=this.table.theme.cornerLeftBottomCellStyle)===null||e===void 0)&&e.frameStyle&&kn(this.leftBottomCornerGroup,this.table.theme.cornerLeftBottomCellStyle.frameStyle,this.leftBottomCornerGroup.role,s?[!0,!1,!0,!0]:void 0),!((t=this.table.theme.bottomFrozenStyle)===null||t===void 0)&&t.frameStyle&&kn(this.bottomFrozenGroup,this.table.theme.bottomFrozenStyle.frameStyle,this.bottomFrozenGroup.role,s?[!0,!0,!0,!1]:void 0),!((i=this.table.theme.rightFrozenStyle)===null||i===void 0)&&i.frameStyle&&kn(this.rightFrozenGroup,this.table.theme.rightFrozenStyle.frameStyle,this.rightFrozenGroup.role,void 0),!((r=this.table.theme.cornerRightTopCellStyle)===null||r===void 0)&&r.frameStyle&&kn(this.rightTopCornerGroup,this.table.theme.cornerRightTopCellStyle.frameStyle,this.rightTopCornerGroup.role,void 0),!((o=this.table.theme.cornerRightBottomCellStyle)===null||o===void 0)&&o.frameStyle&&kn(this.rightBottomCornerGroup,this.table.theme.cornerRightBottomCellStyle.frameStyle,this.rightBottomCornerGroup.role,void 0),kn(this.tableGroup,this.table.theme.frameStyle,this.tableGroup.role,void 0)}getResizeColAt(e,t,i){const r=this.table.theme.columnResize.resizeHotSpotSize/2;let o;if(!i){const s=this.table.getDrawRange();return t>=s.top&&t<=s.bottom&&(o=this.table.getCellAtRelativePosition(e-r,t),o.col===this.table.colCount-1)?o:{col:-1,row:-1}}return i.stage?(e<i.globalAABBBounds.x1+r?o={col:i.col-1,row:i.row,x:i.globalAABBBounds.x1}:i.globalAABBBounds.x2-r<e&&(o={col:i.col,row:i.row,x:i.globalAABBBounds.x2}),o&&this.table.rightFrozenColCount>0&&o.col>=this.table.colCount-this.table.rightFrozenColCount-1&&this.table.tableNoFrameWidth-this.table.getFrozenColsWidth()-this.table.getRightFrozenColsWidth()+this.table.scrollLeft<this.bodyGroup.attribute.width&&(o.col=o.col+1,o.rightFrozen=!0),o||{col:-1,row:-1}):{col:-1,row:-1}}getResizeRowAt(e,t,i){const r=this.table.theme.columnResize.resizeHotSpotSize/2;if(i){let o;if(t<i.globalAABBBounds.y1+r?o={col:i.col,row:i.row-1,y:i.globalAABBBounds.y1}:i.globalAABBBounds.y2-r<t&&(o={col:i.col,row:i.row,y:i.globalAABBBounds.y2}),o&&this.table.bottomFrozenRowCount>0&&o.row>=this.table.rowCount-this.table.bottomFrozenRowCount-1&&this.table.tableNoFrameHeight-this.table.getFrozenRowsHeight()-this.table.getBottomFrozenRowsHeight()+this.table.scrollTop<this.bodyGroup.attribute.height&&(o.row=o.row+1,o.bottomFrozen=!0),o)return o}return{col:-1,row:-1}}updateFrozen(){this.clear||(this.resetFrozen(),this.component.updateScrollBar())}updateRowFrozen(){this.clear||(this.resetRowFrozen(),this.component.updateScrollBar())}dealWidthRightFrozen(e){this.clear?this.table.internalProps.rightFrozenColCount=e:FE(e,this)}dealWidthBottomFrozen(e){this.clear?this.table.internalProps.bottomFrozenRowCount=e:zE(e,this)}updateBorderSizeAndPosition(){this.bodyGroup.border&&(this.bodyGroup.appendChild(this.bodyGroup.border),ci(this.bodyGroup),this.rowHeaderGroup.attribute.width,tC(this.bodyGroup,this.table.theme.bodyStyle.frameStyle)),this.colHeaderGroup.border&&(this.colHeaderGroup.appendChild(this.colHeaderGroup.border),ci(this.colHeaderGroup),this.cornerHeaderGroup.attribute.width,tC(this.colHeaderGroup,this.table.theme.headerStyle.frameStyle)),this.rowHeaderGroup.border&&(this.rowHeaderGroup.appendChild(this.rowHeaderGroup.border),ci(this.rowHeaderGroup)),this.cornerHeaderGroup.border&&(this.cornerHeaderGroup.appendChild(this.cornerHeaderGroup.border),ci(this.cornerHeaderGroup)),this.leftBottomCornerGroup.border&&(this.leftBottomCornerGroup.appendChild(this.leftBottomCornerGroup.border),ci(this.leftBottomCornerGroup)),this.bottomFrozenGroup.border&&(this.bottomFrozenGroup.appendChild(this.bottomFrozenGroup.border),ci(this.bottomFrozenGroup)),this.rightFrozenGroup.border&&(this.rightFrozenGroup.appendChild(this.rightFrozenGroup.border),ci(this.rightFrozenGroup)),this.rightTopCornerGroup.border&&(this.rightTopCornerGroup.appendChild(this.rightTopCornerGroup.border),ci(this.rightTopCornerGroup)),this.rightBottomCornerGroup.border&&(this.rightBottomCornerGroup.appendChild(this.rightBottomCornerGroup.border),ci(this.rightBottomCornerGroup)),Fk(this.table)}sortCell(){this.isPivot||(this.table.transpose?this.proxy.sortCellHorizontal():this.proxy.sortCellVertical())}getCellOverflowText(e,t){const i=this.getCell(e,t).getChildByName("text",!0);if(i&&i.type==="text"){if(i.attribute.moreThanMaxCharacters)return this.table.getCellValue(e,t);if(i.cliped)return this.table.getCellValue(e,t)}else if(i&&i.type==="richtext"){const r=i;if(r.attribute.ellipsis&&r._frameCache&&r.attribute.height<r._frameCache.actualHeight)return r.attribute.textConfig.find(o=>o.text),this.table.getCellValue(e,t)}return null}updateDrill(e,t,i,r,o){this.component.drillIcon.update(e,t,i,r,o,this)}updateCellContent(e,t,i=!1){if(!this.clear)return Rn(e,t,this.table,void 0,void 0,i)}setPixelRatio(e){this.stage.disableDirtyBounds(),this.stage.window.setDpr(e),this.stage.render(),this.stage.enableDirtyBounds()}updateRow(e,t,i=[],r=!0,o){this.table.internalProps.layoutMap.clearCellRangeMap(),this.table.internalProps.useOneRowHeightFillAll=!1;const s=ws(t.map(d=>d.row)).sort((d,u)=>d-u),l=ws(i.map(d=>d.row)).sort((d,u)=>d-u),a=this.table.getAllRowsHeight()-[...s,...l].reduce((d,u)=>d+this.table.getRowHeight(u),0)<=this.table.tableNoFrameHeight;if(RE(e,t,i,this.table,o),r&&this.recalculateColWidths(),this.table.heightMode==="adaptive"||this.table.autoFillHeight&&(this.table.getAllRowsHeight()<=this.table.tableNoFrameHeight||a))this.table.scenegraph.recalculateRowHeights();else if(this.table.isAutoRowHeight())for(let d=0;d<l.length;d++){const u=l[d],h=this.table.getRowHeight(u),c=Sn(u,0,this.table.colCount-1,this.table);(u>=this.proxy.rowStart&&u<=this.proxy.rowEnd||u>=this.table.rowCount-this.table.bottomFrozenRowCount&&u<=this.table.rowCount-1)&&this.table.scenegraph.updateRowHeight(u,c-h)}this.table.stateManager.checkFrozen(),this.isPivot||this.table.transpose?this.table.options.frozenColCount?this.component.setFrozenColumnShadow(this.table.frozenColCount-1):this.table.options.rightFrozenColCount&&this.component.setRightFrozenColumnShadow(this.table.colCount-this.table.rightFrozenColCount):(this.component.setFrozenColumnShadow(this.table.frozenColCount-1),this.component.setRightFrozenColumnShadow(this.table.colCount-this.table.rightFrozenColCount)),this.component.updateScrollBar(),this.updateNextFrame()}updateCol(e,t,i=[]){aL(e,t,i,this.table),this.recalculateColWidths(),this.recalculateRowHeights(),this.table.stateManager.checkFrozen(),this.isPivot||this.table.transpose?this.table.options.frozenColCount?this.component.setFrozenColumnShadow(this.table.frozenColCount-1):this.table.options.rightFrozenColCount&&this.component.setRightFrozenColumnShadow(this.table.colCount-this.table.rightFrozenColCount):(this.component.setFrozenColumnShadow(this.table.frozenColCount-1),this.component.setRightFrozenColumnShadow(this.table.colCount-this.table.rightFrozenColCount)),this.component.updateScrollBar(),this.updateNextFrame()}updateCornerHeaderCells(){for(let e=0;e<this.table.frozenColCount;e++)for(let t=0;t<this.table.frozenRowCount;t++)Rn(e,t,this.table,!1)}updateRowHeaderCells(){for(let e=0;e<this.table.frozenColCount;e++)for(let t=this.table.frozenRowCount;t<this.table.rowCount;t++)Rn(e,t,this.table,!1)}updateColumnHeaderCells(){for(let e=0;e<this.table.frozenRowCount;e++)for(let t=this.table.frozenColCount;t<this.table.colCount;t++)Rn(t,e,this.table,!1)}getColumnGroupX(e){return e<this.table.rowHeaderLevelCount?this.table.getColsWidth(0,e-1):e<this.table.colCount-this.table.rightFrozenColCount?this.table.getColsWidth(this.table.rowHeaderLevelCount,e-1):e<this.table.colCount?this.table.getColsWidth(this.table.colCount-this.table.bottomFrozenRowCount,e-1):0}getCellGroupY(e){return e<this.table.frozenRowCount?this.table.getRowsHeight(0,e-1):e<this.table.rowCount-this.table.bottomFrozenRowCount?this.table.getRowsHeight(this.table.frozenRowCount,e-1):e<this.table.rowCount?this.table.getRowsHeight(this.table.rowCount-this.table.bottomFrozenRowCount,e-1):0}getCellGroupX(e){return e<this.table.rowHeaderLevelCount?this.table.getColsWidth(0,e-1):e<this.table.colCount-this.table.rightFrozenColCount?this.table.getColsWidth(this.table.rowHeaderLevelCount,e-1):e<this.table.colCount?this.table.getColsWidth(this.table.colCount-this.table.rightFrozenColCount,e-1):0}updateDomContainer(){kE(this.table)}setLoadingHierarchyState(e,t){const i=this.getCell(e,t),r=i.getChildByName("collapse",!0)||i.getChildByName("expand",!0);if(r){const o=Vn()[Vt.loadingIconName];o&&xn(o,r,e,t)}}temporarilyUpdateSelectRectStyle(e){fL(e,this)}resetSelectRectStyle(){this.recreateAllSelectRangeComponents()}}function pL(n,e,t){for(let i=0;i<t.length;i++){const r=t[i];if(Mn(r,n,e))return!0}return!1}function mL(n,e,t,i){for(let r=0;r<t.length;r++){const o=t[r];if(M2(o,{start:n,end:e}))return!0}return!1}function Wo(n,e,t){const i=n.highPerformanceGetCell(e,t);if(i.role==="cell"&&O(i.mergeStartCol)&&O(i.mergeStartRow)&&O(i.mergeEndCol)&&O(i.mergeEndRow)){const{colStart:r,colEnd:o,rowStart:s,rowEnd:l}=rr(i,n);for(let a=r;a<=o;a++)for(let d=s;d<=l;d++){const u=n.highPerformanceGetCell(a,d);u.role==="cell"&&u.addUpdateBoundTag()}}else i.addUpdateBoundTag()}function AC(n,e,t,i,r){const o=n.table;for(let l=0;l<o.columnHeaderLevelCount;l++)Wo(n,e,l);const s=n.getColGroup(e);return s==null||s.addUpdateBoundTag(),!0}function BC(n,e,t,i,r,o){const s=n.table;for(let a=0;a<s.columnHeaderLevelCount;a++)Wo(n,e,a);const l=n.getColGroup(e);return l==null||l.addUpdateBoundTag(),!0}function MC(n,e,t,i,r){const o=n.table;for(let s=0;s<o.colCount;s++)Wo(n,s,t);return!0}function TC(n,e,t,i,r,o){const s=n.table;for(let l=0;l<s.colCount;l++)Wo(n,l,t);return!0}function bL(n,e,t,i,r){return Wo(n,e,t),!0}function CL(n,e,t,i,r){return Wo(n,e,t),!0}function _L(n,e,t){const{table:i}=n,{scenegraph:r}=i,{highlightScope:o,singleStyle:s,disableHeader:l,cellPos:a,cellPosContainHeader:d}=n.hover,u=a.col,h=a.row;if(o===He.none||l&&(d.col!==e||d.row!==t)){const p=d.col,m=d.row;r.hideHoverIcon(p,m),r.showHoverIcon(e,t),d.col=e,d.row=t}if((l&&i.isHeader(e,t)||o===He.none)&&(e=-1,t=-1),u===e&&h===t)return;r.deactivateChart(u,h),r.activateChart(e,t);let c=!1;const{ranges:g,highlightScope:f}=n.select;if(u!==-1&&h!==-1&&(c=wL(r,u,h,g,s,o),l||r.hideHoverIcon(u,h)),e===-1||t===-1)return a.col=-1,a.row=-1,void(!c||u===e&&h===t||n.table.scenegraph.updateNextFrame());o===He.single?c=!!CL(r,e,t):o===He.row?c=!!TC(r,e,t):o===He.column?c=!!BC(r,e):o===He.cross&&(c=!!TC(r,e,t),c=!!BC(r,e)),o===He.none||l||r.showHoverIcon(e,t),a.col=e,a.row=t,c&&n.table.scenegraph.updateNextFrame()}function wL(n,e,t,i,r,o,s){let l=!1;return o===He.single?l=!!bL(n,e,t):o===He.row?l=!!MC(n,e,t):o===He.column?l=!!AC(n,e):o===He.cross&&(l=!!MC(n,e,t),l=!!AC(n,e)),l}function yL(n,e,t){t.frozenColCount>0?n!==t.frozenColCount-1?t.setFrozenColCount(n+1):t.setFrozenColCount(0):t.setFrozenColCount(n+1)}function vL(n,e,t,i){var r;let o,s=null,l=!1;if(Array.isArray(t.sortState))for(let c=0;c<t.sortState.length&&(o=t.sortState[c],o&&(s=t._getHeaderCellBySortState(o)),s&&(l=PC(n,e,s.col,s.row,t)),!l);c++);else o=t.sortState,o&&(s=t._getHeaderCellBySortState(o)),s&&(l=PC(n,e,s.col,s.row,t));const a=t.getHeaderDefine(n,e);if(o&&l&&(a!=null&&a.sort)?o.order=o.order==="asc"?"desc":o.order==="desc"?"normal":"asc":a!=null&&a.sort?o={field:t.getHeaderField(n,e),order:"asc"}:l&&(a!=null&&a.showSort)||(o={field:t.getHeaderField(n,e),order:"normal"}),o.event=i,t.fireListeners(j.SORT_CLICK,o).includes(!1))return;let d=!1,u=t.internalProps.sortState?Array.isArray(t.internalProps.sortState)&&(d=!0)?t.internalProps.sortState:[t.internalProps.sortState]:[];if(Array.isArray(u)){const c=u.findIndex(g=>g.field===o.field);c>=0?u[c]=o:u.push(o)}u=u.filter(c=>c.order!=="normal"),u=t.internalProps.multipleSort&&(d=!0)?u:u.splice(-1),u=d&&u.length?u:u[0],t.internalProps.sortState=u,t.stateManager.setSortState(u),a!=null&&a.sort&&SL(u,t),t.internalProps.useOneRowHeightFillAll=!1,t.internalProps.layoutMap.clearCellRangeMap(),t.scenegraph.sortCell();const h=!!(!((r=t.stateManager.select.ranges)===null||r===void 0)&&r.length);t.stateManager.updateSelectPos(-1,-1),t.stateManager.endSelectCells(!0,h)}function SL(n,e,t){n=Array.isArray(n)||!n?n:[n],e.dataSource.sort((n||[]).map(i=>{var r,o;const s=e.internalProps.layoutMap.headerObjects.find(l=>l&&l.field===i.field);return{field:i.field,order:i.order||"asc",orderFn:typeof((r=s==null?void 0:s.define)===null||r===void 0?void 0:r.sort)=="function"?(o=s==null?void 0:s.define)===null||o===void 0?void 0:o.sort:ad}}))}function PC(n,e,t,i,r){return r._getLayoutCellId(n,e)===r._getLayoutCellId(t,i)}function xL(n,e,t,i,r,o,s=!0,l=!1){var a,d;const{table:u,interactionState:h}=n,{scenegraph:c}=u,{highlightScope:g,disableHeader:f,cellPos:p,disableCtrlMultiSelect:m}=n.select;if(e!==-1&&t!==-1&&s&&u._makeVisibleCell(e,t),e!==-1&&t!==-1&&s)if(h===me.grabing&&n.select.ranges.length>0){const b=n.select.ranges[n.select.ranges.length-1];e>b.start.col&&e>b.end.col&&u._makeVisibleCell(e+1,t),t>b.start.row&&t>b.end.row&&u._makeVisibleCell(e,t+1),e<b.start.col&&e<b.end.col&&u._makeVisibleCell(e-1,t),t<b.start.row&&t<b.end.row&&u._makeVisibleCell(e,t-1)}else u._makeVisibleCell(e,t);if(o){n.select.ranges=[],c.deleteAllSelectBorder();let b=0,C=0;const{disableHeaderSelect:_,disableRowSeriesNumberSelect:w}=((a=u.options.keyboardOptions)===null||a===void 0?void 0:a.selectAllOnCtrlA)||{};_&&(b=u.rowHeaderLevelCount,C=u.columnHeaderLevelCount),(w||_&&u.transpose)&&u.options.rowSeriesNumber&&(b+=1),n.select.ranges.push({start:{col:b,row:C},end:{col:u.colCount-1,row:u.rowCount-1}});const y=n.select.ranges[n.select.ranges.length-1];c.updateCellSelectBorder(y,!1)}else if(p.col===-1||p.row===-1||e!==-1&&t!==-1)if(h!==me.default||u.eventManager.isDraging||u.stateManager.isResizeCol()){if((h===me.grabing||u.eventManager.isDraging)&&!u.stateManager.isResizeCol()){let b=!0;p.col===-1&&(p.col=e),p.row===-1&&(p.row=t),p.col=e,p.row=t;const C=n.select.ranges[n.select.ranges.length-1];if(C){if(u.internalProps.layoutMap.isSeriesNumberInBody(C.start.col,C.start.row))b=!1,C.end={col:u.colCount-1,row:t};else if(n.fillHandle.isFilling){if(n.fillHandle.direction==="top")if(t===n.fillHandle.beforeFillMinRow&&t===n.fillHandle.beforeFillMaxRow)C.start.row=C.end.row=t;else if(t<=n.fillHandle.beforeFillMinRow){if(C.start.row<C.end.row){const _=C.start.row;C.start.row=C.end.row,C.end.row=_}C.end.row=t}else t===n.fillHandle.beforeFillMaxRow&&(C.start.row>C.end.row?C.start.row=t:C.end.row=t);else if(n.fillHandle.direction==="bottom"){if(t>=n.fillHandle.beforeFillMaxRow){if(C.start.row>C.end.row){const _=C.start.row;C.start.row=C.end.row,C.end.row=_}C.end.row=t}}else if(n.fillHandle.direction==="left")if(e===n.fillHandle.beforeFillMinCol&&e===n.fillHandle.beforeFillMaxCol)C.start.col=C.end.col=e;else if(e<=n.fillHandle.beforeFillMinCol){if(C.start.col<C.end.col){const _=C.start.col;C.start.col=C.end.col,C.end.col=_}C.end.col=e}else e===n.fillHandle.beforeFillMaxCol&&(C.start.col>C.end.col?C.start.col=e:C.end.col=e);else if(n.fillHandle.direction==="right"&&e>=n.fillHandle.beforeFillMaxCol){if(C.start.col>C.end.col){const _=C.start.col;C.start.col=C.end.col,C.end.col=_}C.end.col=e}}else{C.end={col:e,row:t};const _=l?{start:{col:e,row:t},end:{col:e,row:t}}:u.getCellRange(e,t);C.start.col<_.end.col?C.end.col=_.end.col:C.start.col>_.start.col&&(C.end.col=_.start.col),C.start.row<_.end.row?C.end.row=_.end.row:C.start.row>_.start.row&&(C.end.row=_.start.row),n.select.headerSelectMode==="body"&&(u.isRowHeader(e,t)?(C.start.col=u.rowHeaderLevelCount+u.leftRowSeriesNumberCount,C.end.col=u.colCount-1):u.isColumnHeader(e,t)?(C.start.row=u.columnHeaderLevelCount,C.end.row=u.rowCount-1):u.internalProps.layoutMap.isSeriesNumberInBody(e,t)?(C.start.col=u.leftRowSeriesNumberCount,C.end.col=u.colCount-1):u.isCornerHeader(e,t)?(C.start.col=u.rowHeaderLevelCount+u.leftRowSeriesNumberCount,C.start.row=u.columnHeaderLevelCount,C.end.col=u.colCount-1,C.end.row=u.rowCount-1):u.isSeriesNumber(e,t)&&(C.start.col=u.leftRowSeriesNumberCount,C.start.row=u.columnHeaderLevelCount,C.end.col=u.colCount-1,C.end.row=u.rowCount-1)),l&&(C.skipBodyMerge=!0)}c.updateCellSelectBorder(C,b)}}}else{const b=n.select.ranges[n.select.ranges.length-1];if(i&&b){if(r&&!m||(p.col=e,p.row=t),n.select.headerSelectMode!=="cell"&&u.isColumnHeader(e,t)){const C=Math.min(b.start.col,b.end.col,e),_=Math.max(b.start.col,b.end.col,e),w=Math.min(b.start.row,b.end.row,t),y=u.rowCount-1;n.select.headerSelectMode==="body"?(b.start={col:C,row:u.columnHeaderLevelCount},b.end={col:_,row:u.rowCount-1}):(b.start={col:C,row:w},b.end={col:_,row:y})}else if(n.select.headerSelectMode!=="cell"&&u.isRowHeader(e,t)){const C=Math.min(b.start.col,b.end.col,e),_=u.colCount-1,w=Math.min(b.start.row,b.end.row,t),y=Math.max(b.start.row,b.end.row,t);n.select.headerSelectMode==="body"?(b.start={col:u.leftRowSeriesNumberCount+u.rowHeaderLevelCount,row:w},b.end={col:u.colCount-1,row:y}):(b.start={col:C,row:w},b.end={col:_,row:y})}else if(n.select.headerSelectMode!=="cell"&&u.isSeriesNumberInBody(e,t)){const C=Math.min(b.start.col,b.end.col,e),_=u.colCount-1,w=Math.min(b.start.row,b.end.row,t),y=Math.max(b.start.row,b.end.row,t);n.select.headerSelectMode==="body"?(b.start={col:u.leftRowSeriesNumberCount,row:w},b.end={col:u.colCount-1,row:y}):(b.start={col:C,row:w},b.end={col:_,row:y})}else b.end={col:e,row:t};c.deleteLastSelectedRangeComponents(),c.updateCellSelectBorder(b)}else{let C=!0;if(p.col===-1||p.row===-1||r&&!m||(n.select.ranges=[],c.deleteAllSelectBorder()),n.select.headerSelectMode!=="cell"&&u.isColumnHeader(e,t)){const w=u.getCellRange(e,t);n.select.headerSelectMode==="body"?n.select.ranges.push({start:{col:w.start.col,row:u.columnHeaderLevelCount},end:{col:w.end.col,row:u.rowCount-1},skipBodyMerge:!0}):n.select.ranges.push({start:{col:w.start.col,row:w.start.row},end:{col:w.end.col,row:u.rowCount-1},skipBodyMerge:!0})}else if(n.select.headerSelectMode!=="cell"&&u.isRowHeader(e,t)){const w=u.getCellRange(e,t);n.select.headerSelectMode==="body"?n.select.ranges.push({start:{col:u.rowHeaderLevelCount+u.leftRowSeriesNumberCount,row:w.start.row},end:{col:u.colCount-1,row:w.end.row},skipBodyMerge:!0}):n.select.ranges.push({start:{col:w.start.col,row:w.start.row},end:{col:u.colCount-1,row:w.end.row},skipBodyMerge:!0})}else if(u.internalProps.layoutMap.isSeriesNumberInHeader(e,t))C=!1,n.select.headerSelectMode==="body"?n.select.ranges.push({start:{col:u.leftRowSeriesNumberCount,row:u.columnHeaderLevelCount},end:{col:u.colCount-1,row:u.rowCount-1},skipBodyMerge:!0}):n.select.ranges.push({start:{col:0,row:0},end:{col:u.colCount-1,row:u.rowCount-1},skipBodyMerge:!0});else if(u.internalProps.layoutMap.isSeriesNumberInBody(e,t))C=!1,n.select.headerSelectMode==="body"?n.select.ranges.push({start:{col:u.leftRowSeriesNumberCount,row:t},end:{col:u.colCount-1,row:t},skipBodyMerge:!0}):n.select.ranges.push({start:{col:e,row:t},end:{col:u.colCount-1,row:t},skipBodyMerge:!0});else if(u.internalProps.layoutMap.isCornerHeader(e,t))C=!1,n.select.headerSelectMode==="body"?n.select.ranges.push({start:{col:u.rowHeaderLevelCount+u.leftRowSeriesNumberCount,row:u.columnHeaderLevelCount},end:{col:u.colCount-1,row:u.rowCount-1},skipBodyMerge:!0}):n.select.ranges.push({start:{col:u.leftRowSeriesNumberCount,row:0},end:{col:u.colCount-1,row:u.rowCount-1},skipBodyMerge:!0});else if(e>=0&&t>=0){const w=l?{start:{col:e,row:t},end:{col:e,row:t}}:u.getCellRange(e,t);n.select.ranges.push({start:{col:w.start.col,row:w.start.row},end:{col:w.end.col,row:w.end.row},skipBodyMerge:l||void 0})}p.col=e,p.row=t;const _=(d=n.select.ranges)===null||d===void 0?void 0:d[n.select.ranges.length-1];_&&c.updateCellSelectBorder(_,C)}}else p.col=-1,p.row=-1,n.select.ranges=[],c.deleteAllSelectBorder();c.updateNextFrame()}function RL(n){n.moveSelectingRangeComponentsToSelectedRangeComponents()}const hs=ul(j,{PIVOT_SORT_CLICK:"pivot_sort_click",DRILLMENU_CLICK:"drillmenu_click"}),PO=ul(j,{VCHART_EVENT_TYPE:"vchart_event_type"});function AL(n,e,t,i,r){const o=r.getCellLocation(n,e);let s=0,l=0,a=!1;o==="columnHeader"?(s=r.getColsWidth(0,r.rowHeaderLevelCount-1)-(r.frozenColCount===0?r.scrollLeft:0),l=r.getRowsHeight(0,e-1)+r.getRowHeight(e)/2,a=!0):o==="rowHeader"&&(l=r.getRowsHeight(0,r.columnHeaderLevelCount-1),s=r.getColsWidth(0,n-1)+r.getColWidth(n)/2,a=!0),r.scenegraph.updateDrill(a,s,l,t,i)}function BL(n,e,t){const i=t.scenegraph.getCell(n,e).getChildByName("sparkline"),r=i==null?void 0:i.getChildByName("highlight-line"),o=i==null?void 0:i.getChildByName("highlight-symbol");r&&r.setAttributes({visible:!1,pickable:!1}),o&&o.setAttributes({visible:!1,pickable:!1}),t.scenegraph.updateNextFrame()}function ML(n,e,t,i,r){var o,s;const l=r.scenegraph.getCell(n,e).getChildByName("sparkline"),a=l==null?void 0:l.getChildByName("sparkline-line"),d=l==null?void 0:l.getChildByName("sparkline-symbol-group");if(!a)return!1;const u=a.bandwidth,h=a.min,c=a.max,g=a.attribute.points;let f;t-=l.globalAABBBounds.x1,l.globalAABBBounds.y1;for(let p=0;p<g.length;p++){const{x:m,y:b,defined:C,rawData:_}=g[p];if(Math.abs(t-m)<u/2&&(f={point:g[p],points:g,pointsBandWidth:u,pointData:_},C)){const w=l.getChildByName("highlight-line");if(w)w.setAttributes({points:[{x:m,y:c},{x:m,y:h}],visible:!0,pickable:!0});else{const v=un({points:[{x:m,y:c},{x:m,y:h}],lineWidth:(o=a.hover)===null||o===void 0?void 0:o.strokeWidth,stroke:(s=a.hover)===null||s===void 0?void 0:s.stroke});v.name="highlight-line",l.addChild(v)}const y=l.getChildByName("highlight-symbol");if(y)y.setAttributes({x:m,y:b,visible:!0,pickable:!0});else{const v=zs({x:m,y:b,stroke:d.hover.stroke,lineWidth:d.hover.strokeWidth,fill:d.hover.fill,size:2*d.hover.size,symbolType:"circle"});v.name="highlight-symbol",l.addChild(v)}break}}if(r.scenegraph.updateNextFrame(),f){const p={col:n,row:e,field:r.getHeaderField(n,e),value:r.getCellValue(n,e),dataValue:r.getCellOriginValue(n,e),cellHeaderPaths:r.internalProps.layoutMap.getCellHeaderPaths(n,e),title:r.getBodyColumnDefine(n,e).title,cellRange:r.getCellRelativeRect(n,e),sparkline:{pointData:f.pointData},scaleRatio:r.canvas.getBoundingClientRect().width/r.canvas.offsetWidth};r.fireListeners(j.MOUSEOVER_CHART_SYMBOL,p)}return!0}function TL(n,e,t){const i=t.getCellRange(n.col,n.row);if(t.isColumnHeader(n.col,n.row)){const r=t.getCellRange(e.col,i.start.row);e.row>=t.columnHeaderLevelCount&&(e.row=t.columnHeaderLevelCount-1),e.col>=n.col?e.col=r.end.col:e.col=r.start.col}else if(t.isRowHeader(n.col,n.row)){const r=t.internalProps.layoutMap,o=t.getCellRange(i.start.col,e.row);if(e.col>=t.rowHeaderLevelCount+r.leftRowSeriesNumberColumnCount&&(e.col=t.rowHeaderLevelCount+r.leftRowSeriesNumberColumnCount-1),r.rowHierarchyType==="tree"){const s=r.getCellHeaderPathsWithTreeNode(n.col,n.row).rowHeaderPaths,l=r.getCellHeaderPathsWithTreeNode(e.col,e.row).rowHeaderPaths;if(s.length<=l.length){const a=l[s.length-1];a&&(e.row>=n.row?e.row=a.startInTotal+a.size-1+t.columnHeaderLevelCount:e.row=a.startInTotal+t.columnHeaderLevelCount)}}else e.row>=n.row?e.row=o.end.row:e.row=o.start.row}return e}function PL(n,e,t,i,r,o){var s;if(!("canMoveHeaderPosition"in r.table.internalProps.layoutMap))return;r.columnMove.moving=!0,r.columnMove.colSource=n,r.columnMove.rowSource=e,r.columnMove.x=t-r.table.tableX,r.columnMove.y=i-r.table.tableY;const l=r.table.getCellLocation(n,e),a=l==="columnHeader"?r.columnMove.x:l==="rowHeader"||r.table.internalProps.layoutMap.isSeriesNumberInBody(n,e)?r.columnMove.y:0,{backX:d,lineX:u,backY:h,lineY:c}=r.table.scenegraph.component.showMoveCol(n,e,a);r.table.fireListeners(j.CHANGE_HEADER_POSITION_START,{col:n,row:e,x:t,y:i,backX:d,lineX:u,backY:h,lineY:c,event:o});const g=!!(!((s=r.select.ranges)===null||s===void 0)&&s.length);r.table.stateManager.updateSelectPos(-1,-1),r.table.stateManager.endSelectCells(!0,g),r.table.scenegraph.updateNextFrame()}function HL(n,e,t,i,r,o){if(!("canMoveHeaderPosition"in r.table.internalProps.layoutMap))return;const s=TL({col:r.columnMove.colSource,row:r.columnMove.rowSource},{col:n,row:e},r.table);if(r.table.internalProps.layoutMap.canMoveHeaderPosition({col:r.columnMove.colSource,row:r.columnMove.rowSource},{col:s.col,row:s.row})){let l,a,d,u;r.columnMove.x=t-r.table.tableX,r.columnMove.y=i-r.table.tableY,r.columnMove.colTarget=s.col,r.columnMove.rowTarget=s.row,r.updateCursor("grabbing");const h=r.table.getCellLocation(r.columnMove.colSource,r.columnMove.rowSource);h==="columnHeader"?(a=r.columnMove.x,l=r.table.isLeftFrozenColumn(n)?r.columnMove.colTarget>=r.columnMove.colSource?r.table.getColsWidth(0,r.columnMove.colTarget):r.table.getColsWidth(0,r.columnMove.colTarget-1):r.table.isRightFrozenColumn(n)?r.table.tableNoFrameWidth-r.table.getColsWidth(s.col+1,r.table.colCount-1):(r.columnMove.colTarget>=r.columnMove.colSource?r.table.getColsWidth(0,r.columnMove.colTarget):r.table.getColsWidth(0,r.columnMove.colTarget-1))-r.table.stateManager.scroll.horizontalBarPos):(h==="rowHeader"||r.table.internalProps.layoutMap.isSeriesNumberInBody(n,e))&&(u=r.columnMove.y,d=r.table.isFrozenRow(e)?r.columnMove.rowTarget>=r.columnMove.rowSource?r.table.getRowsHeight(0,r.columnMove.rowTarget):r.table.getRowsHeight(0,r.columnMove.rowTarget-1):r.table.isBottomFrozenRow(e)?r.table.tableNoFrameHeight-r.table.getRowsHeight(s.row+1,r.table.rowCount-1):(r.columnMove.rowTarget>=r.columnMove.rowSource?r.table.getRowsHeight(0,r.columnMove.rowTarget):r.table.getRowsHeight(0,r.columnMove.rowTarget-1))-r.table.stateManager.scroll.verticalBarPos),r.table.scenegraph.component.updateMoveCol(a,l,u,d),r.table.fireListeners(j.CHANGING_HEADER_POSITION,{col:n,row:e,x:t,y:i,backX:a,lineX:l,backY:u,lineY:d,event:o}),r.table.scenegraph.updateNextFrame()}else r.updateCursor("not-allowed"),r.columnMove.colTarget=r.columnMove.colSource,r.columnMove.rowTarget=r.columnMove.rowSource}function kL(n){var e,t;let i=!1;if("canMoveHeaderPosition"in n.table.internalProps.layoutMap&&n.columnMove.moving&&n.columnMove.colSource>=0&&n.columnMove.rowSource>=0&&n.columnMove.colTarget>=0&&n.columnMove.rowTarget>=0&&((e=n.table.options.customConfig)===null||e===void 0?void 0:e.notUpdateInColumnRowMove)!==!0){const r=n.table.getCellRange(n.columnMove.colSource,n.columnMove.rowSource),o=n.table.getCellRange(n.columnMove.colTarget,n.columnMove.rowTarget),s=n.table._moveHeaderPosition({col:n.columnMove.colSource,row:n.columnMove.rowSource},{col:n.columnMove.colTarget,row:n.columnMove.rowTarget});if(!s||s.targetIndex===s.sourceIndex)return n.updateCursor(),n.columnMove.moving=!1,delete n.columnMove.colSource,delete n.columnMove.rowSource,delete n.columnMove.colTarget,delete n.columnMove.rowTarget,n.table.scenegraph.component.hideMoveCol(),n.table.scenegraph.updateNextFrame(),!1;{n.table.internalProps.useOneRowHeightFillAll=!1,n.table.internalProps.layoutMap.clearCellRangeMap();const l=n.table.getCellRange(n.columnMove.colSource,n.columnMove.rowSource),a=n.table.getCellRange(n.columnMove.colTarget,n.columnMove.rowTarget),d=Math.min(l.start.col,a.start.col,r.start.col,o.start.col),u=Math.max(l.end.col,a.end.col,r.end.col,o.end.col),h=Math.min(l.start.row,a.start.row,r.start.row,o.start.row);let c=Math.max(l.end.row,a.end.row,r.end.row,o.end.row);s.moveType==="row"&&n.table.internalProps.layoutMap.rowHierarchyType==="tree"&&(c=s.targetIndex>s.sourceIndex?c+s.targetSize-1:c+s.sourceSize-1),!n.table.transpose&&n.table.internalProps.layoutMap.isSeriesNumberInBody(n.columnMove.colSource,n.columnMove.rowSource)&&(n.table.changeRecordOrder(s.sourceIndex,s.targetIndex),n.changeCheckboxAndRadioOrder(s.sourceIndex,s.targetIndex)),s.moveType==="column"?HC(d,u,0,-1,n.table):HC(0,-1,h,c,n.table),n.table.clearCellStyleCache(),n.table.internalProps.layoutMap.isSeriesNumberInBody(n.columnMove.colSource,n.columnMove.rowSource)?n.table.scenegraph.updateHeaderPosition(n.table.scenegraph.proxy.colStart,n.table.scenegraph.proxy.colEnd,n.table.scenegraph.proxy.rowStart,n.table.scenegraph.proxy.rowEnd,s.moveType):s.moveType==="column"?n.table.scenegraph.updateHeaderPosition(d,u,0,-1,s.moveType):n.table.scenegraph.updateHeaderPosition(0,-1,h,c,s.moveType),n.table.internalProps.frozenColDragHeaderMode==="adjustFrozenCount"&&n.table.isListTable()&&(n.table.isLeftFrozenColumn(n.columnMove.colTarget)&&!n.table.isLeftFrozenColumn(n.columnMove.colSource)?n.table.frozenColCount+=l.end.col-l.start.col+1:n.table.isLeftFrozenColumn(n.columnMove.colSource)&&!n.table.isLeftFrozenColumn(n.columnMove.colTarget)&&(n.table.frozenColCount-=l.end.col-l.start.col+1),n.table.isRightFrozenColumn(n.columnMove.colTarget)&&!n.table.isRightFrozenColumn(n.columnMove.colSource)?n.table.rightFrozenColCount+=l.end.col-l.start.col+1:n.table.isRightFrozenColumn(n.columnMove.colSource)&&!n.table.isRightFrozenColumn(n.columnMove.colTarget)&&(n.table.rightFrozenColCount-=l.end.col-l.start.col+1)),i=!0}}return n.columnMove.moving=!1,setTimeout(()=>{delete n.columnMove.colSource,delete n.columnMove.rowSource,delete n.columnMove.colTarget,delete n.columnMove.rowTarget},0),n.table.scenegraph.component.hideMoveCol(),n.columnResize.col<n.table.frozenColCount&&!n.table.isPivotTable()&&!n.table.transpose?(n.table.scenegraph.component.setFrozenColumnShadow(n.table.frozenColCount-1,n.columnResize.isRightFrozen),n.table.scenegraph.component.setRightFrozenColumnShadow(n.table.colCount-n.table.rightFrozenColCount)):n.columnResize.col>=n.table.colCount-n.table.rightFrozenColCount&&!n.table.isPivotTable()&&!n.table.transpose?n.table.scenegraph.component.setRightFrozenColumnShadow(n.table.colCount-n.table.rightFrozenColCount):n.table.options.frozenColCount?n.table.scenegraph.component.setFrozenColumnShadow(n.table.frozenColCount-1):n.table.options.rightFrozenColCount&&n.table.scenegraph.component.setRightFrozenColumnShadow(n.table.colCount-n.table.rightFrozenColCount),n.table.scenegraph.updateNextFrame(),((t=n.table.options.customConfig)===null||t===void 0?void 0:t.notUpdateInColumnRowMove)===!0||i}function HC(n,e,t,i,r){for(let o=n;o<=e;o++)r._clearColRangeWidthsMap(o);for(let o=t;o<=i;o++)r._clearRowRangeHeightsMap(o)}function Ms(n){var e;if(!n)return;const t=!((e=n.role)===null||e===void 0)&&e.startsWith("icon")?n:n.type==="richtext"?n._currentHoverIcon:void 0;return t?n.type==="richtext"?{icon:t,position:{left:n.globalAABBBounds.x1+t.globalAABBBounds.x1,right:n.globalAABBBounds.x1+t.globalAABBBounds.x2,top:n.globalAABBBounds.y1+t.globalAABBBounds.y1,bottom:n.globalAABBBounds.y1+t.globalAABBBounds.y2,width:t.globalAABBBounds.x2-t.globalAABBBounds.x1,height:t.globalAABBBounds.y2-t.globalAABBBounds.y1},type:"richtext-icon"}:{icon:t,position:{left:t.globalAABBBounds.x1,right:t.globalAABBBounds.x2,top:t.globalAABBBounds.y1,bottom:t.globalAABBBounds.y2,width:t.globalAABBBounds.x2-t.globalAABBBounds.x1,height:t.globalAABBBounds.y2-t.globalAABBBounds.y1},type:"icon"}:void 0}function EL(n,e,t){n=Math.ceil(n),e=Math.ceil(e);let i=t.columnResize.isRightFrozen?t.columnResize.x-n:n-t.columnResize.x;if(Math.abs(i)<1)return;const r=t.table.getColWidth(t.columnResize.col);let o=r;o+=i;const s=t.table.getMinColWidth(t.columnResize.col),l=t.table.getMaxColWidth(t.columnResize.col);if(o<s||o>l){if(r===s||r===l)return;i=r-s>l-r?l-r:s-r}let a=t.table.getColWidth(t.columnResize.col)+i;if(a<t.table.internalProps.limitMinWidth&&(a=t.table.internalProps.limitMinWidth,i=a-t.table.getColWidth(t.columnResize.col)),t.table.widthMode==="adaptive"&&t.columnResize.col<t.table.colCount-1){const d=t.table.getColWidth(t.columnResize.col+1),u=t.table.getMinColWidth(t.columnResize.col+1),h=t.table.getMaxColWidth(t.columnResize.col+1);let c=d;if(c-=i,c<u||c>h){if(d===u||d===h)return;i=d-u>h-d?h-d:u-d}c-i<t.table.internalProps.limitMinWidth&&(i=c-t.table.internalProps.limitMinWidth)}i=Math.ceil(i),t.columnResize.col<t.table.rowHeaderLevelCount||t.columnResize.col>=t.table.colCount-t.table.rightFrozenColCount?kC(i,t):t.table.internalProps.columnResizeType==="indicator"?FL(i,t):t.table.internalProps.columnResizeType==="indicatorGroup"?zL(i,t):t.table.internalProps.columnResizeType==="all"?LL(i,t):kC(i,t),t.columnResize.x=n,t.table.scenegraph.component.updateResizeCol(t.columnResize.col,e,t.columnResize.isRightFrozen),t.columnResize.col<t.table.frozenColCount&&!t.table.isPivotTable()&&!t.table.transpose?t.table.scenegraph.component.setFrozenColumnShadow(t.table.frozenColCount-1,t.columnResize.isRightFrozen):t.table.options.frozenColCount&&t.table.scenegraph.component.setFrozenColumnShadow(t.table.frozenColCount-1),(t.columnResize.col>=t.table.colCount-t.table.rightFrozenColCount&&!t.table.isPivotTable()&&!t.table.transpose||t.table.options.rightFrozenColCount)&&t.table.scenegraph.component.setRightFrozenColumnShadow(t.table.colCount-t.table.rightFrozenColCount),t.table.scenegraph.updateNextFrame()}function kC(n,e){e.table.widthMode==="adaptive"&&e.columnResize.col<e.table.colCount-1?(e.table.scenegraph.updateColWidth(e.columnResize.col,n),e.table.scenegraph.updateColWidth(e.columnResize.col+1,-n),e.table.internalProps._widthResizedColMap.add(e.columnResize.col),e.table.internalProps._widthResizedColMap.add(e.columnResize.col+1)):(e.table.scenegraph.updateColWidth(e.columnResize.col,n),e.table.internalProps._widthResizedColMap.add(e.columnResize.col))}function LL(n,e){const t=e.table.internalProps.layoutMap;for(let i=e.table.frozenColCount;i<e.table.colCount-e.table.rightFrozenColCount;i++){if(!(e.table.internalProps.transpose||e.table.isPivotTable()&&!t.indicatorsAsCol)){const r=t.getBody(i,e.table.columnHeaderLevelCount);if(r!=null&&r.disableColumnResize)continue}e.table.scenegraph.updateColWidth(i,n),e.table.internalProps._widthResizedColMap.add(i)}}function FL(n,e){const t=e.table.internalProps.layoutMap;let i,r,o;if(t.indicatorsAsCol)i=t.getIndicatorKey(e.columnResize.col,e.table.columnHeaderLevelCount);else{const s=t.getCellHeaderPaths(e.columnResize.col,e.table.columnHeaderLevelCount-1),l=s.colHeaderPaths[s.colHeaderPaths.length-1];r=l.dimensionKey,o=l.value}for(let s=e.table.rowHeaderLevelCount;s<e.table.colCount-e.table.rightFrozenColCount;s++){const l=t.getIndicatorKey(s,e.table.columnHeaderLevelCount);if(t.indicatorsAsCol&&l===i)e.table.scenegraph.updateColWidth(s,n),e.table.internalProps._widthResizedColMap.add(s);else if(!t.indicatorsAsCol){const a=t.getCellHeaderPaths(s,e.table.columnHeaderLevelCount-1),d=a==null?void 0:a.colHeaderPaths[a.colHeaderPaths.length-1];d&&r===d.dimensionKey&&o===d.value&&(e.table.scenegraph.updateColWidth(s,n),e.table.internalProps._widthResizedColMap.add(s))}}}function zL(n,e){const t=e.table.internalProps.layoutMap,i=t.getCellHeaderPaths(e.columnResize.col,e.table.columnHeaderLevelCount),r=t.getHeadNodeByRowOrColDimensions(i.colHeaderPaths.slice(0,i.colHeaderPaths.length-1)),o=r.startInTotal+e.table.frozenColCount,s=r.startInTotal+e.table.frozenColCount+r.size-1,l=e.table.getColsWidth(o,s),a=n;for(let d=o;d<=s;d++){if(!(e.table.internalProps.transpose||e.table.isPivotTable()&&!t.indicatorsAsCol)){const h=t.getBody(d,e.table.columnHeaderLevelCount);if(h!=null&&h.disableColumnResize)continue}let u=e.table.getColWidth(d)/l*a;u>0&&u<.5?u=.5:u<0&&u>=-.5&&(u=-.5),e.table.scenegraph.updateColWidth(d,u),e.table.internalProps._widthResizedColMap.add(d)}}function IL(n,e,t,i,r,o){const s=o.table.getRecordShowIndexByCell(n,e);if(s>=0){const l=o.table.dataSource.getIndexKey(s);i==="column"?J(r)?(o.radioState[t]={},o.radioState[t][l]=r):o.radioState[t]=l:(o.radioState[t]||(o.radioState[t]={}),J(r)?o.radioState[t][l]=r:o.radioState[t][l]=!0)}}function OL(n,e,t){var i;const r=t.getBodyColumnDefine(n,e),o=r==null?void 0:r.field,s=t.getCellType(n,e);if(O(o)&&s==="radio"){const l=t.dataSource.getIndexKey(t.getRecordShowIndexByCell(n,e)),a=(i=t.stateManager.radioState)===null||i===void 0?void 0:i[o];if(J(a)){if(a===l)return!0}else if(ke(a)){const d=a[l];if(J(d))return d}}return!1}function DL(n,e,t,i,r,o,s){var l,a,d,u,h;const c=s.table.getRecordShowIndexByCell(n,e);if(c>=0){const g=s.table.dataSource.getIndexKey(c);if(i==="column"){if(!O(s.radioState[t])&&o)return J(r)?(s.radioState[t]={},s.radioState[t][g]=r):s.radioState[t]=g,!0;if(J(s.radioState[t])&&!J(r))return s.radioState[t]===g;if(J(s.radioState[t])&&J(r)||ke(s.radioState[t])&&!J(r))return!1;if(ke(s.radioState[t])&&J(r))return s.radioState[t][g]===r}else if(i==="cell"){if(!O(s.radioState[t])&&o)return s.radioState[t]={},J(r)?s.radioState[t][g]=r:s.radioState[t][g]=!0,!0;if(!O((l=s.radioState[t])===null||l===void 0?void 0:l[g])&&o)return J(r)?s.radioState[t][g]=r:s.radioState[t][g]=!0,!0;if(kt((a=s.radioState[t])===null||a===void 0?void 0:a[g])&&!J(r))return s.radioState[t][g];if(kt((d=s.radioState[t])===null||d===void 0?void 0:d[g])&&J(r)||J((u=s.radioState[t])===null||u===void 0?void 0:u[g])&&!J(r))return!1;if(J((h=s.radioState[t])===null||h===void 0?void 0:h[g])&&J(r))return s.radioState[t][g]===r}}return o}function WL(n,e,t,i){const r=i.scenegraph.getCell(n,e);if(r)if(J(t)){const o=r.getChildAt(t);o==null||o._handlePointerUp()}else{const o=r.getChildByName("radio");o==null||o._handlePointerUp()}}function NL(n,e,t){const{radioState:i,table:r}=t;if(r.internalProps.transpose?(n=r.getRecordShowIndexByCell(n,0),e=r.getRecordShowIndexByCell(e,0)):(n=r.getRecordShowIndexByCell(0,n),e=r.getRecordShowIndexByCell(0,e)),n>e){const o=i[n];for(let s=n;s>e;s--)i[s]=i[s-1];i[e]=o}else if(n<e){const o=i[n];for(let s=n;s<e;s++)i[s]=i[s+1];i[e]=o}}function VL(n,e,t,i,r){const o=r.table.getRecordShowIndexByCell(n,e);if(o>=0){const s=r.table.dataSource.getIndexKey(o).toString();r.checkedState.has(s)?r.checkedState.get(s)[t]=i:r.checkedState.set(s,{[t]:i})}}function GL(n,e,t){var i;t.headerCheckedState[n]=e,(i=t.checkedState)===null||i===void 0||i.forEach(r=>{r[n]=e})}function jL(n,e,t,i,r){var o,s;if(r.table.isHeader(n,e)){if(O(r.headerCheckedState[t]))return r.headerCheckedState[t];if(typeof i=="function")return;if(O(i))r.headerCheckedState[t]=i;else if(((o=r.checkedState)===null||o===void 0?void 0:o.size)>0)return r.updateHeaderCheckedState(t,n,e);return r.headerCheckedState[t]}const l=r.table.getRecordShowIndexByCell(n,e);if(l>=0){const a=r.table.dataSource.getIndexKey(l).toString();if(O((s=r.checkedState.get(a))===null||s===void 0?void 0:s[t]))return r.checkedState.get(a)[t];r.checkedState.has(a)?r.checkedState.get(a)[t]=i:r.checkedState.set(a,{[t]:i})}return i}function UL(n,e){e.checkedState.clear(),e.headerCheckedState={},e.radioState={};let t=!1;if(e._checkboxCellTypeFields=[],e._headerCheckFuncs={},e.table.internalProps.layoutMap.headerObjects.forEach((i,r)=>{if(i.headerType==="checkbox"){const o=i.define.checked;o==null||typeof o=="function"?(t=!0,typeof o=="function"&&(e._headerCheckFuncs[i.field]=o)):e.headerCheckedState[i.field]=o,i.define.cellType!=="checkbox"&&!Ae(i.define.cellType)||i.fieldFormat||e._checkboxCellTypeFields.push(i.field)}}),e.table.leftRowSeriesNumberCount===1)e.headerCheckedState._vtable_rowSeries_number=!1,e._checkboxCellTypeFields.push("_vtable_rowSeries_number"),t=!0;else if(e.table.leftRowSeriesNumberCount>1){for(let i=0;i<e.table.leftRowSeriesNumberCount;i++)e.headerCheckedState[`_vtable_rowSeries_number_${i}`]=!1,e._checkboxCellTypeFields.push(`_vtable_rowSeries_number_${i}`);t=!0}t&&ZL(n,e)}function $L(n,e,t,i){let r=!0,o=!0,s=!1;return e.checkedState.forEach((l,a)=>{var d,u;a=a.includes(",")?a.split(",").map(f=>Number(f)):Number(a);const h=e.table.getTableIndexByRecordIndex(a),c=e.table.transpose?e.table.getCustomMerge(h,i):e.table.getCustomMerge(t,h),g=(d=e.table.dataSource)===null||d===void 0?void 0:d.get(a);c||!(!((u=e.table.internalProps.rowSeriesNumber)===null||u===void 0)&&u.enableTreeCheckbox)&&(g!=null&&g.vtableMerge)||((l==null?void 0:l[n])!==!0?r=!1:(o=!1,s=!0))}),r?(e.headerCheckedState[n]=!0,r):o?(e.headerCheckedState[n]=!1,!1):!!s&&(e.headerCheckedState[n]="indeterminate","indeterminate")}function KL(n,e){for(let t=e.checkedState.size;t<n.length;t++){const i=n[t];e._checkboxCellTypeFields.forEach(r=>{const o=i[r];let s;ke(o)?s=o.checked:typeof o=="boolean"&&(s=o);const l=t.toString();e.checkedState.get(l)||e.checkedState.set(l,{}),e.checkedState.get(l)[r]=s})}}function YL(n,e,t,i){const r=i.scenegraph.getCell(n,e),o=r==null?void 0:r.getChildByName("checkbox");if(!o){const a=i.getHeaderField(n,e);if(i.isHeader(n,e))i.stateManager.setHeaderCheckedState(a,t),i.getCellType(n,e)==="checkbox"&&i.scenegraph.updateCheckboxCellState(n,e,t);else if(i.stateManager.setCheckedState(n,e,a,t),i.getCellType(n,e)==="checkbox"){const d=i.stateManager.headerCheckedState[a],u=i.stateManager.updateHeaderCheckedState(a,n,e);d!==u&&i.scenegraph.updateHeaderCheckboxCellState(n,e,u)}return}const{checked:s,indeterminate:l}=o.attribute;l?(t||o._handlePointerUp(),o._handlePointerUp()):s?t||o._handlePointerUp():t&&o._handlePointerUp()}function ia(n,e,t,i){const r=i.scenegraph.getCell(n,e),o=r==null?void 0:r.getChildByName("checkbox");o&&(t==="indeterminate"?(o.setAttribute("indeterminate",!0),o.setAttribute("checked",void 0)):(o.setAttribute("indeterminate",void 0),o.setAttribute("checked",t)))}function XL(n,e,t){const{checkedState:i,table:r}=t;let o,s;if(r.internalProps.transpose?(n=r.getRecordShowIndexByCell(n,0),e=r.getRecordShowIndexByCell(e,0)):(o=r.isPivotTable()?void 0:r.getRecordIndexByCell(0,n),s=r.isPivotTable()?void 0:r.getRecordIndexByCell(0,e)),J(o)&&J(s)){if(n>e){const l=i.get(n.toString());for(let a=n;a>e;a--)i.set(a.toString(),i.get((a-1).toString()));i.set(e.toString(),l)}else if(n<e){const l=i.get(n.toString());for(let a=n;a<e;a++)i.set(a.toString(),i.get((a+1).toString()));i.set(e.toString(),l)}}else if(ee(o)&&ee(s)){if((n=o[o.length-1])>(e=s[s.length-1])){const l=i.get(o.toString());for(let a=n;a>e;a--){const d=[...o];d[d.length-1]=a;const u=[...o];u[u.length-1]=a-1,i.set(d.toString(),i.get(u.toString()))}i.set(s.toString(),l)}else if(n<e){const l=i.get(o.toString());for(let a=n;a<e;a++){const d=[...o];d[d.length-1]=a;const u=[...o];u[u.length-1]=a+1,i.set(d.toString(),i.get(u.toString()))}i.set(s.toString(),l)}}}function qL(n){const e=[],t=n.dataSource,i=t.dataConfig.groupByRules.length+1;return t.currentIndexedData.forEach((r,o)=>{if(ee(r)&&r.length===i){const s=t.getOriginRecordIndexForGroup(r);e[s]=n.stateManager.checkedState.get(r.toString())}}),e}function ZL(n,e){const t=e.table,i=t.isPivotTable()?0:t.internalProps.transpose?t.rowHeaderLevelCount:t.columnHeaderLevelCount,r=t.isPivotTable()?ee(n)?n.length:0:t.internalProps.transpose?t.colCount:t.rowCount;for(let o=0;o+i<r;o++){const s=t.isPivotTable()?n[o]:t.dataSource.get(o);e._checkboxCellTypeFields.forEach(l=>{const a=s&&s[l];let d;if(ke(a)?d=a.checked:typeof a=="boolean"&&(d=a),d==null){const h=e._headerCheckFuncs[l];if(h){const c=e.table.getCellAddrByFieldRecord(l,o);d=ze(h,{col:c.col,row:c.row,table:e.table,context:null,value:a})}}const u=t.isPivotTable()?o.toString():e.table.dataSource.getIndexKey(o).toString();e.checkedState.get(u)||e.checkedState.set(u,{}),e.checkedState.get(u)[l]=d})}}function JL(n,e,t){n=Math.ceil(n),e=Math.ceil(e);let i=t.rowResize.isBottomFrozen?t.rowResize.y-e:e-t.rowResize.y;if(Math.abs(i)<1)return;t.table.getRowHeight(t.rowResize.row);let r=t.table.getRowHeight(t.rowResize.row)+i;if(r<t.table.internalProps.limitMinHeight&&(r=t.table.internalProps.limitMinHeight,i=r-t.table.getRowHeight(t.rowResize.row)),t.table.heightMode==="adaptive"&&t.rowResize.row<t.table.rowCount-1){let o=t.table.getRowHeight(t.rowResize.row+1);o-=i,o-i<t.table.internalProps.limitMinHeight&&(i=o-t.table.internalProps.limitMinHeight)}i=Math.ceil(i),t.rowResize.row<t.table.columnHeaderLevelCount||t.rowResize.row>=t.table.rowCount-t.table.bottomFrozenRowCount?EC(i,t):t.table.internalProps.rowResizeType==="indicator"?eF(i,t):t.table.internalProps.rowResizeType==="indicatorGroup"?tF(i,t):t.table.internalProps.rowResizeType==="all"?QL(i,t):EC(i,t),t.rowResize.y=e,t.table.scenegraph.component.updateResizeRow(t.rowResize.row,n,t.rowResize.isBottomFrozen),t.table.scenegraph.updateNextFrame()}function EC(n,e){e.table.heightMode==="adaptive"&&e.rowResize.row<e.table.rowCount-1?(e.table.scenegraph.updateRowHeight(e.rowResize.row,n),e.table.scenegraph.updateRowHeight(e.rowResize.row+1,-n),e.table.internalProps._heightResizedRowMap.add(e.rowResize.row),e.table.internalProps._heightResizedRowMap.add(e.rowResize.row+1)):(e.table.scenegraph.updateRowHeight(e.rowResize.row,n),e.table.internalProps._heightResizedRowMap.add(e.rowResize.row))}function QL(n,e){for(let t=e.table.frozenRowCount;t<e.table.rowCount-e.table.bottomFrozenRowCount;t++)e.table.scenegraph.updateRowHeight(t,n),e.table.internalProps._heightResizedRowMap.add(t)}function eF(n,e){var t,i;const r=e.table.internalProps.layoutMap;let o,s,l;if(r.indicatorsAsCol){const a=r.getCellHeaderPaths(e.table.rowHeaderLevelCount-1,e.rowResize.row),d=(t=a.rowHeaderPaths)===null||t===void 0?void 0:t[a.rowHeaderPaths.length-1];s=d==null?void 0:d.dimensionKey,l=d==null?void 0:d.value}else o=r.getIndicatorKey(e.table.rowHeaderLevelCount,e.rowResize.row);for(let a=e.table.columnHeaderLevelCount;a<e.table.rowCount-e.table.bottomFrozenRowCount;a++){const d=r.getIndicatorKey(e.table.rowHeaderLevelCount,a);if(r.indicatorsAsCol||d!==o){if(r.indicatorsAsCol){const u=r.getCellHeaderPaths(e.table.rowHeaderLevelCount-1,a),h=(i=u==null?void 0:u.rowHeaderPaths)===null||i===void 0?void 0:i[u.rowHeaderPaths.length-1];h&&s===h.dimensionKey&&l===h.value&&(e.table.scenegraph.updateRowHeight(a,n),e.table.internalProps._heightResizedRowMap.add(a))}}else e.table.scenegraph.updateRowHeight(a,n),e.table.internalProps._heightResizedRowMap.add(a)}}function tF(n,e){const t=e.table.internalProps.layoutMap,i=t.getCellHeaderPaths(e.table.rowHeaderLevelCount,e.rowResize.row),r=t.getHeadNodeByRowOrColDimensions(i.rowHeaderPaths.slice(0,i.rowHeaderPaths.length-1)),o=r.startInTotal+e.table.frozenRowCount,s=r.startInTotal+e.table.frozenRowCount+r.size-1,l=e.table.getRowsHeight(o,s),a=n;for(let d=o;d<=s;d++){let u=e.table.getRowHeight(d)/l*a;u>0&&u<.5?u=.5:u<0&&u>=-.5&&(u=-.51),e.table.scenegraph.updateRowHeight(d,u),e.table.internalProps._heightResizedRowMap.add(d)}}function nF(n){const{customSelectedRangeComponents:e}=n.table.scenegraph;e.forEach((t,i)=>{t.rect.delete()}),e.clear(),n.select.customSelectRanges=[]}function iF(n,e){const{customSelectedRangeComponents:t}=e.table.scenegraph;n.forEach(i=>{var r,o,s,l;const{range:a,style:d}=i,u=Ze({fill:(r=d.cellBgColor)!==null&&r!==void 0&&r,stroke:(o=d.cellBorderColor)!==null&&o!==void 0&&o,lineWidth:(s=d.cellBorderLineWidth)!==null&&s!==void 0?s:0,lineDash:(l=d.cellBorderLineDash)!==null&&l!==void 0?l:[],pickable:!1});t.set(`${a.start.col}-${a.start.row}-${a.end.col}-${a.end.row}`,{rect:u,role:"body"})}),e.select.customSelectRanges=n,yy(e.table.scenegraph),e.table.scenegraph.updateNextFrame()}class rF{constructor(e){this.fastScrolling=!1,this.checkedState=new Map,this.headerCheckedState={},this._checkboxCellTypeFields=[],this._headerCheckFuncs={},this.radioState={},this.resetInteractionState=Hw(t=>{this.updateInteractionState(t??me.default)},100),this.table=e,this.initState(),this.updateVerticalScrollBar=this.updateVerticalScrollBar.bind(this),this.updateHorizontalScrollBar=this.updateHorizontalScrollBar.bind(this)}initState(){this._initState(),this.setHoverState(),this.setSelectState(),this.setFrozenState()}updateOptionSetState(){this._updateOptionSetState(),this.setHoverState(),this.setSelectState(),this.setFrozenState()}_updateOptionSetState(){this.interactionState=me.default,this.hoverIcon={col:-1,row:-1,icon:null},this.columnResize={col:-1,x:0,resizing:!1},this.rowResize={row:-1,y:0,resizing:!1},this.columnMove={colSource:-1,colTarget:-1,rowSource:-1,rowTarget:-1,x:0,y:0,moving:!1},this.menu={x:-1,y:-1,isShow:!1,itemList:[],bounds:new Ri,highlightIndex:-1,dropDownMenuHighlight:[]},this.sort=[{col:-1,row:-1,order:"normal"}],this.frozen={col:-1,row:-1},this.tablePosition={absoluteX:0,absoluteY:0},this.drill={col:-1,row:-1},this.sparkLine={col:-1,row:-1}}_initState(){this.interactionState=me.default,this.select={highlightScope:He.single,ranges:[],cellPos:{col:-1,row:-1},selecting:!1},this.fillHandle={isFilling:!1,startX:void 0,startY:void 0},this.hover={highlightScope:He.single,cellPos:{col:-1,row:-1}},this.hoverIcon={col:-1,row:-1,icon:null},this.columnResize={col:-1,x:0,resizing:!1},this.rowResize={row:-1,y:0,resizing:!1},this.columnMove={colSource:-1,colTarget:-1,rowSource:-1,rowTarget:-1,x:0,y:0,moving:!1},this.menu={x:-1,y:-1,isShow:!1,itemList:[],bounds:new Ri,highlightIndex:-1,dropDownMenuHighlight:[]},this.sort=[{col:-1,row:-1,order:"normal"}],this.frozen={col:-1,row:-1},this.scroll={horizontalBarPos:0,verticalBarPos:0},this.tablePosition={absoluteX:0,absoluteY:0},this.drill={col:-1,row:-1},this.sparkLine={col:-1,row:-1}}setHoverState(){var e;const{highlightMode:t,disableHover:i,disableHeaderHover:r}=(e=this.table.options.hover)!==null&&e!==void 0?e:{highlightMode:"cell"};i?this.hover.highlightScope=He.none:t==="cross"?this.hover.highlightScope=He.cross:t==="row"?this.hover.highlightScope=He.row:t==="column"?this.hover.highlightScope=He.column:t==="cell"&&(this.hover.highlightScope=He.single),this.hover.singleStyle=!i,this.hover.disableHeader=r,(this.hover.highlightScope===He.none||r)&&(this.hover.cellPosContainHeader={col:-1,row:-1})}setSelectState(){var e;const{headerSelectMode:t,disableSelect:i,disableHeaderSelect:r,highlightMode:o,highlightInRange:s}=Object.assign({},{headerSelectMode:"inline",disableSelect:!1,disableHeaderSelect:!1,highlightMode:"cell",highlightInRange:!1},this.table.options.select);this.select.highlightScope=i===!0?He.none:o==="cross"?He.cross:o==="row"?He.row:o==="column"?He.column:He.single,this.select.singleStyle=!i,this.select.disableHeader=r,this.select.headerSelectMode=t,this.select.highlightInRange=s,this.select.disableCtrlMultiSelect=((e=this.table.options.keyboardOptions)===null||e===void 0?void 0:e.ctrlMultiSelect)===!1}isSelected(e,t){let i=!1;return this.select.ranges.forEach(r=>{Mn(r,e,t)&&(i=!0)}),i}setSortState(e){const t=this,i=(e=!e||Array.isArray(e)?e:[e])&&e.reduce((r,o)=>{var s,l,a;const d=(s=function(u){const h=[];return function c(g,f=0){g.forEach(p=>{var m;const b=p.startInTotal?(m=p.startInTotal+t.table.internalProps.layoutMap.leftRowSeriesNumberColumnCount)!==null&&m!==void 0?m:0:f;p.columns?c(p.columns,b):h.push(Object.assign(Object.assign({},p),{startIndex:b}))})}(u),h}(this.table.internalProps.columns))===null||s===void 0?void 0:s.find(u=>(u==null?void 0:u.field)===(o==null?void 0:o.field));return this.table.internalProps.transpose?r.push({field:o.field,order:o.order,row:(l=(d==null?void 0:d.startInTotal)+this.table.internalProps.layoutMap.leftRowSeriesNumberColumnCount)!==null&&l!==void 0?l:0,col:d==null?void 0:d.level}):r.push({field:o.field,order:o.order,col:(a=(d==null?void 0:d.startInTotal)+this.table.internalProps.layoutMap.leftRowSeriesNumberColumnCount)!==null&&a!==void 0?a:0,row:d==null?void 0:d.level}),r},[]);this.sort=i||[]}setFrozenState(){this.frozen.col=this.table.frozenColCount-1}updateInteractionState(e){if(this.interactionState===e)return;e===me.scrolling&&(this.interactionStateBeforeScroll=this.interactionState);const t=this.interactionState;this.interactionState=e,t===me.scrolling&&me.default}updateHoverhighlightScope(e){this.hover.highlightScope!==e&&(this.hover.highlightScope=e)}updateHoverPos(e,t){_L(this,e,t)}updateSelectPos(e,t,i=!1,r=!1,o=!1,s=!0,l=!1){t!==-1&&t!==-1&&(this.select.selecting=!0),xL(this,e,t,i,r,o,s,l)}checkCellRangeInSelect(e,t){return mL(e,t,this.select.ranges,this.select.highlightScope)}updateHoverIcon(e,t,i,r){var o,s,l,a,d,u,h,c,g;if(!((o=this.residentHoverIcon)===null||o===void 0)&&o.icon&&i===((s=this.residentHoverIcon)===null||s===void 0?void 0:s.icon))return;const f=Ms(i);if(f)if(f.type==="richtext-icon"){const p=f.icon;if(this.hoverIcon.icon&&this.hoverIcon.icon!==((a=this.residentHoverIcon)===null||a===void 0?void 0:a.icon)&&(this.table.scenegraph.setIconNormalStyle(this.hoverIcon.icon,this.hoverIcon.col,this.hoverIcon.row),this.hoverIcon.col=-1,this.hoverIcon.col=-1,this.hoverIcon.icon=null,this.table.scenegraph.updateNextFrame()),p.attribute.tooltip){const m={content:p.attribute.tooltip.title,referencePosition:{rect:f.position,placement:p.attribute.tooltip.placement},style:Object.assign({},(d=this.table.internalProps.theme)===null||d===void 0?void 0:d.tooltipStyle,(u=p.tooltip)===null||u===void 0?void 0:u.style,(c=(h=p.attribute)===null||h===void 0?void 0:h.tooltip)===null||c===void 0?void 0:c.style),disappearDelay:p.attribute.tooltip.disappearDelay};this.table.internalProps.tooltipHandler.isBinded(m)||this.table.showTooltip(e,t,m)}}else{const p=f.icon;p!==this.hoverIcon.icon&&(this.hoverIcon.icon&&this.hoverIcon.icon!==((g=this.residentHoverIcon)===null||g===void 0?void 0:g.icon)&&this.table.scenegraph.setIconNormalStyle(this.hoverIcon.icon,this.hoverIcon.col,this.hoverIcon.row),this.hoverIcon.col=e,this.hoverIcon.row=t,this.hoverIcon.icon=p,this.table.scenegraph.setIconHoverStyle(p,e,t,r),this.table.scenegraph.updateNextFrame())}else this.hoverIcon.icon&&this.hoverIcon.icon!==((l=this.residentHoverIcon)===null||l===void 0?void 0:l.icon)&&(this.table.scenegraph.setIconNormalStyle(this.hoverIcon.icon,this.hoverIcon.col,this.hoverIcon.row),this.hoverIcon.col=-1,this.hoverIcon.col=-1,this.hoverIcon.icon=null,this.table.scenegraph.updateNextFrame())}isResizeCol(){return this.columnResize.resizing}isResizeRow(){return this.rowResize.resizing}isFillHandle(){return this.fillHandle.isFilling}isSelecting(){return this.select.selecting}endSelectCells(e=!0,t=!0){if(this.select.selecting){if(this.select.selecting=!1,this.select.ranges.length===0)return;const i=this.select.ranges[this.select.ranges.length-1];this.table.isSeriesNumber(this.select.cellPos.col,this.select.cellPos.row)||this.table.isHeader(this.select.cellPos.col,this.select.cellPos.row)||Bk(i,this.table);let r=!1;for(let l=0;l<this.select.ranges.length-1;l++){const a=this.select.ranges[l];if(a&&a.start.col===i.start.col&&a.start.row===i.start.row&&a.end.col===i.end.col&&a.end.row===i.end.row){r=!0;break}}r?(this.select.ranges.pop(),vy(this.table.scenegraph),this.table.scenegraph.selectingRangeComponents.clear()):RL(this.table.scenegraph);const o=this.select.ranges[this.select.ranges.length-1].end.col,s=this.select.ranges[this.select.ranges.length-1].end.row;e&&this.table.fireListeners(j.SELECTED_CELL,{ranges:this.select.ranges,col:o,row:s})}else t&&this.select.ranges.length===0&&this.table.fireListeners(j.SELECTED_CLEAR,{})}endResizeCol(){setTimeout(()=>{this.columnResize.resizing=!1},0),this.table.scenegraph.updateChartSizeForResizeColWidth(this.columnResize.col),this.checkFrozen(),this.table.scenegraph.component.hideResizeCol(),this.table.scenegraph.updateNextFrame()}startResizeCol(e,t,i,r){this.columnResize.resizing=!0,this.columnResize.col=e,this.columnResize.x=t,this.columnResize.isRightFrozen=r,this.table.scenegraph.component.showResizeCol(e,i,r),this.table.scenegraph.updateNextFrame()}updateResizeCol(e,t){EL(e,t,this)}endResizeRow(){setTimeout(()=>{this.rowResize.resizing=!1},0),this.table.scenegraph.updateChartSizeForResizeRowHeight(this.rowResize.row),this.table.scenegraph.component.hideResizeRow(),this.table.scenegraph.updateNextFrame()}startResizeRow(e,t,i,r){this.rowResize.resizing=!0,this.rowResize.row=e,this.rowResize.y=i,this.rowResize.isBottomFrozen=r,this.table.scenegraph.component.showResizeRow(e,t,r),this.table.scenegraph.updateNextFrame()}updateResizeRow(e,t){JL(e,t,this)}startFillSelect(e,t){this.fillHandle.isFilling=!0,this.fillHandle.startX=e,this.fillHandle.startY=t;const i=this.select.ranges[this.select.ranges.length-1];this.fillHandle.beforeFillMinCol=Math.min(i.start.col,i.end.col),this.fillHandle.beforeFillMinRow=Math.min(i.start.row,i.end.row),this.fillHandle.beforeFillMaxCol=Math.max(i.start.col,i.end.col),this.fillHandle.beforeFillMaxRow=Math.max(i.start.row,i.end.row),this.table.fireListeners(j.MOUSEDOWN_FILL_HANDLE,{})}endFillSelect(){this.fillHandle.isFilling=!1,this.fillHandle.startX=void 0,this.fillHandle.startY=void 0,this.fillHandle.directionRow=void 0;const e=Math.min(this.select.ranges[0].start.col,this.select.ranges[0].end.col),t=Math.min(this.select.ranges[0].start.row,this.select.ranges[0].end.row),i=Math.max(this.select.ranges[0].start.col,this.select.ranges[0].end.col),r=Math.max(this.select.ranges[0].start.row,this.select.ranges[0].end.row);this.fillHandle.beforeFillMinCol===e&&this.fillHandle.beforeFillMinRow===t&&this.fillHandle.beforeFillMaxCol===i&&this.fillHandle.beforeFillMaxRow===r||this.table.eventManager.isDraging&&this.table.fireListeners(j.DRAG_FILL_HANDLE_END,{direction:this.fillHandle.direction}),this.fillHandle.beforeFillMaxCol=void 0,this.fillHandle.beforeFillMaxRow=void 0,this.fillHandle.beforeFillMinCol=void 0,this.fillHandle.beforeFillMinRow=void 0}startMoveCol(e,t,i,r,o){PL(e,t,i,r,this,o)}updateMoveCol(e,t,i,r,o){HL(e,t,i,r,this,o)}isMoveCol(){return this.columnMove.moving}endMoveCol(){return kL(this)}checkFrozen(){var e;let t=this.table.options.frozenColCount?this.table.options.frozenColCount:this.table.isPivotTable()||this.table.isListTable()&&this.table.internalProps.transpose?((e=this.table.rowHeaderLevelCount)!==null&&e!==void 0?e:0)+this.table.internalProps.layoutMap.leftRowSeriesNumberColumnCount:0;if(t){t>this.table.colCount&&(t=this.table.colCount);const i=this.table._getMaxFrozenWidth();if(this.table.getColsWidth(0,t-1)>i)if(this.table.internalProps.unfreezeAllOnExceedsMaxWidth)this.table._setFrozenColCount(0),this.setFrozenCol(-1);else{const r=this.table._getComputedFrozenColCount(t);this.table._setFrozenColCount(r),this.setFrozenCol(r)}else this.table.frozenColCount!==t&&(this.table._setFrozenColCount(t),this.setFrozenCol(t))}}setFrozenCol(e){e!==this.frozen.col?(this.frozen.col=e,this.table.scenegraph.updateFrozen(),this.table.scenegraph.updateFrozenIcon(0,this.table.colCount-1)):this.table.scenegraph.updateFrozenIcon(0,this.table.colCount-1)}setFrozenRow(e){e!==this.frozen.row&&(this.frozen.row=e,this.table.scenegraph.updateRowFrozen())}checkVerticalScrollBarEnd(){var e,t;const i=this.table.getAllRowsHeight(),r=this.scroll.verticalBarPos,o=this.table.tableNoFrameHeight;r+o>=i&&this.table.fireListeners(j.SCROLL_VERTICAL_END,{scrollTop:r,scrollLeft:this.scroll.horizontalBarPos,scrollHeight:(e=this.table.theme.scrollStyle)===null||e===void 0?void 0:e.width,scrollWidth:(t=this.table.theme.scrollStyle)===null||t===void 0?void 0:t.width,viewHeight:o,viewWidth:this.table.tableNoFrameWidth})}checkHorizontalScrollBarEnd(){var e,t;const i=this.table.getAllColsWidth(),r=this.scroll.horizontalBarPos,o=this.table.tableNoFrameWidth;r+o>=i&&this.table.fireListeners(j.SCROLL_HORIZONTAL_END,{scrollTop:this.scroll.verticalBarPos,scrollLeft:r,scrollHeight:(e=this.table.theme.scrollStyle)===null||e===void 0?void 0:e.width,scrollWidth:(t=this.table.theme.scrollStyle)===null||t===void 0?void 0:t.width,viewHeight:this.table.tableNoFrameHeight,viewWidth:o})}updateVerticalScrollBar(e){var t,i;const r=this.table.getAllRowsHeight(),o=this.scroll.verticalBarPos;this.scroll.verticalBarPos=Math.ceil(e*(r-this.table.scenegraph.height)),O(this.scroll.verticalBarPos)&&!isNaN(this.scroll.verticalBarPos)||(this.scroll.verticalBarPos=0),this.table.scenegraph.setY(-this.scroll.verticalBarPos,e===1),this.scroll.verticalBarPos-=this.table.scenegraph.proxy.deltaY,this.table.scenegraph.proxy.deltaY=0,this.updateHoverPos(-1,-1),this.table.fireListeners(j.SCROLL,{event:void 0,scrollTop:this.scroll.verticalBarPos,scrollLeft:this.scroll.horizontalBarPos,scrollHeight:(t=this.table.theme.scrollStyle)===null||t===void 0?void 0:t.width,scrollWidth:(i=this.table.theme.scrollStyle)===null||i===void 0?void 0:i.width,viewHeight:this.table.tableNoFrameHeight,viewWidth:this.table.tableNoFrameWidth,scrollDirection:"vertical",scrollRatioY:e}),o!==this.scroll.verticalBarPos&&this.checkVerticalScrollBarEnd()}updateHorizontalScrollBar(e){var t,i;const r=this.table.getAllColsWidth(),o=this.scroll.horizontalBarPos;this.scroll.horizontalBarPos=Math.ceil(e*(r-this.table.scenegraph.width)),O(this.scroll.horizontalBarPos)&&!isNaN(this.scroll.horizontalBarPos)||(this.scroll.horizontalBarPos=0),this.table.scenegraph.setX(-this.scroll.horizontalBarPos,e===1),this.scroll.horizontalBarPos-=this.table.scenegraph.proxy.deltaX,this.table.scenegraph.proxy.deltaX=0,this.updateHoverPos(-1,-1),this.table.fireListeners(j.SCROLL,{event:void 0,scrollTop:this.scroll.verticalBarPos,scrollLeft:this.scroll.horizontalBarPos,scrollHeight:(t=this.table.theme.scrollStyle)===null||t===void 0?void 0:t.width,scrollWidth:(i=this.table.theme.scrollStyle)===null||i===void 0?void 0:i.width,viewHeight:this.table.tableNoFrameHeight,viewWidth:this.table.tableNoFrameWidth,scrollDirection:"horizontal",scrollRatioX:e}),o!==this.scroll.horizontalBarPos&&this.checkHorizontalScrollBarEnd()}setScrollTop(e,t,i=!0){var r,o,s;const l=this.table.getAllRowsHeight(),a=!((r=this.table.options.customConfig)===null||r===void 0)&&r._disableColumnAndRowSizeRound?1:0;e=Math.max(0,Math.min(e,l-this.table.scenegraph.height-a)),((e=Math.ceil(e))!==this.scroll.verticalBarPos||this.table.isPivotChart())&&this.updateHoverPos(-1,-1);const d=this.scroll.verticalBarPos;this.scroll.verticalBarPos=e,O(this.scroll.verticalBarPos)&&!isNaN(this.scroll.verticalBarPos)||(this.scroll.verticalBarPos=0),this.table.scenegraph.setY(-e);const u=e/(l-this.table.scenegraph.height);this.table.scenegraph.component.updateVerticalScrollBarPos(u),d!==e&&i&&(this.table.fireListeners(j.SCROLL,{event:t==null?void 0:t.nativeEvent,scrollTop:this.scroll.verticalBarPos,scrollLeft:this.scroll.horizontalBarPos,scrollHeight:(o=this.table.theme.scrollStyle)===null||o===void 0?void 0:o.width,scrollWidth:(s=this.table.theme.scrollStyle)===null||s===void 0?void 0:s.width,viewHeight:this.table.tableNoFrameHeight,viewWidth:this.table.tableNoFrameWidth,scrollDirection:"vertical",scrollRatioY:u}),this.checkVerticalScrollBarEnd())}setScrollLeft(e,t,i=!0){var r,o,s;this.table.scrollLeft;const l=this.table.getAllColsWidth(),a=(this.table.getFrozenColsWidth(),!((r=this.table.options.customConfig)===null||r===void 0)&&r._disableColumnAndRowSizeRound?1:0);e=Math.max(0,Math.min(e,l-this.table.scenegraph.width-a)),(e=Math.ceil(e))!==this.scroll.horizontalBarPos&&this.updateHoverPos(-1,-1);const d=this.scroll.horizontalBarPos;this.scroll.horizontalBarPos=e,O(this.scroll.horizontalBarPos)&&!isNaN(this.scroll.horizontalBarPos)||(this.scroll.horizontalBarPos=0),this.table.scenegraph.setX(-e);const u=e/(l-this.table.scenegraph.width);this.table.scenegraph.component.updateHorizontalScrollBarPos(u),d!==e&&i&&(this.table.fireListeners(j.SCROLL,{event:t==null?void 0:t.nativeEvent,scrollTop:this.scroll.verticalBarPos,scrollLeft:this.scroll.horizontalBarPos,scrollHeight:(o=this.table.theme.scrollStyle)===null||o===void 0?void 0:o.width,scrollWidth:(s=this.table.theme.scrollStyle)===null||s===void 0?void 0:s.width,viewHeight:this.table.tableNoFrameHeight,viewWidth:this.table.tableNoFrameWidth,scrollDirection:"horizontal",scrollRatioX:u}),this.checkHorizontalScrollBarEnd())}hideVerticalScrollBar(){this.table.scenegraph.component.hideVerticalScrollBar()}showVerticalScrollBar(e){this.table.scenegraph.component.showVerticalScrollBar(),e&&(clearTimeout(this._clearVerticalScrollBar),this._clearVerticalScrollBar=setTimeout(()=>{var t;(t=this.table.scenegraph)===null||t===void 0||t.component.hideVerticalScrollBar()},1e3))}hideHorizontalScrollBar(){this.table.scenegraph.component.hideHorizontalScrollBar()}showHorizontalScrollBar(e){this.table.scenegraph.component.showHorizontalScrollBar(),e&&(clearTimeout(this._clearHorizontalScrollBar),this._clearHorizontalScrollBar=setTimeout(()=>{var t;(t=this.table.scenegraph)===null||t===void 0||t.component.hideHorizontalScrollBar()},1e3))}triggerContextMenu(e,t,i,r){this.menu.isShow&&this.menu.x===i&&this.menu.y===r?this.hideMenu():this.showContextMenu(e,t,i,r)}showContextMenu(e,t,i,r){var o;!((o=this.table.internalProps.menu)===null||o===void 0)&&o.contextMenuItems&&(this.table.internalProps.menu.renderMode==="html"?this.menu.isShow=!0:(this.menu.isShow=!0,this.menu.x=i,this.menu.y=r,this.table.scenegraph.component.menu.attach(i,r,e,t,ln.contextmenu)),this.table.fireListeners(j.SHOW_MENU,{x:i,y:r,col:e,row:t,type:"contextmenu"}))}triggerDropDownMenu(e,t,i,r,o){this.table.fireListeners(j.DROPDOWN_ICON_CLICK,{col:e,row:t,event:o}),this.menu.isShow?this.hideMenu():this.showDropDownMenu(e,t,i,r)}showDropDownMenu(e,t,i,r){this.table.internalProps.menu.renderMode==="html"?this.menu.isShow=!0:(this.menu.isShow=!0,this.table.scenegraph.component.menu.attach(i,r,e,t,ln.dropDown),this.menu.bounds=this.table.scenegraph.component.menu.bounds),this.table.fireListeners(j.SHOW_MENU,{x:i,y:r,col:e,row:t,type:"dropDown"}),this.residentHoverIcon&&this.table.scenegraph.setIconNormalStyle(this.residentHoverIcon.icon,this.residentHoverIcon.col,this.residentHoverIcon.row);const o=this.table.scenegraph.getCell(e,t);let s;o.forEachChildren(l=>l.attribute.funcType===Oe.dropDown&&(s=l,!0)),s&&(this.residentHoverIcon={col:e,row:t,icon:s},this.table.scenegraph.setIconHoverStyle(this.residentHoverIcon.icon,this.residentHoverIcon.col,this.residentHoverIcon.row,o),this.table.scenegraph.residentHoverIcon(e,t))}hideMenu(){this.menu.isShow&&(this.table.fireListeners(j.DROPDOWN_MENU_CLEAR,null),this.table.fireListeners(j.HIDE_MENU,null),this.menu.isShow=!1,this.table.scenegraph.component.menu.detach(),this.residentHoverIcon&&(this.table.scenegraph.setIconNormalStyle(this.residentHoverIcon.icon,this.residentHoverIcon.col,this.residentHoverIcon.row),this.table.scenegraph.resetResidentHoverIcon(this.residentHoverIcon.col,this.residentHoverIcon.row),this.residentHoverIcon=null))}setDropDownMenuHighlight(e){this.menu.dropDownMenuHighlight=e;for(let t=0;t<e.length;t++){const{col:i,row:r}=e[t],o=this.table.getCellRange(i,r);if(o)for(let s=o.start.col;s<=o.end.col;s++)for(let l=o.start.row;l<=o.end.row;l++)this.table.scenegraph.updateCellContent(s,l)}}dropDownMenuIsHighlight(e,t,i){const r=this.menu.dropDownMenuHighlight;if(Array.isArray(r))for(let o=0;o<r.length;o++){const s=r[o];let{col:l,row:a}=s;const{field:d,menuKey:u}=s;if(typeof l!="number"||typeof a!="number")if(this.table.isPivotTable()){const h=this.table.internalProps.layoutMap.getPivotCellAdress(d);if(!h)continue;l=h.col,a=h.row}else{const h=this.table.internalProps.layoutMap.getHeaderCellAddressByField(d);if(!h)continue;l=h.col,a=h.row}if(O(l)&&O(a)&&this.table.isCellRangeEqual(e,t,l,a)){let h=this.table._getHeaderLayoutMap(l??e,a??t).dropDownMenu||this.table.globalDropDownMenu;if(typeof h=="function"&&(h=h({row:a,col:l,table:this.table})),h)for(let c=0;c<h.length;c++){const g=h[c];if(ke(g)&&(g.menuKey||g.text)===(u||"")&&c===i||je(g)&&g===u&&c===i)return!0}}}return!1}triggerSort(e,t,i,r){if(this.table.isPivotTable()){const c=this.table.getPivotSortState(e,t),g=c?c.toUpperCase():"NORMAL",f=g==="ASC"?"DESC":g==="DESC"?"NORMAL":"ASC";return this.table.sort(e,t,f),void this.table.fireListeners(hs.PIVOT_SORT_CLICK,{col:e,row:t,order:g||"normal",dimensionInfo:this.table.internalProps.layoutMap.getPivotDimensionInfo(e,t),cellLocation:this.table.getCellLocation(e,t),event:r})}const o=[...this.sort],s=this.table.internalProps.multipleSort||!o.length?null:this.sort[this.sort.length-1];vL(e,t,this.table,r);const l=this.table.getCellRange(e,t),a=this.sort.find(c=>c.col===l.start.col&&c.row===l.start.row),d=this.table.internalProps.multipleSort||!s?null:s.col,u=this.table.internalProps.multipleSort||!s?null:s.row,h=o.findIndex(c=>c.col===e&&c.row===t);h>=0&&o.splice(h,1),this.table.scenegraph.updateSortIcon({col:e,row:t,iconMark:i,order:a==null?void 0:a.order,oldSortCol:d,oldSortRow:u,oldIconMark:s==null?void 0:s.icon}),a&&(a.icon=i),this.table.internalProps.multipleSort||o.forEach(c=>{this.table.scenegraph.updateSortIcon({col:null,row:null,iconMark:null,order:"normal",oldSortCol:c.col,oldSortRow:c.row,oldIconMark:null})}),this.table.fireListeners(hs.AFTER_SORT,{order:a==null?void 0:a.order,field:this.table.getHeaderField(e,t),event:r})}updateSortState(e){var t,i,r,o,s,l,a,d;e=Array.isArray(e)?e:[e];for(let h=0;h<e.length;h++){if(e[h].field===((t=this.sort[h])===null||t===void 0?void 0:t.field)&&e[e.length-1].order===((i=this.sort[h])===null||i===void 0?void 0:i.order))return;const c=this.table.internalProps.multipleSort?null:((r=this.sort[h])===null||r===void 0?void 0:r.col)||null,g=this.table.internalProps.multipleSort?null:((o=this.sort[h])===null||o===void 0?void 0:o.row)||null;((s=this.sort[h])===null||s===void 0?void 0:s.order)==="asc"||(l=this.sort[h])===null||l===void 0||l.order,this.setSortState(e.slice(0,h+1));const f=this.table.internalProps.layoutMap.getHeaderCellAddressByField(e[h].field);this.sort[h].col=f.col,this.sort[h].row=f.row;const p=this.table.scenegraph.getCell(this.sort[h].col,this.sort[h].row);let m;qf(p,"children",b=>b.attribute.funcType==="sort"&&(m=b,!0)),this.table.scenegraph.updateSortIcon({col:this.sort[h].col,row:this.sort[h].row,iconMark:m,order:this.sort[h].order,oldSortCol:c,oldSortRow:g,oldIconMark:(a=this.sort[h])===null||a===void 0?void 0:a.icon})}const u=[];this.table.internalProps.layoutMap.columnTree.tree.children.forEach(h=>{e.some(c=>c.field===h.field)||u.push(h)});for(let h=0;h<u.length;h++){const c=u[h];this.table.scenegraph.updateSortIcon({col:null,row:null,iconMark:null,order:null,oldSortCol:(d=c.startInTotal+this.table.internalProps.layoutMap.leftRowSeriesNumberColumnCount)!==null&&d!==void 0?d:0,oldSortRow:c.level,oldIconMark:null})}}triggerFreeze(e,t,i){if(!this.table.isPivotTable()&&!this.table.transpose){if(yL(e,t,this.table),this.table.hasListeners(hs.FREEZE_CLICK)){const r=this.table.internalProps.layoutMap.columnObjects.slice(0,e+1);this.table.fireListeners(hs.FREEZE_CLICK,{col:e,row:t,fields:r.reduce((o,s)=>o.concat(s.field),[]),colCount:this.table.frozenColCount})}this.frozen.icon=i}}updateCursor(e="default"){this.table.getElement().style.cursor=e}updateDrillState(e,t,i,r,o,s){this.drill.dimensionKey=e,this.drill.title=t,this.drill.drillDown=i,this.drill.drillUp=r,this.drill.col=o,this.drill.row=s,AL(o,s,i,r,this.table)}updateSparklineHoverPose(e,t,i,r){this.sparkLine.col!==-1&&this.sparkLine.row!==-1&&BL(this.sparkLine.col,this.sparkLine.row,this.table);let o=!1;e!==-1&&t!==-1&&(o=ML(e,t,i,r,this.table)),o?(this.sparkLine.col=e,this.sparkLine.row=t):(this.sparkLine.col=-1,this.sparkLine.row=-1)}setCheckedState(e,t,i,r){return VL(e,t,i,r,this)}setHeaderCheckedState(e,t){return GL(e,t,this)}syncCheckedState(e,t,i,r){return jL(e,t,i,r,this)}initCheckedState(e){return UL(e,this)}updateHeaderCheckedState(e,t,i){return $L(e,this,t,i)}initLeftRecordsCheckState(e){return KL(e,this)}setRadioState(e,t,i,r,o){IL(e,t,i,r,o,this)}syncRadioState(e,t,i,r,o,s){return DL(e,t,i,r,o,s,this)}changeCheckboxAndRadioOrder(e,t){this.checkedState.size&&XL(e,t,this),this.radioState.length&&NL(e,t,this)}setCustomSelectRanges(e){nF(this),iF(e,this)}}function oF(n){Me.mode==="browser"&&n.on(j.CLICK_CELL,e=>{const{col:t,row:i}=e;if(e.target.type==="image"&&e.target.role&&e.target.role.startsWith("icon"))return;let r;r=n.internalProps.layoutMap.isHeader(t,i)?n.isPivotTable()?n._getHeaderLayoutMap(t,i).headerType:n.getHeaderDefine(t,i).headerType:n.getBodyColumnType(t,i);const o=n.isHeader(t,i)?n.getHeaderDefine(t,i):n.getBodyColumnDefine(t,i),s=n.getCellValue(t,i),l=n.getCellOriginValue(t,i);if(r==="link"){let a=ze(o.linkJump,{col:t,row:i,table:n,value:s,dataValue:l,cellHeaderPaths:void 0});if(a=a!==!1,!a)return;const d=o.templateLink;let u,h=ze(o.linkDetect,{col:t,row:i,table:n,value:s,dataValue:l,cellHeaderPaths:void 0});if(h=h!==!1,d){const f=n.getCellOriginRecord(t,i);if(f&&f.vtableMerge)return;const p=Object.assign({__value:s,__dataValue:l},f);if(Ae(d))u=d(p,t,i,n);else{const m=/\{\s*(\S+?)\s*\}/g;u=d.replace(m,(b,C)=>p[C])}}else if(h){if(!Zf.test(s))return;u=s}else u=s;if(!u)return;const c=o.linkTarget,g=o.linkWindowFeatures;window.open(u,c,g)}else if(r==="image"){const{clickToPreview:a}=o;if(a===!1)return;const d=document.createElement("div");d.style.width="100%",d.style.height="100%",d.style.position="absolute",d.style.top="0",d.style.left="0",d.style.backgroundColor="rgba(30, 30, 30, 0.4)",d.style.display="flex",d.style.justifyContent="center",d.style.alignItems="center",d.style.overflow="hidden",d.style.zIndex="9999",d.addEventListener("click",h=>{h.target===d&&document.body.removeChild(d)});const u=new Image;u.src=s,u.style.maxWidth="80%",u.style.maxHeight="80%",d.appendChild(u),document.body.appendChild(d)}else if(r==="video"){const{clickToPreview:a}=o;if(a===!1)return;const d=document.createElement("div");d.style.width="100%",d.style.height="100%",d.style.position="absolute",d.style.top="0",d.style.left="0",d.style.backgroundColor="rgba(30, 30, 30, 0.4)",d.style.display="flex",d.style.justifyContent="center",d.style.alignItems="center",d.style.overflow="hidden",d.style.zIndex="9999",d.addEventListener("click",h=>{h.target===d&&document.body.removeChild(d)});const u=document.createElement("video");u.src=s,u.style.maxWidth="80%",u.style.maxHeight="80%",u.setAttribute("preload","auto"),u.setAttribute("controls","true"),d.appendChild(u),document.body.appendChild(d)}})}function sF(n){n.on(j.MOUSEENTER_CELL,e=>{const{col:t,row:i}=e;if(t===-1||i===-1)return;const r=n.internalProps.layoutMap.getHeaderDimension(t,i);r!=null&&r.drillDown||r!=null&&r.drillUp?n.stateManager.updateDrillState(r.dimensionKey,r.title,r.drillDown,r.drillUp,t,i):n.stateManager.updateDrillState(void 0,void 0,!1,!1,-1,-1)}),n.on(j.MOUSELEAVE_TABLE,e=>{n.stateManager.updateDrillState(void 0,void 0,!1,!1,-1,-1)})}function lF(n){n.fireListeners(hs.DRILLMENU_CLICK,n.stateManager.drill)}function aF(n){const e=n.internalProps.layoutMap.rowsDefine,t=n.internalProps.layoutMap.columnsDefine;for(let i=0;i<e.length;i++){const r=e[i];if(typeof r!="string"&&(r.drillDown||r.drillUp))return!0}for(let i=0;i<t.length;i++){const r=t[i];if(typeof r!="string"&&(r.drillDown||r.drillUp))return!0}return!1}function LC(n){if(n.eventManager.bindSparklineHoverEvent)return;let e=!1;n.isPivotTable()?e=n.internalProps.layoutMap.indicatorsDefine.some(t=>typeof t!="string"&&t.cellType==="sparkline"):e=n.internalProps.layoutMap.columnObjects.some(t=>t.cellType==="sparkline"||typeof t.cellType=="function"),e&&(n.eventManager.bindSparklineHoverEvent=!0,n.on(j.MOUSEMOVE_CELL,t=>{const{col:i,row:r,x:o,y:s}=t;n.getBodyColumnType(i,r)!=="sparkline"&&n.stateManager.updateSparklineHoverPose(-1,-1,0,0),n.stateManager.updateSparklineHoverPose(i,r,o,s)}),n.on(j.MOUSELEAVE_TABLE,t=>{n.stateManager.updateSparklineHoverPose(-1,-1,0,0)}))}function Ld(n,e,t=!0){var i;let{deltaX:r,deltaY:o}=n;n.shiftKey&&n.deltaY&&(r=o,o=0);const[s,l]=dF(r,o,{horizontal:1,vertical:1});(s||l)&&e.interactionState!==me.scrolling&&e.updateInteractionState(me.scrolling),s&&(e.setScrollLeft(e.scroll.horizontalBarPos+s,n),e.showHorizontalScrollBar(!0)),l&&(e.setScrollTop(e.scroll.verticalBarPos+l,n),e.showVerticalScrollBar(!0)),t&&e.resetInteractionState(e.interactionStateBeforeScroll),!((i=n.nativeEvent)===null||i===void 0)&&i.cancelable&&(e.table.internalProps.overscrollBehavior==="none"||Math.abs(o)>=Math.abs(r)&&o!==0&&Hy(o,e)||Math.abs(o)<=Math.abs(r)&&r!==0&&ky(r,e))&&n.nativeEvent.preventDefault()}function dF(n,e,t){var i,r;const o=Math.abs(n/e),s=o<=.5?0:n,l=o>2?0:e;return[Math.ceil(s*((i=t.horizontal)!==null&&i!==void 0?i:0)),Math.ceil(l*((r=t.vertical)!==null&&r!==void 0?r:0))]}function Hy(n,e){return e.table.getAllRowsHeight()-e.table.scenegraph.height!=0&&!uF(n,e)&&!hF(n,e)}function ky(n,e){return e.table.getAllColsWidth()-e.table.scenegraph.width!=0&&!cF(n,e)&&!fF(n,e)}function uF(n,e){return e.table.getAllRowsHeight()-e.table.scenegraph.height!==0&&n<=0&&e.scroll.verticalBarPos<1}function hF(n,e){var t;const i=!((t=e.table.options.customConfig)===null||t===void 0)&&t._disableColumnAndRowSizeRound?1:0,r=e.table.getAllRowsHeight()-e.table.scenegraph.height;return r!==0&&n>=0&&Math.abs(e.scroll.verticalBarPos-r)<1+i}function cF(n,e){return e.table.getAllColsWidth()-e.table.scenegraph.width!==0&&n<=0&&e.scroll.horizontalBarPos<1}function fF(n,e){var t;const i=!((t=e.table.options.customConfig)===null||t===void 0)&&t._disableColumnAndRowSizeRound?1:0,r=e.table.getAllColsWidth()-e.table.scenegraph.width;return r!==0&&n>=0&&Math.abs(e.scroll.horizontalBarPos-r)<1+i}class gF{constructor(e){this.stateManager=e}setScrollHandle(e){this.scrollHandle=e}startInertia(e,t,i){this.lastTime=Date.now(),this.speedX=e,this.speedY=t,this.friction=i,this.runingId||(this.runingId=requestAnimationFrame(this.inertia.bind(this)))}inertia(){var e;const t=Date.now(),i=t-this.lastTime;let r=!0;const o=Math.pow(this.friction,i/16),s=o*this.speedX,l=o*this.speedY;let a=0,d=0;Math.abs(s)>.05&&(r=!1,a=(this.speedX+s)/2*i),Math.abs(l)>.05&&(r=!1,d=(this.speedY+l)/2*i),(e=this.scrollHandle)===null||e===void 0||e.call(this,a,d),r?this.runingId=null:(this.lastTime=t,this.speedX=s,this.speedY=l,this.runingId=requestAnimationFrame(this.inertia.bind(this)))}endInertia(){cancelAnimationFrame(this.runingId),this.runingId=null}isInertiaScrolling(){return!!this.runingId}}function uf(n,e,t){var i,r,o,s;e&&((i=n.stateManager.columnMove)===null||i===void 0?void 0:i.colSource)!==-1&&((r=n.stateManager.columnMove)===null||r===void 0?void 0:r.rowSource)!==-1&&((o=n.stateManager.columnMove)===null||o===void 0?void 0:o.colTarget)!==-1&&((s=n.stateManager.columnMove)===null||s===void 0?void 0:s.rowTarget)!==-1?n.hasListeners(j.CHANGE_HEADER_POSITION)&&n.fireListeners(j.CHANGE_HEADER_POSITION,{target:{col:n.stateManager.columnMove.colTarget,row:n.stateManager.columnMove.rowTarget},source:{col:n.stateManager.columnMove.colSource,row:n.stateManager.columnMove.rowSource},event:t}):e||n.hasListeners(j.CHANGE_HEADER_POSITION_FAIL)&&n.fireListeners(j.CHANGE_HEADER_POSITION_FAIL,{target:{col:n.stateManager.columnMove.colTarget,row:n.stateManager.columnMove.rowTarget},source:{col:n.stateManager.columnMove.colSource,row:n.stateManager.columnMove.rowSource},event:t})}function pF(n){const e=n.table,t=e.stateManager;e.scenegraph.tableGroup.addEventListener("pointermove",o=>{var s,l,a,d,u,h,c,g,f,p,m,b,C,_,w,y,v,x,S;const R=(l=(s=e.eventManager.LastPointerXY)===null||s===void 0?void 0:s.x)!==null&&l!==void 0?l:o.x,B=(d=(a=e.eventManager.LastPointerXY)===null||a===void 0?void 0:a.y)!==null&&d!==void 0?d:o.y;e.eventManager.LastPointerXY={x:o.x,y:o.y},n.touchSetTimeout&&(clearTimeout(n.touchSetTimeout),n.touchSetTimeout=void 0);const A=Ct(o);if(A.eventArgs&&e.hasListeners(j.MOUSEMOVE_TABLE)&&e.fireListeners(j.MOUSEMOVE_TABLE,{col:A.eventArgs.col,row:A.eventArgs.row,x:A.abstractPos.x,y:A.abstractPos.y,event:o.nativeEvent,target:(u=A==null?void 0:A.eventArgs)===null||u===void 0?void 0:u.target,mergeCellInfo:(h=A.eventArgs)===null||h===void 0?void 0:h.mergeInfo}),t.interactionState===me.grabing&&!(!((c=e.editorManager)===null||c===void 0)&&c.editingEditor))return void(Math.abs(R-o.x)+Math.abs(B-o.y)>=1&&(t.isResizeCol()||t.isResizeRow()||(t.isMoveCol()?n.dealColumnMover(A):t.isFillHandle()?n.dealFillSelect(A,!0):((g=e.options.select)===null||g===void 0?void 0:g.disableDragSelect)||n.dealTableSelect(A,!0))));!(!((f=e.options.select)===null||f===void 0)&&f.disableDragSelect)&&e.eventManager.isDraging&&t.isSelecting()&&!(!((p=e.editorManager)===null||p===void 0)&&p.editingEditor)&&n.dealTableSelect(A,!0);const M=o.path.find(H=>H.role==="cell");if(e.hasListeners(j.MOUSELEAVE_CELL)&&(e.stateManager.hover.cellPos.col===-1||e.stateManager.hover.cellPos.row===-1||(M==null?void 0:M.col)===e.stateManager.hover.cellPos.col&&(M==null?void 0:M.row)===e.stateManager.hover.cellPos.row||e.fireListeners(j.MOUSELEAVE_CELL,{col:e.stateManager.hover.cellPos.col,row:e.stateManager.hover.cellPos.row,cellRange:e.getCellRangeRelativeRect({col:e.stateManager.hover.cellPos.col,row:e.stateManager.hover.cellPos.row}),scaleRatio:e.canvas.getBoundingClientRect().width/e.canvas.offsetWidth,event:o.nativeEvent,target:(m=A==null?void 0:A.eventArgs)===null||m===void 0?void 0:m.target})),e.hasListeners(j.MOUSEENTER_CELL)&&((M==null?void 0:M.role)!=="cell"||!O(M.col)||!O(M.row)||M.col===e.stateManager.hover.cellPos.col&&M.row===e.stateManager.hover.cellPos.row||M.col===((b=e.stateManager.hover.cellPosContainHeader)===null||b===void 0?void 0:b.col)&&M.row===((C=e.stateManager.hover.cellPosContainHeader)===null||C===void 0?void 0:C.row)||e.fireListeners(j.MOUSEENTER_CELL,{col:M.col,row:M.row,cellRange:e.getCellRangeRelativeRect({col:M.col,row:M.row}),scaleRatio:e.canvas.getBoundingClientRect().width/e.canvas.offsetWidth,event:o.nativeEvent,target:(_=A==null?void 0:A.eventArgs)===null||_===void 0?void 0:_.target,mergeCellInfo:(w=A.eventArgs)===null||w===void 0?void 0:w.mergeInfo})),n.dealIconHover(A),n.dealTableHover(A),e.theme.columnResize.visibleOnHover&&n.checkColumnResize(A,!0),A.eventArgs&&e.hasListeners(j.MOUSEMOVE_CELL)){let H,E;if(!((y=A.eventArgs)===null||y===void 0)&&y.target){const T=Ms((v=A.eventArgs)===null||v===void 0?void 0:v.target);T&&(H=T.icon,E=T.position)}e.fireListeners(j.MOUSEMOVE_CELL,{col:A.eventArgs.col,row:A.eventArgs.row,x:A.abstractPos.x,y:A.abstractPos.y,event:o.nativeEvent,targetIcon:H?{name:H.name,position:E,funcType:H.attribute.funcType}:void 0,target:(x=A==null?void 0:A.eventArgs)===null||x===void 0?void 0:x.target,mergeCellInfo:(S=A.eventArgs)===null||S===void 0?void 0:S.mergeInfo})}}),e.scenegraph.tableGroup.addEventListener("pointerout",o=>{var s;const l=Ct(o),a=(s=l==null?void 0:l.eventArgs)===null||s===void 0?void 0:s.target;(a==null?void 0:a.role)==="table"&&n.dealTableHover()}),e.scenegraph.tableGroup.addEventListener("pointerover",o=>{var s,l;const a=Ct(o),d=(s=a==null?void 0:a.eventArgs)===null||s===void 0?void 0:s.target;if(d&&e.hasListeners(j.MOUSEOVER_CHART_SYMBOL)&&d.type==="symbol"){const u=o.composedPath().find(h=>h.roll==="cell");if(u){const{col:h,row:c}=u,g={col:h,row:c,field:e.getHeaderField(h,c),value:e.getCellValue(h,c),dataValue:e.getCellOriginValue(h,c),cellHeaderPaths:e.internalProps.layoutMap.getCellHeaderPaths(h,c),title:e.getBodyColumnDefine(h,c).title,cellRange:e.getCellRelativeRect(h,c),event:o.nativeEvent,sparkline:{pointData:void 0},scaleRatio:e.canvas.getBoundingClientRect().width/e.canvas.offsetWidth,target:(l=a==null?void 0:a.eventArgs)===null||l===void 0?void 0:l.target};e.fireListeners(j.MOUSEOVER_CHART_SYMBOL,g)}}}),e.scenegraph.tableGroup.addEventListener("pointerenter",o=>{(e.theme.scrollStyle.horizontalVisible&&e.theme.scrollStyle.horizontalVisible==="focus"||!e.theme.scrollStyle.horizontalVisible&&e.theme.scrollStyle.visible==="focus")&&t.showHorizontalScrollBar(),(e.theme.scrollStyle.verticalVisible&&e.theme.scrollStyle.verticalVisible==="focus"||!e.theme.scrollStyle.verticalVisible&&e.theme.scrollStyle.visible==="focus")&&t.showVerticalScrollBar(),e.hasListeners(j.MOUSEENTER_TABLE)&&e.fireListeners(j.MOUSEENTER_TABLE,{event:o.nativeEvent})}),e.scenegraph.tableGroup.addEventListener("pointerleave",o=>{t.isResizeCol()||t.isResizeRow()||t.isMoveCol()||t.isSelecting()||(t.updateInteractionState(me.default),t.updateCursor()),(e.theme.scrollStyle.horizontalVisible&&e.theme.scrollStyle.horizontalVisible==="focus"||!e.theme.scrollStyle.horizontalVisible&&e.theme.scrollStyle.visible==="focus")&&t.hideHorizontalScrollBar(),(e.theme.scrollStyle.verticalVisible&&e.theme.scrollStyle.verticalVisible==="focus"||!e.theme.scrollStyle.verticalVisible&&e.theme.scrollStyle.visible==="focus")&&t.hideVerticalScrollBar(),e.hasListeners(j.MOUSELEAVE_CELL)&&e.stateManager.hover.cellPos.col!==-1&&e.stateManager.hover.cellPos.row!==-1&&e.fireListeners(j.MOUSELEAVE_CELL,{col:e.stateManager.hover.cellPos.col,row:e.stateManager.hover.cellPos.row,cellRange:e.getCellRangeRelativeRect({col:e.stateManager.hover.cellPos.col,row:e.stateManager.hover.cellPos.row}),scaleRatio:e.canvas.getBoundingClientRect().width/e.canvas.offsetWidth,event:o.nativeEvent,target:void 0}),n.dealTableHover();const s=o.target;s&&!s.isDescendantsOf(e.scenegraph.tableGroup)&&e.fireListeners(j.MOUSELEAVE_TABLE,{event:o.nativeEvent})});const i=o=>{var s;const l=o.target;if(!e.getElement().contains(l)){const a=(s=e.editorManager)===null||s===void 0?void 0:s.completeEdit(o);Il(a,d=>{d!==!1&&(t.updateInteractionState(me.default),n.dealTableHover())})}},r=o=>{var s;const l=o.target;if(!e.getElement().contains(l)&&!e.internalProps.menuHandler.containElement(l)){const a=(s=e.editorManager)===null||s===void 0?void 0:s.completeEdit(o);Il(a,d=>{var u,h;if(d!==!1&&(!((u=e.options.select)===null||u===void 0)&&u.outsideClickDeselect)){const c=!!(!((h=t.select.ranges)===null||h===void 0)&&h.length);n.dealTableSelect(),t.endSelectCells(!0,c)}})}};n.globalEventListeners.push({name:"pointerup",env:"document",callback:i}),n.globalEventListeners.push({name:"pointerdown",env:"document",callback:r}),et.addEventListener("pointerup",i),et.addEventListener("pointerdown",r),e.scenegraph.tableGroup.addEventListener("pointerdown",o=>{var s,l,a,d,u;e.hasListeners(j.MOUSEDOWN_TABLE)&&e.fireListeners(j.MOUSEDOWN_TABLE,{event:o.nativeEvent}),e.eventManager.isDown=!0,e.eventManager.LastBodyPointerXY={x:o.x,y:o.y},e.eventManager.LastPointerXY={x:o.x,y:o.y};const h=Ct(o);if(n.downIcon=void 0,t.interactionState!==me.default||(e.isPivotChart()&&((s=h==null?void 0:h.eventArgs)===null||s===void 0?void 0:s.target.type)!=="chart"&&e.scenegraph.updateChartState(null),((l=h.eventArgs)===null||l===void 0?void 0:l.target)!==((a=t.residentHoverIcon)===null||a===void 0?void 0:a.icon)&&t.hideMenu(),((d=h==null?void 0:h.eventArgs)===null||d===void 0?void 0:d.target.type)==="chart"))return;const c=(u=e.editorManager)===null||u===void 0?void 0:u.completeEdit(o.nativeEvent);Il(c,g=>{var f,p,m,b,C,_,w,y,v,x,S;if(g===!1)return;const R=!((m=(p=(f=h==null?void 0:h.eventArgs)===null||f===void 0?void 0:f.target)===null||p===void 0?void 0:p.role)===null||m===void 0)&&m.startsWith("icon")?h.eventArgs.target:!((b=o.target.role)===null||b===void 0)&&b.startsWith("icon")?o.target:void 0;if(n.downIcon=R,R&&R.attribute.interactive!==!1)R.attribute.funcType===Oe.dragReorder&&(t.startMoveCol(h.eventArgs.col,h.eventArgs.row,h.abstractPos.x,h.abstractPos.y,(x=(v=h.eventArgs)===null||v===void 0?void 0:v.event)===null||x===void 0?void 0:x.nativeEvent),t.updateInteractionState(me.grabing));else{if(n.cellIsHeaderCheck(h))return;if(o.pointerType==="touch"){if(n.touchEnd=!1,n.touchSetTimeout=setTimeout(()=>{n.isTouchdown=!1,n.touchMove=!0,(n.touchEnd||!n.checkColumnResize(h,!0)&&!n.checkRowResize(h,!0))&&(n.touchEnd||!n.checkColumnMover(h))?n.dealTableSelect(h)&&!n.touchEnd&&t.updateInteractionState(me.grabing):t.updateInteractionState(me.grabing)},500),e.hasListeners(j.MOUSEENTER_CELL)){const B=o.path.find(A=>A.role==="cell");(B==null?void 0:B.role)!=="cell"||!O(B.col)||!O(B.row)||B.col===e.stateManager.hover.cellPos.col&&B.row===e.stateManager.hover.cellPos.row||B.col===((C=e.stateManager.hover.cellPosContainHeader)===null||C===void 0?void 0:C.col)&&B.row===((_=e.stateManager.hover.cellPosContainHeader)===null||_===void 0?void 0:_.row)||e.fireListeners(j.MOUSEENTER_CELL,{col:B.col,row:B.row,cellRange:e.getCellRangeRelativeRect({col:B.col,row:B.row}),scaleRatio:e.canvas.getBoundingClientRect().width/e.canvas.offsetWidth,event:o.nativeEvent,target:(w=h==null?void 0:h.eventArgs)===null||w===void 0?void 0:w.target,mergeCellInfo:(y=h.eventArgs)===null||y===void 0?void 0:y.mergeInfo})}n.dealTableHover(h)}else{if(!n.checkCellFillhandle(h)&&(n.checkColumnResize(h,!0)||n.checkRowResize(h,!0)))return e.scenegraph.updateChartState(null),void t.updateInteractionState(me.grabing);if(n.checkColumnMover(h)||n.checkCellFillhandle(h,!0)&&n.dealFillSelect(h))return void t.updateInteractionState(me.grabing);n.dealTableSelect(h)&&t.updateInteractionState(me.grabing)}}if(e.hasListeners(j.MOUSEDOWN_CELL)){const B=Ct(o);B.eventArgs&&e.fireListeners(j.MOUSEDOWN_CELL,{col:B.eventArgs.col,row:B.eventArgs.row,event:o.nativeEvent,target:(S=B==null?void 0:B.eventArgs)===null||S===void 0?void 0:S.target,mergeCellInfo:B.eventArgs.mergeInfo})}})}),e.scenegraph.tableGroup.addEventListener("pointerup",o=>{var s,l,a,d;if(o.button===0){if(t.interactionState==="grabing"){if(t.updateInteractionState(me.default),t.isResizeCol())Fd(e);else if(t.isResizeRow())zd(e);else if(t.isMoveCol()){const u=e.stateManager.endMoveCol();uf(e,u,o.nativeEvent)}else if(t.isSelecting()){e.stateManager.endSelectCells(),e.stateManager.isFillHandle()&&e.stateManager.endFillSelect();const u=Ct(o);if(e.eventManager.isDraging&&u.eventArgs&&e.hasListeners(j.DRAG_SELECT_END)){const h={event:o.nativeEvent,cells:[],col:u.eventArgs.target.col,row:u.eventArgs.target.row,scaleRatio:e.canvas.getBoundingClientRect().width/e.canvas.offsetWidth,target:(s=u==null?void 0:u.eventArgs)===null||s===void 0?void 0:s.target,mergeCellInfo:(l=u.eventArgs)===null||l===void 0?void 0:l.mergeInfo};h.cells=e.getSelectedCellInfos(),e.fireListeners(j.DRAG_SELECT_END,h)}}}else t.interactionState===me.scrolling&&t.updateInteractionState(me.default);if(e.hasListeners(j.MOUSEUP_CELL)){const u=Ct(o);u.eventArgs&&e.fireListeners(j.MOUSEUP_CELL,{col:u.eventArgs.col,row:u.eventArgs.row,event:o.nativeEvent,target:(a=u==null?void 0:u.eventArgs)===null||a===void 0?void 0:a.target,mergeCellInfo:(d=u.eventArgs)===null||d===void 0?void 0:d.mergeInfo})}}}),e.scenegraph.tableGroup.addEventListener("rightdown",o=>{var s,l,a,d;const u=Ct(o);if(u.eventArgs){t.triggerContextMenu(u.eventArgs.col,u.eventArgs.row,u.abstractPos.x,u.abstractPos.y);const{col:h,row:c}=u.eventArgs;if(e.hasListeners(j.CONTEXTMENU_CELL)){const g=e.getCellInfo(h,c);let f,p;if(!((s=u.eventArgs)===null||s===void 0)&&s.target){const b=Ms((l=u.eventArgs)===null||l===void 0?void 0:l.target);b&&(f=b.icon,p=b.position)}const m=Object.assign(Object.assign({},g),{event:o.nativeEvent,cells:[],targetIcon:f?{name:f.name,position:p,funcType:f.attribute.funcType}:void 0,target:(a=u==null?void 0:u.eventArgs)===null||a===void 0?void 0:a.target,mergeCellInfo:(d=u.eventArgs)===null||d===void 0?void 0:d.mergeInfo});B2(e.stateManager.select.ranges,h,c)?m.cells=e.getSelectedCellInfos():m.cells=[[g]],e.fireListeners(j.CONTEXTMENU_CELL,m)}}}),e.scenegraph.tableGroup.addEventListener("pointertap",o=>{var s,l,a,d,u;if(e.stateManager.columnResize.resizing)return;const h=Ct(o);if(!n.touchMove&&o.button===0&&h.eventArgs&&e.hasListeners(j.CLICK_CELL)){const{col:c,row:g}=h.eventArgs,f=e.getCellInfo(c,g);let p,m;if(!((s=h.eventArgs)===null||s===void 0)&&s.target){const C=Ms((l=h.eventArgs)===null||l===void 0?void 0:l.target);C&&(p=C.icon,m=C.position)}const b=Object.assign(Object.assign({},f),{event:o.nativeEvent,federatedEvent:o,cells:[],targetIcon:p?{name:p.name,position:m,funcType:p.attribute.funcType}:void 0,target:(a=h==null?void 0:h.eventArgs)===null||a===void 0?void 0:a.target,mergeCellInfo:(d=h.eventArgs)===null||d===void 0?void 0:d.mergeInfo});e.fireListeners(j.CLICK_CELL,b)}if(!e.stateManager.columnResize.resizing&&!e.stateManager.columnMove.moving&&(n.dealIconClick(o,h),(h==null?void 0:h.eventArgs)&&n.touchSetTimeout&&o.pointerType==="touch")){const c=Ct(o);if(n.touchSetTimeout){clearTimeout(n.touchSetTimeout);const g=!!(!((u=t.select.ranges)===null||u===void 0)&&u.length);n.dealTableSelect(c),t.endSelectCells(!0,g),n.touchSetTimeout=void 0}}}),e.scenegraph.stage.addEventListener("pointerdown",o=>{var s,l,a,d;const u=Ct(o);!((s=u.eventArgs)===null||s===void 0)&&s.target&&((l=u.eventArgs)===null||l===void 0?void 0:l.target)===((a=t.residentHoverIcon)===null||a===void 0?void 0:a.icon)||t.hideMenu();const h=(d=e.editorManager)===null||d===void 0?void 0:d.completeEdit(o.nativeEvent);Il(h,c=>{var g;if(c===!1)return;const f=!((g=o.target.role)===null||g===void 0)&&g.startsWith("icon")?o.target:void 0;if(n.downIcon=f,!(f||n.checkCellFillhandle(u)||t.columnResize.resizing||!n.checkColumnResize(u,!0))){e.scenegraph.updateChartState(null),t.updateInteractionState(me.grabing);const{eventArgs:p}=u;p!=null&&p.targetCell||e.getCellAt(u.abstractPos.x-e.theme.columnResize.resizeHotSpotSize/2,u.abstractPos.y)&&e.hasListeners(j.MOUSEDOWN_TABLE)&&e.fireListeners(j.MOUSEDOWN_TABLE,{event:o.nativeEvent})}})}),e.scenegraph.stage.addEventListener("pointerup",o=>{t.interactionState==="grabing"&&(t.updateInteractionState(me.default),t.isResizeCol()?Fd(e):t.isResizeRow()&&zd(e))}),e.scenegraph.stage.addEventListener("pointertap",o=>{var s,l,a;const d=o.target;if(e.eventManager.isDraging||!d||!d.isDescendantsOf(e.scenegraph.stage)&&d.stage!==d||d.isDescendantsOf(e.scenegraph.tableGroup))e.eventManager.isDraging&&t.isSelecting()&&t.endSelectCells();else{t.updateInteractionState(me.default),n.dealTableHover();const u=!!(!((s=t.select.ranges)===null||s===void 0)&&s.length);((a=(l=e.options.select)===null||l===void 0?void 0:l.blankAreaClickDeselect)===null||a===void 0||a)&&n.dealTableSelect(),t.endSelectCells(!0,u),t.updateCursor(),e.scenegraph.updateChartState(null)}}),e.scenegraph.stage.addEventListener("pointermove",o=>{const s=Ct(o);t.isResizeCol()||n.checkColumnResize(s)?e.stateManager.select&&n.checkCellFillhandle(s)?t.updateCursor("crosshair"):t.updateCursor("col-resize"):t.isResizeRow()||n.checkRowResize(s)?e.stateManager.select&&n.checkCellFillhandle(s)?t.updateCursor("crosshair"):t.updateCursor("row-resize"):t.isMoveCol()||t.updateCursor()}),e.scenegraph.tableGroup.addEventListener("checkbox_state_change",o=>{var s,l;const a=Ct(o),{col:d,row:u}=a.eventArgs,h=e.getCellInfo(d,u),c=at(e,d,u);if(c)for(let f=c.start.col;f<=c.end.col;f++)for(let p=c.start.row;p<=c.end.row;p++)e.scenegraph.getCell(f,p).forEachChildren(m=>{m.name==="checkbox"&&m.setAttributes({checked:o.target.attribute.checked,indeterminate:o.target.attribute.indeterminate})});const g=Object.assign(Object.assign({},h),{event:o.nativeEvent,target:(s=a==null?void 0:a.eventArgs)===null||s===void 0?void 0:s.target,mergeCellInfo:(l=a==null?void 0:a.eventArgs)===null||l===void 0?void 0:l.mergeInfo,checked:o.detail.checked});if(e.isHeader(d,u))e.stateManager.setHeaderCheckedState(h.field,o.detail.checked),e.getCellType(d,u)==="checkbox"&&e.scenegraph.updateCheckboxCellState(d,u,o.detail.checked);else if(e.stateManager.setCheckedState(d,u,h.field,o.detail.checked),e.getCellType(d,u)==="checkbox"){const f=e.stateManager.headerCheckedState[h.field],p=e.stateManager.updateHeaderCheckedState(h.field,d,u);f!==p&&e.scenegraph.updateHeaderCheckboxCellState(d,u,p)}e.fireListeners(j.CHECKBOX_STATE_CHANGE,g),e.scenegraph.updateNextFrame()}),e.scenegraph.tableGroup.addEventListener("radio_checked",o=>{var s,l,a;const d=Ct(o),{col:u,row:h,target:c}=d.eventArgs,g=e.getCellInfo(u,h),f=(s=XH.exec(c.id))===null||s===void 0?void 0:s[1],p=at(e,u,h);if(p)for(let _=p.start.col;_<=p.end.col;_++)for(let w=p.start.row;w<=p.end.row;w++)e.scenegraph.getCell(_,w).forEachChildren(y=>{y.name==="radio"&&y.id===c.id&&y.setAttributes({checked:!0})});const m=e.getBodyColumnDefine(u,h).radioCheckType||"column";if(m==="cell")if(p)for(let _=p.start.col;_<=p.end.col;_++)for(let w=p.start.row;w<=p.end.row;w++)e.scenegraph.getCell(_,w).forEachChildren(y=>{y.name==="radio"&&y.id!==c.id&&y.setAttributes({checked:!1})});else e.scenegraph.getCell(u,h).forEachChildren(_=>{_.name==="radio"&&_.id!==c.id&&_.setAttributes({checked:!1})});else m==="column"&&e.scenegraph.getColGroup(u).forEachChildren(_=>{_.forEachChildren(w=>{w.name==="radio"&&w.id!==c.id&&w.setAttributes({checked:!1})})});const b=f?Number(f):void 0;e.stateManager.setRadioState(u,h,g.field,m,b);const C=Object.assign(Object.assign({},g),{event:o.nativeEvent,target:(l=d==null?void 0:d.eventArgs)===null||l===void 0?void 0:l.target,mergeCellInfo:(a=d==null?void 0:d.eventArgs)===null||a===void 0?void 0:a.mergeInfo,radioIndexInCell:b});e.fireListeners(j.RADIO_STATE_CHANGE,C),e.scenegraph.updateNextFrame()}),e.scenegraph.tableGroup.addEventListener("switch_state_change",o=>{var s,l;const a=Ct(o),{col:d,row:u,target:h}=a.eventArgs,c=e.getCellInfo(d,u),g=at(e,d,u);if(g)for(let p=g.start.col;p<=g.end.col;p++)for(let m=g.start.row;m<=g.end.row;m++)e.scenegraph.getCell(p,m).forEachChildren(b=>{b.name==="switch"&&b.setAttributes({checked:o.target.attribute.checked})});const f=Object.assign(Object.assign({},c),{event:o.nativeEvent,target:(s=a==null?void 0:a.eventArgs)===null||s===void 0?void 0:s.target,mergeCellInfo:(l=a==null?void 0:a.eventArgs)===null||l===void 0?void 0:l.mergeInfo,checked:o.detail.checked});e.stateManager.setCheckedState(d,u,c.field,o.detail.checked),e.fireListeners(j.SWITCH_STATE_CHANGE,f),e.scenegraph.updateNextFrame()}),e.scenegraph.stage.addEventListener("wheel",o=>{var s;o.path.find(l=>l.name==="legend")||((s=e.editorManager)===null||s===void 0||s.completeEdit(),e.eventManager._enableTableScroll&&Ld(o,t))})}function mF(n){const e=n.table;n.gesture=new DB(e.scenegraph.tableGroup,{tap:{interval:300}}),n.gesture.on("doubletap",t=>{bF(t,e)})}function Fd(n){n.stateManager.endResizeCol();const e=[];for(let t=0;t<n.colCount;t++)e.push(n.getColWidth(t));n.fireListeners(j.RESIZE_COLUMN_END,{col:n.stateManager.columnResize.col,colWidths:e})}function zd(n){n.stateManager.endResizeRow(),n.fireListeners(j.RESIZE_ROW_END,{row:n.stateManager.rowResize.row,rowHeight:n.getRowHeight(n.stateManager.rowResize.row)})}function bF(n,e){var t,i,r,o,s,l;const a=Ct(n);let d=-1,u=-1;a.eventArgs&&(d=a.eventArgs.col,u=a.eventArgs.row);const h=e.getCellValue(d,u),c=(i=(t=a.eventArgs)===null||t===void 0?void 0:t.targetCell)===null||i===void 0?void 0:i.globalAABBBounds;if(c&&e.internalProps.focusControl.setFocusRect(new Zn(c.x1+e.scrollLeft,c.y1+e.scrollTop,c.x2-c.x1,c.y2-c.y1),h),e.hasListeners(j.DBLCLICK_CELL)){const g=e.getCellInfo(d,u);let f,p;if(!((r=a.eventArgs)===null||r===void 0)&&r.target){const b=Ms((o=a.eventArgs)===null||o===void 0?void 0:o.target);b&&(f=b.icon,p=b.position)}const m=Object.assign(Object.assign({},g),{event:n.nativeEvent,federatedEvent:n,cells:[],targetIcon:f?{name:f.name,position:p,funcType:f.attribute.funcType}:void 0,target:(s=a==null?void 0:a.eventArgs)===null||s===void 0?void 0:s.target,mergeCellInfo:(l=a==null?void 0:a.eventArgs)===null||l===void 0?void 0:l.mergeInfo});e.fireListeners(j.DBLCLICK_CELL,m)}}function CF(n){const e=n.table,t=e.stateManager,i=e.scenegraph;i.component.vScrollBar.addEventListener("pointerover",s=>{t.showVerticalScrollBar()}),i.component.hScrollBar.addEventListener("pointerover",s=>{t.showHorizontalScrollBar()}),i.component.vScrollBar.addEventListener("pointerout",s=>{t.interactionState!==me.scrolling&&t.hideVerticalScrollBar()}),i.component.hScrollBar.addEventListener("pointerout",s=>{t.interactionState!==me.scrolling&&t.hideHorizontalScrollBar()}),i.component.vScrollBar.addEventListener("pointermove",s=>{i.table.stateManager.updateCursor("default"),s.stopPropagation()}),i.component.vScrollBar.addEventListener("pointerdown",s=>{s.stopPropagation(),i.table.hasListeners(j.MOUSEDOWN_TABLE)&&i.table.fireListeners(j.MOUSEDOWN_TABLE,{event:s.nativeEvent})}),i.component.vScrollBar.addEventListener("scrollDown",s=>{var l;i.table.eventManager.LastBodyPointerXY={x:s.x,y:s.y},i.table.eventManager.isDown=!0,t.interactionState!==me.scrolling&&t.updateInteractionState(me.scrolling),i.table.stateManager.hideMenu(),(l=i.table.editorManager)===null||l===void 0||l.completeEdit(),i.table.hasListeners(j.MOUSEDOWN_TABLE)&&i.table.fireListeners(j.MOUSEDOWN_TABLE,{event:s.nativeEvent})}),i.component.vScrollBar.addEventListener("pointerup",()=>{t.fastScrolling=!1,i.table.eventManager.isDraging=!1,t.interactionState===me.scrolling&&t.updateInteractionState(me.default)}),i.component.vScrollBar.addEventListener("pointerupoutside",()=>{t.fastScrolling=!1,t.interactionState===me.scrolling&&t.updateInteractionState(me.default)}),i.component.vScrollBar.addEventListener("scrollUp",s=>{i.table.eventManager.isDraging=!1}),i.component.hScrollBar.addEventListener("pointermove",s=>{i.table.stateManager.updateCursor("default"),s.stopPropagation()}),i.component.hScrollBar.addEventListener("pointerdown",s=>{s.stopPropagation(),i.table.hasListeners(j.MOUSEDOWN_TABLE)&&i.table.fireListeners(j.MOUSEDOWN_TABLE,{event:s.nativeEvent})}),i.component.hScrollBar.addEventListener("scrollDown",s=>{var l;i.table.eventManager.LastBodyPointerXY={x:s.x,y:s.y},i.table.eventManager.isDown=!0,t.interactionState!==me.scrolling&&t.updateInteractionState(me.scrolling),i.table.stateManager.hideMenu(),(l=i.table.editorManager)===null||l===void 0||l.completeEdit(),i.table.hasListeners(j.MOUSEDOWN_TABLE)&&i.table.fireListeners(j.MOUSEDOWN_TABLE,{event:s.nativeEvent})}),i.component.hScrollBar.addEventListener("pointerup",()=>{t.fastScrolling=!1,i.table.eventManager.isDraging=!1,t.interactionState===me.scrolling&&t.updateInteractionState(me.default)}),i.component.hScrollBar.addEventListener("pointerupoutside",()=>{t.fastScrolling=!1,t.interactionState===me.scrolling&&t.updateInteractionState(me.default)}),i.component.hScrollBar.addEventListener("scrollUp",s=>{i.table.eventManager.isDraging=!1});const r=Bb(t.updateVerticalScrollBar,20),o=Bb(t.updateHorizontalScrollBar,20);i.component.vScrollBar.addEventListener("scrollDrag",s=>{i.table.eventManager.isDown&&(i.table.eventManager.isDraging=!0),t.fastScrolling=!0,t.interactionState!==me.scrolling&&t.updateInteractionState(me.scrolling);const l=s.detail.value[0]/(1-s.detail.value[1]+s.detail.value[0]);r(l,s)}),i.component.hScrollBar.addEventListener("scrollDrag",s=>{i.table.eventManager.isDown&&(i.table.eventManager.isDraging=!0),t.fastScrolling=!0,t.interactionState!==me.scrolling&&t.updateInteractionState(me.scrolling);const l=s.detail.value[0]/(1-s.detail.value[1]+s.detail.value[0]);o(l)})}let gr=1;function Ey(){return Aw?gr=1:(gr=Math.ceil(window.devicePixelRatio||1),gr>1&&gr%2!=0&&(gr+=1)),gr}Ey();var _F=function(n,e,t,i){return new(t||(t=Promise))(function(r,o){function s(d){try{a(i.next(d))}catch(u){o(u)}}function l(d){try{a(i.throw(d))}catch(u){o(u)}}function a(d){var u;d.done?r(d.value):(u=d.value,u instanceof t?u:new t(function(h){h(u)})).then(s,l)}a((i=i.apply(n,e||[])).next())})};function wF(n){const e=n.table,t=e.stateManager,i=e.internalProps.handler;function r(f){var p;if(e.hasListeners(j.KEYDOWN)){const m={keyCode:(p=f.keyCode)!==null&&p!==void 0?p:f.which,code:f.code,event:f,scaleRatio:e.canvas.getBoundingClientRect().width/e.canvas.offsetWidth};e.fireListeners(j.KEYDOWN,m)}}i.on(e.getElement(),"blur",f=>{n.dealTableHover()}),i.on(e.getElement(),"keydown",f=>{var p,m,b,C,_,w,y,v,x,S,R,B,A,M,H,E,T,P,k,L;if(f.key==="a"&&(f.ctrlKey||f.metaKey))!((p=e.keyboardOptions)===null||p===void 0)&&p.selectAllOnCtrlA&&(f.preventDefault(),n.deelTableSelectAll());else if(t.select.cellPos.col>=0&&t.select.cellPos.row>=0&&(f.key==="ArrowUp"||f.key==="ArrowDown"||f.key==="ArrowLeft"||f.key==="ArrowRight")){if(((b=(m=e.options.keyboardOptions)===null||m===void 0?void 0:m.moveEditCellOnArrowKeys)===null||b===void 0||!b)&&(!((C=e.editorManager)===null||C===void 0)&&C.editingEditor)||((_=e.options.keyboardOptions)===null||_===void 0?void 0:_.moveSelectedCellOnArrowKeys)===!1)return;let F,z;if(f.preventDefault(),f.stopPropagation(),f.key==="ArrowUp"?f.ctrlKey||f.metaKey?(F=t.select.cellPos.col,z=0):(f.shiftKey,F=t.select.cellPos.col,z=Math.min(e.rowCount-1,Math.max(0,t.select.cellPos.row-1))):f.key==="ArrowDown"?f.ctrlKey||f.metaKey?(F=t.select.cellPos.col,z=e.rowCount-1):(f.shiftKey,F=t.select.cellPos.col,z=Math.min(e.rowCount-1,Math.max(0,t.select.cellPos.row+1))):f.key==="ArrowLeft"?f.ctrlKey||f.metaKey?(F=0,z=t.select.cellPos.row):(f.shiftKey,z=t.select.cellPos.row,F=Math.min(e.colCount-1,Math.max(0,t.select.cellPos.col-1))):f.key==="ArrowRight"&&(f.ctrlKey||f.metaKey?(F=e.colCount-1,z=t.select.cellPos.row):(f.shiftKey,z=t.select.cellPos.row,F=Math.min(e.colCount-1,Math.max(0,t.select.cellPos.col+1)))),Yi(e,F,z))return;e.selectCell(F,z,f.shiftKey),(y=(w=e.options.keyboardOptions)===null||w===void 0?void 0:w.moveEditCellOnArrowKeys)!==null&&y!==void 0&&y&&(!((v=e.editorManager)===null||v===void 0)&&v.editingEditor)&&(e.editorManager.completeEdit(),e.getElement().focus(),e.getEditor(F,z)&&e.editorManager.startEditCell(F,z))}else if(f.key==="Escape")(x=e.editorManager)===null||x===void 0||x.cancelEdit(),e.getElement().focus();else if(f.key==="Enter"){if(!((S=e.editorManager)===null||S===void 0)&&S.editingEditor){if(r(f),e.editorManager.completeEdit(),e.getElement().focus(),((R=e.options.keyboardOptions)===null||R===void 0?void 0:R.moveFocusCellOnEnter)===!0){const F=t.select.cellPos.col,z=Math.min(e.rowCount-1,Math.max(0,t.select.cellPos.row+1));if(Yi(e,F,z))return;e.selectCell(F,z,f.shiftKey)}return}if(((B=e.options.keyboardOptions)===null||B===void 0?void 0:B.moveFocusCellOnEnter)===!0){const F=t.select.cellPos.col,z=Math.min(e.rowCount-1,Math.max(0,t.select.cellPos.row+1));if(Yi(e,F,z))return;e.selectCell(F,z,f.shiftKey)}else if(((M=(A=e.options.keyboardOptions)===null||A===void 0?void 0:A.editCellOnEnter)===null||M===void 0||M)&&((E=(H=e.stateManager.select.ranges)===null||H===void 0?void 0:H.length)!==null&&E!==void 0?E:0)===1){const F=e.stateManager.select.ranges[0].start.col,z=e.stateManager.select.ranges[0].start.row,I=e.stateManager.select.ranges[0].end.col,N=e.stateManager.select.ranges[0].end.row;F===I&&z===N&&e.getEditor(F,z)&&e.editorManager.startEditCell(F,z)}}else if(f.key==="Tab"){if(((P=(T=e.options.keyboardOptions)===null||T===void 0?void 0:T.moveFocusCellOnTab)===null||P===void 0||P)&&t.select.cellPos.col>=0&&t.select.cellPos.row>=0){if(t.select.cellPos.col===e.colCount-1&&t.select.cellPos.row===e.rowCount-1)return;let F,z;if(f.preventDefault(),t.select.cellPos.col===e.colCount-1?(z=Math.min(e.rowCount-1,t.select.cellPos.row+1),F=e.rowHeaderLevelCount):(z=t.select.cellPos.row,F=t.select.cellPos.col+1),Yi(e,F,z))return;e.selectCell(F,z),!((k=e.editorManager)===null||k===void 0)&&k.editingEditor&&(e.editorManager.completeEdit(),e.getElement().focus(),e.getEditor(F,z)&&e.editorManager.startEditCell(F,z))}}else if(!(f.ctrlKey||f.metaKey||f.shiftKey)){const F=e.options.editCellTrigger;if((F==="keydown"||Array.isArray(F)&&F.includes("keydown"))&&!(!((L=e.editorManager)===null||L===void 0)&&L.editingEditor)){const z=/^[a-zA-Z0-9+\-*\/%=.,\s]$/;f.key.match(z)&&e.editorManager.startEditCell(t.select.cellPos.col,t.select.cellPos.row,"")}}r(f)}),i.on(e.getElement(),"copy",f=>_F(this,void 0,void 0,function*(){var p,m;if(!((p=e.keyboardOptions)===null||p===void 0)&&p.copySelected){const b=e.getCopyValue();if(O(b)){f.preventDefault();const C=yield navigator.permissions.query({name:"clipboard-write"});if(!((m=navigator.clipboard)===null||m===void 0)&&m.write&&C.state==="granted"){const _=y=>{const v=["<table>"],x=['<meta name="author" content="Visactor"/>','<style type="text/css">td{white-space:normal}br{mso-data-placement:same-cell}</style>'].join(""),S=y.split(`\r
`);return S.forEach(function(R,B){const A=R.split("	"),M=[];B===0&&v.push("<tbody>"),A.forEach(function(H,E){const T=H?H.toString().replace(/&/g,"&amp;").replace(/'/g,"&#39;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\n/g,"<br>").replace(/(<br(\s*|\/)>(\r\n|\n)?|\r\n|\n)/g,`<br>\r
`).replace(/\x20{2,}/gi,P=>`<span style="mso-spacerun: yes">${"&nbsp;".repeat(P.length-1)} </span>`).replace(/\t/gi,"&#9;"):" ";M.push(`<td>${T}</td>`)}),v.push("<tr>",...M,"</tr>"),B===S.length-1&&v.push("</tbody>")}),v.push("</table>"),[x,v.join("")].join("")},w=_(b);navigator.clipboard.write([new ClipboardItem({"text/html":new Blob([w],{type:"text/html"}),"text/plain":new Blob([b],{type:"text/plain"})})])}else T2.IE?window.clipboardData.setData("Text",b):f.clipboardData.setData("text/plain",b);e.fireListeners(j.COPY_DATA,{cellRange:e.stateManager.select.ranges,copyData:b})}}})),i.on(e.getElement(),"paste",f=>{var p,m,b,C;if(!((p=e.keyboardOptions)===null||p===void 0)&&p.pasteValueToCell&&e.changeCellValues){if(!((m=e.editorManager)===null||m===void 0)&&m.editingEditor)return;if(((b=e.stateManager.select.ranges)===null||b===void 0?void 0:b.length)>0)if(!((C=navigator.clipboard)===null||C===void 0)&&C.read)navigator.clipboard.read().then(_=>{for(const w of _)w.types.includes("text/html")?l(w):w.types.length===1&&w.types[0]==="text/plain"&&d(w)});else{const _=e.stateManager.select.ranges,w=Math.min(_[0].start.col,_[0].end.col),y=Math.min(_[0].start.row,_[0].end.row),v=(f.clipboardData||window.Clipboard).getData("text").split(`
`),x=[];v.forEach(function(S,R){const B=S.split("	"),A=[];x.push(A),B.forEach(function(M,H){H===B.length-1&&(M=M.trim()),A.push(M)})}),e.changeCellValues(w,y,x)}}}),i.on(e.getElement(),"contextmenu",f=>{var p;((p=e.eventOptions)===null||p===void 0?void 0:p.preventDefaultContextMenu)!==!1&&f.preventDefault()}),e.options.canvas||i.on(e.getContainer(),"resize",f=>{var p;e.isReleased||f.width===0&&f.height===0||((e.autoFillWidth||e.autoFillHeight)&&((p=e.editorManager)===null||p===void 0||p.completeEdit()),O(e.options.pixelRatio)||e.setPixelRatio(Ey()),f.windowSizeNotChange||e.resize())});const o=/<tr[^>]*>([\s\S]*?)<\/tr>/g,s=/<td[^>]*>([\s\S]*?)<\/td>/g;function l(f){const p=e.stateManager.select.ranges,m=p.length,b=Math.min(p[m-1].start.col,p[m-1].end.col),C=Math.min(p[m-1].start.row,p[m-1].end.row),_=Math.max(p[m-1].start.col,p[m-1].end.col),w=Math.max(p[m-1].start.row,p[m-1].end.row);let y=0,v=0,x=[];f.getType("text/html").then(S=>{S.text().then(R=>{var B,A;if(R&&/(<table)|(<TABLE)/g.test(R)){const M=Array.from(R.matchAll(o));for(const H of M){const E=H[1],T=Array.from(E.matchAll(s)).map(P=>P[1].replace(/(<(?!br)([^>]+)>)/gi,"").replace(/<br(\s*|\/)>[\r\n]?/gim,`
`).replace(/&amp;/g,"&").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&#9;/gi,"	").replace(/&nbsp;/g," "));x.push(T),y=Math.max(y,(B=T==null?void 0:T.length)!==null&&B!==void 0?B:0)}v=(A=x.length)!==null&&A!==void 0?A:0,x=u(x,v,y,w-C+1,_-b+1),e.changeCellValues(b,C,x,!0)}else navigator.clipboard.read().then(M=>{for(const H of M)H.types.includes("text/plain")&&H.getType("text/plain").then(E=>{E.text().then(a)})})})})}function a(f){var p;const m=e.stateManager.select.ranges,b=m.length,C=Math.min(m[b-1].start.col,m[b-1].end.col),_=Math.min(m[b-1].start.row,m[b-1].end.row),w=Math.max(m[b-1].start.col,m[b-1].end.col),y=Math.max(m[b-1].start.row,m[b-1].end.row);let v=0,x=0,S=[];f.split(`
`).forEach(function(R,B){var A;const M=R.split("	"),H=[];S.push(H),M.forEach(function(E,T){T===M.length-1&&(E=E.trim()),H.push(E)}),v=Math.max(v,(A=H==null?void 0:H.length)!==null&&A!==void 0?A:0)}),x=(p=S.length)!==null&&p!==void 0?p:0,S=u(S,x,v,y-_+1,w-C+1),e.changeCellValues(C,_,S,!0)}function d(f){const p=e.stateManager.select.ranges,m=p.length,b=Math.min(p[m-1].start.col,p[m-1].end.col),C=Math.min(p[m-1].start.row,p[m-1].end.row),_=Math.max(p[m-1].start.col,p[m-1].end.col),w=Math.max(p[m-1].start.row,p[m-1].end.row);let y=0,v=0;f.getType("text/plain").then(x=>{x.text().then(S=>{var R;const B=S.replace(/\r(?!\n)/g,`\r
`).split(`\r
`);let A=[];B.length>1&&B[B.length-1]===""&&B.pop(),B.forEach(function(M,H){var E;const T=M.split("	"),P=[];A.push(P),T.forEach(function(k,L){k.includes(`
`)&&(k=k.replace(/^"(.*)"$/,"$1").replace(/["]*/g,F=>new Array(Math.floor(F.length/2)).fill('"').join(""))),P.push(k)}),y=Math.max(y,(E=P==null?void 0:P.length)!==null&&E!==void 0?E:0)}),v=(R=A.length)!==null&&R!==void 0?R:0,A=u(A,v,y,w-C+1,_-b+1),e.changeCellValues(b,C,A,!0)})})}function u(f,p,m,b,C){if(C>m||b>p){if(C%m==0&&b%p==0){const _=[];for(let w=0;w<b;w++){const y=[];_.push(y);for(let v=0;v<C;v++){const x=w%p,S=v%m;y.push(f[x][S])}}return _}return f}return f}const h=f=>{e.eventManager.LastBodyPointerXY={x:f.x,y:f.y},e.eventManager.isDown=!0};n.globalEventListeners.push({name:"pointerdown",env:"body",callback:h}),document.body.addEventListener("pointerdown",h);const c=f=>{if(f.target!==e.canvas&&(p=>{var m,b;if(t.menu.isShow&&setTimeout(()=>{e.internalProps.menuHandler.pointInMenuElement(p.clientX,p.clientY)||t.menu.isShow&&t.hideMenu()},0),t.isResizeCol())Fd(e);else if(t.isResizeRow())zd(e);else if(t.isMoveCol()){const C=e.stateManager.endMoveCol();uf(e,C,p)}else if(t.isSelecting()&&(!((b=(m=e.stateManager.select)===null||m===void 0?void 0:m.ranges)===null||b===void 0)&&b.length)){const C=e.stateManager.select.ranges[e.stateManager.select.ranges.length-1].end.col,_=e.stateManager.select.ranges[e.stateManager.select.ranges.length-1].end.row;if(e.stateManager.endSelectCells(),e.hasListeners(j.DRAG_SELECT_END)){const w={event:p,cells:[],col:C,row:_,scaleRatio:e.canvas.getBoundingClientRect().width/e.canvas.offsetWidth,target:void 0};w.cells=e.getSelectedCellInfos(),e.fireListeners(j.DRAG_SELECT_END,w)}}})(f),e.eventManager.LastBodyPointerXY=null,e.eventManager.isDown=!1,e.eventManager.isDraging=!1,e.eventManager.inertiaScroll.endInertia(),t.interactionState==="grabing"&&t.isResizeCol())Fd(e);else if(t.interactionState==="grabing"&&t.isResizeRow())zd(e);else if(t.isMoveCol()){const p=e.stateManager.endMoveCol();uf(e,p,f)}};n.globalEventListeners.push({name:"pointerup",env:"document",callback:c}),document.addEventListener("pointerup",c);const g=f=>{var p,m,b,C,_;if(e.eventManager.isDown&&e.eventManager.LastBodyPointerXY){const x=(m=(p=e.eventManager.LastBodyPointerXY)===null||p===void 0?void 0:p.x)!==null&&m!==void 0?m:f.x,S=(C=(b=e.eventManager.LastBodyPointerXY)===null||b===void 0?void 0:b.y)!==null&&C!==void 0?C:f.y;(Math.abs(x-f.x)>1||Math.abs(S-f.y)>1)&&(e.eventManager.isDraging=!0)}const{x:w,y}=e._getMouseAbstractPoint(f,!1);t.interactionState===me.grabing&&(t.isResizeCol()?(n.dealColumnResize(w,y),e.hasListeners(j.RESIZE_COLUMN)&&e.fireListeners(j.RESIZE_COLUMN,{col:e.stateManager.columnResize.col,colWidth:e.getColWidth(e.stateManager.columnResize.col)})):t.isResizeRow()&&(n.dealRowResize(w,y),e.hasListeners(j.RESIZE_ROW)&&e.fireListeners(j.RESIZE_ROW,{row:e.stateManager.rowResize.row,rowHeight:e.getRowHeight(e.stateManager.rowResize.row)})));const v=e.stateManager.isSelecting();if(n._enableTableScroll&&n.isDraging&&v&&((_=e.stateManager.select.ranges)===null||_===void 0?void 0:_.length)>0){const x=e.getDrawRange(),S=e.getFrozenRowsHeight(),R=e.getBottomFrozenRowsHeight(),B=e.getFrozenColsWidth(),A=e.getRightFrozenColsWidth(),M=e.stateManager.select.ranges[e.stateManager.select.ranges.length-1].start;if(e.isSeriesNumber(M.col,M.row))return;const H=e.stateManager.select.ranges[e.stateManager.select.ranges.length-1].end,E=(e.isFrozenRow(M.row)===!1||e.isFrozenRow(H.row)===!1)&&e.getAllRowsHeight()>e.tableNoFrameHeight,T=(e.isFrozenColumn(M.col)===!1||e.isFrozenColumn(H.col)===!1)&&e.getAllColsWidth()>e.tableNoFrameWidth;if((y>x.bottom-R||y<x.top+S)&&E||(w>x.right-A||w<x.left+B)&&T){e.eventManager.scrollXSpeed=0,e.eventManager.scrollYSpeed=0;let P=!1,k=!1,L=!1,F=!1;y>x.bottom-R&&E&&e.scrollTop+e.tableNoFrameHeight<e.getAllRowsHeight()?(P=!0,e.eventManager.scrollYSpeed=-(y-x.bottom+R)/50):y<x.top+S&&E&&e.scrollTop>0&&(k=!0,e.eventManager.scrollYSpeed=-(y-x.top-S)/50),w>x.right-A&&T&&e.scrollLeft+e.tableNoFrameWidth<e.getAllColsWidth()?(L=!0,e.eventManager.scrollXSpeed=-(w-x.right+A)/50):w<x.left+B&&T&&e.scrollLeft>0&&(F=!0,e.eventManager.scrollXSpeed=-(w-x.left-B)/50),e.eventManager.inertiaScroll.startInertia(e.eventManager.scrollXSpeed,e.eventManager.scrollYSpeed,1),e.eventManager.inertiaScroll.setScrollHandle((z,I)=>{let N,W;Ld({deltaX:-z,deltaY:-I},e.stateManager,!1),P?W=e.scrollTop+x.height-R-20:k&&(W=e.scrollTop+S+20),L?N=e.scrollLeft+x.width-A-20:F&&(N=e.scrollLeft+B+20);let D=!1,G=!1;L||F||(w>e.tableNoFrameWidth-e.getRightFrozenColsWidth()&&w<e.tableNoFrameWidth||w>0&&w<e.getFrozenColsWidth()?(N=w,G=!0):N=e.scrollLeft+w),P||k||(y>e.tableNoFrameHeight-e.getBottomFrozenRowsHeight()&&y<e.tableNoFrameHeight||y>0&&y<e.getFrozenRowsHeight()?(W=y,D=!0):W=e.scrollTop+y),e.stateManager.updateInteractionState(me.grabing);const V=e.getTargetColAtConsiderRightFrozen(N,G),X=e.getTargetRowAtConsiderBottomFrozen(W,D);O(V)&&O(X)&&e.stateManager.updateSelectPos(V.col,X.row,!1,!1,!1,!1)})}else e.eventManager.inertiaScroll.isInertiaScrolling()?e.eventManager.inertiaScroll.endInertia():e.eventManager.scrollYSpeed=0}};n.globalEventListeners.push({name:"pointermove",env:"body",callback:g}),document.body.addEventListener("pointermove",g)}function yF(n){const e=n.table,t=e.stateManager,i=e.scenegraph;n.touchMovePoints=[],e.scenegraph.tableGroup.addEventListener("touchstart",l=>{l.target.isChildOf(i.component.vScrollBar)||l.target.isChildOf(i.component.vScrollBar)||(n.isTouchdown=!0,n.touchMovePoints.push({x:l.page.x,y:l.page.y,timestamp:Date.now()}))});const r=l=>{var a,d;if(n.touchMove&&l.preventDefault(),n.isTouchdown&&FC(l)){if(((d=(a=n.downIcon)===null||a===void 0?void 0:a.attribute)===null||d===void 0?void 0:d.funcType)===Oe.dragReorder)l.preventDefault();else if(n.touchMovePoints.length>4&&n.touchMovePoints.shift(),n.touchMovePoints.push({x:l.changedTouches[0].pageX,y:l.changedTouches[0].pageY,timestamp:Date.now()}),n._enableTableScroll){const u=-n.touchMovePoints[n.touchMovePoints.length-1].x+n.touchMovePoints[n.touchMovePoints.length-2].x,h=-n.touchMovePoints[n.touchMovePoints.length-1].y+n.touchMovePoints[n.touchMovePoints.length-2].y;Ld({deltaX:u,deltaY:h},t),l.cancelable&&(e.internalProps.overscrollBehavior==="none"||Math.abs(h)>=Math.abs(u)&&h!==0&&Hy(h,t)||Math.abs(h)<=Math.abs(u)&&u!==0&&ky(u,t))&&l.preventDefault()}}};window.addEventListener("touchmove",r,{passive:!1}),n.globalEventListeners.push({name:"touchmove",env:"window",callback:r});const o=l=>{var a,d,u,h;if(n.touchEnd=!0,n.touchMove=!1,n.isTouchdown&&FC(l)){if(((d=(a=n.downIcon)===null||a===void 0?void 0:a.attribute)===null||d===void 0?void 0:d.funcType)===Oe.dragReorder)l.preventDefault();else if(!((u=n.touchMovePoints)===null||u===void 0)&&u.length&&(n.touchMovePoints.length>4&&n.touchMovePoints.shift(),n.touchMovePoints.push({x:l.changedTouches[0].pageX,y:l.changedTouches[0].pageY,timestamp:Date.now()}),n._enableTableScroll)){const c=n.touchMovePoints[0],g=n.touchMovePoints[((h=n.touchMovePoints)===null||h===void 0?void 0:h.length)-1],f=(g.x-c.x)/(g.timestamp-c.timestamp),p=(g.y-c.y)/(g.timestamp-c.timestamp);n.inertiaScroll.startInertia(f,p,.95),e.eventManager.inertiaScroll.setScrollHandle((m,b)=>{Ld({deltaX:-m,deltaY:-b},e.stateManager)})}n.isTouchdown=!1,n.touchMovePoints=[]}};window.addEventListener("touchend",o),n.globalEventListeners.push({name:"touchend",env:"window",callback:o});const s=l=>{n.touchEnd=!0,n.touchMove=!1,n.isTouchdown&&(n.isTouchdown=!1,n.touchMovePoints=[])};window.addEventListener("touchcancel",s),n.globalEventListeners.push({name:"touchcancel",env:"window",callback:s})}function FC(n){return!!n.changedTouches}function vF(n){n.isPivotChart()&&n.scenegraph.tableGroup.addEventListener("click",e=>{var t;if(!n.stateManager.columnMove.moving&&!n.stateManager.columnResize.resizing)if(e.target.name==="axis-label"){const i=Ct(e),{col:r,row:o}=i.eventArgs,s=n.internalProps.layoutMap;let l,a;s.indicatorsAsCol?(l=s.getDimensionKeyInChartSpec(s.rowHeaderLevelCount,o),a=s.getCellHeaderPaths(s.rowHeaderLevelCount-2,o).rowHeaderPaths):(l=s.getDimensionKeyInChartSpec(r,s.columnHeaderLevelCount),a=s.getCellHeaderPaths(r,s.columnHeaderLevelCount-1).colHeaderPaths);const d=a.map(u=>({key:u.dimensionKey,value:u.value})).filter(u=>u.key);if(d.push({key:l,value:e.target.attribute.text}),n._selectedDimensionInChart.length&&SF(n._selectedDimensionInChart,d))return;n._selectedDimensionInChart=d,s.updateDataStateToChartInstance(),af(n.scenegraph),n.scenegraph.updateNextFrame()}else!((t=n._selectedDimensionInChart)===null||t===void 0)&&t.length&&(n._selectedDimensionInChart.length=0,n.internalProps.layoutMap.updateDataStateToChartInstance(),af(n.scenegraph),n.scenegraph.updateNextFrame())})}function SF(n,e){if(n.length!==e.length)return!1;for(let t=0;t<n.length;t++)if(n[t].key!==e[t].key||n[t].value!==e[t].value)return!1;return!0}function xF(n){n.isPivotChart()&&(n.on(j.MOUSEENTER_CELL,e=>{n.scenegraph.getCell(e.col,e.row).forEachChildren(t=>{if(t.name==="axis"){const i=zC(e.col,e.row,n.internalProps.layoutMap);e.axisPosition=i,n.fireListeners(j.MOUSEENTER_AXIS,e)}})}),n.on(j.MOUSELEAVE_CELL,e=>{n.scenegraph.getCell(e.col,e.row).forEachChildren(t=>{if(t.name==="axis"){const i=zC(e.col,e.row,n.internalProps.layoutMap);e.axisPosition=i,n.fireListeners(j.MOUSELEAVE_AXIS,e)}})}))}function zC(n,e,t){if(t.indicatorsAsCol){if(t.hasTwoIndicatorAxes&&e===t.columnHeaderLevelCount-1&&n>=t.rowHeaderLevelCount&&n<t.colCount-t.rightFrozenColCount)return"top";if(e===t.rowCount-t.bottomFrozenRowCount&&n>=t.rowHeaderLevelCount&&n<t.colCount-t.rightFrozenColCount)return"bottom";if(n===t.rowHeaderLevelCount-1&&e>=t.rowHeaderLevelCount&&e<t.rowCount-t.bottomFrozenRowCount)return"left"}else{if(n===t.rowHeaderLevelCount-1&&e>=t.columnHeaderLevelCount&&e<t.rowCount-t.bottomFrozenRowCount)return"left";if(n===t.colCount-t.rightFrozenColCount&&e>=t.columnHeaderLevelCount&&e<t.rowCount-t.bottomFrozenRowCount)return"right";if(e===t.rowCount-t.bottomFrozenRowCount&&n>=t.rowHeaderLevelCount&&n<t.colCount-t.rightFrozenColCount)return"bottom"}return"bottom"}function RF(n){n.on("checkbox_state_change",e=>{var t;if(((t=n.internalProps.rowSeriesNumber)===null||t===void 0?void 0:t.enableTreeCheckbox)!==!0)return;const{col:i,row:r,checked:o}=e,s=n.getCellOriginRecord(i,r),l=n.dataSource.currentPagerIndexedData,a=n.getRecordShowIndexByCell(i,r);let d=l[a];if(J(d)&&(d=[d]),s.vtableMerge)if(o)n.getHierarchyState(i,r)===be.collapse?OC(!0,d,n):IC(!0,a,d,l,n),hh(a,d,l,n);else{n.getHierarchyState(i,r)===be.collapse?OC(!1,d,n):IC(!1,a,d,l,n),hh(a,d,l,n);const u=n.stateManager.headerCheckedState._vtable_rowSeries_number,h=n.stateManager.updateHeaderCheckedState("_vtable_rowSeries_number",i,r);u!==h&&n.scenegraph.updateHeaderCheckboxCellState(i,r,h)}else hh(a,d,l,n)})}function IC(n,e,t,i,r){var o;let s=e+1;for(;ee(i[s])&&((o=i[s])===null||o===void 0?void 0:o.length)>t.length;){const l=r.columnHeaderLevelCount+s;r.stateManager.setCheckedState(0,l,"_vtable_rowSeries_number",n),ia(0,l,n,r),s++}}function hh(n,e,t,i){var r;let o=e.length-1;if(o>0){let s=n-1;for(;o>0&&s>=0;)(ee(t[s])&&((r=t[s])===null||r===void 0?void 0:r.length)===o||o===1&&J(t[s]))&&(AF(0,i.columnHeaderLevelCount+s,t[s],i),o--),s--}}function AF(n,e,t,i){const{checkedState:r}=i.stateManager,o=t.toString(),s=ee(t)?t.length:1;let l=!1;const a=[];if(r.forEach((h,c)=>{l&&(c.split(",").length===s?l=!1:a.push(h._vtable_rowSeries_number)),c===o&&(l=!0)}),a.length===0)return;const d=a.every(h=>!!h),u=a.every(h=>!h);d?(i.stateManager.setCheckedState(n,e,"_vtable_rowSeries_number",!0),ia(n,e,!0,i)):u?(i.stateManager.setCheckedState(n,e,"_vtable_rowSeries_number",!1),ia(n,e,!1,i)):(i.stateManager.setCheckedState(n,e,"_vtable_rowSeries_number","indeterminate"),ia(n,e,"indeterminate",i))}function OC(n,e,t){const{checkedState:i}=t.stateManager,r=e.toString(),o=ee(e)?e.length:1;let s=!1;i.forEach((l,a)=>{s&&(a.split(",").length===o?s=!1:l._vtable_rowSeries_number=n),a===r&&(s=!0)})}function BF(n){n.on(j.CLICK_CELL,e=>{const{col:t,row:i,target:r}=e;r.name!=="button"||r.attribute.disable||n.hasListeners(j.BUTTON_CLICK)&&n.fireListeners(j.BUTTON_CLICK,{col:t,row:i,event:e.event})})}class MF{constructor(e){this.isDown=!1,this.isDraging=!1,this.globalEventListeners=[],this._enableTableScroll=!0,this.table=e,this.handleTextStickBindId=[],this.inertiaScroll=new gF(e.stateManager),Me.mode==="node"||e.options.disableInteraction||(this.bindOuterEvent(),setTimeout(()=>{this.bindSelfEvent()},0))}bindOuterEvent(){pF(this),wF(this),CF(this),yF(this),mF(this)}updateEventBinder(){setTimeout(()=>{var e;this.table.isReleased||(mC(this.table)&&((e=this.handleTextStickBindId)===null||e===void 0?void 0:e.length)===0?(this.handleTextStickBindId.push(this.table.on(j.SCROLL,t=>{Bs(this.table)})),this.handleTextStickBindId.push(this.table.on(j.RESIZE_COLUMN_END,t=>{Bs(this.table)})),this.handleTextStickBindId.push(this.table.on(j.RESIZE_ROW_END,t=>{Bs(this.table)}))):!mC(this.table)&&this.handleTextStickBindId&&(this.handleTextStickBindId.forEach(t=>{this.table.off(t)}),this.handleTextStickBindId=[]),LC(this.table))},0)}bindSelfEvent(){if(this.table.isReleased)return;const e=this.table.stateManager;this.table.on(j.ICON_CLICK,t=>{var i;const{col:r,row:o,x:s,y:l,funcType:a,icon:d,event:u}=t;if(a===Oe.dropDown)e.triggerDropDownMenu(r,o,s,l,u);else if(a===Oe.sort)e.triggerSort(r,o,d,u);else if(a===Oe.frozen)e.triggerFreeze(r,o,d);else if(a===Oe.drillDown)lF(this.table);else if(a===Oe.collapse||a===Oe.expand){const h=!!(!((i=e.select.ranges)===null||i===void 0)&&i.length);e.updateSelectPos(-1,-1),e.endSelectCells(!0,h),this.table.toggleHierarchyState(r,o)}}),this.table.on(j.DROPDOWN_MENU_CLICK,()=>{e.hideMenu()}),this.updateEventBinder(),oF(this.table),this.table.on(j.DBLCLICK_CELL,t=>{var i,r,o;if(t.federatedEvent){const s=Ct(t.federatedEvent),l=this.table.scenegraph.getResizeColAt(s.abstractPos.x,s.abstractPos.y,(i=s.eventArgs)===null||i===void 0?void 0:i.targetCell),a=(r=this.table.options.disableDblclickAutoResizeColWidth)!==null&&r!==void 0?r:(o=this.table.options.resize)===null||o===void 0?void 0:o.disableDblclickAutoResizeColWidth;if(this.table.eventManager.checkCellFillhandle(s))this.table.fireListeners(j.DBLCLICK_FILL_HANDLE,{});else if(this.table._canResizeColumn(l.col,l.row)&&l.col>=0&&!a){this.table.scenegraph.updateAutoColWidth(l.col),this.table.internalProps._widthResizedColMap.add(l.col),this.table.scenegraph.updateChartSizeForResizeColWidth(l.col);const d=this.table.stateManager;d.columnResize.col<d.table.frozenColCount&&!d.table.isPivotTable()&&!d.table.transpose&&d.table.scenegraph.component.setFrozenColumnShadow(d.table.frozenColCount-1,d.columnResize.isRightFrozen);const u=[];for(let h=0;h<this.table.colCount;h++)u.push(this.table.getColWidth(h));this.table.fireListeners(j.RESIZE_COLUMN_END,{col:l.col,colWidths:u})}}}),this.table.isPivotTable()&&aF(this.table)&&sF(this.table),LC(this.table),vF(this.table),xF(this.table),RF(this.table),BF(this.table)}dealTableHover(e){if(!e)return void this.table.stateManager.updateHoverPos(-1,-1);const{eventArgs:t}=e;t?this.table.stateManager.updateHoverPos(t.col,t.row):this.table.stateManager.updateHoverPos(-1,-1)}dealIconHover(e){const{eventArgs:t}=e;t?this.table.stateManager.updateHoverIcon(t.col,t.row,t.target,t.targetCell):this.table.stateManager.updateHoverIcon(-1,-1,void 0,void 0)}dealMenuHover(e){}dealTableSelect(e,t){var i,r,o,s,l;if(!e)return this.table.stateManager.updateSelectPos(-1,-1),!1;const{eventArgs:a}=e;if(a){if(a.target.name==="checkbox"||a.target.name==="radio"||a.target.name==="switch"||a.target.name==="button")return!1;if(this.table.isHeader(a.col,a.row)&&Yi(this.table,a.col,a.row))return t||this.table.stateManager.updateSelectPos(-1,-1),!1;if(!this.table.isHeader(a.col,a.row)&&Yi(this.table,a.col,a.row)){if(!t){const d=!!(!((i=this.table.stateManager.select.ranges)===null||i===void 0)&&i.length);this.table.stateManager.updateSelectPos(-1,-1),d&&this.table.stateManager.endSelectCells(!0,d)}return!1}return!this.table.isPivotChart()||((r=e==null?void 0:e.eventArgs)===null||r===void 0?void 0:r.target.name)!=="axis-label"&&((o=e==null?void 0:e.eventArgs)===null||o===void 0?void 0:o.target.type)!=="chart"?(this.table.stateManager.updateSelectPos(a.col,a.row,a.event.shiftKey,a.event.ctrlKey||a.event.metaKey,!1,!t&&((l=(s=this.table.options.select)===null||s===void 0?void 0:s.makeSelectCellVisible)===null||l===void 0||l)),!0):(this.table.stateManager.updateSelectPos(-1,-1),!1)}return!1}dealFillSelect(e,t){var i,r;const{eventArgs:o}=e;if(o){if(!((r=(i=this.table.stateManager.select)===null||i===void 0?void 0:i.ranges)===null||r===void 0)&&r.length&&this.table.stateManager.isFillHandle()){let s,l;const a=this.table.stateManager.select.ranges[this.table.stateManager.select.ranges.length-1];t&&(O(this.table.stateManager.fillHandle.directionRow)||(Math.abs(this.table.stateManager.fillHandle.startY-e.abstractPos.y)>=Math.abs(this.table.stateManager.fillHandle.startX-e.abstractPos.x)?this.table.stateManager.fillHandle.directionRow=!0:this.table.stateManager.fillHandle.directionRow=!1),Math.abs(this.table.stateManager.fillHandle.startY-e.abstractPos.y)>=Math.abs(this.table.stateManager.fillHandle.startX-e.abstractPos.x)?this.table.stateManager.fillHandle.startY-e.abstractPos.y>0?this.table.stateManager.fillHandle.direction="top":this.table.stateManager.fillHandle.direction="bottom":this.table.stateManager.fillHandle.startX-e.abstractPos.x>0?this.table.stateManager.fillHandle.direction="left":this.table.stateManager.fillHandle.direction="right",this.table.stateManager.fillHandle.directionRow?(s=o.row,l=a.end.col):(s=a.end.row,l=o.col)),this.table.stateManager.updateSelectPos(t?l:a.end.col,t?s:a.end.row,!0,o.event.ctrlKey||o.event.metaKey,!1,!t)}else this.table.stateManager.updateSelectPos(o.col,o.row,o.event.shiftKey,o.event.ctrlKey||o.event.metaKey,!1,!t);return!0}return!1}deelTableSelectAll(){this.table.stateManager.updateSelectPos(-1,-1,!1,!1,!0),this.table.fireListeners(j.SELECTED_CELL,{ranges:this.table.stateManager.select.ranges,col:0,row:0})}dealMenuSelect(e){}checkColumnResize(e,t){const{eventArgs:i}=e;if(this.table.options.enableTreeStickCell&&!i)return!1;const r=this.table.scenegraph.getResizeColAt(e.abstractPos.x,e.abstractPos.y,i==null?void 0:i.targetCell);return this.table._canResizeColumn(r.col,r.row)&&r.col>=0?(t&&this.table.stateManager.startResizeCol(r.col,e.abstractPos.x,e.abstractPos.y,r.rightFrozen),!0):(this.table.stateManager.isResizeCol()&&this.table.stateManager.endResizeCol(),!1)}checkRowResize(e,t){const{eventArgs:i}=e;if(i){const r=this.table.scenegraph.getResizeRowAt(e.abstractPos.x,e.abstractPos.y,i.targetCell);if(this.table._canResizeRow(r.col,r.row)&&r.row>=0)return t&&this.table.stateManager.startResizeRow(r.row,e.abstractPos.x,e.abstractPos.y,r.bottomFrozen),!0}return!1}cellIsHeaderCheck(e,t){const{eventArgs:i}=e,{col:r,row:o,target:s}=i;return this.table.isHeader(r,o)?this.table.getCellType(i.col,i.row)==="checkbox"&&s.name==="checkbox":!1}checkCellFillhandle(e,t){var i,r,o,s;if(!((i=this.table.options.excelOptions)===null||i===void 0)&&i.fillHandle){const{eventArgs:l}=e;if(l&&(!((o=(r=this.table.stateManager.select)===null||r===void 0?void 0:r.ranges)===null||o===void 0)&&o.length)){const a=Math.max(this.table.stateManager.select.ranges[this.table.stateManager.select.ranges.length-1].start.col,this.table.stateManager.select.ranges[this.table.stateManager.select.ranges.length-1].end.col),d=Math.max(this.table.stateManager.select.ranges[this.table.stateManager.select.ranges.length-1].start.row,this.table.stateManager.select.ranges[this.table.stateManager.select.ranges.length-1].end.row),u=this.table.scenegraph.highPerformanceGetCell(a,d).globalAABBBounds,h=Math.abs(e.abstractPos.x-u.x2),c=Math.abs(e.abstractPos.y-u.y2),g=18;if(!((s=this.table.stateManager.fillHandle)===null||s===void 0)&&s.isFilling||h<=g/2&&c<=g/2)return t&&this.table.stateManager.startFillSelect(e.abstractPos.x,e.abstractPos.y),!0}}return!1}dealColumnResize(e,t){this.table.stateManager.updateResizeCol(e,t)}dealRowResize(e,t){this.table.stateManager.updateResizeRow(e,t)}checkColumnMover(e){var t;const{eventArgs:i}=e;return!(!i||!this.table._canDragHeaderPosition(i.col,i.row))&&(this.table.stateManager.startMoveCol(i.col,i.row,e.abstractPos.x,e.abstractPos.y,(t=i==null?void 0:i.event)===null||t===void 0?void 0:t.nativeEvent),!0)}dealColumnMover(e){var t;const{eventArgs:i}=e;O(i.col)&&O(i.row)&&this.table.stateManager.updateMoveCol(i.col,i.row,e.abstractPos.x,e.abstractPos.y,(t=i==null?void 0:i.event)===null||t===void 0?void 0:t.nativeEvent)}startColumnResize(e){}dealIconClick(e,t){const{eventArgs:i}=t,{target:r,event:o,col:s,row:l}=i||{target:e.target,event:e,col:-1,row:-1},a=r;if(a.role&&a.role.startsWith("icon-"))return this.table.fireListeners(j.ICON_CLICK,{name:a.name,x:(a.globalAABBBounds.x1+a.globalAABBBounds.x2)/2,y:a.globalAABBBounds.y2,col:s,row:l,funcType:a.attribute.funcType,icon:a,event:o}),!0;if(r instanceof Wn){const d=r.pickIcon(o.global);if(d)return this.table.fireListeners(j.ICON_CLICK,{name:d.attribute.id,x:d.globalX+d.globalAABBBounds.width()/2,y:d.globalY+d.AABBBounds.height(),col:s,row:l,funcType:d.attribute.funcType,icon:d,event:o}),!0}return!1}release(){this.gesture.release(),this.globalEventListeners.forEach(e=>{e.env==="document"?document.removeEventListener(e.name,e.callback):e.env==="body"?document.body.removeEventListener(e.name,e.callback):e.env==="window"&&window.removeEventListener(e.name,e.callback)}),this.globalEventListeners=[]}enableScroll(){this._enableTableScroll=!0}disableScroll(){this._enableTableScroll=!1}}let DC;const TF=n=>{const e=n.value;return Number(e)>80?"#20a8d8":Number(e)>50?"#4dbd74":Number(e)>20?"#ffc107":"#f86c6b"};class Id extends Nn{static get DEFAULT(){return DC||(DC=new Id)}constructor(e={},t={}){var i,r,o,s,l,a,d,u,h,c,g,f,p,m,b;super(e,t),this._showBar=(i=e.showBar)===null||i===void 0||i,this._barColor=(r=e.barColor)!==null&&r!==void 0?r:TF,this._barPositiveColor=(o=e.barPositiveColor)!==null&&o!==void 0?o:"#4dbd74",this._barNegativeColor=(s=e.barNegativeColor)!==null&&s!==void 0?s:"#f86c6b",this._barAxisColor=(l=e.barAxisColor)!==null&&l!==void 0?l:"black",this._barBgColor=e.barBgColor,this._barHeight=(a=e.barHeight)!==null&&a!==void 0?a:3,this._barHeight=(d=e.barHeight)!==null&&d!==void 0?d:3,this._barBottom=(u=e.barBottom)!==null&&u!==void 0?u:0,this._barPadding=(h=e.barPadding)!==null&&h!==void 0?h:[0,0,0,0],this._showBarMark=(c=e.showBarMark)!==null&&c!==void 0&&c,this._barMarkPositiveColor=(g=e.barMarkPositiveColor)!==null&&g!==void 0?g:"#4dbd74",this._barMarkNegativeColor=(f=e.barMarkNegativeColor)!==null&&f!==void 0?f:"#f86c6b",this._barMarkWidth=(p=e.barMarkWidth)!==null&&p!==void 0?p:2,this._barMarkPosition=(m=e.barMarkPosition)!==null&&m!==void 0?m:"right",this._barRightToLeft=(b=e.barRightToLeft)!==null&&b!==void 0&&b}get showBar(){return this._showBar}set showBar(e){this._showBar=e}get barColor(){return this._barColor}set barColor(e){this._barColor=e}get barBgColor(){return this._barBgColor}set barBgColor(e){this._barBgColor=e}get barHeight(){return this._barHeight}set barHeight(e){this._barHeight=e}get barBottom(){return this._barBottom}set barBottom(e){this._barBottom=e}get barPositiveColor(){return this._barPositiveColor}set barPositiveColor(e){this._barPositiveColor=e}get barNegativeColor(){return this._barNegativeColor}set barNegativeColor(e){this._barNegativeColor=e}get barAxisColor(){return this._barAxisColor}set barAxisColor(e){this._barAxisColor=e}get barPadding(){return this._barPadding}set barPadding(e){this._barPadding=e}get showBarMark(){return this._showBarMark}set showBarMark(e){this._showBarMark=e}get barMarkPositiveColor(){return this._barMarkPositiveColor}set barMarkPositiveColor(e){this._barMarkPositiveColor=e}get barMarkNegativeColor(){return this._barMarkNegativeColor}set barMarkNegativeColor(e){this._barMarkNegativeColor=e}get barMarkWidth(){return this._barMarkWidth}set barMarkWidth(e){this._barMarkWidth=e}get barMarkPosition(){return this._barMarkPosition}set barMarkPosition(e){this._barMarkPosition=e}get barRightToLeft(){return this._barRightToLeft}set barRightToLeft(e){this._barRightToLeft=e}clone(){return new Id(this,null)}}const PF=["type","content","style","color","width","height","marginRight","marginLeft","src","svg","name","path","positionType","tooltip","hover","cursor","shape","interactive","isGif"],HF=PF;class kF{constructor(e){this._table=e;const t=Vn();this.expandIcon=t[Vt.expandIconName],this.collapseIcon=t[Vt.collapseIconName]}getIcons(e,t,i,r,o){const s=[],l=this.getHierarchyIcon(e,t);l&&s.push(l);const{icon:a}=this._table.getBodyColumnDefine(e,t);if(a){let d;typeof a=="function"?d=a({col:e,row:t,value:i,dataValue:r,table:this._table}):d=a;const u=Vn(),h=c=>{let g;g=typeof c=="string"?u[c]:c,g&&s.push(g)};Array.isArray(d)?d.forEach((c,g)=>{h(c)}):h(d)}return o&&s.forEach((d,u)=>{(d.content||d.src)&&(s[u]=this.getCellIconFromRecordValue(d,e,t))}),s}getStyleClass(e){switch(e){case"text":case"link":return $s;case"image":case"video":return s2;case"chart":case"sparkline":return Nn;case"progressbar":return Id;case"checkbox":return Wc;case"radio":return xr;case"switch":return Rr;case"button":return Ar}return $s}getCellIconFromRecordValue(e,t,i){if(Array.isArray(e))return e.map(s=>this.getCellIconFromRecordValue(s,t,i));if(!Pw.isObject(e)||typeof e=="function")return this._table.getFieldData(e,t,i);const r={},o=e;return HF.forEach(s=>{var l,a;if(o[s]!==void 0){const d=this._table.getFieldData(o[s],t,i);O(d)?r[s]=d:!((a=(l=this._table)._hasField)===null||a===void 0)&&a.call(l,o[s],t,i)||(r[s]=o[s])}}),r}getHierarchyIcon(e,t){const i=this._table.getHierarchyState(e,t);return i===be.expand?this.expandIcon:i===be.collapse?this.collapseIcon:void 0}getHierarchyIconWidth(){var e,t;return this.expandIcon.width+((e=this.expandIcon.marginLeft)!==null&&e!==void 0?e:0)+((t=this.expandIcon.marginRight)!==null&&t!==void 0?t:0)}}function Jn(n,e){const t=document.createElement(n);return e&&t.classList.add(...e),t}function EF(){if(Me.mode==="node")return;const n=document.createElement("style");n.id="vtable-menu-styleSheet",n.textContent=`
@keyframes vtable__menu-element--shown-animation {
	0% {
		opacity: 0;
	}
	100% {
		opacity: 1;
	}
}
.vtable__menu-element {
	position: absolute;
	box-sizing: border-box;
	border-radius: 4px;
	background-color: #fff;
	padding: 6px 0;
	/* pointer-events: none; */
	user-select: none;
	color: #000;
	max-width: 300px;
	z-index: 99999;
	border: #CCC 0.5px solid;
	cursor: default;
	width: max-content;
	box-shadow: 0px 8px 16px rgba(27, 31, 35, 0.12);
  max-height: 100%;
  overflow-y: auto;
}
.vtable__menu-element--hidden {
	opacity: 0;
	/* transform: translate(-50%, -50%); */
	transition: opacity 75ms linear;
	z-index: -9999;
}
.vtable__menu-element--shown {
	opacity: 1;
	/* transform: translate(-50%, -50%); */
	animation: vtable__menu-element--shown-animation 150ms ease-out;
}
.vtable__menu-element__content {
	font-family: Roboto;
	font-size: 12px;
	overflow: hidden;
	display: inline-block;
	/* height: 100%; */
	line-height: 30px;
}
.vtable__menu-element__item {
	height: 32px;
	padding: 0px 12px;
	cursor: pointer;
	position: relative;
	display: flex;
	align-items: center;
	justify-content: flex-start;
}
.vtable__menu-element__item:hover {
	background-color: rgba(27, 31, 35, 0.06);
}
.vtable__menu-element__icon{
	/* vertical-align: top; */
	display: flex;
	/* line-height: 30px; */
	margin-right: 6px;
}
.vtable__menu-element__no-event {
	pointer-events: none;
}
.vtable__menu-element--select {
	color: #2E68CF;
}.vtable__menu-element--normal {
	color: rgba(20, 20, 20, 0.9);;
}
.vtable__menu-element__split {
	height: 0px;
	border: 1px solid rgb(209, 213, 218);
	margin: 5px 0;
}
.vtable__menu-element__title {
	color: rgb(149, 149, 149);
}
.vtable__menu-element__arrow {
	position: absolute;
	right: 3px;
	font-weight: bold;
	margin-top: 1px;
}
.vtable__menu-element__item-text {
	margin-right: 15px;
}
`,document.head.appendChild(n)}EF();const pn="vtable__menu-element",LF=`${pn}__item`,ch=`${pn}__content`,Kt=`${pn}--hidden`,pi=`${pn}--shown`,FF=`${pn}--normal`,zF=`${pn}--select`,IF=`${pn}__icon`,OF=`${pn}__split`,DF=`${pn}__title`,WF=`${pn}__arrow`,ns=`${pn}__no-event`,WC=`${pn}__item-text`;function NC(){return Jn("div",[pn,Kt])}function cs(n,e,t,i,r,o){const s=n.getCellRange(i,r);for(let l=0;l<e.length;l++){const a=e[l];let{col:d,row:u}=a;const{field:h,menuKey:c}=a;if(typeof d!="number"||typeof u!="number")if(n.isPivotTable()){const g=n.internalProps.layoutMap.getPivotCellAdress(h);if(!g)continue;d=g.col,u=g.row}else{const g=n.internalProps.layoutMap.getHeaderCellAddressByField(h);if(!g)continue;d=g.col,u=g.row}if(O(d)&&O(u)&&Mn(s,d,u)&&t===c)return!0}return!1}class NF{constructor(e){var t,i,r,o,s,l,a,d,u,h,c;this._handler=new wu,this._rootElement=NC(),this._secondElement=NC(),this._secondElement.sub=!0,this._showChildrenIndex=-1,this._rootElement.addEventListener("wheel",g=>{g.stopPropagation()}),(t=this._rootElement)===null||t===void 0||t.addEventListener("mousedown",g=>{g.stopPropagation(),g.preventDefault()}),(i=this._rootElement)===null||i===void 0||i.addEventListener("contextmenu",g=>{g.stopPropagation(),g.preventDefault()}),(r=this._rootElement)===null||r===void 0||r.addEventListener("touchend",g=>{if(g.stopPropagation(),g.preventDefault(),this._rootElement.classList.contains(Kt))return;const{col:f,row:p,dropDownIndex:m,menuKey:b,text:C,hasChildren:_}=g.target;if(typeof m!="number"||_)return void g.stopPropagation();const w=e.isPivotTable()?e.internalProps.layoutMap.getPivotDimensionInfo(f,p):e.getHeaderField(f,p),y=e._dropDownMenuIsHighlight(f,p,m);e.fireListeners(j.DROPDOWN_MENU_CLICK,{col:f,row:p,field:w,menuKey:b,text:C,highlight:y,cellLocation:e.getCellLocation(f,p),event:g}),e.fireListeners(j.DROPDOWN_MENU_CLEAR,null),e.fireListeners(j.HIDE_MENU,null),g.stopPropagation()}),(o=this._rootElement)===null||o===void 0||o.addEventListener("click",g=>{if(g.stopPropagation(),g.preventDefault(),this._rootElement.classList.contains(Kt))return;const{col:f,row:p,dropDownIndex:m,menuKey:b,text:C,hasChildren:_}=g.target;if(typeof m!="number"||_)return void g.stopPropagation();const w=e.isPivotTable()?e.internalProps.layoutMap.getPivotDimensionInfo(f,p):e.getHeaderField(f,p),y=e._dropDownMenuIsHighlight(f,p,m);e.fireListeners(j.DROPDOWN_MENU_CLICK,{col:f,row:p,field:w,menuKey:b,text:C,highlight:y,cellLocation:e.getCellLocation(f,p),event:g}),e.fireListeners(j.DROPDOWN_MENU_CLEAR,null),e.fireListeners(j.HIDE_MENU,null),g.stopPropagation()}),(s=this._rootElement)===null||s===void 0||s.addEventListener("mousemove",g=>{var f,p;if(this._rootElement.classList.contains(Kt))return;g.stopPropagation();const{hasChildren:m,dropDownIndex:b,col:C,row:_,sub:w}=g.target;if(m){this._showChildrenIndex=b;const y=this._secondElement;y==null||y.classList.remove(Kt),y==null||y.classList.add(pi),y.innerHTML="";const v=(f=this._menuInstanceInfo.content[b])===null||f===void 0?void 0:f.children;for(let S=0;S<v.length;S++){const R=v[S],B=VC(R,!!e.stateManager.menu.dropDownMenuHighlight&&cs(e,e.stateManager.menu.dropDownMenuHighlight,typeof R=="object"?(R==null?void 0:R.menuKey)||(R==null?void 0:R.text):R,C,_));B.col=C,B.row=_,B.dropDownIndex=S,typeof R=="string"?(B.text=R,B.menuKey=R):typeof R=="object"&&(B.text=R.text,B.menuKey=R.menuKey||R.text),B.sub=!0,B.sub=!0,y.appendChild(B)}const x=g.target.getBoundingClientRect();this._bindSecondElement(e,C,_,x.right,x.top)}else if(m&&this._showChildrenIndex===b){const y=this._secondElement;y==null||y.classList.remove(Kt),y==null||y.classList.add(pi)}else!w&&(!((p=this._secondElement)===null||p===void 0)&&p.classList.contains(pi))&&setTimeout(()=>{if(this._mouseEnterSecondElement!==!0){this._showChildrenIndex=-1;const y=this._secondElement;y==null||y.classList.remove(pi),y==null||y.classList.add(Kt)}},300)}),(l=this._secondElement)===null||l===void 0||l.addEventListener("wheel",g=>{g.stopPropagation()}),(a=this._secondElement)===null||a===void 0||a.addEventListener("mousemove",g=>{this._rootElement.classList.contains(Kt)||g.stopPropagation()}),(d=this._secondElement)===null||d===void 0||d.addEventListener("mouseenter",g=>{this._mouseEnterSecondElement=!0}),(u=this._secondElement)===null||u===void 0||u.addEventListener("mouseleave",g=>{this._mouseEnterSecondElement=!1}),(h=this._secondElement)===null||h===void 0||h.addEventListener("mousedown",g=>{g.stopPropagation(),g.preventDefault()}),(c=this._secondElement)===null||c===void 0||c.addEventListener("click",g=>{if(g.stopPropagation(),g.preventDefault(),this._secondElement.classList.contains(Kt))return;const{col:f,row:p,dropDownIndex:m,menuKey:b,text:C,hasChildren:_}=g.target;if(typeof m!="number"||_)return void g.stopPropagation();const w=e.isPivotTable()?e.internalProps.layoutMap.getPivotDimensionInfo(f,p):e.getHeaderField(f,p);let y=!1;this._menuInstanceInfo.content.forEach((v,x)=>{if(typeof v=="object"&&v.children&&v.children.length)for(let S=0;S<v.children.length;S++){const R=v.children[S];if(cs(e,e.stateManager.menu.dropDownMenuHighlight,typeof R=="object"?R==null?void 0:R.menuKey:R,f,p)&&b===(typeof R=="object"?R==null?void 0:R.menuKey:R))return void(y=!0)}}),e.fireListeners(j.DROPDOWN_MENU_CLICK,{col:f,row:p,field:w,cellHeaderPaths:e.isPivotTable()?e.getCellHeaderPaths(f,p):void 0,menuKey:b,text:C,highlight:y,cellLocation:e.getCellLocation(f,p),event:g}),e.fireListeners(j.DROPDOWN_MENU_CLEAR,null),e.fireListeners(j.HIDE_MENU,null),g.stopPropagation()})}get rootElement(){return this._rootElement}release(){this.unbindFromCell();const e=this._rootElement;e!=null&&e.parentElement&&e.parentElement.removeChild(e),this._handler.release(),delete this._rootElement}bindToCell(e,t,i,r){var o,s;const l=this._rootElement,a=this._secondElement;if(this._menuInstanceInfo=r,l==null||l.classList.remove(pi),l==null||l.classList.add(Kt),a==null||a.classList.remove(pi),a==null||a.classList.add(Kt),this._canBindToCell(e,t,i)){if(l.innerHTML="",Array.isArray(r.content)){const d=r.content;for(let u=0;(o=u<(d==null?void 0:d.length))!==null&&o!==void 0&&o;u++){const h=d[u];let c=!!e.stateManager.menu.dropDownMenuHighlight&&cs(e,e.stateManager.menu.dropDownMenuHighlight,typeof h=="object"?(h==null?void 0:h.menuKey)||(h==null?void 0:h.text):h,t,i);if(e.stateManager.menu.dropDownMenuHighlight&&typeof h=="object"&&Array.isArray(h.children)&&h.children.length)for(let f=0;f<h.children.length;f++){const p=h.children[f];if(cs(e,e.stateManager.menu.dropDownMenuHighlight,typeof p=="object"?(p==null?void 0:p.menuKey)||(p==null?void 0:p.text):p,t,i)){c=!0;break}}const g=VC(h,c);g.col=t,g.row=i,g.dropDownIndex=u,typeof h=="string"?(g.text=h,g.menuKey=h):typeof h=="object"&&(g.text=h.text,g.menuKey=h.menuKey||h.text,!((s=h.children)===null||s===void 0)&&s.length&&(g.hasChildren=!0)),l.appendChild(g)}}if(this._bindToCell(e,t,i,r.position,r.referencePosition))return l==null||l.classList.add(pi),l==null||l.classList.remove(Kt),!0}else this.unbindFromCell();return!1}unbindFromCell(){const e=this._rootElement,t=this._secondElement;this._menuInstanceInfo=void 0,e!=null&&e.parentElement&&(e.classList.remove(pi),e.classList.add(Kt)),t!=null&&t.parentElement&&(t.classList.remove(pi),t.classList.add(Kt))}_canBindToCell(e,t,i){var r;const o=e.getCellRangeRelativeRect({col:t,row:i}),s=(r=e.internalProps.menu.parentElement)!==null&&r!==void 0?r:e.getElement(),{top:l,bottom:a,left:d,right:u}=o;if(e.isFrozenCell(t,i))return!0;if(a<e.getFrozenRowsHeight()||u<e.getFrozenColsWidth()||d>e.tableNoFrameWidth-e.getRightFrozenColsWidth()||l>e.tableNoFrameHeight-e.getBottomFrozenRowsHeight())return!1;const{offsetHeight:h,offsetWidth:c}=s;return!(h<l)&&!(c<d)}_bindToCell(e,t,i,r,o){var s;const l=this._rootElement,a=(s=e.internalProps.menu.parentElement)!==null&&s!==void 0?s:e.getElement(),{width:d,height:u,left:h,top:c}=a.getBoundingClientRect();if(l){l.parentElement!==a&&a.appendChild(l),l.style.left="0px";const g=.8*d;l.style.maxWidth=`${g}px`;const f=l.offsetWidth,p=l.offsetHeight;let m,b;r?(m=r.x,b=r.y):o&&(m=o.rect.right-f,b=o.rect.bottom);const C=a.getBoundingClientRect(),_=C.width/a.offsetWidth,w=C.height/a.offsetHeight;b*w+p>u&&(b=(u-p)/w),b<0&&(b/=2);let y=0,v=0;if(e.getElement()!==a){const{left:x,top:S}=e.getElement().getBoundingClientRect();y=S-c,v=x-h}return l.style.top=`${b+y}px`,m<0?m=0:m*_+f>d&&(m=(d-f)/_),l.style.left=`${m+v}px`,!0}return!1}_bindSecondElement(e,t,i,r,o){var s;const l=this._secondElement,a=this._rootElement,d=(s=e.internalProps.menu.parentElement)!==null&&s!==void 0?s:e.getElement(),{width:u,left:h,top:c}=d.getBoundingClientRect(),{x:g,y:f,width:p}=a.getBoundingClientRect();if(l){l.parentElement!==d&&d.appendChild(l),l.style.left="0px";const m=.8*u;l.style.maxWidth=`${m}px`;const b=l.clientWidth,C=o-4-c,_=r-h;l.style.top=`${C}px`;let w=_;return w+b>u?w=w-b-p:w+=4,l.style.left=`${w}px`,!0}return!1}pointInMenuElement(e,t){const i=this._rootElement,{x:r,y:o,width:s,height:l}=i.getBoundingClientRect();if(e>r-5&&e<r+s+5&&t>o-5&&t<o+l+5)return!0;if(this._secondElement){const{x:a,y:d,width:u,height:h}=i.getBoundingClientRect();if(e>a-5&&e<a+u+5&&t>d-5&&t<d+h+5)return!0}return!1}}function VC(n,e){var t,i,r;const o=Jn("div",[LF,e?zF:FF]);if(typeof n=="string"){const s=Jn("span",[ch,ns,WC]);s.innerHTML=n,o.appendChild(s)}else if(typeof n=="object"){const s=(t=n.type)!==null&&t!==void 0?t:"item";if(s==="split")return o==null||o.classList.add(OF),o;if(!((i=n==null?void 0:n.icon)===null||i===void 0)&&i.svg)if(Zf.test(n.icon.svg)){const a=new Image;n.icon.width?a.style.width=n.icon.width.toString()+"px":a.style.width="16px",n.icon.height?a.style.height=n.icon.height.toString()+"px":a.style.height="16px",a.src=n.icon.svg,o.appendChild(a)}else{const a=Jn("span",[IF,ns]);a.innerHTML=e&&n.selectedIcon&&n.selectedIcon.svg?n.selectedIcon.svg:n.icon.svg,n.icon.width&&a.children[0].setAttribute("width",n.icon.width.toString()),n.icon.height&&a.children[0].setAttribute("height",n.icon.height.toString()),o.appendChild(a)}const l=Jn("span",[ch,ns,WC]);if(l.innerHTML=n.text,o.appendChild(l),s==="title")o==null||o.classList.add(ns,DF);else if(!((r=n==null?void 0:n.children)===null||r===void 0)&&r.length){const a=Jn("span",[ch,ns,WF]);a.innerHTML=e?'<svg width="8" height="12" viewBox="0 0 10 17" fill="none" xmlns="http://www.w3.org/2000/svg" style="vertical-align: baseline"><path d="M1.78186 16.7729L0.300378 15.2915L6.8189 8.77295L0.300377 2.25443L1.78186 0.77295L9.78186 8.77295L1.78186 16.7729Z" fill="#2E68CF" fill-opacity="0.65"></path></svg>':'<svg width="8" height="12" viewBox="0 0 10 17" fill="none" xmlns="http://www.w3.org/2000/svg" style="vertical-align: baseline"><path d="M1.78186 16.7729L0.300378 15.2915L6.8189 8.77295L0.300377 2.25443L1.78186 0.77295L9.78186 8.77295L1.78186 16.7729Z" fill="#141414" fill-opacity="0.65"></path></svg>',o.appendChild(a)}}return o}let GC;const VF={CHANGE_STYLE:"change_style"};class zr extends bu{static get EVENT_TYPE(){return VF}static get DEFAULT(){return GC||(GC=new zr)}constructor(e={},t={}){var i,r,o,s,l,a,d,u,h,c,g,f,p,m,b,C,_,w,y,v,x,S,R,B,A,M,H,E,T,P,k,L;super(),this._defaultPadding=[10,16,10,16],this._color=(i=e.color)!==null&&i!==void 0?i:t==null?void 0:t.color,this._strokeColor=(r=e==null?void 0:e.strokeColor)!==null&&r!==void 0?r:t==null?void 0:t.strokeColor,this._fontSize=(o=e.fontSize)!==null&&o!==void 0?o:t==null?void 0:t.fontSize,this._fontFamily=(s=e.fontFamily)!==null&&s!==void 0?s:t==null?void 0:t.fontFamily,this._fontWeight=(l=e.fontWeight)!==null&&l!==void 0?l:t==null?void 0:t.fontWeight,this._fontVariant=(a=e.fontVariant)!==null&&a!==void 0?a:t==null?void 0:t.fontVariant,this._fontStyle=(d=e.fontStyle)!==null&&d!==void 0?d:t==null?void 0:t.fontStyle,this._textOverflow=((u=e.textOverflow)!==null&&u!==void 0?u:t==null?void 0:t.textOverflow)||"ellipsis",this._textStick=(c=(h=e.textStick)!==null&&h!==void 0?h:t==null?void 0:t.textStick)!==null&&c!==void 0&&c,this._textStickBaseOnAlign=(f=(g=e.textStickBaseOnAlign)!==null&&g!==void 0?g:t==null?void 0:t.textStickBaseOnAlign)!==null&&f!==void 0&&f,this._marked=(m=(p=e.marked)!==null&&p!==void 0?p:t==null?void 0:t.marked)!==null&&m!==void 0&&m,this._textAlign=((b=e.textAlign)!==null&&b!==void 0?b:t==null?void 0:t.textAlign)||"left",this._textBaseline=((C=e.textBaseline)!==null&&C!==void 0?C:t==null?void 0:t.textBaseline)||"middle",this._bgColor=(_=e.bgColor)!==null&&_!==void 0?_:t==null?void 0:t.bgColor,this._padding=(y=(w=e.padding)!==null&&w!==void 0?w:t==null?void 0:t.padding)!==null&&y!==void 0?y:this._defaultPadding,this._borderColor=(v=e.borderColor)!==null&&v!==void 0?v:t==null?void 0:t.borderColor,this._lineHeight=(x=e.lineHeight)!==null&&x!==void 0?x:t==null?void 0:t.lineHeight,this._underline=(S=e.underline)!==null&&S!==void 0?S:t==null?void 0:t.underline,this._underlineColor=(R=e.underlineColor)!==null&&R!==void 0?R:t==null?void 0:t.underlineColor,this._underlineDash=(B=e.underlineDash)!==null&&B!==void 0?B:t==null?void 0:t.underlineDash,this._underlineOffset=(A=e.underlineOffset)!==null&&A!==void 0?A:t==null?void 0:t.underlineOffset,this._lineThrough=(M=e.lineThrough)!==null&&M!==void 0?M:t==null?void 0:t.lineThrough,this._lineThroughColor=(H=e.lineThroughColor)!==null&&H!==void 0?H:t==null?void 0:t.lineThroughColor,this._lineThroughDash=(E=e.lineThroughDash)!==null&&E!==void 0?E:t==null?void 0:t.lineThroughDash,this._linkColor=(T=e.linkColor)!==null&&T!==void 0?T:t==null?void 0:t.linkColor,this._cursor=(P=e.cursor)!==null&&P!==void 0?P:t==null?void 0:t.cursor,this._borderLineWidth=(k=e.borderLineWidth)!==null&&k!==void 0?k:t==null?void 0:t.borderLineWidth,this._borderLineDash=(L=e.borderLineDash)!==null&&L!==void 0?L:t==null?void 0:t.borderLineDash}get bgColor(){return this._bgColor}set bgColor(e){this._bgColor=e}get color(){return this._color}set color(e){this._color=e}get strokeColor(){return this._strokeColor}set strokeColor(e){this._strokeColor=e}get fontSize(){return this._fontSize}set fontSize(e){this._fontSize=e}get fontFamily(){return this._fontFamily}set fontFamily(e){this._fontFamily=e}get fontWeight(){return this._fontWeight}set fontWeight(e){this._fontWeight=e}get fontVariant(){return this._fontVariant}set fontVariant(e){this._fontVariant=e}get fontStyle(){return this._fontStyle}set fontStyle(e){this._fontStyle=e}get textOverflow(){return this._textOverflow}set textOverflow(e){this._textOverflow=e}get padding(){var e;return(e=this._padding)!==null&&e!==void 0?e:this._defaultPadding}set padding(e){this._padding=e}get borderColor(){return this._borderColor}set borderColor(e){this._borderColor=e}get textStick(){return this._textStick}set textStick(e){this._textStick=e}get textStickBaseOnAlign(){return this._textStickBaseOnAlign}set textStickBaseOnAlign(e){this._textStickBaseOnAlign=e}get marked(){return this._marked}set marked(e){this._marked=e}get textAlign(){return this._textAlign}set textAlign(e){this._textAlign=e}get textBaseline(){return this._textBaseline}set textBaseline(e){this._textBaseline=e}get lineHeight(){return this._lineHeight}set lineHeight(e){this._lineHeight=e}get underline(){return this._underline}set underline(e){this._underline=e}get underlineColor(){return this._underlineColor}set underlineColor(e){this._underlineColor=e}get underlineDash(){return this._underlineDash}set underlineDash(e){this._underlineDash=e}get underlineOffset(){return this._underlineOffset}set underlineOffset(e){this._underlineOffset=e}get lineThrough(){return this._lineThrough}set lineThrough(e){this._lineThrough=e}get lineThroughColor(){return this._lineThroughColor}set lineThroughColor(e){this._lineThroughColor=e}get lineThroughDash(){return this._lineThroughDash}set lineThroughDash(e){this._lineThroughDash=e}get linkColor(){return this._linkColor}set linkColor(e){this._linkColor=e}get cursor(){return this._cursor}set cursor(e){this._cursor=e}get borderLineWidth(){return this._borderLineWidth}set borderLineWidth(e){this._borderLineWidth=e}get borderLineDash(){return this._borderLineDash}set borderLineDash(e){this._borderLineDash=e}clone(){return new zr(this)}}let jC;class Od extends zr{static get DEFAULT(){return jC||(jC=new Od)}constructor(e={},t={}){var i;super(e,t),this.textAlign=((i=e.textAlign)!==null&&i!==void 0?i:t==null?void 0:t.textAlign)||"center"}clone(){return new Od(this)}}let UC;class Dd extends zr{static get DEFAULT(){return UC||(UC=new Dd)}constructor(e={},t=null){var i,r;super(e,t),this._autoWrapText=(i=e==null?void 0:e.autoWrapText)!==null&&i!==void 0?i:t==null?void 0:t.autoWrapText,this._lineClamp=(r=e==null?void 0:e.lineClamp)!==null&&r!==void 0?r:t==null?void 0:t.lineClamp}clone(){return new Dd(this,null)}get lineClamp(){return this._lineClamp}set lineClamp(e){this._lineClamp=e}get autoWrapText(){return this._autoWrapText}set autoWrapText(e){this._autoWrapText=e}}let $C;class Br extends zr{static get DEFAULT(){return $C||($C=new Br)}constructor(e={},t={},i={}){var r,o,s,l,a,d,u,h,c,g,f,p,m,b,C,_,w,y,v,x,S,R;super(e,t),this._size=((o=(r=e==null?void 0:e.size)!==null&&r!==void 0?r:t==null?void 0:t.size)!==null&&o!==void 0?o:i==null?void 0:i.size)||14,this._spaceBetweenTextAndIcon=((l=(s=e==null?void 0:e.spaceBetweenTextAndIcon)!==null&&s!==void 0?s:t==null?void 0:t.spaceBetweenTextAndIcon)!==null&&l!==void 0?l:i==null?void 0:i.spaceBetweenTextAndIcon)||8,this._defaultFill=(d=(a=e==null?void 0:e.checkboxStyle)===null||a===void 0?void 0:a.defaultFill)!==null&&d!==void 0?d:i==null?void 0:i.defaultFill,this._defaultStroke=(h=(u=e==null?void 0:e.checkboxStyle)===null||u===void 0?void 0:u.defaultStroke)!==null&&h!==void 0?h:i==null?void 0:i.defaultStroke,this._disableFill=(g=(c=e==null?void 0:e.checkboxStyle)===null||c===void 0?void 0:c.disableFill)!==null&&g!==void 0?g:i==null?void 0:i.disableFill,this._checkedFill=(p=(f=e==null?void 0:e.checkboxStyle)===null||f===void 0?void 0:f.checkedFill)!==null&&p!==void 0?p:i==null?void 0:i.checkedFill,this._checkedStroke=(b=(m=e==null?void 0:e.checkboxStyle)===null||m===void 0?void 0:m.checkedStroke)!==null&&b!==void 0?b:i==null?void 0:i.checkedStroke,this._disableCheckedFill=(_=(C=e==null?void 0:e.checkboxStyle)===null||C===void 0?void 0:C.disableCheckedFill)!==null&&_!==void 0?_:i==null?void 0:i.disableCheckedFill,this._disableCheckedStroke=(y=(w=e==null?void 0:e.checkboxStyle)===null||w===void 0?void 0:w.disableCheckedStroke)!==null&&y!==void 0?y:i==null?void 0:i.disableCheckedStroke,this._checkIconImage=(x=(v=e==null?void 0:e.checkboxStyle)===null||v===void 0?void 0:v.checkIconImage)!==null&&x!==void 0?x:i==null?void 0:i.checkIconImage,this._indeterminateIconImage=(R=(S=e==null?void 0:e.checkboxStyle)===null||S===void 0?void 0:S.indeterminateIconImage)!==null&&R!==void 0?R:i==null?void 0:i.indeterminateIconImage}get size(){return this._size}set size(e){this._size=e}get spaceBetweenTextAndIcon(){return this._spaceBetweenTextAndIcon}set spaceBetweenTextAndIcon(e){this._spaceBetweenTextAndIcon=e}get defaultFill(){return this._defaultFill}set defaultFill(e){this._defaultFill=e}get defaultStroke(){return this._defaultStroke}set defaultStroke(e){this._defaultStroke=e}get disableFill(){return this._disableFill}set disableFill(e){this._disableFill=e}get checkedFill(){return this._checkedFill}set checkedFill(e){this._checkedFill=e}get checkedStroke(){return this._checkedStroke}set checkedStroke(e){this._checkedStroke=e}get disableCheckedFill(){return this._disableCheckedFill}set disableCheckedFill(e){this._disableCheckedFill=e}get disableCheckedStroke(){return this._disableCheckedStroke}set disableCheckedStroke(e){this._disableCheckedStroke=e}get checkIconImage(){return this._checkIconImage}set checkIconImage(e){this._checkIconImage=e}get indeterminateIconImage(){return this._indeterminateIconImage}set indeterminateIconImage(e){this._indeterminateIconImage=e}getStyle(e){return new Br(e,this)}clone(){return new Br(this)}}function ra(n,e,t,i,r,o){var s;return n||e?n instanceof zr?n:typeof n=="function"?ra(n(t),e,t,i,r,o):(n||(n={}),r&&!O(n.autoWrapText)&&(n.autoWrapText=!0),i===Br?new Br(n??{},e??{},(s=o.checkboxStyle)!==null&&s!==void 0?s:{}):new i(n??{},e??{})):i.DEFAULT}class GF{constructor(e){this._table=e;const t=Vn();this.freezeIcon=t[Vt.freezeIconName],this.frozenIcon=t[Vt.frozenIconName],this.frozenCurrentIcon=t[Vt.frozenCurrentIconName],this.normalIcon=t[Vt.normalIconName],this.upIcon=t[Vt.upwardIconName],this.downIcon=t[Vt.downwardIconName],this.dropDownAbsoluteIcon=t[Vt.dropdownIconName],this.expandIcon=t[Vt.expandIconName],this.collapseIcon=t[Vt.collapseIconName]}getIcons(e,t){const i=[];if(this._table.isPivotTable()){const{showSort:l,sort:a}=this._table.internalProps.layoutMap.getHeader(e,t);let d;if(d=typeof l=="function"?l({col:e,row:t,table:this._table}):l,d){let u=this._table.getPivotSortState(e,t);u&&(u=u.toUpperCase());const h=u==="ASC"?this.upIcon:u==="DESC"?this.downIcon:this.normalIcon;h&&i.push(h)}else if(a){const u=this.getSortIconForPivotTable(this._table.getPivotSortState(e,t),this._table,e,t);u&&i.push(u)}}else{const l=this._table.sortState;let a;a=void 0;const d=this._table.getCellRange(e,t);if(l)if(Array.isArray(l))for(let h=0;h<l.length;h++){const c=l[h],g=this._table._getHeaderCellBySortState(c);if(g&&Mn(d,g.col,g.row)){({order:a}=c);break}}else{const h=this._table._getHeaderCellBySortState(l);h&&Mn(d,h.col,h.row)&&({order:a}=l)}const u=this.getSortIcon(a,this._table,e,t);u&&i.push(u)}if(this._table.showFrozenIcon&&e<this._table.allowFrozenColCount){const l=this.getFrozenIcon(e,t);l&&i.push(l)}if(this.checkDropDownIcon(this._table,e,t)){const l=this.dropDownAbsoluteIcon;i.push(l)}const r=this.getDropDownStateIcons(this._table,e,t);r.length&&i.push(...r);const{headerIcon:o}=this._table._getHeaderLayoutMap(e,t),s=this.getHierarchyIcon(e,t);if(s&&i.push(s),o){let l;typeof o=="function"?l=o({col:e,row:t,value:this._table.getCellValue(e,t),dataValue:this._table.getCellOriginValue(e,t),table:this._table}):l=o;const a=Vn(),d=u=>{let h;h=typeof u=="string"?a[u]:u,h&&i.push(h)};Array.isArray(l)?l.forEach((u,h)=>{d(u)}):d(l)}return i}getFrozenIcon(e,t){if(this._table.isPivotTable()||this._table.transpose||this._table.rightFrozenColCount&&e>=this._table.colCount-this._table.rightFrozenColCount)return null;const i=this._table.getHeaderDefine(e,t);if(i.columns&&i.columns.length>0)return null;let r=this.freezeIcon;return this._table.options.frozenColCount-1>e?r=this.frozenIcon:this._table.options.frozenColCount-1===e&&(r=this.frozenCurrentIcon),r}getSortIcon(e,t,i,r){const o=e==="asc"?this.upIcon:e==="desc"?this.downIcon:this.normalIcon,s=t.getHeaderDefine(i,r);let l;return s&&(l=typeof s.showSort=="function"?s.showSort({col:i,row:r,table:this._table}):s.showSort),!s||l===!1||!O(l)&&!s.sort||s.columns&&s.columns.length>0?null:o}getSortIconForPivotTable(e,t,i,r){const o=t.getHeaderDefine(i,r);let s;return o&&(s=typeof o.showSort=="function"?o.showSort({col:i,row:r,table:this._table}):o.showSort),!o||s===!1||!O(s)&&!o.sort||o.columns&&o.columns.length>0?null:(e==null?void 0:e.toUpperCase())==="ASC"?this.upIcon:(e==null?void 0:e.toUpperCase())==="DESC"?this.downIcon:this.normalIcon}getDropDownStateIcons(e,t,i){var r,o,s;const l=e.getHeaderDefine(t,i),a=e._getHeaderLayoutMap(t,i);let{dropDownMenu:d}=a;typeof d=="function"&&(d=d({row:i,col:t,table:e}));let u=e.globalDropDownMenu;typeof u=="function"&&(u=u({row:i,col:t,table:e}));const h=[];if(Array.isArray(d)&&d.length||Array.isArray(u)&&u.length&&!(!((r=l==null?void 0:l.columns)===null||r===void 0)&&r.length)){const c=d||u;let g=-1,f=-1;for(let p=0;p<c.length;p++){const m=c[p];if(typeof m=="object"&&m.children&&m.children.length)for(let b=0;b<m.children.length;b++){const C=m.children[b];if(!((o=e.stateManager.menu)===null||o===void 0)&&o.dropDownMenuHighlight&&cs(e,(s=e.stateManager.menu)===null||s===void 0?void 0:s.dropDownMenuHighlight,typeof C=="object"?C==null?void 0:C.menuKey:C,t,i)){g=p,f=b;break}}if(e._dropDownMenuIsHighlight(t,i,p)){g=p;break}}if(g!==-1){let p;p=f!==-1?c[g].children[f]:c[g],p.stateIcon&&(p.stateIcon.svg?h.push({type:"svg",name:p.stateIcon.src||p.stateIcon.svg,width:p.stateIcon.width||22,height:p.stateIcon.height||22,svg:p.stateIcon.svg,positionType:Ie.right,marginRight:0,funcType:Oe.dropDownState,interactive:!1}):p.stateIcon.src&&h.push({type:"image",name:p.stateIcon.src||p.stateIcon.svg,width:p.stateIcon.width||22,height:p.stateIcon.height||22,src:p.stateIcon.src,positionType:Ie.right,marginRight:0,funcType:Oe.dropDownState,interactive:!1}))}}return h}getDropDownIconRect(e,t,i){var r,o,s,l,a,d,u,h;const c=(l=(o=(r=this.downIcon.hover)===null||r===void 0?void 0:r.width)!==null&&o!==void 0?o:(s=this.downIcon)===null||s===void 0?void 0:s.width)!==null&&l!==void 0?l:0,g=(h=(d=(a=this.downIcon.hover)===null||a===void 0?void 0:a.height)!==null&&d!==void 0?d:(u=this.downIcon)===null||u===void 0?void 0:u.height)!==null&&h!==void 0?h:0,f=e.right-2-c,p=e.right-2;let m;return m=i==="middle"?e.top+e.height/2-c/2:i==="top"?e.top+t/2:i==="bottom"?e.bottom-2*t:e.top,{left:f,right:p,top:m,bottom:g+m,width:c,height:g}}getHierarchyIcon(e,t){const{hierarchyState:i}=this._table._getHeaderLayoutMap(e,t);if(i){if(i===be.expand)return this.expandIcon;if(i===be.collapse)return this.collapseIcon}}getHierarchyIconWidth(){var e,t;return this.expandIcon.width+((e=this.expandIcon.marginLeft)!==null&&e!==void 0?e:0)+((t=this.expandIcon.marginRight)!==null&&t!==void 0?t:0)}checkDropDownIcon(e,t,i){var r;if(e.isPivotTable()){let o=e._getHeaderLayoutMap(t,i).dropDownMenu;if(typeof o=="function"&&(o=o({row:i,col:t,table:e})),Array.isArray(o)&&o.length)return!0}else{const o=e.getHeaderDefine(t,i),s=o.dropDownMenu;let l=e.globalDropDownMenu;if(typeof l=="function"&&(l=l({row:i,col:t,table:e})),Array.isArray(s)&&s.length||(!Array.isArray(o.dropDownMenu)||o.dropDownMenu.length!==0)&&Array.isArray(l)&&l.length&&!(!((r=o==null?void 0:o.columns)===null||r===void 0)&&r.length))return!0}return!1}getStyleClass(e){switch(e){case"text":case"link":return Dd;case"image":case"video":return Od;case"checkbox":return Br}}setTableColumnsEditor(){const e=(t,i)=>{t==null||t.forEach((r,o)=>{r.editor&&(i[o].editor=r.editor),r.columns&&e(r.columns,i[o].columns)})};e(this._table.options.columns,this._table.internalProps.columns)}}class KC extends EventTarget{constructor(e,t){if(super(),this._table=e,Me.mode==="node")return;const i=document.createElement("div");i.style.opacity="0",i.dataset.vtable="vtable",i.style.pointerEvents="none",i.classList.add("input-container");const r=this._input=document.createElement("input");i.appendChild(r),r.classList.add("table-focus-control"),r.dataset.vtable="vtable",r.readOnly=!0,t.appendChild(i),this._container=i}focus(){this._input.focus({preventScroll:!0})}setFocusRect(e,t){const i=this._input;i.value=t,i.select();const r=e.top-this._table.scrollTop,o=e.left-this._table.scrollLeft;i.style.top=`${r.toFixed()}px`,i.style.left=`${o.toFixed()}px`,i.style.width=`${e.width.toFixed()}px`,i.style.height=`${e.height.toFixed()}px`}get input(){return this._input}release(){var e;(e=this._container.parentElement)===null||e===void 0||e.removeChild(this._container)}}class YC{constructor(e){this.isUpdate=!1,this._keys=[],this._sorted=!1,this.data=new Map,this._keys.length=0,this.cumulativeSum=new Map,this.difference=new Map,this.totalSum=0,this.table=e}get length(){return this.data.size}clear(){this._keys=[],this.data.clear(),this.cumulativeSum.clear(),this.difference.clear(),this.totalSum=0}clearRange(){this.cumulativeSum.clear(),this.difference.clear()}add(e,t){if(!O(t))return;const i=this.table.getRowHeight(e);this.data.has(e)||(this._keys.push(e),this._sorted=!1),this.data.set(e,t),this.totalSum+=t,this.updateDifference(e,t-i)}remove(e){if(this.data.has(e)){const t=this.data.get(e);this.data.delete(e);const i=this._keys.indexOf(e);i!==-1&&this._keys.splice(i,1),this.totalSum-=t;const r=this.table.getRowHeight(e);this.updateDifference(e,r-t)}}put(e,t){if(O(t))if(this.data.has(e)){const i=this.data.get(e);if(i===t)return;this.data.set(e,t);const r=t-i;this.totalSum+=r,this.updateDifference(e,r)}else this.add(e,t)}get(e){return this.data.get(e)}has(e){return this.data.has(e)}_sort(){const{_keys:e}=this;this._sorted||(e.sort((t,i)=>t<i?-1:t>i?1:0),this._sorted=!0)}updateDifference(e,t){var i;const r=(i=this.difference.get(e))!==null&&i!==void 0?i:0;this.difference.set(e,r+t),this.update()}getSumInRange(e,t){return this.calculatePrefixSum(t)-this.calculatePrefixSum(e-1)}updateCumulativeSum(e,t){for(const[i,r]of this.cumulativeSum)i>=e&&this.cumulativeSum.set(i,r+t)}calculatePrefixSum(e){if(e<0)return 0;if(this.cumulativeSum.has(e)){let t=this.cumulativeSum.get(e);for(const[i,r]of this.difference)i<=e&&(t+=r);return t}return this.dealDiffenence(),this.getCumulativeSum(e)}getCumulativeSum(e){var t;let i=0;for(let r=e;r>=0;r--){if(this.cumulativeSum.has(r)){i+=this.cumulativeSum.get(r);break}i+=(t=this.data.get(r))!==null&&t!==void 0?t:this.table.getRowHeight(r)}return this.cumulativeSum.set(e,i),i}update(){this.isUpdate||(this.isUpdate=!0,setTimeout(()=>{this.dealDiffenence(),this.isUpdate=!1},0))}dealDiffenence(){for(const[e]of this.cumulativeSum)for(const[t,i]of this.difference)if(e>=t){const r=this.cumulativeSum.get(e);this.cumulativeSum.set(e,r+i)}this.difference.clear()}insert(e,t){for(let r=e;r<=this.getLastIndex();r++)this.cumulativeSum.delete(r);const i=this.getLastIndex()+1;this.adjustOrder(e,e+1,i-e),O(t)&&this.put(e,t)}getLastIndex(){return this._sort(),this._keys[this._keys.length-1]}delLast(){const e=this.getLastIndex();this.remove(e)}delete(e){if(!this.has(e))return;for(let i=e;i<=this.getLastIndex();i++)this.cumulativeSum.delete(i);const t=this.getLastIndex();this.adjustOrder(e+1,e,t-e),this.delLast()}adjustOrder(e,t,i){this.clearRange(),this._sort();const{_keys:r}=this;if(e>t){const s=[];for(let l=Xr(r,e+i-1);l>=0;l--){const a=r[l];if(a>=e)s.push(this.get(a));else if(t<=a&&a<e)this.put(a+i,this.get(a));else if(a<t)break}for(let l=0;l<i;l++)this.put(t+l,s[i-1-l])}const{length:o}=r;if(e<t){const s=[];for(let l=Xr(r,e);l<o;l++){const a=r[l];if(a>=e&&a<e+i)s.push(this.get(a));else if(e+i<=a&&a<=t)this.put(a-i,this.get(a));else if(a>t)break}for(let l=0;l<i;l++)this.put(t+l,s[l])}}exchangeOrder(e,t,i,r,o){const{_keys:s}=this;if(this._sorted||(s.sort((l,a)=>l<a?-1:l>a?1:0),this._sorted=!0),e>i){const l=[],a=[];for(let d=Xr(s,i);d<Xr(s,e)+t;d++){const u=s[d];u>=e&&u<e+t?a.push(this.get(u)):l.push(this.get(u))}for(let d=0;d<t;d++)this.put(o+d,a[d]);for(let d=0;d<l.length;d++)this.put(o+t+d,l[d])}else{const l=[],a=[];for(let d=Xr(s,e);d<Xr(s,i)+r;d++){const u=s[d];u>=e&&u<e+t?a.push(this.get(u)):l.push(this.get(u))}for(let d=0;d<t;d++)this.put(o+d,a[d]);for(let d=0;d<l.length;d++)this.put(e+d,l[d])}}}function Xr(n,e){let t=0,i=n.length-1;for(;t<=i;){const r=Math.floor((t+i)/2);if(n[r]===e)return r;n[r]>e?i=r-1:t=r+1}return i<0?0:i}class jF{constructor(e){this._table=e;const t=Vn();this.dragReorderIconName=t[Vt.dragReorderIconName]}getIcons(e,t){return[this.dragReorderIconName]}}class hf{constructor(e,t,i="grid",r=void 0){this.hasHideNode=!1,this.sizeIncludeParent=!1,this.tree={id:0,dimensionKey:"",value:"",children:[],level:-1,afterSpanLevel:-1,levelSpan:1,startIndex:0,size:0,startInTotal:0,hierarchyState:void 0},this.totalLevel=0,this.expandedMaxLevel=0,this.dimensionKeys=new Ki,this.dimensionKeysIncludeVirtual=new Ki,this.cache=new Map,this.sizeIncludeParent=r!=null,this.setExpandLevel=r,this.hierarchyType=i,this.sharedVar=t,this.reset(e)}reset(e){this.totalLevel=0,this.expandedMaxLevel=0,this.hasHideNode=!1,this.cache.clear(),this.dimensionKeys=new Ki,this.dimensionKeysIncludeVirtual=new Ki,this.tree.children=e,this.setTreeNode(this.tree,0,this.tree)}setTreeNode(e,t,i){var r,o,s,l;e.startIndex=t,e.startInTotal=((r=i.startInTotal)!==null&&r!==void 0?r:0)+e.startIndex,e.hide&&(this.hasHideNode=!0),((o=e.dimensionKey)!==null&&o!==void 0?o:e.indicatorKey)&&(e.virtual||this.dimensionKeys.contain(e.indicatorKey?Dl:e.dimensionKey)||this.dimensionKeys.put(e.level,e.indicatorKey?Dl:e.dimensionKey),this.dimensionKeysIncludeVirtual.contain(e.indicatorKey?Dl:e.dimensionKey)||this.dimensionKeysIncludeVirtual.put(e.level,e.indicatorKey?Dl:e.dimensionKey),e.id||(e.id=++this.sharedVar.seqId));let a=e.dimensionKey&&this.sizeIncludeParent?1:0;const d=e.children||e.columns;return this.hierarchyType==="grid"||this.hierarchyType===null?(d==null?void 0:d.length)>=1?d.forEach(u=>{var h,c,g;u.level=((h=e.level)!==null&&h!==void 0?h:0)+1,this.hierarchyType==="grid"&&(u.afterSpanLevel=((c=e.afterSpanLevel)!==null&&c!==void 0?c:0)+((g=e.levelSpan)!==null&&g!==void 0?g:1)),this.totalLevel=Math.max(this.totalLevel,u.level+1),a+=this.setTreeNode(u,a,e)}):a=1:e.hierarchyState===be.expand&&(d==null?void 0:d.length)>=1?d.forEach(u=>{var h;u.level=((h=e.level)!==null&&h!==void 0?h:0)+1,this.totalLevel=Math.max(this.totalLevel,u.level+1),this.expandedMaxLevel=Math.max(this.expandedMaxLevel,u.level+1),a+=this.setTreeNode(u,a,e)}):e.hierarchyState===be.collapse&&(d==null?void 0:d.length)>=1?d.forEach(u=>{var h;u.level=((h=e.level)!==null&&h!==void 0?h:0)+1,this.totalLevel=Math.max(this.totalLevel,u.level+1),this.setTreeNode(u,a,e)}):!e.hierarchyState&&e.level+1<this.setExpandLevel&&((d==null?void 0:d.length)>=1||d===!0)?(!((s=d[0])===null||s===void 0)&&s.indicatorKey&&this.hierarchyType==="grid-tree"||(e.hierarchyState=be.expand),(d==null?void 0:d.length)>=1&&d.forEach(u=>{var h;u.level=((h=e.level)!==null&&h!==void 0?h:0)+1,this.totalLevel=Math.max(this.totalLevel,u.level+1),this.expandedMaxLevel=Math.max(this.expandedMaxLevel,u.level+1),a+=this.setTreeNode(u,a,e)})):(d==null?void 0:d.length)>=1||d===!0?(!((l=d[0])===null||l===void 0)&&l.indicatorKey&&this.hierarchyType==="grid-tree"||(e.hierarchyState=be.collapse),(d==null?void 0:d.length)>=1&&d.forEach(u=>{var h;u.level=((h=e.level)!==null&&h!==void 0?h:0)+1,this.totalLevel=Math.max(this.totalLevel,u.level+1),this.setTreeNode(u,a,e)})):(e.hierarchyState=be.none,a=1),e.size=a,a}getTreePath(e,t=30){const i=[];return this.searchPath(e,this.tree,i,t),i.shift(),i}findNodeById(e,t){return e.find(i=>i.id===t)}searchPath(e,t,i,r){if(!t||e<t.startIndex||e>=t.startIndex+t.size||(i.push(t),!t.children||t.children.length===0||t.level>=r))return;const o=e-t.startIndex;if(this.cache.has(t.level+1)){const a=this.cache.get(t.level+1);if(o>=a.startIndex&&o<a.startIndex+a.size)return void this.searchPath(o,a,i,r)}let s=0,l=t.children.length-1;for(;s<=l;){const a=Math.floor((s+l)/2),d=t.children[a];if(o>=d.startIndex&&o<d.startIndex+d.size){this.cache.set(d.level,d);const u=[];this.cache.forEach((h,c)=>{c>d.level&&u.push(c)}),u.forEach(h=>{this.cache.delete(h)}),this.searchPath(o,d,i,r);break}o<d.startIndex?l=a-1:s=a+1}}movePosition(e,t,i){let r,o,s;const l=(u,h)=>{if(o!==void 0&&s!==void 0)return;u.level===e&&(u.startInTotal===t&&(o=h),u.startInTotal<=i&&i<=u.startInTotal+u.size-1&&(s=h));const c=u.children||u.columns;if(c&&u.level<e){r=u;for(let g=0;g<c.length;g++)(t>=c[g].startInTotal&&t<=c[g].startInTotal+c[g].size||i>=c[g].startInTotal&&i<=c[g].startInTotal+c[g].size)&&l(c[g],g)}};l(this.tree,0);const a=r.children||r.columns,d=a.splice(o,1);d.unshift(s,0),Array.prototype.splice.apply(a,d)}getCopiedTree(){const e=Or(this.tree.children);return Ly(e),e}}function UF(n,e){e==null||e.forEach(t=>{var i,r;const o={dimensionKey:t.dimensionKey,indicatorKey:t.indicatorKey,value:t.value,hierarchyState:t.hierarchyState,children:void 0,virtual:(i=t.virtual)!==null&&i!==void 0&&i,levelSpan:(r=t.levelSpan)!==null&&r!==void 0?r:1};n.push(o),t.children&&(o.children=[],UF(o.children,t.children))})}function $F(n,e){let t=0;return n==null||n.forEach(i=>{e?t++:i.children&&i.children.length!==0||t++,i.children&&(t+=$F(i.children,e))}),t}function HO(n,e,t,i,r,o){var s,l,a,d,u,h,c,g,f,p,m,b,C,_,w,y,v,x,S,R,B,A,M,H;const E=n.id,T=(l=(s=o.rowsDefine)===null||s===void 0?void 0:s.find(L=>typeof L!="string"&&L.dimensionKey===n.dimensionKey))!==null&&l!==void 0?l:(a=o.columnsDefine)===null||a===void 0?void 0:a.find(L=>typeof L!="string"&&L.dimensionKey===n.dimensionKey),P=(d=o.indicatorsDefine)===null||d===void 0?void 0:d.find(L=>typeof L!="string"&&(n.indicatorKey?L.indicatorKey===n.indicatorKey:L.title===n.value&&!n.dimensionKey)),k={id:E,title:(u=n.value)!==null&&u!==void 0?u:P==null?void 0:P.title,field:n.dimensionKey,style:typeof((h=P??T)===null||h===void 0?void 0:h.headerStyle)=="function"?(c=P??T)===null||c===void 0?void 0:c.headerStyle:Object.assign({},(g=P??T)===null||g===void 0?void 0:g.headerStyle),headerType:(p=(f=P==null?void 0:P.headerType)!==null&&f!==void 0?f:T==null?void 0:T.headerType)!==null&&p!==void 0?p:"text",headerIcon:(m=P==null?void 0:P.headerIcon)!==null&&m!==void 0?m:T==null?void 0:T.headerIcon,define:Object.assign({},n,P??Object.assign({},T,{sort:void 0})),fieldFormat:(b=P==null?void 0:P.headerFormat)!==null&&b!==void 0?b:T==null?void 0:T.headerFormat,dropDownMenu:(C=P==null?void 0:P.dropDownMenu)!==null&&C!==void 0?C:T==null?void 0:T.dropDownMenu,pivotInfo:{value:n.value,dimensionKey:n.dimensionKey,isPivotCorner:!1},width:T==null?void 0:T.width,minWidth:T==null?void 0:T.minWidth,maxWidth:T==null?void 0:T.maxWidth,showSort:(_=P==null?void 0:P.showSort)!==null&&_!==void 0?_:T==null?void 0:T.showSort,sort:P==null?void 0:P.sort,description:T==null?void 0:T.description};P?(P.customRender&&(n.customRender=P.customRender),O((w=o._indicators)===null||w===void 0?void 0:w.find(L=>L.indicatorKey===P.indicatorKey))||(y=o._indicators)===null||y===void 0||y.push({id:++o.sharedVar.seqId,indicatorKey:P.indicatorKey,field:P.indicatorKey,fieldFormat:P==null?void 0:P.format,cellType:(x=(v=P==null?void 0:P.cellType)!==null&&v!==void 0?v:P==null?void 0:P.columnType)!==null&&x!==void 0?x:"text",chartModule:"chartModule"in P?P.chartModule:null,chartSpec:"chartSpec"in P?P.chartSpec:null,noDataRenderNothing:"noDataRenderNothing"in P&&P.noDataRenderNothing,sparklineSpec:"sparklineSpec"in P?P.sparklineSpec:null,style:P==null?void 0:P.style,icon:P==null?void 0:P.icon,define:Object.assign({},n,P,{dragHeader:T==null?void 0:T.dragHeader}),width:P==null?void 0:P.width,minWidth:P==null?void 0:P.minWidth,maxWidth:P==null?void 0:P.maxWidth,disableColumnResize:P==null?void 0:P.disableColumnResize})):n.indicatorKey&&(O((S=o._indicators)===null||S===void 0?void 0:S.find(L=>L.indicatorKey===n.indicatorKey))||(R=o._indicators)===null||R===void 0||R.push({id:++o.sharedVar.seqId,indicatorKey:n.indicatorKey,field:n.indicatorKey,cellType:"text",define:Object.assign({},n)})),t[E]=k,o._headerObjects[E]=k;for(let L=r-1;L>=0;L--)e[L][o.colIndex]=i[L];if(e[r][o.colIndex]=E,n.levelSpan>1)for(let L=1;L<n.levelSpan;L++){if(!e[r+L]){e[r+L]=[];for(let F=0;F<o.colIndex;F++)e[r+L][F]=e[r][F]}e[r+L][o.colIndex]=E}if(((B=n.children)===null||B===void 0?void 0:B.length)>=1)o._addHeaders(e,r+((A=n.levelSpan)!==null&&A!==void 0?A:1),(M=n.children)!==null&&M!==void 0?M:[],[...i,...Array((H=n.levelSpan)!==null&&H!==void 0?H:1).fill(E)],t);else{for(let L=r+1;L<e.length;L++)e[L][o.colIndex]=E;o.colIndex++}}function kO(n,e,t,i,r,o,s,l,a,d,u,h){var c,g,f,p,m,b,C,_,w,y,v,x,S,R,B,A,M,H,E,T,P,k,L,F,z,I,N,W,D,G,V,X,$,Q,te,le,fe,ne,ie;const ce=n.id,ae=(g=(c=h.rowsDefine)===null||c===void 0?void 0:c.find(Y=>typeof Y!="string"&&Y.dimensionKey===n.dimensionKey))!==null&&g!==void 0?g:(f=h.columnsDefine)===null||f===void 0?void 0:f.find(Y=>typeof Y!="string"&&Y.dimensionKey===n.dimensionKey),q=(p=h.indicatorsDefine)===null||p===void 0?void 0:p.find(Y=>typeof Y!="string"&&(n.indicatorKey?Y.indicatorKey===n.indicatorKey:Y.title===n.value&&!n.dimensionKey)),_e={id:ce,title:(m=n.value)!==null&&m!==void 0?m:q==null?void 0:q.title,field:n.dimensionKey,style:typeof((b=q??ae)===null||b===void 0?void 0:b.headerStyle)=="function"?(C=q??ae)===null||C===void 0?void 0:C.headerStyle:Object.assign({},(_=q??ae)===null||_===void 0?void 0:_.headerStyle),headerType:(y=(w=q==null?void 0:q.headerType)!==null&&w!==void 0?w:ae==null?void 0:ae.headerType)!==null&&y!==void 0?y:"text",headerIcon:(v=q==null?void 0:q.headerIcon)!==null&&v!==void 0?v:ae==null?void 0:ae.headerIcon,define:Object.assign(n,{linkJump:(x=q??ae)===null||x===void 0?void 0:x.linkJump,linkDetect:(S=q??ae)===null||S===void 0?void 0:S.linkDetect,templateLink:(R=q??ae)===null||R===void 0?void 0:R.templateLink,keepAspectRatio:(A=(B=q??ae)===null||B===void 0?void 0:B.keepAspectRatio)!==null&&A!==void 0&&A,imageAutoSizing:(M=q??ae)===null||M===void 0?void 0:M.imageAutoSizing,headerCustomRender:(H=q??ae)===null||H===void 0?void 0:H.headerCustomRender,headerCustomLayout:(E=q??ae)===null||E===void 0?void 0:E.headerCustomLayout,dragHeader:ae==null?void 0:ae.dragHeader,disableHeaderHover:!!(!((T=q??ae)===null||T===void 0)&&T.disableHeaderHover),disableHeaderSelect:!!(!((P=q??ae)===null||P===void 0)&&P.disableHeaderSelect),showSort:(k=q==null?void 0:q.showSort)!==null&&k!==void 0?k:ae==null?void 0:ae.showSort,hide:q==null?void 0:q.hide}),fieldFormat:(L=q==null?void 0:q.headerFormat)!==null&&L!==void 0?L:ae==null?void 0:ae.headerFormat,dropDownMenu:(F=q==null?void 0:q.dropDownMenu)!==null&&F!==void 0?F:ae==null?void 0:ae.dropDownMenu,pivotInfo:{value:n.value,dimensionKey:n.dimensionKey,isPivotCorner:!1},hierarchyLevel:n.level,dimensionTotalLevel:o,hierarchyState:n.hierarchyState,width:ae==null?void 0:ae.width,minWidth:ae==null?void 0:ae.minWidth,maxWidth:ae==null?void 0:ae.maxWidth,showSort:(z=q==null?void 0:q.showSort)!==null&&z!==void 0?z:ae==null?void 0:ae.showSort,sort:q==null?void 0:q.sort,description:ae==null?void 0:ae.description,parentCellId:i[i.length-1]};q?(q.customRender&&(n.customRender=q.customRender),O((I=h._indicators)===null||I===void 0?void 0:I.find(Y=>Y.indicatorKey===q.indicatorKey))||(N=h._indicators)===null||N===void 0||N.push({id:++h.sharedVar.seqId,indicatorKey:q.indicatorKey,field:q.indicatorKey,fieldFormat:q==null?void 0:q.format,cellType:(D=(W=q==null?void 0:q.cellType)!==null&&W!==void 0?W:q==null?void 0:q.columnType)!==null&&D!==void 0?D:"text",chartModule:"chartModule"in q?q.chartModule:null,chartSpec:"chartSpec"in q?q.chartSpec:null,noDataRenderNothing:"noDataRenderNothing"in q&&q.noDataRenderNothing,sparklineSpec:"sparklineSpec"in q?q.sparklineSpec:null,style:q==null?void 0:q.style,icon:q==null?void 0:q.icon,define:Object.assign({},n,q,{dragHeader:ae==null?void 0:ae.dragHeader}),width:q==null?void 0:q.width,minWidth:q==null?void 0:q.minWidth,maxWidth:q==null?void 0:q.maxWidth,disableColumnResize:q==null?void 0:q.disableColumnResize})):n.indicatorKey&&(O((G=h._indicators)===null||G===void 0?void 0:G.find(Y=>Y.indicatorKey===n.indicatorKey))||(V=h._indicators)===null||V===void 0||V.push({id:++h.sharedVar.seqId,indicatorKey:n.indicatorKey,field:n.indicatorKey,cellType:"text",define:Object.assign({},n)})),t[ce]=_e,h._headerObjects[ce]=_e;for(let Y=r-1;Y>=0;Y--)e[Y][h.colIndex]=i[Y];e[r][h.colIndex]=ce;const oe=Math.min((d?u:!u)?s:s-1,(X=n.levelSpan)!==null&&X!==void 0?X:1e3);if(oe>0)for(let Y=r+1;Y<oe;Y++){if(!e[Y]){e[Y]=[];for(let de=0;de<h.colIndex;de++)e[Y][de]=e[r][de]}e[Y][h.colIndex]=ce}if((($=(n.hierarchyState===be.expand&&n).children)===null||$===void 0?void 0:$.length)>=1)h._addHeadersForGridTreeMode(e,r+((Q=n.levelSpan)!==null&&Q!==void 0?Q:1),(te=n.children)!==null&&te!==void 0?te:[],[...i,...Array((le=n.levelSpan)!==null&&le!==void 0?le:1).fill(ce)],o,s,l&&n.hierarchyState===be.expand,a,t,d);else{const Y=(d?u:!u)?s:s-1;for(let de=r+1;de<Y;de++)e[de]||(e[de]=[]),e[de][h.colIndex]=ce;if(r<=Y-1&&(d&&u===!1||!d&&u===!0)){let de=n;const K=Y-r;for(;de&&!(!((fe=de.children)===null||fe===void 0)&&fe[0].indicatorKey);)de=de.children[0];h._addHeadersForGridTreeMode(e,s-1,(ne=de.children)!==null&&ne!==void 0?ne:[],[...i,...Array(Math.max(K,(ie=n.levelSpan)!==null&&ie!==void 0?ie:1)).fill(ce)],o,s,!0,a,t,d)}else h.colIndex++}}function EO(n,e,t,i,r,o,s,l,a){var d,u,h,c,g,f,p,m,b,C,_,w,y,v,x,S,R,B,A,M,H,E,T,P,k,L,F,z,I;const N=n.id,W=l.find(V=>typeof V!="string"&&V.dimensionKey===n.dimensionKey),D=(d=a.indicatorsDefine)===null||d===void 0?void 0:d.find(V=>typeof V!="string"&&(n.indicatorKey?V.indicatorKey===n.indicatorKey:V.title===n.value)),G={id:N,title:(u=n.value)!==null&&u!==void 0?u:D.title,field:n.dimensionKey,style:n.level+1===o||typeof((h=D??W)===null||h===void 0?void 0:h.headerStyle)=="function"?(c=D??W)===null||c===void 0?void 0:c.headerStyle:Object.assign({},(g=D??W)===null||g===void 0?void 0:g.headerStyle,{textAlign:"left"}),headerType:(p=(f=D==null?void 0:D.headerType)!==null&&f!==void 0?f:W==null?void 0:W.headerType)!==null&&p!==void 0?p:"text",headerIcon:(m=D==null?void 0:D.headerIcon)!==null&&m!==void 0?m:W==null?void 0:W.headerIcon,define:Object.assign(n,{linkJump:(b=D??W)===null||b===void 0?void 0:b.linkJump,linkDetect:(C=D??W)===null||C===void 0?void 0:C.linkDetect,templateLink:(_=D??W)===null||_===void 0?void 0:_.templateLink,keepAspectRatio:(y=(w=D??W)===null||w===void 0?void 0:w.keepAspectRatio)!==null&&y!==void 0&&y,imageAutoSizing:(v=D??W)===null||v===void 0?void 0:v.imageAutoSizing,headerCustomRender:(x=D??W)===null||x===void 0?void 0:x.headerCustomRender,headerCustomLayout:(S=D??W)===null||S===void 0?void 0:S.headerCustomLayout,dragHeader:W==null?void 0:W.dragHeader,disableHeaderHover:!!(!((R=D??W)===null||R===void 0)&&R.disableHeaderHover),disableHeaderSelect:!!(!((B=D??W)===null||B===void 0)&&B.disableHeaderSelect),showSort:(A=D==null?void 0:D.showSort)!==null&&A!==void 0?A:W==null?void 0:W.showSort,hide:D==null?void 0:D.hide}),fieldFormat:(M=D==null?void 0:D.headerFormat)!==null&&M!==void 0?M:W==null?void 0:W.headerFormat,dropDownMenu:(H=D==null?void 0:D.dropDownMenu)!==null&&H!==void 0?H:W==null?void 0:W.dropDownMenu,pivotInfo:{value:n.value,dimensionKey:n.dimensionKey,isPivotCorner:!1},hierarchyLevel:n.level,dimensionTotalLevel:o,hierarchyState:n.hierarchyState,width:W==null?void 0:W.width,minWidth:W==null?void 0:W.minWidth,maxWidth:W==null?void 0:W.maxWidth,parentCellId:i[i.length-1]};D?(D.customRender&&(n.customRender=D.customRender),O((E=a._indicators)===null||E===void 0?void 0:E.find(V=>V.indicatorKey===D.indicatorKey))||(T=a._indicators)===null||T===void 0||T.push({id:++a.sharedVar.seqId,indicatorKey:D.indicatorKey,field:D.indicatorKey,fieldFormat:D==null?void 0:D.format,cellType:(k=(P=D==null?void 0:D.cellType)!==null&&P!==void 0?P:D==null?void 0:D.columnType)!==null&&k!==void 0?k:"text",chartModule:"chartModule"in D?D.chartModule:null,chartSpec:"chartSpec"in D?D.chartSpec:null,noDataRenderNothing:"noDataRenderNothing"in D&&D.noDataRenderNothing,sparklineSpec:"sparklineSpec"in D?D.sparklineSpec:null,style:D==null?void 0:D.style,icon:D==null?void 0:D.icon,define:Object.assign({},n,D,{dragHeader:W==null?void 0:W.dragHeader}),width:D==null?void 0:D.width,minWidth:D==null?void 0:D.minWidth,maxWidth:D==null?void 0:D.maxWidth,disableColumnResize:D==null?void 0:D.disableColumnResize})):n.indicatorKey&&(O((L=a._indicators)===null||L===void 0?void 0:L.find(V=>V.indicatorKey===n.indicatorKey))||(F=a._indicators)===null||F===void 0||F.push({id:++a.sharedVar.seqId,indicatorKey:n.indicatorKey,field:n.indicatorKey,cellType:"text",define:Object.assign({},n)})),t[N]=G,a._headerObjects[N]=G,e[r][a.colIndex]=N;for(let V=r-1;V>=0;V--)e[V][a.colIndex]=i[V];if(n.hierarchyState===be.expand&&((z=n.children)===null||z===void 0?void 0:z.length)>=1)s&&a.colIndex++,a._addHeadersForTreeMode(e,r,(I=n.children)!==null&&I!==void 0?I:[],[...i,N],o,s&&n.hierarchyState===be.expand,l,t);else{s&&a.colIndex++;for(let V=r+1;V<e.length;V++)e[V][a.colIndex]=N}}function Ly(n){for(let e=0;e<n.length;e++){const t=n[e];delete t.level,delete t.startIndex,delete t.id,delete t.levelSpan,delete t.size,delete t.startInTotal;const i=t.children||t.columns;i&&Ly(i)}}function Fy(n,e,t,i,r){var o;for(let s=n.length-1;s>=0;s--){const l=n[s];if(e.push(l),i&&l.hide)n.splice(s,1);else if(l.indicatorKey){const a=(o=t==null?void 0:t.find(d=>d.indicatorKey===l.indicatorKey))===null||o===void 0?void 0:o.hide;typeof a=="function"?a({dimensionPaths:e,table:r})&&n.splice(s,1):a&&n.splice(s,1)}else l.children&&l.children.length>0&&Fy(l.children,e,t,i,r);e.pop()}}function KF(n){const e=n.columnObjects;for(let t=0;t<e.length;t++){const i=e[t];if(i!=null&&i.aggregation)return!0}return!1}function YF(n){const e=n.columnObjects;let t=0;for(let i=0;i<e.length;i++){const r=e[i];r!=null&&r.aggregation&&(Array.isArray(r==null?void 0:r.aggregation)?t=Math.max(t,r.aggregation.filter(o=>o.showOnTop).length):r.aggregation.showOnTop&&(t=Math.max(t,1)))}return t}function XF(n){const e=n.columnObjects;let t=0;for(let i=0;i<e.length;i++){const r=e[i];r!=null&&r.aggregation&&(Array.isArray(r==null?void 0:r.aggregation)?t=Math.max(t,r.aggregation.filter(o=>!o.showOnTop).length):r.aggregation.showOnTop||(t=Math.max(t,1)))}return t}function qF(n){if(n._table.options.groupBy)return!0;const{columns:e}=n._table.options;if(ee(e)&&e.length>0)for(let t=0;t<e.length;t++){const i=e[t];if(!je(i)&&i.tree)return!0}return!1}function ZF(n){const{columns:e,rows:t,indicators:i}=n.options;if(n.isPivotTable()){if(ee(e)&&e.length>0)for(let r=0;r<e.length;r++){const o=e[r];if(!je(o)&&(o.headerType==="image"||o.headerType==="video"||typeof o.headerType=="function")&&o.imageAutoSizing)return!0}if(ee(t)&&t.length>0)for(let r=0;r<t.length;r++){const o=t[r];if(!je(o)&&(o.headerType==="image"||o.headerType==="video"||typeof o.headerType=="function")&&o.imageAutoSizing)return!0}if(ee(i)&&i.length>0)for(let r=0;r<i.length;r++){const o=i[r];if(!je(o)&&((o.cellType==="image"||o.cellType==="video"||typeof o.cellType=="function")&&o.imageAutoSizing||(o.headerType==="image"||o.headerType==="video"||typeof o.headerType=="function")&&o.imageAutoSizing))return!0}}else if(ee(e)&&e.length>0)for(let r=0;r<e.length;r++){const o=e[r];if((o.cellType==="image"||o.cellType==="video"||typeof o.cellType=="function")&&o.imageAutoSizing||(o.headerType==="image"||o.headerType==="video"||typeof o.headerType=="function")&&o.imageAutoSizing)return!0}return!1}function LO(n,e){var t,i,r,o,s,l,a,d,u,h,c,g,f,p,m;let b,C;e.columnTree&&(n.options.indicatorsAsCol!==!1&&n.options.supplementIndicatorNodes!==!1&&(n.internalProps.columnTree=XC(n.internalProps.columnTree,e.indicators)),b=new hf((t=n.internalProps.columnTree)!==null&&t!==void 0?t:[],n.layoutNodeId,n.options.columnHierarchyType,n.options.columnHierarchyType!=="grid"?(i=n.options.columnExpandLevel)!==null&&i!==void 0?i:1:void 0)),e.rowTree&&(n.options.indicatorsAsCol===!1&&n.options.supplementIndicatorNodes!==!1&&(n.internalProps.rowTree=XC(n.internalProps.rowTree,e.indicators)),C=new hf((r=n.internalProps.rowTree)!==null&&r!==void 0?r:[],n.layoutNodeId,n.options.rowHierarchyType,n.options.rowHierarchyType!=="grid"?(o=n.options.rowExpandLevel)!==null&&o!==void 0?o:1:void 0));const _=!((s=C==null?void 0:C.dimensionKeys)===null||s===void 0)&&s.count?C.dimensionKeys.valueArr():(a=(l=e.rows)===null||l===void 0?void 0:l.reduce((v,x)=>(typeof x=="string"?v.push(x):v.push(x.dimensionKey),v),[]))!==null&&a!==void 0?a:[],w=!((d=b==null?void 0:b.dimensionKeys)===null||d===void 0)&&d.count?b.dimensionKeys.valueArr():(h=(u=e.columns)===null||u===void 0?void 0:u.reduce((v,x)=>(typeof x=="string"?v.push(x):v.push(x.dimensionKey),v),[]))!==null&&h!==void 0?h:[],y=(g=(c=e.indicators)===null||c===void 0?void 0:c.reduce((v,x)=>{var S;return typeof x=="string"?v.push(x):(v.push(x.indicatorKey),(x.chartSpec||x.sparklineSpec)&&(!((S=n.internalProps.dataConfig)===null||S===void 0)&&S.aggregationRules?n.internalProps.dataConfig.aggregationRules.find(R=>R.indicatorKey===x.indicatorKey)||n.internalProps.dataConfig.aggregationRules.push({field:x.indicatorKey,indicatorKey:x.indicatorKey,aggregationType:Je.NONE}):n.internalProps.dataConfig?n.internalProps.dataConfig.aggregationRules=[{field:x.indicatorKey,indicatorKey:x.indicatorKey,aggregationType:Je.NONE}]:n.internalProps.dataConfig={aggregationRules:[{field:x.indicatorKey,indicatorKey:x.indicatorKey,aggregationType:Je.NONE}]})),v},[]))!==null&&g!==void 0?g:[];return e.rowHierarchyType!=="grid"&&((p=(f=e.extensionRows)===null||f===void 0?void 0:f.length)!==null&&p!==void 0?p:0)>=1&&((m=e.extensionRows)===null||m===void 0||m.forEach(v=>{const x=[];v.rows.forEach(S=>{typeof S=="string"?x.push(S):x.push(S.dimensionKey)}),_.push(...x)})),{rowKeys:_,columnKeys:w,indicatorKeys:y,columnDimensionTree:b,rowDimensionTree:C}}function XC(n,e){const t=(i,r)=>{i.forEach(o=>{var s;o.indicatorKey||r||!((s=o.children)===null||s===void 0)&&s.length&&o.children?o.children&&Array.isArray(o.children)&&t(o.children,r||!!o.indicatorKey):o.children=e==null?void 0:e.map(l=>{var a;return typeof l=="string"?{indicatorKey:l,value:l}:{indicatorKey:l.indicatorKey,value:(a=l.title)!==null&&a!==void 0?a:l.indicatorKey}})})};return n!=null&&n.length?t(n,!1):n=e==null?void 0:e.map(i=>{var r;return typeof i=="string"?{indicatorKey:i,value:i}:{indicatorKey:i.indicatorKey,value:(r=i.title)!==null&&r!==void 0?r:i.indicatorKey}}),n}function FO(n,e,t,i){const r=[];for(let o=0;o<(e==null?void 0:e.length);o++){const s=e[o];s!=null&&s.hide&&r.push(s)}(r.length||t)&&Fy(n,[],r,t,i)}function zy(n,e){var t;return DH(e,n)||((t=rg(n,e))!==null&&t!==void 0?t:{top:-1,row:-1,bottom:-1,height:-1})}function Iy(n,e){var t;return WH(e,n)||((t=ig(n,e))!==null&&t!==void 0?t:{left:-1,col:-1,right:-1,width:1})}function JF(n,e,t){const i=zy(e,t),{row:r,top:o,bottom:s,height:l}=i,a=Iy(n,t),{col:d,left:u,right:h,width:c}=a;return{row:r,col:d,rect:{left:u,right:h,top:o,bottom:s,width:c,height:l}}}function ig(n,e){if(n===0)return{left:0,col:0,right:0,width:0};const t=ez(n,e),i=e.getColsWidth(0,t);return n>=i?((r,o)=>{let s=o-e.getColWidth(r);const{colCount:l}=e.internalProps;for(let a=r;a<l;a++){const d=e.getColWidth(a),u=s+d;if(Math.round(s)<=Math.round(n)&&Math.round(n)<Math.round(u))return{left:s,col:a,right:u,width:d};s=u}return null})(t,i):((r,o)=>{let s=o;for(let l=r;l>=0;l--){const a=e.getColWidth(l),d=s-a;if(Math.round(d)<=Math.round(n)&&Math.round(n)<Math.round(s))return{left:d,col:l,right:s,width:a};s=d}return null})(t,i)}function rg(n,e){var t;if(n===0)return{top:0,row:0,bottom:0,height:0};const i=((t=e.options.customConfig)===null||t===void 0?void 0:t._disableColumnAndRowSizeRound)===!0?Math.floor:Math.round,r=QF(n,e),o=e.getRowsHeight(0,r);return n>=o?((s,l)=>{let a=l-e.getRowHeight(s);const{rowCount:d}=e.internalProps;for(let u=s;u<d;u++){const h=e.getRowHeight(u),c=a+h;if(i(a)<=i(n)&&i(n)<i(c))return{top:a,row:u,bottom:c,height:h};a=c}return null})(r,o):((s,l)=>{let a=l;for(let d=s;d>=0;d--){const u=e.getRowHeight(d),h=a-u;if(i(h)<=i(n)&&i(n)<i(a))return{top:h,row:d,bottom:a,height:u};a=h}return null})(r,o)}function Oy(n,e,t){if(n===0)return{left:0,col:0,right:0,width:0};if(n-=t.tableX,e&&n>t.tableNoFrameWidth-t.getRightFrozenColsWidth()&&n<t.tableNoFrameWidth&&n<=t.getAllColsWidth()){for(let i=0;i<t.rightFrozenColCount;i++)if(n>t.tableNoFrameWidth-t.getColsWidth(t.colCount-i-1,t.colCount-1))return{col:t.colCount-i-1,left:void 0,right:void 0,width:void 0}}return ig(n,t)}function Dy(n,e,t){if(n===0)return{top:0,row:0,bottom:0,height:0};if(n-=t.tableY,e&&n>t.tableNoFrameHeight-t.getBottomFrozenRowsHeight()&&n<t.tableNoFrameHeight){for(let i=0;i<t.rightFrozenColCount;i++)if(n>t.tableNoFrameHeight-t.getRowsHeight(t.rowCount-i-1,t.rowCount-1))return{row:t.rowCount-i-1,top:void 0,bottom:void 0,height:void 0}}return rg(n,t)}function QF(n,e){let t=e.defaultRowHeight;return e._rowRangeHeightsMap.get("$0$"+(e.rowCount-1))&&(t=e._rowRangeHeightsMap.get("$0$"+(e.rowCount-1))/e.rowCount),Math.min(Math.ceil(n/t),e.rowCount-1)}function ez(n,e){if(e._colRangeWidthsMap.get("$0$"+(e.colCount-1))){let t=0,i=e.colCount-1;for(;i-t>1;){const r=Math.floor((t+i)/2);if(n<e._colRangeWidthsMap.get(`$0$${r}`))i=r;else{if(!(n>e._colRangeWidthsMap.get(`$0$${r}`)))return r;t=r}}return i}return Math.min(Math.ceil(n/e.internalProps.defaultColWidth),e.colCount-1)}function tz(n,e,t){n-=t.tableX;let i=!1;(e-=t.tableY)>0&&e<t.getFrozenRowsHeight()&&(i=!0);let r=!1;n>0&&n<t.getFrozenColsWidth()&&(r=!0);let o=!1;e>t.tableNoFrameHeight-t.getBottomFrozenRowsHeight()&&e<t.tableNoFrameHeight&&e<=t.getAllRowsHeight()&&(o=!0);let s=!1;n>t.tableNoFrameWidth-t.getRightFrozenColsWidth()&&n<t.tableNoFrameWidth&&n<=t.getAllColsWidth()&&(s=!0);const l=Oy((r||s?n:n+t.scrollLeft)+t.tableX,s,t),a=Dy((i||o?e:e+t.scrollTop)+t.tableY,o,t);if(l&&a){const{row:d,top:u,bottom:h,height:c}=a,{col:g,left:f,right:p,width:m}=l;return{row:d,col:g,rect:{left:f,right:p,top:u,bottom:h,width:m,height:c}}}return{col:-1,row:-1}}function qC(n){return n.length===2&&Xe(n[0])&&Xe(n[1])&&n[1]>=n[0]}function ZC(n){const e=n[1]-n[0],t=n[1]*n[0]<0;let i=n[0]<=0?0-n[0]:0,r=n[1]>0?n[1]-0:0;return e===0?n[0]<0?(i=1,r=0):n[0]>0&&(i=0,r=1):(i/=e,r/=e),{total:e,negative:i,positive:r,includeZero:t,domain:n,extendable_min:!0,extendable_max:!0}}function JC(n,e){const{positive:t,negative:i,extendable_min:r,extendable_max:o,domain:s}=n,{positive:l,negative:a,extendable_min:d,extendable_max:u,domain:h}=e;if(l>0){if(!d)return!1;let c=i/t;o&&(c=i/Math.max(t,l),s[1]=-s[0]/c),h[0]=-h[1]*c}else if(a>0){if(!u)return!1;let c=t/i;r&&(c=t/Math.max(i,i),s[0]=-s[1]/c),h[1]=-h[0]*c}return!0}function QC(n,e){const{extendable_min:t,extendable_max:i,domain:r}=n,{positive:o,negative:s,domain:l}=e;return(o!==0||s!==0)&&!(o>0&&!i)&&!(s>0&&!t)&&(r[0]=l[0],r[1]=l[1],!0)}function e_(n,e){const{positive:t,negative:i,extendable_max:r,domain:o}=n,{positive:s,negative:l,extendable_min:a,domain:d}=e;if(r&&a){const u=Math.max(i,l)/Math.max(t,s);o[1]=-o[0]/u,d[0]=-d[1]*u}else if(a){const u=i/t;d[0]=-d[1]*u}else{if(!r)return!1;{const u=l/s;o[1]=-o[0]/u}}return!0}function t_(n,e){const{extendable_min:t,domain:i}=n,{extendable_max:r,domain:o}=e;return!(!t||!r)&&(i[0]=-i[1],o[1]=-o[0],!0)}function nz(n,e){const t=[n.min,n.max],i=[e.min,e.max];if(!qC(t)||!qC(i))return;const r=ZC(t),o=ZC(i),{positive:s,negative:l,extendable_max:a,includeZero:d}=r,{positive:u,negative:h,extendable_max:c,includeZero:g}=o;if(s===0&&l===0){if(!QC(r,o))return}else if(u===0&&h===0){if(!QC(o,r))return}else if(d||g)if(d&&!g){if(!JC(r,o))return}else if(g&&!d){if(!JC(o,r))return}else{if(l===h)return;if(l>h){if(!e_(r,o))return}else if(!e_(o,r))return}else{if(l===0&&u===0){if(!t_(r,o))return}else if(h===0&&s===0&&!t_(o,r))return;if(l===0&&h===0)if(t[0]===0&&i[0]>0)i[0]=0;else{if(!(i[0]===0&&t[0]>0))return;t[0]=0}if(s===0&&u===0)if(t[1]===0&&i[1]>0){if(!c)return;i[1]=0}else{if(!(i[1]===0&&t[1]>0)||!a)return;t[1]=0}}return{range1:t,range2:i}}function iz(n,e,t,i,r,o){const s=ue.getFunction("getAxisDomainRangeAndLabels"),{axisOption:l,isZeroAlign:a}=Eo(e,t,i===0?"right":"left",o),{ticks:d}=s(n.min,n.max,l,a,r==="bottom"||r==="top"?o._table.getColWidth(e)||o._table.tableNoFrameWidth:o._table.getRowHeight(t)||o._table.tableNoFrameHeight);return d}function lo(n,e,t,i){return i!==0&&n?()=>n.map(r=>{const o=(r-e.min)/(e.max-e.min),s=(t.max-t.min)*o+t.min;return Math.round(100*s)/100}):void 0}function rz(n,e,t){var i,r,o,s,l,a,d;if(t._table.isPivotChart())if(t.indicatorsAsCol){if(t.hasTwoIndicatorAxes&&e===t.columnHeaderLevelCount-1&&n>=t.rowHeaderLevelCount&&n<t.colCount-t.rightFrozenColCount){const u=Kl("top",n,e+1,n,t.columnHeaderLevelCount-1,n,e,1,t);if(!u)return;const h=t._table._getCellStyle(n,e+1),c=xe(Z("padding",h,n,e+1,t._table)),{range:g,ticks:f,axisOption:p,targetTicks:m,targetRange:b,index:C,theme:_}=u;return J(p==null?void 0:p.min)&&(g.min=p.min,g.min>0&&(p.zero=!1)),J(p==null?void 0:p.max)&&(g.max=p.max,g.max<0&&(p.zero=!1)),re({range:g},p,{orient:"top",type:(p==null?void 0:p.type)||"linear",label:{flush:!0},tick:{tickMode:lo(m,b,g,C)},__ticksForVTable:f,__vtableChartTheme:_,__vtablePadding:c})}if(e===t.rowCount-t.bottomFrozenRowCount&&n>=t.rowHeaderLevelCount&&n<t.colCount-t.rightFrozenColCount){const u=t.getIndicatorKeyInChartSpec(n,e);let h=null;u==null||u.forEach(v=>{const x=t.getIndicatorInfo(v);x&&(h=x)});const c=Kl("bottom",n,e-1,n,e,n,e,0,t);if(!c)return;const g=t._table._getCellStyle(n,e-1),f=xe(Z("padding",g,n,e-1,t._table)),{range:p,ticks:m,axisOption:b,index:C,targetTicks:_,targetRange:w,theme:y}=c;return J(b==null?void 0:b.min)&&(p.min=b.min,p.min>0&&(b.zero=!1)),J(b==null?void 0:b.max)&&(p.max=b.max,p.max<0&&(b.zero=!1)),re({title:{visible:!0,text:h==null?void 0:h.title},range:p},b,{orient:"bottom",type:(b==null?void 0:b.type)||"linear",label:{flush:!0},tick:{tickMode:lo(_,w,p,C)},__ticksForVTable:m,__vtableChartTheme:y,__vtablePadding:f})}if(n===t.rowHeaderLevelCount-1&&e>=t.columnHeaderLevelCount&&e<t.rowCount-t.bottomFrozenRowCount){let u=t.getDimensionKeyInChartSpec(t.rowHeaderLevelCount,e);ee(u)&&(u=u[0]);const h=(i=t.dataset.collectedValues[u])!==null&&i!==void 0?i:[],c=t.getRowKeysPath(n,e),g=(r=h[c??""])!==null&&r!==void 0?r:[],{axisOption:f,theme:p,chartType:m}=Eo(n+1,e,"left",t);if((f==null?void 0:f.visible)===!1)return;const b=t._table._getCellStyle(n+1,e),C=xe(Z("padding",b,n+1,e,t._table)),_=t.getRawChartSpec(n+1,e);return re({domain:(f==null?void 0:f.type)==="linear"?void 0:Array.from(g),range:(f==null?void 0:f.type)==="linear"?g:void 0,title:{autoRotate:!0}},f,{orient:"left",type:(o=f==null?void 0:f.type)!==null&&o!==void 0?o:"band",__vtableChartTheme:p,inverse:lz(f,((s=_==null?void 0:_.direction)!==null&&s!==void 0?s:m==="scatter"?"vertical":"horizontal")==="horizontal"),__vtablePadding:C})}}else{if(n===t.rowHeaderLevelCount-1&&e>=t.columnHeaderLevelCount&&e<t.rowCount-t.bottomFrozenRowCount){const u=t.getIndicatorKeyInChartSpec(n,e);let h=null;u==null||u.forEach(v=>{const x=t.getIndicatorInfo(v);x&&(h=x)});const c=Kl("left",n+1,e,n,e,n,e,0,t);if(!c)return;const g=t._table._getCellStyle(n+1,e),f=xe(Z("padding",g,n+1,e,t._table)),{range:p,ticks:m,axisOption:b,index:C,targetTicks:_,targetRange:w,theme:y}=c;return J(b==null?void 0:b.min)&&(p.min=b.min,p.min>0&&(b.zero=!1)),J(b==null?void 0:b.max)&&(p.max=b.max,p.max<0&&(b.zero=!1)),re({title:{visible:!0,text:h==null?void 0:h.title,autoRotate:!0},range:p},b,{orient:"left",type:(b==null?void 0:b.type)||"linear",label:{flush:!0},tick:{tickMode:lo(_,w,p,C)},__ticksForVTable:m,__vtableChartTheme:y,__vtablePadding:f})}if(n===t.colCount-t.rightFrozenColCount&&e>=t.columnHeaderLevelCount&&e<t.rowCount-t.bottomFrozenRowCount){const u=Kl("right",n-1,e,t.rowHeaderLevelCount-1,e,n,e,1,t);if(!u)return;const h=t._table._getCellStyle(n-1,e),c=xe(Z("padding",h,n-1,e,t._table)),{range:g,ticks:f,axisOption:p,index:m,targetTicks:b,targetRange:C,theme:_}=u;return J(p==null?void 0:p.min)&&(g.min=p.min,g.min>0&&(p.zero=!1)),J(p==null?void 0:p.max)&&(g.max=p.max,g.max<0&&(p.zero=!1)),re({range:g,title:{autoRotate:!0}},p,{orient:"right",type:(p==null?void 0:p.type)||"linear",label:{flush:!0},tick:{tickMode:lo(b,C,g,m)},__ticksForVTable:f,__vtableChartTheme:_,__vtablePadding:c})}if(e===t.rowCount-t.bottomFrozenRowCount&&n>=t.rowHeaderLevelCount&&n<t.colCount-t.rightFrozenColCount){let u=t.getDimensionKeyInChartSpec(n,t.columnHeaderLevelCount);ee(u)&&(u=u[0]);const h=(l=t.dataset.collectedValues[u])!==null&&l!==void 0?l:[],c=t.getColKeysPath(n,e),g=(a=h==null?void 0:h[c??""])!==null&&a!==void 0?a:[],{axisOption:f,isPercent:p,theme:m,chartType:b}=Eo(n,e-1,"bottom",t);if((f==null?void 0:f.visible)===!1)return;const C=t._table._getCellStyle(n,e-1),_=xe(Z("padding",C,n,e-1,t._table));return re({domain:(f==null?void 0:f.type)==="linear"?void 0:Array.from(g),range:(f==null?void 0:f.type)==="linear"?g:void 0},f,{orient:"bottom",type:(d=f==null?void 0:f.type)!==null&&d!==void 0?d:"band",__vtableChartTheme:m,__vtablePadding:_})}}}function Eo(n,e,t,i){var r,o;const s=i.getRawChartSpec(n,e),l=(r=s.axes)!==null&&r!==void 0?r:[];if(i._table.pivotChartAxes.forEach(h=>{l.findIndex(c=>h.orient===c.orient)===-1&&l.push(h)}),s&&ee(l)){const h=l.find(c=>c.orient===t);if(h){const{seriesIndex:c,seriesId:g}=h;let f,p;O(g)&&ee(s.series)?f=(ee(g)?g:[g]).map(C=>{const _=s.series.findIndex(w=>w.id===C);return _>=0&&(p=s.series[_]),_}):O(c)&&ee(s.series)&&(f=c);const{isZeroAlign:m,isTickAlign:b}=n_(s,t,i);return{axisOption:h,isPercent:s.percent,isZeroAlign:m,isTickAlign:b,seriesIndice:f,theme:s.theme,chartType:(o=p==null?void 0:p.type)!==null&&o!==void 0?o:s.type}}}const a=i._table.pivotChartAxes.find(h=>h.orient===t),{isZeroAlign:d,isTickAlign:u}=n_(s,t,i);return{axisOption:a,isPercent:!1,isZeroAlign:d,isTickAlign:u,theme:s.theme,chartType:s.type}}function n_(n,e,t){const i=[];let r;e==="left"||e==="right"?i.push("left","right"):e!=="top"&&e!=="bottom"||i.push("top","bottom"),r=n&&ee(n.axes)?n.axes:t._table.pivotChartAxes;let o=!1,s=!1;if(ee(r)){const l=[];r.forEach(a=>{i.includes(a.orient)&&l.push(a)});for(let a=0;a<l.length;a++){const d=l[a];d.sync&&d.sync.axisId&&l.find(u=>u.id===d.sync.axisId)&&(o=o||d.sync.zeroAlign,s=s||d.sync.tickAlign)}}return{isZeroAlign:o,isTickAlign:s}}function Wy(n,e,t,i,r){var o;if(ee(r)){const d={min:1/0,max:-1/0};for(let u=0;u<r.length;u++){const h=Wy(n,e,t,i,r[u]);h&&(d.min=Math.min(d.min,h.min),d.max=Math.max(d.max,h.max))}return isFinite(d.min)&&isFinite(d.max)?d:null}let s=e==null?void 0:e[r];if(ee(s)&&(s=s[0]),!s)return null;const l=n[s],a=re({},(o=l==null?void 0:l[i??""])!==null&&o!==void 0?o:{min:0,max:1});return a.positiveMax&&a.positiveMax>a.max&&(a.max=a.positiveMax),a.negativeMin&&a.negativeMin<a.min&&(a.min=a.negativeMin),a.min===a.max&&(a.min>0?a.min=0:a.max=0),a}function oz(n,e,t){if(!t._table.isPivotChart())return!1;if(t.indicatorsAsCol){if(t.hasTwoIndicatorAxes&&e===t.columnHeaderLevelCount-1&&n>=t.rowHeaderLevelCount&&n<t.colCount-t.rightFrozenColCount||e===t.rowCount-t.bottomFrozenRowCount&&n>=t.rowHeaderLevelCount&&n<t.colCount-t.rightFrozenColCount)return!0}else if(e===t.rowCount-t.bottomFrozenRowCount&&n>=t.rowHeaderLevelCount&&n<t.colCount-t.rightFrozenColCount)return!0;return!1}function sz(n,e,t){if(!t._table.isPivotChart())return!1;if(t.indicatorsAsCol){if(n===t.rowHeaderLevelCount-1&&e>=t.columnHeaderLevelCount&&e<t.rowCount-t.bottomFrozenRowCount)return!0}else if(n===t.rowHeaderLevelCount-1&&e>=t.columnHeaderLevelCount&&e<t.rowCount-t.bottomFrozenRowCount||n===t.colCount-t.rightFrozenColCount&&e>=t.columnHeaderLevelCount&&e<t.rowCount-t.bottomFrozenRowCount)return!0;return!1}var i_;function lz(n,e){let t=n==null?void 0:n.inverse;return e&&!az(n==null?void 0:n.orient)&&(t=!O(n==null?void 0:n.inverse)||!(n!=null&&n.inverse)),t}function az(n){return n==="bottom"||n==="top"}(function(n){n.vertical="vertical",n.horizontal="horizontal"})(i_||(i_={}));function zO(n,e,t,i){if(!ee(n.axes)||n.axes.length===0)return t&&i||!t&&!i;for(let r=0;r<n.axes.length;r++){const o=n.axes[r];if(!t&&i&&o.orient==="bottom"&&o.type==="linear"||t&&i&&o.orient==="bottom"&&o.type!=="linear"||!t&&!i&&o.orient==="left"&&o.type!=="linear"||t&&!i&&o.orient==="left"&&o.type==="linear")return!0}if(ee(e)&&e.length>0)for(let r=0;r<e.length;r++){const o=e[r];if(!t&&i&&o.orient==="bottom"&&o.type==="linear"||t&&i&&o.orient==="bottom"&&o.type!=="linear"||!t&&!i&&o.orient==="left"&&o.type!=="linear"||t&&!i&&o.orient==="left"&&o.type==="linear")return!0}return t&&i||!t&&!i}function Kl(n,e,t,i,r,o,s,l,a){const d=a.getIndicatorKeyInChartSpec(i,r);let u;u=n==="top"||n==="bottom"?a.getColKeysPath(o,s):a.getRowKeysPath(o,s);const h=og(e,t,l,n,d,u,a);if(!h)return;const c=n==="bottom"?"top":n==="top"?"bottom":n==="left"?"right":"left",{targetRange:g,targetTicks:f}=Ny(e,t,h.index,h.isZeroAlign,h.isTickAlign,h.range,d,c,u,a);if(h.index!==0&&f){const p=ue.getFunction("getAxisDomainRangeAndLabels"),{range:m,ticks:b}=p(h.range.min,h.range.max,h.axisOption,h.isZeroAlign,n==="bottom"||n==="top"?a._table.getColWidth(o)||a._table.tableNoFrameWidth:a._table.getRowHeight(s)||a._table.tableNoFrameHeight,{targetTicks:f,targetRange:g});h.range.min=m[0],h.range.max=m[1],h.ticks=b}return h.targetRange=g,h.targetTicks=f,h}function og(n,e,t,i,r,o,s){const{axisOption:l,isPercent:a,isZeroAlign:d,isTickAlign:u,seriesIndice:h,theme:c,chartType:g}=Eo(n,e,i,s),f=Wy(s.dataset.collectedValues,r,d,o,h??t);if(!f)return;let p;if(a&&(f.min=f.min<0?-1:0,f.max=f.max>0?1:0),(l!=null&&l.zero||f.min===f.max)&&(f.min=Math.min(f.min,0),f.max=Math.max(f.max,0)),(l==null?void 0:l.nice)||u){const m=ue.getFunction("getAxisDomainRangeAndLabels"),{range:b,ticks:C}=m(f.min,f.max,l,d,i==="bottom"||i==="top"?s._table.getColWidth(n)||s._table.tableNoFrameWidth:s._table.getRowHeight(e)||s._table.tableNoFrameHeight);l!=null&&l.nice&&(f.min=b[0],f.max=b[1]),p=C}return J(l==null?void 0:l.min)&&(f.min=l.min),J(l==null?void 0:l.max)&&(f.max=l.max),{index:h??t,range:f,ticks:p,isZeroAlign:d,isTickAlign:u,axisOption:l,theme:c,chartType:g}}function r_(n,e,t,i,r,o,s,l){const{range:a,isZeroAlign:d,isTickAlign:u,axisOption:h}=og(n,e,t,i,o,s,l),{targetRange:c,targetTicks:g}=Ny(n,e,t,d,u,a,o,r,s,l);if(t!==0&&g){const f=ue.getFunction("getAxisDomainRangeAndLabels"),{range:p,ticks:m}=f(a.min,a.max,re({},h,{nice:!0,tick:{forceTickCount:g.length}}),d,i==="bottom"||i==="top"?l._table.getColWidth(n)||l._table.tableNoFrameWidth:l._table.getRowHeight(e)||l._table.tableNoFrameHeight,{targetTicks:g,targetRange:c});a.min=p[0],a.max=p[1]}return{axisOption:h,range:a,targetTicks:g,targetRange:c}}function Ny(n,e,t,i,r,o,s,l,a,d){let u,h;if(!i&&!r)return{targetTicks:u,targetRange:h};const c=og(n,e,s.length-1-t,l,s,a,d);if(c){const{range:g,ticks:f}=c;if(h=g,i){const p=nz(o,g);p&&(o.min=p.range1[0],o.max=p.range1[1],h.min=p.range2[0],h.max=p.range2[1])}r&&(u=i?iz(h,n,e,t,l,d):f)}return{targetTicks:u,targetRange:h}}class dz{constructor(e,t,i){this.table=e,this.customCellStyle=t,this.customCellStyleArrangement=i}getCustomCellStyle(e,t){const i=this.getCustomCellStyleIds(e,t);if(i.length){const r=[];return i.forEach(o=>{const s=this.getCustomCellStyleOption(o);if(Ae(s==null?void 0:s.style)){const l=s.style({col:e,row:t,table:this.table,value:this.table.getCellValue(e,t),dataValue:this.table.getCellOriginValue(e,t),cellHeaderPaths:this.table.getCellHeaderPaths(e,t)});r.push(l)}else s!=null&&s.style&&r.push(s.style)}),re({},...r)}}getCustomCellStyleIds(e,t){const i=[],r=this.table.getCellRange(e,t);for(let o=r.start.col;o<=r.end.col;o++)for(let s=r.start.row;s<=r.end.row;s++)this.customCellStyleArrangement.forEach(l=>{l.cellPosition.range?l.cellPosition.range.start.col<=o&&l.cellPosition.range.end.col>=o&&l.cellPosition.range.start.row<=s&&l.cellPosition.range.end.row>=s&&i.push(l.customStyleId):l.cellPosition.col===o&&l.cellPosition.row===s&&i.push(l.customStyleId)});return i}getCustomCellStyleOption(e){return this.customCellStyle.find(t=>t.id===e)}registerCustomCellStyle(e,t){const i=this.customCellStyle.findIndex(r=>r.id===e);i===-1?this.customCellStyle.push({id:e,style:t}):this.customCellStyle[i]={id:e,style:t},this.customCellStyleArrangement.forEach(r=>{const o=r.cellPosition;if(r.customStyleId===e)if(o.range)for(let s=Math.max(0,o.range.start.col);s<=Math.min(this.table.colCount-1,o.range.end.col);s++)for(let l=Math.max(0,o.range.start.row);l<=Math.min(this.table.rowCount-1,o.range.end.row);l++)this.table.scenegraph.updateCellContent(s,l);else this.table.scenegraph.updateCellContent(o.col,o.row)}),this.table.scenegraph.updateNextFrame()}arrangeCustomCellStyle(e,t,i){var r;const o=this.customCellStyleArrangement.findIndex(l=>l.cellPosition.range&&e.range?l.cellPosition.range.start.col===e.range.start.col&&l.cellPosition.range.start.row===e.range.start.row&&l.cellPosition.range.end.col===e.range.end.col&&l.cellPosition.range.end.row===e.range.end.row:l.cellPosition.col===e.col&&l.cellPosition.row===e.row);if(o===-1&&!t)return;if(o===-1&&t)this.customCellStyleArrangement.push({cellPosition:{col:e.col,row:e.row,range:e.range},customStyleId:t});else{if(this.customCellStyleArrangement[o].customStyleId===t)return;t?this.customCellStyleArrangement[o].customStyleId=t:this.customCellStyleArrangement.splice(o,1)}const s=(r=this.getCustomCellStyleOption(t))===null||r===void 0?void 0:r.style;if(s){i=!0;for(const l in s)if(KP.indexOf(l)===-1){i=!1;break}}if(e.range)for(let l=Math.max(0,e.range.start.col);l<=Math.min(this.table.colCount-1,e.range.end.col);l++)for(let a=Math.max(0,e.range.start.row);a<=Math.min(this.table.rowCount-1,e.range.end.row);a++){const d=this.table.getCellRange(l,a);for(let u=d.start.col;u<=d.end.col;u++)for(let h=d.start.row;h<=d.end.row;h++)this.table.scenegraph.updateCellContent(u,h,i)}else this.table.scenegraph.updateCellContent(e.col,e.row,i);this.table.scenegraph.updateNextFrame()}updateCustomCell(e,t){this.customCellStyle.length=0,this.customCellStyleArrangement.length=0,e.forEach(i=>{this.registerCustomCellStyle(i.id,i.style)}),t.forEach(i=>{this.arrangeCustomCellStyle(i.cellPosition,i.customStyleId)})}hasCustomCellStyle(e){return this.customCellStyle.some(t=>t.id===e)}}function is(n,e){n=n.clone();for(const t in e){const i=e[t];O(i)&&(n[`_${t}`]=i)}return n}const uz=()=>{ue.registerComponent("customCellStylePlugin",dz)},hz={};function cz(n,e,t){var i,r,o,s,l,a,d,u,h,c;const g=(i=t.customCellStylePlugin)===null||i===void 0?void 0:i.getCustomCellStyle(n,e),{layoutMap:f}=t.internalProps;if(f.isHeader(n,e)){let x;if(!t.isPivotTable()||t.isBottomFrozenRow(e)||t.isRightFrozenColumn(n))x=`${n}-${e}`;else{const M=t.getHeaderDefine(n,e),H=t.isCornerHeader(n,e);x=M!=null&&M.dimensionKey?H?`dim-cor-${M.dimensionKey}`:`dim-${M.dimensionKey}`:M!=null&&M.indicatorKey?`ind-${M.indicatorKey}`:`${n}-${e}`}let S=t.headerStyleCache.get(x);if(S)return g?is(S,g):S;const R=f.getHeader(n,e);let B;if(t.isPivotChart()&&oz(n,e,f)&&f.isAxisCell(n,e)?B=(o=(r=f.getBody(n,t.rowHeaderLevelCount).style)===null||r===void 0?void 0:r.padding)!==null&&o!==void 0?o:t.theme.bodyStyle.padding:t.isPivotChart()&&sz(n,e,f)&&f.isAxisCell(n,e)&&(B=(l=(s=f.getBody(t.columnHeaderLevelCount,e).style)===null||s===void 0?void 0:s.padding)!==null&&l!==void 0?l:t.theme.bodyStyle.padding),(!R||R.isEmpty)&&(f.isLeftBottomCorner(n,e)||f.isRightBottomCorner(n,e)||f.isCornerHeader(n,e)||f.isRightTopCorner(n,e)))return hz;const A=t.internalProps.headerHelper.getStyleClass((R==null?void 0:R.headerType)||"text");if(f.isBottomFrozenRow(n,e)&&t.theme.bottomFrozenStyle)S=ra(B?{padding:B}:{},t.theme.bottomFrozenStyle,{col:n,row:e,table:t,value:t.getCellValue(n,e),dataValue:t.getCellOriginValue(n,e),cellHeaderPaths:t.getCellHeaderPaths(n,e)},A,t.options.autoWrapText,t.theme);else if(f.isRightFrozenColumn(n,e)&&t.theme.rightFrozenStyle)S=ra(B?{padding:B}:{},t.theme.rightFrozenStyle,{col:n,row:e,table:t,value:t.getCellValue(n,e),dataValue:t.getCellOriginValue(n,e),cellHeaderPaths:t.getCellHeaderPaths(n,e)},A,t.options.autoWrapText,t.theme);else{const M=(R==null?void 0:R.style)||{};B&&(M.padding=B),S=ra(M,f.isColumnHeader(n,e)||f.isBottomFrozenRow(n,e)?t.theme.headerStyle:f.isRowHeader(n,e)||f.isRightFrozenColumn(n,e)?t.theme.rowHeaderStyle:t.theme.cornerHeaderStyle,{col:n,row:e,table:t,value:t.getCellValue(n,e),dataValue:t.getCellOriginValue(n,e),cellHeaderPaths:t.getCellHeaderPaths(n,e)},A,t.options.autoWrapText,t.theme)}return t.headerStyleCache.set(x,S),g?is(S,g):S}let p,m;!((d=(a=t.internalProps)===null||a===void 0?void 0:a.dataConfig)===null||d===void 0)&&d.mappingRules&&!t.isHeader(n,e)&&((c=(h=(u=t.internalProps)===null||u===void 0?void 0:u.dataConfig)===null||h===void 0?void 0:h.mappingRules)===null||c===void 0||c.forEach((x,S)=>{x.bgColor&&t.internalProps.layoutMap.getIndicatorKey(n,e)===x.bgColor.indicatorKey&&(p=x.bgColor.mapping)}));const b=t.getCellType(n,e),C=t.getCellOriginRecord(n,e);let _;if(m=C!=null&&C.vtableMerge?"merge-title":t.isSeriesNumberInBody(n,e)?`${n}-series-`+b:t.isListTable()&&!t.transpose||t.isPivotTable()&&t.internalProps.layoutMap.indicatorsAsCol?n+b:e+b,_=C!=null&&C.vtableMerge?t.bodyMergeTitleCache.get(m):f.isBottomFrozenRow(e)?t.bodyBottomStyleCache.get(m):t.bodyStyleCache.get(m),_)return g?is(_,g):_;const w=f.getBody(n,e),y=t.internalProps.bodyHelper.getStyleClass(t.getCellType(n,e)),v=w==null?void 0:w.style;return _=Xf(v,C!=null&&C.vtableMerge&&t.theme.groupTitleStyle?t.theme.groupTitleStyle:f.isBottomFrozenRow(e)&&t.theme.bottomFrozenStyle?t.theme.bottomFrozenStyle:f.isRightFrozenColumn(n)&&t.theme.rightFrozenStyle?t.theme.rightFrozenStyle:t.theme.bodyStyle,{col:n,row:e,table:t,value:t.getCellValue(n,e),dataValue:t.getCellOriginValue(n,e),cellHeaderPaths:t.getCellHeaderPaths(n,e)},y,t.options.autoWrapText,t.theme),p&&(_=is(_,{bgColor:p})),Ae(v)||(f.isBottomFrozenRow(e)?t.bodyBottomStyleCache.set(m,_):t.bodyStyleCache.set(m,_)),g?is(_,g):_}function o_(n){return Math.floor(n)===n}class fz extends m0{onUpdate(e,t,i){if(this.from.x!==this.to.x){const r=e?this.to.x:this.from.x+Math.floor((this.to.x-this.from.x)*t);this.params.table.scrollLeft=r}if(this.from.y!==this.to.y){const r=e?this.to.y:this.from.y+Math.floor((this.to.y-this.from.y)*t);this.params.table.scrollTop=r}}}class gz{constructor(e){this.table=e,this.timeline=new Bf,this.ticker=new g0,this.ticker.addTimeline(this.timeline),this.ticker.setFPS(60),this.tempGraphic=Ze({})}scrollTo(e,t){var i,r;const o={x:this.table.scrollLeft,y:this.table.scrollTop},{col:s,row:l}=e;let a,d,u=s,h=l;J(s)&&!o_(s)&&(u=Math.floor(s),a=s-u),J(l)&&!o_(l)&&(h=Math.floor(l),d=l-h);const c=this.table.getCellRect(u??0,h??0);let{left:g,top:f}=c;a&&(g+=a*c.width),d&&(f+=d*c.height);const p={x:J(s)?g-this.table.getFrozenColsWidth():this.table.scrollLeft,y:J(l)?f-this.table.getFrozenRowsHeight():this.table.scrollTop},m=kt(t)?t?3e3:0:(i=t==null?void 0:t.duration)!==null&&i!==void 0?i:3e3,b=kt(t)?t?"linear":"":(r=t==null?void 0:t.easing)!==null&&r!==void 0?r:"linear";new wi(pt.GenAutoIncrementId(),this.timeline).bind(this.tempGraphic).play(new fz(o,p,m,b,{graphic:this.tempGraphic,table:this.table})),this.ticker.start()}clear(){this.timeline.clear(),this.ticker.stop()}}function s_(n){return Ae(n)?n:ee(n)?(e,t)=>n.find(i=>i.range.start.col<=e&&i.range.end.col>=e&&i.range.start.row<=t&&i.range.end.row>=t):void 0}const{toBoxArray:zi}=H2,{isTouchEvent:pz}=P2,mz=/^\$(\d+)\$(\d+)$/;a2();class bz extends bu{static get EVENT_TYPE(){return j}constructor(e,t={}){var i,r,o,s,l,a,d,u,h,c,g,f,p,m,b,C;if(super(),this.showFrozenIcon=!0,this.version="1.17.2",this.id=`VTable${Date.now()}`,this.isReleased=!1,this._chartEventMap={},this.throttleInvalidate=b2(this.render.bind(this),200),!e&&t.mode!=="node"&&!t.canvas)throw new Error("vtable's container is undefined");((i=t.customConfig)===null||i===void 0?void 0:i.imageAnonymous)===!1&&(et.isImageAnonymous=!1);const{frozenColCount:_=0,unfreezeAllOnExceedsMaxWidth:w,frozenRowCount:y,defaultRowHeight:v=40,defaultHeaderRowHeight:x,defaultColWidth:S=80,defaultHeaderColWidth:R,widthMode:B="standard",heightMode:A="standard",autoFillWidth:M=!1,autoFillHeight:H=!1,widthAdaptiveMode:E="only-body",heightAdaptiveMode:T="only-body",keyboardOptions:P,eventOptions:k,rowSeriesNumber:L,columnResizeMode:F,rowResizeMode:z="none",resize:I,dragHeaderMode:N,dragOrder:W,showFrozenIcon:D,allowFrozenColCount:G,padding:V,hover:X,menu:$,select:Q,customRender:te,pixelRatio:le=gr,renderChartAsync:fe,renderChartAsyncBatchCount:ne,mode:ie,modeParams:ce,canvasWidth:ae,canvasHeight:q,overscrollBehavior:_e,limitMinWidth:oe,limitMinHeight:Y,clearDOM:de=!0}=t;this.container=e,this.options=t,this._widthMode=B,this._heightMode=A,this._widthAdaptiveMode=E,this._heightAdaptiveMode=T,this._autoFillWidth=M,this._autoFillHeight=H,this.customRender=te,this.padding={top:0,right:0,left:0,bottom:0},V&&(typeof V=="number"?(this.padding.top=V,this.padding.left=V,this.padding.bottom=V,this.padding.right=V):(V.top&&(this.padding.top=V.top),V.bottom&&(this.padding.bottom=V.bottom),V.left&&(this.padding.left=V.left),V.right&&(this.padding.right=V.right))),O(q)&&O(ae)&&(this.canvasSizeSeted=!0),this.tableNoFrameWidth=0,this.tableNoFrameHeight=0,this.canvasWidth=J(ae)?ae:void 0,this.canvasHeight=J(q)?q:void 0,this.columnWidthComputeMode=(r=t.columnWidthComputeMode)!==null&&r!==void 0?r:"normal";const K=this.internalProps={};D!==void 0&&(this.showFrozenIcon=D),typeof G=="number"&&G<=0&&(this.showFrozenIcon=!1),this.options.canvas?(Me.mode!=="node"&&(K.element=this.options.canvas.parentElement,K.element.style.position="relative"),K.focusControl=new KC(this,K.element),K.canvas=this.options.canvas,K.context=K.canvas.getContext("2d")):Me.mode!=="node"&&(K.element=zH(this.padding),K.focusControl=new KC(this,K.element),K.canvas=document.createElement("canvas"),K.element.appendChild(K.canvas),K.context=K.canvas.getContext("2d"),!((o=t.customConfig)===null||o===void 0)&&o.createReactContainer&&HE(this)),K.handler=new wu,J(this.options.resizeTime)&&(K.handler.resizeTime=this.options.resizeTime),K.pixelRatio=le,K.frozenColCount=_,K.frozenRowCount=y,K.unfreezeAllOnExceedsMaxWidth=w==null||w,K.defaultRowHeight=v,K.defaultHeaderRowHeight=x??v,K.defaultColWidth=S,K.defaultHeaderColWidth=R??S,K.keyboardOptions=P,K.eventOptions=k,K.rowSeriesNumber=L,K.columnResizeMode=(s=I==null?void 0:I.columnResizeMode)!==null&&s!==void 0?s:F,K.rowResizeMode=(l=I==null?void 0:I.rowResizeMode)!==null&&l!==void 0?l:z,K.dragHeaderMode=(d=(a=W==null?void 0:W.dragHeaderMode)!==null&&a!==void 0?a:N)!==null&&d!==void 0?d:"none",K.renderChartAsync=fe,nC(ne),K.overscrollBehavior=_e??"auto",K._rowHeightsMap=new YC(this),K._rowRangeHeightsMap=new Map,K._colRangeWidthsMap=new Map,K._widthResizedColMap=new Set,K._heightResizedRowMap=new Set,this.colWidthsMap=new Ki,this.colContentWidthsMap=new Ki,this.colWidthsLimit={};const ut=this;if(K.calcWidthContext={_:K,get full(){var We;return Me.mode==="node"?ut.canvasWidth/(le??1):this._.canvas.width/((We=this._.context.pixelRatio)!==null&&We!==void 0?We:window.devicePixelRatio)}},K.cellTextOverflows={},K.focusedTable=!1,K.theme=Fi.of((u=t.theme)!==null&&u!==void 0?u:Fi.DEFAULT),K.theme.isPivot=this.isPivotTable(),Gl(K.theme.functionalIconsStyle),e?(de&&(e.innerHTML=""),e.appendChild(K.element),this._updateSize()):this._updateSize(),K.bodyHelper=new kF(this),K.headerHelper=new GF(this),K.rowSeriesNumberHelper=new jF(this),K.autoWrapText=t.autoWrapText,K.enableLineBreak=t.enableLineBreak,K.allowFrozenColCount=(h=t.allowFrozenColCount)!==null&&h!==void 0?h:0,K.limitMaxAutoWidth=(c=t.limitMaxAutoWidth)!==null&&c!==void 0?c:450,K.limitMinWidth=oe!=null?typeof oe=="number"?oe:oe?10:0:10,K.limitMinHeight=Y!=null?typeof Y=="number"?Y:Y?10:0:10,this.scenegraph=new gL(this),this.stateManager=new rF(this),this.eventManager=new MF(this),this.animationManager=new gz(this),t.legends){K.legends=[];const We=ue.getFunction("createLegend");if(Array.isArray(t.legends)){for(let bt=0;bt<t.legends.length;bt++)K.legends.push(We(t.legends[bt],this));this.scenegraph.tableGroup.setAttributes({x:this.tableX,y:this.tableY})}else K.legends.push(We(t.legends,this)),this.scenegraph.tableGroup.setAttributes({x:this.tableX,y:this.tableY})}if(K.tooltip=Object.assign({parentElement:this.getElement(),renderMode:"html",isShowOverflowTextTooltip:!1,confine:!0,position:sn.bottom},t.tooltip),K.tooltip.renderMode==="html"){const We=ue.getComponent("tooltipHandler");We&&(K.tooltipHandler=new We(this,K.tooltip.confine))}if(K.menu=Object.assign({renderMode:"html"},t.menu),Array.isArray((g=t.menu)===null||g===void 0?void 0:g.dropDownMenuHighlight)&&this.setDropDownMenuHighlight((f=t.menu)===null||f===void 0?void 0:f.dropDownMenuHighlight),(Array.isArray((p=t.menu)===null||p===void 0?void 0:p.defaultHeaderMenuItems)||typeof((m=t.menu)===null||m===void 0?void 0:m.defaultHeaderMenuItems)=="function")&&(this.globalDropDownMenu=t.menu.defaultHeaderMenuItems),K.menu.renderMode==="html"){const We=ue.getComponent("menuHandler");K.menuHandler=new We(this)}this.headerStyleCache=new Map,this.bodyStyleCache=new Map,this.bodyMergeTitleCache=new Map,this.bodyBottomStyleCache=new Map,K.stick={changedCells:new Map},K.customMergeCell=s_(t.customMergeCell);const he=ue.getComponent("customCellStylePlugin");he&&(this.customCellStylePlugin=new he(this,(b=t.customCellStyle)!==null&&b!==void 0?b:[],(C=t.customCellStyleArrangement)!==null&&C!==void 0?C:[])),this._adjustCanvasSizeByOption()}_adjustCanvasSizeByOption(){this.options.canvasHeight!=="auto"&&this.options.canvasWidth!=="auto"||setTimeout(()=>{var e,t,i,r,o,s,l,a,d,u,h,c,g,f,p,m,b,C,_,w,y,v,x,S;let R,B;if(this.options.canvasHeight==="auto"){let A=0;if(!((e=this.theme.frameStyle)===null||e===void 0)&&e.innerBorder)A+=(r=zi((i=(t=this.internalProps.theme.frameStyle)===null||t===void 0?void 0:t.shadowBlur)!==null&&i!==void 0?i:[0])[1])!==null&&r!==void 0?r:0;else if(this.theme.frameStyle){const M=zi((s=(o=this.internalProps.theme.frameStyle)===null||o===void 0?void 0:o.borderLineWidth)!==null&&s!==void 0?s:[null]),H=zi((a=(l=this.internalProps.theme.frameStyle)===null||l===void 0?void 0:l.shadowBlur)!==null&&a!==void 0?a:[0]);A+=((d=M[0])!==null&&d!==void 0?d:0)+((u=H[0])!==null&&u!==void 0?u:0)+(((h=M[2])!==null&&h!==void 0?h:0)+((c=H[2])!==null&&c!==void 0?c:0))}B=Math.min(this.options.maxCanvasHeight?this.options.maxCanvasHeight-A:2e4,this.getAllRowsHeight())+A}else B=this.canvasHeight;if(this.options.canvasWidth==="auto"){let A=0;if(!((g=this.theme.frameStyle)===null||g===void 0)&&g.innerBorder)A+=(m=zi((p=(f=this.internalProps.theme.frameStyle)===null||f===void 0?void 0:f.shadowBlur)!==null&&p!==void 0?p:[0])[2])!==null&&m!==void 0?m:0;else if(this.theme.frameStyle){const M=zi((C=(b=this.internalProps.theme.frameStyle)===null||b===void 0?void 0:b.borderLineWidth)!==null&&C!==void 0?C:[null]),H=zi((w=(_=this.internalProps.theme.frameStyle)===null||_===void 0?void 0:_.shadowBlur)!==null&&w!==void 0?w:[0]);A+=((y=M[1])!==null&&y!==void 0?y:0)+((v=H[1])!==null&&v!==void 0?v:0)+(((x=M[3])!==null&&x!==void 0?x:0)+((S=H[3])!==null&&S!==void 0?S:0))}R=Math.min(this.options.maxCanvasWidth?this.options.maxCanvasWidth-A:2e4,this.getAllColsWidth())+A}else R=this.canvasWidth;this.setCanvasSize(R,B)},0)}getContainer(){return this.container}getElement(){return this.internalProps.element}get canvas(){return this.internalProps.canvas}setCanvasSize(e,t){this.canvasWidth=e,this.canvasHeight=t,this.options.canvasHeight=t,this.options.canvasWidth=e,this.resize()}resize(){var e;this._updateSize(),(e=this.internalProps.legends)===null||e===void 0||e.forEach(t=>{t==null||t.resize()}),this.internalProps.title&&this.internalProps.title.resize(),this.internalProps.emptyTip&&this.internalProps.emptyTip.resize(),this.scenegraph.resize()}get rowCount(){return this.internalProps.rowCount}set rowCount(e){this.internalProps.rowCount=e}get colCount(){var e;return(e=this.internalProps.colCount)!==null&&e!==void 0?e:0}set colCount(e){this.internalProps.colCount=e}get frozenColCount(){var e,t,i,r,o;return(o=(i=(t=(e=this.internalProps)===null||e===void 0?void 0:e.layoutMap)===null||t===void 0?void 0:t.frozenColCount)!==null&&i!==void 0?i:(r=this.internalProps)===null||r===void 0?void 0:r.frozenColCount)!==null&&o!==void 0?o:0}set frozenColCount(e){e>=this.colCount&&(e=0),this.internalProps.frozenColCount=e,this.options.frozenColCount=e;const t=this._getMaxFrozenWidth();if(this.getColsWidth(0,e-1)>t)if(this.internalProps.unfreezeAllOnExceedsMaxWidth)this.internalProps.frozenColCount=0;else{const i=this._getComputedFrozenColCount(e);this.internalProps.frozenColCount=i}this.stateManager.setFrozenCol(this.internalProps.frozenColCount)}setFrozenColCount(e){e>=this.colCount&&(e=0),this.internalProps.frozenColCount=e,this.options.frozenColCount=e;const t=this._getMaxFrozenWidth();if(this.getColsWidth(0,e-1)>t)if(this.internalProps.unfreezeAllOnExceedsMaxWidth)this.internalProps.frozenColCount=0;else{const i=this._getComputedFrozenColCount(e);this.internalProps.frozenColCount=i}this.stateManager.setFrozenCol(this.internalProps.frozenColCount)}_setFrozenColCount(e){e>=this.colCount&&(e=0),this.internalProps.frozenColCount=e}_resetFrozenColCount(){this.options.frozenColCount&&(this.tableNoFrameWidth-this.getColsWidth(0,this.options.frozenColCount-1)<=120?this._setFrozenColCount(0):this.frozenColCount!==this.options.frozenColCount&&this._setFrozenColCount(this.options.frozenColCount))}get frozenRowCount(){var e,t,i,r,o;return(o=(i=(t=(e=this.internalProps)===null||e===void 0?void 0:e.layoutMap)===null||t===void 0?void 0:t.frozenRowCount)!==null&&i!==void 0?i:(r=this.internalProps)===null||r===void 0?void 0:r.frozenRowCount)!==null&&o!==void 0?o:0}set frozenRowCount(e){this.internalProps.frozenRowCount=e,this.stateManager.setFrozenRow(this.internalProps.frozenRowCount)}get rightFrozenColCount(){var e,t,i,r,o;return(o=(i=(t=(e=this.internalProps)===null||e===void 0?void 0:e.layoutMap)===null||t===void 0?void 0:t.rightFrozenColCount)!==null&&i!==void 0?i:(r=this.internalProps)===null||r===void 0?void 0:r.rightFrozenColCount)!==null&&o!==void 0?o:0}set rightFrozenColCount(e){this.scenegraph.dealWidthRightFrozen(e)}get bottomFrozenRowCount(){var e,t,i,r,o;return(o=(i=(t=(e=this.internalProps)===null||e===void 0?void 0:e.layoutMap)===null||t===void 0?void 0:t.bottomFrozenRowCount)!==null&&i!==void 0?i:(r=this.internalProps)===null||r===void 0?void 0:r.bottomFrozenRowCount)!==null&&o!==void 0?o:0}set bottomFrozenRowCount(e){this.scenegraph.dealWidthBottomFrozen(e)}get defaultRowHeight(){return J(this.internalProps.defaultRowHeight)?this.internalProps.defaultRowHeight:40}set defaultRowHeight(e){this.internalProps.defaultRowHeight=e,this.options.defaultRowHeight=e}get defaultHeaderRowHeight(){return this.internalProps.defaultHeaderRowHeight}set defaultHeaderRowHeight(e){this.internalProps.defaultHeaderRowHeight=e,this.options.defaultHeaderRowHeight=e}get defaultColWidth(){return this.internalProps.defaultColWidth}set defaultColWidth(e){this.internalProps.defaultColWidth=e,this.options.defaultColWidth=e}get defaultHeaderColWidth(){return this.internalProps.defaultHeaderColWidth}set defaultHeaderColWidth(e){this.internalProps.defaultHeaderColWidth=e,this.options.defaultHeaderColWidth=e}get colWidthsMap(){return this.internalProps._colWidthsMap}set colWidthsMap(e){this.internalProps._colWidthsMap=e}get colContentWidthsMap(){return this.internalProps._colContentWidthsMap}set colContentWidthsMap(e){this.internalProps._colContentWidthsMap=e}get _colRangeWidthsMap(){return this.internalProps._colRangeWidthsMap}set _colRangeWidthsMap(e){this.internalProps._colRangeWidthsMap=e}get _rowRangeHeightsMap(){return this.internalProps._rowRangeHeightsMap}set _rowRangeHeightsMap(e){this.internalProps._rowRangeHeightsMap=e}get rowHeightsMap(){return this.internalProps._rowHeightsMap}set rowHeightsMap(e){this.internalProps._rowHeightsMap=e}get colWidthsLimit(){return this.internalProps._colWidthsLimit}set colWidthsLimit(e){this.internalProps._colWidthsLimit=e}get keyboardOptions(){var e;return(e=this.internalProps.keyboardOptions)!==null&&e!==void 0?e:null}set keyboardOptions(e){this.internalProps.keyboardOptions=e??void 0}get eventOptions(){var e;return(e=this.internalProps.eventOptions)!==null&&e!==void 0?e:null}set eventOptions(e){this.internalProps.eventOptions=e??void 0}get widthMode(){return this._widthMode}set widthMode(e){e!==this._widthMode&&(this._widthMode=e,this.options.widthMode=e)}get heightMode(){return this._heightMode}set heightMode(e){e!==this._heightMode&&(this._heightMode=e,this.options.heightMode=e)}get autoFillWidth(){return this._autoFillWidth}set autoFillWidth(e){e!==this._autoFillWidth&&(this._autoFillWidth=e)}get autoFillHeight(){return this._autoFillHeight}set autoFillHeight(e){e!==this._autoFillHeight&&(this._autoFillHeight=e)}get widthAdaptiveMode(){return this._widthAdaptiveMode}set widthAdaptiveMode(e){e!==this._widthAdaptiveMode&&(this._widthAdaptiveMode=e)}get heightAdaptiveMode(){return this._heightAdaptiveMode}set heightAdaptiveMode(e){e!==this._heightAdaptiveMode&&(this._heightAdaptiveMode=e)}_colWidthDefineToPxWidth(e){return e==="auto"?0:$r(this,e)}_getMaxFrozenWidth(){var e;const t=(e=this.options.maxFrozenWidth)!==null&&e!==void 0?e:"80%";return $r(this,t)}_getComputedFrozenColCount(e){const t=this._getMaxFrozenWidth();let i=e;for(;this.getColsWidth(0,i-1)>t&&(i--,!(i<=0)););return i}_getColWidthLimits(e){const t=this.colWidthsLimit[e];if(!t)return null;const i={};return t.min&&(i.min=$r(this,t.min),i.minDef=t.min),t.max&&(i.max=$r(this,t.max),i.maxDef=t.max),i}_adjustColWidth(e,t){const i=this._getColWidthLimits(e);return Math.max(NH(i,t),0)}get pixelRatio(){return this.internalProps.pixelRatio}setPixelRatio(e){var t;if(e!==((t=this.internalProps)===null||t===void 0?void 0:t.pixelRatio)){this.internalProps.pixelRatio=e;const i=this.canvasWidth;this.internalProps.calcWidthContext={_:this.internalProps,get full(){var r;return Me.mode==="node"?i/(e??1):this._.canvas.width/((r=this._.context.pixelRatio)!==null&&r!==void 0?r:window.devicePixelRatio)}},this.scenegraph.setPixelRatio(e)}}_updateSize(){var e,t,i,r,o,s,l,a,d,u,h,c,g,f,p,m,b,C,_,w,y,v,x,S,R,B;const{padding:A}=this;let M=0,H=0;if(this.tableX=0,this.tableY=0,this.options.canvas&&this.options.viewBox)M=this.options.viewBox.x2-this.options.viewBox.x1,H=this.options.viewBox.y2-this.options.viewBox.y1,!((e=this==null?void 0:this.scenegraph)===null||e===void 0)&&e.stage&&(this.options.viewBox?this.scenegraph.stage.setViewBox(this.options.viewBox,!1):this.scenegraph.stage.resize(M,H));else if(Me.mode==="browser"){const P=this.getElement();let k=0,L=0;if(this.canvasSizeSeted)k=this.canvasWidth,L=this.canvasHeight;else if(P.parentElement){const z=P.parentElement.style||window.getComputedStyle(P.parentElement);k=P.parentElement.offsetWidth-parseInt(z.paddingLeft||"0px",10)-parseInt(z.paddingRight||"0px",10),L=P.parentElement.offsetHeight-parseInt(z.paddingTop||"0px",10)-parseInt(z.paddingBottom||"0px",20),k=(k??1)-(this.options.tableSizeAntiJitter?1:0),L=(L??1)-(this.options.tableSizeAntiJitter?1:0)}P.style.width=k&&k-A.left-A.right+"px"||"0px",P.style.height=L&&L-A.top-A.bottom+"px"||"0px";const{canvas:F}=this.internalProps;M=((i=(t=F.parentElement)===null||t===void 0?void 0:t.offsetWidth)!==null&&i!==void 0?i:1)-(this.options.tableSizeAntiJitter?1:0),H=((o=(r=F.parentElement)===null||r===void 0?void 0:r.offsetHeight)!==null&&o!==void 0?o:1)-(this.options.tableSizeAntiJitter?1:0),!((s=this==null?void 0:this.scenegraph)===null||s===void 0)&&s.stage?this.scenegraph.stage.resize(M,H):(F.style.width="",F.style.height="",F.width=M,F.height=H,F.style.width=`${M}px`,F.style.height=`${H}px`)}else Me.mode==="node"&&(M=this.canvasWidth-1,H=this.canvasHeight-1);const E=Math.floor(M-u2(this.getTheme().scrollStyle)),T=Math.floor(H-d2(this.getTheme().scrollStyle));if(!((l=this.internalProps.theme)===null||l===void 0)&&l.frameStyle){const P=zi((d=(a=this.internalProps.theme.frameStyle)===null||a===void 0?void 0:a.borderLineWidth)!==null&&d!==void 0?d:[null]),k=zi((h=(u=this.internalProps.theme.frameStyle)===null||u===void 0?void 0:u.shadowBlur)!==null&&h!==void 0?h:[0]);!((c=this.theme.frameStyle)===null||c===void 0)&&c.innerBorder?(this.tableX=0,this.tableY=0,this.tableNoFrameWidth=E-((g=k[1])!==null&&g!==void 0?g:0),this.tableNoFrameHeight=T-((f=k[2])!==null&&f!==void 0?f:0)):(this.tableX=((p=P[3])!==null&&p!==void 0?p:0)+((m=k[3])!==null&&m!==void 0?m:0),this.tableY=((b=P[0])!==null&&b!==void 0?b:0)+((C=k[0])!==null&&C!==void 0?C:0),this.tableNoFrameWidth=E-(((_=P[1])!==null&&_!==void 0?_:0)+((w=k[1])!==null&&w!==void 0?w:0))-(((y=P[3])!==null&&y!==void 0?y:0)+((v=k[3])!==null&&v!==void 0?v:0)),this.tableNoFrameHeight=T-(((x=P[0])!==null&&x!==void 0?x:0)+((S=k[0])!==null&&S!==void 0?S:0))-(((R=P[2])!==null&&R!==void 0?R:0)+((B=k[2])!==null&&B!==void 0?B:0)))}}updateViewBox(e){var t,i,r,o,s,l,a,d;const u=(o=(i=(t=this.options)===null||t===void 0?void 0:t.viewBox.x2)!==null&&i!==void 0?i:0-((r=this.options)===null||r===void 0?void 0:r.viewBox.x1))!==null&&o!==void 0?o:0,h=(d=(l=(s=this.options)===null||s===void 0?void 0:s.viewBox.y2)!==null&&l!==void 0?l:0-((a=this.options)===null||a===void 0?void 0:a.viewBox.y1))!==null&&d!==void 0?d:0,c=e.x2-e.x1,g=e.y2-e.y1;this.options.viewBox=e,u!==c||h!==g?this.resize():this.scenegraph.stage.setViewBox(this.options.viewBox,!0)}setViewBoxTransform(e,t,i,r,o,s){this.internalProps.modifiedViewBoxTransform=!0,this.scenegraph.stage.window.setViewBoxTransform(e,t,i,r,o,s)}get rowHierarchyType(){return"grid"}getColsWidth(e,t){var i;if(e>t)return 0;e=Math.max(e,0),t=Math.min(t,((i=this.colCount)!==null&&i!==void 0?i:1/0)-1);const r=this._colRangeWidthsMap.get(`$${e}$${t}`);if(r!=null)return r;const o=this._colRangeWidthsMap.get(`$${e}$${t-1}`);if(o!=null){const l=o+this.getColWidth(t);return e>=0&&t>=0&&!Number.isNaN(l)&&this._colRangeWidthsMap.set(`$${e}$${t}`,Math.round(l)),Math.round(l)}let s=0;for(let l=e;l<=t;l++)s+=this.getColWidth(l);return e>=0&&t>=0&&this._colRangeWidthsMap.set(`$${e}$${t}`,Math.round(s)),Math.round(s)}getRowHeight(e){var t;if(O(this.rowHeightsMap.get(e))){if(!((t=this.options.customConfig)===null||t===void 0)&&t._disableColumnAndRowSizeRound){const r=this.rowHeightsMap.get(e);let o;return o=e<this.frozenRowCount?this.rowHeightsMap.getSumInRange(0,e):e>=this.rowCount-this.bottomFrozenRowCount?this.rowHeightsMap.getSumInRange(e,this.rowCount-1):this.rowHeightsMap.getSumInRange(this.frozenRowCount,e),o=Number(o.toFixed(2)),Number.isInteger(o)?Math.ceil(r):Math.floor(r)}return this.rowHeightsMap.get(e)}const i=this.getDefaultRowHeight(e);return J(i)?i:this.defaultRowHeight}getDefaultColumnWidth(e){var t,i;return this.isRowHeader(e,0)||this.isCornerHeader(e,0)?Array.isArray(this.defaultHeaderColWidth)?(t=this.defaultHeaderColWidth[e])!==null&&t!==void 0?t:this.defaultColWidth:this.defaultHeaderColWidth:this.isRightFrozenColumn(e,this.columnHeaderLevelCount)&&this.isPivotTable()?Array.isArray(this.defaultHeaderColWidth)?(i=this.defaultHeaderColWidth[this.rowHeaderLevelCount-this.rightFrozenColCount])!==null&&i!==void 0?i:this.defaultColWidth:this.defaultHeaderColWidth:this.defaultColWidth}getDefaultRowHeight(e){var t,i;return this.isColumnHeader(0,e)||this.isCornerHeader(0,e)||this.isSeriesNumberInHeader(0,e)?Array.isArray(this.defaultHeaderRowHeight)?(t=this.defaultHeaderRowHeight[e])!==null&&t!==void 0?t:this.internalProps.defaultRowHeight:this.defaultHeaderRowHeight:this.isBottomFrozenRow(e)?Array.isArray(this.defaultHeaderRowHeight)?(i=this.defaultHeaderRowHeight[this.columnHeaderLevelCount>0?this.columnHeaderLevelCount-this.bottomFrozenRowCount:0])!==null&&i!==void 0?i:this.internalProps.defaultRowHeight:this.defaultHeaderRowHeight:this.internalProps.defaultRowHeight}_setRowHeight(e,t,i){var r;this.rowHeightsMap.put(e,!((r=this.options.customConfig)===null||r===void 0)&&r._disableColumnAndRowSizeRound?t:Math.round(t)),i&&this._clearRowRangeHeightsMap(e)}setRowHeight(e,t){this.scenegraph.setRowHeight(e,t),this.scenegraph.updateChartSizeForResizeRowHeight(e),this.internalProps._heightResizedRowMap.add(e)}getRowsHeight(e,t){var i,r;if(e>t||this.rowCount===0)return 0;e=Math.max(e,0),t=Math.min(t,((i=this.rowCount)!==null&&i!==void 0?i:1/0)-1);let o=0;const s=this.options.defaultRowHeight==="auto";if(this.heightMode!=="standard"||this.options.customComputeRowHeight||this.autoFillHeight||!this.internalProps.layoutMap||this.hasAutoImageColumn()||s||this.internalProps._heightResizedRowMap.size!==0){if(!((r=this.options.customConfig)===null||r===void 0)&&r._disableColumnAndRowSizeRound){const l=this.rowHeightsMap.getSumInRange(e,t);let a;return a=t<this.frozenRowCount?this.rowHeightsMap.getSumInRange(0,t):t>=this.rowCount-this.bottomFrozenRowCount?this.rowHeightsMap.getSumInRange(t,this.rowCount-1):this.rowHeightsMap.getSumInRange(this.frozenRowCount,t),a=Number(a.toFixed(2)),Number.isInteger(a)?Math.ceil(l):Math.floor(l)}o=this.rowHeightsMap.getSumInRange(e,t)}else{for(let l=e;l<Math.min(t+1,this.columnHeaderLevelCount);l++)o+=this.getRowHeight(l);t>=this.columnHeaderLevelCount&&(o+=this.defaultRowHeight*(Math.min(t,this.rowCount-this.bottomFrozenRowCount-1)-Math.max(this.columnHeaderLevelCount,e)+1));for(let l=this.rowCount-this.bottomFrozenRowCount;l<t+1;l++)o+=this.getRowHeight(l)}return Math.round(o)}getColWidthDefined(e){var t;const{layoutMap:i}=this.internalProps;if(this.widthMode==="autoWidth")return"auto";const{width:r}=(t=i==null?void 0:i.getColumnWidthDefined(e))!==null&&t!==void 0?t:{};return typeof r=="number"&&r<=0?0:r||this.getDefaultColumnWidth(e)}getColWidthDefinedNumber(e){const t=this.getColWidthDefined(e);return this._adjustColWidth(e,this._colWidthDefineToPxWidth(t))}isAutoRowHeight(e){return this.heightMode==="autoHeight"||!!this.options.customComputeRowHeight||e>=0&&e<this.columnHeaderLevelCount&&this.getDefaultRowHeight(e)==="auto"}getColWidth(e){var t;const i=(t=this.colWidthsMap.get(e))!==null&&t!==void 0?t:this.getDefaultColumnWidth(e);return this.widthMode==="adaptive"&&typeof i=="number"||this.transpose&&typeof i=="number"?this._colWidthDefineToPxWidth(i):this._adjustColWidth(e,this._colWidthDefineToPxWidth(i))}_setColWidth(e,t,i,r){this.colWidthsMap.put(e,typeof t=="number"?Math.round(t):t),i&&this._clearColRangeWidthsMap(e),r||this.stateManager.checkFrozen()}setColWidth(e,t){this.scenegraph.setColWidth(e,t),this.scenegraph.updateChartSizeForResizeColWidth(e),this.internalProps._widthResizedColMap.add(e)}_clearColRangeWidthsMap(e){if(typeof e!="number")this._colRangeWidthsMap.clear();else{const t=this._colRangeWidthsMap.keys();for(const i of t){const r=mz.exec(i);if(r){const o=Number(r[1]),s=Number(r[2]);e>=o&&e<=s&&this._colRangeWidthsMap.delete(i)}}}}_clearRowRangeHeightsMap(e){this.rowHeightsMap.clearRange()}_getColContentWidth(e){return Number(this.colContentWidthsMap.get(e))}_setColContentWidth(e,t){this.colContentWidthsMap.put(e,t)}getAllRowsHeight(){return this.internalProps.rowCount<=0?0:this.getRowsHeight(0,this.internalProps.rowCount-1)}getAllColsWidth(){return this.internalProps.colCount<=0?0:this.getColsWidth(0,this.internalProps.colCount-1)}getMaxColWidth(e){var t;const i=this.colWidthsLimit[e];let r=(t=i&&i.max)!==null&&t!==void 0?t:1/0;return typeof r=="string"&&(r=$r(this,r)),r}setMaxColWidth(e,t){(this.colWidthsLimit[e]||(this.colWidthsLimit[e]={})).max=t}getMinColWidth(e){var t;const i=this.colWidthsLimit[e];let r=(t=i&&i.min)!==null&&t!==void 0?t:0;return typeof r=="string"&&(r=$r(this,r)),r}setMinColWidth(e,t){(this.colWidthsLimit[e]||(this.colWidthsLimit[e]={})).min=t}getCellRect(e,t){var i,r;const o=this.isFrozenCell(e,t);let s;const l=this.getColWidth(e);let a;s=o&&o.col&&this.isRightFrozenColumn(e,t)?this.getAllColsWidth()<=this.tableNoFrameWidth?this.getColsWidth(0,e-1)||0:this.tableNoFrameWidth-((i=this.getColsWidth(e,this.colCount-1))!==null&&i!==void 0?i:0):this.getColsWidth(0,e-1)||0;const d=this.getRowHeight(t);return a=o&&o.row&&this.isBottomFrozenRow(e,t)?this.getAllRowsHeight()<=this.tableNoFrameHeight?this.getRowsHeight(0,t-1):this.tableNoFrameHeight-((r=this.getRowsHeight(t,this.rowCount-1))!==null&&r!==void 0?r:0):this.getRowsHeight(0,t-1),new Zn(Math.round(s),Math.round(a),Math.round(l),Math.round(d))}getMergeCellRect(e,t){const i=this.getCellRange(e,t),r=this.getColsWidth(0,i.start.col-1)||0,o=this.getColsWidth(i.start.col,i.end.col),s=this.getRowsHeight(0,i.start.row-1)||0,l=this.getRowsHeight(i.start.row,i.end.row);return new Zn(Math.round(r),Math.round(s),Math.round(o),Math.round(l))}getCellRelativeRect(e,t){const i=this.isFrozenCell(e,t);let r=!0,o=!0;i!=null&&i.col&&(i!=null&&i.row)?(r=!1,o=!1):i!=null&&i.col?r=!1:i!=null&&i.row&&(o=!1);const s=this.getCellRect(e,t);return this._toRelativeRect(s,r,o)}getCellRangeRelativeRect(e){if(e.start){const s=this.isFrozenCell(e.start.col,e.start.row);let l=!0,a=!0;return s!=null&&s.col&&(s!=null&&s.row)?(l=!1,a=!1):s!=null&&s.col?l=!1:s!=null&&s.row&&(a=!1),this._toRelativeRect(this.getCellsRect(e.start.col,e.start.row,e.end.col,e.end.row),l,a)}const t=this.getCellRange(e.col,e.row),i=this.isFrozenCell(e.col,e.row);let r=!0,o=!0;return i!=null&&i.col&&(i!=null&&i.row)?(r=!1,o=!1):i!=null&&i.col?r=!1:i!=null&&i.row&&(o=!1),this._toRelativeRect(this.getCellsRect(t.start.col,t.start.row,t.end.col,t.end.row),r,o)}getVisibleCellRangeRelativeRect(e){let t;return t=e.start?e:this.getCellRange(e.col,e.row),this._getVisiableRect(this.getCellRangeRelativeRect(e),t)}_getVisiableRect(e,t){const i=t.start.col>=this.frozenColCount?Math.max(e.left,this.frozenColCount>=1?this.getColsWidth(0,this.frozenColCount-1):0):e.left,r=Math.min(e.right,this.tableNoFrameWidth),o=e.copy();o.left=i,o.right=r;const s=t.start.row>=this.frozenRowCount?Math.max(e.top,this.frozenRowCount>=1?this.getRowsHeight(0,this.frozenRowCount-1):0):e.top,l=Math.min(e.bottom,this.tableNoFrameHeight);return o.top=s,o.bottom=l,o}getCellsRect(e,t,i,r){var o,s,l,a,d,u;let h=this.getColsWidth(0,e-1)||0,c=this.getColsWidth(e,i);const g=this.scrollLeft;this.isLeftFrozenColumn(e)&&this.isRightFrozenColumn(i)?c=this.tableNoFrameWidth-((o=this.getColsWidth(e+1,this.colCount-1))!==null&&o!==void 0?o:0)-h:this.isLeftFrozenColumn(e)&&!this.isLeftFrozenColumn(i)?c=Math.max(c-g,this.getColsWidth(e,this.frozenColCount-1)):!this.isRightFrozenColumn(e)&&this.isRightFrozenColumn(i)?(h=Math.min(h-g,this.tableNoFrameWidth-this.getRightFrozenColsWidth()),c=this.tableNoFrameWidth-((s=this.getColsWidth(e+1,this.colCount-1))!==null&&s!==void 0?s:0)-h):this.isRightFrozenColumn(e)&&(h=this.tableNoFrameWidth-((l=this.getColsWidth(e,this.colCount-1))!==null&&l!==void 0?l:0));let f=this.getRowsHeight(0,t-1),p=this.getRowsHeight(t,r);const m=this.scrollTop;return this.isTopFrozenRow(t)&&this.isBottomFrozenRow(r)?p=this.tableNoFrameHeight-((a=this.getRowsHeight(t+1,this.rowCount-1))!==null&&a!==void 0?a:0)-f:this.isTopFrozenRow(t)&&!this.isTopFrozenRow(r)?p=Math.max(p-m,this.getRowsHeight(t,this.frozenRowCount-1)):!this.isBottomFrozenRow(t)&&this.isBottomFrozenRow(r)?(f=Math.min(f-m,this.tableNoFrameHeight-this.getBottomFrozenRowsHeight()),p=this.tableNoFrameHeight-((d=this.getRowsHeight(t+1,this.rowCount-1))!==null&&d!==void 0?d:0)-f):this.isBottomFrozenRow(t)&&(f=this.tableNoFrameHeight-((u=this.getRowsHeight(t,this.rowCount-1))!==null&&u!==void 0?u:0)),new Zn(Math.round(h),Math.round(f),Math.round(c),Math.round(p))}getCellsRectWidth(e,t,i,r){const o=this.isFrozenCell(e,t),s=this.isFrozenCell(i,r);let l=this.getColsWidth(e,i);if(o&&o.col){const a=this.scrollLeft;s&&s.col||(l-=a,l=Math.max(l,this.getColsWidth(e,this.frozenColCount-1)))}return l}getCellRangeRect(e){if(e.start)return this.getCellsRect(e.start.col,e.start.row,e.end.col,e.end.row);const t=this.getCellRange(e.col,e.row);return this.getCellsRect(t.start.col,t.start.row,t.end.col,t.end.row)}getCellRangeRectWidth(e){if(e.start)return this.getCellsRectWidth(e.start.col,e.start.row,e.end.col,e.end.row);const t=this.getCellRange(e.col,e.row);return this.getCellsRectWidth(t.start.col,t.start.row,t.end.col,t.end.row)}isFrozenCell(e,t){const i=this.isFrozenRow(t),r=this.isFrozenColumn(e);return i||r?{row:i,col:r}:null}getRowAt(e){return zy(e,this)}getColAt(e){return Iy(e,this)}getCellAt(e,t){return JF(e,t,this)}getCellAtRelativePosition(e,t){return tz(e,t,this)}_checkRowCol(e,t){return e>=0&&e<this.colCount&&t>=0&&t<this.rowCount}_makeVisibleCell(e,t){if(this._checkRowCol(e,t)){const i=this.isFrozenCell(e,t);if(i&&i.col&&i.row)return;const r=this.getCellRect(e,t),o=VH(this);if(o.contains(r))return;i&&i.col||this.getColsWidth(0,this.frozenColCount-1)+r.width>this.canvas.width||(r.left<o.left?this.scrollLeft-=o.left-r.left:o.right<r.right&&(this.scrollLeft-=o.right-r.right)),i&&i.row||this.getRowsHeight(0,this.frozenRowCount-1)+r.height>this.canvas.height||(r.top<o.top?this.scrollTop-=o.top-r.top:o.bottom<r.bottom&&(this.scrollTop-=o.bottom-r.bottom))}}render(){this.scenegraph.renderSceneGraph()}renderAsync(){return this.scenegraph.updateNextFrame(),new Promise((e,t)=>{setTimeout(()=>{e()},0)})}_toRelativeRect(e,t=!0,i=!0){var r,o,s,l;const a=e.copy(),d=this.getVisibleRect();return a.offsetLeft(this.tableX-(t?d.left:0)),a.offsetTop(this.tableY-(i?d.top:0)),a.offsetLeft((o=(r=this.options.viewBox)===null||r===void 0?void 0:r.x1)!==null&&o!==void 0?o:0),a.offsetTop((l=(s=this.options.viewBox)===null||s===void 0?void 0:s.y1)!==null&&l!==void 0?l:0),a}getVisibleRect(){const{scrollTop:e,scrollLeft:t}=this,i=this.tableNoFrameWidth,r=this.tableNoFrameHeight;return new Zn(t,e,i,r)}get visibleRowCount(){const{frozenRowCount:e}=this,t=this.getVisibleRect(),i=e>0?t.top+this.getRowsHeight(0,e-1):t.top,r=this.getTargetRowAt(i);if(!r)return 0;const o=Math.max(r.top>=i?r.row:r.row+1,e);let s=this.getRowsHeight(0,o-1),l=0;const{rowCount:a}=this;for(let d=o;d<a;d++){const u=s+this.getRowHeight(d);if(t.bottom<u)break;l++,s=u}return l}getBodyVisibleCellRange(){const{scrollTop:e,scrollLeft:t}=this,i=this.getFrozenRowsHeight(),r=this.getFrozenColsWidth(),o=this.getBottomFrozenRowsHeight(),s=this.getRightFrozenColsWidth(),{row:l}=this.getRowAt(e+i+1),{col:a}=this.getColAt(t+r+1),d=this.getAllRowsHeight()>this.tableNoFrameHeight?this.getRowAt(e+this.tableNoFrameHeight-1-o).row:this.rowCount-1,u=this.getAllColsWidth()>this.tableNoFrameWidth?this.getColAt(t+this.tableNoFrameWidth-1-s).col:this.colCount-1;return u<0||d<0?null:{rowStart:l,colStart:a,rowEnd:d,colEnd:u}}getBodyVisibleRowRange(){const{scrollTop:e}=this,t=this.getFrozenRowsHeight(),i=this.getBottomFrozenRowsHeight(),{row:r}=this.getRowAt(e+t+1),o=this.getAllRowsHeight()>this.tableNoFrameHeight?this.getRowAt(e+this.tableNoFrameHeight-1-i).row:this.rowCount-1;return o<0?null:{rowStart:r,rowEnd:o}}getBodyVisibleColRange(){const{scrollLeft:e}=this,t=this.getFrozenColsWidth(),i=this.getRightFrozenColsWidth(),{col:r}=this.getColAt(e+t+1),o=this.getAllColsWidth()>this.tableNoFrameWidth?this.getColAt(e+this.tableNoFrameWidth-1-i).col:this.colCount-1;return o<0?null:{colStart:r,colEnd:o}}get visibleColCount(){const{frozenColCount:e}=this,t=this.getVisibleRect(),i=e>0?t.left+this.getColsWidth(0,e-1):t.left,r=this.getTargetColAt(i);if(!r)return 0;const o=Math.max(r.left>=i?r.col:r.col+1,e);let s=this.getColsWidth(0,o-1),l=0;const{colCount:a}=this;for(let d=o;d<a;d++){const u=s+this.getColWidth(d);if(t.right<u)break;l++,s=u}return l}get scrollTop(){return this.stateManager.scroll.verticalBarPos}set scrollTop(e){this.stateManager.setScrollTop(e)}get scrollLeft(){return this.stateManager.scroll.horizontalBarPos}set scrollLeft(e){this.stateManager.setScrollLeft(e)}getScrollLeft(){return this.scrollLeft}getScrollTop(){return this.scrollTop}setScrollLeft(e){this.scrollLeft=Math.ceil(e)}setScrollTop(e){this.scrollTop=Math.ceil(e)}getCellOverflowText(e,t){return this.scenegraph.getCellOverflowText(e,t)}addReleaseObj(e){if(!e||!e.release||typeof e.release!="function")throw new Error("not releaseObj!");(this.internalProps.releaseList=this.internalProps.releaseList||[]).push(e)}dispose(){this.release()}release(){var e,t,i,r,o,s,l,a,d,u,h,c,g,f,p,m;const b=this.internalProps;if(this.isReleased)return;(t=(e=b.tooltipHandler)===null||e===void 0?void 0:e.release)===null||t===void 0||t.call(e),(r=(i=b.menuHandler)===null||i===void 0?void 0:i.release)===null||r===void 0||r.call(i),qw.clearAll(),(o=super.release)===null||o===void 0||o.call(this),(l=(s=b.handler)===null||s===void 0?void 0:s.release)===null||l===void 0||l.call(s),this.eventManager.release(),(d=(a=b.focusControl)===null||a===void 0?void 0:a.release)===null||d===void 0||d.call(a),(u=b.legends)===null||u===void 0||u.forEach(_=>{_==null||_.release()}),(h=b.title)===null||h===void 0||h.release(),b.title=null,(c=b.emptyTip)===null||c===void 0||c.release(),b.emptyTip=null,b.layoutMap.release(),b.releaseList&&(b.releaseList.forEach(_=>{var w;return(w=_==null?void 0:_.release)===null||w===void 0?void 0:w.call(_)}),b.releaseList=null),this.scenegraph.stage.release(),this.scenegraph.proxy.release(),b.focusControl.release();const{parentElement:C}=b.element;C&&!this.options.canvas&&C.removeChild(b.element),(p=(f=(g=this.editorManager)===null||g===void 0?void 0:g.editingEditor)===null||f===void 0?void 0:f.onEnd)===null||p===void 0||p.call(f),this.isReleased=!0,this.scenegraph=null,this.internalProps=null,(m=this.reactCustomLayout)===null||m===void 0||m.clearCache()}fireListeners(e,t){return super.fireListeners(e,t)}updateOption(e){var t,i,r,o,s,l,a,d,u,h,c,g,f,p,m,b,C,_;this.options=e,this._hasAutoImageColumn=void 0;const{frozenColCount:w=0,unfreezeAllOnExceedsMaxWidth:y,defaultRowHeight:v=40,defaultHeaderRowHeight:x,defaultColWidth:S=80,defaultHeaderColWidth:R=80,keyboardOptions:B,eventOptions:A,rowSeriesNumber:M,columnResizeMode:H,rowResizeMode:E="none",resize:T,dragHeaderMode:P,dragOrder:k,showFrozenIcon:L,allowFrozenColCount:F,padding:z,hover:I,menu:N,select:W,pixelRatio:D,widthMode:G,heightMode:V,autoFillWidth:X,autoFillHeight:$,widthAdaptiveMode:Q,heightAdaptiveMode:te,customRender:le,renderChartAsync:fe,renderChartAsyncBatchCount:ne,canvasWidth:ie,canvasHeight:ce,overscrollBehavior:ae,limitMinWidth:q,limitMinHeight:_e}=e;D&&D!==this.internalProps.pixelRatio&&(this.internalProps.pixelRatio=D),z&&(typeof z=="number"?(this.padding.top=z,this.padding.left=z,this.padding.bottom=z,this.padding.right=z):(z.top&&(this.padding.top=z.top),z.bottom&&(this.padding.bottom=z.bottom),z.left&&(this.padding.left=z.left),z.right&&(this.padding.right=z.right))),this.showFrozenIcon=typeof L!="boolean"||L,typeof F=="number"&&F<=0&&(this.showFrozenIcon=!1),this.widthMode=G??"standard",this.heightMode=V??"standard",this._widthAdaptiveMode=Q??"only-body",this._heightAdaptiveMode=te??"only-body",this.autoFillWidth=X!=null&&X,this.autoFillHeight=$!=null&&$,this.customRender=le,this.canvasWidth=J(ie)?ie:void 0,this.canvasHeight=J(ce)?ce:void 0;const oe=this.internalProps;if(Me.mode==="node"||e.canvas||IH(oe.element,this.padding),this.columnWidthComputeMode=(t=e.columnWidthComputeMode)!==null&&t!==void 0?t:"normal",oe.frozenColCount=w,oe.unfreezeAllOnExceedsMaxWidth=y==null||y,oe.defaultRowHeight=v,oe.defaultHeaderRowHeight=x??v,oe.defaultColWidth=S,oe.defaultHeaderColWidth=R??S,oe.keyboardOptions=B,oe.eventOptions=A,oe.rowSeriesNumber=M,oe.columnResizeMode=(i=T==null?void 0:T.columnResizeMode)!==null&&i!==void 0?i:H,oe.rowResizeMode=(r=T==null?void 0:T.rowResizeMode)!==null&&r!==void 0?r:E,oe.dragHeaderMode=(s=(o=k==null?void 0:k.dragHeaderMode)!==null&&o!==void 0?o:P)!==null&&s!==void 0?s:"none",oe.renderChartAsync=fe,nC(ne),oe.overscrollBehavior=ae??"auto",oe.cellTextOverflows={},oe._rowHeightsMap=new YC(this),oe._rowRangeHeightsMap=new Map,oe._colRangeWidthsMap=new Map,oe._widthResizedColMap=new Set,oe._heightResizedRowMap=new Set,this.colWidthsMap=new Ki,this.colContentWidthsMap=new Ki,this.colWidthsLimit={},oe.stick.changedCells.clear(),oe.theme=Fi.of((l=e.theme)!==null&&l!==void 0?l:Fi.DEFAULT),oe.theme.isPivot=this.isPivotTable(),Gl(oe.theme.functionalIconsStyle),this.scenegraph.updateStageBackground(),oe.autoWrapText=e.autoWrapText,oe.enableLineBreak=e.enableLineBreak,oe.allowFrozenColCount=(a=e.allowFrozenColCount)!==null&&a!==void 0?a:0,oe.limitMaxAutoWidth=(d=e.limitMaxAutoWidth)!==null&&d!==void 0?d:450,oe.limitMinWidth=q!=null?typeof q=="number"?q:q?10:0:10,oe.limitMinHeight=_e!=null?typeof _e=="number"?_e:_e?10:0:10,(u=oe.legends)===null||u===void 0||u.forEach(Y=>{Y==null||Y.release()}),(h=oe.title)===null||h===void 0||h.release(),oe.title=null,(c=oe.emptyTip)===null||c===void 0||c.release(),oe.emptyTip=null,oe.layoutMap.release(),this.scenegraph.clearCells(),this.scenegraph.updateComponent(),this.stateManager.updateOptionSetState(),this._updateSize(),this.eventManager.updateEventBinder(),e.legends){oe.legends=[];const Y=ue.getFunction("createLegend");if(Array.isArray(e.legends)){for(let de=0;de<e.legends.length;de++)oe.legends.push(Y(e.legends[de],this));this.scenegraph.tableGroup.setAttributes({x:this.tableX,y:this.tableY})}else oe.legends.push(Y(e.legends,this)),this.scenegraph.tableGroup.setAttributes({x:this.tableX,y:this.tableY})}if(oe.tooltip=Object.assign({parentElement:this.getElement(),renderMode:"html",isShowOverflowTextTooltip:!1,confine:!0,position:sn.bottom},e.tooltip),oe.tooltip.renderMode==="html"&&!oe.tooltipHandler){const Y=ue.getComponent("tooltipHandler");oe.tooltipHandler=new Y(this,oe.tooltip.confine)}if(oe.menu=Object.assign({renderMode:"html"},e.menu),Array.isArray((g=e.menu)===null||g===void 0?void 0:g.dropDownMenuHighlight)&&this.setDropDownMenuHighlight((f=e.menu)===null||f===void 0?void 0:f.dropDownMenuHighlight),(Array.isArray((p=e.menu)===null||p===void 0?void 0:p.defaultHeaderMenuItems)||typeof((m=e.menu)===null||m===void 0?void 0:m.defaultHeaderMenuItems)=="function")&&(this.globalDropDownMenu=e.menu.defaultHeaderMenuItems),oe.menu.renderMode==="html"&&!oe.menuHandler){const Y=ue.getComponent("menuHandler");oe.menuHandler=new Y(this)}this.clearCellStyleCache(),this.clearColWidthCache(),this.clearRowHeightCache(),oe.customMergeCell=s_(e.customMergeCell),(b=this.customCellStylePlugin)===null||b===void 0||b.updateCustomCell((C=e.customCellStyle)!==null&&C!==void 0?C:[],(_=e.customCellStyleArrangement)!==null&&_!==void 0?_:[]),this._adjustCanvasSizeByOption()}renderWithRecreateCells(){this.internalProps.stick.changedCells.clear();const e={col:this.stateManager.hover.cellPos.col,row:this.stateManager.hover.cellPos.row};this.refreshHeader(),this.internalProps.useOneRowHeightFillAll=!1,this.scenegraph.clearCells(),this.clearCellStyleCache(),this.scenegraph.createSceneGraph(),this.stateManager.updateHoverPos(e.col,e.row),this.render()}getFrozenRowsHeight(){return this.getRowsHeight(0,this.frozenRowCount-1)}getFrozenColsWidth(){return this.getColsWidth(0,this.frozenColCount-1)}getBottomFrozenRowsHeight(){if(this.bottomFrozenRowCount>0){let e=0;for(let t=this.rowCount-this.bottomFrozenRowCount;t<=this.rowCount-1;t++)e+=this.getRowHeight(t);return e}return 0}getRightFrozenColsWidth(){if(this.rightFrozenColCount>0){let e=0;for(let t=this.colCount-this.rightFrozenColCount;t<=this.colCount-1;t++)e+=this.getColWidth(t);return e}return 0}getDrawRange(){const e=Math.min(this.tableNoFrameWidth,this.getAllColsWidth()),t=Math.min(this.tableNoFrameHeight,this.getAllRowsHeight());return new Zn(this.tableX,this.tableY,e,t)}_getMouseAbstractPoint(e,t=!0){var i,r,o,s;let l;if(!e)return{inTable:!1,x:void 0,y:void 0};l=pz(e)?e.changedTouches[0]:e;const a=l.clientX||l.pageX+window.scrollX,d=l.clientY||l.pageY+window.scrollY,u=this.internalProps.canvas.getBoundingClientRect();let h=!0;u.right<=a&&(h=!1),u.bottom<=d&&(h=!1);const c=u.width,g=c/(this.canvas.offsetWidth||c),f=u.height,p=f/(this.canvas.offsetHeight||f),m={x:(a-u.left)/g+(t?this.scrollLeft:0)-((r=(i=this.options.viewBox)===null||i===void 0?void 0:i.x1)!==null&&r!==void 0?r:0),y:(d-u.top)/p+(t?this.scrollTop:0)-((s=(o=this.options.viewBox)===null||o===void 0?void 0:o.y1)!==null&&s!==void 0?s:0),inTable:h};return this.internalProps.modifiedViewBoxTransform&&this.scenegraph.stage.window.getViewBoxTransform()&&this.scenegraph.stage.window.getViewBoxTransform().transformPoint(m,m),m}getTheme(){return this.internalProps.theme}getTargetColAt(e){return ig(e,this)}getTargetRowAt(e){const t=rg(e,this);return t&&(t.row=Math.min(t.row,this.rowCount-1)),t}getTargetColAtConsiderRightFrozen(e,t){return Oy(e,t,this)}getTargetRowAtConsiderBottomFrozen(e,t){return Dy(e,t,this)}clearSelected(){this.stateManager.updateSelectPos(-1,-1)}selectCell(e,t,i,r,o,s=!1){var l,a,d;const u=!!(!((l=this.stateManager.select.ranges)===null||l===void 0)&&l.length);this.stateManager.updateSelectPos(e,t,i,r,!1,(d=o??((a=this.options.select)===null||a===void 0?void 0:a.makeSelectCellVisible))===null||d===void 0||d,s),this.stateManager.endSelectCells(!0,u)}selectCells(e){const{scrollLeft:t,scrollTop:i}=this;e.forEach((r,o)=>{var s,l,a,d,u,h;r.start.col===r.end.col&&r.start.row===r.end.row?this.stateManager.updateSelectPos(r.start.col,r.start.row,!1,o>=1,!1,(l=(s=this.options.select)===null||s===void 0?void 0:s.makeSelectCellVisible)===null||l===void 0||l,!0):(this.stateManager.updateSelectPos(r.start.col,r.start.row,!1,o>=1,!1,(d=(a=this.options.select)===null||a===void 0?void 0:a.makeSelectCellVisible)===null||d===void 0||d,!0),this.stateManager.updateInteractionState(me.grabing),this.stateManager.updateSelectPos(r.end.col,r.end.row,!1,o>=1,!1,(h=(u=this.options.select)===null||u===void 0?void 0:u.makeSelectCellVisible)===null||h===void 0||h,!0)),this.stateManager.endSelectCells(!1,!1),this.stateManager.updateInteractionState(me.default)}),this.setScrollTop(i),this.setScrollLeft(t)}get recordsCount(){var e;return(e=this.records)===null||e===void 0?void 0:e.length}get allowFrozenColCount(){return this.internalProps.allowFrozenColCount}get rowHeaderLevelCount(){return this.internalProps.layoutMap.rowHeaderLevelCount}get columnHeaderLevelCount(){return this.internalProps.layoutMap.columnHeaderLevelCount}get records(){return this.internalProps.records}get dataSource(){return this.internalProps.dataSource}set dataSource(e){this.scenegraph.clearCells(),OH(this,e),this.refreshRowColCount(),this.scenegraph.createSceneGraph(),this.render()}get autoWrapText(){return this.internalProps.autoWrapText}set autoWrapText(e){this.internalProps.autoWrapText=e,this.options.autoWrapText=e}get enableLineBreak(){return this.internalProps.enableLineBreak}set enableLineBreak(e){this.internalProps.enableLineBreak=e,this.options.enableLineBreak=e}updateAutoWrapText(e){this.internalProps.autoWrapText!==e&&(this.internalProps.autoWrapText=e,this.options.autoWrapText=e,this.scenegraph.clearCells(),this.clearCellStyleCache(),this.scenegraph.createSceneGraph(),this.render())}get theme(){return this.internalProps.theme}set theme(e){this.internalProps.theme=Fi.of(e??Fi.DEFAULT),this.internalProps.theme.isPivot=this.isPivotTable(),this.options.theme=e,Gl(this.internalProps.theme.functionalIconsStyle)}updateTheme(e){const t={col:this.stateManager.hover.cellPos.col,row:this.stateManager.hover.cellPos.row};this.internalProps.theme=Fi.of(e??Fi.DEFAULT),this.internalProps.theme.isPivot=this.isPivotTable(),Gl(this.internalProps.theme.functionalIconsStyle),this.options.theme=e,this.scenegraph.updateComponent(),this.scenegraph.updateStageBackground(),this.scenegraph.clearCells(),this.clearCellStyleCache(),this.scenegraph.createSceneGraph(),this.stateManager.updateHoverPos(t.col,t.row),this.render()}getBodyField(e,t){return this.internalProps.layoutMap.getBody(e,t).field}getBodyColumnDefine(e,t){const i=this.internalProps.layoutMap.getBody(e,t);return i==null?void 0:i.define}getBodyColumnType(e,t){var i,r;const o=(r=(i=this.internalProps.layoutMap.getBody(e,t))===null||i===void 0?void 0:i.cellType)!==null&&r!==void 0?r:"text";return Z("cellType",{cellType:o},e,t,this)}getCellType(e,t){let i;return this.isSeriesNumberInHeader(e,t)?this.internalProps.layoutMap.getSeriesNumberHeader(e,t).cellType:(i=this.isHeader(e,t)?this.internalProps.layoutMap.getHeader(e,t).headerType:this.internalProps.layoutMap.getBody(e,t).cellType,Z("cellType",{cellType:i},e,t,this))}getHeaderField(e,t){return this.internalProps.layoutMap.getHeaderField(e,t)}getHeaderDefine(e,t){const i=this.internalProps.layoutMap.getHeader(e,t);return i==null?void 0:i.define}getCellLocation(e,t){return this.internalProps.layoutMap.getCellLocation(e,t)}getCellHeaderPaths(e,t){return this.internalProps.layoutMap.getCellHeaderPaths(e,t)}getHeadersDefine(e,t){const i=[];for(;;){const r=this.getHeaderDefine(e,t);if(!r||!r.field&&!r.columns)break;i.push(r),t++}return i}_getHeaderLayoutMap(e,t){return this.internalProps.layoutMap.getHeader(e,t)}_getBodyLayoutMap(e,t){return this.internalProps.layoutMap.getBody(e,t)}getContext(){return this.internalProps.context}getRecordByCell(e,t){if(!this.internalProps.layoutMap.isHeader(e,t))return this.getCellOriginRecord(e,t)}getRecordByRowCol(e,t){return this.getRecordByCell(e,t)}getRecordStartRowByRecordIndex(e){return this.internalProps.layoutMap.getRecordStartRowByRecordIndex(e)}_getHeaderCellBySortState(e){const{layoutMap:t}=this.internalProps,i=t.headerObjects.find(r=>r&&r.field===e.field);if(i)return t.getHeaderCellAdressById(i.id)}getCellRange(e,t){var i;if(this.internalProps.customMergeCell){const r=this.internalProps.customMergeCell(e,t,this);if(r&&r.range&&(O(r.text)||r.customLayout||r.customRender))return r.range}return(i=this.internalProps.layoutMap)===null||i===void 0?void 0:i.getCellRange(e,t)}hasCustomMerge(){return!!this.internalProps.customMergeCell}getCustomMerge(e,t){if(this.internalProps.customMergeCell){const i=this.internalProps.customMergeCell(e,t,this);if(i&&i.range&&(O(i.text)||i.customLayout||this.customRender)){if(i.style){const r=this.internalProps.bodyHelper.getStyleClass("text"),o=i.style,s=Xf(o,this.theme.bodyStyle,{col:e,row:t,table:this,value:i.text,dataValue:this.getCellOriginValue(e,t),cellHeaderPaths:this.getCellHeaderPaths(e,t)},r,this.options.autoWrapText,this.theme);i.style=s}return i}}}isCellRangeEqual(e,t,i,r){return this.internalProps.layoutMap.isCellRangeEqual(e,t,i,r)}_getLayoutCellId(e,t){return this.internalProps.layoutMap.getCellId(e,t)}getHeaderDescription(e,t){var i;const r=this._getHeaderLayoutMap(e,t),o=r==null?void 0:r.define,s=(i=o==null?void 0:o.description)!==null&&i!==void 0?i:r==null?void 0:r.description;return typeof s=="function"?s({col:e,row:t,value:this.getCellValue(e,t),dataValue:this.getCellOriginValue(e,t)}):s}setDropDownMenuHighlight(e){this.stateManager.setDropDownMenuHighlight(e)}_dropDownMenuIsHighlight(e,t,i){return this.stateManager.dropDownMenuIsHighlight(e,t,i)}isSeriesNumberInBody(e,t){return this.internalProps.layoutMap&&this.internalProps.layoutMap.isSeriesNumberInBody(e,t)}isSeriesNumberInHeader(e,t){return this.internalProps.layoutMap&&this.internalProps.layoutMap.isSeriesNumberInHeader(e,t)}isHeader(e,t){return this.internalProps.layoutMap&&this.internalProps.layoutMap.isHeader(e,t)}isColumnHeader(e,t){var i;return(i=this.internalProps.layoutMap)===null||i===void 0?void 0:i.isColumnHeader(e,t)}isRowHeader(e,t){var i;return(i=this.internalProps.layoutMap)===null||i===void 0?void 0:i.isRowHeader(e,t)}isCornerHeader(e,t){var i;return(i=this.internalProps.layoutMap)===null||i===void 0?void 0:i.isCornerHeader(e,t)}isFrozenColumn(e,t){return this.isLeftFrozenColumn(e,t)||this.isRightFrozenColumn(e,t)}isLeftFrozenColumn(e,t){var i;return(i=this.internalProps.layoutMap)===null||i===void 0?void 0:i.isFrozenColumn(e,t)}isRightFrozenColumn(e,t){var i;return(i=this.internalProps.layoutMap)===null||i===void 0?void 0:i.isRightFrozenColumn(e,t)}isFrozenRow(e,t){return this.isTopFrozenRow(e,t)||this.isBottomFrozenRow(e,t)}isTopFrozenRow(e,t){var i;return(i=this.internalProps.layoutMap)===null||i===void 0?void 0:i.isFrozenRow(e,t)}isBottomFrozenRow(e,t){var i;return(i=this.internalProps.layoutMap)===null||i===void 0?void 0:i.isBottomFrozenRow(e,t)}getCellInfo(e,t){if(e>=0&&t>=0){const i=this.isHeader(e,t)?this.getHeaderDefine(e,t):this.getBodyColumnDefine(e,t);return{col:e,row:t,field:this.getHeaderField(e,t),cellHeaderPaths:this.internalProps.layoutMap.getCellHeaderPaths(e,t),title:i==null?void 0:i.title,cellType:this.getCellType(e,t),originData:this.getCellOriginRecord(e,t),cellRange:this.getCellRangeRelativeRect({col:e,row:t}),value:this.getCellValue(e,t),dataValue:this.getCellOriginValue(e,t),cellLocation:this.getCellLocation(e,t),scaleRatio:this.canvas.getBoundingClientRect().width/this.canvas.offsetWidth}}}_hasField(e,t,i){var r;if(e===null||this.internalProps.layoutMap.isHeader(t,i))return!1;const o=this.getRecordShowIndexByCell(t,i);return(r=this.internalProps.dataSource)===null||r===void 0?void 0:r.hasField(o,e)}_getCellStyle(e,t){return cz(e,t,this)}clearCellStyleCache(){this.headerStyleCache.clear(),this.bodyStyleCache.clear(),this.bodyMergeTitleCache.clear(),this.bodyBottomStyleCache.clear()}clearRowHeightCache(){this.internalProps._rowHeightsMap.clear(),this._clearRowRangeHeightsMap()}clearColWidthCache(){this.internalProps._colWidthsMap.clear(),this._clearColRangeWidthsMap()}_canResizeColumn(e,t){if(!(e>=0&&t>=0)||this.isCellRangeEqual(e,t,e+1,t)||this.internalProps.columnResizeMode==="none")return!1;if(this.internalProps.columnResizeMode==="header"){if(!this.isHeader(e,t))return!1}else if(this.internalProps.columnResizeMode==="body"&&this.isHeader(e,t))return!1;const i=this.colWidthsLimit[e];return!(i&&i.min&&i.max)||i.max!==i.min}_canResizeRow(e,t){if(!(e>=0&&t>=0)||this.isCellRangeEqual(e,t,e,t+1)||this.internalProps.rowResizeMode==="none")return!1;if(this.internalProps.rowResizeMode==="header"){if(!this.isHeader(e,t))return!1}else if(this.internalProps.rowResizeMode==="body"&&this.isHeader(e,t))return!1;return!0}_canDragHeaderPosition(e,t){var i;if(this.isHeader(e,t)&&(this.stateManager.isSelected(e,t)||((i=this.options.select)===null||i===void 0?void 0:i.headerSelectMode)==="body"&&pL(e,t,[this.getCellRange(this.stateManager.select.cellPos.col,this.stateManager.select.cellPos.row)])||Yi(this,e,t))){if(this.internalProps.frozenColDragHeaderMode==="disabled"&&this.isFrozenColumn(e))return!1;if(this.stateManager.isSelected(e,t)){const o=this.stateManager.select.ranges[0];if(this.isColumnHeader(e,t)){if(o.end.row!==this.rowCount-1)return!1}else if(!this.isRowHeader(e,t)||o.end.col!==this.colCount-1)return!1}const r=this.getHeaderDefine(e,t);if(!r)return!1;if(r.dragHeader===void 0){if(this.internalProps.dragHeaderMode==="all")return!0;if(this.internalProps.dragHeaderMode==="column"){if(this.isColumnHeader(e,t))return!0}else if(this.internalProps.dragHeaderMode==="row"&&this.isRowHeader(e,t))return!0;return!1}return r.dragHeader}return!1}getCellIcons(e,t){var i,r,o;let s;if(this.isHeader(e,t))s=this.internalProps.headerHelper.getIcons(e,t);else if(this.internalProps.layoutMap.isSeriesNumber(e,t)){(!this.options.groupBy||!(!((i=this.getCellRawRecord(e,t))===null||i===void 0)&&i.vtableMerge))&&!((o=(r=this.internalProps.layoutMap.getSeriesNumberBody(e,t))===null||r===void 0?void 0:r.define)===null||o===void 0)&&o.dragOrder&&(s=this.internalProps.rowSeriesNumberHelper.getIcons(e,t));const l=this.getCellValue(e,t),a=this.getCellOriginValue(e,t),d=this.internalProps.context,u=this.internalProps.bodyHelper.getIcons(e,t,l,a,d);(s==null?void 0:s.length)>0?s=s.concat(u):(u==null?void 0:u.length)>0&&(s=u)}else{const l=this.getCellValue(e,t),a=this.getCellOriginValue(e,t),d=this.internalProps.context;s=this.internalProps.bodyHelper.getIcons(e,t,l,a,d)}return s}showDropDownMenu(e,t,i){let r="dropdown-menu";i&&(r=Array.isArray(i.content)?"dropdown-menu":"container"),this.internalProps.menu.renderMode==="html"&&(this.stateManager.menu.isShow=!0,this.internalProps.menuHandler._bindToCell(e,t,r,i))}showTooltip(e,t,i){this.internalProps.tooltip.renderMode==="html"&&this.internalProps.tooltipHandler._bindToCell(e,t,i)}getCellStyle(e,t){const i=this._getCellStyle(e,t),r=ir(i,this,e,t,Z).theme,{autoWrapText:o,lineClamp:s,textOverflow:l}=i;return{textAlign:r.text.textAlign,textBaseline:r.text.textBaseline,bgColor:kt(r.group.fill)?Z("bgColor",i,e,t,this):r.group.fill,color:kt(r.text.fill)?Z("color",i,e,t,this):r.text.fill,strokeColor:kt(r.text.stroke)?Z("strokeColor",i,e,t,this):r.text.stroke,fontFamily:r.text.fontFamily,fontSize:r.text.fontSize,fontWeight:r.text.fontWeight,fontVariant:r.text.fontVariant,fontStyle:r.text.fontStyle,lineHeight:r.text.lineHeight,autoWrapText:o!=null&&o,lineClamp:s??"auto",textOverflow:l,borderColor:kt(r.group.stroke)?Z("borderColor",i,e,t,this):r.group.stroke,borderLineWidth:r.group.lineWidth,borderLineDash:r.group.lineDash,underline:!!r.text.underline,underlineDash:r.text.underlineDash,underlineOffset:r.text.underlineOffset,lineThrough:!!r.text.lineThrough,padding:r._vtable.padding,underlineWidth:r.text.underline,lineThroughLineWidth:r.text.lineThrough,_strokeArrayWidth:r.group.strokeArrayWidth,_strokeArrayColor:r.group.strokeArrayColor,_linkColor:Z("linkColor",i,e,t,this)}}getAllBodyCells(e,t){const i=this.rowHeaderLevelCount,r=this.columnHeaderLevelCount,o=this.colCount-1,s=this.rowCount-1;return Array(Math.min(t??2e3,s-r+1,this.rowCount)).fill(0).map((l,a)=>Array(Math.min(e??2e3,o-i+1,this.colCount)).fill(0).map((d,u)=>this.getCellInfo(u+i,a+r)))}getAllCells(e,t){const o=this.colCount-1,s=this.rowCount-1;return Array(Math.min(t??2e3,s-0+1,this.rowCount)).fill(0).map((l,a)=>Array(Math.min(e??2e3,o-0+1,this.colCount)).fill(0).map((d,u)=>this.getCellInfo(u+0,a+0)))}getAllColumnHeaderCells(){const e=this.rowHeaderLevelCount,t=0,i=this.colCount-1,r=this.columnHeaderLevelCount-1;return Array(r-t+1).fill(0).map((o,s)=>Array(i-e+1).fill(0).map((l,a)=>this.getCellInfo(a+e,s+t)))}getAllRowHeaderCells(){const t=this.columnHeaderLevelCount,i=this.rowHeaderLevelCount-1,r=this.rowCount-1;return Array(r-t+1).fill(0).map((o,s)=>Array(i-0+1).fill(0).map((l,a)=>this.getCellInfo(a+0,s+t)))}getCopyValue(){var e,t,i;if(((t=(e=this.stateManager.select)===null||e===void 0?void 0:e.ranges)===null||t===void 0?void 0:t.length)>0){const r=this.stateManager.select.ranges;let o=Math.min(r[0].start.col,r[0].end.col),s=Math.max(r[0].start.col,r[0].end.col),l=Math.min(r[0].start.row,r[0].end.row),a=Math.max(r[0].start.row,r[0].end.row);r.forEach(f=>{o=Math.min(o,f.start.col,f.end.col),s=Math.max(s,f.start.col,f.end.col),l=Math.min(l,f.start.row,f.end.row),a=Math.max(a,f.start.row,f.end.row)});const d=f=>{let p=!1;return r.forEach(m=>{const b=Math.min(m.start.row,m.end.row),C=Math.max(m.start.row,m.end.row);b<=f&&C>=f&&(p=!0)}),p},u=f=>{let p=!1;return r.forEach(m=>{const b=Math.min(m.start.col,m.end.col),C=Math.max(m.start.col,m.end.col);b<=f&&C>=f&&(p=!0)}),p},h=(f,p)=>{let m;return r.forEach(b=>{const C=Math.min(b.start.row,b.end.row),_=Math.max(b.start.row,b.end.row),w=Math.min(b.start.col,b.end.col),y=Math.max(b.start.col,b.end.col);w<=f&&y>=f&&C<=p&&_>=p&&(m=b)}),m},c=(f,p,m)=>{const b=this.getCellRange(f,p);let C=b.start.col,_=b.start.row;if(m){const w=Math.min(m.start.col,m.end.col),y=Math.min(m.start.row,m.end.row);C=Math.max(w,b.start.col),_=Math.max(y,b.start.row)}return C!==f||_!==p?"":this.getCellValue(f,p)};let g="";for(let f=l;f<=a;f++)if(d(f)){for(let p=o;p<=s;p++)if(u(p)){const m=h(p,f);if(m){const b=c(p,f,m);if(!(typeof Promise<"u"&&b instanceof Promise)){const C=O(b)?`${b}`:"";/^\[object .*\]$/.exec(C)||(g+=C)}(p<m.end.col||p<s)&&(g+="	")}else g+="	"}f<a&&(g+=`\r
`)}return!((i=this.options)===null||i===void 0)&&i.formatCopyValue&&(g=this.options.formatCopyValue(g)),g}return""}getSelectedCellInfos(){var e;if(!(!((e=this.stateManager.select)===null||e===void 0)&&e.ranges))return null;const t=this.stateManager.select.ranges;if(!t.length)return[];let i=Math.min(t[0].start.col,t[0].end.col),r=Math.max(t[0].start.col,t[0].end.col),o=Math.min(t[0].start.row,t[0].end.row),s=Math.max(t[0].start.row,t[0].end.row);t.forEach(h=>{i=Math.min(i,h.start.col,h.end.col),r=Math.max(r,h.start.col,h.end.col),o=Math.min(o,h.start.row,h.end.row),s=Math.max(s,h.start.row,h.end.row)});const l=h=>{let c=!1;return t.forEach(g=>{const f=Math.min(g.start.row,g.end.row),p=Math.max(g.start.row,g.end.row);f<=h&&p>=h&&(c=!0)}),c},a=h=>{let c=!1;return t.forEach(g=>{const f=Math.min(g.start.col,g.end.col),p=Math.max(g.start.col,g.end.col);f<=h&&p>=h&&(c=!0)}),c},d=(h,c)=>{let g;return t.forEach(f=>{const p=Math.min(f.start.row,f.end.row),m=Math.max(f.start.row,f.end.row),b=Math.min(f.start.col,f.end.col),C=Math.max(f.start.col,f.end.col);b<=h&&C>=h&&p<=c&&m>=c&&(g=f)}),g},u=[];for(let h=o;h<=s;h++)if(l(h)){const c=[];for(let g=i;g<=r;g++)if(a(g)&&d(g,h)){const f=this.getCellInfo(g,h);c.push(f)}u.push(c)}return u}getSelectedCellRanges(){const e=this.stateManager.select.ranges;return e.length?Or(e):[]}measureText(e,t){return dy.measureText(e,t)}measureTextBounds(e){return uy(e)}getCustomRender(e,t){let i;if(this.getCellLocation(e,t)!=="body"){const r=this.getHeaderDefine(e,t);i=r==null?void 0:r.headerCustomRender}else{const r=this.getBodyColumnDefine(e,t);i=(r==null?void 0:r.customRender)||this.customRender}return i}getCustomLayout(e,t){let i;if(this.getCellLocation(e,t)!=="body"){const r=this.getHeaderDefine(e,t);i=r==null?void 0:r.headerCustomLayout}else{const r=this.getBodyColumnDefine(e,t);i=r==null?void 0:r.customLayout}return i}hasAutoImageColumn(){return this._hasAutoImageColumn===void 0&&(this._hasAutoImageColumn=ZF(this)),this._hasAutoImageColumn}_getActiveChartInstance(){var e,t,i,r,o,s;const l=this.scenegraph.getCell((t=(e=this.stateManager.hover)===null||e===void 0?void 0:e.cellPos)===null||t===void 0?void 0:t.col,(r=(i=this.stateManager.hover)===null||i===void 0?void 0:i.cellPos)===null||r===void 0?void 0:r.row);return((s=(o=l==null?void 0:l.getChildren())===null||o===void 0?void 0:o[0])===null||s===void 0?void 0:s.type)==="chart"?l.getChildren()[0].activeChartInstance:null}cellIsInVisualView(e,t){var i,r,o,s;const l=this.getDrawRange(),a=this.getCellRelativeRect(e,t);if(e<this.frozenColCount&&t<this.frozenRowCount)return!0;let d,u,h,c;return this.frozenRowCount>=1&&(d=this.getCellRangeRelativeRect({start:{col:0,row:0},end:{col:this.colCount-1,row:this.frozenRowCount-1}})),this.frozenColCount>=1&&(u=this.getCellRangeRelativeRect({start:{col:0,row:0},end:{col:this.frozenColCount-1,row:this.rowCount-1}})),this.bottomFrozenRowCount>=1&&(h=this.getCellRangeRelativeRect({start:{col:0,row:this.rowCount-this.bottomFrozenRowCount},end:{col:this.colCount-1,row:this.rowCount-1}})),this.rightFrozenColCount>=1&&(c=this.getCellRangeRelativeRect({start:{col:this.colCount-this.rightFrozenColCount,row:0},end:{col:this.colCount-1,row:this.rowCount-1}})),!!(a.top>=l.top&&a.bottom<=l.bottom&&a.left>=l.left&&a.right<=l.right&&(this.isFrozenCell(e,t)||a.top>=((i=d==null?void 0:d.bottom)!==null&&i!==void 0?i:a.top)&&a.left>=((r=u==null?void 0:u.right)!==null&&r!==void 0?r:a.left)&&a.bottom<=((o=h==null?void 0:h.top)!==null&&o!==void 0?o:a.bottom)&&a.right<=((s=c==null?void 0:c.left)!==null&&s!==void 0?s:a.right)))}getCustomMergeValue(e,t){if(this.internalProps.customMergeCell){const i=this.getCustomMerge(e,t);if(i){const{text:r}=i;return r}}}exportImg(){return this.scenegraph.stage.toCanvas().toDataURL()}exportCellImg(e,t,i){var r,o,s,l;const a=this.cellIsInVisualView(e,t),{scrollTop:d,scrollLeft:u}=this;a||this.scrollToCell({col:e,row:t});const h=this.getCellRelativeRect(e,t);((o=(r=this.stateManager.select)===null||r===void 0?void 0:r.ranges)===null||o===void 0?void 0:o.length)>0&&CC(this.scenegraph);const{col:c,row:g}=this.stateManager.hover.cellPos;let f,p;if(this.stateManager.updateHoverPos(-1,-1),this.scenegraph.component.hideVerticalScrollBar(),this.scenegraph.component.hideHorizontalScrollBar(),this.scenegraph.tableGroup.border.setAttribute("visible",!1),i==null?void 0:i.disableBackground){const C=this.scenegraph.getCell(e,t);f=C.attribute.fill,C.setAttribute("fill","transparent")}if(i!=null&&i.disableBorder){const C=this.scenegraph.getCell(e,t);p=C.attribute.stroke,C.setAttribute("stroke",!1)}this.scenegraph.renderSceneGraph();let m=0;this.theme.cellBorderClipDirection==="bottom-right"&&(m=1);const b=this.scenegraph.stage.toCanvas(!1,new Ue().set(h.left+this.tableX+1,h.top+this.tableY+1,h.right+this.tableX-m,h.bottom+this.tableY-m));return a||(this.setScrollTop(d),this.setScrollLeft(u)),this.scenegraph.tableGroup.border.setAttribute("visible",!0),f&&this.scenegraph.getCell(e,t).setAttribute("fill",f),p&&this.scenegraph.getCell(e,t).setAttribute("stroke",p),((l=(s=this.stateManager.select)===null||s===void 0?void 0:s.ranges)===null||l===void 0?void 0:l.length)>0&&_C(this.scenegraph),this.stateManager.updateHoverPos(c,g),this.scenegraph.updateNextFrame(),b.toDataURL()}exportCellRangeImg(e){var t,i,r,o;const{scrollTop:s,scrollLeft:l}=this,a=Math.min(e.start.col,e.end.col),d=Math.min(e.start.row,e.end.row),u=Math.max(e.start.col,e.end.col),h=Math.max(e.start.row,e.end.row),c=this.cellIsInVisualView(a,d),g=this.cellIsInVisualView(u,h);c&&g||this.scrollToCell({col:a,row:d});const f=this.getCellRangeRelativeRect({start:{col:a,row:d},end:{col:u,row:h}});((i=(t=this.stateManager.select)===null||t===void 0?void 0:t.ranges)===null||i===void 0?void 0:i.length)>0&&CC(this.scenegraph);const{col:p,row:m}=this.stateManager.hover.cellPos;this.stateManager.updateHoverPos(-1,-1),this.scenegraph.component.hideVerticalScrollBar(),this.scenegraph.component.hideHorizontalScrollBar(),this.scenegraph.renderSceneGraph();const b=this.scenegraph.stage.toCanvas(!1,new Ue().set(f.left+this.tableX+1,f.top+this.tableY+1,f.right+this.tableX,f.bottom+this.tableY)).toDataURL();return c&&g||(this.setScrollTop(s),this.setScrollLeft(l)),((o=(r=this.stateManager.select)===null||r===void 0?void 0:r.ranges)===null||o===void 0?void 0:o.length)>0&&_C(this.scenegraph),this.stateManager.updateHoverPos(p,m),b}exportCanvas(){return this.scenegraph.stage.toCanvas()}getImageBuffer(e="image/png"){if(this.options.mode!=="node")return;this.render();const t=this.scenegraph.stage;if(t){const i=this.tableX+this.getAllColsWidth(),r=this.tableY+this.getAllRowsHeight();return i>=this.canvasWidth&&r>=this.canvasHeight?(t.render(),t.window.getImageBuffer(e)):this.scenegraph.stage.toCanvas(!1,new Ue().set(0,0,Math.min(this.canvasWidth,i),Math.min(this.canvasHeight,r))).toBuffer(e)}return null}getBodyIndexByTableIndex(e,t){return{col:e-this.rowHeaderLevelCount-this.leftRowSeriesNumberCount,row:t-this.columnHeaderLevelCount}}getTableIndexByBodyIndex(e,t){return{col:e+this.rowHeaderLevelCount+this.leftRowSeriesNumberCount,row:t+this.columnHeaderLevelCount}}onVChartEvent(e,t,i){this._chartEventMap[e]||(this._chartEventMap[e]=[]),typeof t=="function"?this._chartEventMap[e].push({callback:t}):this._chartEventMap[e].push({callback:i,query:t})}offVChartEvent(e,t){this._chartEventMap[e]&&(this._chartEventMap[e]=t?this._chartEventMap[e].filter(i=>i.callback!==t):[])}_bindChartEvent(e){if(e)for(const t in this._chartEventMap)(this._chartEventMap[t]||[]).forEach(i=>{i.query?e.on(t,i.query,i.callback):e.on(t,i.callback)})}changeRecordOrder(e,t){}hasCustomCellStyle(e){var t;return(t=this.customCellStylePlugin)===null||t===void 0?void 0:t.hasCustomCellStyle(e)}registerCustomCellStyle(e,t){var i;(i=this.customCellStylePlugin)===null||i===void 0||i.registerCustomCellStyle(e,t)}arrangeCustomCellStyle(e,t,i){var r;(r=this.customCellStylePlugin)===null||r===void 0||r.arrangeCustomCellStyle(e,t,i)}isSeriesNumber(e,t){return this.internalProps.layoutMap.isSeriesNumber(e,t)}isHasSeriesNumber(){var e;return((e=this.internalProps.layoutMap)===null||e===void 0?void 0:e.leftRowSeriesNumberColumnCount)>0}get leftRowSeriesNumberCount(){var e,t;return(t=(e=this.internalProps.layoutMap)===null||e===void 0?void 0:e.leftRowSeriesNumberColumnCount)!==null&&t!==void 0?t:0}setMinMaxLimitWidth(e=!1){var t,i;const r=this.internalProps;for(let o=0;o<r.layoutMap.columnWidths.length;o++){if(this.internalProps._widthResizedColMap.has(o))continue;const{width:s,minWidth:l,maxWidth:a}=(i=(t=r.layoutMap.columnWidths)===null||t===void 0?void 0:t[o])!==null&&i!==void 0?i:{};e&&s&&(typeof s=="string"&&s!=="auto"||typeof s=="number"&&s>0)&&this._setColWidth(o,s),l&&(typeof l=="number"&&l>0||typeof l=="string")&&this.setMinColWidth(o,l),a&&(typeof a=="number"&&a>0||typeof a=="string")&&this.setMaxColWidth(o,a)}}setSortedIndexMap(e,t){var i;(i=this.dataSource)===null||i===void 0||i.setSortedIndexMap(e,t)}checkReactCustomLayout(){this.reactCustomLayout||(this.reactCustomLayout=new UH(this))}get bodyDomContainer(){return this.internalProps.bodyDomContainer}get headerDomContainer(){return this.internalProps.headerDomContainer}get frozenBodyDomContainer(){return this.internalProps.frozenBodyDomContainer}get frozenHeaderDomContainer(){return this.internalProps.frozenHeaderDomContainer}get rightFrozenBodyDomContainer(){return this.internalProps.rightFrozenBodyDomContainer}get rightFrozenHeaderDomContainer(){return this.internalProps.rightFrozenHeaderDomContainer}get frozenBottomDomContainer(){return this.internalProps.frozenBottomDomContainer}get bottomDomContainer(){return this.internalProps.bottomDomContainer}get rightFrozenBottomDomContainer(){return this.internalProps.rightFrozenBottomDomContainer}showMoverLine(e,t){this.scenegraph.component.showMoveCol(e,t,0),this.scenegraph.renderSceneGraph()}hideMoverLine(e,t){this.scenegraph.component.hideMoveCol(),this.scenegraph.renderSceneGraph()}disableScroll(){this.eventManager.disableScroll()}enableScroll(){this.eventManager.enableScroll()}getGroupTitleLevel(e,t){}scrollToRow(e,t){t?this.animationManager.scrollTo({row:e},t):this.scrollToCell({row:e})}scrollToCol(e,t){t?this.animationManager.scrollTo({col:e},t):this.scrollToCell({col:e})}scrollToCell(e,t){if(t)return void this.animationManager.scrollTo(e,t);const i=this.getDrawRange();if(O(e.col)&&e.col>=this.frozenColCount){const r=this.getFrozenColsWidth(),o=this.getColsWidth(0,e.col-1);this.scrollLeft=Math.min(o-r,this.getAllColsWidth()-i.width)}if(O(e.row)&&e.row>=this.frozenRowCount){const r=this.getFrozenRowsHeight(),o=this.getRowsHeight(0,e.row-1);this.scrollTop=Math.min(o-r,this.getAllRowsHeight()-i.height)}this.render()}checkHasColumnAutoWidth(){return jH(this)}}const cf={},Wd={};function Cz(n){if(Wd[n])return Wd[n]}function Vy(n,e,t){const i=n[e];return n[e]=t,i}function IO(n,e){return e!=null?Vy(cf,n,e):cf[n]}function OO(n,e){return e!=null?Vy(Wd,n,e):Wd[n]}const No=(n,e)=>Object.prototype.toString.call(n)===`[object ${e}]`,Gy=(n,e=!1)=>e?typeof n=="boolean":n===!0||n===!1||No(n,"Boolean"),_z=n=>typeof n=="function",xt=n=>n==null,tt=n=>n!=null,wz=n=>typeof n=="object"&&n!==null,yz=function(n){if(!wz(n)||!No(n,"Object"))return!1;if(Object.getPrototypeOf(n)===null)return!0;let e=n;for(;Object.getPrototypeOf(e)!==null;)e=Object.getPrototypeOf(e);return Object.getPrototypeOf(n)===e},jy=(n,e=!1)=>{const t=typeof n;return e?t==="string":t==="string"||No(n,"String")},Ir=n=>Array.isArray?Array.isArray(n):No(n,"Array"),vz=function(n){return n!==null&&typeof n!="function"&&Number.isFinite(n.length)},Uy=n=>No(n,"Date"),Gt=(n,e=!1)=>{const t=typeof n;return e?t==="number":t==="number"||No(n,"Number")};function $y(n,e,t){let i;if(!tt(n)||typeof n!="object"||e)return n;const r=Ir(n),o=n.length;i=r?new Array(o):typeof n=="object"?{}:Gy(n)||Gt(n)||jy(n)?n:Uy(n)?new Date(+n):void 0;const s=r?void 0:Object.keys(Object(n));let l=-1;if(i)for(;++l<(s||n).length;){const a=s?s[l]:l,d=n[a];i[a]=$y(d,e)}return i}function Ky(n,e,t=!1,i=!1){if(e){if(n===e)return;if(tt(e)&&typeof e=="object"){const r=Object(e),o=[];for(const a in r)o.push(a);let{length:s}=o,l=-1;for(;s--;){const a=o[++l];!tt(r[a])||typeof r[a]!="object"||i&&Ir(n[a])?Yy(n,a,r[a]):Sz(n,e,a,t,i)}}}}function Sz(n,e,t,i=!1,r=!1){const o=n[t],s=e[t];let l=e[t],a=!0;if(Ir(s)){if(i)l=[];else if(Ir(o))l=o;else if(vz(o)){l=new Array(o.length);let d=-1;const u=o.length;for(;++d<u;)l[d]=o[d]}}else yz(s)?(l=o??{},typeof o!="function"&&typeof o=="object"||(l={})):a=!1;a&&Ky(l,s,i,r),Yy(n,t,l)}function Yy(n,e,t){(t!==void 0&&!xz(n[e],t)||t===void 0&&!(e in n))&&(n[e]=t)}function xz(n,e){return n===e||Number.isNaN(n)&&Number.isNaN(e)}function Rz(n,...e){let t=-1;const i=e.length;for(;++t<i;)Ky(n,e[t],!0);return n}function Az(n){if(!n)return[];if(Object.keys)return Object.keys(n);const e=[];for(const t in n)n.hasOwnProperty(t)&&e.push(t);return e}function Bz(n,e,t){const i=Az(e);for(let r=0;r<i.length;r++){const o=i[r];(t?e[o]!=null:n[o]==null)&&(n[o]=e[o])}return n}function Xy(n,e,t=!0){if(n="prototype"in n?n.prototype:n,e="prototype"in e?e.prototype:e,Object.getOwnPropertyNames){const i=Object.getOwnPropertyNames(e);for(let r=0;r<i.length;r++){const o=i[r];o!=="constructor"&&(t?e[o]!=null:n[o]==null)&&(n[o]=e[o])}}else Bz(n,e,t)}function Mz(n,e,t){tt(e)||(e=n,n=0),tt(t)||(t=1);let i=-1;const r=0|Math.max(0,Math.ceil((e-n)/t)),o=new Array(r);for(;++i<r;)o[i]=n+i*t;return o}function Tz(n,e){return n<e?-1:n>e?1:n>=e?0:NaN}function fs(n){return Number(n)}const Pz=typeof console<"u";function Yl(n,e,t){const i=[e].concat([].slice.call(t));Pz&&console[n].apply(console,i)}var Ln;(function(n){n[n.None=0]="None",n[n.Error=1]="Error",n[n.Warn=2]="Warn",n[n.Info=3]="Info",n[n.Debug=4]="Debug"})(Ln||(Ln={}));class Nt{static getInstance(e,t){return Nt._instance&&Gt(e)?Nt._instance.level(e):Nt._instance||(Nt._instance=new Nt(e,t)),Nt._instance}static setInstance(e){return Nt._instance=e}static setInstanceLevel(e){Nt._instance?Nt._instance.level(e):Nt._instance=new Nt(e)}static clearInstance(){Nt._instance=null}constructor(e=Ln.None,t){this._onErrorHandler=[],this._level=e,this._method=t}addErrorHandler(e){this._onErrorHandler.find(t=>t===e)||this._onErrorHandler.push(e)}removeErrorHandler(e){const t=this._onErrorHandler.findIndex(i=>i===e);t<0||this._onErrorHandler.splice(t,1)}callErrorHandler(...e){this._onErrorHandler.forEach(t=>t(...e))}canLogInfo(){return this._level>=Ln.Info}canLogDebug(){return this._level>=Ln.Debug}canLogError(){return this._level>=Ln.Error}canLogWarn(){return this._level>=Ln.Warn}level(e){return arguments.length?(this._level=+e,this):this._level}error(...e){var t;return this._level>=Ln.Error&&(this._onErrorHandler.length?this.callErrorHandler(...e):Yl((t=this._method)!==null&&t!==void 0?t:"error","ERROR",e)),this}warn(...e){return this._level>=Ln.Warn&&Yl(this._method||"warn","WARN",e),this}info(...e){return this._level>=Ln.Info&&Yl(this._method||"log","INFO",e),this}debug(...e){return this._level>=Ln.Debug&&Yl(this._method||"log","DEBUG",e),this}}Nt._instance=null;function Hz(n,e,t=0,i){for(xt(i)&&(i=n.length);t<i;){const r=t+i>>>1;Tz(n[r],e)>0?i=r:t=r+1}return t}const kz=1e-10,Ez=1e-10;function qy(n,e,t=Ez,i=kz){const r=i,o=t*Math.max(n,e);return Math.abs(n-e)<=Math.max(r,o)}function l_(n,e,t,i){return n>e&&!qy(n,e,t,i)}function a_(n,e,t,i){return n<e&&!qy(n,e,t,i)}const cl=n=>{let e=null,t=null;return(...i)=>(e&&i.every((r,o)=>r===e[o])||(e=i,t=n(...i)),t)},Zy=function(n,e,t){return n<e?e:n>t?t:n};function sg(n,e){let t;return n>e&&(t=n,n=e,e=t),i=>Math.max(n,Math.min(e,i))}function oa(n,e){return t=>n*(1-t)+e*t}function Lz(n,e){return function(t){return Math.round(n*(1-t)+e*t)}}function Fz(n,e){const t=n.valueOf(),i=e.valueOf(),r=new Date;return o=>(r.setTime(t*(1-o)+i*o),r)}function ff(n,e,t){e/=100,t/=100;const i=(1-Math.abs(2*t-1))*e,r=i*(1-Math.abs(n/60%2-1)),o=t-i/2;let s=0,l=0,a=0;return 0<=n&&n<60?(s=i,l=r,a=0):60<=n&&n<120?(s=r,l=i,a=0):120<=n&&n<180?(s=0,l=i,a=r):180<=n&&n<240?(s=0,l=r,a=i):240<=n&&n<300?(s=r,l=0,a=i):300<=n&&n<360&&(s=i,l=0,a=r),s=Math.round(255*(s+o)),l=Math.round(255*(l+o)),a=Math.round(255*(a+o)),{r:s,g:l,b:a}}function lg(n,e,t){n/=255,e/=255,t/=255;const i=Math.min(n,e,t),r=Math.max(n,e,t),o=r-i;let s=0,l=0,a=0;return s=o===0?0:r===n?(e-t)/o%6:r===e?(t-n)/o+2:(n-e)/o+4,s=Math.round(60*s),s<0&&(s+=360),a=(r+i)/2,l=o===0?0:o/(1-Math.abs(2*a-1)),l=+(100*l).toFixed(1),a=+(100*a).toFixed(1),{h:s,s:l,l:a}}const zz=/^#([0-9a-f]{3,8})$/,d_={transparent:4294967040},sa={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};function Xl(n){return((n=Math.max(0,Math.min(255,Math.round(n)||0)))<16?"0":"")+n.toString(16)}function Jy(n){return Gt(n)?new Ut(n>>16,n>>8&255,255&n,1):Ir(n)?new Ut(n[0],n[1],n[2]):new Ut(255,255,255)}function Iz(n){return Gt(n)?new Ut(n>>>24,n>>>16&255,n>>>8&255,255&n):Ir(n)?new Ut(n[0],n[1],n[2],n[3]):new Ut(255,255,255,1)}function fh(n){return n<.04045?.0773993808*n:Math.pow(.9478672986*n+.0521327014,2.4)}function gh(n){return n<.0031308?12.92*n:1.055*Math.pow(n,.41666)-.055}const u_=(n,e)=>{const t=zz.exec(n);if(e||t){const i=parseInt(t[1],16),r=t[1].length;return r===3?new Ut((i>>8&15)+((i>>8&15)<<4),(i>>4&15)+((i>>4&15)<<4),(15&i)+((15&i)<<4),1):r===6?Jy(i):r===8?new Ut(i>>24&255,i>>16&255,i>>8&255,(255&i)/255):null}};class zn{static Brighter(e,t=1){return t===1?e:new zn(e).brighter(t).toRGBA()}static SetOpacity(e,t=1){return t===1?e:new zn(e).setOpacity(t).toRGBA()}static getColorBrightness(e,t="hsl"){const i=e instanceof zn?e:new zn(e);switch(t){case"hsv":default:return i.getHSVBrightness();case"hsl":return i.getHSLBrightness();case"lum":return i.getLuminance();case"lum2":return i.getLuminance2();case"lum3":return i.getLuminance3()}}static parseColorString(e){if(tt(d_[e]))return Iz(d_[e]);if(tt(sa[e]))return Jy(sa[e]);const t=`${e}`.trim().toLowerCase(),i=u_(t);if(i!==void 0)return i;if(/^(rgb|RGB|rgba|RGBA)/.test(t)){const r=t.replace(/(?:\(|\)|rgba|RGBA|rgb|RGB)*/g,"").split(",");return new Ut(parseInt(r[0],10),parseInt(r[1],10),parseInt(r[2],10),parseFloat(r[3]))}if(/^(hsl|HSL|hsla|HSLA)/.test(t)){const r=t.replace(/(?:\(|\)|hsla|HSLA|hsl|HSL)*/g,"").split(","),o=ff(parseInt(r[0],10),parseInt(r[1],10),parseInt(r[2],10));return new Ut(o.r,o.g,o.b,parseFloat(r[3]))}}constructor(e){const t=zn.parseColorString(e);t?this.color=t:(console.warn(`Warn: 传入${e}无法解析为Color`),this.color=new Ut(255,255,255))}toRGBA(){return this.color.formatRgb()}toString(){return this.color.formatRgb()}toHex(){return this.color.formatHex()}toHsl(){return this.color.formatHsl()}brighter(e){const{r:t,g:i,b:r}=this.color;return this.color.r=Math.max(0,Math.min(255,Math.floor(t*e))),this.color.g=Math.max(0,Math.min(255,Math.floor(i*e))),this.color.b=Math.max(0,Math.min(255,Math.floor(r*e))),this}add(e){const{r:t,g:i,b:r}=this.color;return this.color.r+=Math.min(255,t+e.color.r),this.color.g+=Math.min(255,i+e.color.g),this.color.b+=Math.min(255,r+e.color.b),this}sub(e){return this.color.r=Math.max(0,this.color.r-e.color.r),this.color.g=Math.max(0,this.color.g-e.color.g),this.color.b=Math.max(0,this.color.b-e.color.b),this}multiply(e){const{r:t,g:i,b:r}=this.color;return this.color.r=Math.max(0,Math.min(255,Math.floor(t*e.color.r))),this.color.g=Math.max(0,Math.min(255,Math.floor(i*e.color.g))),this.color.b=Math.max(0,Math.min(255,Math.floor(r*e.color.b))),this}getHSVBrightness(){return Math.max(this.color.r,this.color.g,this.color.b)/255}getHSLBrightness(){return .5*(Math.max(this.color.r,this.color.g,this.color.b)/255+Math.min(this.color.r,this.color.g,this.color.b)/255)}setHsl(e,t,i){const r=this.color.opacity,o=lg(this.color.r,this.color.g,this.color.b),s=ff(xt(e)?o.h:Zy(e,0,360),xt(t)?o.s:t>=0&&t<=1?100*t:t,xt(i)?o.l:i<=1&&i>=0?100*i:i);return this.color=new Ut(s.r,s.g,s.b,r),this}setRGB(e,t,i){return!xt(e)&&(this.color.r=e),!xt(t)&&(this.color.g=t),!xt(i)&&(this.color.b=i),this}setHex(e){const t=`${e}`.trim().toLowerCase(),i=u_(t,!0);return i??this}setColorName(e){const t=sa[e.toLowerCase()];return t!==void 0?this.setHex(t):console.warn("THREE.Color: Unknown color "+e),this}setScalar(e){return this.color.r=e,this.color.g=e,this.color.b=e,this}setOpacity(e=1){return this.color.opacity=e,this}getLuminance(){return(.2126*this.color.r+.7152*this.color.g+.0722*this.color.b)/255}getLuminance2(){return(.2627*this.color.r+.678*this.color.g+.0593*this.color.b)/255}getLuminance3(){return(.299*this.color.r+.587*this.color.g+.114*this.color.b)/255}clone(){return new zn(this.color.toString())}copyGammaToLinear(e,t=2){return this.color.r=Math.pow(e.color.r,t),this.color.g=Math.pow(e.color.g,t),this.color.b=Math.pow(e.color.b,t),this}copyLinearToGamma(e,t=2){const i=t>0?1/t:1;return this.color.r=Math.pow(e.color.r,i),this.color.g=Math.pow(e.color.g,i),this.color.b=Math.pow(e.color.b,i),this}convertGammaToLinear(e){return this.copyGammaToLinear(this,e),this}convertLinearToGamma(e){return this.copyLinearToGamma(this,e),this}copySRGBToLinear(e){return this.color.r=fh(e.color.r),this.color.g=fh(e.color.g),this.color.b=fh(e.color.b),this}copyLinearToSRGB(e){return this.color.r=gh(e.color.r),this.color.g=gh(e.color.g),this.color.b=gh(e.color.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}}class Ut{constructor(e,t,i,r){this.r=isNaN(+e)?255:Math.max(0,Math.min(255,+e)),this.g=isNaN(+t)?255:Math.max(0,Math.min(255,+t)),this.b=isNaN(+i)?255:Math.max(0,Math.min(255,+i)),tt(r)?this.opacity=isNaN(+r)?1:Math.max(0,Math.min(1,+r)):this.opacity=1}formatHex(){return`#${Xl(this.r)+Xl(this.g)+Xl(this.b)+(this.opacity===1?"":Xl(255*this.opacity))}`}formatRgb(){const e=this.opacity;return`${e===1?"rgb(":"rgba("}${this.r},${this.g},${this.b}${e===1?")":`,${e})`}`}formatHsl(){const e=this.opacity,{h:t,s:i,l:r}=lg(this.r,this.g,this.b);return`${e===1?"hsl(":"hsla("}${t},${i}%,${r}%${e===1?")":`,${e})`}`}toString(){return this.formatHex()}}function Oz(n){let e="",t="",i="";const r=n[0]==="#"?1:0;for(let o=r;o<n.length;o++)n[o]!=="#"&&(o<r+2?e+=n[o]:o<r+4?t+=n[o]:o<r+6&&(i+=n[o]));return[parseInt(e,16),parseInt(t,16),parseInt(i,16)]}function Dz(n,e,t){return Number((1<<24)+(n<<16)+(e<<8)+t).toString(16).slice(1)}function Wz(n,e){const t=n.r,i=e.r,r=n.g,o=e.g,s=n.b,l=e.b,a=n.opacity,d=e.opacity;return u=>{const h=Math.round(t*(1-u)+i*u),c=Math.round(r*(1-u)+o*u),g=Math.round(s*(1-u)+l*u);return new Ut(h,c,g,a*(1-u)+d*u)}}const Nz=Object.freeze(Object.defineProperty({__proto__:null,Color:zn,DEFAULT_COLORS:sa,RGB:Ut,hexToRgb:Oz,hslToRgb:ff,interpolateRgb:Wz,rgbToHex:Dz,rgbToHsl:lg},Symbol.toStringTag,{value:"Module"}));function Vz(n){try{return n instanceof Element}catch{const t=["children","innerHTML","classList","setAttribute","tagName","getBoundingClientRect"],i=Object.keys(n);return t.every(r=>i.includes(r))}}const Gz=(n,e)=>{var t,i;if(!(e!=null&&e.fields)||n.length===0)return n;const r=e.fields,o=n[0],s={},l=[];for(const a in r)if(Object.prototype.hasOwnProperty.call(r,a)){const d=r[a];if(!d.type){let h=o;a in o||(h=(t=n.find(c=>a in c))!==null&&t!==void 0?t:o),d.type=typeof h[a]=="number"?"linear":"ordinal"}let u;if(typeof d.sortIndex=="number"&&(u={key:a,type:d.type,index:d.sortIndex,sortIndex:{},sortIndexCount:0,sortReverse:d.sortReverse===!0},l.push(u)),((i=d.domain)===null||i===void 0?void 0:i.length)>0)if(d.type==="ordinal"){d._domainCache={},s[a]=d;const h={};d.domain.forEach((c,g)=>{h[c]=g,d._domainCache[c]=g}),u&&(u.sortIndex=h,u.sortIndexCount=d.domain.length)}else d.domain.length>=2&&(s[a]=d)}return Object.keys(s).length>0&&(n=n.filter(a=>{for(const d in s){const u=s[d];if(u.type==="ordinal"){if(!(a[d]in u._domainCache))return!1}else if(u.domain[0]>a[d]||u.domain[1]<a[d])return!1}return!0})),l.sort((a,d)=>a.index-d.index),n.sort((a,d)=>jz(a,d,l)),n};function jz(n,e,t){for(let i=0;i<t.length;i++){const r=t[i];let o=0;if(r.type==="ordinal"?(r.sortIndex[e[r.key]]===void 0&&(r.sortIndex[e[r.key]]=r.sortIndexCount++),r.sortIndex[n[r.key]]===void 0&&(r.sortIndex[n[r.key]]=r.sortIndexCount++),o=r.sortIndex[n[r.key]]-r.sortIndex[e[r.key]]):r.type==="linear"&&(o=n[r.key]-e[r.key]),r.sortReverse&&(o=-o),o!==0)return o}return 0}let ph=0;const Uz=1e8;function Qy(n="dataset"){return ph>Uz&&(ph=0),n+"_"+ph++}class $z{constructor(e){var t;let i;this.options=e,this.isDataSet=!0,this.transformMap={},this.parserMap={},this.dataViewMap={},this.target=new Lo,i=e!=null&&e.name?e.name:Qy("dataset"),this.name=i,this._logger=(t=e==null?void 0:e.logger)!==null&&t!==void 0?t:Nt.getInstance()}setLogger(e){this._logger=e}getDataView(e){return this.dataViewMap[e]}setDataView(e,t){var i;this.dataViewMap[e]&&((i=this._logger)===null||i===void 0||i.error(`Error: dataView ${e} 之前已存在，请重新命名`)),this.dataViewMap[e]=t}removeDataView(e){this.dataViewMap[e]=null,delete this.dataViewMap[e]}registerParser(e,t){var i;this.parserMap[e]&&((i=this._logger)===null||i===void 0||i.warn(`Warn: transform ${e} 之前已注册，执行覆盖逻辑`)),this.parserMap[e]=t}removeParser(e){this.parserMap[e]=null,delete this.parserMap[e]}getParser(e){return this.parserMap[e]||this.parserMap.default}registerTransform(e,t){var i;this.transformMap[e]&&((i=this._logger)===null||i===void 0||i.warn(`Warn: transform ${e} 之前已注册，执行覆盖逻辑`)),this.transformMap[e]=t}removeTransform(e){this.transformMap[e]=null,delete this.transformMap[e]}getTransform(e){return this.transformMap[e]}multipleDataViewAddListener(e,t,i){this._callMap||(this._callMap=new Map);let r=this._callMap.get(i);r||(r=()=>{e.some(o=>o.isRunning)||i()}),e.forEach(o=>{o.target.addListener(t,r)}),this._callMap.set(i,r)}allDataViewAddListener(e,t){this.multipleDataViewAddListener(Object.values(this.dataViewMap),e,t)}multipleDataViewRemoveListener(e,t,i){if(this._callMap){const r=this._callMap.get(i);r&&e.forEach(o=>{o.target.removeListener(t,r)}),this._callMap.delete(i)}}multipleDataViewUpdateInParse(e){e.forEach(t=>{var i;return(i=this.getDataView(t.name))===null||i===void 0?void 0:i.markRunning()}),e.forEach(t=>{var i;return(i=this.getDataView(t.name))===null||i===void 0?void 0:i.parseNewData(t.data,t.options)})}multipleDataViewUpdateInRawData(e){e.forEach(t=>{var i;return(i=this.getDataView(t.name))===null||i===void 0?void 0:i.markRunning()}),e.forEach(t=>{var i;return(i=this.getDataView(t.name))===null||i===void 0?void 0:i.updateRawData(t.data,t.options)})}destroy(){this.transformMap=null,this.parserMap=null,this.dataViewMap=null,this._callMap=null,this.target.removeAllListeners()}}const mh="_data-view-diff-rank";class Bu{constructor(e,t){let i;this.dataSet=e,this.options=t,this.isDataView=!0,this.target=new Lo,this.parseOption=null,this.transformsArr=[],this.isRunning=!1,this.rawData={},this.history=!1,this.parserData={},this.latestData={},this._fields=null,this.reRunAllTransform=(r={pushHistory:!0,emitMessage:!0})=>(this.isRunning=!0,this.resetTransformData(),this.transformsArr.forEach(o=>{this.executeTransform(o,{pushHistory:r.pushHistory,emitMessage:!1}),this.isLastTransform(o)&&this.diffLastData()}),this.isRunning=!1,r.emitMessage!==!1&&this.target.emit("change",[]),this),this.markRunning=()=>{this.isRunning=!0,this.target.emit("markRunning",[])},i=t!=null&&t.name?t.name:Qy("dataview"),this.name=i,t!=null&&t.history&&(this.history=t.history,this.historyData=[]),this.dataSet.setDataView(i,this),this.setFields(t==null?void 0:t.fields)}parse(e,t,i=!1){var r;this.isRunning=!0,i&&this.target.emit("beforeParse",[]),t&&(this.parseOption=t);const o=this.cloneParseData(e,t);if(t!=null&&t.type){const s=((r=this.dataSet.getParser(t.type))!==null&&r!==void 0?r:this.dataSet.getParser("bytejson"))(o,t.options,this);this.rawData=o,this.parserData=s,this.history&&this.historyData.push(o,s),this.latestData=s}else this.parserData=o,this.rawData=o,this.history&&this.historyData.push(o),this.latestData=o;return this.isRunning=!1,i&&this.target.emit("afterParse",[]),this}transform(e,t=!0){if(this.isRunning=!0,e&&e.type){let i=!0;if(e.type==="fields"){this._fields=e.options.fields;const r=this.transformsArr.findIndex(o=>o.type===e.type);r>=0&&(i=!1,this.transformsArr[r].options.fields=this._fields)}if(i&&this.transformsArr.push(e),t){const r=this.isLastTransform(e);this.executeTransform(e),r&&this.diffLastData()}}return this.sortTransform(),this.isRunning=!1,this}isLastTransform(e){return this.transformsArr[this.transformsArr.length-1]===e}sortTransform(){this.transformsArr.length>=2&&this.transformsArr.sort((e,t)=>{var i,r;return((i=e.level)!==null&&i!==void 0?i:0)-((r=t.level)!==null&&r!==void 0?r:0)})}executeTransform(e,t={pushHistory:!0,emitMessage:!0}){const{pushHistory:i,emitMessage:r}=t,o=this.dataSet.getTransform(e.type)(this.latestData,e.options);this.history&&i!==!1&&this.historyData.push(o),this.latestData=o,r!==!1&&this.target.emit("change",[])}resetTransformData(){this.latestData=this.parserData,this.history&&(this.historyData.length=0,this.historyData.push(this.rawData,this.parserData))}enableDiff(e){this._diffData=!0,this._diffKeys=e,this._diffMap=new Map,this._diffRank=0}disableDiff(){this._diffData=!1,this._diffMap=null,this._diffRank=null}resetDiff(){this._diffMap=new Map,this._diffRank=0}diffLastData(){var e;if(!this._diffData||!this.latestData.forEach||!(!((e=this._diffKeys)===null||e===void 0)&&e.length))return;const t=this._diffRank+1;if(this._diffRank===0)this.latestData.forEach(i=>{i[mh]=t,this._diffMap.set(this._diffKeys.reduce((r,o)=>r+i[o],""),i)}),this.latestDataAUD={add:Array.from(this.latestData),del:[],update:[]};else{let i;this.latestDataAUD={add:[],del:[],update:[]},this.latestData.forEach(r=>{r[mh]=t,i=this._diffKeys.reduce((o,s)=>o+r[s],""),this._diffMap.get(i)?this.latestDataAUD.update.push(r):this.latestDataAUD.add.push(r),this._diffMap.set(i,r)}),this._diffMap.forEach((r,o)=>{r[mh]<t&&(this.latestDataAUD.del.push(r),this._diffMap.delete(o))})}this._diffRank=t}cloneParseData(e,t){let i=!1;return e instanceof Bu||(t==null?void 0:t.clone)!==!0||(i=!0),i?$y(e):e}parseNewData(e,t){this.parse(e,t||this.parseOption),this.reRunAllTransform()}updateRawData(e,t){const i=this.cloneParseData(e,t);this.rawData=i,this.parserData=i,this.latestData=i,this.reRunAllTransform()}getFields(){var e;return this._fields?this._fields:((e=this.parseOption)===null||e===void 0?void 0:e.type)==="dataview"&&this.rawData.length===1&&this.rawData[0].getFields?this.rawData[0].getFields():null}setFields(e,t=!1){this._fields=e&&t?Rz({},this._fields,e):e;const i=this.transformsArr.find(r=>r.type==="fields");!xt(this._fields)&&xt(i)?(this.dataSet.registerTransform("fields",Gz),this.transform({type:"fields",options:{fields:this._fields}},!1)):i&&(i.options.fields=this._fields)}destroy(){this.dataSet.removeDataView(this.name),this._diffMap=null,this._diffRank=null,this.latestData=null,this.rawData=null,this.parserData=null,this.transformsArr=null,this.target=null}}function Kz(n){return n instanceof Bu}function br(n,e=["data"]){const t=n;let i;if(!tt(t)||typeof t!="object"||Kz(t)||Vz(t))return t;const r=Ir(t),o=t.length;i=r?new Array(o):typeof t=="object"?{}:Gy(t)||Gt(t)||jy(t)?t:Uy(t)?new Date(+t):void 0;const s=r?void 0:Object.keys(Object(t));let l=-1;if(i)for(;++l<(s||t).length;){const a=s?s[l]:l,d=t[a];e!=null&&e.includes(a.toString())?i[a]=d:i[a]=br(d,e)}return i}function ev(n){var e,t;const i=Object.assign({},n);return ye(n.style)||(i.textStyle=lt(n.style)),ye(n.textStyle)||re(i.textStyle,lt(n.textStyle)),!((e=n.shape)===null||e===void 0)&&e.style&&lt(i.shape.style),!((t=n.background)===null||t===void 0)&&t.style&&lt(i.background.style),i}function lt(n){return ye(n)||n.angle&&(n.angle=Mr(n.angle)),n}function In(n={}){return ye(n.style)||(n.style=lt(n.style)),ye(n.state)||Object.keys(n.state).forEach(e=>{ye(n.state[e])||(n.state[e]=lt(n.state[e]))}),n}function sr(n){return ye(n)?null:(Object.keys(n).forEach(e=>{ye(n[e])||(n[e]=lt(n[e]))}),n)}function Yz(n){return In(n),In(n.startSymbol),In(n.endSymbol),n}const Xz={left:{textAlign:"center",textBaseline:"bottom"},right:{textAlign:"center",textBaseline:"bottom"},radius:{},angle:{}},_o="PingFang SC,Microsoft Yahei,system-ui,-apple-system,segoe ui,Roboto,Helvetica,Arial,sans-serif, apple color emoji,segoe ui emoji,segoe ui symbol",Qn=14,gs={LABEL_FONT_SIZE:14,AXIS_TICK_SIZE:4},Nd={domainLine:{visible:!0,style:{lineWidth:1,stroke:"#D9DDE4",strokeOpacity:1}},grid:{visible:!0,style:{lineWidth:1,stroke:"#EBEDF2",strokeOpacity:1,lineDash:[]}},subGrid:{visible:!1,style:{lineWidth:1,stroke:"#EBEDF2",strokeOpacity:1,lineDash:[4,4]}},tick:{visible:!0,tickSize:gs.AXIS_TICK_SIZE,style:{lineWidth:1,stroke:"#D9DDE4",strokeOpacity:1}},subTick:{visible:!1,tickSize:gs.AXIS_TICK_SIZE/2,style:{lineWidth:1,stroke:"#D9DDE4",strokeOpacity:1}},label:{visible:!0,space:1,style:{fontSize:gs.LABEL_FONT_SIZE,fill:"#89909D",fontWeight:"normal",fillOpacity:1},autoLimit:!0},title:{space:10,style:{fontSize:gs.LABEL_FONT_SIZE,fill:"#333333",fontWeight:"normal",fillOpacity:1}}};function qz(n){var e,t;return!((t=(e=n==null?void 0:n.colorScheme)===null||e===void 0?void 0:e.default)===null||t===void 0)&&t.palette?re({},Nd,{tick:{style:{stroke:n.colorScheme.default.palette.axisDomainColor||"#D9DDE4"}},subTick:{style:{stroke:n.colorScheme.default.palette.axisDomainColor||"#D9DDE4"}},label:{style:{fill:n.colorScheme.default.palette.axisLabelFontColor||"#89909D"}},title:{style:{fill:n.colorScheme.default.palette.secondaryFontColor||"#333333"}}}):Nd}function h_(n){var e,t,i,r,o,s,l,a,d,u,h,c,g;const f=re({},n);let p,m=(t=(e=f.title)===null||e===void 0?void 0:e.angle)!==null&&t!==void 0?t:0;f.orient!=="left"&&f.orient!=="right"||!((i=f.title)===null||i===void 0)&&i.autoRotate&&Te(f.title.angle)&&(m=f.orient==="left"?-90:90,p=Xz[f.orient]);const b=kv(f.label,["style","formatMethod","state"]);return{orient:f.orient,select:f.select,hover:f.hover,line:Yz(f.domainLine),label:Object.assign({style:lt(f.label.style),formatMethod:f.label.formatMethod?(C,_,w)=>f.label.formatMethod(_.rawValue,_):null,state:sr(f.label.state)},b),tick:{visible:f.tick.visible,length:f.tick.tickSize,inside:f.tick.inside,alignWithLabel:f.tick.alignWithLabel,style:lt(f.tick.style),state:sr(f.tick.state),dataFilter:f.tick.dataFilter},subTick:{visible:f.subTick.visible,length:f.subTick.tickSize,inside:f.subTick.inside,count:f.subTick.tickCount,style:lt(f.subTick.style),state:sr(f.subTick.state)},grid:{type:"line",visible:f.grid.visible,alternateColor:f.grid.alternateColor,alignWithLabel:f.grid.alignWithLabel,style:lt(f.grid.style)},subGrid:{type:"line",visible:f.subGrid.visible,alternateColor:f.subGrid.alternateColor,style:lt(f.subGrid.style)},title:{visible:f.title.visible,position:f.title.position,space:f.title.space,autoRotate:!1,angle:m?Mr(m):null,textStyle:re({},p,lt(f.title.style)),padding:f.title.padding,shape:{visible:(r=f.title.shape)===null||r===void 0?void 0:r.visible,space:(o=f.title.shape)===null||o===void 0?void 0:o.space,style:lt((s=f.title.shape)===null||s===void 0?void 0:s.style)},background:{visible:(l=f.title.background)===null||l===void 0?void 0:l.visible,style:lt((a=f.title.background)===null||a===void 0?void 0:a.style)},state:{text:sr(f.title.state),shape:sr((d=f.title.shape)===null||d===void 0?void 0:d.state),background:sr((u=f.title.background)===null||u===void 0?void 0:u.state)}},panel:{visible:(h=f.background)===null||h===void 0?void 0:h.visible,style:lt((c=f.background)===null||c===void 0?void 0:c.style),state:sr((g=f.background)===null||g===void 0?void 0:g.state)}}}const c_="NO_AXISID_FRO_VTABLE";function DO(n,e,t){var i,r;const o=t.getCellHeaderPaths(n,e);let s;if(t.indicatorsAsCol){const a=(i=o.colHeaderPaths.find(d=>d.indicatorKey))===null||i===void 0?void 0:i.indicatorKey;s=t.columnObjects.find(d=>d.indicatorKey===a)}else{const a=(r=o.rowHeaderPaths.find(d=>d.indicatorKey))===null||r===void 0?void 0:r.indicatorKey;s=t.columnObjects.find(d=>d.indicatorKey===a)}const l=s==null?void 0:s.chartSpec;return typeof l=="function"?l({col:n,row:e,dataValue:t._table.getCellOriginValue(n,e)||"",value:t._table.getCellValue(n,e)||"",rect:t._table.getCellRangeRelativeRect(t._table.getCellRange(n,e)),table:t._table}):l}function WO(n,e,t){var i,r;const o=t.getCellHeaderPaths(n,e);let s;if(t.indicatorsAsCol){const l=(i=o.colHeaderPaths.find(a=>a.indicatorKey))===null||i===void 0?void 0:i.indicatorKey;s=t.columnObjects.find(a=>a.indicatorKey===l)}else{const l=(r=o.rowHeaderPaths.find(a=>a.indicatorKey))===null||r===void 0?void 0:r.indicatorKey;s=t.columnObjects.find(a=>a.indicatorKey===l)}return typeof(s==null?void 0:s.chartSpec)!="function"}function NO(n,e,t){var i,r;const o=t.getCellHeaderPaths(n,e);let s;if(t.indicatorsAsCol){const l=(i=o.colHeaderPaths.find(a=>a.indicatorKey))===null||i===void 0?void 0:i.indicatorKey;s=t.columnObjects.find(a=>a.indicatorKey===l)}else{const l=(r=o.rowHeaderPaths.find(a=>a.indicatorKey))===null||r===void 0?void 0:r.indicatorKey;s=t.columnObjects.find(a=>a.indicatorKey===l)}return s==null?void 0:s.noDataRenderNothing}function VO(n){let e=!1;for(let t=0;t<n.length;t++){const i=n[t];if(i.chartSpec&&i.chartSpec.type!=="wordCloud"&&i.chartSpec.type!=="radar"&&i.chartSpec.type!=="gauge"&&i.chartSpec.type!=="pie"&&i.chartSpec.type!=="funnel"&&i.chartSpec.type!=="rose"){e=!0;break}}return e}function GO(n,e,t){let i=!0;const r=t.getRawChartSpec(n,e);return r&&r.type!=="pie"&&r.type!=="radar"&&r.type!=="gauge"&&r.type!=="wordCloud"&&r.type!=="funnel"&&r.type!=="rose"||(i=!1),i}function jO(n,e,t,i){let r=!1;if(i.indicatorsAsCol&&t==="row"||!i.indicatorsAsCol&&t==="col")for(let o=0;o<i.indicatorsDefine.length;o++){const s=i.indicatorsDefine[o];if(s.chartSpec&&s.chartSpec.type!=="pie"&&s.chartSpec.type!=="wordCloud"&&s.chartSpec.type!=="radar"&&s.chartSpec.type!=="gauge"&&s.chartSpec.type!=="funnel"&&s.chartSpec.type!=="rose"){r=!0;break}}else{const o=i.getRawChartSpec(n,e);o?o.type!=="pie"&&o.type!=="radar"&&o.type!=="gauge"&&o.type!=="wordCloud"&&o.type!=="funnel"&&o.type!=="rose"&&(r=!0):r=!1}return r}function UO(n,e,t){let i=t.getRawChartSpec(n,e);return i?(t._table.isPivotChart()&&(i=br(i),i.sortDataByAxis=!0,ee(i.series)&&i.series.forEach(r=>{r.sortDataByAxis=!0}),i.type!=="gauge"&&i.type!=="rose"&&i.type!=="radar"&&(i.axes=t.getChartAxes(n,e)),i.padding=0,i.dataZoom=[]),i):null}function $O(n,e,t){var i,r,o;const s=[];if(t.indicatorsAsCol){const l=t.getIndicatorKeyInChartSpec(n,e),a=t.getColKeysPath(n,e);l.forEach((m,b)=>{const{range:C,targetTicks:_,targetRange:w,axisOption:y}=r_(n,e,b,b===0?"bottom":"top",b===0?"top":"bottom",l,a,t);J(y==null?void 0:y.min)&&(C.min=y.min),J(y==null?void 0:y.max)&&(C.max=y.max),f_(y,s)||s.push(re({range:C,label:{style:{fontSize:Qn}}},y,{type:(y==null?void 0:y.type)||"linear",orient:b===0?"bottom":"top",label:{visible:!1,flush:!0},title:{visible:!1},domainLine:{visible:!1},seriesIndex:y!=null&&y.seriesId?void 0:b,tick:{tickMode:lo(_,w,C,b)},sync:{axisId:c_}}))});let d=t.getDimensionKeyInChartSpec(t.rowHeaderLevelCount,e);ee(d)&&(d=d[0]);const u=t.dataset.cacheCollectedValues[d]||t.dataset.collectedValues[d]||[],h=t.getRowKeysPath(n,e),c=u[h??""],{axisOption:g,isPercent:f,chartType:p}=Eo(n,e,"left",t);s.push(re({domain:(g==null?void 0:g.type)!=="linear"||Array.isArray(c)?Array.from(c??[]):void 0,range:(g==null?void 0:g.type)!=="linear"||Array.isArray(c)?void 0:c,label:{style:{fontSize:Qn}}},g,{type:(i=g==null?void 0:g.type)!==null&&i!==void 0?i:"band",orient:"left",label:{visible:!1},domainLine:{visible:!1},tick:{visible:!1},subTick:{visible:!1},title:{visible:!1}}))}else{const l=t.getIndicatorKeyInChartSpec(n,e),a=t.getRowKeysPath(n,e);l.forEach((m,b)=>{const{range:C,targetTicks:_,targetRange:w,axisOption:y}=r_(n,e,b,b===0?"left":"right",b===0?"right":"left",l,a,t);J(y==null?void 0:y.min)&&(C.min=y.min),J(y==null?void 0:y.max)&&(C.max=y.max),f_(y,s)||s.push(re({range:C,label:{style:{fontSize:Qn}}},y,{type:(y==null?void 0:y.type)||"linear",orient:b===0?"left":"right",label:{visible:!1,flush:!0},title:{visible:!1},domainLine:{visible:!1},seriesIndex:y!=null&&y.seriesId?void 0:b,tick:{tickMode:lo(_,w,C,b)},sync:{axisId:c_}}))});let d=t.getDimensionKeyInChartSpec(n,t.columnHeaderLevelCount);ee(d)&&(d=d[0]);const u=t.dataset.cacheCollectedValues[d]||t.dataset.collectedValues[d]||[],h=t.getColKeysPath(n,e),c=(r=u==null?void 0:u[h??""])!==null&&r!==void 0?r:[],{axisOption:g,isPercent:f,chartType:p}=Eo(n,e,"bottom",t);s.push(re({domain:(g==null?void 0:g.type)!=="linear"||Array.isArray(c)?Array.from(c??[]):void 0,range:(g==null?void 0:g.type)!=="linear"||Array.isArray(c)?void 0:c,label:{style:{fontSize:Qn}}},g,{type:(o=g==null?void 0:g.type)!==null&&o!==void 0?o:"band",orient:"bottom",visible:!0,label:{visible:!1},domainLine:{visible:!1},tick:{visible:!1},subTick:{visible:!1},title:{visible:!1}}))}return s}function Zz(n,e,t){var i;const r=t.getRawChartSpec(n,e);if(r!=null&&r.series){const o={};return!((i=r.data)===null||i===void 0)&&i.id&&(o[r.data.id]=void 0),r==null||r.series.forEach(s=>{var l,a,d,u,h,c,g,f,p,m,b;if(!(!((l=s.data)===null||l===void 0)&&l.fromDataId))if(!((a=s.data)===null||a===void 0)&&a.transforms)o[(b=(p=(f=s.data)===null||f===void 0?void 0:f.id)!==null&&p!==void 0?p:(m=r.data)===null||m===void 0?void 0:m.id)!==null&&b!==void 0?b:"data"]=void 0;else{const C=s.direction==="horizontal"?s.xField:s.yField;o[(c=(u=(d=s.data)===null||d===void 0?void 0:d.id)!==null&&u!==void 0?u:(h=r.data)===null||h===void 0?void 0:h.id)!==null&&c!==void 0?c:"data"]=!((g=s.data)===null||g===void 0)&&g.id?C:void 0}}),o}return r.data.id}function Jz(n){let e=!1;for(let t=0;t<n.columnObjects.length;t++)if(n.columnObjects[t].chartSpec){e=!0;break}return e}function f_(n,e){return!!(n&&ee(n.seriesId)&&n.seriesId.length>0&&e.filter(t=>!(t.orient!==n.orient||!t.seriesId||t.seriesId.length!==n.seriesId.length||!t.seriesId.every((i,r)=>i===n.seriesId[r]))).length>0)}function Qz(n,e,t){var i,r,o;if(n===-1||e===-1)return{start:{col:n,row:e},end:{col:n,row:e}};if(t._cellRangeMap.has(`$${n}$${e}`))return t._cellRangeMap.get(`$${n}$${e}`);let s={start:{col:n,row:e},end:{col:n,row:e}};if(t.transpose)s=tI(n,e,t);else if(t.headerLevelCount<=e){if(t.headerLevelCount<=e&&(!((r=(i=t.columnObjects[n-t.leftRowSeriesNumberColumnCount])===null||i===void 0?void 0:i.define)===null||r===void 0)&&r.mergeCell)){const l=t._table.getCellValue(n,e);for(let a=e-1;a>=t.headerLevelCount;a--){const d=t._table.getCellValue(n,a);if(typeof t.columnObjects[n-t.leftRowSeriesNumberColumnCount].define.mergeCell=="boolean"){if(l!==d)break}else if(!t.columnObjects[n-t.leftRowSeriesNumberColumnCount].define.mergeCell(l,d,{source:{col:n,row:e},target:{col:n,row:a},table:t._table}))break;s.start.row=a}for(let a=e+1;a<t.rowCount;a++){const d=t._table.getCellValue(n,a);if(typeof t.columnObjects[n-t.leftRowSeriesNumberColumnCount].define.mergeCell=="boolean"){if(l!==d)break}else if(!t.columnObjects[n-t.leftRowSeriesNumberColumnCount].define.mergeCell(l,d,{source:{col:n,row:e},target:{col:n,row:a},table:t._table}))break;s.end.row=a}}eI(n,e,s,t)}else{const l=t.getCellId(n,e);for(let a=n-1;a>=0&&l===t.getCellId(a,e);a--)s.start.col=a;for(let a=n+1;a<((o=t.colCount)!==null&&o!==void 0?o:0)&&l===t.getCellId(a,e);a++)s.end.col=a;for(let a=e-1;a>=0&&l===t.getCellId(n,a);a--)s.start.row=a;for(let a=e+1;a<t.headerLevelCount&&l===t.getCellId(n,a);a++)s.end.row=a}return t._cellRangeMap.set(`$${n}$${e}`,s),s}function eI(n,e,t,i){var r;if(i.rowHierarchyType!=="tree")return;const o=i._table.getCellRawRecord(n,e);!((r=i._table.internalProps.rowSeriesNumber)===null||r===void 0)&&r.enableTreeCheckbox?o!=null&&o.vtableMerge&&n>=i.leftRowSeriesNumberColumnCount&&(t.start.col=i.rowHeaderLevelCount+i.leftRowSeriesNumberColumnCount,t.end.col=i.colCount-1,t.start.row=t.end.row=e):o!=null&&o.vtableMerge&&(t.start.col=i.rowHeaderLevelCount,t.end.col=i.colCount-1,t.start.row=t.end.row=e)}function tI(n,e,t){var i,r,o,s;const l={start:{col:n,row:e},end:{col:n,row:e}};if(t.headerLevelCount+t.leftRowSeriesNumberColumnCount<=n||n===-1&&e===-1){if(t.headerLevelCount+t.leftRowSeriesNumberColumnCount<=n&&(!((r=(i=t.columnObjects[e])===null||i===void 0?void 0:i.define)===null||r===void 0)&&r.mergeCell)){const d=t._table.getCellValue(n,e);for(let u=n-1;u>=t.headerLevelCount+t.leftRowSeriesNumberColumnCount;u--){const h=t._table.getCellValue(u,e);if(typeof t.columnObjects[e].define.mergeCell=="boolean"){if(d!==h)break}else if(!t.columnObjects[e].define.mergeCell(d,h,{source:{col:n,row:e},target:{col:u,row:e},table:t._table}))break;l.start.col=u}for(let u=n+1;u<((o=t.colCount)!==null&&o!==void 0?o:0);u++){const h=t._table.getCellValue(u,e);if(typeof t.columnObjects[e].define.mergeCell=="boolean"){if(d!==h)break}else if(!t.columnObjects[e].define.mergeCell(d,h,{source:{col:n,row:e},target:{col:u,row:e},table:t._table}))break;l.end.col=u}}return l}const a=t.getCellId(n,e);for(let d=e-1;d>=0&&a===t.getCellId(n,d);d--)l.start.row=d;for(let d=e+1;d<((s=t.rowCount)!==null&&s!==void 0?s:0)&&a===t.getCellId(n,d);d++)l.end.row=d;for(let d=n-1;d>=0&&a===t.getCellId(d,e);d--)l.start.col=d;for(let d=n+1;d<t.headerLevelCount+t.leftRowSeriesNumberColumnCount&&a===t.getCellId(d,e);d++)l.end.col=d;return l}class nI{constructor(e,t,i,r){this.seqId=0,this.leftRowSeriesNumberColumnCount=0,this.rightRowSeriesNumberColumnCount=0,this.bodyRowSpanCount=1,this._transpose=!1,this._showHeader=!0,this._recordsCount=0,this._hasAggregation=!1,this._hasAggregationOnTopCount=0,this._hasAggregationOnBottomCount=0,this._cellRangeMap=new Map,this._showHeader=i,this._table=e,this._columns=[],this._columnsIncludeHided=[],this._headerCellIds=[],this.hierarchyIndent=r??20,this.hierarchyTextStartAlignment=e.options.hierarchyTextStartAlignment,this.columnTree=new hf(t,{seqId:0},null),this._headerObjectsIncludeHided=this._addHeaders(0,t,[]),this._headerObjects=this._headerObjectsIncludeHided.filter(o=>o.define.hide!==!0),this._headerObjectMap=this._headerObjects.reduce((o,s)=>(o[s.id]=s,o),{}),this.rowHierarchyType=qF(this)?"tree":"grid",this._hasAggregation=KF(this),this._hasAggregationOnBottomCount=XF(this),this._hasAggregationOnTopCount=YF(this),this.handleRowSeriesNumber(e.internalProps.rowSeriesNumber)}handleRowSeriesNumber(e){var t,i;e&&(Array.isArray(e)?this.rowSeriesNumberColumn=e.map((r,o)=>{var s,l,a;return{id:this.seqId++,title:r.title,define:re({field:"_vtable_rowSeries_number_"+o},r),cellType:(s=r.cellType)!==null&&s!==void 0?s:"text",headerType:(l=e.cellType)!==null&&l!==void 0?l:"text",style:r.style,width:r.width,format:r.format,field:(a=r.field)!==null&&a!==void 0?a:"_vtable_rowSeries_number_"+o,icon:r.icon,headerIcon:r.headerIcon,isChildNode:!1}}):this.rowSeriesNumberColumn=[{id:this.seqId++,title:e.title,define:re({field:"_vtable_rowSeries_number"},e),cellType:(t=e.cellType)!==null&&t!==void 0?t:"text",headerType:(i=e.cellType)!==null&&i!==void 0?i:"text",style:e.style,width:e.width,format:e.format,field:"_vtable_rowSeries_number",icon:e.icon,headerIcon:e.headerIcon,isChildNode:!1}],this.leftRowSeriesNumberColumn=this.rowSeriesNumberColumn.filter(r=>!0),this.rightRowSeriesNumberColumn=this.rowSeriesNumberColumn.filter(r=>!1),this.leftRowSeriesNumberColumnCount=this.leftRowSeriesNumberColumn.length,this.rightRowSeriesNumberColumnCount=this.rightRowSeriesNumberColumn.length)}get transpose(){return this._transpose}set transpose(e){this._transpose=e}get showHeader(){return this._showHeader}set showHeader(e){this._showHeader=e}isSeriesNumberInHeader(e,t){if(this.leftRowSeriesNumberColumnCount>0&&e>=0&&t>=0&&e<this.leftRowSeriesNumberColumnCount){if(this.transpose)return!1;if(t<this.headerLevelCount)return!0}if(this.rightRowSeriesNumberColumnCount>0&&t>=0&&e>=this.colCount-this.rightRowSeriesNumberColumnCount){if(this.transpose)return!1;if(t<this.headerLevelCount)return!0}return!1}isSeriesNumberInBody(e,t){return!!(this.leftRowSeriesNumberColumnCount>0&&e>=0&&e<this.leftRowSeriesNumberColumnCount&&(this.transpose||t>=this.headerLevelCount)||this.rightRowSeriesNumberColumnCount>0&&e>=this.colCount-this.rightRowSeriesNumberColumnCount&&(this.transpose||t>=this.headerLevelCount))}isSeriesNumber(e,t){return!!(O(e)&&O(t)&&(this.leftRowSeriesNumberColumnCount>0&&e>=0&&t>=0&&e<this.leftRowSeriesNumberColumnCount||this.rightRowSeriesNumberColumnCount>0&&t>=0&&e>=this.colCount-this.rightRowSeriesNumberColumnCount))}getSeriesNumberHeader(e,t){if(this.leftRowSeriesNumberColumnCount>0&&e>=0&&e<this.leftRowSeriesNumberColumnCount){if(this.transpose)return;if(t<this.headerLevelCount)return Object.assign({},this.leftRowSeriesNumberColumn[e],{style:Object.assign({},this._table.transpose?this._table.internalProps.theme.rowHeaderStyle:this._table.internalProps.theme.headerStyle,this._table.internalProps.rowSeriesNumber.headerStyle)})}if(this.rightRowSeriesNumberColumnCount>0&&e>=this.colCount-this.rightRowSeriesNumberColumnCount&&t<this.headerLevelCount){if(this.transpose)return;if(t<this.headerLevelCount)return this.rightRowSeriesNumberColumn[e-(this.colCount-this.rightRowSeriesNumberColumnCount)]}}getSeriesNumberBody(e,t){if(this.leftRowSeriesNumberColumnCount>0&&e>=0&&e<this.leftRowSeriesNumberColumnCount){if(this.transpose)return this.leftRowSeriesNumberColumn[e];if(t>=this.headerLevelCount)return this.leftRowSeriesNumberColumn[e]}if(this.rightRowSeriesNumberColumnCount>0&&e>=this.colCount-this.rightRowSeriesNumberColumnCount){if(this.transpose)return this.rightRowSeriesNumberColumn[e-(this.colCount-this.rightRowSeriesNumberColumnCount)];if(t>=this.headerLevelCount)return this.rightRowSeriesNumberColumn[e-(this.colCount-this.rightRowSeriesNumberColumnCount)]}}isHeader(e,t){return!!(this.transpose&&e>=this.leftRowSeriesNumberColumnCount&&e<this.headerLevelCount+this.leftRowSeriesNumberColumnCount)||!this.transpose&&t>=0&&t<this.headerLevelCount}isAggregation(e,t){if(this.hasAggregation){if(this.hasAggregationOnBottomCount){if(this.transpose){if(e>=this.colCount-this.hasAggregationOnBottomCount)return!0}else if(t>=this.rowCount-this.hasAggregationOnBottomCount)return!0}if(this.hasAggregationOnTopCount){if(this.transpose){if(e>=this.rowHeaderLevelCount&&e<this.rowHeaderLevelCount+this.hasAggregationOnTopCount)return!0}else if(t>=this.columnHeaderLevelCount&&t<this.columnHeaderLevelCount+this.hasAggregationOnTopCount)return!0}}return!1}isTopAggregation(e,t){if(this.hasAggregationOnTopCount){if(this.transpose){if(e>=this.rowHeaderLevelCount&&e<this.rowHeaderLevelCount+this.hasAggregationOnTopCount)return!0}else if(t>=this.columnHeaderLevelCount&&t<this.columnHeaderLevelCount+this.hasAggregationOnTopCount)return!0}return!1}isBottomAggregation(e,t){if(this.hasAggregationOnBottomCount){if(this.transpose){if(e>=this.colCount-this.hasAggregationOnBottomCount)return!0}else if(t>=this.rowCount-this.hasAggregationOnBottomCount)return!0}return!1}get hasAggregation(){return this._hasAggregation}get hasAggregationOnTopCount(){return this._hasAggregationOnTopCount}get hasAggregationOnBottomCount(){return this._hasAggregationOnBottomCount}getAggregatorsByCell(e,t){return this.getColumnDefine(e,t).vtable_aggregator}getAggregatorsByCellRange(e,t,i,r){let o=[];if(!this.transpose){for(let s=e;s<=i;s++){const l=this.getColumnDefine(s,t);l.vtable_aggregator&&(o=o.concat(Array.isArray(l.vtable_aggregator)?l.vtable_aggregator:[l.vtable_aggregator]))}return o}for(let s=t;s<=r;s++){const l=this.getColumnDefine(e,s);l.vtable_aggregator&&(o=o.concat(Array.isArray(l.vtable_aggregator)?l.vtable_aggregator:[l.vtable_aggregator]))}return[]}getAggregatorOnTop(e,t){const i=this.getColumnDefine(e,t),r=i.vtable_aggregator,o=i.aggregation;if(Array.isArray(o)){const s=o.reduce((l,a,d)=>(a.showOnTop&&l.push(d),l),[]).map(l=>r[l]);return this.transpose?s[e-this.rowHeaderLevelCount]:s[t-this.columnHeaderLevelCount]}return this.transpose&&e-this.rowHeaderLevelCount==0?o!=null&&o.showOnTop?r:null:this.transpose||t-this.columnHeaderLevelCount!=0?null:o!=null&&o.showOnTop?r:null}getAggregatorOnBottom(e,t){const i=this.getColumnDefine(e,t),r=i.vtable_aggregator,o=i.aggregation;if(Array.isArray(o)){const s=o.reduce((l,a,d)=>(a.showOnTop||l.push(d),l),[]).map(l=>r[l]);return this.transpose?s[e-(this.colCount-this.hasAggregationOnBottomCount)]:s[t-(this.rowCount-this.hasAggregationOnBottomCount)]}return this.transpose&&e-(this.colCount-this.hasAggregationOnBottomCount)==0?o!=null&&o.showOnTop?null:r:this.transpose||t-(this.rowCount-this.hasAggregationOnBottomCount)!=0||o!=null&&o.showOnTop?null:r}getAggregatorCellAddress(e,t,i,r){const o=[],s=this.hasAggregationOnTopCount,l=this.hasAggregationOnBottomCount;if(this.transpose){for(let a=t;a<=r;a++)if(this.getColumnDefine(e,a).vtable_aggregator){for(let d=0;d<s;d++)o.push({col:this.headerLevelCount+d,row:a});for(let d=0;d<l;d++)o.push({col:this.rowCount-l+d,row:a})}}else for(let a=e;a<=i;a++)if(this.getColumnDefine(a,t).vtable_aggregator){for(let d=0;d<s;d++)o.push({col:a,row:this.headerLevelCount+d});for(let d=0;d<l;d++)o.push({col:a,row:this.rowCount-l+d})}return o}getCellLocation(e,t){return this.isHeader(e,t)?this.transpose?"rowHeader":"columnHeader":"body"}isRowHeader(e,t){return!!(this.transpose&&e>=this.leftRowSeriesNumberColumnCount&&e<this.headerLevelCount+this.leftRowSeriesNumberColumnCount)}isColumnHeader(e,t){return!this.transpose&&t>=0&&t<=this.headerLevelCount-1&&e>=this.leftRowSeriesNumberColumnCount&&e<this.colCount-this.rightRowSeriesNumberColumnCount}isFrozenColumn(e,t){if(O(t)){if(e>=0&&e<this.frozenColCount&&t>=this.frozenRowCount&&t<this.rowCount-this.bottomFrozenRowCount)return!0}else if(this.frozenColCount>0&&e>=0&&e<this.frozenColCount)return!0;return!1}isRightFrozenColumn(e,t){if(O(t)){if(e>=this.colCount-this.rightFrozenColCount&&t>=this.frozenRowCount&&t<this.rowCount-this.bottomFrozenRowCount)return!0}else if(this.rightFrozenColCount>0&&e>=this.colCount-this.rightFrozenColCount)return!0;return!1}isFrozenRow(e,t){if(O(t)){if(t>=0&&t<this.frozenRowCount&&e>=this.frozenColCount&&e<this.colCount-this.rightFrozenColCount)return!0}else if(t=e,this.frozenRowCount>0&&t>=0&&t<this.frozenRowCount)return!0;return!1}isBottomFrozenRow(e,t){if(O(t)){if(t>=this.rowCount-this.bottomFrozenRowCount&&e>=this.frozenColCount&&e<this.colCount-this.rightFrozenColCount)return!0}else if(t=e,this.bottomFrozenRowCount>0&&t>=this.rowCount-this.bottomFrozenRowCount)return!0;return!1}isLeftTopCorner(e,t){return e>=0&&e<this.frozenColCount&&t>=0&&t<this.frozenRowCount}isLeftBottomCorner(e,t){return e>=0&&e<this.frozenColCount&&t>=this.rowCount-this.bottomFrozenRowCount}isRightTopCorner(e,t){return e>=this.colCount-this.rightFrozenColCount&&t>=0&&t<this.frozenRowCount}isRightBottomCorner(e,t){return e>=this.colCount-this.rightFrozenColCount&&t>=this.rowCount-this.bottomFrozenRowCount}isCornerHeader(e,t){return!1}getColumnHeaderRange(){var e,t;return this.transpose?{start:{col:0,row:0},end:{col:this._headerCellIds.length-1,row:((e=this.rowCount)!==null&&e!==void 0?e:0)-1}}:{start:{col:0,row:0},end:{col:((t=this.colCount)!==null&&t!==void 0?t:0)-1,row:this._headerCellIds.length-1}}}getRowHeaderRange(){var e,t;return this.transpose?{start:{col:0,row:0},end:{col:this._headerCellIds.length-1,row:((e=this.rowCount)!==null&&e!==void 0?e:0)-1}}:{start:{col:0,row:0},end:{col:((t=this.colCount)!==null&&t!==void 0?t:0)-1,row:this._headerCellIds.length-1}}}getCornerHeaderRange(){}getBodyRange(){var e,t,i,r;return this.transpose?{start:{col:this.headerLevelCount,row:0},end:{col:((e=this.colCount)!==null&&e!==void 0?e:0)-1,row:((t=this.rowCount)!==null&&t!==void 0?t:0)-1}}:{start:{col:0,row:this.headerLevelCount},end:{col:((i=this.colCount)!==null&&i!==void 0?i:0)-1,row:((r=this.rowCount)!==null&&r!==void 0?r:0)-1}}}get headerLevelCount(){return this.showHeader?this._headerCellIds.length:0}get columnHeaderLevelCount(){return this.transpose?0:this.headerLevelCount}get rowHeaderLevelCount(){return this.transpose?this.headerLevelCount:0}get frozenColCount(){return this._table.internalProps.frozenColCount?this.colCount>this._table.internalProps.frozenColCount?this._table.internalProps.frozenColCount:this.colCount:0}get frozenRowCount(){return this._table.internalProps.frozenRowCount?this.rowCount>=this._table.internalProps.frozenRowCount?this._table.internalProps.frozenRowCount:this.rowCount:0}get bottomFrozenRowCount(){return this._table.internalProps.bottomFrozenRowCount?this.rowCount-this.headerLevelCount>=this._table.internalProps.bottomFrozenRowCount?this._table.internalProps.bottomFrozenRowCount:this.rowCount-this.headerLevelCount:0}get rightFrozenColCount(){return this._table.internalProps.rightFrozenColCount?this.colCount-this.frozenColCount>=this._table.internalProps.rightFrozenColCount?this._table.internalProps.rightFrozenColCount:Math.max(0,this.colCount-this.frozenColCount):0}get colCount(){return this.transpose?this.headerLevelCount+this.recordsCount+this.leftRowSeriesNumberColumnCount+this.rightRowSeriesNumberColumnCount:this._columns.length+this.leftRowSeriesNumberColumnCount+this.rightRowSeriesNumberColumnCount}get rowCount(){return this.transpose?this._columns.length:this.headerLevelCount+this.recordsCount}get bodyRowCount(){return this.transpose?this._columns.length:this.rowCount-this.bottomFrozenRowCount-this.headerLevelCount}get bodyColCount(){return this.transpose?this.colCount-this.rightFrozenColCount-this.rowHeaderLevelCount:this._columns.length}get recordsCount(){return this._recordsCount}set recordsCount(e){this._recordsCount=e}get headerObjects(){return this._headerObjects}get columnObjects(){return this._columns}get headerObjectsIncludeHided(){return this._headerObjectsIncludeHided}get columnWidths(){if(this.leftRowSeriesNumberColumnCount){const e=this.leftRowSeriesNumberColumn.map(t=>({width:t.width,minWidth:t.minWidth,maxWidth:t.maxWidth}));return e.push(...this._columns.map(t=>({width:t.width,minWidth:t.minWidth,maxWidth:t.maxWidth}))),e}return this._columns.map(e=>({width:e.width,minWidth:e.minWidth,maxWidth:e.maxWidth}))}getColumnWidthDefined(e){var t;if(e>=0){if(e<this.leftRowSeriesNumberColumnCount)return this.leftRowSeriesNumberColumn[e];if(this.transpose){let i,r,o=0;if(e>=this.rowHeaderLevelCount+this.leftRowSeriesNumberColumnCount){let s;return this.columnObjects.forEach((l,a)=>{typeof l.width=="number"?o=Math.max(l.width,o):l.width==="auto"&&(s=!0),typeof l.minWidth=="number"&&(r=Math.max(l.minWidth,r)),typeof l.maxWidth=="number"&&(i=Math.max(l.maxWidth,i))}),o=o>0?o:s?"auto":void 0,{width:o,minWidth:r,maxWidth:i}}if(this.isRowHeader(e,0)){const s=Array.isArray(this._table.defaultHeaderColWidth)?(t=this._table.defaultHeaderColWidth[e])!==null&&t!==void 0?t:this._table.defaultColWidth:this._table.defaultHeaderColWidth;return s==="auto"?{width:"auto"}:{width:s}}}return this._columns[e-this.leftRowSeriesNumberColumnCount]}}getCellId(e,t){var i,r,o,s;return this.transpose?e>=this.headerLevelCount+this.leftRowSeriesNumberColumnCount?(i=this._columns[t])===null||i===void 0?void 0:i.id:this.isSeriesNumber(e,t)?t+"_series_number":(r=this._headerCellIds[e-this.leftRowSeriesNumberColumnCount])===null||r===void 0?void 0:r[t]:this.isSeriesNumber(e,t)?this.rowSeriesNumberColumn[e].id:this.headerLevelCount<=t?(o=this._columns[e-this.leftRowSeriesNumberColumnCount])===null||o===void 0?void 0:o.id:(s=this._headerCellIds[t])===null||s===void 0?void 0:s[e-this.leftRowSeriesNumberColumnCount]}getHeader(e,t){if(this.isSeriesNumberInHeader(e,t))return this.getSeriesNumberHeader(e,t);const i=this.getCellId(e,t);return this._headerObjectMap[i]}getHeaderField(e,t){var i,r,o;if(this.isSeriesNumberInHeader(e,t))return(i=this.getSeriesNumberHeader(e,t))===null||i===void 0?void 0:i.field;if(this.isSeriesNumberInBody(e,t))return(r=this.getSeriesNumberBody(e,t))===null||r===void 0?void 0:r.field;const s=this.getCellId(e,t);return((o=this._headerObjectMap[s])===null||o===void 0?void 0:o.field)||(this.transpose?this._columns[t]&&this._columns[t].field:this._columns[e-this.leftRowSeriesNumberColumnCount]&&this._columns[e-this.leftRowSeriesNumberColumnCount].field)}getHeaderCellAdressById(e){for(let t=0;t<this._headerCellIds.length;t++){const i=this._headerCellIds[t];for(let r=0;r<i.length;r++)if(i[r]===e)return this.transpose?{col:t,row:r}:{col:r+this.leftRowSeriesNumberColumnCount,row:t}}}getHeaderCellAddressByField(e){const t=this.headerObjects.find(i=>i&&i.field===e);return t&&this.getHeaderCellAdressById(t.id)}getBody(e,t){return this.isSeriesNumber(e,t)?this.getSeriesNumberBody(e,t):this.transpose?this._columns[t]:this._columns[e-this.leftRowSeriesNumberColumnCount]}getBodyLayoutRangeById(e){var t,i;if(this.transpose){for(let r=0;r<((t=this.rowCount)!==null&&t!==void 0?t:0);r++)if(e===this._columns[r].id)return{start:{col:0,row:r},end:{col:0,row:r}}}else for(let r=this.leftRowSeriesNumberColumnCount;r<((i=this.colCount)!==null&&i!==void 0?i:0);r++)if(e===this._columns[r-this.leftRowSeriesNumberColumnCount].id)return{start:{col:r,row:0},end:{col:r,row:0}};return{start:{col:-1,row:-1},end:{col:-1,row:-1}}}getCellRange(e,t){return Qz(e,t,this)}isCellRangeEqual(e,t,i,r){const o=this.getCellRange(e,t),s=this.getCellRange(i,r);return o.start.col===s.start.col&&o.end.col===s.end.col&&o.start.row===s.start.row&&o.end.row===s.end.row}getRecordShowIndexByCell(e,t){const i=this.hasAggregationOnTopCount?this.headerLevelCount+1:this.headerLevelCount;return this.transpose?e<i?-1:e-i:t<i?-1:t-i}getRecordStartRowByRecordIndex(e){return(this.hasAggregationOnTopCount?this.headerLevelCount+1:this.headerLevelCount)+e}_addHeaders(e,t,i,r){const o=[],s=this._newRow(e,r);return t.forEach(l=>{var a,d,u,h;const c=this._columns.length,g=this.seqId++,f={id:g,title:(a=l.title)!==null&&a!==void 0?a:l.caption,headerIcon:l.headerIcon,field:l.field,style:l.headerStyle,headerType:(d=l.headerType)!==null&&d!==void 0?d:"text",dropDownMenu:l.dropDownMenu,define:l,columnWidthComputeMode:l.columnWidthComputeMode};o[g]=f;for(let p=e-1;p>=0;p--)this._headerCellIds[p]&&(this._headerCellIds[p][c]=i[p]);if(r?this._headerCellIds[e-1]&&(s[c]=this._headerCellIds[e-1][c]):s[c]=g,l.columns)!l.columns.every(p=>p.hide)&&this._addHeaders(e+1,l.columns,[...i,g],l.hideColumnsSubHeader||r).forEach(p=>o.push(p));else{const p={id:this.seqId++,field:l.field,fieldFormat:l.fieldFormat,width:l.width,minWidth:l.minWidth,maxWidth:l.maxWidth,icon:l.icon,cellType:(h=(u=l.cellType)!==null&&u!==void 0?u:l.columnType)!==null&&h!==void 0?h:"text",chartModule:"chartModule"in l?l.chartModule:null,chartSpec:"chartSpec"in l?l.chartSpec:null,sparklineSpec:"sparklineSpec"in l?l.sparklineSpec:J2,style:l.style,define:l,columnWidthComputeMode:l.columnWidthComputeMode,disableColumnResize:l==null?void 0:l.disableColumnResize,aggregation:l.aggregation,isChildNode:e>=1};if(this._columnsIncludeHided.push(p),l.hide!==!0){this._columns.push(p);for(let m=e+1;m<this._headerCellIds.length;m++)this._headerCellIds[m][c]=g}}}),o}_newRow(e,t=!1){if(this._headerCellIds[e]){const o=this._headerCellIds[e-1];if(o.length>this._headerCellIds[e].length)for(let s=this._headerCellIds[e].length;s<o.length;s++)this._headerCellIds[e][s]=o[s];return this._headerCellIds[e]}if(t)return[];const i=this._headerCellIds[e]=[];if(!this._columns.length)return i;const r=this._headerCellIds[e-1];for(let o=0;o<r.length;o++)i[o]=r[o];return i}getCellHeaderPaths(e,t){if(this.isSeriesNumber(e,t))return;let i=[],r=[];return this.transpose?r=[{field:this._columns[t].field}]:i=[{field:this._columns[e-this.leftRowSeriesNumberColumnCount].field}],{colHeaderPaths:i,rowHeaderPaths:r,cellLocation:this.getCellLocation(e,t)}}getParentCellId(e,t){if(t!==0){if(this.isColumnHeader(e,t))return this.getCellId(e,t-1);if(this.isRowHeader(e,t))return this.isSeriesNumberInBody(e-1,t)?void 0:this.getCellId(e-1,t)}}canMoveHeaderPosition(e,t){if(this.isSeriesNumberInHeader(t.col,t.row)||this.isSeriesNumberInHeader(e.col,e.row))return!1;if(!this.transpose&&this.isSeriesNumberInBody(t.col,t.row)&&this.isSeriesNumberInBody(e.col,e.row)){const r=this.getRecordShowIndexByCell(0,e.row),o=this.getRecordShowIndexByCell(0,t.row);return this._table.dataSource.canChangeOrder(r,o)}if(this.transpose&&this.isSeriesNumberInBody(t.col,t.row)&&this.isSeriesNumberInBody(e.col,e.row)&&(this.getBody(e.col+this.leftRowSeriesNumberColumnCount,e.row).isChildNode&&this.getBody(t.col+this.leftRowSeriesNumberColumnCount,t.row).isChildNode?(e.col=e.col+this.leftRowSeriesNumberColumnCount+this.rowHeaderLevelCount-1,t.col=t.col+this.leftRowSeriesNumberColumnCount+this.rowHeaderLevelCount-1):(e.col=e.col+this.leftRowSeriesNumberColumnCount,t.col=t.col+this.leftRowSeriesNumberColumnCount)),e.col<0||e.row<0||t.col<0||t.row<0||this._table.internalProps.frozenColDragHeaderMode==="disabled"&&this._table.isFrozenColumn(t.col))return!1;const i=this.getCellRange(e.col,e.row);return this.isColumnHeader(e.col,e.row)?this.getParentCellId(e.col,i.start.row)===this.getParentCellId(t.col,i.start.row):this.isRowHeader(e.col,e.row)?this.getParentCellId(i.start.col,e.row)===this.getParentCellId(i.start.col,t.row):!1}moveHeaderPosition(e,t){var i,r;if((!((i=this._table.options.dragOrder)===null||i===void 0)&&i.validateDragOrderOnEnd(e,t)||!(!((r=this._table.options.dragOrder)===null||r===void 0)&&r.validateDragOrderOnEnd))&&this.canMoveHeaderPosition(e,t)){let o=this.getCellRange(e.col,e.row);if(this.isColumnHeader(e.col,e.row)){const s=o.end.col-o.start.col+1;let l;const a=this.getCellRange(t.col,o.start.row);if(l=t.col>=e.col?a.end.col-s+1:a.start.col,l===o.start.col)return null;for(let u=0;u<this._headerCellIds.length;u++){const h=this._headerCellIds[u].splice(o.start.col-this.leftRowSeriesNumberColumnCount,s);h.unshift(l-this.leftRowSeriesNumberColumnCount,0),Array.prototype.splice.apply(this._headerCellIds[u],h)}const d=this._columns.splice(o.start.col-this.leftRowSeriesNumberColumnCount,s);return d.unshift(l-this.leftRowSeriesNumberColumnCount,0),Array.prototype.splice.apply(this._columns,d),this.columnTree.movePosition(o.start.row,o.start.col-this.leftRowSeriesNumberColumnCount,l-this.leftRowSeriesNumberColumnCount),this.columnTree.reset(this.columnTree.tree.children),this._cellRangeMap=new Map,{sourceIndex:o.start.col,targetIndex:l,sourceSize:s,targetSize:a.end.col-a.start.col+1,moveType:"column"}}if(this.isRowHeader(e.col,e.row)||this.isSeriesNumberInBody(e.col,e.row)&&this.transpose){this.isSeriesNumberInBody(e.col,e.row)&&(o=this.getCellRange(e.col+this.leftRowSeriesNumberColumnCount,e.row));const s=o.end.row-o.start.row+1;let l;const a=this.getCellRange(o.start.col,t.row);if(l=t.row>=e.row?a.end.row-s+1:a.start.row,l===o.start.row)return null;for(let u=0;u<this._headerCellIds.length;u++){const h=this._headerCellIds[u].splice(o.start.row,s);h.unshift(l,0),Array.prototype.splice.apply(this._headerCellIds[u],h)}const d=this._columns.splice(o.start.row,s);return d.unshift(l,0),Array.prototype.splice.apply(this._columns,d),this.columnTree.movePosition(o.start.col-this.leftRowSeriesNumberColumnCount,o.start.row,l+(t.row>e.row?o.end.row-o.start.row:0)),this.columnTree.reset(this.columnTree.tree.children),this._cellRangeMap=new Map,{sourceIndex:o.start.row,targetIndex:l,sourceSize:s,targetSize:a.end.row-a.start.row+1,moveType:"row"}}if(this.isSeriesNumberInBody(e.col,e.row))return{sourceIndex:e.row,targetIndex:t.row,sourceSize:1,targetSize:1,moveType:"row"}}return null}toggleHierarchyState(e){return{addCellPositions:e.add.map(t=>({col:0,row:this._table.columnHeaderLevelCount+t})),removeCellPositions:e.remove.map(t=>({col:0,row:this._table.columnHeaderLevelCount+t}))}}setChartInstance(e,t,i){const r=this.transpose?this._columns[t]:this._columns[e-this.leftRowSeriesNumberColumnCount];typeof r.chartSpec!="function"&&(r.chartInstance=i)}getChartInstance(e,t){return(this.transpose?this._columns[t]:this._columns[e-this.leftRowSeriesNumberColumnCount]).chartInstance}checkHasChart(){return Jz(this)}getAxisConfigInPivotChart(e,t){}isEmpty(e,t){return!1}isAxisCell(e,t){return!1}getChartAxes(e,t){return[]}isShareChartSpec(e,t){const i=this.getBody(e,t);return typeof(i==null?void 0:i.chartSpec)!="function"}isNoChartDataRenderNothing(e,t){const i=this.getBody(e,t);return(i==null?void 0:i.define).noDataRenderNothing}getChartSpec(e,t){return this.getRawChartSpec(e,t)}getRawChartSpec(e,t){const i=this.getBody(e,t),r=i==null?void 0:i.chartSpec;return typeof r=="function"?r({col:e,row:t,dataValue:this._table.getCellOriginValue(e,t)||"",value:this._table.getCellValue(e,t)||"",rect:this._table.getCellRangeRelativeRect(this._table.getCellRange(e,t)),table:this._table}):r}getChartDataId(e,t){return Zz(e,t,this)}release(){const e=this._table._getActiveChartInstance();e==null||e.release(),this.columnObjects.forEach(t=>{var i;(i=t.chartInstance)===null||i===void 0||i.release()})}clearCellRangeMap(){this._cellRangeMap.clear()}updateColumnTitle(e,t,i){const r=this._table.internalProps.layoutMap.getHeader(e,t);r.title=i,r.define.title=i}getColumnByField(e){var t;return(t=this.columnObjects)===null||t===void 0?void 0:t.reduce((i,r,o)=>(r.field===e&&i.push({col:o,columnDefine:r}),i),[])}getColumnByKey(e){var t;let i;return{columnDefine:(t=this.columnObjects)===null||t===void 0?void 0:t.find((r,o)=>{var s;return((s=r.define)===null||s===void 0?void 0:s.key)===e&&(i=o,!0)}),col:i}}getColumnDefine(e,t){if(e>=0)return e<this.leftRowSeriesNumberColumnCount?this.leftRowSeriesNumberColumn[e].define:this.transpose?this._columns[t].define:this._columns[e-this.leftRowSeriesNumberColumnCount].define}}class iI{constructor(e){this.isValidatingValue=!1,this.listenersId=[],this.table=e,this.bindEvent()}bindEvent(){const e=this.table,t=e.on(j.DBLCLICK_CELL,r=>{var o;const{editCellTrigger:s="doubleclick"}=e.options;if(!s.includes("doubleclick"))return;const{col:l,row:a}=r,d=Ct(r.federatedEvent),u=e.scenegraph.getResizeColAt(d.abstractPos.x,d.abstractPos.y,(o=d.eventArgs)===null||o===void 0?void 0:o.targetCell);e._canResizeColumn(u.col,u.row)&&u.col>=0||this.startEditCell(l,a)}),i=e.on(j.CLICK_CELL,r=>{const{editCellTrigger:o="doubleclick"}=e.options;if(o==="click"||Array.isArray(o)&&o.includes("click")){const{col:s,row:l}=r;this.startEditCell(s,l)}});this.listenersId.push(t,i)}startEditCell(e,t,i){var r,o,s,l,a;if(this.editingEditor)return;const d=this.table.getEditor(e,t);if(d){if(!((o=(r=this.table.internalProps.layoutMap)===null||r===void 0?void 0:r.isAggregation)===null||o===void 0)&&o.call(r,e,t))return;this.editingEditor||(this.editCell={col:e,row:t}),this.table._makeVisibleCell(e,t),this.editingEditor=d;const u=O(i)?i:this.table.getCellOriginValue(e,t),h=this.table.getCellRangeRelativeRect(this.table.getCellRange(e,t)),c={rect:{left:h.left,top:h.top,width:h.width,height:h.height}};e===this.table.colCount-1&&(c.rect.width=h.width-1),t===this.table.rowCount-1&&(c.rect.height=h.height-1),d.beginEditing,(s=d.beginEditing)===null||s===void 0||s.call(d,this.table.getElement(),c,u),d.bindSuccessCallback,(l=d.bindSuccessCallback)===null||l===void 0||l.call(d,()=>{this.completeEdit()}),(a=d.onStart)===null||a===void 0||a.call(d,{value:u,endEdit:()=>{this.completeEdit()},referencePosition:c,container:this.table.getElement(),col:e,row:t,table:this.table})}}completeEdit(e){var t,i;if(!this.editingEditor)return!0;if(this.isValidatingValue)return!1;const r=e==null?void 0:e.target,{editingEditor:o}=this;if(r){if(o.targetIsOnEditor){if(o.targetIsOnEditor(r))return!1}else if(!o.isEditorElement||o.isEditorElement(r))return!1}if(this.editingEditor.getValue,this.editingEditor.validateValue){this.isValidatingValue=!0;const s=this.editingEditor.getValue(),l=this.table.getCellOriginValue(this.editCell.col,this.editCell.row),a=(i=(t=this.editingEditor).validateValue)===null||i===void 0?void 0:i.call(t,s,l,this.editCell,this.table);return Un(a)?(this.isValidatingValue=!0,new Promise((d,u)=>{a.then(h=>{g_(h,this,l,d)}).catch(h=>{this.isValidatingValue=!1,u(h)})})):g_(a,this,l)}return this.doExit(),!0}doExit(){var e,t,i,r,o,s;const l=(t=(e=this.editingEditor).getValue)===null||t===void 0?void 0:t.call(e),a=this.table.getCellRange(this.editCell.col,this.editCell.row),d=[];for(let u=a.start.row;u<=a.end.row;u++){const h=[];for(let c=a.start.col;c<=a.end.col;c++)h.push(l);d.push(h)}this.table.changeCellValues(a.start.col,a.start.row,d),this.editingEditor.exit,(r=(i=this.editingEditor).exit)===null||r===void 0||r.call(i),(s=(o=this.editingEditor).onEnd)===null||s===void 0||s.call(o),this.editingEditor=null,this.isValidatingValue=!1}cancelEdit(){var e,t,i,r;this.editingEditor&&((t=(e=this.editingEditor).exit)===null||t===void 0||t.call(e),(r=(i=this.editingEditor).onEnd)===null||r===void 0||r.call(i),this.editingEditor=null)}release(){this.listenersId.forEach(e=>{this.table.off(e)})}}function g_(n,e,t,i){return e.isValidatingValue=!1,n==="validate-exit"?(e.doExit(),i==null||i(!0),!0):n==="invalidate-exit"?(e.editingEditor.setValue(t),e.doExit(),i==null||i(!0),!0):n==="validate-not-exit"||n==="invalidate-not-exit"?(i==null||i(!1),!1):n===!0?(e.doExit(),i==null||i(!0),!0):(i==null||i(!1),!1)}function p_(n){return je(n)?{groupByRules:[n]}:ee(n)?{groupByRules:n.map(e=>je(e)?e:e.key)}:{}}function rI(n,e,t,i,r){if(i&&r.isHasEditorDefine(n,e)||i===!1){const o=r.getRecordShowIndexByCell(n,e),{field:s}=r.internalProps.layoutMap.getBody(n,e),l=r.getCellRawValue(n,e),a=r.getCellOriginValue(n,e);r.isHeader(n,e)?r.internalProps.layoutMap.updateColumnTitle(n,e,t):r.dataSource.changeFieldValue(t,o,s,n,e,r);const d=r.getCellRange(n,e),u=r.internalProps.layoutMap.getAggregatorsByCell(n,e);if(u){if(Array.isArray(u))for(let g=0;g<(u==null?void 0:u.length);g++)u[g].recalculate();else u.recalculate();const c=r.internalProps.layoutMap.getAggregatorCellAddress(d.start.col,d.start.row,d.end.col,d.end.row);for(let g=0;g<c.length;g++){const f=r.getCellRange(c[g].col,c[g].row);for(let p=f.start.col;p<=f.end.col;p++)for(let m=f.start.row;m<=f.end.row;m++)r.scenegraph.updateCellContent(p,m)}}for(let c=d.start.col;c<=d.end.col;c++)for(let g=d.start.row;g<=d.end.row;g++)r.scenegraph.updateCellContent(c,g);if(r.widthMode==="adaptive"||r.autoFillWidth&&r.getAllColsWidth()<=r.tableNoFrameWidth)r.internalProps._widthResizedColMap.size===0&&r.scenegraph.recalculateColWidths();else if(!r.internalProps._widthResizedColMap.has(n)){const c=r.getColWidth(n),g=Co(n,0,r.rowCount-1,r,!1);g!==c&&r.scenegraph.updateColWidth(n,g-c)}if(r.heightMode==="adaptive"||r.autoFillHeight&&r.getAllRowsHeight()<=r.tableNoFrameHeight)r.internalProps._heightResizedRowMap.size===0&&r.scenegraph.recalculateRowHeights();else if(r.isAutoRowHeight()&&!r.internalProps._heightResizedRowMap.has(e)){const c=r.getRowHeight(e),g=Sn(e,0,r.colCount-1,r);r.scenegraph.updateRowHeight(e,g-c)}const h=r.getCellOriginValue(n,e);a!==h&&r.fireListeners(j.CHANGE_CELL_VALUE,{col:n,row:e,rawValue:l,currentValue:a,changedValue:h}),r.scenegraph.updateNextFrame()}}function oI(n,e,t,i,r){var o,s;let l=n,a=e;const d=[],u=[];let h;for(let p=0;p<t.length&&!(e+p>r.rowCount-1);p++){const m=t[p],b=[],C=[];d.push(b),u.push(C);for(let _=0;_<m.length&&!(n+_>r.colCount-1);_++){h=sI(n+_,e+p,r,h);const w=r.getCellRawValue(n+_,e+p);b.push(w);const y=r.getCellOriginValue(n+_,e+p);C.push(y)}}for(let p=0;p<t.length&&!(e+p>r.rowCount-1);p++){a=e+p;const m=t[p];let b=n;for(let C=0;C<m.length&&!(n+C>r.colCount-1);C++){b=n+C;let _=!1;if(i===!1)_=!0;else if(r.isHasEditorDefine(n+C,e+p)){const w=r.getEditor(n+C,e+p),y=u[p][C],v=m[C],x=(s=(o=w==null?void 0:w.validateValue)===null||o===void 0?void 0:o.call(w,v,y))===null||s===void 0||s;_=!!Un(x)||x===!0||x==="validate-exit"||x==="invalidate-exit"}if(_){const w=m[C],y=r.getRecordShowIndexByCell(n+C,e+p),{field:v}=r.internalProps.layoutMap.getBody(n+C,e+p),x=d[p][C],S=u[p][C];r.isHeader(n+C,e+p)?r.internalProps.layoutMap.updateColumnTitle(n+C,e+p,w):r.dataSource.changeFieldValue(w,y,v,n+C,e+p,r);const R=r.getCellOriginValue(n+C,e+p);S!==R&&r.fireListeners(j.CHANGE_CELL_VALUE,{col:n+C,row:e+p,rawValue:x,currentValue:S,changedValue:R})}}l=Math.max(l,b)}const c=r.getCellRange(n,e),g=r.getCellRange(l,a),f=r.internalProps.layoutMap.getAggregatorsByCellRange(c.start.col,c.start.row,g.end.col,g.end.row);if(f){for(let p=0;p<(f==null?void 0:f.length);p++)f[p].recalculate();if(h==="normal"){const p=r.internalProps.layoutMap.getAggregatorCellAddress(c.start.col,c.start.row,g.end.col,g.end.row);for(let m=0;m<p.length;m++){const b=r.getCellRange(p[m].col,p[m].row);for(let C=b.start.col;C<=b.end.col;C++)for(let _=b.start.row;_<=b.end.row;_++)r.scenegraph.updateCellContent(C,_)}}}if(h==="group"&&r.dataSource.updateRecordsForGroup([],[]),h==="sort"||h==="group")return r.dataSource.sortedIndexMap.clear(),Qt(r),r.refreshRowColCount(),r.internalProps.layoutMap.clearCellRangeMap(),r.scenegraph.clearCells(),void r.scenegraph.createSceneGraph();for(let p=c.start.col;p<=g.end.col;p++)for(let m=c.start.row;m<=g.end.row;m++)r.scenegraph.updateCellContent(p,m);if(r.widthMode==="adaptive"||r.autoFillWidth&&r.getAllColsWidth()<=r.tableNoFrameWidth)r.internalProps._widthResizedColMap.size===0&&r.scenegraph.recalculateColWidths();else for(let p=n;p<=g.end.col;p++)if(!r.internalProps._widthResizedColMap.has(p)){const m=r.getColWidth(p),b=Co(p,0,r.rowCount-1,r,!1);b!==m&&r.scenegraph.updateColWidth(p,b-m)}if(r.heightMode==="adaptive"||r.autoFillHeight&&r.getAllRowsHeight()<=r.tableNoFrameHeight)r.scenegraph.recalculateRowHeights();else if(r.isAutoRowHeight()){const p=[],m=[];for(let b=e;b<=g.end.row;b++)if(r.rowHeightsMap.get(b)){const C=r.getRowHeight(b),_=Sn(b,0,r.colCount-1,r);p.push(b),m.push(_-C)}r.scenegraph.updateRowsHeight(p,m)}r.scenegraph.updateNextFrame()}function sI(n,e,t,i){if(i==="group"||i==="sort"&&!t.options.groupBy)return i;let r="normal";return t.options.groupBy?r="group":!t.isHeader(n,e)&&t.dataSource.lastOrderField&&t.getBodyField(n,e)===t.dataSource.lastOrderField&&(r="sort"),r}function Qt(n){let e=n.sortState;e=!e||Array.isArray(e)?e:[e],e&&(e=e.map(t=>{var i;return t.orderFn=(i=n._getSortFuncFromHeaderOption(void 0,t.field))!==null&&i!==void 0?i:ad,t}),n.dataSource.sort(e))}function lI(n,e,t){var i,r,o,s;if(t.options.groupBy)(r=(i=t.dataSource).addRecordsForGroup)===null||r===void 0||r.call(i,[n],e),t.refreshRowColCount(),t.internalProps.layoutMap.clearCellRangeMap(),t.sortState&&Qt(t),t.scenegraph.clearCells(),t.scenegraph.createSceneGraph();else if(t.dataSource.rowHierarchyType==="tree")(s=(o=t.dataSource).addRecordsForTree)===null||s===void 0||s.call(o,[n],e),t.refreshRowColCount(),t.internalProps.layoutMap.clearCellRangeMap(),t.sortState&&Qt(t),t.scenegraph.clearCells(),t.scenegraph.createSceneGraph();else if(t.sortState)t.dataSource.addRecordForSorted(n),Qt(t),t.refreshRowColCount(),t.scenegraph.clearCells(),t.scenegraph.createSceneGraph();else{(e===void 0||e>t.dataSource.sourceLength)&&(e=t.dataSource.sourceLength);const l=t.transpose?t.rowHeaderLevelCount:t.columnHeaderLevelCount;t.dataSource.addRecord(n,e);const a=t.rowCount;if(t.refreshRowColCount(),t.scenegraph.proxy.totalActualBodyRowCount===0)return t.scenegraph.clearCells(),void t.scenegraph.createSceneGraph();const d=t.transpose?t.colCount:t.rowCount;if(t.pagination){const{perPageCount:u,currentPage:h}=t.pagination,c=u*(h||0)+u;if(e<c)if(e<c-u)t.scenegraph.clearCells(),t.scenegraph.createSceneGraph();else{const g=e-(c-u)+l;if(a-l===t.pagination.perPageCount){const f=[];for(let p=g;p<d;p++)t.transpose?f.push({col:p,row:0}):f.push({col:0,row:p});t.transpose?t.scenegraph.updateCol([],[],f):t.scenegraph.updateRow([],[],f)}else{const f=[];for(let p=g;p<Math.min(d,g+1);p++)t.transpose?f.push({col:p,row:0}):f.push({col:0,row:p});t.transpose?t.scenegraph.updateCol([],f,[]):t.scenegraph.updateRow([],f,[])}}}else{const u=[];for(let f=e+l;f<e+l+1;f++)t.transpose?u.push({col:f,row:0}):u.push({col:0,row:f});const h=[],c=t.internalProps.layoutMap.hasAggregationOnTopCount,g=t.internalProps.layoutMap.hasAggregationOnBottomCount;for(let f=l;f<l+c;f++)t.transpose?h.push({col:f,row:0}):h.push({col:0,row:f});for(let f=(t.transpose?t.colCount:t.rowCount)-g;f<(t.transpose?t.colCount:t.rowCount);f++)t.transpose?h.push({col:f,row:0}):h.push({col:0,row:f});t.transpose?t.scenegraph.updateCol([],u,[]):t.scenegraph.updateRow([],u,[])}}}function aI(n,e,t){var i,r,o,s;if(t.options.groupBy)(r=(i=t.dataSource).addRecordsForGroup)===null||r===void 0||r.call(i,n,e),t.refreshRowColCount(),t.internalProps.layoutMap.clearCellRangeMap(),t.sortState&&Qt(t),t.scenegraph.clearCells(),t.scenegraph.createSceneGraph();else if(t.dataSource.rowHierarchyType==="tree")(s=(o=t.dataSource).addRecordsForTree)===null||s===void 0||s.call(o,n,e),t.refreshRowColCount(),t.internalProps.layoutMap.clearCellRangeMap(),t.sortState&&Qt(t),t.scenegraph.clearCells(),t.scenegraph.createSceneGraph();else if(t.sortState)t.dataSource.addRecordsForSorted(n),Qt(t),t.refreshRowColCount(),t.scenegraph.clearCells(),t.scenegraph.createSceneGraph();else{e===void 0||e>t.dataSource.sourceLength?e=t.dataSource.sourceLength:e<0&&(e=0);const l=t.transpose?t.rowHeaderLevelCount:t.columnHeaderLevelCount;t.dataSource.addRecords(n,e);const a=t.transpose?t.colCount:t.rowCount;if(t.refreshRowColCount(),t.scenegraph.proxy.totalActualBodyRowCount===0)return t.scenegraph.clearCells(),void t.scenegraph.createSceneGraph();const d=t.transpose?t.colCount:t.rowCount;if(t.pagination){const{perPageCount:u,currentPage:h}=t.pagination,c=u*(h||0)+u;if(e<c)if(e<c-u)t.scenegraph.clearCells(),t.scenegraph.createSceneGraph();else{const g=e-(c-u)+l;if(a-l===t.pagination.perPageCount){const f=[];for(let p=g;p<d;p++)t.transpose?f.push({col:p,row:0}):f.push({col:0,row:p});t.transpose?t.scenegraph.updateCol([],[],f):t.scenegraph.updateRow([],[],f)}else{const f=[];for(let p=g;p<Math.min(d,g+(Array.isArray(n)?n.length:1));p++)t.transpose?f.push({col:p,row:0}):f.push({col:0,row:p});t.transpose?t.scenegraph.updateCol([],f,[]):t.scenegraph.updateRow([],f,[])}}}else{const u=[];for(let f=e+l;f<e+l+(Array.isArray(n)?n.length:1);f++)t.transpose?u.push({col:f,row:0}):u.push({col:0,row:f});const h=t.internalProps.layoutMap.hasAggregationOnTopCount,c=t.internalProps.layoutMap.hasAggregationOnBottomCount,g=[];for(let f=l;f<l+h;f++)t.transpose?g.push({col:f,row:0}):g.push({col:0,row:f});for(let f=(t.transpose?t.colCount:t.rowCount)-c;f<(t.transpose?t.colCount:t.rowCount);f++)t.transpose?g.push({col:f,row:0}):g.push({col:0,row:f});t.transpose?t.scenegraph.updateCol([],u,g):t.scenegraph.updateRow([],u,g)}}}function dI(n,e){var t,i,r,o,s,l,a,d;if((n==null?void 0:n.length)>0)if(e.options.groupBy)(i=(t=e.dataSource).deleteRecordsForGroup)===null||i===void 0||i.call(t,n),e.refreshRowColCount(),e.internalProps.layoutMap.clearCellRangeMap(),e.sortState&&Qt(e),e.scenegraph.clearCells(),e.scenegraph.createSceneGraph();else if(e.dataSource.rowHierarchyType==="tree")(o=(r=e.dataSource).deleteRecordsForTree)===null||o===void 0||o.call(r,n),e.refreshRowColCount(),e.internalProps.layoutMap.clearCellRangeMap(),e.sortState&&Qt(e),e.scenegraph.clearCells(),e.scenegraph.createSceneGraph();else if(e.sortState)e.dataSource.deleteRecordsForSorted(n),Qt(e),e.refreshRowColCount(),e.scenegraph.clearCells(),e.scenegraph.createSceneGraph();else{const u=e.dataSource.deleteRecords(n);if(u.length===0)return;const h=e.transpose?e.colCount:e.rowCount;e.refreshRowColCount();const c=e.transpose?e.colCount:e.rowCount,g=u.sort((p,m)=>p-m),f=g[0];if(e.pagination){const{perPageCount:p,currentPage:m}=e.pagination,b=p*(m||0)+p;if(f<b)if(f<b-p)e.scenegraph.clearCells(),e.scenegraph.createSceneGraph();else{const C=e.transpose?e.rowHeaderLevelCount:e.columnHeaderLevelCount,_=e.internalProps.layoutMap.hasAggregationOnTopCount,w=[],y=[];for(let v=f-(b-p)+(e.transpose?e.rowHeaderLevelCount:e.columnHeaderLevelCount)+_;v<c;v++)e.transpose?w.push({col:v,row:0}):w.push({col:0,row:v});for(let v=C;v<C+_;v++)e.transpose?w.push({col:v,row:0}):w.push({col:0,row:v});if(c<h)for(let v=c;v<h;v++)e.transpose?y.push({col:v,row:0}):y.push({col:0,row:v});(s=e.reactCustomLayout)===null||s===void 0||s.clearCache(),e.transpose?e.scenegraph.updateCol(y,[],w):e.scenegraph.updateRow(y,[],w),(l=e.reactCustomLayout)===null||l===void 0||l.updateAllCustomCell()}}else{const p=[],m=e.transpose?e.rowHeaderLevelCount:e.columnHeaderLevelCount,b=e.internalProps.layoutMap.hasAggregationOnTopCount,C=e.internalProps.layoutMap.hasAggregationOnBottomCount;for(let w=0;w<g.length;w++){const y=g[w]+m+b;e.transpose?p.push({col:y,row:0}):p.push({col:0,row:y})}const _=[];for(let w=m;w<m+b;w++)e.transpose?_.push({col:w,row:0}):_.push({col:0,row:w});for(let w=(e.transpose?e.colCount:e.rowCount)-C;w<(e.transpose?e.colCount:e.rowCount);w++)e.transpose?_.push({col:w,row:0}):_.push({col:0,row:w});(a=e.reactCustomLayout)===null||a===void 0||a.clearCache(),e.transpose?e.scenegraph.updateCol(p,[],_):e.scenegraph.updateRow(p,[],_),(d=e.reactCustomLayout)===null||d===void 0||d.updateAllCustomCell()}}}function uI(n,e,t){var i,r,o,s;if((e==null?void 0:e.length)>0)if(t.options.groupBy)(r=(i=t.dataSource).updateRecordsForGroup)===null||r===void 0||r.call(i,n,e),t.refreshRowColCount(),t.internalProps.layoutMap.clearCellRangeMap(),t.sortState&&Qt(t),t.scenegraph.clearCells(),t.scenegraph.createSceneGraph();else if(t.dataSource.rowHierarchyType==="tree")(s=(o=t.dataSource).updateRecordsForTree)===null||s===void 0||s.call(o,n,e),t.refreshRowColCount(),t.internalProps.layoutMap.clearCellRangeMap(),t.sortState&&Qt(t),t.scenegraph.clearCells(),t.scenegraph.createSceneGraph();else if(t.sortState)t.dataSource.updateRecordsForSorted(n,e),Qt(t),t.refreshRowColCount(),t.scenegraph.clearCells(),t.scenegraph.createSceneGraph();else{const l=t.dataSource.updateRecords(n,e);if(l.length===0)return;const a=l.map(d=>t.getBodyRowIndexByRecordIndex(d)).sort((d,u)=>d-u);if(t.pagination){const{perPageCount:d,currentPage:u}=t.pagination,h=t.transpose?t.rowHeaderLevelCount:t.columnHeaderLevelCount,c=t.internalProps.layoutMap.hasAggregationOnTopCount,g=d*(u||0)+d,f=[];for(let p=0;p<a.length;p++){const m=a[p];if(m<g&&m>=g-d){const b=m-(g-d)+(t.transpose?t.rowHeaderLevelCount:t.columnHeaderLevelCount)+c;f.push(b)}}if(f.length>=1){const p=[];for(let m=0;m<f.length;m++){const b=f[m];t.transpose?p.push({col:b,row:0}):p.push({col:0,row:b})}for(let m=h;m<h+c;m++)t.transpose?p.push({col:m,row:0}):p.push({col:0,row:m});t.transpose?t.scenegraph.updateCol([],[],p):t.scenegraph.updateRow([],[],p)}}else{const d=[],u=t.transpose?t.rowHeaderLevelCount:t.columnHeaderLevelCount,h=t.internalProps.layoutMap.hasAggregationOnTopCount,c=t.internalProps.layoutMap.hasAggregationOnBottomCount;for(let g=0;g<a.length;g++){const f=a[g]+u+h;t.transpose?d.push({col:f,row:0}):d.push({col:0,row:f})}for(let g=u;g<u+h;g++)t.transpose?d.push({col:g,row:0}):d.push({col:0,row:g});for(let g=(t.transpose?t.colCount:t.rowCount)-c;g<(t.transpose?t.colCount:t.rowCount);g++)t.transpose?d.push({col:g,row:0}):d.push({col:0,row:g});t.transpose?t.scenegraph.updateCol([],[],d):t.scenegraph.updateRow([],[],d)}}}function hI(n,e,t,i){const r=[{col:e,row:t}],o=[],s=[],{addCellPositions:l,removeCellPositions:a}=n,d=i.scenegraph.proxy,{rowStart:u,rowLimit:h}=d;let{rowEnd:c}=d,g=1/0;for(let m=0;m<l.length;m++){const{row:b}=l[m];c-u+1===h?b>=u&&b<=c&&(g=Math.min(g,b)):(o.push({col:e,row:b}),c++)}const f=Math.min(u+h,i.rowCount-1-i.bottomFrozenRowCount),p=f<u+h;for(let m=0;m<a.length;m++){const{row:b}=a[a.length-m-1];b<u||b>c||(b>f||p?(s.push({col:e,row:b}),g--):g=Math.min(g,b))}if(g!==1/0)for(let m=g;m<=c;m++)r.push({col:e,row:m});return i.scenegraph.proxy.refreshRowCount(),{updateCells:r,addCells:o,removeCells:s}}class cI extends bz{constructor(e,t){var i,r,o,s,l,a,d,u;Me.mode==="node"?(t=e,e=null):e instanceof HTMLElement||(t=e,e=e.container?e.container:null),super(e,t),this.showHeader=!0;const h=this.internalProps;if(h.frozenColDragHeaderMode=(r=(i=t.dragOrder)===null||i===void 0?void 0:i.frozenColDragHeaderMode)!==null&&r!==void 0?r:t.frozenColDragHeaderMode,this.pagination=t.pagination,h.sortState=t.sortState,h.multipleSort=!!t.multipleSort,h.dataConfig=t.groupBy?p_(t.groupBy):{},h.columns=t.columns?br(t.columns,["children"]):t.header?br(t.header,["children"]):[],Vl(this),h.enableTreeNodeMerge=(s=(o=t.enableTreeNodeMerge)!==null&&o!==void 0?o:O(t.groupBy))!==null&&s!==void 0&&s,this.internalProps.headerHelper.setTableColumnsEditor(),this.showHeader=(l=t.showHeader)===null||l===void 0||l,this.internalProps.columnWidthConfig=t.columnWidthConfig,this.transpose=(a=t.transpose)!==null&&a!==void 0&&a,Me.mode!=="node"&&(this.editorManager=new iI(this)),this.refreshHeader(),this.internalProps.useOneRowHeightFillAll=!1,t.dataSource?this.dataSource=t.dataSource:t.records?this.setRecords(t.records,{sortState:h.sortState}):this.setRecords([]),t.title){const c=ue.getComponent("title");h.title=new c(t.title,this),this.scenegraph.resize()}if(this.options.emptyTip)if(this.internalProps.emptyTip)(d=this.internalProps.emptyTip)===null||d===void 0||d.resetVisible();else{const c=ue.getComponent("emptyTip");this.internalProps.emptyTip=new c(this.options.emptyTip,this),(u=this.internalProps.emptyTip)===null||u===void 0||u.resetVisible()}if(t.enableTreeStickCell){const c=ue.getComponent("listTreeStickCellPlugin");this.listTreeStickCellPlugin=new c(this)}setTimeout(()=>{this.fireListeners(j.INITIALIZED,null)},0)}isListTable(){return!0}isPivotTable(){return!1}isPivotChart(){return!1}get sortState(){return this.internalProps.sortState}get records(){var e;return(e=this.dataSource)===null||e===void 0?void 0:e.records}get recordsCount(){return this.dataSource.records.length}updateColumns(e){var t,i,r,o;const s={col:this.stateManager.hover.cellPos.col,row:this.stateManager.hover.cellPos.row};this.internalProps.columns=br(e,["children"]),Vl(this),this.options.columns=e,this.internalProps.headerHelper.setTableColumnsEditor(),this._hasAutoImageColumn=void 0,this.refreshHeader(),(i=(t=this.dataSource).updateColumns)===null||i===void 0||i.call(t,this.internalProps.columns),this.records&&GH(e)&&this.dataSource.processRecords((o=(r=this.dataSource.dataSourceObj)===null||r===void 0?void 0:r.records)!==null&&o!==void 0?o:this.dataSource.dataSourceObj),this.internalProps.useOneRowHeightFillAll=!1,this.scenegraph.clearCells(),this.headerStyleCache=new Map,this.bodyStyleCache=new Map,this.bodyBottomStyleCache=new Map,this.scenegraph.createSceneGraph(),this.stateManager.updateHoverPos(s.col,s.row),this.renderAsync(),this.eventManager.updateEventBinder()}get columns(){return this.internalProps.layoutMap.columnTree.getCopiedTree()}get header(){return this.internalProps.columns}set header(e){this.internalProps.columns=e,Vl(this),this.options.header=e,this.refreshHeader(),this.internalProps.useOneRowHeightFillAll=!1,this.renderAsync()}get transpose(){var e;return(e=this.internalProps.transpose)!==null&&e!==void 0&&e}set transpose(e){this.internalProps.transpose!==e&&(this.internalProps.transpose=e,this.internalProps.layoutMap&&(this.internalProps.layoutMap.transpose=e,this.refreshRowColCount(),this._resetFrozenColCount(),this.renderAsync()))}getCellValue(e,t,i){if(e===-1||t===-1)return null;if(!i){const l=this.getCustomMergeValue(e,t);if(l)return l}const r=this;if(r.internalProps.layoutMap.isSeriesNumber(e,t)){if(r.internalProps.layoutMap.isSeriesNumberInHeader(e,t)){const{title:d}=r.internalProps.layoutMap.getSeriesNumberHeader(e,t);return d}let l;if(this.options.groupBy){const d=r.getCellRawRecord(e,t);if(d!=null&&d.vtableMerge)return"";l=this.dataSource.getGroupSeriesNumber(t-this.columnHeaderLevelCount)}else l=t-this.columnHeaderLevelCount+1;const{format:a}=r.internalProps.layoutMap.getSeriesNumberBody(e,t);return typeof a=="function"?a(e,t,this,l):l}if(r.internalProps.layoutMap.isHeader(e,t)){const{title:l}=r.internalProps.layoutMap.getHeader(e,t);return typeof l=="function"?l():l}if(r.internalProps.layoutMap.isAggregation(e,t)){if(r.internalProps.layoutMap.isTopAggregation(e,t)){const l=r.internalProps.layoutMap.getAggregatorOnTop(e,t);return l!=null&&l.formatValue?l.formatValue(e,t,this):""}if(r.internalProps.layoutMap.isBottomAggregation(e,t)){const l=r.internalProps.layoutMap.getAggregatorOnBottom(e,t);return l!=null&&l.formatValue?l.formatValue(e,t,this):""}}const{field:o,fieldFormat:s}=r.internalProps.layoutMap.getBody(e,t);return r.getFieldData(s||o,e,t)}getCellOriginValue(e,t){if(e===-1||t===-1)return null;const i=this;if(i.internalProps.layoutMap.isSeriesNumber(e,t)){if(i.internalProps.layoutMap.isSeriesNumberInHeader(e,t)){const{title:s}=i.internalProps.layoutMap.getSeriesNumberHeader(e,t);return s}const{format:o}=i.internalProps.layoutMap.getSeriesNumberBody(e,t);return typeof o=="function"?o(e,t,this):t-this.columnHeaderLevelCount}if(i.internalProps.layoutMap.isHeader(e,t)){const{title:o}=i.internalProps.layoutMap.getHeader(e,t);return typeof o=="function"?o():o}if(i.internalProps.layoutMap.isAggregation(e,t)){if(i.internalProps.layoutMap.isTopAggregation(e,t)){const o=i.internalProps.layoutMap.getAggregatorOnTop(e,t);return o==null?void 0:o.value()}if(i.internalProps.layoutMap.isBottomAggregation(e,t)){const o=i.internalProps.layoutMap.getAggregatorOnBottom(e,t);return o==null?void 0:o.value()}}const{field:r}=i.internalProps.layoutMap.getBody(e,t);return i.getFieldData(r,e,t)}getCellRawValue(e,t){if(e===-1||t===-1)return null;const i=this;if(i.internalProps.layoutMap.isHeader(e,t)){const{title:o}=i.internalProps.layoutMap.getHeader(e,t);return typeof o=="function"?o():o}const{field:r}=i.internalProps.layoutMap.getBody(e,t);return i.getRawFieldData(r,e,t)}getRecordShowIndexByCell(e,t){const{layoutMap:i}=this.internalProps;return i.getRecordShowIndexByCell(e,t)}getRecordIndexByCell(e,t){const{layoutMap:i}=this.internalProps,r=i.getRecordShowIndexByCell(e,t);return this.dataSource.getRecordIndexPaths(r)}getTableIndexByRecordIndex(e){return this.transpose?this.dataSource.getTableIndex(e)+this.rowHeaderLevelCount:this.dataSource.getTableIndex(e)+this.columnHeaderLevelCount}getTableIndexByField(e){const t=this.internalProps.layoutMap.columnObjects.find(r=>r.field===e);if(!t)return-1;const i=this.internalProps.layoutMap.getBodyLayoutRangeById(t.id);return this.transpose?i.start.row:i.start.col}getCellAddrByFieldRecord(e,t){return this.transpose?{col:this.getTableIndexByRecordIndex(t),row:this.getTableIndexByField(e)}:{col:this.getTableIndexByField(e),row:this.getTableIndexByRecordIndex(t)}}getCellOriginRecord(e,t){const i=this,r=i.getRecordShowIndexByCell(e,t);if(r>-1)return i.dataSource.get(r)}getCellRawRecord(e,t){const i=this,r=i.getRecordShowIndexByCell(e,t);if(r>-1)return i.dataSource.getRaw(r)}_canResizeColumn(e,t){const i=super._canResizeColumn(e,t);if(i&&!this.transpose){const r=this.internalProps.layoutMap.getBody(e,this.columnHeaderLevelCount),o=this.internalProps.layoutMap.isSeriesNumber(e,t);if(r!=null&&r.disableColumnResize||o&&this.internalProps.rowSeriesNumber.disableColumnResize===!0)return!1}return i}updateOption(e){var t,i,r,o,s,l,a,d;const u=this.internalProps;if(super.updateOption(e),u.frozenColDragHeaderMode=(i=(t=e.dragOrder)===null||t===void 0?void 0:t.frozenColDragHeaderMode)!==null&&i!==void 0?i:e.frozenColDragHeaderMode,this.pagination=e.pagination,u.sortState=e.sortState,u.dataConfig=e.groupBy?p_(e.groupBy):{},this.showHeader=(r=e.showHeader)===null||r===void 0||r,u.columns=e.columns?br(e.columns,["children"]):e.header?br(e.header,["children"]):[],Vl(this),u.enableTreeNodeMerge=(s=(o=e.enableTreeNodeMerge)!==null&&o!==void 0?o:O(e.groupBy))!==null&&s!==void 0&&s,this.internalProps.headerHelper.setTableColumnsEditor(),this.transpose=(l=e.transpose)!==null&&l!==void 0&&l,this.refreshHeader(),this.internalProps.useOneRowHeightFillAll=!1,this.internalProps.columnWidthConfig=e.columnWidthConfig,u.releaseList&&(u.releaseList.forEach(h=>{var c;return(c=h==null?void 0:h.release)===null||c===void 0?void 0:c.call(h)}),u.releaseList=null),e.dataSource?this.dataSource=e.dataSource:e.records?this.setRecords(e.records,{sortState:e.sortState}):(this._resetFrozenColCount(),this.scenegraph.createSceneGraph(),this.render()),e.title){const h=ue.getComponent("title");u.title=new h(e.title,this),this.scenegraph.resize()}if(this.options.emptyTip)if(this.internalProps.emptyTip)(a=this.internalProps.emptyTip)===null||a===void 0||a.resetVisible();else{const h=ue.getComponent("emptyTip");this.internalProps.emptyTip=new h(this.options.emptyTip,this),(d=this.internalProps.emptyTip)===null||d===void 0||d.resetVisible()}return new Promise(h=>{setTimeout(h,0)})}updatePagination(e){this.pagination&&(typeof e.currentPage=="number"&&e.currentPage>=0&&(this.pagination.currentPage=e.currentPage),e.perPageCount&&(this.pagination.perPageCount=e.perPageCount||this.pagination.perPageCount),this.internalProps.layoutMap.clearCellRangeMap(),this.internalProps.useOneRowHeightFillAll=!1,this.scenegraph.clearCells(),this.dataSource.updatePagination(this.pagination),this.refreshRowColCount(),this.stateManager.initCheckedState(this.records),this.scenegraph.createSceneGraph(),this.renderAsync())}refreshHeader(){var e;const t=this.internalProps,i=this.transpose,r=this.showHeader;(t.layoutMap=new nI(this,(e=t.columns)!==null&&e!==void 0?e:[],r,this.options.hierarchyIndent)).transpose=i,i||this.setMinMaxLimitWidth(!0),this.refreshRowColCount()}refreshRowColCount(){var e,t,i,r,o,s,l,a,d,u,h,c,g,f,p,m,b,C;const _=this,{layoutMap:w}=_.internalProps;if(!w)return;const y=(t=(e=_.internalProps.dataSource)===null||e===void 0?void 0:e.length)!==null&&t!==void 0?t:0;w.recordsCount=y+(y>0?w.hasAggregationOnTopCount+w.hasAggregationOnBottomCount:0),_.transpose?(_.rowCount=(i=w.rowCount)!==null&&i!==void 0?i:0,_.colCount=(r=w.colCount)!==null&&r!==void 0?r:0,this.internalProps.frozenColCount=Math.max(((o=w.headerLevelCount)!==null&&o!==void 0?o:0)+w.leftRowSeriesNumberColumnCount,(s=this.options.frozenColCount)!==null&&s!==void 0?s:0),this.internalProps.frozenRowCount=(l=this.options.frozenRowCount)!==null&&l!==void 0?l:0,_.bottomFrozenRowCount!==((a=this.options.bottomFrozenRowCount)!==null&&a!==void 0?a:0)&&(_.bottomFrozenRowCount=(d=this.options.bottomFrozenRowCount)!==null&&d!==void 0?d:0),_.rightFrozenColCount!==((u=this.options.rightFrozenColCount)!==null&&u!==void 0?u:0)&&(_.rightFrozenColCount=(h=this.options.rightFrozenColCount)!==null&&h!==void 0?h:0)):(_.colCount=(c=w.colCount)!==null&&c!==void 0?c:0,_.rowCount=w.recordsCount*w.bodyRowSpanCount+w.headerLevelCount,this.internalProps.frozenColCount=(g=this.options.frozenColCount)!==null&&g!==void 0?g:0,_.frozenRowCount=Math.max(w.headerLevelCount,(f=this.options.frozenRowCount)!==null&&f!==void 0?f:0),_.bottomFrozenRowCount!==((p=this.options.bottomFrozenRowCount)!==null&&p!==void 0?p:0)&&(_.bottomFrozenRowCount=(m=this.options.bottomFrozenRowCount)!==null&&m!==void 0?m:0),_.rightFrozenColCount!==((b=this.options.rightFrozenColCount)!==null&&b!==void 0?b:0)&&(_.rightFrozenColCount=(C=this.options.rightFrozenColCount)!==null&&C!==void 0?C:0)),this.stateManager.setFrozenCol(this.internalProps.frozenColCount)}getFieldData(e,t,i){if(e===null||this.internalProps.layoutMap.isHeader(t,i))return null;const r=this.getRecordShowIndexByCell(this.transpose?t-this.internalProps.layoutMap.leftRowSeriesNumberColumnCount:t,i);return this.internalProps.dataSource.getField(r,e,t,i,this)}getRawFieldData(e,t,i){if(e===null||this.internalProps.layoutMap.isHeader(t,i))return null;const r=this.getRecordShowIndexByCell(t,i);return this.internalProps.dataSource.getRawField(r,e,t,i,this)}_moveHeaderPosition(e,t){const i=this.getCellRange(e.col,e.row),r=this.getCellRange(t.col,t.row),o=this.internalProps.layoutMap.moveHeaderPosition(e,t);return o?(o.moveType==="column"?(this.colWidthsMap.exchangeOrder(i.start.col,i.end.col-i.start.col+1,r.start.col,r.end.col-r.start.col+1,o.targetIndex),this.transpose||(this.colWidthsLimit={},this.setMinMaxLimitWidth())):o.targetIndex>o.sourceIndex?this.rowHeightsMap.exchangeOrder(o.sourceIndex,o.sourceSize,o.targetIndex+o.sourceSize-o.targetSize,o.targetSize,o.targetIndex):this.rowHeightsMap.exchangeOrder(o.sourceIndex,o.sourceSize,o.targetIndex,o.targetSize,o.targetIndex),o):null}changeRecordOrder(e,t){this.transpose?(e=this.getRecordShowIndexByCell(e,0),t=this.getRecordShowIndexByCell(t,0)):(e=this.getRecordShowIndexByCell(0,e),t=this.getRecordShowIndexByCell(0,t)),this.dataSource.changeOrder(e,t)}getCellAddress(e,t){let i;for(let o=0;o<this.internalProps.records.length;o++){const s=this.internalProps.records[o];if(typeof e=="function")e(s)&&(i=o);else{let l=!0;for(const a in e)if(s[a]!==e[a]){l=!1;break}l&&(i=o)}if(O(i))break}const r=this.getCellRangeByField(t,i);if(r)return{row:r.start.row,col:r.start.col}}getCellRangeByField(e,t){const{layoutMap:i}=this.internalProps,r=i.columnObjects.find(o=>o.field===e);if(r){const o=i.getBodyLayoutRangeById(r.id);let s;return O(t)&&(s=i.getRecordStartRowByRecordIndex(t)),this.transpose?{start:{row:o.start.row,col:O(s)?s+o.start.col:void 0},end:{row:o.end.row,col:O(s)?s+o.end.col:void 0}}:{start:{col:o.start.col,row:O(s)?s+o.start.row:void 0},end:{col:o.end.col,row:O(s)?s+o.end.row:void 0}}}return null}getHierarchyState(e,t){if((!this.options.groupBy||ee(this.options.groupBy)&&this.options.groupBy.length===0)&&!this.getBodyColumnDefine(e,t).tree)return be.none;const i=this.getRecordShowIndexByCell(e,t);return this.dataSource.getHierarchyState(i)}toggleHierarchyState(e,t,i=!0){this.stateManager.updateHoverIcon(e,t,void 0,void 0);const r=this.getHierarchyState(e,t);if(r===be.expand)this._refreshHierarchyState(e,t,i),this.fireListeners(j.TREE_HIERARCHY_STATE_CHANGE,{col:e,row:t,hierarchyState:be.collapse});else if(r===be.collapse){const o=this.getCellOriginRecord(e,t);Array.isArray(o.children)&&this._refreshHierarchyState(e,t,i),this.fireListeners(j.TREE_HIERARCHY_STATE_CHANGE,{col:e,row:t,hierarchyState:be.expand,originData:o})}}setLoadingHierarchyState(e,t){this.scenegraph.setLoadingHierarchyState(e,t)}_refreshHierarchyState(e,t,i=!0){var r,o;let s=!1,l=!1;const a=this.internalProps.layoutMap.checkHasChart();a&&(this.autoFillWidth&&(s=this.getAllColsWidth()<=this.tableNoFrameWidth),this.autoFillHeight&&(l=this.getAllRowsHeight()<=this.tableNoFrameHeight));const d=this.getRecordShowIndexByCell(e,t),u=this.dataSource.toggleHierarchyState(d,this.scenegraph.proxy.rowStart-this.columnHeaderLevelCount,Math.max(this.scenegraph.proxy.rowEnd-this.columnHeaderLevelCount,this.scenegraph.proxy.rowStart-this.columnHeaderLevelCount+this.scenegraph.proxy.rowLimit-1)),h=this.internalProps.layoutMap.toggleHierarchyState(u);this.refreshRowColCount();for(let p=this.rowCount-this.bottomFrozenRowCount;p<this.rowCount;p++){const m=Sn(p,0,this.colCount-1,this);this._setRowHeight(p,m)}this.clearCellStyleCache(),this.internalProps.layoutMap.clearCellRangeMap(),this.internalProps.useOneRowHeightFillAll=!1;const{updateCells:c,addCells:g,removeCells:f}=hI(h,e,t,this);(r=this.reactCustomLayout)===null||r===void 0||r.clearCache(),this.scenegraph.updateRow(f,g,c,i,!0),(o=this.reactCustomLayout)===null||o===void 0||o.updateAllCustomCell(),a&&(this.autoFillWidth&&!s&&(s=this.getAllColsWidth()<=this.tableNoFrameWidth),this.autoFillHeight&&!l&&(l=this.getAllRowsHeight()<=this.tableNoFrameHeight),(this.widthMode==="adaptive"||s||this.heightMode==="adaptive"||l)&&this.scenegraph.updateChartSizeForResizeColWidth(-1))}_hasHierarchyTreeHeader(){var e,t;return(t=(e=this.options.columns)!==null&&e!==void 0?e:this.options.header)===null||t===void 0?void 0:t.some((i,r)=>i.tree)}getMenuInfo(e,t,i){return{field:this.getHeaderField(e,t),value:this.getCellValue(e,t),cellLocation:this.getCellLocation(e,t),event:void 0}}_getSortFuncFromHeaderOption(e,t,i){if(e||(e=this.internalProps.columns),t&&e&&e.length>0)for(let r=0;r<e.length;r++){const o=e[r];if((i&&i===o.fieldKey||!i&&o.field===t)&&o.sort&&typeof o.sort=="function")return o.sort;if(o.columns){const s=this._getSortFuncFromHeaderOption(o.columns,t,i);if(s)return s}}}updateSortState(e,t=!0){var i;if(e)this.internalProps.sortState=e;else if(this.internalProps.sortState)if(Array.isArray(this.internalProps.sortState))for(let r=0;r<this.internalProps.sortState.length;r++)(e=(i=this.internalProps.sortState)===null||i===void 0?void 0:i[r])&&(e.order="normal");else this.internalProps.sortState.order="normal",e=this.internalProps.sortState;(e=Array.isArray(e)?e:[e]).some(r=>r.field)&&t&&this.internalProps.layoutMap.headerObjects.some(r=>r.define.sort!==!1)&&(this.dataSource.sort(e.map(r=>{const o=this._getSortFuncFromHeaderOption(this.internalProps.columns,r.field);return this.internalProps.layoutMap.headerObjects.find(s=>s&&s.field===r.field),{field:r.field,order:r.order,orderFn:o??ad}})),this.internalProps.layoutMap.clearCellRangeMap(),this.internalProps.useOneRowHeightFillAll=!1,this.scenegraph.sortCell()),e.length&&this.stateManager.updateSortState(e)}updateFilterRules(e){this.scenegraph.clearCells(),this.sortState?(this.dataSource.updateFilterRulesForSorted(e),Qt(this)):this.dataSource.updateFilterRules(e),this.refreshRowColCount(),this.stateManager.initCheckedState(this.records),this.scenegraph.createSceneGraph()}getCheckboxState(e){if(this.stateManager.checkedState.size<this.rowCount-this.columnHeaderLevelCount&&this.stateManager.initLeftRecordsCheckState(this.records),O(e)){let t=Array.from(this.stateManager.checkedState.keys()).sort((i,r)=>Number(i)-Number(r)).map(i=>this.stateManager.checkedState.get(i));return this.options.groupBy&&(t=qL(this)),Array.from(t,i=>i[e])}return new Array(...this.stateManager.checkedState.values())}getCellCheckboxState(e,t){var i;const r=this.getBodyColumnDefine(e,t),o=r==null?void 0:r.field,s=this.getCellType(e,t);if(O(o)&&(s==="checkbox"||s==="switch")){const l=this.dataSource.getIndexKey(this.getRecordShowIndexByCell(e,t)).toString();return(i=this.stateManager.checkedState.get(l))===null||i===void 0?void 0:i[o]}}getRadioState(e){return O(e)?this.stateManager.radioState[e]:this.stateManager.radioState}getCellRadioState(e,t){return OL(e,t,this)}setCellCheckboxState(e,t,i){YL(e,t,i,this)}setCellRadioState(e,t,i){WL(e,t,i,this)}getSwitchState(e){return this.getCheckboxState(e)}getCellSwitchState(e,t){return this.getCellCheckboxState(e,t)}setCellSwitchState(e,t,i){this.setCellCheckboxState(e,t,i)}setRecords(e,t){var i,r,o,s;let l;(i=this.internalProps.dataSource)===null||i===void 0||i.release(),this.internalProps.releaseList=(r=this.internalProps.releaseList)===null||r===void 0?void 0:r.filter(d=>!d.dataSourceObj),this.internalProps.dataSource=null,Array.isArray(t)||t!=null&&t.order?l=t:t?l=t.sortState:t===null&&(l=null),typeof window<"u"&&window.performance.now();const a={col:this.stateManager.hover.cellPos.col,row:this.stateManager.hover.cellPos.row};if(this.scenegraph.clearCells(),l!==void 0&&(l===null||!Array.isArray(l)&&O(l.field)||Array.isArray(l))&&(this.internalProps.sortState=this.internalProps.multipleSort?Array.isArray(l)?l:[l]:l,this.stateManager.setSortState(this.sortState)),e){if(Vb(this,e),this.sortState){const d=Array.isArray(this.sortState)?this.sortState:[this.sortState];d.some(u=>u.order&&u.field&&u.order!=="normal")&&this.internalProps.layoutMap.headerObjectsIncludeHided.some(u=>u.define.sort!==!1)&&this.dataSource.sort(d.map(u=>{const h=this._getSortFuncFromHeaderOption(void 0,u.field);return this.internalProps.layoutMap.headerObjectsIncludeHided.find(c=>c&&c.field===u.field),{field:u.field,order:u.order||"asc",orderFn:h??ad}}))}this.refreshRowColCount()}else Vb(this,e);if(this.stateManager.initCheckedState(e),this.clearCellStyleCache(),this.scenegraph.createSceneGraph(),this.stateManager.updateHoverPos(a.col,a.row),this.internalProps.title&&!this.internalProps.title.isReleased&&(this._updateSize(),this.internalProps.title.resize(),this.scenegraph.resize()),this.options.emptyTip)if(this.internalProps.emptyTip)(o=this.internalProps.emptyTip)===null||o===void 0||o.resetVisible();else{const d=ue.getComponent("emptyTip");this.internalProps.emptyTip=new d(this.options.emptyTip,this),(s=this.internalProps.emptyTip)===null||s===void 0||s.resetVisible()}this.render(),O(a.col)&&O(a.row)&&a.col>=0&&a.row>=0&&setTimeout(()=>{var d;(d=this.internalProps)===null||d===void 0||d.tooltipHandler.showTooltip(a.col,a.row)},0)}setRecordChildren(e,t,i,r=!0){const o=this.getCellOriginRecord(t,i);o.children=e;const s=this.getRecordShowIndexByCell(t,i);this.dataSource.setRecord(o,s),this._refreshHierarchyState(t,i,r)}startEditCell(e,t,i){var r;if(O(e)&&O(t))this.eventManager.isDraging=!1,this.selectCell(e,t),this.editorManager.startEditCell(e,t,i);else if(!((r=this.stateManager.select)===null||r===void 0)&&r.cellPos){const{col:o,row:s}=this.stateManager.select.cellPos;O(o)&&O(s)&&this.editorManager.startEditCell(o,s,i)}}completeEditCell(){this.editorManager.completeEdit()}getEditor(e,t){var i,r;const o=this.getBodyColumnDefine(e,t);let s=this.isHeader(e,t)?(i=o==null?void 0:o.headerEditor)!==null&&i!==void 0?i:this.options.headerEditor:(r=o==null?void 0:o.editor)!==null&&r!==void 0?r:this.options.editor;return typeof s=="function"&&(s=s({col:e,row:t,dataValue:this.getCellOriginValue(e,t),value:this.getCellValue(e,t)||"",table:this})),typeof s=="string"?Cz(s):s}isHasEditorDefine(e,t){var i,r;const o=this.getBodyColumnDefine(e,t);let s=this.isHeader(e,t)?(i=o==null?void 0:o.headerEditor)!==null&&i!==void 0?i:this.options.headerEditor:(r=o==null?void 0:o.editor)!==null&&r!==void 0?r:this.options.editor;return typeof s=="function"&&(s=s({col:e,row:t,dataValue:this.getCellOriginValue(e,t),value:this.getCellValue(e,t)||"",table:this})),O(s)}changeCellValue(e,t,i,r=!1){return rI(e,t,i,r,this)}changeCellValues(e,t,i,r=!1){return oI(e,t,i,r,this)}addRecord(e,t){var i;lI(e,t,this),(i=this.internalProps.emptyTip)===null||i===void 0||i.resetVisible()}addRecords(e,t){var i;aI(e,t,this),(i=this.internalProps.emptyTip)===null||i===void 0||i.resetVisible()}deleteRecords(e){var t;dI(e,this),(t=this.internalProps.emptyTip)===null||t===void 0||t.resetVisible()}updateRecords(e,t){uI(e,t,this)}_hasCustomRenderOrLayout(){var e,t,i,r;const{headerObjects:o}=this.internalProps.layoutMap;if(this.options.customRender)return!0;for(let s=0;s<o.length;s++){const l=o[s];if(!((e=l==null?void 0:l.define)===null||e===void 0)&&e.customLayout||!((t=l==null?void 0:l.define)===null||t===void 0)&&t.headerCustomLayout||!((i=l==null?void 0:l.define)===null||i===void 0)&&i.customRender||!((r=l==null?void 0:l.define)===null||r===void 0)&&r.headerCustomRender)return!0}return!1}getAggregateValuesByField(e){const t=this.internalProps.layoutMap.getColumnByField(e),i=[];for(let r=0;r<t.length;r++){const o=t[r].columnDefine.aggregator;if(delete t[r].columnDefine,o){const s={col:t[r].col,aggregateValue:null};if(s.aggregateValue=[],Array.isArray(o))for(let l=0;l<o.length;l++)s.aggregateValue.push({aggregationType:o[l].type,value:o[l].value()});else s.aggregateValue.push({aggregationType:o.type,value:o.value()});i.push(s)}}return i}isAggregation(e,t){return this.internalProps.layoutMap.isAggregation(e,t)}getGroupTitleLevel(e,t){var i;if(!this.options.groupBy)return;const r=this.dataSource.getIndexKey(this.getRecordShowIndexByCell(e,t)),o=(i=this.dataSource.getGroupLength())!==null&&i!==void 0?i:0;let s=ee(r)?r.length-1:0;return o>0&&s===o&&(s=void 0),s}getBodyRowIndexByRecordIndex(e){return Array.isArray(e)&&e.length===1&&(e=e[0]),this.dataSource.getTableIndex(e)}_parseColumnWidthConfig(e){for(let t=0;t<(e==null?void 0:e.length);t++){const i=e[t],r=i.key,o=i.width,s=this.internalProps.layoutMap.getColumnByKey(r);if(s.columnDefine){const{col:l}=s;this.internalProps._widthResizedColMap.has(l)||(this._setColWidth(l,o),this.internalProps._widthResizedColMap.add(l))}}}release(){this.editorManager.release(),super.release()}}function gf(n){return n==="bottom"||n==="top"}function fI(n){return n==="left"||n==="right"}var Ai;(function(n){n.Identity="identity",n.Linear="linear",n.Log="log",n.Pow="pow",n.Sqrt="sqrt",n.Symlog="symlog",n.Time="time",n.Quantile="quantile",n.Quantize="quantize",n.Threshold="threshold",n.Ordinal="ordinal",n.Point="point",n.Band="band"})(Ai||(Ai={}));Object.values(Ai).forEach(n=>{});function Jr(n){return n}const gI=n=>-Math.log(-n),pI=n=>-Math.exp(-n),mI=n=>isFinite(n)?Math.pow(10,n):n<0?0:n,m_=n=>n===10?mI:n===Math.E?Math.exp:e=>Math.pow(n,e),b_=n=>n===Math.E?Math.log:n===10?Math.log10:n===2?Math.log2:(n=Math.log(n),e=>Math.log(e)/n),C_=n=>e=>Math.sign(e)*Math.log1p(Math.abs(e/n)),__=n=>e=>Math.sign(e)*Math.expm1(Math.abs(e))*n;function pf(n,e){if(n=Number(n),e=Number(e),e-=n)return i=>(i-n)/e;const t=Number.isNaN(e)?NaN:.5;return()=>t}function w_(n,e,t){const i=n[0],r=n[1],o=e[0],s=e[1];let l,a;return r<i?(l=pf(r,i),a=t(s,o)):(l=pf(i,r),a=t(o,s)),d=>a(l(d))}function ag(n,e,t){let i;return i=n===1?n+2*t:n-e+2*t,n?i>0?i:1:0}function bI(n,e,t,i){return t===1&&(t=0),ag(n,t,i)*(e/(1-t))}function CI(n,e,t,i,r){const o=ag(n,t,i);let s=e/Math.max(1,o||1);r&&(s=Math.floor(s));let l=s*(1-t);return r&&(l=Math.round(l)),l}function tv(n,e){const t=(n[1]-n[0])/(e[1]-e[0]),i=n[0]-t*e[0];return[i,t+i]}function _I(n,e,t){const i=Math.min(n.length,e.length)-1,r=new Array(i),o=new Array(i);let s=-1;for(n[i]<n[0]&&(n=n.slice().reverse(),e=e.slice().reverse());++s<i;)r[s]=pf(n[s],n[s+1]),o[s]=t(e[s],e[s+1]);return function(l){const a=Hz(n,l,1,i)-1;return o[a](r[a](l))}}const wI=(n,e)=>{const t=n.slice();let i=0,r=t.length-1,o=t[i],s=t[r];return s<o&&([i,r]=[r,i],[o,s]=[s,o]),t[i]=e.floor(o),t[r]=e.ceil(s),t},nv=(n,e=!1)=>{const t=Math.floor(Math.log10(n)),i=n/Math.pow(10,t);let r;return r=e?i<1.5?1:i<3?2:i<7?5:10:i<=1?1:i<=2?2:i<=5?5:10,r*Math.pow(10,t)},yI=(n,e)=>{let t,i;return e[0]<e[1]?(t=e[0],i=e[1]):(t=e[1],i=e[0]),Math.min(Math.max(n,t),i)};class iv{constructor(){this._rangeFactorStart=null,this._rangeFactorEnd=null}_calculateWholeRange(e){return this._wholeRange?this._wholeRange:tt(this._rangeFactorStart)&&tt(this._rangeFactorEnd)&&e.length===2?(this._wholeRange=tv(e,[this._rangeFactorStart,this._rangeFactorEnd]),this._wholeRange):e}rangeFactor(e,t,i){return e?(e.length===2&&e.every(r=>r>=0&&r<=1)&&(this._wholeRange=null,e[0]===0&&e[1]===1?(this._rangeFactorStart=null,this._rangeFactorEnd=null):(this._rangeFactorStart=e[0],this._rangeFactorEnd=e[1])),this):i?(this._wholeRange=null,this._rangeFactorStart=null,this._rangeFactorEnd=null,this):tt(this._rangeFactorStart)&&tt(this._rangeFactorEnd)?[this._rangeFactorStart,this._rangeFactorEnd]:null}rangeFactorStart(e,t){var i;return xt(e)?this._rangeFactorStart:(e>=0&&e<=1&&(this._wholeRange=null,e!==0||!xt(this._rangeFactorEnd)&&this._rangeFactorEnd!==1?(this._rangeFactorStart=e,this._rangeFactorEnd=(i=this._rangeFactorEnd)!==null&&i!==void 0?i:1):(this._rangeFactorStart=null,this._rangeFactorEnd=null)),this)}rangeFactorEnd(e,t){var i;return xt(e)?this._rangeFactorEnd:(e>=0&&e<=1&&(this._wholeRange=null,e!==0||!xt(this._rangeFactorStart)&&this._rangeFactorStart!==0?(this._rangeFactorEnd=e,this._rangeFactorStart=(i=this._rangeFactorStart)!==null&&i!==void 0?i:0):(this._rangeFactorStart=null,this._rangeFactorEnd=null)),this)}generateFishEyeTransform(){var e;if(!this._fishEyeOptions)return void(this._fishEyeTransform=null);const{distortion:t=2,radiusRatio:i=.1,radius:r}=this._fishEyeOptions,o=this.range(),s=o[0],l=o[o.length-1],a=Math.min(s,l),d=Math.max(s,l),u=Zy((e=this._fishEyeOptions.focus)!==null&&e!==void 0?e:0,a,d),h=xt(r)?(d-a)*i:r;let c=Math.exp(t);c=c/(c-1)*h;const g=t/h;this._fishEyeTransform=f=>{const p=Math.abs(f-u);if(p>=h)return f;if(p<=1e-6)return u;const m=c*(1-Math.exp(-p*g))/p*.75+.25;return u+(f-u)*m}}unknown(e){return arguments.length?(this._unknown=e,this):this._unknown}get(e,t){var i;return(i=this==null?void 0:this[e])!==null&&i!==void 0?i:t}}const mf=Symbol("implicit");class dg extends iv{specified(e){var t;return e?(this._specified=Object.assign((t=this._specified)!==null&&t!==void 0?t:{},e),this):Object.assign({},this._specified)}_getSpecifiedValue(e){if(this._specified)return this._specified[e]}constructor(){super(),this.type=Ai.Ordinal,this._index=new Map,this._domain=[],this._ordinalRange=[],this._unknown=mf}clone(){const e=new dg().domain(this._domain).range(this._ordinalRange).unknown(this._unknown);return this._specified&&e.specified(this._specified),e}calculateVisibleDomain(e){return tt(this._rangeFactorStart)&&tt(this._rangeFactorEnd)&&e.length===2?[this.invert(e[0]),this.invert(e[1])]:this._domain}scale(e){const t=`${e}`,i=this._getSpecifiedValue(t);if(i!==void 0)return i;let r=this._index.get(t);if(!r){if(this._unknown!==mf)return this._unknown;r=this._domain.push(e),this._index.set(t,r)}const o=this._ordinalRange[(r-1)%this._ordinalRange.length];return this._fishEyeTransform?this._fishEyeTransform(o):o}invert(e){let t=0;for(;t<this._ordinalRange.length&&this._ordinalRange[t]!==e;)t++;return this._domain[(t-1)%this._domain.length]}domain(e){if(!e)return this._domain.slice();this._domain=[],this._index=new Map;for(const t of e){const i=`${t}`;this._index.has(i)||this._index.set(i,this._domain.push(t))}return this}range(e){if(!e)return this._ordinalRange.slice();const t=Array.from(e);return this._ordinalRange=t,this}index(e){var t;return this._index&&(t=this._index.get(`${e}`))!==null&&t!==void 0?t:-1}}function rv(n,e,t,i){const r=[];let o=n;for(;o<=e;)r.push(o),o+=t;return i&&r.reverse(),r}function y_(n,e,t,i){let r,o;if(e=Math.floor(+e),n=Math.floor(+n),!(t=Math.floor(+t)))return[];if(n===e)return[n];if(r=e<n){const l=n;n=e,e=l}let s=sg(1,e-n+1)(t);if(o=Math.floor((e-n+1)/s),!i)for(;Math.ceil((e-n+1)/o)>t&&s>1;)s-=1,o=Math.floor((e-n)/s);return rv(n,e,o,r)}function vI(n,e,t){let i;if(e=Math.floor(+e),n=Math.floor(+n),t=sg(1,e-n+1)(Math.floor(+t)),i=e<n){const r=n;n=e,e=r}return rv(n,e,t,i)}class Mu extends dg{constructor(e){super(),this.type=Ai.Band,this._range=[0,1],this._step=void 0,this._bandwidth=void 0,this._isFixed=!1,this._round=!1,this._paddingInner=0,this._paddingOuter=0,this._align=.5,this._unknown=void 0,delete this.unknown,this.rescale(e)}rescale(e,t){if(e)return this;this._wholeRange=null;const i=this._calculateWholeRange(this._range,t),r=super.domain().length,o=i[1]<i[0];let s=i[Number(o)-0];const l=i[1-Number(o)],a=ag(r,this._paddingInner,this._paddingOuter);return this._step=(l-s)/Math.max(1,a||1),this._round&&(this._step=Math.floor(this._step)),s+=(l-s-this._step*(r-this._paddingInner))*this._align,this.isBandwidthFixed()||(this._bandwidth=this._step*(1-this._paddingInner)),this._round&&(s=Math.round(s),this.isBandwidthFixed()||(this._bandwidth=Math.round(this._bandwidth))),this._bandRangeState={reverse:o,start:o?s+this._step*(r-1):s,count:r},this.generateFishEyeTransform(),this}scale(e){if(!this._bandRangeState)return;const t=`${e}`,i=this._getSpecifiedValue(t);if(i!==void 0)return i;let r=this._index.get(t);if(!r){if(this._unknown!==mf)return this._unknown;r=this._domain.push(e),this._index.set(t,r)}const{count:o,start:s,reverse:l}=this._bandRangeState,a=s+(l?-1:1)*((r-1)%o)*this._step;return this._fishEyeTransform?this._fishEyeTransform(a):a}_calculateWholeRange(e,t){if(this._wholeRange)return this._wholeRange;if((this._minBandwidth||this._maxBandwidth)&&!this._isBandwidthFixedByUser()){let i;if(tt(this._rangeFactorStart)&&tt(this._rangeFactorEnd)&&e.length===2){const o=tv(e,[this._rangeFactorStart,this._rangeFactorEnd]);i=Math.abs(o[1]-o[0])}else i=Math.abs(e[1]-e[0]);const r=CI(super.domain().length,i,this._paddingInner,this._paddingOuter,this._round);r<this._minBandwidth?(this._bandwidth=this._minBandwidth,this._isFixed=!0):r>this._maxBandwidth?(this._bandwidth=this._maxBandwidth,this._isFixed=!0):(this._bandwidth=r,this._isFixed=!1)}if(this.isBandwidthFixed()){const i=bI(super.domain().length,this._bandwidth,this._paddingInner,this._paddingOuter)*Math.sign(e[1]-e[0]),r=Math.min((e[1]-e[0])/i,1);if(tt(this._rangeFactorStart)&&tt(this._rangeFactorEnd)){if(i>0){const l=e[0]-i*this._rangeFactorStart,a=l+i;this._wholeRange=[l,a]}else{const l=e[1]+i*(1-this._rangeFactorEnd),a=l-i;this._wholeRange=[a,l]}const o=this._rangeFactorStart+r<=1,s=this._rangeFactorEnd-r>=0;t==="rangeFactorStart"&&o?this._rangeFactorEnd=this._rangeFactorStart+r:t==="rangeFactorEnd"&&s?this._rangeFactorStart=this._rangeFactorEnd-r:e[0]<=e[1]?o?this._rangeFactorEnd=this._rangeFactorStart+r:s?this._rangeFactorStart=this._rangeFactorEnd-r:(this._rangeFactorStart=0,this._rangeFactorEnd=r):s?this._rangeFactorStart=this._rangeFactorEnd-r:o?this._rangeFactorEnd=this._rangeFactorStart+r:(this._rangeFactorStart=1-r,this._rangeFactorEnd=1)}else this._rangeFactorStart=0,this._rangeFactorEnd=r,this._wholeRange=[e[0],e[0]+i];return this._wholeRange}return super._calculateWholeRange(e)}calculateWholeRangeSize(){const e=this._calculateWholeRange(this._range);return Math.abs(e[1]-e[0])}calculateVisibleDomain(e){const t=this._domain;if(tt(this._rangeFactorStart)&&tt(this._rangeFactorEnd)&&t.length){const i=this._getInvertIndex(e[0]),r=this._getInvertIndex(e[1]);return t.slice(Math.min(i,r),Math.max(i,r)+1)}return t}domain(e,t){return e?(super.domain(e),this.rescale(t)):super.domain()}range(e,t){return e?(this._range=[fs(e[0]),fs(e[1])],this.rescale(t)):this._range}rangeRound(e,t){return this._range=[fs(e[0]),fs(e[1])],this._round=!0,this.rescale(t)}ticks(e=10){const t=this.calculateVisibleDomain(this._range);return e===-1?t:y_(0,t.length-1,e,!1).map(i=>t[i])}tickData(e=10){return this.ticks(e).map((t,i)=>({index:i,tick:t,value:(this.scale(t)-this._range[0]+this._bandwidth/2)/(this._range[1]-this._range[0])}))}forceTicks(e=10){const t=this.calculateVisibleDomain(this._range);return y_(0,t.length-1,e,!0).filter(i=>i<t.length).map(i=>t[i])}stepTicks(e){const t=this.calculateVisibleDomain(this._range);return vI(0,t.length-1,e).map(i=>t[i])}_getInvertIndex(e){let t=0;const i=this.step()/2,r=this.bandwidth()/2,o=this._domain.length,s=this.range(),l=s[0]>s[s.length-1];for(t=0;t<o;t++){const a=this.scale(this._domain[t])+r;if(t===0&&(!l&&!l_(e,a+i)||l&&!a_(e,a-i))||t===o-1||!a_(e,a-i)&&!l_(e,a+i))break}return t>=0&&t<=o-1?t:o-1}invert(e){return this._domain[this._getInvertIndex(e)]}padding(e,t){return e!==void 0?(this._paddingOuter=Math.max(0,Math.min(Array.isArray(e)?Math.min.apply(null,e):e)),this._paddingInner=this._paddingOuter,this.rescale(t)):this._paddingInner}paddingInner(e,t){return e!==void 0?(this._paddingInner=Math.max(0,Math.min(1,e)),this.rescale(t)):this._paddingInner}paddingOuter(e,t){return e!==void 0?(this._paddingOuter=Math.max(0,Math.min(1,e)),this.rescale(t)):this._paddingOuter}step(){return this._step}round(e,t){return e!==void 0?(this._round=e,this.rescale(t)):this._round}align(e,t){return e!==void 0?(this._align=Math.max(0,Math.min(1,e)),this.rescale(t)):this._align}rangeFactor(e,t){return e?(super.rangeFactor(e),this.rescale(t)):super.rangeFactor()}rangeFactorStart(e,t){return xt(e)?super.rangeFactorStart():(super.rangeFactorStart(e),this.rescale(t,"rangeFactorStart"))}rangeFactorEnd(e,t){return xt(e)?super.rangeFactorEnd():(super.rangeFactorEnd(e),this.rescale(t,"rangeFactorEnd"))}bandwidth(e,t){return e?(e==="auto"?(this._bandwidth=void 0,this._isFixed=!1):(this._bandwidth=e,this._isFixed=!0),this._userBandwidth=e,this.rescale(t)):this._bandwidth}maxBandwidth(e,t){return e?(this._maxBandwidth=e==="auto"?void 0:e,this.rescale(t)):this._maxBandwidth}minBandwidth(e,t){return e?(this._minBandwidth=e==="auto"?void 0:e,this.rescale(t)):this._minBandwidth}fishEye(e,t,i){return e||i?(this._fishEyeOptions=e,this._fishEyeTransform=null,this.rescale(t)):this._fishEyeOptions}isBandwidthFixed(){return this._isFixed&&!!this._bandwidth}_isBandwidthFixedByUser(){return this._isFixed&&this._userBandwidth&&Gt(this._userBandwidth)}clone(){var e,t,i;return new Mu(!0).domain(this._domain,!0).range(this._range,!0).round(this._round,!0).paddingInner(this._paddingInner,!0).paddingOuter(this._paddingOuter,!0).align(this._align,!0).bandwidth((e=this._userBandwidth)!==null&&e!==void 0?e:"auto",!0).maxBandwidth((t=this._maxBandwidth)!==null&&t!==void 0?t:"auto",!0).minBandwidth((i=this._maxBandwidth)!==null&&i!==void 0?i:"auto")}}const{interpolateRgb:bh}=Nz;function SI(n,e){const t=typeof e;let i;if(xt(e)||t==="boolean")return()=>e;if(t==="number")return oa(n,e);if(t==="string"){if(i=zn.parseColorString(e)){const r=bh(zn.parseColorString(n),i);return o=>r(o).formatRgb()}return oa(Number(n),Number(e))}return e instanceof Ut?bh(n,e):e instanceof zn?bh(n.color,e.color):e instanceof Date?Fz(n,e):oa(Number(n),Number(e))}class ov extends iv{constructor(e=Jr,t=Jr){super(),this._unknown=void 0,this.transformer=e,this.untransformer=t,this._forceAlign=!0,this._domain=[0,1],this._range=[0,1],this._clamp=Jr,this._piecewise=w_,this._interpolate=SI}calculateVisibleDomain(e){var t;return tt(this._rangeFactorStart)&&tt(this._rangeFactorEnd)&&e.length===2?[this.invert(e[0]),this.invert(e[1])]:(t=this._niceDomain)!==null&&t!==void 0?t:this._domain}fishEye(e,t,i){return e||i?(this._fishEyeOptions=e,this._fishEyeTransform=null,this.rescale(t)):this._fishEyeOptions}scale(e){var t;if(e=Number(e),Number.isNaN(e)||this._domainValidator&&!this._domainValidator(e))return this._unknown;this._output||(this._output=this._piecewise(((t=this._niceDomain)!==null&&t!==void 0?t:this._domain).map(this.transformer),this._calculateWholeRange(this._range),this._interpolate));const i=this._output(this.transformer(this._clamp(e)));return this._fishEyeTransform?this._fishEyeTransform(i):i}invert(e){var t;return this._input||(this._input=this._piecewise(this._calculateWholeRange(this._range),((t=this._niceDomain)!==null&&t!==void 0?t:this._domain).map(this.transformer),oa)),this._clamp(this.untransformer(this._input(e)))}domain(e,t){var i;if(!e)return((i=this._niceDomain)!==null&&i!==void 0?i:this._domain).slice();this._domainValidator=null,this._niceType=null,this._niceDomain=null;const r=Array.from(e,fs);return this._domain=r,this.rescale(t)}range(e,t){if(!e)return this._range.slice();const i=Array.from(e);return this._range=i,this.rescale(t)}rangeRound(e,t){const i=Array.from(e);return this._range=i,this._interpolate=Lz,this.rescale(t)}rescale(e){var t;if(e)return this;const i=(t=this._niceDomain)!==null&&t!==void 0?t:this._domain,r=i.length,o=this._range.length;let s=Math.min(r,o);if(r&&r<o&&this._forceAlign){const l=o-r+1,a=i[r-1],d=r>=2?(a-i[r-2])/l:0;for(let u=1;u<=l;u++)i[r-2+u]=a-d*(l-u);s=o}return this._autoClamp&&(this._clamp=sg(i[0],i[s-1])),this._piecewise=s>2?_I:w_,this._output=this._input=null,this._wholeRange=null,this.generateFishEyeTransform(),this}clamp(e,t,i){return arguments.length?(t?(this._autoClamp=!1,this._clamp=t):(this._autoClamp=!!e,this._clamp=e?void 0:Jr),this.rescale(i)):this._clamp!==Jr}interpolate(e,t){return arguments.length?(this._interpolate=e,this.rescale(t)):this._interpolate}ticks(e=10){return[]}tickData(e=10){const t=this.ticks(e);return(t??[]).map((i,r)=>({index:r,tick:i,value:(this.scale(i)-this._range[0])/(this._range[1]-this._range[0])}))}rangeFactor(e,t){return e?(super.rangeFactor(e),this._output=this._input=null,this):super.rangeFactor()}rangeFactorStart(e,t){return xt(e)?super.rangeFactorStart():(super.rangeFactorStart(e),this._output=this._input=null,this)}rangeFactorEnd(e,t){return xt(e)?super.rangeFactorEnd():(super.rangeFactorEnd(e),this._output=this._input=null,this)}forceAlignDomainRange(e){return arguments.length?(this._forceAlign=e,this):this._forceAlign}}const xI=Math.sqrt(50),RI=Math.sqrt(10),AI=Math.sqrt(2),ql=[1,2,5,10],v_=(n,e,t)=>{let i=1,r=n;const o=Math.floor((e-1)/2),s=Math.abs(n);return n>=0&&n<=Number.MIN_VALUE?r=0:n<0&&n>=-Number.MIN_VALUE?r=-(e-1):!t&&s<1?i=sv(s).step:(t||s>1)&&(r=Math.floor(n)-o*i),i>0?(n>0?r=Math.max(r,0):n<0&&(r=Math.min(r,-(e-1)*i)),Mz(0,e).map(l=>r+l*i)):n>0?Vd(0,-(e-1)/i,i):Vd((e-1)/i,0,i)},BI=cl((n,e,t,i)=>{let r,o,s,l,a=-1;if(t=+t,(n=+n)==(e=+e))return[n];if(Math.abs(n-e)<=Number.MIN_VALUE&&t>0)return[n];if((r=e<n)&&(o=n,n=e,e=o),l=ug(n,e,t).step,!isFinite(l))return[];if(l>0){let d=Math.round(n/l),u=Math.round(e/l);for(d*l<n&&++d,u*l>e&&--u,s=new Array(o=u-d+1);++a<o;)s[a]=(d+a)*l}else if(l<0&&(i!=null&&i.noDecimals)){l=1;const d=Math.ceil(n),u=Math.floor(e);if(!(d<=u))return[];for(s=new Array(o=u-d+1);++a<o;)s[a]=d+a}else{l=-l;let d=Math.round(n*l),u=Math.round(e*l);for(d/l<n&&++d,u/l>e&&--u,s=new Array(o=u-d+1);++a<o;)s[a]=(d+a)/l}return r&&s.reverse(),s}),Vd=(n,e,t)=>{let i,r,o=-1;if(t>0){let s=Math.floor(n/t),l=Math.ceil(e/t);for((s+1)*t<n&&++s,(l-1)*t>e&&--l,r=new Array(i=l-s+1);++o<i;)r[o]=(s+o)*t}else{t=-t;let s=Math.floor(n*t),l=Math.ceil(e*t);for((s+1)/t<n&&++s,(l-1)/t>e&&--l,r=new Array(i=l-s+1);++o<i;)r[o]=(s+o)/t}return r},MI=(n,e,t)=>{let i;const r=n[0],o=n[n.length-1],s=e-n.length;if(o<=0){const d=[];for(i=s;i>=1;i--)d.push(r-i*t);return d.concat(n)}if(r>=0){for(i=1;i<=s;i++)n.push(o+i*t);return n}let l=[];const a=[];for(i=1;i<=s;i++)i%2==0?l=[r-Math.floor(i/2)*t].concat(l):a.push(o+Math.ceil(i/2)*t);return l.concat(n).concat(a)},Gd=cl((n,e,t,i)=>{let r,o,s;if(t=+t,(n=+n)==(e=+e)||Math.abs(n-e)<=Number.MIN_VALUE&&t>0)return v_(n,t,i==null?void 0:i.noDecimals);(r=e<n)&&(s=n,n=e,e=s);const l=ug(n,e,t);let a=l.step;if(!isFinite(a))return[];if(a>0){let d=1;const{power:u,gap:h}=l,c=h===10?2*10**u:1*10**u;for(;d<=5&&(o=Vd(n,e,a),o.length>t+1)&&t>2;)a+=c,d+=1;t>2&&o.length<t-1&&(o=MI(o,t,a))}else i!=null&&i.noDecimals&&a<0&&(a=1),o=Vd(n,e,a);return r&&o.reverse(),o}),sv=n=>{const e=Math.floor(Math.log(n)/Math.LN10),t=n/10**e;let i=ql[0];return t>=xI?i=ql[3]:t>=RI?i=ql[2]:t>=AI&&(i=ql[1]),e>=0?{step:i*10**e,gap:i,power:e}:{step:-(10**-e)/i,gap:i,power:e}};function ug(n,e,t){const i=(e-n)/Math.max(0,t);return sv(i)}function lv(n,e,t){let i;if(t=+t,(n=+n)==(e=+e)&&t>0)return[n];if(t<=0||(i=TI(n,e,t))===0||!isFinite(i))return[];const r=new Array(t);for(let o=0;o<t;o++)r[o]=n+o*i;return r}function TI(n,e,t){return(e-n)/Math.max(1,t-1)}function PI(n,e,t){let i,r,o=-1;if(t=+t,(r=(e=+e)<(n=+n))&&(i=n,n=e,e=i),!isFinite(t)||e-n<=t)return[n];const s=Math.floor((e-n)/t+1),l=new Array(s);for(;++o<s;)l[o]=n+o*t;return r&&l.reverse(),l}function Ch(n,e=10){let t,i,r=0,o=n.length-1,s=n[r],l=n[o],a=10;for(l<s&&(i=s,s=l,l=i,i=r,r=o,o=i);a-- >0;){if(i=ug(s,l,e).step,i===t)return n[r]=s,n[o]=l,n;if(i>0)s=Math.floor(s/i)*i,l=Math.ceil(l/i)*i;else{if(!(i<0))break;s=Math.ceil(s*i)/i,l=Math.floor(l*i)/i}t=i}}function av(n,e){const t=Gt(e.forceMin),i=Gt(e.forceMax);let r=null;const o=[];let s=null;const l=t&&i?a=>a>=e.forceMin&&a<=e.forceMax:t?a=>a>=e.forceMin:i?a=>a<=e.forceMax:null;return t?o[0]=e.forceMin:Gt(e.min)&&e.min<=Math.min(n[0],n[n.length-1])&&(o[0]=e.min),i?o[1]=e.forceMax:Gt(e.max)&&e.max>=Math.max(n[0],n[n.length-1])&&(o[1]=e.max),Gt(o[0])&&Gt(o[1])?(s=n.slice(),s[0]=o[0],s[s.length-1]=o[1]):r=Gt(o[0])||Gt(o[1])?Gt(o[0])?"max":"min":"all",{niceType:r,niceDomain:s,niceMinMax:o,domainValidator:l}}const _h=(n,e,t)=>Math.abs(e-n)<1?+t.toFixed(1):Math.round(+t),dv=cl((n,e,t,i,r,o,s)=>{let l=n,a=e;const d=a<l;d&&([l,a]=[a,l]);let u,h,c=r(l),g=r(a),f=[];if(!(i%1)&&g-c<t){if(c=Math.floor(c),g=Math.ceil(g),l>0){for(;c<=g;++c)for(u=1;u<i;++u)if(h=c<0?u/o(-c):u*o(c),!(h<l)){if(h>a)break;f.push(h)}}else for(;c<=g;++c)for(u=i-1;u>=1;--u)if(h=c>0?u/o(-c):u*o(c),!(h<l)){if(h>a)break;f.push(h)}2*f.length<t&&(f=Gd(l,a,t))}else f=Gd(c,g,Math.min(g-c,t)).map(o);return f=f.filter(p=>p!==0),s!=null&&s.noDecimals&&(f=Array.from(new Set(f.map(p=>Math.floor(p))))),d?f.reverse():f}),uv=cl((n,e,t,i,r,o)=>{const s=[],l={},a=r(n),d=r(e);let u=[];if(Number.isInteger(i))u=Gd(a,d,t);else{const h=(d-a)/(t-1);for(let c=0;c<t;c++)u.push(a+c*h)}return u.forEach(h=>{const c=o(h),g=Number.isInteger(i)?_h(n,e,c):_h(n,e,nv(c)),f=_h(n,e,yI(g,[n,e]));!l[f]&&!isNaN(f)&&u.length>1&&(l[f]=1,s.push(f))}),s}),jd=cl((n,e,t,i,r)=>lv(i(n),i(e),t).map(o=>nv(r(o))));class Vo extends ov{constructor(){super(...arguments),this.type=Ai.Linear}clone(){return new Vo().domain(this._domain,!0).range(this._range,!0).unknown(this._unknown).clamp(this.clamp(),null,!0).interpolate(this._interpolate)}tickFormat(){return()=>{}}d3Ticks(e=10,t){const i=this.calculateVisibleDomain(this._range);return BI(i[0],i[i.length-1],e,t)}ticks(e=10,t){var i;if(_z(t==null?void 0:t.customTicks))return t.customTicks(this,e);if(tt(this._rangeFactorStart)&&tt(this._rangeFactorEnd)&&(this._rangeFactorStart>0||this._rangeFactorEnd<1)&&this._range.length===2||!this._niceType)return this.d3Ticks(e,t);const r=(i=this._niceDomain)!==null&&i!==void 0?i:this._domain,o=this._domain,s=r[0],l=r[r.length-1];let a=Gd(o[0],o[o.length-1],e,t);if(!a.length)return a;if(this._domainValidator)a=a.filter(this._domainValidator);else if((a[0]!==s||a[a.length-1]!==l)&&this._niceType){const d=r.slice();if(this._niceType==="all"?(d[0]=a[0],d[d.length-1]=a[a.length-1],this._niceDomain=d,this.rescale()):this._niceType==="min"&&a[0]!==s?(d[0]=a[0],this._niceDomain=d,this.rescale()):this._niceType==="max"&&a[a.length-1]!==l&&(d[d.length-1]=a[a.length-1],this._niceDomain=d,this.rescale()),this._niceType!=="all"){const u=Math.min(d[0],d[d.length-1]),h=Math.max(d[0],d[d.length-1]);a=a.filter(c=>c>=u&&c<=h)}}return a}forceTicks(e=10){const t=this.calculateVisibleDomain(this._range);return lv(t[0],t[t.length-1],e)}stepTicks(e){const t=this.calculateVisibleDomain(this._range);return PI(t[0],t[t.length-1],e)}nice(e=10,t){var i,r;const o=this._domain;let s=[];if(t){const l=av(o,t);if(s=l.niceMinMax,this._domainValidator=l.domainValidator,this._niceType=l.niceType,l.niceDomain)return this._niceDomain=l.niceDomain,this.rescale(),this}else this._niceType="all";if(this._niceType){const l=Ch(o.slice(),e);this._niceType==="min"?l[l.length-1]=(i=s[1])!==null&&i!==void 0?i:l[l.length-1]:this._niceType==="max"&&(l[0]=(r=s[0])!==null&&r!==void 0?r:l[0]),this._niceDomain=l,this.rescale()}return this}niceMin(e=10){this._niceType="min";const t=this._domain[this._domain.length-1],i=Ch(this.domain(),e);return i&&(i[i.length-1]=t,this._niceDomain=i,this.rescale()),this}niceMax(e=10){this._niceType="max";const t=this._domain[0],i=Ch(this._domain.slice(),e);return i&&(i[0]=t,this._niceDomain=i,this.rescale()),this}}class hv{nice(e=10,t){var i,r,o,s;const l=this._domain;let a=[],d=null;if(t){const u=av(l,t);if(a=u.niceMinMax,this._domainValidator=u.domainValidator,d=u.niceType,u.niceDomain)return this._niceDomain=u.niceDomain,this.rescale(),this}else d="all";if(d){const u=wI(l.slice(),(r=(i=this.getNiceConfig)===null||i===void 0?void 0:i.call(this))!==null&&r!==void 0?r:{floor:h=>Math.floor(h),ceil:h=>Math.ceil(h)});return d==="min"?u[u.length-1]=(o=a[1])!==null&&o!==void 0?o:u[u.length-1]:d==="max"&&(u[0]=(s=a[0])!==null&&s!==void 0?s:u[0]),this._niceDomain=u,this.rescale(),this}return this}niceMin(){const e=this._domain[this._domain.length-1];this.nice();const t=this._domain.slice();return this._domain&&(t[t.length-1]=e,this._niceDomain=t,this.rescale()),this}niceMax(){const e=this._domain[0];this.nice();const t=this._domain.slice();return this._domain&&(t[0]=e,this._niceDomain=t,this.rescale()),this}}function S_(n){return e=>-n(-e)}function x_(n=Number.EPSILON){return e=>Math.max(e,n)}function HI(n=Number.EPSILON){return e=>Math.min(e,-n)}class fl extends ov{constructor(){super(b_(10),m_(10)),this.type=Ai.Log,this._limit=x_(),this._logs=this.transformer,this._pows=this.untransformer,this._domain=[1,10],this._base=10}clone(){return new fl().domain(this._domain,!0).range(this._range,!0).unknown(this._unknown).clamp(this.clamp(),null,!0).interpolate(this._interpolate,!0).base(this._base)}rescale(e){var t;if(e)return this;super.rescale();const i=b_(this._base),r=m_(this._base);return((t=this._niceDomain)!==null&&t!==void 0?t:this._domain)[0]<0?(this._logs=S_(i),this._pows=S_(r),this._limit=HI(),this.transformer=gI,this.untransformer=pI):(this._logs=i,this._pows=r,this._limit=x_(),this.transformer=this._logs,this.untransformer=r),this}scale(e){var t;if(e=Number(e),Number.isNaN(e)||this._domainValidator&&!this._domainValidator(e))return this._unknown;this._output||(this._output=this._piecewise(((t=this._niceDomain)!==null&&t!==void 0?t:this._domain).map(this._limit).map(this.transformer),this._calculateWholeRange(this._range),this._interpolate));const i=this._output(this.transformer(this._limit(this._clamp(e))));return this._fishEyeTransform?this._fishEyeTransform(i):i}base(e,t){return arguments.length?(this._base=e,this.rescale(t)):this._base}tickFormat(){return Jr}d3Ticks(e=10,t){const i=this.domain(),r=this._limit(i[0]),o=this._limit(i[i.length-1]);return dv(r,o,e,this._base,this.transformer,this.untransformer,t)}ticks(e=10){const t=this.calculateVisibleDomain(this._range);return uv(this._limit(t[0]),this._limit(t[t.length-1]),e,this._base,this.transformer,this.untransformer)}forceTicks(e=10){const t=this.calculateVisibleDomain(this._range);return jd(t[0],t[t.length-1],e,this.transformer,this.untransformer)}stepTicks(e){const t=this.calculateVisibleDomain(this._range);return jd(this._limit(t[0]),this._limit(t[t.length-1]),e,this.transformer,this.untransformer)}getNiceConfig(){return{floor:e=>this._pows(Math.floor(this._logs(this._limit(e)))),ceil:e=>Math.abs(e)>=1?Math.ceil(e):this._pows(Math.ceil(this._logs(this._limit(e))))}}}Xy(fl,hv);class kI extends Mu{constructor(e){super(!1),this.type=Ai.Point,this._padding=0,this.paddingInner(1,e),this.padding=this.paddingOuter,this.paddingInner=void 0,this.paddingOuter=void 0}}class gl extends Vo{constructor(){super(C_(1),__(1)),this.type=Ai.Symlog,this._const=1}clone(){return new gl().domain(this._domain,!0).range(this._range,!0).unknown(this._unknown).clamp(this.clamp(),null,!0).interpolate(this._interpolate,!0).constant(this._const)}constant(e,t){return arguments.length?(this._const=e,this.transformer=C_(e),this.untransformer=__(e),this.rescale(t)):this._const}d3Ticks(e=10,t){const i=this.domain(),r=i[0],o=i[i.length-1];return dv(r,o,e,this._const,this.transformer,this.untransformer,t)}ticks(e=10){const t=this.calculateVisibleDomain(this._range);return uv(t[0],t[t.length-1],e,this._const,this.transformer,this.untransformer)}forceTicks(e=10){const t=this.calculateVisibleDomain(this._range);return jd(t[0],t[t.length-1],e,this.transformer,this.untransformer)}stepTicks(e){const t=this.calculateVisibleDomain(this._range);return jd(t[0],t[t.length-1],e,this.transformer,this.untransformer)}}Xy(gl,hv);class EI{constructor(){this._scale=new Mu,this._scales=[this._scale]}valueToPosition(e){return this._scale.scale(e)}getPosition(e){let t=0,i=this._scale;if(this._scales.length===1||e.length===1)t=this.valueToPosition(e[0]);else{const r=Math.min(e.length,this._scales.length);for(let o=0;o<r;o++)t+=this._scales[o].scale(e[o]);i=this._scales[r-1]}return{position:t,bandScale:i}}calcScales(e,t){var i,r;const{bandPadding:o,paddingInner:s,paddingOuter:l}=this,a=ee(o),d=ee(s),u=ee(l);for(let h=0;h<this._scales.length;h++){const c=a?o[h]:o,g=d?s[h]:s,f=u?l[h]:l;this._scales[h].paddingInner((i=g??c)!==null&&i!==void 0?i:e,!0).paddingOuter((r=f??c)!==null&&r!==void 0?r:t)}}dataToPosition(e,t={}){var i;if(e.length===0||this._scales.length===0)return 0;const{position:r,bandScale:o}=this.getPosition(e);return r+o.bandwidth()*((i=t.bandPosition)!==null&&i!==void 0?i:.5)}updateScaleDomain(e){for(let t=0;t<this._scales.length;t++)this._scales[t].domain(e)}updateRange(e){const[t,i]=this._scale.range();e[0]===t&&e[1]===i||this._scale.range(e)}}function LI(n,e,t){n.getTransform(e)||n.registerTransform(e,t)}function FI(n,e,t){n.getParser(e)||n.registerParser(e,t)}const zI=Math.sqrt(50),II=Math.sqrt(10),OI=Math.sqrt(2);class DI{constructor(e){this._extend={},this.type=e??"linear",this._scale=e==="log"?new fl:e==="symlog"?new gl:new Vo,this._scales=[this._scale]}setExtraAttrFromSpec(e,t,i,r,o,s){this.nice=!1,this.zero=t,this.zero&&(i.min=Math.min(i.min,0),i.max=Math.max(i.max,0)),this.domain=i,this.expand=r,this.type==="log"?this._scale.base(o??10):this.type==="symlog"&&this._scale.constant(s??10)}transformScaleDomain(){this.type==="symlog"||this.type==="log"||this.setScaleNice()}setScaleNice(){this.type==="log"?this.setLogScaleNice():this.setLinearScaleNice()}setLogScaleNice(){var e,t,i,r,o,s;Te((e=this.domain)===null||e===void 0?void 0:e.min)&&Te((t=this.domain)===null||t===void 0?void 0:t.max)?this.nice&&this._scale.nice():O((i=this.domain)===null||i===void 0?void 0:i.min)&&Te((r=this.domain)===null||r===void 0?void 0:r.max)?this.nice&&this._scale.niceMax():Te((o=this.domain)===null||o===void 0?void 0:o.min)&&O((s=this.domain)===null||s===void 0?void 0:s.max)&&this.nice&&this._scale.niceMin()}setLinearScaleNice(){var e,t,i,r,o,s,l,a;let d=(t=(e=this.forceTickCount)!==null&&e!==void 0?e:this.tickCount)!==null&&t!==void 0?t:10;this.niceType==="accurateFirst"&&(d=Math.max(10,d)),Te((i=this.domain)===null||i===void 0?void 0:i.min)&&Te((r=this.domain)===null||r===void 0?void 0:r.max)?this.nice&&this._scale.nice(d):O((o=this.domain)===null||o===void 0?void 0:o.min)&&Te((s=this.domain)===null||s===void 0?void 0:s.max)?this.nice&&this._scale.niceMax(d):Te((l=this.domain)===null||l===void 0?void 0:l.min)&&O((a=this.domain)===null||a===void 0?void 0:a.max)?this.nice&&this._scale.niceMin(d):this.nice&&this._scale.nice(d)}dataToPosition(e){return this.valueToPosition(e[0])}valueToPosition(e){return this._scale.scale(e)}computeLinearDomain(e){const t=[];return e.forEach(i=>{const{min:r,max:o}=i;t[0]=t[0]===void 0?r:Math.min(t[0],r),t[1]=t[1]===void 0?o:Math.max(t[1],o)}),this.expandDomain(t),this.includeZero(t),this.setDomainMinMax(t),t}expandDomain(e){if(!this.expand)return;const t=e[0],i=e[e.length-1];O(this.expand.min)&&(e[0]=t-(i-t)*this.expand.min),O(this.expand.max)&&(e[e.length-1]=i+(i-t)*this.expand.max)}niceDomain(e){if(O(e[0])||O(e[1])||this.type!=="linear")return e;if(Math.abs(Kd(e)-bf(e))<=1e-12){let t=e[0];const i=t>=0?1:-1;if(t=Math.abs(t),t<1)e[0]=0,e[1]=1;else{let r=t/5;const o=Math.floor(Math.log(r)/Math.LN10),s=r/Math.pow(10,o);r=(s>=zI?10:s>=II?5:s>=OI?2:1)*Math.pow(10,o),e[0]=0,e[1]=10*r}i<0&&(e.reverse(),e[0]*=-1,e[1]*=-1)}return e}niceMinMax(){var e,t,i,r,o,s,l,a;if(this.nice){let d=(t=(e=this.forceTickCount)!==null&&e!==void 0?e:this.tickCount)!==null&&t!==void 0?t:10;this.niceType==="accurateFirst"&&(d=Math.max(10,d)),Te((i=this.domain)===null||i===void 0?void 0:i.min)&&Te((r=this.domain)===null||r===void 0?void 0:r.max)?this._scale.nice(d):O((o=this.domain)===null||o===void 0?void 0:o.min)&&Te((s=this.domain)===null||s===void 0?void 0:s.max)?this._scale.niceMax(d):Te((l=this.domain)===null||l===void 0?void 0:l.min)&&O((a=this.domain)===null||a===void 0?void 0:a.max)?this._scale.niceMin(d):this._scale.nice(d)}}includeZero(e){this.zero&&(e[0]=Math.min(e[0],0),e[e.length-1]=Math.max(e[e.length-1],0))}setExtendDomain(e,t){if(t===void 0)return void delete this._extend[e];this._extend[e]=t;const i=this._scale.domain();this.extendDomain(i),this.includeZero(i),this.setDomainMinMax(i),this.niceDomain(i),this._scale.domain(i,this.nice),this.niceMinMax()}extendDomain(e){let t;const i=e.length-1,r=e[0]-e[i]>0,o=r?i:0,s=r?0:i;for(const l in this._extend)t=this._extend[l],t>e[s]&&(e[s]=t),t<e[o]&&(e[o]=t)}setDomainMinMax(e){if(!this.domain)return;const{min:t,max:i}=this.domain;O(t)&&(e[0]=t),O(i)&&(e[1]=i)}setZero(e){this.zero!==e&&(this.zero=e,this.updateScaleDomain())}updateScaleDomain(){const e=this.computeDomain([this.domain]);this.updateScaleDomainByModel(e)}computeDomain(e){return this.computeLinearDomain(e)}updateScaleDomainByModel(e){e=e??this._scale.domain(),this.extendDomain(e),this.includeZero(e),this.setDomainMinMax(e),this.niceDomain(e),this._scale.domain(e,this.nice),this.niceMinMax()}updateRange(e){const[t,i]=this._scale.range();e[0]===t&&e[1]===i||this._scale.range(e)}}function WI(n,e){const t=n.find(r=>r.name==="axis-label-container-layer-0",!0),i=n.find(r=>r.name==="axis-label-container-layer-1",!0);R_(t?t.getChildren():[],e),R_(i?i.getChildren():[],e)}function NI(n,e){const{width:t,height:i}=e.getLayoutRect(),r=gf(e.orient),o=e.option.inverse===!0,s=n[0],l=Cr(n);if(r)if(o){const a=t,d=0,u=s.AABBBounds.x2,h=l.AABBBounds.x1;u>a&&s.setAttributes({x:a,textAlign:"right"}),h<d&&l.setAttributes({x:d,textAlign:"left"})}else{const d=t,u=s.AABBBounds.x1,h=l.AABBBounds.x2;u<0&&s.setAttributes({x:0,textAlign:"left"}),h>d&&l.setAttributes({x:d,textAlign:"right"})}else if(o){const a=s.AABBBounds.y1,d=l.AABBBounds.y2,u=0,h=i;a<u&&s.setAttributes({y:u,textBaseline:"top"}),d>h&&l.setAttributes({y:h,textBaseline:"bottom"})}else{const a=i,d=0,u=s.AABBBounds.y2,h=l.AABBBounds.y1;u>a&&s.setAttributes({y:a,textBaseline:"bottom"}),h<d&&l.setAttributes({y:d,textBaseline:"top"})}}function R_(n,e){var t;const i=e.option;ye(n)||!((t=i==null?void 0:i.label)===null||t===void 0)&&t.flush&&NI(n,e)}const VI=n=>n;class GI{constructor(e,t,i,r,o){var s,l,a;this.x=0,this.y=0,this.padding=r,this.table=o,this.orient=(s=e.orient)!==null&&s!==void 0?s:"left",this.type=(l=e.type)!==null&&l!==void 0?l:"band",this.option=re({},qz(e.__vtableChartTheme),jI(this.orient,o.theme),UI(this.orient,this.type,e.__vtableChartTheme),e),this.orient==="left"||this.orient==="right"?(this.width=t,this.height=i-r[0]-r[2]-0,this.y=r[0]+0):(this.orient==="top"||this.orient==="bottom")&&(this.width=t-r[1]-r[3]-0,this.height=i,this.x=r[3]+0),this.visible=(a=e.visible)===null||a===void 0||a,this.inverse="inverse"in e&&!!e.inverse,e.type==="band"&&(this.data=e.domain),this.initScale(),this.initData(),this.createComponent(),this.initEvent()}initScale(){const e=this.option;this.type==="band"||this.type==="point"?(this.scale=new EI,this.scale.bandPadding=e.bandPadding,this.scale.paddingInner=e.paddingInner,this.scale.paddingOuter=e.paddingOuter,this.scale.calcScales(.1,.3),this.scale.updateScaleDomain(this.data),this.updateScaleRange()):this.type!=="linear"&&this.type!=="time"&&this.type!=="log"&&this.type!=="symlog"||(this.scale=new DI(this.type),this.scale.setExtraAttrFromSpec(e.nice,e.zero,e.range,e.expand,e.base,e.constant),this.scale.transformScaleDomain(),this.scale.updateScaleDomain(),this.updateScaleRange())}initData(){this.table._vDataSet||(this.table._vDataSet=new $z),FI(this.table._vDataSet,"scale",VI),LI(this.table._vDataSet,"ticks",kP);const e=this.option.label||{},t=this.option.tick||{},i=new Bu(this.table._vDataSet).parse(this.scale._scale,{type:"scale"}).transform({type:"ticks",options:{sampling:this.option.sampling!==!1,tickCount:t.tickCount,forceTickCount:t.forceTickCount,tickStep:t.tickStep,tickMode:t.tickMode,noDecimals:t.noDecimals,axisOrientType:this.orient,coordinateType:"cartesian",labelStyle:e.style,labelFormatter:e.formatMethod,labelGap:e.minGap,labelLastVisible:e.lastVisible,labelFlush:e.flush}},!1);this.tickData=i,this.computeData()}computeData(){this.tickData.reRunAllTransform()}initEvent(){}createComponent(){const e=h_(this.option),t=this.getUpdateAttribute();t.verticalFactor=this.orient==="top"||this.orient==="right"?-1:1,this.component=new Gs(re({disableTriggerEvent:this.table.options.disableInteraction},e,t)),this.component.setAttributes(this.setLayoutStartPosition({x:this.x,y:this.y})),this.component.originAxis=this}resize(e,t){this.width=e-(this.orient==="top"||this.orient==="bottom"?this.padding[1]+this.padding[3]:0),this.height=t-(this.orient==="left"||this.orient==="right"?this.padding[2]+this.padding[0]:0),this.updateScaleRange(),this.computeData();const i=h_(this.option),r=this.getUpdateAttribute();r.verticalFactor=this.orient==="top"||this.orient==="right"?-1:1,this.component.setAttributes(re({},i,r)),this.component.setAttributes(this.setLayoutStartPosition({x:this.x,y:this.y})),this.overlap()}overlap(){WI(this.component,this)}getLayoutRect(){return{width:this.width,height:this.height}}getUpdateAttribute(){this.table.tableNoFrameHeight,this.table.tableNoFrameWidth;const{width:e,height:t}=this.getLayoutRect(),i=gf(this.orient),r=fI(this.orient);let o={x:0,y:0},s=0;i?(o={x:e,y:0},s=e):r&&(o={x:0,y:t},s=t);const l=this.orient==="top"||this.orient==="bottom"?t:e;return{start:{x:0,y:0},end:o,title:{text:this.option.title.text,maxWidth:this._getTitleLimit(i)},items:this.getLabelItems(s),verticalLimitSize:l,verticalMinSize:l}}getLabelItems(e){return[this.tickData.latestData.map(t=>({id:t.value,label:t.value,value:e===0?0:this.scale.dataToPosition([t.value])/e,rawValue:t.value})).filter(t=>t.value>=0&&t.value<=1)]}updateScaleRange(){var e,t,i,r,o,s,l,a;const d=(t=(e=this.option.innerOffset)===null||e===void 0?void 0:e.right)!==null&&t!==void 0?t:0,u=(r=(i=this.option.innerOffset)===null||i===void 0?void 0:i.left)!==null&&r!==void 0?r:0,h=(s=(o=this.option.innerOffset)===null||o===void 0?void 0:o.top)!==null&&s!==void 0?s:0,c=(a=(l=this.option.innerOffset)===null||l===void 0?void 0:l.bottom)!==null&&a!==void 0?a:0,{width:g,height:f}=this.getLayoutRect(),p=this.option.inverse||!1;let m=[0,0];gf(this.orient)?Xe(g)&&(m=p?[g-d,u]:[u,g-d]):Xe(f)&&(m=p?[h,f-c]:[f-c,h]),this.scale.updateRange(m)}setLayoutStartPosition(e){let{x:t,y:i}=e;return Xe(t)&&(t+=+(this.orient==="left")*this.getLayoutRect().width),Xe(i)&&(i+=+(this.orient==="top")*this.getLayoutRect().height),{x:t,y:i}}_getTitleLimit(e){var t,i,r;if(this.option.title.visible&&Te((t=this.option.title.style)===null||t===void 0?void 0:t.maxLineWidth)){let o=((i=this.option.title.style)===null||i===void 0?void 0:i.angle)||0;if(!((r=this.option.title)===null||r===void 0)&&r.autoRotate&&Te(this.option.title.angle)&&(o=this.option.orient==="left"?-90:90),e){const a=this.getLayoutRect().width,d=Math.abs(Math.cos(Mr(o)));return d<1e-6?1/0:a/d}const s=this.getLayoutRect().height,l=Math.abs(Math.sin(Mr(o)));return l<1e-6?1/0:s/l}return null}getScale(){return this.scale._scale}getDomainSpec(){return this.scale.domain}}function jI(n,e){let t;return n==="left"?t=e.axisStyle.leftAxisStyle:n==="right"?t=e.axisStyle.rightAxisStyle:n==="top"?t=e.axisStyle.topAxisStyle:n==="bottom"&&(t=e.axisStyle.bottomAxisStyle),re({},e.axisStyle.defaultAxisStyle,t)}function UI(n,e,t){if(!t)return{};const i=t.axis;let r,o;return e==="linear"||e==="log"||e==="symlog"?r=t.axisLinear:e==="band"&&(r=t.axisBand),n==="top"||n==="bottom"?o=t.axisX:n!=="left"&&n!=="right"||(o=t.axisY),re({},i,r,o)}function $I(n,e){var t,i,r,o,s,l,a,d,u,h,c,g,f,p,m,b,C,_;const w=re({},Nd,n);let y=0;w.tick.visible!==!1&&(y=(t=w.tick.width)!==null&&t!==void 0?t:4);let v=0;if(w.label.visible){if(w.type==="band")w.domain.forEach(S=>{var R,B,A,M,H,E,T,P,k,L,F,z,I,N,W,D;w.label.formatMethod&&(S=w.label.formatMethod(S));const{width:G,height:V}=e.measureText(S,{fontSize:(A=(B=(R=w.label)===null||R===void 0?void 0:R.style)===null||B===void 0?void 0:B.fontSize)!==null&&A!==void 0?A:Qn,fontWeight:(E=(H=(M=w.label)===null||M===void 0?void 0:M.style)===null||H===void 0?void 0:H.fontWeight)!==null&&E!==void 0?E:"normal",fontFamily:(k=(P=(T=w.label)===null||T===void 0?void 0:T.style)===null||P===void 0?void 0:P.fontFamily)!==null&&k!==void 0?k:_o}),X=((F=(L=w.label)===null||L===void 0?void 0:L.style)===null||F===void 0?void 0:F.maxLineWidth)||1/0,$=((N=(I=(z=w.label)===null||z===void 0?void 0:z.style)===null||I===void 0?void 0:I.angle)!==null&&N!==void 0?N:0)+(((D=(W=w.label)===null||W===void 0?void 0:W.style)===null||D===void 0?void 0:D.direction)==="vertical"?90:0);v=Math.max(v,wo(Math.min(G,X),V,$).width)});else{let S;if(!((i=n.sync)===null||i===void 0)&&i.tickAlign&&Ae((r=n.tick)===null||r===void 0?void 0:r.tickMode))S=n.tick.tickMode();else if(ee(n.__ticksForVTable))S=n.__ticksForVTable;else{const R=w.range,B=Math.abs(R.min)>1?Math.round(R.min):R.min,A=Math.abs(R.max)>1?Math.round(R.max):R.max;S=[Ud(B),Ud(A)]}S.forEach(R=>{var B,A,M,H,E,T,P,k,L,F,z,I,N,W,D,G;w.label.formatMethod&&(R=w.label.formatMethod(R));const{width:V,height:X}=e.measureText(R,{fontSize:(M=(A=(B=w.label)===null||B===void 0?void 0:B.style)===null||A===void 0?void 0:A.fontSize)!==null&&M!==void 0?M:Qn,fontWeight:(T=(E=(H=w.label)===null||H===void 0?void 0:H.style)===null||E===void 0?void 0:E.fontWeight)!==null&&T!==void 0?T:"normal",fontFamily:(L=(k=(P=w.label)===null||P===void 0?void 0:P.style)===null||k===void 0?void 0:k.fontFamily)!==null&&L!==void 0?L:_o}),$=((z=(F=w.label)===null||F===void 0?void 0:F.style)===null||z===void 0?void 0:z.maxLineWidth)||1/0,Q=((W=(N=(I=w.label)===null||I===void 0?void 0:I.style)===null||N===void 0?void 0:N.angle)!==null&&W!==void 0?W:0)+(((G=(D=w.label)===null||D===void 0?void 0:D.style)===null||G===void 0?void 0:G.direction)==="vertical"?90:0);v=Math.max(v,wo(Math.min(V,$),X,Q).width)})}v+=(o=w.label.space)!==null&&o!==void 0?o:4}let x=0;if(w.title.visible&&je(w.title.text)){const{width:S,height:R}=e.measureText(w.title.text,{fontSize:(a=(l=(s=w.title)===null||s===void 0?void 0:s.style)===null||l===void 0?void 0:l.fontSize)!==null&&a!==void 0?a:Qn,fontWeight:(h=(u=(d=w.title)===null||d===void 0?void 0:d.style)===null||u===void 0?void 0:u.fontWeight)!==null&&h!==void 0?h:"normal",fontFamily:(f=(g=(c=w.title)===null||c===void 0?void 0:c.style)===null||g===void 0?void 0:g.fontFamily)!==null&&f!==void 0?f:_o}),B=((m=(p=w.label)===null||p===void 0?void 0:p.style)===null||m===void 0?void 0:m.maxLineWidth)||1/0,A=wo(Math.min(S,B),R,(C=(b=w.title)===null||b===void 0?void 0:b.style)===null||C===void 0?void 0:C.angle);x=n.orient!=="left"&&n.orient!=="right"||!w.title.autoRotate?A.width:A.height,x+=(_=w.title.space)!==null&&_!==void 0?_:4}return Math.ceil(y+v+x+1)}function KI(n,e){var t,i,r,o,s,l,a,d,u,h,c,g,f,p,m,b,C,_;const w=re({},Nd,n);let y=0;w.tick.visible!==!1&&(y=(t=w.tick.width)!==null&&t!==void 0?t:4);let v=0;if(w.label.visible){if(w.type==="band")w.domain.forEach(S=>{var R,B,A,M,H,E,T,P,k,L,F,z,I,N,W,D;w.label.formatMethod&&(S=w.label.formatMethod(S));const{width:G,height:V}=e.measureText(S,{fontSize:(A=(B=(R=w.label)===null||R===void 0?void 0:R.style)===null||B===void 0?void 0:B.fontSize)!==null&&A!==void 0?A:Qn,fontWeight:(E=(H=(M=w.label)===null||M===void 0?void 0:M.style)===null||H===void 0?void 0:H.fontWeight)!==null&&E!==void 0?E:"normal",fontFamily:(k=(P=(T=w.label)===null||T===void 0?void 0:T.style)===null||P===void 0?void 0:P.fontFamily)!==null&&k!==void 0?k:_o}),X=((F=(L=w.label)===null||L===void 0?void 0:L.style)===null||F===void 0?void 0:F.maxLineWidth)||1/0,$=((N=(I=(z=w.label)===null||z===void 0?void 0:z.style)===null||I===void 0?void 0:I.angle)!==null&&N!==void 0?N:0)+(((D=(W=w.label)===null||W===void 0?void 0:W.style)===null||D===void 0?void 0:D.direction)==="vertical"?90:0);v=Math.max(v,wo(Math.min(G,X),V,$).height)});else{let S;if(!((i=n.sync)===null||i===void 0)&&i.tickAlign&&Ae((r=n.tick)===null||r===void 0?void 0:r.tickMode))S=n.tick.tickMode();else if(ee(n.__ticksForVTable))S=n.__ticksForVTable;else{const R=w.range,B=Math.abs(R.min)>1?Math.round(R.min):R.min,A=Math.abs(R.max)>1?Math.round(R.max):R.max;S=[Ud(B),Ud(A)]}S.forEach(R=>{var B,A,M,H,E,T,P,k,L,F,z,I,N,W,D,G;w.label.formatMethod&&(R=w.label.formatMethod(R));const{width:V,height:X}=e.measureText(R,{fontSize:(M=(A=(B=w.label)===null||B===void 0?void 0:B.style)===null||A===void 0?void 0:A.fontSize)!==null&&M!==void 0?M:Qn,fontWeight:(T=(E=(H=w.label)===null||H===void 0?void 0:H.style)===null||E===void 0?void 0:E.fontWeight)!==null&&T!==void 0?T:"normal",fontFamily:(L=(k=(P=w.label)===null||P===void 0?void 0:P.style)===null||k===void 0?void 0:k.fontFamily)!==null&&L!==void 0?L:_o}),$=((z=(F=w.label)===null||F===void 0?void 0:F.style)===null||z===void 0?void 0:z.maxLineWidth)||1/0,Q=((W=(N=(I=w.label)===null||I===void 0?void 0:I.style)===null||N===void 0?void 0:N.angle)!==null&&W!==void 0?W:0)+(((G=(D=w.label)===null||D===void 0?void 0:D.style)===null||G===void 0?void 0:G.direction)==="vertical"?90:0);v=Math.max(v,wo(Math.min(V,$),X,Q).height)})}v+=(o=w.label.space)!==null&&o!==void 0?o:4}let x=0;if(w.title.visible&&w.title.text){const{width:S,height:R}=e.measureText(w.title.text,{fontSize:(a=(l=(s=w.title)===null||s===void 0?void 0:s.style)===null||l===void 0?void 0:l.fontSize)!==null&&a!==void 0?a:Qn,fontWeight:(h=(u=(d=w.title)===null||d===void 0?void 0:d.style)===null||u===void 0?void 0:u.fontWeight)!==null&&h!==void 0?h:"normal",fontFamily:(f=(g=(c=w.title)===null||c===void 0?void 0:c.style)===null||g===void 0?void 0:g.fontFamily)!==null&&f!==void 0?f:_o}),B=((m=(p=w.label)===null||p===void 0?void 0:p.style)===null||m===void 0?void 0:m.maxLineWidth)||1/0,A=wo(Math.min(S,B),R,(C=(b=w.title)===null||b===void 0?void 0:b.style)===null||C===void 0?void 0:C.angle);x=n.orient!=="bottom"&&n.orient!=="top"||!w.title.autoRotate?A.height:A.width,x+=(_=w.title.space)!==null&&_!==void 0?_:4}return y+v+x+1}function Ud(n){return typeof n!="number"&&(n=Number(n)),Number(n.toPrecision(1)).toString()}function wo(n,e,t=0){const i=t*Math.PI/180,r=-n/2,o=-e/2,s=n/2,l=-e/2,a=n/2,d=e/2,u=-n/2,h=e/2,c={x:r*Math.cos(i)-o*Math.sin(i),y:r*Math.sin(i)+o*Math.cos(i)},g={x:s*Math.cos(i)-l*Math.sin(i),y:s*Math.sin(i)+l*Math.cos(i)},f={x:a*Math.cos(i)-d*Math.sin(i),y:a*Math.sin(i)+d*Math.cos(i)},p={x:u*Math.cos(i)-h*Math.sin(i),y:u*Math.sin(i)+h*Math.cos(i)},m=Math.min(c.x,g.x,f.x,p.x),b=Math.max(c.x,g.x,f.x,p.x),C=Math.min(c.y,g.y,f.y,p.y);return{width:b-m,height:Math.max(c.y,g.y,f.y,p.y)-C}}const YI='<svg t="1716726614852" class="icon" viewBox="0 0 1194 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="2621" width="200" height="200"><path d="M1038.694079 367.237067c13.265507 23.342857-16.633865-40.004445-63.05621-40.004446H219.018794c-26.558738 0-46.46393 13.334815-63.05621 40.004446S0.006238 607.277601 0.006238 650.608819V940.647979a82.351494 82.351494 0 0 0 82.961402 83.349526H1111.702885a82.337632 82.337632 0 0 0 82.975264-83.349526V650.608819c0-43.331218-155.970208-283.371753-155.970208-283.371752zM730.066575 667.284269a136.328386 136.328386 0 0 1-132.738243 133.33429 133.417459 133.417459 0 0 1-132.738243-133.33429v-6.681269a40.6698 40.6698 0 0 0-36.497473-26.66963H73.015044l119.458874-220.02445s23.231965-40.004445 53.103614-40.004446h713.481918c26.544876 0 29.871649 10.008042 46.436207 40.004446L1128.33675 633.947231H769.904682c-26.184476 0-39.838107 7.623855-39.838107 33.337038zM338.505391 210.559919l-89.601086-86.69016a22.178487 22.178487 0 0 1 0-33.26773 21.984425 21.984425 0 0 1 33.170699 0l89.601087 86.676299a22.317102 22.317102 0 0 1 0 33.26773 24.950798 24.950798 0 0 1-33.1707 0z m252.197118-40.059891a25.532983 25.532983 0 0 1-6.639685-16.633865l-3.326773-126.694606A28.263709 28.263709 0 0 1 603.995739 0.515788c13.251646-3.326773 23.204242 10.021904 26.544877 23.342858V153.866163a28.249847 28.249847 0 0 1-23.259688 26.66963c-6.611961-3.312911-13.279369-3.312911-16.578419-10.035765z m235.646421 33.337038a22.372548 22.372548 0 0 1 0-33.337038l86.288175-90.030795a22.039871 22.039871 0 0 1 33.170699 0 22.289379 22.289379 0 0 1 0 33.364761l-82.961401 90.003072a25.962691 25.962691 0 0 1-36.483611 0z" fill="#8a8a8a" p-id="2622"></path></svg>';class XI{constructor(e,t){this._emptyTipOption={spaceBetweenTextAndIcon:20,text:"no data",textStyle:{fontSize:14,color:"#000"},icon:{image:YI,width:100,height:100}},this.isReleased=!1,this.table=t,this._emptyTipOption=Object.assign(this._emptyTipOption,e===!0?{}:e),O(this._emptyTipOption.displayMode)||(this.table.isListTable()?this._emptyTipOption.displayMode="basedOnTable":this._emptyTipOption.displayMode="basedOnContainer"),this._emptyTipComponent=this._createOrUpdateEmptyTipComponent(this._getEmptyTipAttrs())}_createOrUpdateEmptyTipComponent(e){if(this._emptyTipComponent)Cf(e,this._cacheAttrs)||this._emptyTipComponent.setAttributes(e);else{const t=new Sw(e);t.name="emptyTip",this.table.scenegraph.stage.defaultLayer.appendChild(t),this._emptyTipComponent=t,this.bindEvents()}return this._emptyTipComponent}bindEvents(){this._emptyTipComponent.on("click",e=>{const t=new Ue;this._emptyTipComponent.forEachChildren(i=>{t.union(i.globalAABBBounds)}),t.contains(e.x,e.y)&&this.table.fireListeners("empty_tip_click",e)}),this._emptyTipComponent.on("dblclick",e=>{const t=new Ue;this._emptyTipComponent.forEachChildren(i=>{t.union(i.globalAABBBounds)}),t.contains(e.x,e.y)&&this.table.fireListeners("empty_tip_dblclick",e)})}resize(){var e;if(!this._emptyTipComponent)return;const{leftHeaderWidth:t,topHeaderHeight:i,width:r,height:o}=this.getWidthAndHeight();this._emptyTipComponent.setAttributes({spaceBetweenTextAndIcon:this._emptyTipOption.spaceBetweenTextAndIcon,x:this.table.tableX+t,y:this.table.tableY+i,width:r,height:o,text:Object.assign(Object.assign({text:this._emptyTipOption.text},this._emptyTipOption.textStyle),{fill:(e=this._emptyTipOption.textStyle)===null||e===void 0?void 0:e.color}),icon:Object.assign({},this._emptyTipOption.icon)})}release(){this._emptyTipComponent&&this.table.scenegraph.stage.defaultLayer.removeChild(this._emptyTipComponent),this._emptyTipComponent=null,this.isReleased=!0}resetVisible(){(this.table.recordsCount&&this.table.recordsCount!==0||this.table.internalProps.layoutMap.rowCount!==this.table.internalProps.layoutMap.columnHeaderLevelCount)&&this.table.internalProps.layoutMap.colCount!==this.table.internalProps.layoutMap.rowHeaderLevelCount?this.table.scenegraph.stage.defaultLayer.children.includes(this._emptyTipComponent)&&this.table.scenegraph.stage.defaultLayer.removeChild(this._emptyTipComponent):this.table.scenegraph.stage.defaultLayer.children.includes(this._emptyTipComponent)||this.table.scenegraph.stage.defaultLayer.appendChild(this._emptyTipComponent)}getWidthAndHeight(){const e=this.table.transpose||this.table.options.indicatorsAsCol===!1?this.table.getFrozenColsWidth():0,t=!this.table.transpose||this.table.options.indicatorsAsCol?this.table.getFrozenRowsHeight():0;return{leftHeaderWidth:e,topHeaderHeight:t,width:(this._emptyTipOption.displayMode!=="basedOnContainer"&&this.table.columnHeaderLevelCount>0&&this.table.colCount>this.table.rowHeaderLevelCount?this.table.getDrawRange().width:this.table.tableNoFrameWidth)-e-this.table.getTheme().scrollStyle.width,height:(this._emptyTipOption.displayMode!=="basedOnContainer"&&this.table.rowHeaderLevelCount>0&&this.table.rowCount>this.table.columnHeaderLevelCount?this.table.getDrawRange().height:this.table.tableNoFrameHeight)-t-this.table.getTheme().scrollStyle.width}}_getEmptyTipAttrs(){var e;const{leftHeaderWidth:t,topHeaderHeight:i,width:r,height:o}=this.getWidthAndHeight();return{spaceBetweenTextAndIcon:this._emptyTipOption.spaceBetweenTextAndIcon,x:this.table.tableX+t,y:this.table.tableY+i,width:r,height:o,text:Object.assign(Object.assign({text:this._emptyTipOption.text},this._emptyTipOption.textStyle),{fill:(e=this._emptyTipOption.textStyle)===null||e===void 0?void 0:e.color}),icon:Object.assign({},this._emptyTipOption.icon)}}}var qI=function(n,e){var t={};for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&e.indexOf(i)<0&&(t[i]=n[i]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function"){var r=0;for(i=Object.getOwnPropertySymbols(n);r<i.length;r++)e.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(n,i[r])&&(t[i[r]]=n[i[r]])}return t};const ZI={orient:"bottom",position:"middle",padding:30,title:{visible:!1,padding:0,textStyle:{fontSize:14,fill:"#000000",fontWeight:"normal"},space:12},item:{visible:!0,spaceCol:10,spaceRow:10,padding:2,background:{state:{selectedHover:{fill:"gray",fillOpacity:.7},unSelectedHover:{fill:"gray",fillOpacity:.2}}},shape:{space:4,state:{unSelected:{fillOpacity:.5}}},label:{space:4,style:{fill:"#89909D",fontSize:14},state:{unSelected:{fillOpacity:.5}}}},allowAllCanceled:!0,visible:!0};function JI(n,e){const t=re({},ZI,n),{title:i={},item:r={},pager:o={},background:s={},type:l,id:a,visible:d,orient:u,position:h,data:c,filter:g,regionId:f,regionIndex:p,seriesIndex:m,seriesId:b,padding:C}=t,_=qI(t,["title","item","pager","background","type","id","visible","orient","position","data","filter","regionId","regionIndex","seriesIndex","seriesId","padding"]);return i.visible&&(_.title=ev(i)),ye(r.focusIconStyle)||lt(r.focusIconStyle),In(r.shape),In(r.label),In(r.value),In(r.background),Zu(r.maxWidth)&&(r.maxWidth=Number(r.maxWidth.substring(0,r.maxWidth.length-1))*e.width/100),Zu(r.width)&&(r.width=Number(r.width.substring(0,r.width.length-1))*e.width/100),Zu(r.height)&&(r.height=Number(r.height.substring(0,r.height.length-1))*e.width/100),_.item=r,ye(o.textStyle)||lt(o.textStyle),In(o.handler),_.pager=o,s.visible&&!ye(s.style)&&(re(_,s.style),O(s.padding)&&(_.padding=s.padding)),_}class QI{constructor(e,t){var i,r,o,s;this.table=t,this.option=Or(e),this.orient=(i=e.orient)!==null&&i!==void 0?i:"left",this.visible=(r=e.visible)===null||r===void 0||r,this.position=(o=e.position)!==null&&o!==void 0?o:"middle",this.selectedData=(s=e.defaultSelected)!==null&&s!==void 0?s:null,this.createComponent(),this.initEvent()}createComponent(){const e=this.getLegendAttributes({width:this.table.tableNoFrameWidth,height:this.table.tableNoFrameHeight}),t=new gu(re({},e,{defaultSelected:this.selectedData,disableTriggerEvent:this.table.options.disableInteraction}));t.name="legend",this.legendComponent=t,this.visible===!1&&(t.setAttributes({visible:!1,visibleAll:!1}),t.hideAll()),this.table.scenegraph.stage.defaultLayer.appendChild(t),this.adjustTableSize(e)}resize(){this.legendComponent&&this.visible!==!1&&(this.legendComponent.setAttributes({maxWidth:this.table.tableNoFrameWidth,maxHeight:this.table.tableNoFrameHeight}),this.adjustTableSize(this.legendComponent.attribute))}adjustTableSize(e){var t,i;if(!this.legendComponent||this.visible===!1)return;let r=isFinite(this.legendComponent.AABBBounds.width())?this.legendComponent.AABBBounds.width():0,o=isFinite(this.legendComponent.AABBBounds.height())?this.legendComponent.AABBBounds.height():0;if(r<=0||o<=0)return;const s=this.table.tableNoFrameWidth,l=this.table.tableNoFrameHeight,a=xe((i=(t=e.padding)!==null&&t!==void 0?t:this.option.padding)!==null&&i!==void 0?i:10);let d=0,u=0;this.orient==="left"?(d=a[3],u=0,r+=a[1]+a[3]):this.orient==="top"?(d=0,u=a[0],o+=a[0]+a[2]):this.orient==="right"?(d=s-r-a[1],u=0,r+=a[1]+a[3]):this.orient==="bottom"&&(d=0,u=l-o-a[2],o+=a[0]+a[2]);const h=this.orient==="bottom"||this.orient==="top"?"horizontal":"vertical",c=this.position;let g=0,f=0;h==="horizontal"?g=c==="middle"?(s-r)/2:c==="end"?s-r-a[1]:a[3]:f=c==="middle"?(l-o)/2:c==="end"?l-o-a[2]:a[0],this.legendComponent.setAttributes({dx:g,dy:f,x:d,y:u}),this.orient==="left"?(this.table.tableNoFrameWidth=this.table.tableNoFrameWidth-Math.ceil(r),this.table.tableX+=Math.ceil(r)):this.orient==="top"?(this.table.tableNoFrameHeight=this.table.tableNoFrameHeight-Math.ceil(o),this.table.tableY+=Math.ceil(o)):this.orient==="right"?this.table.tableNoFrameWidth=this.table.tableNoFrameWidth-Math.ceil(r):this.orient==="bottom"&&(this.table.tableNoFrameHeight=this.table.tableNoFrameHeight-Math.ceil(o))}getLegendAttributes(e){var t,i;const r=this.orient==="bottom"||this.orient==="top"?"horizontal":"vertical",o=JI(this.option,e),s=xe((i=(t=o.padding)!==null&&t!==void 0?t:this.option.padding)!==null&&i!==void 0?i:10);return Object.assign({layout:r,items:this.getLegendItems(),maxWidth:e.width-s[1]-s[3],maxHeight:e.height-s[0]-s[2]},o)}getLegendItems(){return this.option.data}initEvent(){this.legendComponent&&(this.legendComponent.addEventListener(vn.legendItemClick,e=>{const t=vt(e,"detail.currentSelected");this.table.fireListeners(j.LEGEND_ITEM_CLICK,{model:this,value:t,event:e})}),this.legendComponent.addEventListener(vn.legendItemHover,e=>{const t=vt(e,"detail");this.table.fireListeners(j.LEGEND_ITEM_HOVER,{model:this,value:t,event:e})}),this.legendComponent.addEventListener(vn.legendItemUnHover,e=>{const t=vt(e,"detail");this.table.fireListeners(j.LEGEND_ITEM_UNHOVER,{model:this,value:t,event:e})}),this.legendComponent.addEventListener("legendItemAttributeUpdate",e=>{this.table.scenegraph.updateNextFrame()}))}getLegendBounds(){return{width:isFinite(this.legendComponent.AABBBounds.width())?this.legendComponent.AABBBounds.width():0,height:isFinite(this.legendComponent.AABBBounds.height())?this.legendComponent.AABBBounds.height():0}}release(){this.legendComponent&&this.table.scenegraph.stage.defaultLayer.removeChild(this.legendComponent),this.legendComponent=null}}var e3=function(n,e){var t={};for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&e.indexOf(i)<0&&(t[i]=n[i]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function"){var r=0;for(i=Object.getOwnPropertySymbols(n);r<i.length;r++)e.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(n,i[r])&&(t[i[r]]=n[i[r]])}return t};const $d={orient:"right",position:"middle",padding:30,title:{visible:!1,padding:0,textStyle:{fontSize:14,fontWeight:"normal",fill:{type:"palette",key:"titleFontColor"}},space:12},handler:{visible:!0},startText:{style:{fontSize:14,fontWeight:"normal",fill:{type:"palette",key:"labelFontColor"}}},endText:{style:{fontSize:14,fontWeight:"normal",fill:{type:"palette",key:"labelFontColor"}}},handlerText:{style:{fontSize:14,fontWeight:"normal",fill:{type:"palette",key:"labelFontColor"}}}},t3={horizontal:Object.assign(Object.assign({},$d),{rail:{width:200,height:8,style:{fill:"rgba(0,0,0,0.04)"}}}),vertical:Object.assign(Object.assign({},$d),{rail:{width:8,height:200,style:{fill:"rgba(0,0,0,0.04)"}}})},n3={horizontal:Object.assign({sizeBackground:{fill:"#cdcdcd"},track:{style:{fill:"rgba(20,20,20,0.1)"}},rail:{width:200,height:4,style:{fill:"rgba(0,0,0,0.04)"}}},$d),vertical:Object.assign({sizeBackground:{fill:"#cdcdcd"},track:{style:{fill:"rgba(20,20,20,0.1)"}},rail:{width:4,height:200,style:{fill:"rgba(0,0,0,0.04)"}}},$d)};function i3(n,e){const t=re({},(n.type==="color"?t3:n3)[n.orient==="bottom"||n.orient==="top"?"horizontal":"vertical"],n),{title:i={},handler:r={},rail:o={},track:s={},startText:l,endText:a,handlerText:d,sizeBackground:u,background:h={},type:c,id:g,visible:f,orient:p,position:m,data:b,defaultSelected:C,field:_,filter:w,regionId:y,regionIndex:v,seriesIndex:x,seriesId:S,padding:R}=t,B=e3(t,["title","handler","rail","track","startText","endText","handlerText","sizeBackground","background","type","id","visible","orient","position","data","defaultSelected","field","filter","regionId","regionIndex","seriesIndex","seriesId","padding"]);return i.visible&&(B.title=ev(i)),B.showHandler=r.visible!==!1,ye(r.style)||(B.handlerStyle=lt(r.style)),O(o.width)&&(B.railWidth=o.width),O(o.height)&&(B.railHeight=o.height),ye(o.style)||(B.railStyle=lt(o.style)),ye(s.style)||(B.trackStyle=lt(s.style)),B.startText=In(l),B.endText=In(a),B.handlerText=In(d),ye(u)||(B.sizeBackground=lt(u)),h.visible&&!ye(h.style)&&(re(B,h.style),O(h.padding)&&(B.padding=h.padding)),B}class r3{constructor(e,t){var i,r,o,s;this.table=t,this.option=Or(e),this.orient=(i=e.orient)!==null&&i!==void 0?i:"left",this.visible=(r=e.visible)===null||r===void 0||r,this.position=(o=e.position)!==null&&o!==void 0?o:"middle",this.selectedData=(s=e.defaultSelected)!==null&&s!==void 0?s:null,this.createComponent(),this.initEvent()}createComponent(){const e=this.getLegendAttributes({width:this.table.tableNoFrameWidth,height:this.table.tableNoFrameHeight});let t;t=this.option.type==="color"?new pu(re({},e,{slidable:!0})):new mu(re({},e,{slidable:!0})),t.name="legend",this.legendComponent=t,this.visible===!1&&(t.setAttributes({visible:!1,visibleAll:!1}),t.hideAll()),this.table.scenegraph.stage.defaultLayer.appendChild(t),this.adjustTableSize(e)}resize(){this.legendComponent&&this.visible!==!1&&(this.legendComponent.setAttributes({width:this.table.tableNoFrameWidth,height:this.table.tableNoFrameHeight}),this.adjustTableSize(this.legendComponent.attribute))}adjustTableSize(e){var t,i;if(!this.legendComponent||this.visible===!1)return;let r=isFinite(this.legendComponent.AABBBounds.width())?this.legendComponent.AABBBounds.width():0,o=isFinite(this.legendComponent.AABBBounds.height())?this.legendComponent.AABBBounds.height():0;if(r<=0||o<=0)return;const s=this.table.tableNoFrameWidth,l=this.table.tableNoFrameHeight,a=xe((i=(t=e.padding)!==null&&t!==void 0?t:this.option.padding)!==null&&i!==void 0?i:10);let d=0,u=0;this.orient==="left"?(d=a[3],u=0,r+=a[1]+a[3]):this.orient==="top"?(d=0,u=a[0],o+=a[0]+a[2]):this.orient==="right"?(d=s-r-a[1],u=0,r+=a[1]+a[3]):this.orient==="bottom"&&(d=0,u=l-o-a[2],o+=a[0]+a[2]);const h=this.orient==="bottom"||this.orient==="top"?"horizontal":"vertical",c=this.position;let g=0,f=0;h==="horizontal"?g=c==="middle"?(s-r)/2:c==="end"?s-r-a[1]:a[3]:f=c==="middle"?(l-o)/2:c==="end"?l-o-a[2]:a[0],this.legendComponent.setAttributes({dx:g,dy:f,x:d,y:u}),this.orient==="left"?(this.table.tableNoFrameWidth=this.table.tableNoFrameWidth-Math.ceil(r),this.table.tableX+=Math.ceil(r)):this.orient==="top"?(this.table.tableNoFrameHeight=this.table.tableNoFrameHeight-Math.ceil(o),this.table.tableY+=Math.ceil(o)):this.orient==="right"?this.table.tableNoFrameWidth=this.table.tableNoFrameWidth-Math.ceil(r):this.orient==="bottom"&&(this.table.tableNoFrameHeight=this.table.tableNoFrameHeight-Math.ceil(o))}getLegendAttributes(e){const t=this.orient==="bottom"||this.orient==="top"?"horizontal":"vertical",i=t==="horizontal"?"bottom":this.orient;return Object.assign(Object.assign({},i3(this.option)),{layout:t,align:i,min:this.option.min,max:this.option.max,value:this.option.value,[this.option.type==="color"?"colors":"sizeRange"]:this.option.type==="color"?this.option.colors:this.option.sizeRange})}initEvent(){this.legendComponent&&this.legendComponent.addEventListener("change",e=>{const t=vt(e,"detail.value");this.table.fireListeners(j.LEGEND_CHANGE,{model:this,value:t,event:e}),this.table.scenegraph.updateNextFrame()})}getLegendBounds(){return{width:isFinite(this.legendComponent.AABBBounds.width())?this.legendComponent.AABBBounds.width():0,height:isFinite(this.legendComponent.AABBBounds.height())?this.legendComponent.AABBBounds.height():0}}release(){this.legendComponent&&this.table.scenegraph.stage.defaultLayer.removeChild(this.legendComponent),this.legendComponent=null}}function o3(n,e){return n.type==="color"||n.type==="size"?new r3(n,e):new QI(n,e)}class cv{constructor(e){this._table=e}release(){this.unbindMenuElement(),this._menuElement&&this._menuElement.release(),this._menuElement=void 0}_getMenuElement(){return this._menuElement||(this._menuElement=this.createMenuElementInternal()),this._menuElement}bindMenuElement(e,t,i){return this._getMenuElement().bindToCell(this._table,e,t,i)}unbindMenuElement(){this._getMenuElement().unbindFromCell()}pointInMenuElement(e,t){return this._getMenuElement().pointInMenuElement(e,t)}getRootElement(){return this._getMenuElement().rootElement}}const hg="vtable__menu-element",Qr=`${hg}--hidden`,wh=`${hg}--shown`;function s3(){return Jn("div",[hg,Qr])}class l3{constructor(e){var t,i,r;this._handler=new wu,this._rootElement=s3(),this._rootElement.addEventListener("wheel",o=>{o.stopPropagation()}),(t=this._rootElement)===null||t===void 0||t.addEventListener("mousedown",o=>{o.stopPropagation(),o.preventDefault()}),(i=this._rootElement)===null||i===void 0||i.addEventListener("click",o=>{if(o.stopPropagation(),o.preventDefault(),this._rootElement.classList.contains(Qr))return;const{col:s,row:l,dropDownIndex:a,menuKey:d,text:u,hasChildren:h}=o.target;if(typeof a!="number"||h)return void o.stopPropagation();const c=e.isPivotTable()?e.internalProps.layoutMap.getPivotDimensionInfo(s,l):e.getHeaderField(s,l),g=e._dropDownMenuIsHighlight(s,l,a);e.fireListeners(j.DROPDOWN_MENU_CLICK,{col:s,row:l,field:c,menuKey:d,text:u,highlight:g,cellLocation:e.getCellLocation(s,l),event:o}),e.fireListeners(j.DROPDOWN_MENU_CLEAR,null),e.fireListeners(j.HIDE_MENU,null),o.stopPropagation()}),(r=this._rootElement)===null||r===void 0||r.addEventListener("mousemove",o=>{this._rootElement.classList.contains(Qr)||o.stopPropagation()})}get rootElement(){return this._rootElement}release(){this.unbindFromCell();const e=this._rootElement;e!=null&&e.parentElement&&e.parentElement.removeChild(e),this._handler.release(),delete this._rootElement}bindToCell(e,t,i,r){const o=this._rootElement;if(this._menuInstanceInfo=r,o==null||o.classList.remove(wh),o==null||o.classList.add(Qr),this._canBindToCell(e,t,i)){if(o.innerHTML="",o.appendChild(r.content),this._bindCell(e,t,i,r.position,r.referencePosition))return o==null||o.classList.add(wh),o==null||o.classList.remove(Qr),!0}else this.unbindFromCell();return!1}unbindFromCell(){const e=this._rootElement;this._menuInstanceInfo=void 0,e!=null&&e.parentElement&&(e.classList.remove(wh),e.classList.add(Qr))}_canBindToCell(e,t,i){var r;const o=e.getCellRangeRelativeRect({col:t,row:i}),s=(r=e.internalProps.menu.parentElement)!==null&&r!==void 0?r:e.getElement(),{top:l,bottom:a,left:d,right:u}=o;if(e.isFrozenCell(t,i))return!0;if(a<e.getFrozenRowsHeight()||u<e.getFrozenColsWidth()||d>e.tableNoFrameWidth-e.getRightFrozenColsWidth()||l>e.tableNoFrameHeight-e.getBottomFrozenRowsHeight())return!1;const{offsetHeight:h,offsetWidth:c}=s;return!(h<l)&&!(c<d)}_bindCell(e,t,i,r,o){var s;const l=this._rootElement,a=(s=e.internalProps.menu.parentElement)!==null&&s!==void 0?s:e.getElement(),{width:d,height:u,left:h,top:c}=a.getBoundingClientRect();if(l){l.parentElement!==a&&a.appendChild(l),l.style.left="0px";const g=.8*d;l.style.maxWidth=`${g}px`;const f=l.clientWidth,p=l.clientHeight;let m,b;r&&(m=r.x,b=r.y),o&&(m=o.rect.right-f,b=o.rect.bottom),b+p>u&&(b=u-p,m+=f-2),b<0&&(b/=2);let C=0,_=0;if(e.getElement()!==a){const{left:w,top:y}=e.getElement().getBoundingClientRect();C=y-c,_=w-h}return l.style.top=`${b+C}px`,m<0?m=0:m+f>d&&(m=d-f),l.style.left=`${m+_}px`,!0}return!1}pointInMenuElement(e,t){const i=this._rootElement,{x:r,y:o,width:s,height:l}=i.getBoundingClientRect();return e>r-5&&e<r+s+5&&t>o-5&&t<o+l+5}}class A_ extends cv{createMenuElementInternal(){return new NF(this._table)}}class a3 extends cv{createMenuElementInternal(){return new l3(this._table)}}const d3={"dropdown-menu":function(n){return new A_(n)},"context-menu":function(n){return new A_(n)},container:n=>new a3(n)};function u3(n,e,t,i,r){var o,s;const{lineHeight:l,textBaseline:a,textStick:d}=n._getCellStyle(e,t);let u=n.getCellRangeRelativeRect(n.getCellRange(e,t));d&&(u=n.getVisibleCellRangeRelativeRect({col:e,row:t}));let{left:h,right:c,bottom:g,top:f,width:p,height:m}=u;if(n.isHeader(e,t)&&({left:h,right:c,bottom:g,top:f,width:p,height:m}=n.internalProps.headerHelper.getDropDownIconRect(u,l,a||"middle")),r==null?void 0:r.content)return{type:i,position:r.position,referencePosition:(o=r.referencePosition)!==null&&o!==void 0?o:{rect:{left:h,right:c,top:f,bottom:g,width:p,height:m}},content:r.content};if(i==="dropdown-menu"){let b=n.globalDropDownMenu;const C=n._getHeaderLayoutMap(e,t);b=(s=C.dropDownMenu)!==null&&s!==void 0?s:b;const _=C.pivotInfo;return typeof b=="function"&&(b=b({row:t,col:e,table:n})),{type:i,referencePosition:{rect:{left:h,right:c,top:f,bottom:g,width:p,height:m}},content:b,pivotInfo:_}}return null}class h3{constructor(e){this._table=e,this._menuInstances={},this._bindTableEvent(e)}release(){const e=this._menuInstances;for(const t in e)e[t].release();delete this._menuInstances,this._attachInfo=null}_bindToCell(e,t,i,r){var o;const s=this._attachInfo,l=this._getMenuInstanceInfo(e,t,i,r);if(!s||l&&s.instance===l.instance||((o=s.instance)===null||o===void 0||o.unbindMenuElement(),this._attachInfo=null),!l)return;const{instance:a,info:d}=l;if(a&&a.bindMenuElement(e,t,d)){const u=this._table.getCellRange(e,t);this._attachInfo={range:u,instance:a}}}_unbindFromCell(){const e=this._attachInfo;if(!e)return;const{instance:t}=e;t==null||t.unbindMenuElement(),this._attachInfo=null}_isBindToCell(e,t){const i=this._attachInfo;return!!i&&Mn(i.range,e,t)}pointInMenuElement(e,t){if(!this._attachInfo)return!1;const i=this._attachInfo,{instance:r}=i;return r.pointInMenuElement(e,t)}_bindTableEvent(e){e.on(j.DROPDOWN_ICON_CLICK,t=>{this._attachInfo&&this._isBindToCell(t.col,t.row)?this._unbindFromCell():this._bindToCell(t.col,t.row,"dropdown-menu")}),e.on(j.DROPDOWN_MENU_CLEAR,t=>{this._unbindFromCell()}),e.on(j.CONTEXTMENU_CELL,t=>{var i,r,o,s;if(((i=e.internalProps.menu)===null||i===void 0?void 0:i.renderMode)==="html"){const l=e._getMouseAbstractPoint(t.event,!1);let a=null;l.inTable&&typeof((r=e.internalProps.menu)===null||r===void 0?void 0:r.contextMenuItems)=="function"?a=e.internalProps.menu.contextMenuItems(e.getHeaderField(t.col,t.row),t.row,t.col,e):l.inTable&&Array.isArray((o=e.internalProps.menu)===null||o===void 0?void 0:o.contextMenuItems)&&(a=(s=e.internalProps.menu)===null||s===void 0?void 0:s.contextMenuItems),this._bindToCell(t.col,t.row,"context-menu",{content:a,position:{x:l.x,y:l.y}})}})}_getMenuInstanceInfo(e,t,i,r){const o=this._table,s=this._menuInstances,l=u3(o,e,t,i,r);return l?{instance:s&&s[i]||s&&(s[i]=d3[i](o)),type:i,info:l}:null}containElement(e){var t;for(const i in this._menuInstances)if(!((t=this._menuInstances[i].getRootElement())===null||t===void 0)&&t.contains(e))return!0;return!1}}class c3{constructor(e,t){this.isReleased=!1,this.table=t,this._titleOption=re({orient:"top"},e),e.visible!==!1&&(this._titleComponent=this._createOrUpdateTitleComponent(this._getTitleAttrs()))}_createOrUpdateTitleComponent(e){if(this._titleComponent)Cf(e,this._cacheAttrs)||this._titleComponent.setAttributes(e);else{const t=new yw(e);t.name="title",this.table.scenegraph.stage.defaultLayer.appendChild(t),this._titleComponent=t}return this._adjustTableSize(this._titleComponent.attribute),this._titleComponent}resize(){var e,t,i,r,o;if(!this._titleComponent)return;const s=xe((e=this._titleOption.padding)!==null&&e!==void 0?e:10),l=(t=this._titleOption.width)!==null&&t!==void 0?t:(this.table.widthMode==="adaptive"?this.table.tableNoFrameWidth:Math.min(this.table.tableNoFrameWidth,this.table.getDrawRange().width))-s[1]-s[3],a=(i=this._titleOption.height)!==null&&i!==void 0?i:(this.table.heightMode==="adaptive"?this.table.tableNoFrameHeight:Math.min(this.table.tableNoFrameHeight,this.table.getDrawRange().height))-s[0]-s[2];this._titleComponent.setAttributes({x:((r=this._titleOption.x)!==null&&r!==void 0?r:this._titleOption.orient==="right")?this.table.tableX+Math.min(this.table.tableNoFrameWidth,this.table.getDrawRange().width):this.table.tableX,y:((o=this._titleOption.y)!==null&&o!==void 0?o:this._titleOption.orient==="bottom")?this.table.tableY+this.table.tableNoFrameHeight:this.table.tableY,width:this._titleOption.orient==="top"||this._titleOption.orient==="bottom"?l:this._titleOption.width,height:this._titleOption.orient==="left"||this._titleOption.orient==="right"?a:this._titleOption.height,textStyle:Object.assign({width:l},this._titleOption.textStyle),subtextStyle:Object.assign({width:l},this._titleOption.subtextStyle)}),this._adjustTableSize(this._titleComponent.attribute)}_adjustTableSize(e){var t,i,r,o;const s=isFinite((t=this._titleComponent)===null||t===void 0?void 0:t.AABBBounds.width())?this._titleComponent.AABBBounds.width():0,l=isFinite((i=this._titleComponent)===null||i===void 0?void 0:i.AABBBounds.height())?this._titleComponent.AABBBounds.height():0;this._titleOption.orient==="left"?(this.table.tableNoFrameWidth=this.table.tableNoFrameWidth-Math.ceil(s),this.table.tableX+=Math.ceil(s)):this._titleOption.orient==="top"?(this.table.tableNoFrameHeight=this.table.tableNoFrameHeight-Math.ceil(l),this.table.tableY+=Math.ceil(l)):this._titleOption.orient==="right"?this.table.tableNoFrameWidth=this.table.tableNoFrameWidth-Math.ceil(s):this._titleOption.orient==="bottom"&&(this.table.tableNoFrameHeight=this.table.tableNoFrameHeight-Math.ceil(l)),this._cacheAttrs=e,this._titleOption.orient!=="right"&&this._titleOption.orient!=="bottom"||this._titleComponent.setAttributes({x:((r=this._titleOption.x)!==null&&r!==void 0?r:this._titleOption.orient==="right")?this.table.tableX+this.table.tableNoFrameWidth:this.table.tableX,y:((o=this._titleOption.y)!==null&&o!==void 0?o:this._titleOption.orient==="bottom")?this.table.tableY+this.table.tableNoFrameHeight:this.table.tableY})}release(){this._titleComponent&&this.table.scenegraph.stage.defaultLayer.removeChild(this._titleComponent),this._titleComponent=null,this.isReleased=!0}_getTitleAttrs(){var e,t,i,r,o,s,l,a,d,u,h;const c=this._titleOption.text||this._titleOption.subtext?10:0,g=xe((e=this._titleOption.padding)!==null&&e!==void 0?e:c),f=(t=this._titleOption.width)!==null&&t!==void 0?t:Math.min(this.table.tableNoFrameWidth,this.table.getDrawRange().width)-g[1]-g[3],p=(i=this._titleOption.height)!==null&&i!==void 0?i:Math.min(this.table.tableNoFrameHeight,this.table.getDrawRange().height)-g[0]-g[2];return{text:(r=this._titleOption.text)!==null&&r!==void 0?r:"",subtext:(o=this._titleOption.subtext)!==null&&o!==void 0?o:"",x:((s=this._titleOption.x)!==null&&s!==void 0?s:this._titleOption.orient==="right")?this.table.tableX+Math.min(this.table.tableNoFrameWidth,this.table.getDrawRange().width):this.table.tableX,y:((l=this._titleOption.y)!==null&&l!==void 0?l:this._titleOption.orient==="bottom")?this.table.tableY+this.table.tableNoFrameHeight:this.table.tableY,width:this._titleOption.orient==="top"||this._titleOption.orient==="bottom"?f:this._titleOption.width,height:this._titleOption.orient==="left"||this._titleOption.orient==="right"?p:this._titleOption.height,minWidth:this._titleOption.minWidth,maxWidth:this._titleOption.maxWidth,minHeight:this._titleOption.minHeight,maxHeight:this._titleOption.maxHeight,padding:this._titleOption.padding,align:(a=this._titleOption.align)!==null&&a!==void 0?a:"left",verticalAlign:(d=this._titleOption.verticalAlign)!==null&&d!==void 0?d:"top",textStyle:Object.assign({width:f},this._titleOption.textStyle),subtextStyle:Object.assign({width:f},this._titleOption.subtextStyle),dx:(u=this._titleOption.dx)!==null&&u!==void 0?u:0,dy:(h=this._titleOption.dy)!==null&&h!==void 0?h:0}}getComponentGraphic(){return this._titleComponent}}class f3{constructor(e){this._table=e}release(){var e,t;this.unbindTooltipElement(),this._tooltipElement&&((t=(e=this._tooltipElement).release)===null||t===void 0||t.call(e)),this._tooltipElement=void 0}_getTooltipElement(){return this._tooltipElement||(this._tooltipElement=this.createTooltipElementInternal()),this._tooltipElement}bindTooltipElement(e,t,i,r){return this._getTooltipElement().bindToCell(this._table,e,t,i,r)}moveTooltipElement(e,t,i,r){this._getTooltipElement().move(this._table,e,t,i,r)}unbindTooltipElement(){this._getTooltipElement().unbindFromCell()}locateTooltipElement(e,t,i,r,o){this._getTooltipElement()._locate(this._table,e,t,i,r,o)}}function g3(){if(Me.mode==="node")return;const n=document.createElement("style");n.id="vtable-tooltip-styleSheet",n.textContent=`
@keyframes vtable__bubble-tooltip-element--shown-animation {
	0% {
		opacity: 0;
	}
	100% {
		opacity: 1;
	}
}
.vtable__bubble-tooltip-element {
	position: absolute;
	
	// pointer-events: none;
	//user-select: none;
	max-width: 300px;
	z-index: 99999;

	background: #FFFFFF;
    border: 1px solid #E6E8ED;
    box-sizing: border-box;
    border-radius: 4px;
    box-shadow: 0px 2px 4px rgb(27 31 35 / 8%);
    color: #141414;
    font-size: 13px;
}
.vtable__bubble-tooltip-element--hidden {
	opacity: 0;
  pointer-events: none;
	user-select: none;
	/* transform: translate(-50%, -50%); */
	transition: opacity 75ms linear;
}
.vtable__bubble-tooltip-element--shown {
	opacity: 1;
	/* transform: translate(-50%, -50%); */
	animation: vtable__bubble-tooltip-element--shown-animation 150ms ease-out;
}
.vtable__bubble-tooltip-element__content {
	/* font-size: .75rem; */
	padding: 6px 8px;
	min-height: 1em;
	line-height: 1.5;
	width: 100%;
	display: block;
	white-space: pre-wrap;
	margin: 0;
	box-sizing: border-box;
	overflow: auto;
	word-wrap: break-word;
	position: relative;
	background-color: #FFF;
	z-index: 2;
	border-radius: 4px;
}
/*  WebKit Microsoft Edge（新版）： */
.vtable__bubble-tooltip-element__content::-webkit-scrollbar {
  width: 0;
  height: 0;
  background-color: transparent;
}
/*  Opera Firefox  */
.vtable__bubble-tooltip-element__content > scrollbar-track {
  width: 0;
  height: 0;
  background-color: transparent;
}
/* Internet Explorer 11 和 Microsoft Edge（旧版） */
.vtable__bubble-tooltip-element__content > scrollbar {
  width: 0;
  height: 0;
  background-color: transparent;
}
.vtable__bubble-tooltip-element__triangle {
	/* font-size: .75rem; */
	position: absolute;
	width: 10px;
	height: 10px;
	display: block;
	transform: rotate(45deg);
    transform-origin: 50% 50% 0;
	z-index: 1;
	background-color: #FFF;
	border: 1px solid #E6E8ED;
}
`,document.head.appendChild(n)}g3();const pl="vtable__bubble-tooltip-element",B_=`${pl}__content`,M_=`${pl}__triangle`,qr=`${pl}--hidden`,rs=`${pl}--shown`;class p3{constructor(){this._handler=new wu;const e=this._rootElement=Jn("div",[pl,qr]),t=Jn("div",[B_]),i=Jn("span",[M_]);e.appendChild(i),e.appendChild(t),this._messageElement=e.querySelector(`.${B_}`)||void 0,this._triangleElement=e.querySelector(`.${M_}`)||void 0,e.addEventListener("mousemove",()=>{this._disappearDelayId&&clearTimeout(this._disappearDelayId)}),e.addEventListener("mouseleave",()=>{this._disappearDelay=void 0,this.unbindFromCell()}),t.addEventListener("wheel",r=>{r.stopPropagation()}),t.addEventListener("copy",r=>{w2(t)&&r.stopPropagation()})}bindToCell(e,t,i,r,o){var s,l,a,d,u,h,c,g,f,p,m,b,C,_,w,y,v,x,S;this._disappearDelay=r==null?void 0:r.disappearDelay,this._disappearDelayId&&clearTimeout(this._disappearDelayId);const R=this._rootElement,B=this._messageElement,A=this._triangleElement;if(R==null||R.classList.remove(rs),R==null||R.classList.add(qr),this._canBindToCell(e,t,i)){if(B.setAttribute("style",""),A.setAttribute("style",""),r!=null&&r.className&&R.classList.add(r.className),!((s=r==null?void 0:r.style)===null||s===void 0)&&s.bgColor&&(B.style.backgroundColor=(l=r==null?void 0:r.style)===null||l===void 0?void 0:l.bgColor),!((a=r==null?void 0:r.style)===null||a===void 0)&&a.bgColor&&(A.style.backgroundColor=(d=r==null?void 0:r.style)===null||d===void 0?void 0:d.bgColor),A.style.display=((u=r==null?void 0:r.style)===null||u===void 0?void 0:u.arrowMark)===!0?"block":"none",!((h=r==null?void 0:r.style)===null||h===void 0)&&h.fontSize&&(B.style.fontSize=((g=(c=r==null?void 0:r.style)===null||c===void 0?void 0:c.fontSize)!==null&&g!==void 0?g:12)+"px"),!((f=r==null?void 0:r.style)===null||f===void 0)&&f.fontFamily&&(B.style.fontFamily=(p=r==null?void 0:r.style)===null||p===void 0?void 0:p.fontFamily),!((m=r==null?void 0:r.style)===null||m===void 0)&&m.color&&(B.style.color=(b=r==null?void 0:r.style)===null||b===void 0?void 0:b.color),!((C=r==null?void 0:r.style)===null||C===void 0)&&C.padding&&(B.style.padding=`${(_=r==null?void 0:r.style)===null||_===void 0?void 0:_.padding.join("px ")}px`),!((w=r==null?void 0:r.style)===null||w===void 0)&&w.maxHeight&&(B.style.maxHeight=`${(y=r==null?void 0:r.style)===null||y===void 0?void 0:y.maxHeight}px`),!((v=r==null?void 0:r.style)===null||v===void 0)&&v.maxWidth&&(B.style.maxWidth=`${(x=r==null?void 0:r.style)===null||x===void 0?void 0:x.maxWidth}px`),B&&(B.textContent=r==null?void 0:r.content),this._bindToCell(e,t,i,r==null?void 0:r.position,r==null?void 0:r.referencePosition,o,(S=r==null?void 0:r.style)===null||S===void 0?void 0:S.arrowMark))return R==null||R.classList.add(rs),R==null||R.classList.remove(qr),!0}else this.unbindFromCell();return!1}release(){var e,t;this.unbindFromCell();const i=this._rootElement;i!=null&&i.parentElement&&i.parentElement.removeChild(i),(t=(e=this._handler)===null||e===void 0?void 0:e.release)===null||t===void 0||t.call(e),delete this._rootElement,delete this._messageElement}move(e,t,i,r,o){const s=this._rootElement;this._canBindToCell(e,t,i)?(this._bindToCell(e,t,i,r==null?void 0:r.position,r==null?void 0:r.referencePosition,o),s==null||s.classList.add(rs),s==null||s.classList.remove(qr)):this.unbindFromCell()}unbindFromCell(){var e;if(this._disappearDelay)this._disappearDelayId=setTimeout(()=>{const t=this._rootElement;t!=null&&t.parentElement&&(t.classList.remove(rs),t.classList.add(qr))},(e=this._disappearDelay)!==null&&e!==void 0?e:0);else{const t=this._rootElement;t!=null&&t.parentElement&&(t.classList.remove(rs),t.classList.add(qr))}}_canBindToCell(e,t,i){const r=e.getCellRangeRelativeRect({col:t,row:i}),o=e.getElement(),{bottom:s,left:l,right:a,top:d}=r;if(e.isFrozenCell(t,i))return!0;if(s<e.getFrozenRowsHeight()||a<e.getFrozenColsWidth()||l>e.tableNoFrameWidth-e.getRightFrozenColsWidth()||d>e.tableNoFrameHeight-e.getBottomFrozenRowsHeight())return!1;const{offsetHeight:u,offsetWidth:h}=o;return!(d>u)&&!(l>h)}_bindToCell(e,t,i,r,o,s,l){const a=this._rootElement,d=e.getCellRangeRelativeRect({col:t,row:i}),u=e.internalProps.tooltip.parentElement,h=e.internalProps.element.offsetWidth,{width:c}=d;if(a){let g,f;a.parentElement!==u&&u.appendChild(a),a.style.left="0px";const p=Math.min(.8*h,4*c);a.style.maxWidth=`${p}px`;const m=a.clientWidth,b=a.clientHeight;if(!r&&!o)return!1;{const B=this.getComputedPosition(e,t,i,r,o,s,l);f=B.x,g=B.y}a.style.left=`${f}px`,a.style.top=`${g}px`,Nc()&&(a.style.fontSize="11px");const{x1:C,x2:_,y1:w,y2:y}=e.stateManager.menu.bounds,v=f,x=v+m,S=g,R=v+b;return!(e.stateManager.menu.isShow&&C<x&&_>v&&y>S&&w<R)}return!1}getComputedPosition(e,t,i,r,o,s,l){var a;const d=this._rootElement,u=e.getCellRangeRelativeRect({col:t,row:i}),{x:h,y:c}=e.internalProps.tooltip.parentElement.getBoundingClientRect(),{width:g,height:f,x:p,y:m}=e.internalProps.element.getBoundingClientRect(),{width:b}=u;let C,_;const w=Math.min(.8*g,4*b);d.style.maxWidth=`${w}px`;const y=d.clientWidth,v=d.clientHeight,x=l?6:0;if(r)_=r.x,C=r.y+x,this._triangleElement.style.left="50%",this._triangleElement.style.marginLeft="-5px",this._triangleElement.style.top="-5px";else if(o){let S=(a=o.placement)!==null&&a!==void 0?a:sn.bottom;const R=o.rect.left+o.rect.width/2,B=o.rect.top+o.rect.height/2,A=o.rect.top,M=o.rect.bottom,H=o.rect.left,E=o.rect.right;let T=0;const P=()=>{T++,T>=4||(this.removeStyleFromTriangle(),S===sn.top?(_=R-y/2,C=A-v-x,this._triangleElement.style.left="50%",this._triangleElement.style.marginLeft="-5px",this._triangleElement.style.bottom="-5px",s&&C<0&&(S=sn.right,P())):S===sn.bottom?(_=R-y/2,C=M+x,this._triangleElement.style.left="50%",this._triangleElement.style.marginLeft="-5px",this._triangleElement.style.top="-5px",s&&C+v>f&&(S=sn.left,P())):S===sn.left?(C=B-v/2,_=H-y-x,this._triangleElement.style.top="50%",this._triangleElement.style.marginTop="-5px",this._triangleElement.style.right="-5px",s&&_<0&&(S=sn.top,P())):S===sn.right&&(C=B-v/2,_=E+x,this._triangleElement.style.top="50%",this._triangleElement.style.marginTop="-5px",this._triangleElement.style.left="-5px",s&&_+y>g&&(S=sn.bottom,P())))};P()}return s&&(_<0?_=0:_+d.offsetWidth>g&&(_=g-d.offsetWidth)),{x:_+p-h,y:C+m-c}}removeStyleFromTriangle(){this._triangleElement.style.left="",this._triangleElement.style.right="",this._triangleElement.style.top="",this._triangleElement.style.bottom="",this._triangleElement.style.marginLeft="",this._triangleElement.style.marginTop=""}_locate(e,t,i,r,o,s){const l=this.getComputedPosition(e,t,i,r,o,s),a=l.x,d=l.y;this._rootElement.style.left=`${a}px`,this._rootElement.style.top=`${d}px`}}class m3 extends f3{createTooltipElementInternal(){return new p3}}const b3={"bubble-tooltip":function(n){return new m3(n)}};class C3{constructor(e,t){this._table=e,this._tooltipInstances={},this._bindTableEvent(e),this.confine=t}release(){var e,t;const i=this._tooltipInstances;for(const r in i)(t=(e=i[r])===null||e===void 0?void 0:e.release)===null||t===void 0||t.call(e);delete this._tooltipInstances,this._attachInfo=null}_bindToCell(e,t,i){var r;const o=this._attachInfo,s=this._getTooltipInstanceInfo(e,t);if(!o||s&&o.instance===s||((r=o.instance)===null||r===void 0||r.unbindTooltipElement(),this._attachInfo=null),!!s&&s&&s.bindTooltipElement(e,t,i,this.confine)){const l=this._table.getCellRange(e,t);this._attachInfo={range:l,instance:s,tooltipOptions:i}}}_move(e,t,i){const r=this._attachInfo;if(!r||!Mn(r.range,e,t))return;const{instance:o}=r;o==null||o.moveTooltipElement(e,t,i,this.confine)}moveToPosition(e,t,i,r){const o=this._attachInfo;if(!o||!Mn(o.range,e,t))return;const{instance:s}=o;this._attachInfo.tooltipOptions.position=i,this._attachInfo.tooltipOptions.referencePosition=r,s==null||s.locateTooltipElement(e,t,i,r,this.confine)}_unbindFromCell(){const e=this._attachInfo;if(!e)return;const{instance:t}=e;t==null||t.unbindTooltipElement(),this._attachInfo=null}_isBindCell(e,t){const i=this._attachInfo;return!!i&&Mn(i.range,e,t)}_bindTableEvent(e){e.on(j.MOUSEENTER_CELL,t=>{if(Nc())return;const{x1:i,x2:r,y1:o,y2:s}=e.stateManager.menu.bounds;if(e.stateManager.menu.isShow&&typeof t.x=="number"&&typeof t.y=="number"&&t.x>i&&t.x<r&&t.y>o&&t.y<s)return;const{col:l,row:a}=t;this.showTooltip(l,a)}),e.on(j.MOUSEMOVE_CELL,t=>{var i,r;if(!Nc()){if(!((r=(i=this._attachInfo)===null||i===void 0?void 0:i.tooltipOptions)===null||r===void 0)&&r.referencePosition){const o=this._attachInfo.tooltipOptions.referencePosition,{event:s}=t,{left:l,right:a,top:d,bottom:u}=o.rect,h=e._getMouseAbstractPoint(s,!1);h.inTable&&h.x>=l-5&&h.x<=a+5&&h.y>=d-5&&h.y<=u+5||this._unbindFromCell()}this._attachInfo&&e.stateManager.menu.isShow&&this._bindToCell(t.col,t.row)}}),e.on(j.MOUSELEAVE_CELL,t=>{this._unbindFromCell()}),e.on(j.SELECTED_CELL,t=>{this._isBindCell(t.col,t.row)&&this._unbindFromCell()}),e.on(j.MOUSELEAVE_TABLE,t=>{this._unbindFromCell()}),e.on(j.SCROLL,t=>{this._unbindFromCell()})}showTooltip(e,t){var i,r,o;let s;const l=this._table,a=l.getHeaderDescription(e,t);if(a){const d=l.getCellRangeRelativeRect({col:e,row:t});s={content:a,referencePosition:{placement:l.internalProps.tooltip.position,rect:d},disappearDelay:(i=l.internalProps.tooltip.overflowTextTooltipDisappearDelay)!==null&&i!==void 0?i:0,style:l.theme.tooltipStyle}}else if(Ae((r=l.internalProps.tooltip)===null||r===void 0?void 0:r.isShowOverflowTextTooltip)?l.internalProps.tooltip.isShowOverflowTextTooltip(e,t,l):l.internalProps.tooltip.isShowOverflowTextTooltip){const d=l.getCellOverflowText(e,t),u=l.getCellRangeRelativeRect({col:e,row:t});d&&(s={content:a?`${a}
  ${d}`:d,referencePosition:{placement:l.internalProps.tooltip.position,rect:u},disappearDelay:(o=l.internalProps.tooltip.overflowTextTooltipDisappearDelay)!==null&&o!==void 0?o:0,style:l.theme.tooltipStyle})}s?this._bindToCell(e,t,s):this._unbindFromCell()}_getTooltipInstanceInfo(e,t){const i=this._table,r=this._tooltipInstances;return r&&r["bubble-tooltip"]||r&&(r["bubble-tooltip"]=b3["bubble-tooltip"](i))}isBinded(e){var t;return JSON.stringify(e)===JSON.stringify((t=this._attachInfo)===null||t===void 0?void 0:t.tooltipOptions)}}const _3=()=>{ue.registerComponent("axis",GI),ue.registerFunction("computeAxisComponentWidth",$I),ue.registerFunction("computeAxisComponentHeight",KI),ue.registerFunction("getAxisConfigInPivotChart",rz)},w3=()=>{ue.registerComponent("emptyTip",XI)},y3=()=>{ue.registerFunction("createLegend",o3)},v3=()=>{ue.registerComponent("menuHandler",h3)},S3=()=>{ue.registerComponent("title",c3)},x3=()=>{ue.registerComponent("tooltipHandler",C3)};class R3{constructor(e){this.titleRows=[],this.showedTitleRows=[],this.rowNow=-1,this.skipStartRow=-1,this.skipEndRow=-1,this.table=e,this.table.on("scroll",t=>{t.scrollDirection==="vertical"&&this.updateGroupTitle()}),this.table.on("tree_hierarchy_state_change",t=>{this.updateGroupTitle()}),this.table.on("resize_column",t=>{this.updateGroupTitle()})}updateGroupTitle(){this.table.scrollTop===0?(this.titleRows=[],this.showedTitleRows=[]):this.skipStartRow!==-1&&this.skipEndRow!==-1&&this.skipStartRow!==this.table.scenegraph.proxy.bodyTopRow-1?(this.table.scenegraph.proxy.screenTopRow<=this.skipStartRow||this.table.scenegraph.proxy.screenTopRow>=this.skipEndRow)&&(this.skipStartRow=-1,this.skipEndRow=-1,this.updateGroupTitleInfo()):(this.skipStartRow=-1,this.skipEndRow=-1,this.updateGroupTitleInfo()),this.updateScenegraph()}updateGroupTitleInfo(){this.rowNow=this.table.scenegraph.proxy.screenTopRow+this.titleRows.length;const e=this.table.getRecordIndexByCell(0,this.rowNow),t=this.table.getRecordIndexByCell(0,this.rowNow+1);this.getTitleRowsByRecordIndex(e,t)}getTitleRowsByRecordIndex(e,t){ee(e)||(e=[e]),ee(t)||(t=[t]);for(let l=0;l<e.length;l++){const a=e.slice(0,l+1);this.table.dataSource.getRaw(a)}const i=[],r=t.length===e.length+1;let o=e.slice(0,r?e.length:e.length-1);const s=this.table.dataSource.currentIndexedData;for(let l=this.rowNow-this.table.columnHeaderLevelCount;l>=0;l--){const a=s[l];if(ee(a)&&o.length===a.length){let d=!0;for(let u=0;u<a.length;u++)if(a[u]!==o[u]){d=!1;break}d&&(i.push(l+this.table.columnHeaderLevelCount),o=o.slice(0,o.length-1))}else if(a===e[0]){i.push(l+this.table.columnHeaderLevelCount);break}}this.titleRows=i.reverse()}updateScenegraph(){const{table:e}=this,{shadowGroup:t,shadowGroupFrozen:i}=B3(e);this.showedTitleRows.length=0;let r=0;for(let o=0;o<e.colCount;o++){let s;o<e.frozenColCount?(s=new Pe({x:e.getColsWidth(0,o-1),y:e.getFrozenRowsHeight()}),i.add(s)):(s=new Pe({x:e.getColsWidth(e.frozenColCount,o-1),y:e.getFrozenRowsHeight()}),t.add(s)),s.col=o;for(let l=0;l<this.titleRows.length;l++){const a=this.titleRows[l];if(A3(a,this.rowNow,e.scenegraph.proxy.screenTopRow,this.titleRows)){o===0&&r++;continue}o===0&&this.showedTitleRows.push(a);const d=e.scenegraph.getCell(o,a);if(d.role==="cell"){const u=fv(d);u.setAttributes({y:40*l}),s.add(u)}else{const u=Rn(o,a,e,!0,!0);u.setAttributes({y:40*l}),s.add(u)}}}r>0&&this.skipStartRow===-1&&this.skipEndRow===-1&&(this.skipStartRow=e.scenegraph.proxy.screenTopRow-1,this.skipEndRow=e.scenegraph.proxy.screenTopRow+1)}}function A3(n,e,t,i){return n===e&&n!==t+i.length-1?!0:n===t+i.indexOf(n)+1&&n<e}function fv(n){const e=n.clone();if(e.role=n.role,e.col=n.col,e.row=n.row,e.mergeStartCol=n.mergeStartCol,e.mergeStartRow=n.mergeStartRow,e.mergeEndCol=n.mergeEndCol,e.mergeEndRow=n.mergeEndRow,e.contentWidth=n.contentWidth,e.contentHeight=n.contentHeight,e.role==="cell"){const t=Ze({x:0,y:0,width:e.attribute.width,height:e.attribute.height});e.add(t)}if(n.type==="group"){const t=e;n.forEachChildren(i=>{const r=fv(i);t.add(r)})}return e}function B3(n){const e=n.scenegraph.colHeaderGroup,t=n.scenegraph.cornerHeaderGroup;if(!e.border){const o=Ze({x:0,y:0,width:0,height:0,cursor:"pointer"});e.add(o),e.border=o,o.attachShadow(o.shadowRoot),o.name="border-rect",o.addEventListener("click",s=>{const l=n.listTreeStickCellPlugin.titleRows,{shadowTarget:a}=s.pickParams,d=Fr(a),{col:u,row:h}=d;T_(h-l.indexOf(h),n)})}if(!t.border){const o=Ze({x:0,y:0,width:0,height:0,cursor:"pointer"});t.add(o),t.border=o,o.attachShadow(o.shadowRoot),o.name="border-rect",o.addEventListener("click",s=>{const l=n.listTreeStickCellPlugin.titleRows,{shadowTarget:a}=s.pickParams,d=Fr(a),{col:u,row:h}=d;T_(h-l.indexOf(h),n)})}const i=e.border.shadowRoot,r=t.border.shadowRoot;return i.removeAllChild(),r.removeAllChild(),{shadowGroup:i,shadowGroupFrozen:r}}function T_(n,e){const t=e.getDrawRange();if(O(n)&&n>=e.frozenRowCount){const i=e.getFrozenRowsHeight(),r=e.getRowsHeight(0,n-1);e.scrollTop=Math.min(r-i,e.getAllRowsHeight()-t.height)-1}e.scenegraph.updateNextFrame()}const M3=()=>{ue.registerComponent("listTreeStickCellPlugin",R3)},T3={};function P3(){return ul(T3,cf)}function H3(n,e,t,i,r,o,s,l,a,d,u,h,c,g,f,p,m,b,C){var _,w,y,v,x,S,R,B,A,M,H,E,T,P,k,L,F,z,I,N,W,D,G,V,X;const $=P3()[u],Q=f._getCellStyle(r,o),te=Ru("padding",Q,r,o,f);if(O(te)&&(a=te),!n){const le=oi(r,o,p,f);b&&(n=f.scenegraph.highPerformanceGetCell(r,o,!0))&&n.role==="cell"&&n.setAttributes({x:t,y:i,width:s,height:l,lineWidth:(w=(_=p==null?void 0:p.group)===null||_===void 0?void 0:_.lineWidth)!==null&&w!==void 0?w:void 0,fill:(v=(y=p==null?void 0:p.group)===null||y===void 0?void 0:y.fill)!==null&&v!==void 0?v:void 0,stroke:(S=(x=p==null?void 0:p.group)===null||x===void 0?void 0:x.stroke)!==null&&S!==void 0?S:void 0,strokeArrayWidth:le,strokeArrayColor:(B=(R=p==null?void 0:p.group)===null||R===void 0?void 0:R.strokeArrayColor)!==null&&B!==void 0?B:void 0,cursor:(M=(A=p==null?void 0:p.group)===null||A===void 0?void 0:A.cursor)!==null&&M!==void 0?M:void 0,lineDash:(E=(H=p==null?void 0:p.group)===null||H===void 0?void 0:H.lineDash)!==null&&E!==void 0?E:void 0,lineCap:"butt",clip:!0,cornerRadius:p.group.cornerRadius}),n&&n.role==="cell"||((n=new Pe({x:t,y:i,width:s,height:l,lineWidth:(P=(T=p==null?void 0:p.group)===null||T===void 0?void 0:T.lineWidth)!==null&&P!==void 0?P:void 0,fill:(L=(k=p==null?void 0:p.group)===null||k===void 0?void 0:k.fill)!==null&&L!==void 0?L:void 0,stroke:(z=(F=p==null?void 0:p.group)===null||F===void 0?void 0:F.stroke)!==null&&z!==void 0?z:void 0,strokeArrayWidth:le,strokeArrayColor:(N=(I=p==null?void 0:p.group)===null||I===void 0?void 0:I.strokeArrayColor)!==null&&N!==void 0?N:void 0,cursor:(D=(W=p==null?void 0:p.group)===null||W===void 0?void 0:W.cursor)!==null&&D!==void 0?D:void 0,lineDash:(V=(G=p==null?void 0:p.group)===null||G===void 0?void 0:G.lineDash)!==null&&V!==void 0?V:void 0,lineCap:"butt",clip:!0,cornerRadius:p.group.cornerRadius})).role="cell",n.col=r,n.row=o,e==null||e.addCellGroup(n))}if(n.AABBBounds.width(),C&&Array.isArray(f.getCellValue(r,o))||!C){const le=new bo(m,{stroke:!1,x:a[3],y:a[0],canvas:(X=f.canvas)!==null&&X!==void 0?X:f.scenegraph.stage.window.getContext().canvas,mode:f.options.mode,modeParams:f.options.modeParams,spec:f.options.specTransformInCell?f.options.specTransformInCell(h,r,o):h,ClassType:$,width:s-a[3]-a[1],height:l-a[2]-a[0],chartInstance:c,dataId:g,data:f.getCellValue(r,o)||[],cellPadding:a,dpr:f.internalProps.pixelRatio,axes:f.isPivotChart()?f.internalProps.layoutMap.getChartAxes(r,o):[],tableChartOption:f.options.chartOption,col:r,row:o});n.appendChild(le),f.internalProps.layoutMap.setChartInstance(r,o,le.chartInstance)}return n}function k3(n,e,t,i,r,o,s,l,a,d,u,h,c,g,f,p,m,b){var C,_,w,y,v,x,S,R,B,A,M,H,E,T,P,k,L,F,z,I,N,W,D,G;if(!n){const te=oi(r,o,f,g);b&&(n=g.scenegraph.highPerformanceGetCell(r,o,!0))&&n.role==="cell"&&n.setAttributes({x:t,y:i,width:l,height:a,lineWidth:(_=(C=f==null?void 0:f.group)===null||C===void 0?void 0:C.lineWidth)!==null&&_!==void 0?_:void 0,fill:(y=(w=f==null?void 0:f.group)===null||w===void 0?void 0:w.fill)!==null&&y!==void 0?y:void 0,stroke:(x=(v=f==null?void 0:f.group)===null||v===void 0?void 0:v.stroke)!==null&&x!==void 0?x:void 0,strokeArrayWidth:te,strokeArrayColor:(R=(S=f==null?void 0:f.group)===null||S===void 0?void 0:S.strokeArrayColor)!==null&&R!==void 0?R:void 0,cursor:(A=(B=f==null?void 0:f.group)===null||B===void 0?void 0:B.cursor)!==null&&A!==void 0?A:void 0,lineDash:(H=(M=f==null?void 0:f.group)===null||M===void 0?void 0:M.lineDash)!==null&&H!==void 0?H:void 0,lineCap:"butt",clip:!0,cornerRadius:f.group.cornerRadius}),n&&n.role==="cell"||((n=new Pe({x:t,y:i,width:l,height:a,lineWidth:(T=(E=f==null?void 0:f.group)===null||E===void 0?void 0:E.lineWidth)!==null&&T!==void 0?T:void 0,fill:(k=(P=f==null?void 0:f.group)===null||P===void 0?void 0:P.fill)!==null&&k!==void 0?k:void 0,stroke:(F=(L=f==null?void 0:f.group)===null||L===void 0?void 0:L.stroke)!==null&&F!==void 0?F:void 0,strokeArrayWidth:te,strokeArrayColor:(I=(z=f==null?void 0:f.group)===null||z===void 0?void 0:z.strokeArrayColor)!==null&&I!==void 0?I:void 0,cursor:(W=(N=f==null?void 0:f.group)===null||N===void 0?void 0:N.cursor)!==null&&W!==void 0?W:void 0,lineDash:(G=(D=f==null?void 0:f.group)===null||D===void 0?void 0:D.lineDash)!==null&&G!==void 0?G:void 0,lineCap:"butt",clip:!0,cornerRadius:f.group.cornerRadius})).role="cell",n.col=r,n.row=o,e==null||e.addCellGroup(n))}let V;if(c){let te=r,le=o;m&&(te=m.start.col,le=m.start.row),V=g.getCellIcons(te,le)}let X=0,$=0;if(Array.isArray(V)&&V.length!==0){const{leftIconWidth:te,rightIconWidth:le,absoluteRightIconWidth:fe}=Do(V,n,m,g);X=te+le,$=te,n.forEachChildren(ne=>{ne.role==="icon-left"?ne.setAttribute("x",ne.attribute.x+d[3]):ne.role==="icon-right"?ne.setAttribute("x",ne.attribute.x+l-le-d[1]):ne.role==="icon-absolute-right"&&ne.setAttribute("x",ne.attribute.x+l-fe-d[1])}),n.forEachChildren(ne=>{h==="middle"?ne.setAttribute("y",(a-ne.AABBBounds.height())/2):h==="bottom"?ne.setAttribute("y",a-ne.AABBBounds.height()-d[2]):ne.setAttribute("y",d[0])})}const Q=E3(r,o,s-X,l,a,d,f,p,g);return Q&&n.appendChild(Q),Q.render(),l-=d[1]+d[3]+X,a-=d[0]+d[2],u==="center"?Q.setAttribute("x",d[3]+$+(l-Q.AABBBounds.width())/2):u==="right"?Q.setAttribute("x",d[3]+$+l-Q.AABBBounds.width()):Q.setAttribute("x",d[3]+$),h==="middle"?Q.setAttribute("y",d[0]+(a-Q.AABBBounds.height())/2):h==="bottom"?Q.setAttribute("y",d[0]+a-Q.AABBBounds.height()):Q.setAttribute("y",d[0]),n}function E3(n,e,t,i,r,o,s,l,a){var d,u,h,c;const g=a._getCellStyle(n,e),f=Z("size",g,n,e,a),p=Z("spaceBetweenTextAndIcon",g,n,e,a),m=Z("defaultFill",g,n,e,a),b=Z("defaultStroke",g,n,e,a),C=Z("disableFill",g,n,e,a),_=Z("checkedFill",g,n,e,a),w=Z("checkedStroke",g,n,e,a),y=Z("disableCheckedFill",g,n,e,a),v=Z("disableCheckedStroke",g,n,e,a),x=Z("checkIconImage",g,n,e,a),S=Z("indeterminateIconImage",g,n,e,a),R=a.getCellValue(n,e),B=a.getCellOriginValue(n,e);let A,M,H=(d=R)!==null&&d!==void 0?d:"";ke(R)?(A=R.checked,M=R.disable,H=(u=R.text)!==null&&u!==void 0?u:""):typeof R=="boolean"&&(A=R,H=""),A=a.stateManager.syncCheckedState(n,e,l.field,A);const E=cn(n,e,a),T=a._getCellStyle(n,e),P=(h=T.autoWrapText)!==null&&h!==void 0?h:a.internalProps.autoWrapText,{lineClamp:k}=T,{checked:L,disable:F}=l;if(A==null||typeof A=="function"){const V=ze(L,{col:n,row:e,table:a,context:null,value:R,dataValue:B});A=a.stateManager.syncCheckedState(n,e,l.field,V)}const z=ze(F,{col:n,row:e,table:a,context:null,value:R,dataValue:B}),I=t==="auto",N=a.isAutoRowHeight(e),W={text:H.length===1?H[0]:H,maxLineWidth:I?1/0:i-(o[1]+o[3]+E)-f-p,textAlign:"left",textBaseline:"top",autoWrapText:P,lineClamp:k,wordBreak:"break-word",heightLimit:N?-1:r-Math.floor(o[0]+o[2]),pickable:!1,dx:E,whiteSpace:H.length!==1||P?"normal":"no-wrap"},D={x:0,y:0,text:s.text?Object.assign({},s.text,W):W,icon:{width:Math.floor(f/1.4),height:Math.floor(f/1.4)},box:{width:f,height:f},spaceBetweenTextAndIcon:p,disabled:(c=M??z)!==null&&c!==void 0&&c};A==="indeterminate"?(D.checked=void 0,D.indeterminate=!0):(D.checked=A,D.indeterminate=void 0),m&&(D.box.fill=m),b&&(D.box.stroke=b),C&&(D.box.disableFill=C),_&&(D.box.checkedFill=_),w&&(D.box.checkedStroke=w),y&&(D.box.disableCheckedFill=y),v&&(D.box.disableCheckedStroke=v),x&&(D.icon.checkIconImage=x),S&&(D.icon.indeterminateIconImage=S);const G=new Po(D);return G.name="checkbox",G}function L3(n,e,t,i,r,o,s,l,a,d,u,h,c,g,f,p){var m,b,C,_,w,y,v,x,S,R,B,A;if(!n){const E=oi(r,o,g,c);(n=new Pe({x:t,y:i,width:l,height:a,lineWidth:(b=(m=g==null?void 0:g.group)===null||m===void 0?void 0:m.lineWidth)!==null&&b!==void 0?b:void 0,fill:(_=(C=g==null?void 0:g.group)===null||C===void 0?void 0:C.fill)!==null&&_!==void 0?_:void 0,stroke:(y=(w=g==null?void 0:g.group)===null||w===void 0?void 0:w.stroke)!==null&&y!==void 0?y:void 0,strokeArrayWidth:E,strokeArrayColor:(x=(v=g==null?void 0:g.group)===null||v===void 0?void 0:v.strokeArrayColor)!==null&&x!==void 0?x:void 0,cursor:(R=(S=g==null?void 0:g.group)===null||S===void 0?void 0:S.cursor)!==null&&R!==void 0?R:void 0,lineDash:(A=(B=g==null?void 0:g.group)===null||B===void 0?void 0:B.lineDash)!==null&&A!==void 0?A:void 0,lineCap:"butt",clip:!0,cornerRadius:g.group.cornerRadius})).role="cell",n.col=r,n.row=o,e==null||e.addCellGroup(n)}const{width:M,height:H}=F3(r,o,s,l,a,d,g,f,n,p,c);return l-=d[1]+d[3],a-=d[0]+d[2],n.forEachChildren(E=>{u==="center"?E.setAttribute("x",d[3]+E.attribute.x+(l-M)/2):u==="right"?E.setAttribute("x",d[3]+E.attribute.x+l-M):E.setAttribute("x",d[3]+E.attribute.x),h==="middle"?E.setAttribute("y",d[0]+E.attribute.y+(a-H)/2):h==="bottom"?E.setAttribute("y",d[0]+E.attribute.y+a-H):E.setAttribute("y",d[0]+E.attribute.y)}),n}function F3(n,e,t,i,r,o,s,l,a,d,u){var h,c,g,f;const p=u._getCellStyle(n,e);let m=Z("size",p,n,e,u),b=Z("innerRadius",p,n,e,u),C=Z("outerRadius",p,n,e,u);const _=Z("spaceBetweenTextAndIcon",p,n,e,u),w=Z("spaceBetweenRadio",p,n,e,u),y=Z("defaultFill",p,n,e,u),v=Z("defaultStroke",p,n,e,u),x=Z("disableFill",p,n,e,u),S=Z("checkedFill",p,n,e,u),R=Z("checkedStroke",p,n,e,u),B=Z("disableCheckedFill",p,n,e,u),A=Z("disableCheckedStroke",p,n,e,u);J(C)?m=2*C:C=Math.round(m/2),(!J(b)||b<0)&&(b=Math.round(C/7*3));const M=u.getCellValue(n,e),H=u.getCellOriginValue(n,e),E=cn(n,e,u),T=u._getCellStyle(n,e),P=(h=T.autoWrapText)!==null&&h!==void 0?h:u.internalProps.autoWrapText,{lineClamp:k}=T,L=t==="auto",F=u.isAutoRowHeight(),z={maxLineWidth:L?1/0:i-(o[1]+o[3]+E)-m-_,textAlign:"left",textBaseline:"top",autoWrapText:P,lineClamp:k,wordBreak:"break-word",heightLimit:F?-1:r-Math.floor(o[0]+o[2]),pickable:!1,dx:E},I={x:0,y:0,text:s.text?Object.assign({},s.text,z):z,circle:{innerRadius:b,outerRadius:C},spaceBetweenTextAndIcon:_};y&&(I.circle.fill=y),v&&(I.circle.stroke=v),x&&(I.circle.disableFill=x),S&&(I.circle.checkedFill=S),R&&(I.circle.checkedStroke=R),B&&(I.circle.disableCheckedFill=B),A&&(I.circle.disableCheckedStroke=A);let N=0,W=0;const D=(c=l.radioDirectionInCell)!==null&&c!==void 0?c:"vertical";if(ee(M))M.forEach((G,V)=>{var X,$;const Q=P_(G,H,V,n,e,l,P,I,u);Q&&a.appendChild(Q),Q.id=`radio-${(X=d==null?void 0:d.start.col)!==null&&X!==void 0?X:n}-${($=d==null?void 0:d.start.row)!==null&&$!==void 0?$:e}-${V}`,Q.render();const te=Q.AABBBounds;D==="vertical"?(Q.setAttribute("y",W),W+=te.height()+(V!==M.length-1?w:0),N=Math.max(N,te.width())):D==="horizontal"&&(Q.setAttribute("x",N),N+=te.width()+(V!==M.length-1?w:0),W=Math.max(W,te.height()))});else{const G=P_(M,H,void 0,n,e,l,P,I,u);G&&a.appendChild(G),G.id=`radio-${(g=d==null?void 0:d.start.col)!==null&&g!==void 0?g:n}-${(f=d==null?void 0:d.start.row)!==null&&f!==void 0?f:e}`,G.render();const V=G.AABBBounds;N=V.width(),W=V.height()}return{width:N,height:W}}function P_(n,e,t,i,r,o,s,l,a){const d=z3(n,e,t,i,r,o,a),u=I3(n,e,i,r,o,a),h=ke(n)?n.text:kt(n)?"":n??"",c=re({},l,{checked:d,disabled:u,text:{text:h.length===1?h[0]:h,whiteSpace:h.length!==1||s?"normal":"no-wrap"},boundsPadding:0}),g=new Ho(c);return g.name="radio",g}function z3(n,e,t,i,r,o,s){var l,a;const d=(l=o.radioCheckType)!==null&&l!==void 0?l:"column";let u,h;return ke(n)?u=n.checked:typeof n=="boolean"&&(u=n),u=s.stateManager.syncRadioState(i,r,o.field,d,t,u),u!=null&&typeof u!="function"||(h=ze(o.checked,{col:i,row:r,table:s,context:null,value:n,dataValue:e}),u=s.stateManager.syncRadioState(i,r,o.field,d,t,h)),(a=u??h)!==null&&a!==void 0&&a}function I3(n,e,t,i,r,o){var s;let l;ke(n)&&(l=n.disable);const a=ze(r.disable,{col:t,row:i,table:o,context:null,value:n,dataValue:e});return(s=l??a)!==null&&s!==void 0&&s}function O3(n,e,t,i,r,o,s,l,a,d,u,h,c,g,f,p,m,b){var C,_,w,y,v,x,S,R,B,A,M,H,E,T,P,k,L,F,z,I,N,W,D,G;if(!n){const te=oi(r,o,f,g);b&&(n=g.scenegraph.highPerformanceGetCell(r,o,!0))&&n.role==="cell"&&n.setAttributes({x:t,y:i,width:l,height:a,lineWidth:(_=(C=f==null?void 0:f.group)===null||C===void 0?void 0:C.lineWidth)!==null&&_!==void 0?_:void 0,fill:(y=(w=f==null?void 0:f.group)===null||w===void 0?void 0:w.fill)!==null&&y!==void 0?y:void 0,stroke:(x=(v=f==null?void 0:f.group)===null||v===void 0?void 0:v.stroke)!==null&&x!==void 0?x:void 0,strokeArrayWidth:te,strokeArrayColor:(R=(S=f==null?void 0:f.group)===null||S===void 0?void 0:S.strokeArrayColor)!==null&&R!==void 0?R:void 0,cursor:(A=(B=f==null?void 0:f.group)===null||B===void 0?void 0:B.cursor)!==null&&A!==void 0?A:void 0,lineDash:(H=(M=f==null?void 0:f.group)===null||M===void 0?void 0:M.lineDash)!==null&&H!==void 0?H:void 0,lineCap:"butt",clip:!0,cornerRadius:f.group.cornerRadius}),n&&n.role==="cell"||((n=new Pe({x:t,y:i,width:l,height:a,lineWidth:(T=(E=f==null?void 0:f.group)===null||E===void 0?void 0:E.lineWidth)!==null&&T!==void 0?T:void 0,fill:(k=(P=f==null?void 0:f.group)===null||P===void 0?void 0:P.fill)!==null&&k!==void 0?k:void 0,stroke:(F=(L=f==null?void 0:f.group)===null||L===void 0?void 0:L.stroke)!==null&&F!==void 0?F:void 0,strokeArrayWidth:te,strokeArrayColor:(I=(z=f==null?void 0:f.group)===null||z===void 0?void 0:z.strokeArrayColor)!==null&&I!==void 0?I:void 0,cursor:(W=(N=f==null?void 0:f.group)===null||N===void 0?void 0:N.cursor)!==null&&W!==void 0?W:void 0,lineDash:(G=(D=f==null?void 0:f.group)===null||D===void 0?void 0:D.lineDash)!==null&&G!==void 0?G:void 0,lineCap:"butt",clip:!0,cornerRadius:f.group.cornerRadius})).role="cell",n.col=r,n.row=o,e==null||e.addCellGroup(n))}let V;if(c){let te=r,le=o;m&&(te=m.start.col,le=m.start.row),V=g.getCellIcons(te,le)}let X=0,$=0;if(Array.isArray(V)&&V.length!==0){const{leftIconWidth:te,rightIconWidth:le,absoluteRightIconWidth:fe}=Do(V,n,m,g);X=te+le,$=te,n.forEachChildren(ne=>{ne.role==="icon-left"?ne.setAttribute("x",ne.attribute.x+d[3]):ne.role==="icon-right"?ne.setAttribute("x",ne.attribute.x+l-le-d[1]):ne.role==="icon-absolute-right"&&ne.setAttribute("x",ne.attribute.x+l-fe-d[1])}),n.forEachChildren(ne=>{h==="middle"?ne.setAttribute("y",(a-ne.AABBBounds.height())/2):h==="bottom"?ne.setAttribute("y",a-ne.AABBBounds.height()-d[2]):ne.setAttribute("y",d[0])})}const Q=D3(r,o,s-X,l,a,d,f,p,g);return Q&&n.appendChild(Q),Q.render(),l-=d[1]+d[3]+X,a-=d[0]+d[2],u==="center"?Q.setAttribute("x",d[3]+$+(l-Q.AABBBounds.width())/2):u==="right"?Q.setAttribute("x",d[3]+$+l-Q.AABBBounds.width()):Q.setAttribute("x",d[3]+$),h==="middle"?Q.setAttribute("y",d[0]+(a-Q.AABBBounds.height())/2):h==="bottom"?Q.setAttribute("y",d[0]+a-Q.AABBBounds.height()):Q.setAttribute("y",d[0]),n}function D3(n,e,t,i,r,o,s,l,a){var d,u,h,c;const g=a._getCellStyle(n,e),f=Z("spaceBetweenTextAndCircle",g,n,e,a),p=Z("circleRadius",g,n,e,a),m=Z("boxWidth",g,n,e,a),b=Z("boxHeight",g,n,e,a),C=Z("checkedFill",g,n,e,a),_=Z("uncheckedFill",g,n,e,a),w=Z("disableCheckedFill",g,n,e,a),y=Z("disableUncheckedFill",g,n,e,a),v=Z("circleFill",g,n,e,a),x=a.getCellValue(n,e),S=a.getCellOriginValue(n,e);let R,B,A=(d=x)!==null&&d!==void 0?d:"";ke(x)?(R=x.checked,B=x.disable,A=(u=x.text)!==null&&u!==void 0?u:""):typeof x=="boolean"&&(R=x,A=""),R=a.stateManager.syncCheckedState(n,e,l.field,R);const M=cn(n,e,a),H=a._getCellStyle(n,e),E=(h=H.autoWrapText)!==null&&h!==void 0?h:a.internalProps.autoWrapText,{lineClamp:T}=H,{checked:P,disable:k,uncheckedText:L,checkedText:F}=l;if(R==null||typeof R=="function"){const $=ze(P,{col:n,row:e,table:a,context:null,value:x,dataValue:S});R=a.stateManager.syncCheckedState(n,e,l.field,$)}const z=ze(k,{col:n,row:e,table:a,context:null,value:x,dataValue:S}),I=ze(F,{col:n,row:e,table:a,context:null,value:x,dataValue:S}),N=ze(L,{col:n,row:e,table:a,context:null,value:x,dataValue:S}),W=t==="auto",D=a.isAutoRowHeight(e),G={text:A.length===1?A[0]:A,maxLineWidth:W?1/0:i-(o[1]+o[3]+M)-2*p-f,textAlign:"left",textBaseline:"top",autoWrapText:E,lineClamp:T,wordBreak:"break-word",heightLimit:D?-1:r-Math.floor(o[0]+o[2]),pickable:!1,dx:M,whiteSpace:A.length!==1||E?"normal":"no-wrap",checkedText:I,uncheckedText:N},V={x:0,y:0,text:s.text?Object.assign({},s.text,G):G,circle:{radius:p},box:{width:m,height:b},spaceBetweenTextAndCircle:f,disabled:(c=B??z)!==null&&c!==void 0&&c};V.checked=R,_&&(V.box.uncheckedFill=_),y&&(V.box.disableUncheckedFill=y),C&&(V.box.checkedFill=C),w&&(V.box.disableCheckedFill=w),v&&(V.circle.fill=v);const X=new Us(V);return X.name="switch",X}const Ii=new kI,Oi=new Vo;function W3(n,e,t,i,r,o,s,l,a,d,u,h){var c,g,f,p,m,b,C,_,w,y,v,x,S,R,B,A,M,H,E,T,P,k,L,F;if(!n){const I=oi(r,o,u,d);h&&(n=d.scenegraph.highPerformanceGetCell(r,o,!0))&&n.role==="cell"&&n.setAttributes({x:t,y:i,width:s,height:l,lineWidth:(g=(c=u==null?void 0:u.group)===null||c===void 0?void 0:c.lineWidth)!==null&&g!==void 0?g:void 0,fill:(p=(f=u==null?void 0:u.group)===null||f===void 0?void 0:f.fill)!==null&&p!==void 0?p:void 0,stroke:(b=(m=u==null?void 0:u.group)===null||m===void 0?void 0:m.stroke)!==null&&b!==void 0?b:void 0,strokeArrayWidth:I,strokeArrayColor:(_=(C=u==null?void 0:u.group)===null||C===void 0?void 0:C.strokeArrayColor)!==null&&_!==void 0?_:void 0,cursor:(y=(w=u==null?void 0:u.group)===null||w===void 0?void 0:w.cursor)!==null&&y!==void 0?y:void 0,lineDash:(x=(v=u==null?void 0:u.group)===null||v===void 0?void 0:v.lineDash)!==null&&x!==void 0?x:void 0,lineCap:"butt",clip:!0,cornerRadius:u.group.cornerRadius}),n&&n.role==="cell"||((n=new Pe({x:t,y:i,width:s,height:l,lineWidth:(R=(S=u==null?void 0:u.group)===null||S===void 0?void 0:S.lineWidth)!==null&&R!==void 0?R:void 0,fill:(A=(B=u==null?void 0:u.group)===null||B===void 0?void 0:B.fill)!==null&&A!==void 0?A:void 0,stroke:(H=(M=u==null?void 0:u.group)===null||M===void 0?void 0:M.stroke)!==null&&H!==void 0?H:void 0,strokeArrayWidth:I,strokeArrayColor:(T=(E=u==null?void 0:u.group)===null||E===void 0?void 0:E.strokeArrayColor)!==null&&T!==void 0?T:void 0,cursor:(k=(P=u==null?void 0:u.group)===null||P===void 0?void 0:P.cursor)!==null&&k!==void 0?k:void 0,lineDash:(F=(L=u==null?void 0:u.group)===null||L===void 0?void 0:L.lineDash)!==null&&F!==void 0?F:void 0,lineCap:"butt",clip:!0,cornerRadius:u.group.cornerRadius})).role="cell",n.col=r,n.row=o,e==null||e.addCellGroup(n))}const z=N3(r,o,s,l,a,d);return z&&n.appendChild(z),n}function N3(n,e,t,i,r,o){let s,l;const a=o.internalProps.layoutMap.getBody(n,e).sparklineSpec,d=o.getCellValue(n,e);if(!Array.isArray(d))return;const u=r[3],h=r[0];t-=r[1]+r[3];const c=i-=r[0]+r[2];if(typeof a=="function"){const _={col:n,row:e,dataValue:o.getCellOriginValue(n,e)||"",value:o.getCellValue(n,e)||"",rect:o.getCellRangeRelativeRect(o.getCellRange(n,e)),table:o};s=a(_),l=H_(s,u,h,t,i)}else s=a,l=H_(a,u,h,t,i);const g=[],f=[];let p,m;if(typeof s.xField=="object")Ii.domain(s.xField.domain),p=s.xField.field;else if(typeof s.xField=="string"){const _=d.map(w=>w[s.xField]);Ii.domain(_),p=s.xField}else Array.isArray(d)&&(Ii.domain(Array.from({length:d.length},(_,w)=>w)),p=s.xField);if(Ii.range([0,t]),typeof s.yField=="object")Oi.domain(s.yField.domain),m=s.yField.field;else if(typeof s.yField=="string"){const _=k_(d,s.yField);Oi.domain([Math.min(..._),Math.max(..._)]),m=s.yField}else if(Array.isArray(d)){const _=k_(d);Oi.domain([Math.min(..._),Math.max(..._)]),m=s.yField}if(Oi.range([0,i]),typeof s.xField=="object"&&Array.isArray(s.xField.domain)){const _=d.map(y=>y[s.xField.field]),w=s.xField.domain;for(let y=0;y<w.length;y++){let v=!1;for(let x=0;x<_.length;x++)if(w[y]===_[x]){const S=d[x];if(!O(S[p])||!O(S[m]))break;g.push({x:0+Ii.scale(S[p]),y:c-Oi.scale(S[m]),defined:O(S[m])}),f.push(S),v=!0;break}v||(g.push({x:0+Ii.scale(w[y]),y:0,defined:!1}),f.push({[p]:w[y],[m]:null}))}}else for(let _=0;_<d.length;_++){const w=d[_];g.push({x:0+Ii.scale(p?w[p]:_),y:c-Oi.scale(m?w[m]:w),defined:O(m?w[m]:w),rawData:w}),f.push(w)}const b=l.getChildByName("sparkline-line");b&&b.setAttribute("points",g),b.bandwidth=Ii.step(),b.min=Oi.range()[0],b.max=Oi.range()[1];const C=l.getChildByName("sparkline-symbol-group");if(C){const _=s.pointShowRule==="isolatedPoint";if(s.pointShowRule==="all")for(let w=0;w<g.length;w++){const{x:y,y:v,defined:x}=g[w];if(x){const S=zs({x:y,y:v});C.appendChild(S)}}else if(_)for(let w=0;w<g.length;w++){const{x:y,y:v,defined:x}=g[w];if(x&&(!g[w-1]||!g[w-1].defined)&&(!g[w+1]||!g[w+1].defined)){const S=zs({x:y,y:v});C.appendChild(S)}}}return l}function H_(n,e,t,i,r){var o,s,l,a,d,u,h,c,g,f,p,m,b,C,_,w,y,v,x,S,R,B;let A;A=typeof n=="function"?n(null):n;const M=new Pe({x:e,y:t,width:i,height:r,stroke:!1,fill:!1});if(M.name="sparkline",A.type==="line"){const H=un({x:0,y:0,curveType:A.smooth?"monotoneX":"linear",stroke:(l=(s=(o=A.line)===null||o===void 0?void 0:o.style)===null||s===void 0?void 0:s.stroke)!==null&&l!==void 0?l:"blue",lineWidth:(u=(d=(a=A.line)===null||a===void 0?void 0:a.style)===null||d===void 0?void 0:d.strokeWidth)!==null&&u!==void 0?u:2});H.name="sparkline-line",M.addChild(H),A.crosshair&&(H.hover=(c=(h=A.crosshair)===null||h===void 0?void 0:h.style)!==null&&c!==void 0?c:{stroke:"#000",interpolate:"linear"});const E=new Pe({x:0,y:0,width:i,height:r,stroke:!1,fill:!1});E.name="sparkline-symbol-group",E.setTheme({symbol:{stroke:(p=(f=(g=A.point)===null||g===void 0?void 0:g.style)===null||f===void 0?void 0:f.stroke)!==null&&p!==void 0?p:"#000",lineWidth:(C=(b=(m=A.point)===null||m===void 0?void 0:m.style)===null||b===void 0?void 0:b.strokeWidth)!==null&&C!==void 0?C:1,fill:(y=(w=(_=A.point)===null||_===void 0?void 0:_.style)===null||w===void 0?void 0:w.fill)!==null&&y!==void 0?y:"#000",size:2*((S=(x=(v=A.point)===null||v===void 0?void 0:v.style)===null||x===void 0?void 0:x.size)!==null&&S!==void 0?S:3),symbolType:"circle"}}),M.addChild(E),E.hover=(B=(R=A.point)===null||R===void 0?void 0:R.hover)!==null&&B!==void 0&&B}return M}function k_(n,e){const t=[];for(let i=0;i<n.length;i++){const r=n[i];O(e)&&O(r[e])?t.push(r[e]):!O(e)&&O(r)&&t.push(r)}return t}const yh=Vn();function V3(n,e,t,i,r,o,s,l,a,d,u,h,c,g,f,p,m){var b,C,_,w,y,v,x,S,R,B,A,M,H,E,T,P,k,L,F,z,I,N,W,D,G,V,X,$,Q,te;const le=g._getCellStyle(i,r),fe=Ru("padding",le,i,r,g);!((b=g.options.customConfig)===null||b===void 0)&&b.imageMargin?d=xe((C=g.options.customConfig)===null||C===void 0?void 0:C.imageMargin):O(fe)&&(d=fe),!((_=f==null?void 0:f.text)===null||_===void 0)&&_.textAlign&&(u=(w=f==null?void 0:f.text)===null||w===void 0?void 0:w.textAlign),!((y=f==null?void 0:f.text)===null||y===void 0)&&y.textBaseline&&(h=(v=f==null?void 0:f.text)===null||v===void 0?void 0:v.textBaseline);const ne=oi(i,r,f,g);let ie,ce;if(m&&(ie=g.scenegraph.highPerformanceGetCell(i,r,!0),ie&&ie.role==="cell"&&ie.setAttributes({x:e,y:t,width:o,height:s,lineWidth:(S=(x=f==null?void 0:f.group)===null||x===void 0?void 0:x.lineWidth)!==null&&S!==void 0?S:void 0,fill:(B=(R=f==null?void 0:f.group)===null||R===void 0?void 0:R.fill)!==null&&B!==void 0?B:void 0,stroke:(M=(A=f==null?void 0:f.group)===null||A===void 0?void 0:A.stroke)!==null&&M!==void 0?M:void 0,strokeArrayWidth:ne,strokeArrayColor:(E=(H=f==null?void 0:f.group)===null||H===void 0?void 0:H.strokeArrayColor)!==null&&E!==void 0?E:void 0,cursor:(P=(T=f==null?void 0:f.group)===null||T===void 0?void 0:T.cursor)!==null&&P!==void 0?P:void 0,lineDash:(L=(k=f==null?void 0:f.group)===null||k===void 0?void 0:k.lineDash)!==null&&L!==void 0?L:void 0,lineCap:"butt",clip:!0,cornerRadius:f.group.cornerRadius})),ie&&ie.role==="cell"||(ie=new Pe({x:e,y:t,width:o,height:s,lineWidth:(z=(F=f==null?void 0:f.group)===null||F===void 0?void 0:F.lineWidth)!==null&&z!==void 0?z:void 0,fill:(N=(I=f==null?void 0:f.group)===null||I===void 0?void 0:I.fill)!==null&&N!==void 0?N:void 0,stroke:(D=(W=f==null?void 0:f.group)===null||W===void 0?void 0:W.stroke)!==null&&D!==void 0?D:void 0,strokeArrayWidth:ne,strokeArrayColor:(V=(G=f==null?void 0:f.group)===null||G===void 0?void 0:G.strokeArrayColor)!==null&&V!==void 0?V:void 0,cursor:($=(X=f==null?void 0:f.group)===null||X===void 0?void 0:X.cursor)!==null&&$!==void 0?$:void 0,lineDash:(te=(Q=f==null?void 0:f.group)===null||Q===void 0?void 0:Q.lineDash)!==null&&te!==void 0?te:void 0,lineCap:"butt",clip:!0,cornerRadius:f.group.cornerRadius}),ie.role="cell",ie.col=i,ie.row=r,n==null||n.addCellGroup(ie)),c){let de=i,K=r;p&&(de=p.start.col,K=p.start.row),ce=g.getCellIcons(de,K)}let ae=0,q=0;if(Array.isArray(ce)&&ce.length!==0){const{leftIconWidth:de,rightIconWidth:K,absoluteRightIconWidth:ut}=Do(ce,ie,p,g);ae=de,q=K,ie.forEachChildren(he=>{he.role==="icon-left"?he.setAttribute("x",he.attribute.x+d[3]):he.role==="icon-right"?he.setAttribute("x",he.attribute.x+o-K-d[1]):he.role==="icon-absolute-right"&&he.setAttribute("x",he.attribute.x+o-ut-d[1])}),ie.forEachChildren(he=>{h==="middle"?he.setAttribute("y",(s-he.AABBBounds.height())/2):h==="bottom"?he.setAttribute("y",s-he.AABBBounds.height()-d[2]):he.setAttribute("y",d[0])}),ie._cellLeftIconWidth=ae,ie._cellRightIconWidth=q}const _e=g.getCellValue(i,r),oe=document.createElement("video");oe.addEventListener("loadeddata",()=>{a&&oy(i,r,oe.videoWidth,oe.videoHeight,g.scenegraph,d,ie);const{width:de,height:K,isMerge:ut}=ko(ie,g);if(l){const{width:bl,height:Go}=xu(oe.videoWidth,oe.videoHeight,de-d[1]-d[3],K-d[0]-d[2]),Cl=Jf(0,0,de,K,bl,Go,u,h,d);Y.setAttributes({width:bl,height:Go,x:Cl.x,y:Cl.y,dx:0})}else Y.setAttributes({x:d[3],y:d[0],width:de-d[1]-d[3],height:K-d[2]-d[0],dy:0});ut&&Qf(ie.mergeStartCol,ie.mergeEndCol,ie.mergeStartRow,ie.mergeEndRow,g);const{width:he,height:We}=ko(ie,g),bt=Math.floor(Math.min(he-d[1]-d[3],We-d[2]-d[0])/2),ki=0+(he>Y.attribute.width?Y.attribute.x-0+Y.attribute.width/2:he/2),rt=0+(We>Y.attribute.height?Y.attribute.y-0+Y.attribute.height/2:We/2),ml=new Lr({x:ki-bt/2,y:rt-bt/2,width:bt,height:bt,image:yh.play.svg,cursor:yh.play.cursor});ml.name="play-icon",ie.appendChild(ml),g.scenegraph.updateNextFrame()}),oe.onerror=()=>{Y.image=yh.damage_pic.svg},oe.src=_e,oe.setAttribute("preload","auto");const Y=au({x:d[3],y:d[0],width:o-d[1]-d[3],height:s-d[2]-d[0],image:oe,cursor:"pointer"});return Y.name="image",Y.keepAspectRatio=l,Y.textAlign=u,Y.textBaseline=h,ie.appendChild(Y),ie}function G3(n,e,t,i,r,o,s,l,a,d,u,h,c,g,f,p,m,b,C){var _,w,y,v,x,S,R,B,A,M,H,E,T,P,k,L,F,z,I,N,W,D,G,V,X,$,Q,te,le,fe,ne,ie;const ce=n._getCellStyle(o,s),ae=Ru("padding",ce,o,s,n);O(ae)&&(u=ae),!((_=m==null?void 0:m.text)===null||_===void 0)&&_.textAlign&&(h=(w=m==null?void 0:m.text)===null||w===void 0?void 0:w.textAlign),!((y=m==null?void 0:m.text)===null||y===void 0)&&y.textBaseline&&(c=(v=m==null?void 0:m.text)===null||v===void 0?void 0:v.textBaseline);const q=n.isAutoRowHeight(s),_e=l==="auto",oe=(x=ce.autoWrapText)!==null&&x!==void 0?x:n.internalProps.autoWrapText,Y=ce.lineClamp,de=oi(o,s,m,n);let K;if(C&&(K=n.scenegraph.getCell(o,s,!0),K&&K.role==="cell"&&K.setAttributes({x:i,y:r,width:a,height:d,lineWidth:(R=(S=m==null?void 0:m.group)===null||S===void 0?void 0:S.lineWidth)!==null&&R!==void 0?R:void 0,fill:(A=(B=m==null?void 0:m.group)===null||B===void 0?void 0:B.fill)!==null&&A!==void 0?A:void 0,stroke:(H=(M=m==null?void 0:m.group)===null||M===void 0?void 0:M.stroke)!==null&&H!==void 0?H:void 0,strokeArrayWidth:de??void 0,strokeArrayColor:(T=(E=m==null?void 0:m.group)===null||E===void 0?void 0:E.strokeArrayColor)!==null&&T!==void 0?T:void 0,cursor:(k=(P=m==null?void 0:m.group)===null||P===void 0?void 0:P.cursor)!==null&&k!==void 0?k:void 0,lineDash:(F=(L=m==null?void 0:m.group)===null||L===void 0?void 0:L.lineDash)!==null&&F!==void 0?F:void 0,lineCap:"butt",clip:!0,cornerRadius:m.group.cornerRadius})),K&&K.role==="cell"||(K=new Pe({x:i,y:r,width:a,height:d,lineWidth:(I=(z=m==null?void 0:m.group)===null||z===void 0?void 0:z.lineWidth)!==null&&I!==void 0?I:void 0,fill:(W=(N=m==null?void 0:m.group)===null||N===void 0?void 0:N.fill)!==null&&W!==void 0?W:void 0,stroke:(G=(D=m==null?void 0:m.group)===null||D===void 0?void 0:D.stroke)!==null&&G!==void 0?G:void 0,strokeArrayWidth:de??void 0,strokeArrayColor:(X=(V=m==null?void 0:m.group)===null||V===void 0?void 0:V.strokeArrayColor)!==null&&X!==void 0?X:void 0,cursor:(Q=($=m==null?void 0:m.group)===null||$===void 0?void 0:$.cursor)!==null&&Q!==void 0?Q:void 0,lineDash:(le=(te=m==null?void 0:m.group)===null||te===void 0?void 0:te.lineDash)!==null&&le!==void 0?le:void 0,lineCap:"butt",clip:!0,cornerRadius:m.group.cornerRadius}),K.role="cell",K.col=o,K.row=s,t==null||t.addCellGroup(K)),f&&K.appendChild(f),p){const ut=e;let he;if(g){let We=o,bt=s;b&&(We=b.start.col,bt=b.start.row),he=n.getCellIcons(We,bt)}if(rk(K,he,ut,u,_e,q,oe,typeof Y=="number"?Y:void 0,K.attribute.width,K.attribute.height,h,c,n,m,b),(fe=m==null?void 0:m._vtable)===null||fe===void 0?void 0:fe.marked){const We=Df({x:K.attribute.width,y:0,startAngle:Math.PI/2,endAngle:Math.PI,outerRadius:6,fill:"#3073F2",pickable:!1});We.name="mark",K.appendChild(We)}}return f&&K.setAttributes({width:Math.max(K.attribute.width,(ne=f.attribute.width)!==null&&ne!==void 0?ne:0),height:Math.max(K.attribute.height,(ie=f.attribute.height)!==null&&ie!==void 0?ie:0)}),K}function j3(n,e,t,i,r,o,s,l,a,d){var u,h,c,g,f;if(n.dependField){const te=ze(n.dependField,{col:o,row:s,table:a,value:i,dataValue:r,cellHeaderPaths:void 0});r=(h=(u=a.getCellOriginRecord(o,s))===null||u===void 0?void 0:u[te])!==null&&h!==void 0?h:r}const p=(c=ze(n.barType,{col:o,row:s,table:a,value:i,dataValue:r,cellHeaderPaths:void 0}))!==null&&c!==void 0?c:"default",m=(g=ze(n.min,{col:o,row:s,table:a,value:i,dataValue:r,cellHeaderPaths:void 0}))!==null&&g!==void 0?g:0,b=(f=ze(n.max,{col:o,row:s,table:a,value:i,dataValue:r,cellHeaderPaths:void 0}))!==null&&f!==void 0?f:m+100;let C=0;C=d?a.getRowsHeight(d.start.row,d.end.row):a.getRowHeight(s);let _=t,w=C,y=0;J(a.theme._contentOffset)&&(y=a.theme._contentOffset);const v=new Pe({x:-y,y:-y,width:_,height:w});v.name="progress-bar";const{showBar:x,barColor:S,barBgColor:R,barPositiveColor:B,barNegativeColor:A,barAxisColor:M,barRightToLeft:H,showBarMark:E,barMarkPositiveColor:T,barMarkNegativeColor:P,barMarkWidth:k,barMarkPosition:L}=e;let{barHeight:F,barBottom:z,barPadding:I}=e;I.length===1?I=[I[0],I[0],I[0],I[0]]:I.length===2?I=[I[0],I[1],I[0],I[1]]:I.length===3&&(I=[I[0],I[1],I[2],I[1]]),I=I.map((te,le)=>{if(typeof te=="string"&&Ol.endsWith(te,"%")){const fe=Number(te.substr(0,te.length-1));return le===0||le===2?C*fe/100:t*fe/100}return Number(te)});const N=xe(Z("borderLineWidth",e,o,s,a)),W=Math.max(I[0],Math.ceil(N[0]/2)),D=Math.max(I[1],Math.floor(N[1]/2)),G=Math.max(I[2],Math.floor(N[2]/2)),V=Math.max(I[3],Math.ceil(N[3]/2));_-=D+V,w-=G+W,s===a.rowCount-1&&[0,"0"].includes(z)&&(w-=1);const X=W,$=V,Q=_;if(typeof F=="string"&&Ol.endsWith(F,"%")?(F=Number(F.substr(0,F.length-1)),F=w*F/100):F=Number(F),typeof z=="string"&&Ol.endsWith(z,"%")?(z=Number(z.substr(0,z.length-1)),z=w*z/100):z=Number(z),ze(x,{col:o,row:s,table:a,context:null,value:i,dataValue:r})){let te=`${r}`;Ol.endsWith(te,"%")&&(te=te.substr(0,te.length-1));const le=Number(te);if(isNaN(le))return v;if((p??"default")==="default"){const fe=le<m?0:le>b?1:(le-m)/(b-m),ne=_,ie=X+w-F-z;let ce=Math.min(ne*fe,ne);const ae=H?$+Q-ce:$;o!==a.colCount-1||fe!==1||H||(ce-=1);const q=ze(R,{col:o,row:s,table:a,context:null,value:i,dataValue:r,percentile:fe});if(q){const Y=Ze({x:ae,y:ie,width:ne,height:F,fill:q});v.addChild(Y)}const _e=ze(S,{col:o,row:s,table:a,context:null,value:i,dataValue:r,percentile:fe})||"#20a8d8",oe=Ze({x:ae,y:ie,width:ce,height:F,fill:_e});v.addChild(oe)}else if(p==="negative"){const fe=m<0?-m:0,ne=b>0?b:0,ie=fe/(fe+ne),ce=1-ie,ae=le>0?le/ne:0,q=le<0?-le/fe:0,_e=_,oe=X+w-F-z,Y=$,de=ze(R,{col:o,row:s,table:a,context:null,value:i,dataValue:r,percentile:ae});if(de){const Tu=Ze({x:Y,y:oe,width:_e,height:F,fill:de});v.addChild(Tu)}const K=H?ce*_e:ie*_e,ut=Math.min(_e*ie*q,_e),he=H?{left:Y+K,top:oe,width:ut,height:F}:{left:Y+K-ut,top:oe,width:ut,height:F},We=ze(A,{col:o,row:s,table:a,context:null,value:i,dataValue:r,percentile:q})||"#20a8d8",bt=Ze({x:he.left,y:he.top,width:he.width,height:he.height,fill:We});v.addChild(bt);let ki=Math.min(_e*ce*ae,_e);o!==a.colCount-1||ae!==1||H||(ki-=1);const rt=H?{left:Y+K-ki,top:oe,width:ki,height:F}:{left:Y+K,top:oe,width:ki,height:F},ml=ze(B,{col:o,row:s,table:a,context:null,value:i,dataValue:r,percentile:ae})||"#20a8d8",bl=Ze({x:rt.left,y:rt.top,width:rt.width,height:rt.height,fill:ml});v.addChild(bl);const Go=H?he.left:rt.left,Cl=ze(M,{col:o,row:s,table:a,context:null,value:i,dataValue:r,percentile:ae}),gv=un({x:0,y:0,stroke:Cl,lineWidth:1,lineDash:[2,2],points:[{x:Go,y:0},{x:Go,y:C}]});if(v.addChild(gv),E&&(ae||q)){const Tu=k,si=[];let Pu;if(ae>0)if(Pu=ze(T,{col:o,row:s,table:a,context:null,value:i,dataValue:r,percentile:ae})||"#20a8d8",L==="right"){const jo=H?rt.left+k/2:rt.left+rt.width-k/2;si.push({x:jo,y:rt.top}),si.push({x:jo,y:rt.top+rt.height})}else L==="bottom"&&(si.push({x:rt.left,y:rt.top+rt.height-k/2}),si.push({x:rt.left+rt.width,y:rt.top+rt.height-k/2}));else if(q>0)if(Pu=ze(P,{col:o,row:s,table:a,context:null,value:i,dataValue:r,percentile:q})||"#20a8d8",L==="right"){const jo=H?he.left+he.width-k/2:he.left+k/2;si.push({x:jo,y:he.top}),si.push({x:jo,y:he.top+he.height})}else L==="bottom"&&(si.push({x:he.left,y:he.top+he.height-k/2}),si.push({x:he.left+he.width,y:he.top+he.height-k/2}));const pv=un({x:0,y:0,stroke:Pu,lineWidth:Tu,points:si});v.addChild(pv)}}else if(p==="negative_no_axis"){const fe=m<0?-m:0,ne=b>0?b:0,ie=Math.max(fe,ne),ce=ie===0?0:Math.abs(le)/ie,ae=_;let q=Math.min(ae*ce,ae);o!==a.colCount-1||ce!==1||H||(q-=1);const _e=X+w-F-z,oe=H?$+Q-q:$,Y=ze(R,{col:o,row:s,table:a,context:null,value:i,dataValue:r,percentile:ce});if(Y){const he=Ze({x:oe,y:_e,width:ae,height:F,fill:Y});v.addChild(he)}const de={left:oe,top:_e,width:q,height:F};let K;K=le>=0?ze(B,{col:o,row:s,table:a,context:null,value:i,percentile:ce,dataValue:r})||"#20a8d8":ze(A,{col:o,row:s,table:a,context:null,value:i,dataValue:r,percentile:ce})||"#20a8d8";const ut=Ze({x:de.left,y:de.top,width:de.width,height:de.height,fill:K});if(v.addChild(ut),E&&le){const he=k,We=[];let bt;if(bt=le>=0?ze(T,{col:o,row:s,table:a,context:null,value:i,dataValue:r,percentile:ce})||"#20a8d8":ze(P,{col:o,row:s,table:a,context:null,value:i,dataValue:r,percentile:ce})||"#20a8d8",L==="right"){const rt=H?de.left+k/2:de.left+de.width-k/2;We.push({x:rt,y:de.top}),We.push({x:rt,y:de.top+de.height})}else L==="bottom"&&(We.push({x:de.left,y:de.top+de.height-k/2}),We.push({x:de.left+de.width,y:de.top+de.height-k/2}));const ki=un({x:0,y:0,stroke:bt,lineWidth:he,points:We});v.addChild(ki)}}}return v}function U3(n,e,t,i,r,o){var s,l,a,d,u,h,c,g,f,p,m,b,C,_,w,y;if(t!=null&&t.zero&&(n=Math.min(n,0),e=Math.max(e,0)),t==null?void 0:t.expand){const S=n,R=e;O(t.expand.min)&&(n=S-(R-S)*t.expand.min),O(t.expand.max)&&(e=R+(R-S)*t.expand.max)}let v,x;if(J(t==null?void 0:t.min)&&(n=t.min),J(t==null?void 0:t.max)&&(e=t.max),(t==null?void 0:t.type)==="log"?(v=new fl,v.base((s=t==null?void 0:t.base)!==null&&s!==void 0?s:10)):(t==null?void 0:t.type)==="symlog"?(v=new gl,v.constant((l=t==null?void 0:t.constant)!==null&&l!==void 0?l:10)):v=new Vo,v.domain([n,e],!!(t!=null&&t.nice)),o)$3(v,o);else if(t!=null&&t.nice){let S=(h=(d=(a=t.tick)===null||a===void 0?void 0:a.forceTickCount)!==null&&d!==void 0?d:(u=t.tick)===null||u===void 0?void 0:u.tickCount)!==null&&h!==void 0?h:10;Ae(S)&&(S=S({axisLength:r,labelStyle:(g=(c=t==null?void 0:t.label)===null||c===void 0?void 0:c.style)!==null&&g!==void 0?g:{fontSize:gs.LABEL_FONT_SIZE}})),t.niceType==="accurateFirst"&&(S=Math.max(10,S)),Te(t.min)&&Te(t.max)?v.nice(S):O(t.min)&&Te(t.max)?v.niceMax(S):Te(t.min)&&O(t.max)&&v.niceMin(S)}return delete v._niceType,x=((p=(f=o==null?void 0:o.targetTicks)===null||f===void 0?void 0:f.length)!==null&&p!==void 0?p:!((m=t==null?void 0:t.tick)===null||m===void 0)&&m.forceTickCount)?v.forceTicks((C=(b=o==null?void 0:o.targetTicks)===null||b===void 0?void 0:b.length)!==null&&C!==void 0?C:(_=t==null?void 0:t.tick)===null||_===void 0?void 0:_.forceTickCount):v.ticks(J((w=t==null?void 0:t.tick)===null||w===void 0?void 0:w.tickCount)?t.tick.tickCount:5,{noDecimals:(y=t==null?void 0:t.tick)===null||y===void 0?void 0:y.noDecimals}),{range:v.domain(),ticks:x}}function $3(n,e){n.niceMax(e.targetTicks.length)}function K3(n,e,t,i,r,o,s,l,a,d,u,h,c,g,f,p,m,b){var C,_,w,y,v,x,S,R,B,A,M,H,E,T,P,k,L,F,z,I,N,W,D,G;if(!n){const te=oi(r,o,f,g);b&&(n=g.scenegraph.highPerformanceGetCell(r,o,!0))&&n.role==="cell"&&n.setAttributes({x:t,y:i,width:l,height:a,lineWidth:(_=(C=f==null?void 0:f.group)===null||C===void 0?void 0:C.lineWidth)!==null&&_!==void 0?_:void 0,fill:(y=(w=f==null?void 0:f.group)===null||w===void 0?void 0:w.fill)!==null&&y!==void 0?y:void 0,stroke:(x=(v=f==null?void 0:f.group)===null||v===void 0?void 0:v.stroke)!==null&&x!==void 0?x:void 0,strokeArrayWidth:te,strokeArrayColor:(R=(S=f==null?void 0:f.group)===null||S===void 0?void 0:S.strokeArrayColor)!==null&&R!==void 0?R:void 0,cursor:(A=(B=f==null?void 0:f.group)===null||B===void 0?void 0:B.cursor)!==null&&A!==void 0?A:void 0,lineDash:(H=(M=f==null?void 0:f.group)===null||M===void 0?void 0:M.lineDash)!==null&&H!==void 0?H:void 0,lineCap:"butt",clip:!0,cornerRadius:f.group.cornerRadius}),n&&n.role==="cell"||((n=new Pe({x:t,y:i,width:l,height:a,lineWidth:(T=(E=f==null?void 0:f.group)===null||E===void 0?void 0:E.lineWidth)!==null&&T!==void 0?T:void 0,fill:(k=(P=f==null?void 0:f.group)===null||P===void 0?void 0:P.fill)!==null&&k!==void 0?k:void 0,stroke:(F=(L=f==null?void 0:f.group)===null||L===void 0?void 0:L.stroke)!==null&&F!==void 0?F:void 0,strokeArrayWidth:te,strokeArrayColor:(I=(z=f==null?void 0:f.group)===null||z===void 0?void 0:z.strokeArrayColor)!==null&&I!==void 0?I:void 0,cursor:(W=(N=f==null?void 0:f.group)===null||N===void 0?void 0:N.cursor)!==null&&W!==void 0?W:void 0,lineDash:(G=(D=f==null?void 0:f.group)===null||D===void 0?void 0:D.lineDash)!==null&&G!==void 0?G:void 0,lineCap:"butt",clip:!0,cornerRadius:f.group.cornerRadius})).role="cell",n.col=r,n.row=o,e==null||e.addCellGroup(n))}let V;if(c){let te=r,le=o;m&&(te=m.start.col,le=m.start.row),V=g.getCellIcons(te,le)}let X=0,$=0;if(Array.isArray(V)&&V.length!==0){const{leftIconWidth:te,rightIconWidth:le,absoluteRightIconWidth:fe}=Do(V,n,m,g);X=te+le,$=te,n.forEachChildren(ne=>{ne.role==="icon-left"?ne.setAttribute("x",ne.attribute.x+d[3]):ne.role==="icon-right"?ne.setAttribute("x",ne.attribute.x+l-le-d[1]):ne.role==="icon-absolute-right"&&ne.setAttribute("x",ne.attribute.x+l-fe-d[1])}),n.forEachChildren(ne=>{h==="middle"?ne.setAttribute("y",(a-ne.AABBBounds.height())/2):h==="bottom"?ne.setAttribute("y",a-ne.AABBBounds.height()-d[2]):ne.setAttribute("y",d[0])})}const Q=Y3(r,o,s-X,l,a,d,f,p,g);return Q&&n.appendChild(Q),l-=d[1]+d[3]+X,a-=d[0]+d[2],u==="center"?Q.setAttribute("x",d[3]+$+(l-Q.AABBBounds.width())/2):u==="right"?Q.setAttribute("x",d[3]+$+l-Q.AABBBounds.width()):Q.setAttribute("x",d[3]+$),h==="middle"?Q.setAttribute("y",d[0]+(a-Q.AABBBounds.height())/2):h==="bottom"?Q.setAttribute("y",d[0]+a-Q.AABBBounds.height()):Q.setAttribute("y",d[0]),n}function Y3(n,e,t,i,r,o,s,l,a){var d,u;const h=a._getCellStyle(n,e),c=Z("buttonColor",h,n,e,a),g=Z("buttonBorderColor",h,n,e,a),f=Z("buttonLineWidth",h,n,e,a),p=Z("buttonBorderRadius",h,n,e,a),m=Z("buttonHoverColor",h,n,e,a),b=Z("buttonHoverBorderColor",h,n,e,a),C=Z("buttonPadding",h,n,e,a),_=Z("buttonTextHoverColor",h,n,e,a),w=Z("buttonDisableColor",h,n,e,a),y=Z("buttonDisableBorderColor",h,n,e,a),v=Z("buttonTextDisableColor",h,n,e,a),x=a.getCellValue(n,e),S=a.getCellOriginValue(n,e),R=cn(n,e,a),B=a._getCellStyle(n,e),A=(d=B.autoWrapText)!==null&&d!==void 0?d:a.internalProps.autoWrapText,{lineClamp:M}=B,H=t==="auto",E=a.isAutoRowHeight(e),{disable:T,text:P}=l,k=ze(T,{col:n,row:e,table:a,context:null,value:x,dataValue:S}),L=ze(P,{col:n,row:e,table:a,context:null,value:x,dataValue:S}),F=(u=L??x)!==null&&u!==void 0?u:"",z={maxLineWidth:H?1/0:i-(o[1]+o[3]+R),textAlign:"left",textBaseline:"top",autoWrapText:A,lineClamp:M,wordBreak:"break-word",heightLimit:E?-1:r-Math.floor(o[0]+o[2]),pickable:!1,dx:R,whiteSpace:F.length!==1||A?"normal":"no-wrap"},I=s.text?Object.assign({},s.text,z):z,N={x:0,y:0,cursor:k?"not-allowed":"pointer",disable:k,childrenPickable:!1,text:F.length===1?F[0]:F,textStyle:I,padding:C,panel:{visible:!0,fill:k?w:c,stroke:k?y:g,lineWidth:f,cornerRadius:p},state:{text:{},panel:{hover:{fill:m,stroke:b}}}};v&&(N.state.text.fill=v),_&&(N.state.text.hover.fill=_);const W=new ll(N);return W.name="button",k||(W.addEventListener("mouseenter",()=>{W.addState("hover",!0,!1),W.stage.renderNextFrame()}),W.addEventListener("mouseleave",()=>{W.removeState("hover",!1),W.stage.renderNextFrame()})),W}const X3=()=>{ue.registerFunction("createChartCellGroup",H3),ue.registerFunction("getAxisDomainRangeAndLabels",U3)},q3=()=>{ue.registerFunction("createCheckboxCellGroup",k3)},Z3=()=>{ue.registerFunction("createImageCellGroup",lk)},J3=()=>{ue.registerFunction("createProgressBarCell",j3)},Q3=()=>{ue.registerFunction("createRadioCellGroup",L3)},eO=()=>{ue.registerFunction("createSwitchCellGroup",O3)},tO=()=>{ue.registerFunction("createButtonCellGroup",K3)},nO=()=>{ue.registerFunction("createSparkLineCellGroup",W3)},iO=()=>{ue.registerFunction("createTextCellGroup",G3)},rO=()=>{ue.registerFunction("createVideoCellGroup",V3)};_3(),w3(),y3(),v3(),S3(),x3(),M3(),uz(),X3(),q3(),Z3(),J3(),Q3(),eO(),tO(),nO(),iO(),rO();class KO extends cI{}Rw();export{t2 as $,jO as A,Ee as B,Ao as C,Fw as D,GO as E,$O as F,jn as G,be as H,Hr as I,DO as J,UO as K,j0 as L,WO as M,Zz as N,NO as O,Vs as P,xe as Q,UF as R,kr as S,Rt as T,$F as U,ue as V,Je as W,YP as X,ZP as Y,JP as Z,e2 as _,Ze as a,QP as a0,XP as a1,mO as a2,qP as a3,pO as a4,CO as a5,bO as a6,n2 as a7,bz as a8,Me as a9,rO as aA,PO as aB,zO as aC,AO as aD,af as aE,TO as aF,MO as aG,Ok as aH,ll as aI,Po as aJ,Ho as aK,sn as aL,IO as aM,br as aa,LO as ab,FO as ac,XC as ad,iI as ae,j as af,hs as ag,Jt as ah,Mn as ai,Cz as aj,Co as ak,Sn as al,_2 as am,_3 as an,w3 as ao,y3 as ap,v3 as aq,S3 as ar,x3 as as,X3 as at,q3 as au,Z3 as av,J3 as aw,Q3 as ax,nO as ay,iO as az,tc as b,un as c,we as d,En as e,Ds as f,rB as g,Ce as h,se as i,KO as j,OO as k,kw as l,pt as m,U as n,ve as o,ot as p,Dl as q,yO as r,HO as s,cO as t,EO as u,et as v,kO as w,hf as x,VO as y,Jz as z};
