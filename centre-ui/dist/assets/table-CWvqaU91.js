import{d7 as T,cP as K,a9 as B,bq as F,d8 as L,O as P,a as M,d9 as G,cL as N,i as U,$ as E,a5 as $,cN as q}from"./index-D_-DzWhp.js";function J(t){return T({url:"/systemManage/getRoleList",method:"get",params:t})}function Q(){return T({url:"/systemManage/getAllRoles",method:"get"})}function Z(t){return T({url:"/systemManage/getUserList",method:"get",params:t})}function H(t){const{loading:d,startLoading:y,endLoading:i}=K(),{bool:w,setBool:m}=B(),{apiFn:v,apiParams:u,transformer:k,immediate:p=!0,getColumnChecks:S,getColumns:z}=t,n=F(L({...u})),g=P(t.columns()),b=P([]),f=P(S(t.columns())),C=M(()=>z(g.value,f.value));function O(){g.value=t.columns();const r=new Map(f.value.map(e=>[e.key,e.checked])),l=S(g.value);f.value=l.map(e=>({...e,checked:r.get(e.key)??e.checked}))}async function h(){var a;y();const r=_(n),l=await v(r),e=k(l);b.value=e.data,m(e.data.length===0),await((a=t.onFetched)==null?void 0:a.call(t,e)),i()}function _(r){const l={};return Object.entries(r).forEach(([e,a])=>{a!=null&&(l[e]=a)}),l}function c(r){Object.assign(n,r)}function D(){Object.assign(n,L(u))}return p&&h(),{loading:d,empty:w,data:b,columns:C,columnChecks:f,reloadColumns:O,getData:h,searchParams:n,updateSearchParams:c,resetSearchParams:D}}const W={1:"page.manage.common.status.enable",2:"page.manage.common.status.disable"},ee=G(W),Y={1:"page.manage.user.gender.male",2:"page.manage.user.gender.female"},te=G(Y);function ae(t){const d=N(),y=U(),i=M(()=>y.isMobile),{apiFn:w,apiParams:m,immediate:v,showTotal:u}=t,k="__selection__",p="__expand__",{loading:S,empty:z,data:n,columns:g,columnChecks:b,reloadColumns:f,getData:C,searchParams:O,updateSearchParams:h,resetSearchParams:_}=H({apiFn:w,apiParams:m,columns:t.columns,transformer:e=>{const{records:a=[],current:s=1,size:x=10,total:o=0}=e.data||{},R=x<=0?10:x;return{data:a.map((j,I)=>({...j,index:(s-1)*R+I+1})),pageNum:s,pageSize:R,total:o}},getColumnChecks:e=>{const a=[];return e.forEach(s=>{A(s)?a.push({key:s.key,title:s.title,checked:!0}):s.type==="selection"?a.push({key:k,title:E("common.check"),checked:!0}):s.type==="expand"&&a.push({key:p,title:E("common.expandColumn"),checked:!0})}),a},getColumns:(e,a)=>{const s=new Map;return e.forEach(o=>{A(o)?s.set(o.key,o):o.type==="selection"?s.set(k,o):o.type==="expand"&&s.set(p,o)}),a.filter(o=>o.checked).map(o=>s.get(o.key))},onFetched:async e=>{const{pageNum:a,pageSize:s,total:x}=e;r({page:a,pageSize:s,itemCount:x})},immediate:v}),c=F({page:1,pageSize:10,showSizePicker:!0,itemCount:0,pageSizes:[10,15,20,25,30],onUpdatePage:async e=>{c.page=e,h({current:e,size:c.pageSize}),C()},onUpdatePageSize:async e=>{c.pageSize=e,c.page=1,h({current:c.page,size:e}),C()},...u?{prefix:e=>E("datatable.itemCount",{total:e.itemCount})}:{}}),D=M(()=>({...c,pageSlot:i.value?3:9,prefix:!i.value&&u?c.prefix:void 0}));function r(e){Object.assign(c,e)}async function l(e=1){r({page:e}),h({current:e,size:c.pageSize}),await C()}return d.run(()=>{$(()=>y.locale,()=>{f()})}),q(()=>{d.stop()}),{loading:S,empty:z,data:n,columns:g,columnChecks:b,reloadColumns:f,pagination:c,mobilePagination:D,updatePagination:r,getData:C,getDataByPage:l,searchParams:O,updateSearchParams:h,resetSearchParams:_}}function se(t,d){const{bool:y,setTrue:i,setFalse:w}=B(),m=P("add");function v(){m.value="add",i()}const u=P(null);function k(n){m.value="edit";const g=t.value.find(b=>b.id===n)||null;u.value=L(g),i()}const p=P([]);async function S(){var n;(n=window.$message)==null||n.success(E("common.deleteSuccess")),p.value=[],await d()}async function z(){var n;(n=window.$message)==null||n.success(E("common.deleteSuccess")),await d()}return{drawerVisible:y,openDrawer:i,closeDrawer:w,operateType:m,handleAdd:v,editingData:u,handleEdit:k,checkedRowKeys:p,onBatchDeleted:S,onDeleted:z}}function A(t){return!!t.key}export{se as a,W as b,te as c,Q as d,ee as e,J as f,Z as g,Y as h,ae as u};
