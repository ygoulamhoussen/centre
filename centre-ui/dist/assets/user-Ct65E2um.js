import{a as re,b as ue,c as pe,d as ie,_ as me,N as de,e as ce}from"./round-refresh-CHdn3SJ2.js";import{c as Y,e as H,d as _e,u as fe,a as ge,g as ve,h as he,b as be}from"./table-CWvqaU91.js";import{u as X,a as Z,b as J,_ as Ne}from"./form-D6Mkvttn.js";import{d as V,c$ as z,cY as Q,a as ee,$ as l,O as j,a5 as ye,c as O,k as t,l as a,g as e,b as I,F as A,Z as W,a2 as T,X as B,Y as F,o as R,b8 as ae,aO as q,i as ke,a6 as $,d0 as we}from"./index-D_-DzWhp.js";import{_ as Re,a as xe}from"./DrawerContent-BY8pXFfO.js";import{_ as le}from"./Input-Bb-Nkj9P.js";import{_ as Se,a as Ge,b as Ue}from"./DataTable-Buj-Hzbd.js";import{_ as te}from"./Select-BYkyg5_P.js";import{_ as ne}from"./Space-CoVGbzuR.js";import{a as Pe}from"./Grid-CLqtPmRw.js";import{N as K}from"./Tag-wiA3KfAO.js";import"./use-merged-state-DuV1Lu3L.js";import"./create-B6F92WxY.js";import"./Dropdown-BfCXARAG.js";import"./Popover-uiGA841y.js";import"./map-BMPY2oeZ.js";import"./Follower-CPJzzLbY.js";import"./next-frame-once-C5Ksf8W7.js";import"./cssr-BW6v_MNg.js";import"./use-compitable-Cr7qxnTd.js";import"./create-ref-setter-C4J8sofl.js";import"./Checkbox-BH2EHdvK.js";import"./Tooltip-D7FLeIpa.js";import"./get-slot-Bk_rJcZu.js";import"./Empty-DLPWk6jr.js";import"./Pagination-nz9vbLQM.js";import"./index-CxXG09Nk.js";const De=V({name:"UserOperateDrawer",__name:"user-operate-drawer",props:z({operateType:{},rowData:{}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:z(["submitted"],["update:visible"]),setup(b,{emit:P}){const N=b,k=P,f=Q(b,"visible"),{formRef:x,validate:m,restoreValidation:S}=X(),{defaultRequiredRule:G}=Z(),w=ee(()=>({add:l("page.manage.user.addUser"),edit:l("page.manage.user.editUser")})[N.operateType]),n=j(i());function i(){return{userName:"",userGender:null,nickName:"",userPhone:"",userEmail:"",userRoles:[],status:null}}const y={userName:G,status:G},c=j([]);async function U(){const{error:v,data:u}=await _e();if(!v){const h=u.map(o=>({label:o.roleName,value:o.roleCode})),d=n.value.userRoles.map(o=>({label:o,value:o}));c.value=[...d,...h]}}function D(){n.value=i(),N.operateType==="edit"&&N.rowData&&Object.assign(n.value,N.rowData)}function g(){f.value=!1}async function E(){var v;await m(),(v=window.$message)==null||v.success(l("common.updateSuccess")),g(),k("submitted")}return ye(f,()=>{f.value&&(D(),S(),U())}),(v,u)=>{const h=le,d=Ne,o=Ge,p=Se,s=te,M=J,C=T,_=ne,oe=Re,se=xe;return R(),O(se,{show:f.value,"onUpdate:show":u[7]||(u[7]=r=>f.value=r),"display-directive":"show",width:360},{default:t(()=>[a(oe,{title:e(w),"native-scrollbar":!1,closable:""},{footer:t(()=>[a(_,{size:16},{default:t(()=>[a(C,{onClick:g},{default:t(()=>[B(F(e(l)("common.cancel")),1)]),_:1}),a(C,{type:"primary",onClick:E},{default:t(()=>[B(F(e(l)("common.confirm")),1)]),_:1})]),_:1})]),default:t(()=>[a(M,{ref_key:"formRef",ref:x,model:e(n),rules:y},{default:t(()=>[a(d,{label:e(l)("page.manage.user.userName"),path:"userName"},{default:t(()=>[a(h,{value:e(n).userName,"onUpdate:value":u[0]||(u[0]=r=>e(n).userName=r),placeholder:e(l)("page.manage.user.form.userName")},null,8,["value","placeholder"])]),_:1},8,["label"]),a(d,{label:e(l)("page.manage.user.userGender"),path:"userGender"},{default:t(()=>[a(p,{value:e(n).userGender,"onUpdate:value":u[1]||(u[1]=r=>e(n).userGender=r)},{default:t(()=>[(R(!0),I(A,null,W(e(Y),r=>(R(),O(o,{key:r.value,value:r.value,label:e(l)(r.label)},null,8,["value","label"]))),128))]),_:1},8,["value"])]),_:1},8,["label"]),a(d,{label:e(l)("page.manage.user.nickName"),path:"nickName"},{default:t(()=>[a(h,{value:e(n).nickName,"onUpdate:value":u[2]||(u[2]=r=>e(n).nickName=r),placeholder:e(l)("page.manage.user.form.nickName")},null,8,["value","placeholder"])]),_:1},8,["label"]),a(d,{label:e(l)("page.manage.user.userPhone"),path:"userPhone"},{default:t(()=>[a(h,{value:e(n).userPhone,"onUpdate:value":u[3]||(u[3]=r=>e(n).userPhone=r),placeholder:e(l)("page.manage.user.form.userPhone")},null,8,["value","placeholder"])]),_:1},8,["label"]),a(d,{label:e(l)("page.manage.user.userEmail"),path:"email"},{default:t(()=>[a(h,{value:e(n).userEmail,"onUpdate:value":u[4]||(u[4]=r=>e(n).userEmail=r),placeholder:e(l)("page.manage.user.form.userEmail")},null,8,["value","placeholder"])]),_:1},8,["label"]),a(d,{label:e(l)("page.manage.user.userStatus"),path:"status"},{default:t(()=>[a(p,{value:e(n).status,"onUpdate:value":u[5]||(u[5]=r=>e(n).status=r)},{default:t(()=>[(R(!0),I(A,null,W(e(H),r=>(R(),O(o,{key:r.value,value:r.value,label:e(l)(r.label)},null,8,["value","label"]))),128))]),_:1},8,["value"])]),_:1},8,["label"]),a(d,{label:e(l)("page.manage.user.userRole"),path:"roles"},{default:t(()=>[a(s,{value:e(n).userRoles,"onUpdate:value":u[6]||(u[6]=r=>e(n).userRoles=r),multiple:"",options:e(c),placeholder:e(l)("page.manage.user.form.userRole")},null,8,["value","options","placeholder"])]),_:1},8,["label"])]),_:1},8,["model"])]),_:1},8,["title"])]),_:1},8,["show"])}}}),Ee=V({name:"UserSearch",__name:"user-search",props:{model:{required:!0},modelModifiers:{}},emits:z(["reset","search"],["update:model"]),setup(b,{emit:P}){const N=P,{formRef:k,validate:f,restoreValidation:x}=X(),m=Q(b,"model"),S=ee(()=>{const{patternRules:n}=Z();return{userEmail:n.email,userPhone:n.phone}});async function G(){await x(),N("reset")}async function w(){await f(),N("search")}return(n,i)=>{const y=le,c=ue,U=te,D=pe,g=T,E=ie,v=ne,u=Pe,h=J,d=re,o=me,p=ae;return R(),O(p,{bordered:!1,size:"small",class:"card-wrapper"},{default:t(()=>[a(o,null,{default:t(()=>[a(d,{title:e(l)("common.search"),name:"user-search"},{default:t(()=>[a(h,{ref_key:"formRef",ref:k,model:m.value,rules:e(S),"label-placement":"left","label-width":80},{default:t(()=>[a(u,{responsive:"screen","item-responsive":""},{default:t(()=>[a(c,{span:"24 s:12 m:6",label:e(l)("page.manage.user.userName"),path:"userName",class:"pr-24px"},{default:t(()=>[a(y,{value:m.value.userName,"onUpdate:value":i[0]||(i[0]=s=>m.value.userName=s),placeholder:e(l)("page.manage.user.form.userName")},null,8,["value","placeholder"])]),_:1},8,["label"]),a(c,{span:"24 s:12 m:6",label:e(l)("page.manage.user.userGender"),path:"userGender",class:"pr-24px"},{default:t(()=>[a(U,{value:m.value.userGender,"onUpdate:value":i[1]||(i[1]=s=>m.value.userGender=s),placeholder:e(l)("page.manage.user.form.userGender"),options:e(q)(e(Y)),clearable:""},null,8,["value","placeholder","options"])]),_:1},8,["label"]),a(c,{span:"24 s:12 m:6",label:e(l)("page.manage.user.nickName"),path:"nickName",class:"pr-24px"},{default:t(()=>[a(y,{value:m.value.nickName,"onUpdate:value":i[2]||(i[2]=s=>m.value.nickName=s),placeholder:e(l)("page.manage.user.form.nickName")},null,8,["value","placeholder"])]),_:1},8,["label"]),a(c,{span:"24 s:12 m:6",label:e(l)("page.manage.user.userPhone"),path:"userPhone",class:"pr-24px"},{default:t(()=>[a(y,{value:m.value.userPhone,"onUpdate:value":i[3]||(i[3]=s=>m.value.userPhone=s),placeholder:e(l)("page.manage.user.form.userPhone")},null,8,["value","placeholder"])]),_:1},8,["label"]),a(c,{span:"24 s:12 m:6",label:e(l)("page.manage.user.userEmail"),path:"userEmail",class:"pr-24px"},{default:t(()=>[a(y,{value:m.value.userEmail,"onUpdate:value":i[4]||(i[4]=s=>m.value.userEmail=s),placeholder:e(l)("page.manage.user.form.userEmail")},null,8,["value","placeholder"])]),_:1},8,["label"]),a(c,{span:"24 s:12 m:6",label:e(l)("page.manage.user.userStatus"),path:"userStatus",class:"pr-24px"},{default:t(()=>[a(U,{value:m.value.status,"onUpdate:value":i[5]||(i[5]=s=>m.value.status=s),placeholder:e(l)("page.manage.user.form.userStatus"),options:e(q)(e(H)),clearable:""},null,8,["value","placeholder","options"])]),_:1},8,["label"]),a(c,{span:"24 m:12",class:"pr-24px"},{default:t(()=>[a(v,{class:"w-full",justify:"end"},{default:t(()=>[a(g,{onClick:G},{icon:t(()=>[a(D,{class:"text-icon"})]),default:t(()=>[B(" "+F(e(l)("common.reset")),1)]),_:1}),a(g,{type:"primary",ghost:"",onClick:w},{icon:t(()=>[a(E,{class:"text-icon"})]),default:t(()=>[B(" "+F(e(l)("common.search")),1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["title"])]),_:1})]),_:1})}}}),Ce={class:"min-h-500px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"};function L(b){return typeof b=="function"||Object.prototype.toString.call(b)==="[object Object]"&&!we(b)}const sa=V({__name:"user",setup(b){const P=ke(),{columns:N,columnChecks:k,data:f,getData:x,getDataByPage:m,loading:S,mobilePagination:G,searchParams:w,resetSearchParams:n}=fe({apiFn:ve,showTotal:!0,apiParams:{current:1,size:10,status:null,userName:null,userGender:null,nickName:null,userPhone:null,userEmail:null},columns:()=>[{type:"selection",align:"center",width:48},{key:"index",title:l("common.index"),align:"center",width:64},{key:"userName",title:l("page.manage.user.userName"),align:"center",minWidth:100},{key:"userGender",title:l("page.manage.user.userGender"),align:"center",width:100,render:o=>{if(o.userGender===null)return null;const p={1:"primary",2:"error"},s=l(he[o.userGender]);return a(K,{type:p[o.userGender]},{default:()=>[" ",s," "]})}},{key:"nickName",title:l("page.manage.user.nickName"),align:"center",minWidth:100},{key:"userPhone",title:l("page.manage.user.userPhone"),align:"center",width:120},{key:"userEmail",title:l("page.manage.user.userEmail"),align:"center",minWidth:200},{key:"status",title:l("page.manage.user.userStatus"),align:"center",width:100,render:o=>{if(o.status===null)return null;const p={1:"success",2:"warning"},s=l(be[o.status]);return a(K,{type:p[o.status]},{default:()=>[" ",s," "]})}},{key:"operate",title:l("common.operate"),align:"center",width:130,render:o=>{let p;return a("div",{class:"flex-center gap-8px"},[a(T,{type:"primary",ghost:!0,size:"small",onClick:()=>d(o.id)},L(p=l("common.edit"))?p:{default:()=>[p]}),a(de,{onPositiveClick:()=>h()},{default:()=>l("common.confirmDelete"),trigger:()=>{let s;return a(T,{type:"error",ghost:!0,size:"small"},L(s=l("common.delete"))?s:{default:()=>[s]})}})])}}]}),{drawerVisible:i,operateType:y,editingData:c,handleAdd:U,handleEdit:D,checkedRowKeys:g,onBatchDeleted:E,onDeleted:v}=ge(f,x);async function u(){E()}function h(){v()}function d(o){D(o)}return(o,p)=>{const s=ce,M=Ue,C=ae;return R(),I("div",Ce,[a(Ee,{model:e(w),"onUpdate:model":p[0]||(p[0]=_=>$(w)?w.value=_:null),onReset:e(n),onSearch:e(m)},null,8,["model","onReset","onSearch"]),a(C,{title:e(l)("page.manage.user.title"),bordered:!1,size:"small",class:"sm:flex-1-hidden card-wrapper"},{"header-extra":t(()=>[a(s,{columns:e(k),"onUpdate:columns":p[1]||(p[1]=_=>$(k)?k.value=_:null),"disabled-delete":e(g).length===0,loading:e(S),onAdd:e(U),onDelete:u,onRefresh:e(x)},null,8,["columns","disabled-delete","loading","onAdd","onRefresh"])]),default:t(()=>[a(M,{"checked-row-keys":e(g),"onUpdate:checkedRowKeys":p[2]||(p[2]=_=>$(g)?g.value=_:null),columns:e(N),data:e(f),size:"small","flex-height":!e(P).isMobile,"scroll-x":962,loading:e(S),remote:"","row-key":_=>_.id,pagination:e(G),class:"sm:h-full"},null,8,["checked-row-keys","columns","data","flex-height","loading","row-key","pagination"]),a(De,{visible:e(i),"onUpdate:visible":p[3]||(p[3]=_=>$(i)?i.value=_:null),"operate-type":e(y),"row-data":e(c),onSubmitted:e(m)},null,8,["visible","operate-type","row-data","onSubmitted"])]),_:1},8,["title"])])}}});export{sa as default};
